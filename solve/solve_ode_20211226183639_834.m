function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.258106342793710e-01   +5.025924923293082e-02   +7.194558826865193e-01   -1.754314343441310e-01   +3.290296870424565e-01   +2.909668168392029e-01   -8.507841971347095e-01   -7.946514825163271e-02   -4.269796468586385e-01   -4.387914136309860e-01   +6.253274503040245e-01   -6.803309657269604e-02   +6.176785425822254e-02   +1.312969466603112e-01   +4.557776377359312e-01   +3.877821266070428e-01; +1.000000000000000e+00   +1.307322385276691e-03   +5.832452149754181e-01   +1.315401646627528e-01   -4.484267735545681e-02   -3.369106588621267e-01   +1.097755644492347e-01   +5.430177769819112e-01   -2.947634562633158e-02   +9.488628130317171e-02   -4.001973687389667e-01   -1.795375501155730e-01   +5.655205212771441e-02   +4.189778548658079e-01   +5.301138574750398e-01   +5.810914045399401e-01; -3.130182265369085e-02   +1.739501278457962e-01   -1.381668053766980e-01   +3.603754431540200e-01   -6.412528726282413e-02   +1.814971695258815e-01   +4.054186613655108e-01   -4.394953731296457e-01   +1.199508305357321e-01   +7.314021707530025e-01   -2.621058568651056e-01   +5.792359967205319e-01   -2.460845961413609e-01   +1.108834619809851e-01   -1.515274259266048e-01   -6.376340278135187e-01; +2.427734616015513e-02   +1.696898306209009e-01   +4.396104848161104e-01   -3.190436353253026e-01   +5.107109922855225e-01   -2.920794970388114e-01   -5.997887597422410e-01   +1.352007937580773e-01   -2.781698887014542e-01   +2.342818915471138e-01   +2.087550607831914e-01   +1.766727914465788e-01   -2.435769449753636e-01   -8.134598544929337e-01   +1.420723240487308e-01   -2.325218840818775e-01; -3.004997419616326e-01   +2.135832996240622e-01   -3.186008227111790e-02   -6.803787496624029e-02   -3.827215537191878e-01   +3.476298806060004e-01   -9.172908187545475e-02   +1.067232824533944e-01   +2.652762278597997e-01   -2.498945848368802e-01   +5.915417469273485e-01   -3.537783006968725e-01   +1.501790091276561e-01   +3.337769509590047e-01   +4.006837742760243e-01   -5.588484808075489e-01; +5.965015047245485e-01   +8.543645601023346e-03   -3.943084252509297e-01   -3.083365645468666e-01   -1.355735990586182e-01   +4.116007752697549e-01   +3.458430397284426e-02   +3.059529770528174e-01   -4.304227277387740e-01   -6.909293038505555e-02   -6.825664907534502e-02   -8.389727841764653e-01   +4.037101133770269e-01   -9.391385301341795e-02   -3.374079116477575e-01   +2.694440159370631e-01; -2.922659905030243e-01   -1.538946835420855e-01   -3.688198611060023e-01   +5.292068284136270e-01   +1.805367490862470e-01   -2.387321598653645e-01   +6.081483270931169e-02   +1.566472885241406e-01   +1.530690338136097e-01   -1.360345037628034e-01   -2.315600259182033e-01   +9.392935539711010e-02   -2.830029219725589e-01   -4.781818204057603e-01   -4.153483681447168e-02   -1.888828311919892e-01; -6.343133730326320e-01   +2.528567144492816e-02   +6.150523031457739e-01   +4.356565116243998e-01   +1.456165274978453e-01   -9.715729710152571e-02   +1.826391518627139e-01   -3.376407707231177e-01   -3.325460555651608e-02   +2.984479917139607e-02   +2.749002854046855e-01   -2.742997931181336e-01   +5.927781061041761e-01   +7.853094563068604e-02   +5.698967606322586e-01   -4.807279850200062e-01; -1.872732715364551e-01   -2.603383634394064e-02   -3.380680286295062e-01   +7.084279114121316e-01   +4.296187239630867e-01   -1.798851901505826e-01   +5.182893363895221e-01   -1.771504050079489e-01   +8.862457289153938e-02   -1.754471293269740e-01   -3.118212231287513e-01   +3.711135170946807e-01   -6.304511416003145e-01   -1.265748108669500e-01   +4.108246027492266e-01   -7.462017571253198e-01; +3.794047591208515e-01   -5.230149092658065e-01   -5.403637337404986e-01   -2.299357685382466e-01   +5.108424180039914e-01   +6.446024903048493e-01   -5.988272715702359e-01   +7.191148342405146e-01   -2.650264889087297e-01   +3.689157244418430e-01   +1.800724520322320e-01   -4.531942731905797e-01   -3.161274966826814e-01   +1.951401349399932e-01   -3.247956715891532e-01   +2.721689336897063e-01; -2.558136918364827e-01   -1.776673968368720e-01   +3.615280763315334e-01   +4.289782649367603e-01   +4.911606326732054e-01   -4.570329271726953e-01   +2.640596403944575e-01   -1.319288501751793e-01   -4.178682436818509e-01   -3.777552240861839e-01   +2.715034781338656e-01   -1.658041740342938e-01   -3.600168998204631e-01   +2.402901404976212e-01   -8.354152406534232e-02   +4.365143167342363e-01; +2.438173804430281e-01   -3.594793775288684e-01   -5.127461168596427e-01   -6.359843697121772e-01   +3.013185430094817e-01   -2.645083126732911e-01   -6.684642041375306e-02   -6.427237692678412e-01   +8.965241963230651e-02   +5.303863064574913e-01   -1.396254815625730e-01   -2.425033060849627e-01   +7.031180330463022e-02   +2.541239408819959e-01   -5.944296492654636e-01   +3.398848021498878e-01; +1.505136650913483e-01   -3.544037486152215e-01   +2.595634378186223e-02   +8.126090927349620e-01   +3.049367705580451e-02   +4.211661062476163e-01   -4.826621838408434e-03   +5.855149899653574e-01   +2.160449241106236e-01   +1.407017651701153e-01   -7.354497667410469e-02   -3.035651265593013e-01   -1.849423459603814e-01   -2.078521937198742e-01   -7.948512859856471e-01   +4.791436161804423e-01; -7.038425632807879e-01   +5.315435317560405e-01   -4.785508849823878e-01   -2.735854387250445e-02   -2.782602157816508e-01   -4.190508730617077e-01   +5.780555471674520e-01   +4.600519715401371e-01   -1.721714724775501e-01   -8.095245834934742e-01   +9.490339701532717e-02   +3.752037031062964e-01   +1.719315247594677e-01   +3.895032842114746e-01   +7.414400936153570e-02   +4.825572266124488e-01; +8.979222668212292e-02   +1.759345346902492e-01   +1.723901923777945e-01   -1.502122301692045e-01   -2.221182468535094e-01   -1.118065757969562e-01   +1.348389964898898e-02   +6.100315024733812e-01   +1.054467532735277e-01   -2.695965518022009e-01   -3.351264372787987e-01   -2.560059580031710e-01   +1.319743878622686e-01   +1.534339615781212e-01   -6.388582386673505e-01   +8.874792761564142e-02; +3.364643969261424e-01   -1.433599666442187e-01   +2.239805985043802e-01   +5.426171958894382e-02   +8.765059281905829e-02   -6.820382295071870e-01   -9.471577998905002e-02   -2.273933404599182e-01   +4.728672554039485e-01   +1.215395409181813e-02   -4.608716193642163e-01   +1.919258272430731e-01   +8.635445933680364e-02   +2.801383880191998e-01   +1.959443364234352e-01   +3.143275769151283e-01];
L1E_L1I_iGABA_netcon = [-5.738747962819674e-01   -7.593782274464200e-02   -6.287397737244173e-01   +2.759917220137189e-02   -5.517548359835229e-03   -2.139540542520090e-01   +6.218483867479275e-03   -6.085790113595629e-01   -4.268110065251376e-01   +6.146790245547075e-01   -6.816231192087814e-02   +3.141787970871525e-01   +3.833551007717225e-01   +1.012308345046889e-01   -1.782742019932512e-01   -7.078434345927943e-01; +1.075552898473416e-01   +1.612219204711897e-01   -2.809585451052867e-01   -3.416626883728309e-02   -2.933666476056898e-01   +9.077589822940858e-02   +3.176797145503494e-01   -4.883073400837826e-02   +1.495938085411473e-01   +1.386422385398338e-01   -5.018600580207552e-01   +2.618649318529371e-01   -3.322880372067873e-01   +2.785438465284441e-01   +5.609905269681870e-03   +3.357722593911239e-01; +7.372278435570329e-01   -5.855619505759777e-01   -3.468190058098578e-01   +5.194951478702017e-01   +1.910038869598412e-01   -8.496957613960293e-01   +1.250816741650352e-01   +6.262921324977079e-02   +7.370199791665724e-01   +1.420977905465781e-01   -3.518198011428759e-01   +2.867082008038195e-01   -2.739636769538101e-01   -1.549250252627361e-01   -1.668999904050777e-01   -2.502855218803103e-01; -1.024813535046709e-01   -6.154707009200912e-02   +3.123985283932679e-01   -7.445004635430287e-02   +1.802472234973185e-01   +7.652914564703841e-01   -2.730847270203987e-01   -5.358285858129131e-01   -2.053743761739809e-01   +1.306325027943158e-02   -3.814235510351154e-01   -5.251175180439330e-01   -6.960205040022893e-02   +5.907421237867522e-02   -9.724462898359748e-02   -6.817459984083007e-02; -7.428844972996880e-01   -6.847778787295175e-02   +1.688140001126256e-01   +5.884037257305982e-02   +2.402866757158555e-01   -1.287577176261363e-02   +7.790026909517797e-01   -3.644998185393588e-01   +3.084417155139240e-01   -6.551055727893417e-01   +7.076858051050164e-01   -2.963348188686386e-01   -2.460594548311878e-01   -9.712874869723988e-02   +1.694116459897221e-01   -7.212425399140036e-02; -5.070413296980407e-01   +1.873008102922342e-01   +2.718225580031727e-01   +1.765096733002784e-01   +5.239701050536891e-01   +4.084422650552676e-02   -5.201126494964378e-01   +2.446773015481755e-01   -7.614841456555004e-01   +1.710541500950910e-01   -6.125162335471123e-01   +1.586775461536504e-01   +1.046963981651792e-01   +2.941727991262794e-01   -6.610568944713390e-01   -3.085926298683037e-01; +1.000000000000000e+00   -1.659825800611918e-01   +1.280006439329416e-01   -6.088705565780473e-01   -2.024203458298369e-01   +6.298845744592417e-02   +8.140384419934919e-02   -1.644424086419002e-01   -2.924856926077378e-01   +6.464730254867986e-01   -2.263499933233948e-01   +1.092875754616018e-01   -3.658534715547307e-01   -2.453207845334645e-02   +2.266373467232945e-01   +3.072926396656080e-01; -2.797462052141415e-01   +3.739386270348719e-01   +1.369246153674487e-01   -5.983518662146149e-02   +3.596610379663777e-01   +2.107946909497219e-01   -1.112018152069223e-01   +8.057959863970438e-01   +1.949884642411933e-01   +2.415333999767271e-01   -5.879616809235582e-01   +9.731444775163466e-02   -3.862267052464006e-01   -8.095296627390386e-01   -4.793299788300832e-02   -2.417632028708052e-01; +7.429193195992456e-02   -3.254869011053987e-01   -4.162506731733613e-01   +1.116701742586769e-01   +6.136233465697422e-03   -3.155389772065391e-01   +6.603550068587596e-01   +2.200734132830136e-01   -2.117591154530514e-01   -3.097837148913499e-01   -3.819671791380508e-01   +4.715740754770215e-01   +1.581985412700311e-01   +4.569818116167045e-02   +1.147774651050664e-02   +3.012156846050473e-01; +1.411280603428431e-01   +1.589948873524703e-01   +3.935098162528918e-01   -2.921413300463558e-01   -7.930695899867057e-01   +3.075069026462824e-01   -5.466060138368488e-01   +3.257917278292511e-02   -5.982219594823956e-01   +1.358949703993462e-01   +4.464977178561113e-01   -2.340675130706332e-01   +1.441853197239797e-01   +3.672520422588643e-01   -5.063500427669826e-01   -1.012516478403014e-01; -4.756731048406493e-01   +3.378822092783508e-01   +1.453050472657052e-01   -1.106985106178079e-01   -3.424718564444085e-01   -3.000046137707785e-01   +2.240013072181664e-01   +3.725168460030124e-02   +3.540899983148715e-01   -8.881280104489560e-02   +6.226723130579796e-02   +5.920607741551027e-01   +5.450852018083434e-01   +5.294331918139690e-01   +7.981925908182463e-02   -6.432737424226619e-01; -6.574449957166268e-01   -6.432258156338035e-01   -2.123366629562251e-01   +3.383355501554086e-01   +5.612802355345673e-01   -1.165131440571830e-01   -1.210734602341763e-01   +3.688537473192594e-01   +6.298455952004778e-01   +5.186068697897011e-01   -3.447956021273461e-01   -9.946199116097726e-02   +2.257559226840020e-01   +4.767149931300070e-01   -5.984569862382233e-01   -8.484101625340744e-01; -4.059251674106976e-02   +1.290580744481183e-01   -6.201367476567685e-01   -7.249186938123340e-01   +6.087284225360913e-01   -2.068966866361612e-01   -3.695292661788153e-01   -1.916951589298162e-01   +8.685921832695183e-02   -7.367856339043137e-02   +1.321795653655083e-03   -6.087690285228234e-01   -4.291409341551354e-02   -2.405257650960873e-01   +2.882680124297842e-01   +5.836044448324956e-02; -1.710075791058602e-01   -4.777528742932138e-01   -4.606248752944753e-01   -8.584170020112953e-01   +4.540720963026761e-01   +2.883569711509665e-01   -1.134104362921633e-01   +4.628013387198698e-01   -5.090499220818846e-02   -3.188000333921143e-02   -3.938023713172021e-01   -5.398090657251450e-01   -1.380881813324720e-01   -5.508372708688403e-01   -2.497871083803149e-01   -2.489810843199188e-01; -8.456321300525663e-01   +1.183995576601509e-01   +1.089960641902259e-01   +5.102281206640422e-03   -3.792359473474724e-01   -8.756478932298459e-02   +1.488481593540957e-01   +4.224573917658337e-01   -1.983714138680761e-01   -2.572027468372263e-03   +1.291617869777214e-02   +4.878435191500661e-01   +1.721301687966520e-01   +4.431010680365718e-01   -1.329377419284560e-01   -3.521762679883357e-01; -1.593204723732418e-02   -4.061794653183833e-01   -6.340429700571196e-01   -3.882170129716669e-01   +7.092425485376860e-02   +2.712041053252521e-01   +3.050720460232321e-01   -2.806928768253048e-01   +6.864892679300334e-01   -7.428188234343728e-01   -2.065015664435905e-01   +8.402315455420761e-01   -2.966115355787755e-01   -4.563847625724456e-01   -7.221210425903865e-01   +7.809572695403436e-03];
L2I_L1I_iGABA_netcon = [+2.204994911687365e-01   +8.837600548666769e-02   +3.685931933985722e-01   -6.169846246238706e-01   -3.640288340618882e-02   -3.466455835343484e-01   +2.053116998712281e-01   +3.254599250399213e-01; +9.533912301162224e-03   +2.094719986367203e-02   +7.261535411805098e-02   -3.291205188755167e-01   +1.632520931094770e-01   -2.154911615882466e-01   +2.861856670326233e-01   +4.972738361449054e-01; +1.555961883081363e-01   +6.145012396263695e-01   -8.860290882214782e-02   +1.908027507519181e-01   -5.261275858864205e-01   -8.242885077309212e-01   +1.620765788690329e-01   -3.970260677399927e-01; +3.610693016822104e-01   -5.146124352386788e-02   +8.702669435999221e-01   +5.069437935192083e-01   -3.271099079495642e-01   +3.259742635736234e-01   -2.494615346358387e-01   +1.967277613919226e-01; -3.668852119614952e-01   +7.758824203781349e-02   +4.138766664971124e-01   -2.443491804793870e-01   +6.222937346258932e-01   -4.516223403659537e-01   -6.274881017203640e-03   +1.883501039229087e-01; +2.354853698965295e-01   +2.088678988258530e-01   -3.671687597279315e-01   -1.577823668933024e-02   +2.126357088133108e-01   -2.939088869844988e-01   +3.741812722060749e-01   -2.371254005747785e-01; -3.854714951642931e-01   +5.902607859594763e-01   +7.660315836033719e-01   +3.081594690683373e-02   +5.663403525749239e-01   -4.650342476420685e-01   +1.998987731448795e-02   -2.076064452631565e-01; -2.757207373137785e-03   -7.851001043583145e-01   -6.908535863507048e-01   -1.268141912173020e-01   +1.327665699101421e-01   +7.036024264698600e-02   -9.491964164060869e-01   +4.657717345581268e-01; +2.203372756335950e-01   -5.645682395311298e-01   -4.649548973951827e-01   -5.692761099551794e-01   -3.865609291898231e-01   -7.293573196490240e-03   +5.201807233084843e-02   +4.212850823611770e-01; +7.565988162351496e-01   -5.636728811095979e-01   +3.195715302270948e-01   -3.875468850490008e-01   -7.123325988867320e-02   -2.663341339849710e-01   +7.116205361350761e-01   +3.241909114491898e-01; -5.062567688175107e-01   +7.792463872519058e-02   -8.590549206146376e-02   -4.750532040139836e-02   -1.924494595883943e-01   -3.328466065281402e-01   -7.836706213765765e-01   +1.897914336412462e-01; -4.160796584049071e-01   -1.963911617709656e-02   -3.359105364685444e-01   -3.204295524446027e-01   +3.273788368702626e-01   -8.400351176613979e-01   -3.359584051394287e-01   +2.012769502177314e-01; -4.385800422443994e-01   -3.268771470318799e-01   +4.749620764802074e-01   +1.056532172438045e-01   +5.441566055450883e-02   +4.696649505052294e-01   +1.605124581682972e-01   +7.524737333166280e-02; -4.564035269051002e-01   -6.167225695273606e-01   +8.534613784072359e-02   -4.359582264332822e-01   +1.324927699827290e-01   -7.313133480809728e-02   -6.220199729085437e-01   -3.323817842441751e-01; -3.744667508430210e-01   -1.846817882490517e-01   +4.777798923699748e-01   -6.218334378931989e-01   -4.970748455193291e-01   +3.694929401685028e-01   +3.174152591348829e-01   +2.904490342994173e-01; -5.738110117456599e-02   +1.000000000000000e+00   -9.864907627653401e-02   -4.479731525360582e-01   -4.266320497854159e-01   +8.060105426313959e-01   -1.471540067617178e-01   -9.969046096378162e-02];
L1I_L2I_iGABA_netcon = [+6.373540837314695e-01   -1.393705592420056e-02   -3.472379094422386e-02   +5.629208221338701e-02   +4.163876341063640e-01   -3.005186512715297e-01   -3.903227731236216e-01   -1.679140724959017e-01   -4.113350831260878e-01   +7.280551650161355e-01   +1.122078146562252e-01   -5.189074409030947e-01   +1.058601524283636e-01   +6.000254077322400e-01   -2.143503017555911e-01   -3.641485406913806e-01; -6.892317011920959e-01   +1.770390064075307e-01   -9.744489628231245e-03   -5.584138561283765e-01   -4.144984997103824e-02   -3.586396792263318e-02   +6.219438693630217e-01   +8.358116382715795e-02   -5.597729179279437e-01   +4.878112754858838e-01   -3.811767300898740e-01   +1.649279227101437e-01   +1.460023066086130e-02   +7.893263428096129e-01   +4.917519798261615e-01   +6.817605955777131e-01; -9.548832697185886e-02   +6.547659646612565e-01   +3.367063422289831e-01   +1.662991604548150e-01   -6.896040849872769e-01   -4.108946727661891e-01   +1.581377338277329e-01   +1.229587083874757e-01   -8.848785399835862e-01   +4.211707271748896e-01   -4.276257096868282e-01   +1.833721023915533e-01   -4.753524831657213e-01   -5.335169294526096e-01   -3.155228587565349e-01   +2.478501436389876e-01; -4.113163291182274e-01   -1.573614703296417e-01   +5.083944755041332e-01   +4.527807638386953e-01   -1.373803501811916e-02   -5.732735018407137e-01   +2.280933364174298e-01   -2.152468855075240e-01   +5.357947271312160e-01   -7.910875669218977e-02   -1.954761768559466e-01   -1.171609329968960e-01   -1.079579868363789e-03   -6.001880108370722e-01   -4.357769592462473e-01   +4.951075070554933e-01; +1.748292192628111e-01   -8.095378251592049e-01   -2.493232133294066e-01   -1.645737806325209e-01   +1.618963432508317e-01   -8.687972013854688e-02   +8.196083182920964e-02   -3.453642306735695e-01   +2.312674004998270e-01   -5.576100715774568e-01   +4.472093267396063e-01   +1.462537485868040e-01   +2.301489384967641e-02   +7.783798293117735e-01   -3.452511141464874e-02   -5.364447664449931e-01; +1.581863876313582e-01   +3.842645663601673e-01   -1.628053022534087e-01   +1.934349538056979e-02   +2.857833742546294e-01   -4.193620299662532e-01   +1.971629034989231e-01   +1.000000000000000e+00   -3.661960440100926e-01   -4.606589097733512e-01   +7.248703437711947e-01   -8.322919832644374e-02   -6.685465463225477e-01   +4.732856133394128e-02   -2.759488307820755e-02   -3.438835578654437e-02; +2.599512532673049e-01   -1.139464098430545e-01   -2.396608093031063e-01   -3.403676355358561e-01   -2.979984114497236e-01   +4.165753569740927e-01   -6.995048045765431e-01   -1.030814309724780e-01   +2.670290717087332e-01   -5.667602435365170e-02   +3.683597559079031e-01   +6.705671567023457e-01   -3.509430303802073e-01   -5.319517651856159e-01   +2.208297268263400e-02   -5.695932870779618e-01; -5.957562040521840e-02   +1.125623962833613e-01   -5.948787357206359e-02   +4.258864848684596e-01   +7.543863142616352e-01   -2.178591730876559e-01   -4.488137494682178e-03   -2.640716663702103e-01   -5.784223452337292e-01   -1.114220050874822e-02   -2.407797658549501e-01   -2.434398971966203e-02   -9.463898564777452e-02   -1.732987646330836e-01   +6.527529319667998e-01   -1.520650046996815e-01];
L2E_L1E_iAMPA_netcon = [-6.905781985304985e-02   -3.560229679837081e-01   +1.503589769355733e-01   -3.260897384075578e-01   +4.806429937766642e-02   +6.601439188766858e-02   +5.584962097918735e-01   +4.321805246056258e-01; +1.087737239683928e-01   -6.113375515352601e-01   -4.491908861641049e-01   +6.735350917810448e-02   -2.485328780620054e-01   -4.556115186317367e-01   +1.946274541732755e-01   -7.590006267570112e-01; -1.983954241198982e-01   +8.873885482137800e-01   +2.834409377731774e-01   +3.093733811749583e-01   -7.157746049525180e-01   +1.414311113820515e-01   -2.542238478967980e-01   -6.338054932893290e-02; -6.774952815338461e-01   +2.736911173393763e-01   +8.329005702890271e-02   -4.968460766723857e-01   -2.279815369792442e-02   -5.346374943449647e-01   +1.827900785942956e-01   +8.329913671563854e-01; +6.989712363485143e-02   +8.967883113942009e-02   -4.754736799943434e-02   +2.508174659970184e-01   -2.431639263877941e-01   -4.278924144953307e-01   +2.375595671070024e-01   -1.094995373856929e-01; +4.660557456881415e-01   -4.923901235972405e-01   -2.590673255770653e-01   +1.930317357584702e-01   -2.439944078824281e-01   +1.205735080548846e-02   +1.000000000000000e+00   -1.352077973986078e-01; -6.988104544611963e-02   -2.837262887791167e-01   -4.213245859299685e-01   -2.318958101396149e-01   +3.252422192707511e-01   +2.724735811434210e-01   -8.073292701664041e-02   +4.715230192452998e-01; -4.681400129410875e-01   -6.482405720497199e-02   +1.519922620265929e-01   +3.026819607915384e-01   +6.561568175234317e-01   -2.740729308625561e-01   -2.848573398364251e-01   +2.203982949377129e-02; +9.926016381914381e-01   +6.692450330272438e-01   +3.034906904571817e-01   +5.382037622206857e-02   +9.845682568058529e-03   +6.359339059326794e-01   +6.083232611332609e-01   -3.785277283311629e-01; +8.079877402796051e-01   +2.284626094938624e-01   +5.530794632144442e-02   -4.068012463095488e-01   +3.890966885425262e-01   -6.470149335486656e-01   -1.898990569510968e-01   +2.392974311482919e-01; +1.045148175840716e-01   -6.001857063010863e-01   -4.238935145540900e-02   +5.848843350117975e-02   -6.732614136872385e-02   +5.169922098544965e-01   +6.419946355442455e-01   -1.052325770431044e-01; +2.633299351789760e-02   +5.733126667082551e-01   -2.814626094287454e-01   -1.689960840043822e-01   -7.254954642937807e-02   +4.749124755482819e-01   -2.918850494357949e-01   +2.597601151427580e-01; +4.772906939714215e-01   +9.691799408125404e-02   +5.729636701413644e-01   -1.085352127102721e-01   -6.022858224063760e-02   +3.980775062658796e-01   -3.520117400829210e-01   +5.104561283587706e-01; -4.295264111199434e-01   +2.882797601913943e-01   -1.326753979501030e-01   +6.332474348409498e-02   +6.076766861220739e-01   -2.341374574436187e-01   +5.055247257114617e-01   +1.141129907180206e-01; +8.166117135657417e-01   -7.783155719380429e-01   +9.102095031313742e-02   -5.317552130321996e-01   +7.935872789451878e-02   +3.124734975965783e-01   +1.756684946533654e-01   +1.220210171784464e-01; +3.222241711050277e-01   +7.689181012288295e-01   -4.606482095400216e-01   +3.005479409285341e-01   -4.600749543374551e-01   +1.893662274026748e-01   -5.400631774921852e-01   -2.744585936468037e-01];
L1E_L2E_iAMPA_netcon = [+3.471995115183119e-01   +3.813522912110017e-01   -2.186530639387870e-01   +5.786379237905882e-01   -1.152617795880663e-01   +3.210680792601335e-01   -6.142623183408607e-02   +3.490644563104034e-01   -2.177201077569259e-01   -1.201023575274830e-04   -4.400744940339070e-01   +3.824193579292322e-01   +5.473151324794324e-02   -5.948255153485610e-01   -1.574938821880830e-01   -3.311951511045021e-01; +1.211732287485981e-02   +8.024131259313256e-01   -3.191020748246947e-01   +2.452976086509300e-01   +3.197799864475897e-01   -1.857140321096252e-01   +2.861746571973498e-01   -3.872339630509586e-01   +5.577358739705259e-02   +5.307158096914517e-01   +5.872617377772718e-01   +5.162136670511632e-01   +2.532564391879005e-01   +2.994821764485340e-01   +5.679762333206615e-01   -1.482721408451087e-01; +2.349457635329292e-01   +2.126462176217794e-01   +9.725551636788680e-02   -9.448956838669592e-01   -3.170689968087599e-01   +6.458938573452182e-01   -3.626627820699996e-01   +4.537998292583424e-01   +1.000000000000000e+00   +7.257617079918601e-01   -1.500842007158994e-01   +2.904028112198535e-01   +2.682585229168610e-01   -4.585685001544428e-01   -5.854065468678490e-01   -4.786637631063968e-02; -1.954791803572923e-01   -6.811965102101364e-01   -3.409758515000977e-01   -5.389997869464918e-03   +2.145376984858800e-01   -2.940449930180742e-01   +1.584977332741217e-01   +6.986198638019814e-01   +1.228592048124834e-01   -1.813430464343652e-01   +2.504426635959591e-01   -3.763921961705616e-02   -2.211560528171960e-01   +1.036575959042321e-01   -2.021008792198744e-01   -9.868279070332914e-01; -1.784699484810138e-01   +3.746670925184057e-01   -6.679766127646100e-01   +5.596124858271777e-01   -3.022429234490907e-01   +8.017395860598944e-01   +1.020394909508740e-01   +2.019793935252699e-03   -3.155200896967791e-01   -2.984473636852656e-04   +2.689921475405920e-02   -1.074829889958939e-01   -2.524698360225884e-01   -3.199271939487351e-01   -2.918572040313696e-01   -1.051318712479700e-01; +5.993896780486307e-01   -3.709182198007038e-01   -2.812777038359868e-01   +3.653772677989202e-01   -3.320025730186636e-01   -3.065146998459631e-01   -2.774080338687060e-01   +6.854382849882011e-01   +1.011163108574151e-03   -3.219523867163731e-01   -1.197380676047682e-01   +6.850606721228427e-01   +4.843846489143436e-01   -7.187081053591584e-01   +3.153766138258207e-01   +3.088121824460089e-01; +5.767758004335598e-02   +6.290769517845274e-01   +2.156977529748200e-01   +2.935711644510734e-01   -1.627868319550395e-01   +3.268424295607080e-01   +3.515118641207542e-01   +8.859622219511099e-02   +3.294220829638872e-01   +3.176755919604598e-01   -3.491707262892049e-01   +4.423662528980257e-01   +3.176212730596312e-01   +3.574479717900801e-01   -1.727951611241928e-01   -7.928340439398059e-02; -3.659867710797469e-01   +5.224460347543134e-01   -5.478866495366184e-02   -6.530187455302806e-02   +3.903989278835048e-01   -6.808225268191014e-01   +7.327661977040608e-01   +6.166186586081479e-02   +7.072254782754718e-01   +2.650154565800740e-01   +4.155258524746673e-01   -4.505960164030677e-01   +1.639606733517661e-01   -2.974119426236439e-01   +4.066428962967994e-01   +9.250505336690093e-02];
L2I_L2E_iAMPA_netcon = [-6.912255840256548e-01   -2.184998412866625e-01   -3.215294044732920e-01   +5.189337341749152e-02   -1.631057612080767e-01   +5.170832569627982e-02   +1.356944017532689e-01   +4.066081596856189e-01; -6.407437796655595e-02   -1.166825897701012e-01   -2.432057099348783e-01   +4.606217803660108e-01   -2.190562026090654e-02   -3.163772536912934e-02   -3.702106773870470e-01   -3.378964823823209e-01; -1.000000000000000e+00   -9.643281972611586e-02   +2.855108068554961e-01   -1.374333673522784e-01   -2.002398426898473e-01   +1.110736612977101e-01   -3.506939518603835e-01   -4.969542445020396e-01; +2.934740159950913e-01   -1.042555938869914e-01   -2.788581429529227e-01   +2.279542613523460e-01   -1.756886262035459e-02   +4.474054103263925e-01   +3.833110552860144e-02   -2.315775255489646e-01; -5.245153609455968e-01   +2.123238335283562e-01   +1.296294256813239e-01   +1.467457383149724e-01   -3.349251499330400e-01   +3.033577695713295e-01   -2.928677372303607e-02   +2.906948996237707e-01; -3.061629173193941e-01   -1.225309116065867e-02   -1.235738523322195e-02   -1.566504178033132e-01   +9.755991694073374e-02   -4.897894973060268e-01   -2.208430500353480e-01   +1.939843982369213e-01; -2.168232537174675e-02   +3.200494871958669e-01   -8.954294048784987e-02   +5.307997839970314e-01   -5.299997597472811e-02   +2.082786114246374e-01   -5.214942118140269e-01   -4.100753595566641e-01; +2.018039762406709e-01   -4.317632446561035e-01   +7.306108655513424e-01   +4.494090809638107e-01   +3.564953269023829e-01   -1.045772882250916e-01   +1.125237697488886e-02   +9.180194344138748e-02];
L2E_L2I_iGABA_netcon = [+3.545996461544266e-01   -2.274271158172855e-02   -6.106509224044608e-01   -5.560547883154876e-01   +9.910245285185360e-02   +2.793814273366554e-01   -3.185108323292335e-01   -4.494679681406796e-01; +1.564836514143089e-01   +4.609548574615188e-01   +2.137724646808135e-01   +1.607148227561981e-01   +1.682330351240807e-01   -6.192771062389723e-01   -6.793611402355503e-01   +3.740021816151676e-01; -6.071575885965070e-01   +1.555289949291372e-01   +4.006663598489331e-01   +1.220395634820957e-01   +3.016693591098915e-01   +2.217207801921529e-02   +5.944491837834062e-02   +2.223203796153640e-01; -3.060529201326946e-02   +3.892271562917708e-01   -2.811002580152264e-01   -5.875479754324384e-01   +5.780313137345203e-01   -1.000000000000000e+00   +4.150586298674135e-01   +9.273510103736014e-02; -2.760165510066508e-01   -6.467528821243472e-01   -5.646862466426774e-01   -1.206158257189579e-01   -2.310994785470191e-01   -5.655640484694646e-01   +7.699442796740064e-01   +2.042309755605819e-01; +4.410479303434303e-01   -2.217760272031034e-01   +4.645533006006632e-01   +1.226228686731202e-01   +2.704280346309222e-01   +5.201950179653178e-03   +3.364313488443788e-01   -2.250269030607380e-01; -2.203346244768946e-01   -7.518780219402139e-02   -6.827288068368615e-01   +2.789895448690313e-01   -2.504931624094379e-01   -2.955778335578255e-02   +3.942349614129942e-01   -5.748142054106773e-01; -6.138601292603836e-01   +4.230103735290166e-01   +3.567405363921783e-01   +3.177037069319708e-04   -4.072580970345623e-01   -5.981661509498595e-01   -3.947212515000041e-01   +2.198803184754488e-01];
L3E_L2E_iAMPA_netcon = [+6.294760063122677e-01   -5.446708311030506e-01   -3.300991079121392e-02   +2.268006197701984e-02   +3.688884939769040e-01   -5.222155923507361e-02   -1.763269225204878e-01   -4.033952918414718e-01   +4.313496707884723e-01   -5.821337451117644e-01   -3.805057261845966e-01   -1.311294515620045e-01; +9.227154522145990e-02   -1.594977767808496e-01   -5.933048598883575e-01   +2.173513388923101e-01   -2.327054161174381e-01   -2.158502348727557e-01   +2.606650573916120e-01   -6.575734704751872e-02   +3.487255396388268e-01   +2.962776380724791e-02   -8.157037912202038e-01   +1.052709302420452e-01; +3.074431118845978e-01   -4.162188017288317e-01   -9.165321895211185e-01   +4.735116287954400e-01   -4.393013691051932e-01   +3.312136593044202e-01   +1.598727216190742e-01   +2.913496993670844e-01   +4.840545215169833e-01   -3.720036117282908e-01   +1.059239791045400e-01   +5.069398981708891e-01; +3.397098919790788e-01   -1.731096111579198e-01   +4.578703605352515e-01   -7.278843132091419e-01   +3.368636732088886e-01   -1.456420822072584e-01   -5.991458333388002e-01   -7.165066170906530e-01   -2.218706579450760e-01   -5.934215502805850e-01   -2.335654118659834e-01   +2.163898379523651e-01; -4.823218937531954e-01   -2.991113523110647e-01   +1.813934501291392e-01   +4.019321673091275e-02   +6.723947099773180e-01   +2.198904489933567e-01   +3.370689771264475e-01   -4.251516950908685e-01   -3.990865589116444e-01   -2.508894791836245e-01   +3.823473076479783e-01   +4.129027117829046e-02; +2.370191487977713e-01   -3.168357290438210e-01   -4.589387004495685e-01   +2.571577260928557e-01   -1.259787872304459e-02   -1.953719944350550e-01   +2.946387586398677e-01   -4.758037949622011e-01   -2.533690508619830e-02   +4.913055098772695e-01   -3.117432727064717e-01   -7.528548311845076e-02; +2.050345948474111e-01   +4.294751937846765e-01   +3.513712971873370e-01   -3.119314624196251e-01   -2.067585011531043e-01   -6.445510892755388e-01   -2.339476214246750e-01   +6.409004690543395e-01   +1.808309957459317e-01   +6.134516118755014e-02   +2.187637032100585e-02   +2.847433355082079e-03; -6.055269403583592e-01   -4.382076806260091e-01   +6.360675612126179e-04   +6.271904249470568e-02   +2.391921002736388e-01   -1.000000000000000e+00   +2.324307439818032e-01   -1.464077308882082e-01   +1.159156163249626e-01   +5.933029644891037e-01   +1.041669732462770e-01   -5.283850506757052e-01];
L3I_L2I_iGABA_netcon = [+8.903402201123507e-01   -8.209028753760848e-02   +1.555800143793046e-02   -4.468594782648280e-02   +1.801893339163389e-01   -8.816657489095692e-01   +2.859021829909905e-01   -3.632913653473991e-01   -8.229203321481265e-01   +2.434901507637890e-01   -4.621406734034313e-01   +5.383626974513161e-02; -6.182673553439787e-01   +5.570114382770089e-02   +2.677393140855561e-01   +3.631613603496755e-01   -6.226540283166174e-01   -7.106040957308963e-01   +1.918349267623249e-02   -2.495468904732049e-01   +7.911691224761491e-02   -5.296891401009719e-01   -7.944998194644692e-01   -2.295776107852741e-01; +4.471765200367651e-01   +2.869162538767900e-01   +2.515861262908451e-01   -6.443825816947257e-02   +9.022989201046731e-02   +2.135026435139271e-01   -5.988112626011924e-01   +4.919460408205629e-01   +1.947288928609062e-01   -1.080944101925749e-01   +5.167928570558804e-02   +6.518220343670876e-01; -8.654065147825301e-01   +7.796881115044111e-01   +3.336376855022139e-01   -2.705106500354168e-01   +6.743699540618909e-01   -3.388664903461129e-01   +4.004883838990368e-01   -8.222643070501743e-01   +1.789483727340496e-01   -1.000000000000000e+00   +1.090440818280255e-01   +5.814295543411555e-02; -1.928796895048901e-01   +3.801864926570228e-01   -1.500808456127898e-01   -2.544443392371311e-01   +8.203467921602110e-01   -5.422753606373123e-01   +3.283486103834737e-01   +1.797112808472066e-01   +4.663708815141765e-01   -1.314267012559683e-01   +7.140335931285888e-01   -2.361246745735602e-01; -2.347186016939215e-02   -8.106192060083544e-01   -1.685356610207422e-01   -5.687984194680328e-01   -6.649459287266887e-01   +2.075927001122270e-01   -2.282458443725587e-01   +4.634205236934443e-01   +7.257190531885164e-01   -9.180638768041803e-02   -1.965694370557063e-01   +9.013680461948346e-01; +3.622512705344052e-01   +1.984594775693042e-03   -5.166112851149279e-01   +5.426378001093917e-01   -3.996391979957993e-01   -1.836417945454067e-01   +4.229799325781275e-03   +2.995645732041423e-01   +2.598726117172944e-01   -5.001943787782193e-01   -4.547191151798463e-01   -2.542142713734679e-01; -1.704700942235046e-01   +1.392732457746873e-01   -9.506124346794370e-01   +3.701136557295315e-01   +2.752680572749576e-02   -3.048545976131537e-01   +4.138355236605271e-01   +9.587199601431515e-01   -9.207126632804842e-01   -7.860579826097863e-03   +9.688564325132623e-02   -4.281155061715366e-01];
L2E_L3E_iAMPA_netcon = [+2.966930398019541e-01   +4.105844839074509e-01   -3.653794635648104e-01   +9.036636908470104e-01   -3.268889674346042e-01   +4.754666974804826e-01   -5.665741839076986e-01   +5.195912930640558e-01; +2.004299134441450e-01   -1.661740876844329e-01   +9.741158486661536e-02   -9.457591318556998e-01   -3.282823946602723e-01   -5.087104095232741e-01   +7.567064558088367e-02   -1.023603293486346e-01; +6.441524663719750e-02   +3.745292158118249e-01   -1.362410911147846e-01   +3.370347779931404e-01   -9.375601085161495e-02   -3.761847101261914e-01   -3.097995521147887e-01   -5.397718369440740e-01; +3.835537960994515e-02   -1.166949939810498e-01   +1.000000000000000e+00   -4.613422245055259e-01   +4.145736923942993e-01   +4.210735036879314e-01   +5.860525546184303e-01   -2.927067597666841e-01; -1.933463594190494e-01   +3.817270806010278e-01   +1.400611326656122e-01   +1.467250841433452e-01   +4.118904030382124e-01   +1.337172450205321e-01   -1.408353478937731e-03   +5.121624368392143e-01; -6.047995296703901e-01   +3.435095441161840e-01   +2.890885784120785e-01   -4.378774661583138e-02   -3.270789797643353e-01   +4.988845513621050e-01   -5.419604632133368e-01   -1.123959113949767e-01; +8.905785546143544e-02   -7.490206641190697e-02   -1.712438829574474e-01   -1.666227795417592e-01   -6.850463799380790e-01   -3.674755418894071e-01   -7.643953009520706e-01   -1.394604799617502e-01; +7.040708389834556e-01   +5.290379592538491e-01   -4.861020634744653e-01   +8.495313324140568e-01   -6.875880970176954e-01   +7.626021742021651e-02   -4.789240185209778e-02   +3.790502962283627e-01; -5.796568015727610e-01   -2.018282550107932e-01   +6.362265625338722e-01   +2.245784811293490e-01   -6.646237012650427e-02   +1.793940838843782e-01   +3.014979630727201e-01   -6.895266118873846e-01; -7.559190131177483e-01   +3.690369915189786e-01   -4.716114005198602e-01   -2.122790345843269e-01   -2.035785923519601e-01   +1.188489354944706e-01   -3.338055623550651e-01   -5.474709310255173e-02; -6.833159961139535e-01   -3.913129071677117e-01   -7.292422895822562e-01   +1.533446585452302e-01   +7.210644227585014e-01   -4.201828029523108e-01   -1.845471649637588e-01   -3.993766166467403e-01; +1.879325939327652e-01   +5.667478118064935e-01   -3.965030176295962e-02   +3.139435812640070e-01   -1.449647664100510e-01   +2.420126400727274e-01   -1.722063494604970e-01   +4.470562894111953e-01];
L2I_L3I_iGABA_netcon = [-2.067154053867936e-01   +4.463530195802353e-01   +7.035054225042257e-02   -2.054394622225701e-01   +2.497208556199662e-01   +7.814887330350656e-01   +2.158157748668495e-01   -2.224365216309641e-01; +5.929807929714275e-02   +7.763730614333954e-01   +6.908488811785324e-02   -2.920806485389459e-01   +3.469328813946105e-01   -3.000862114690186e-01   -3.876647888317123e-01   +5.366318582748250e-01; -6.311661170693563e-01   -5.226972390299719e-01   +4.086357138313525e-02   +5.321900285644527e-01   +4.801045868103129e-01   +6.222249584485431e-01   -3.990497945748183e-01   +3.620200500768032e-02; -1.184251466496561e-01   +2.105908346749929e-01   +1.546455406757962e-01   +4.826884658144381e-01   +1.586612069543530e-01   +2.530199354531293e-01   +4.456503927032677e-01   +8.992174682080512e-02; -4.913885528058139e-01   -9.690813076225635e-02   -5.326551581581132e-01   -3.995567157997441e-01   +5.333865390347712e-01   -2.230649108767722e-01   -2.075745712962060e-01   -5.748976523035356e-01; -2.490331902712317e-01   +9.297639664716061e-02   -1.000000000000000e+00   +7.947565913426567e-02   +3.463175183661073e-01   +5.622848714893698e-01   -1.539462829531748e-01   +3.392258263373878e-01; -2.050406626114272e-01   -2.176639939713806e-01   +2.070374300865800e-01   -4.801279262076335e-02   +6.863211264331651e-01   +2.148808300568534e-01   +4.582821948485304e-01   +6.726235115590130e-01; +4.686296123615268e-02   -3.997541641948050e-01   -6.110160607614278e-01   +4.967221716814160e-01   -2.016562461299780e-01   -3.510327237291099e-01   +4.611441616347584e-01   +4.628138229607033e-01; -7.251671381171531e-01   +2.068431948105193e-01   +7.322378925793374e-02   +4.826841797744800e-01   +2.514368194504433e-01   -5.562462135434025e-01   +5.431319034398499e-01   +9.934543873701188e-02; -2.703209378552346e-02   -2.462755001139384e-01   +4.629658097980076e-01   +2.699619373898609e-01   +2.245346341653551e-01   -7.015310750108862e-01   -8.398502781040488e-01   -2.426699060249043e-01; -3.600341576506049e-01   +1.675716950415113e-01   +1.887822981808961e-01   -3.392362756041281e-01   +2.658393292778305e-01   -1.151522069936975e-01   +2.720113635732637e-02   +1.020945063112572e-01; -6.512405379963891e-01   -1.251067621117561e-01   +2.397180626978521e-01   -1.162021711995305e-01   -7.219519235726708e-01   +4.951497757920387e-01   -7.347652253494292e-01   -1.126508818557895e-01];
L3I_L3E_iAMPA_netcon = [-2.867269298639705e-01   +4.306439549997922e-01   -5.900739224757794e-01   -2.789279660205704e-01   +3.463570481505676e-01   +2.999939757694245e-01   -7.388117722831592e-01   -1.689292006110374e-01   -3.821940088637152e-01   -4.941447841345504e-01   -2.882837047044456e-02   +1.145080337422626e-01; +7.160345121414173e-01   +6.520989353382999e-01   +1.298366666403244e-01   +3.195025206177625e-01   +4.959588731617394e-01   +2.025517807829436e-01   +2.782982359681764e-01   +1.823646808502665e-01   -2.309651644950020e-01   -2.117538942514816e-01   +1.649195980701879e-01   +2.330403849732995e-01; +4.359178391194660e-02   -3.862221343815427e-01   -3.335858269127240e-01   +6.892894255171342e-02   +1.988920551437763e-01   +2.286699180190125e-01   +6.682743282725911e-02   -8.285171255732970e-02   +3.101522261035543e-01   +1.341541591054088e-02   +8.574092880782203e-02   -5.216282255462538e-02; +9.941122658277342e-02   +6.520744890086599e-01   +6.569584912019009e-01   -7.772607952095745e-01   -1.020070379860600e-01   +3.873203190234077e-01   -5.105861928478157e-01   +1.000000000000000e+00   +2.643354062189990e-01   +7.892205875884832e-02   +3.284147373846543e-01   -4.963505385221660e-01; +3.914905416416559e-02   -7.989429542771032e-01   +4.257352395704539e-01   +9.764015865360803e-01   +2.571562426577862e-01   +2.954745607614359e-01   +3.585564862085300e-02   -6.977497056702084e-01   -9.101800473428809e-02   -9.949262571905237e-01   -2.131809470552142e-01   +6.641303507866149e-01; -1.099553951899419e-01   -1.578874634587615e-01   +4.723528091146728e-01   +3.145420616633905e-02   +5.426623651098479e-02   -7.371110301156444e-01   -6.713454568954778e-01   +1.700868352341884e-01   +4.221800099668281e-02   +3.799769178378168e-03   +2.654133033180039e-01   -1.807047783182502e-01; +5.590612680180067e-01   -6.674845992153847e-02   +6.743360446177353e-01   +7.189892144314720e-02   -1.225956121794577e-01   +5.985639519234660e-02   +5.498034471636173e-02   +6.528855795252573e-01   +5.748134841445186e-01   +6.690866283497836e-01   +1.945435132684274e-02   -5.181166698471174e-01; -4.017880145694160e-02   +2.159190531154346e-01   -4.005223128538464e-02   -1.279227330594270e-01   -1.011988569518446e-01   +6.122877186308144e-01   -5.427661846697622e-01   -6.579665209489913e-01   -7.363651579124274e-01   -2.102942515485546e-01   +3.621264167124398e-03   -5.100165916212083e-02; +3.173962622371530e-01   +1.438214799705534e-01   +4.128535367360492e-02   +1.666175535551537e-01   +9.931304416882375e-02   +3.758032153460872e-01   +3.571616214042846e-01   -3.505681222409654e-01   -1.480304869254677e-01   +1.137600308951176e-01   -5.518232070295268e-01   -1.248414132169981e-01; +3.051905462458792e-01   +1.115080558475969e-01   +9.270339372196681e-02   -4.874049403679949e-01   -1.226108819195494e-01   +1.698105940472433e-01   +9.423345644044806e-02   +5.139401104159377e-01   -1.755382334499972e-01   +6.689928681722763e-01   -2.501635890777185e-01   +1.604450698341772e-01; -5.145166384155674e-01   -1.722760578098294e-01   -2.438111220604975e-01   -3.793554779451873e-01   +3.156283092529963e-01   +3.748136646642417e-01   -1.020511997080117e-02   +8.989580976684651e-01   +1.831409329378580e-01   -1.439493448496510e-01   -5.426064819326941e-01   -6.660526254233049e-01; -1.955423663994037e-02   +1.056772951912719e-01   -1.452355021934625e-01   -5.599320967660220e-01   +1.017632747876642e-01   -2.216380201444769e-01   -8.938101055677009e-01   +1.843557080918414e-01   -1.919381999117303e-01   -1.778527397137210e-01   +5.964133187193744e-01   -1.398670494031642e-01];
L3E_L3I_iGABA_netcon = [-2.520065559547356e-01   -3.828770728708168e-02   +2.381072031465387e-01   -4.332663742644877e-01   -2.622078095718045e-01   -2.636889126457654e-02   -5.458634573414322e-01   -3.028512585678478e-01   -2.517477597478610e-01   +6.012898619870226e-01   +5.155387419512905e-02   +8.525501897461303e-01; -1.607403151079716e-02   -8.957289344546822e-02   +4.380333560929012e-02   +1.943740797954944e-01   +1.342942741793159e-01   +1.585994006831721e-01   +5.611884243826171e-01   +2.583949337599649e-01   +1.992443229418629e-01   +3.055133802764984e-01   +2.762615783766708e-01   -5.427399766113379e-01; -8.676243665478476e-01   +2.612153954859999e-01   +5.939232562264745e-01   +3.885826762035486e-02   +2.002452664788264e-01   +6.923193743616195e-02   -1.182425205705363e-01   +5.957673941717803e-01   -1.895917229709894e-01   +3.030839060442997e-02   -7.403167254040903e-01   +2.692448145571643e-01; -4.618881053726515e-01   -5.484882875020958e-01   +3.387097610242988e-01   -8.837675660727447e-02   -6.476348515093944e-01   +5.489637676328161e-01   +6.326842264130618e-02   +1.713518416084986e-01   -7.237329247921419e-02   +3.221191410527724e-01   +3.548030328271291e-01   -2.801386912463932e-01; -7.671739682346729e-01   +2.423944431624922e-02   +1.135818764106818e-01   -3.558205078297034e-02   +6.817722192542311e-01   +2.606122877959093e-01   +4.899239033944049e-01   +7.043143798834205e-02   +1.000000000000000e+00   +5.250258139824470e-01   +4.983475896009103e-02   -7.272151999586125e-01; -3.105010401826787e-02   +1.762366526436647e-01   +1.346365453814410e-01   -9.912160224674605e-03   -3.283882481277250e-01   -2.335572266180077e-01   -7.111946378243286e-01   +5.989824417840597e-01   -5.697292949894075e-01   -1.396293255630120e-01   -2.175430430793297e-01   -4.513628314210911e-02; +2.805373620511878e-01   -2.307708832548327e-01   +1.725002583259624e-01   +5.171732540939211e-01   -1.220841502222318e-01   +4.068187973520008e-01   -5.071815528897203e-01   +6.927453798119405e-01   +7.409738137928426e-01   -5.612977770871425e-01   -5.539629708172724e-01   +3.313861726555215e-01; -3.917161118097018e-01   -1.901756026970456e-01   +2.481969823823950e-01   -1.828834211145265e-01   +1.852769032051117e-01   -2.248300343202039e-01   -2.624563908090968e-01   +4.593171242917602e-01   -4.916314390060668e-01   -9.471549800681939e-01   +1.950412652427682e-01   -2.920412700211327e-01; -3.431949128064014e-01   +4.854299792803689e-01   +7.140450215507047e-01   +2.492144403215442e-01   +8.181151852324158e-01   +1.227906999674052e-01   -2.258503681256302e-01   -1.442670514036961e-01   +1.954242263026358e-02   +1.376964071610542e-01   +7.123960749281504e-01   -5.909366739678794e-01; -3.624788651905385e-01   +4.278050091592051e-01   +4.085188440651643e-01   -8.502251006814562e-01   +1.603524270739761e-01   +1.962834255837572e-01   +1.040063036041710e-03   -2.862444808649002e-01   +8.640014227584143e-02   -4.717251249073465e-01   -3.924228452436404e-01   +5.181397157403128e-01; -4.540787025053816e-02   -3.585754502967554e-01   -1.316393991053005e-01   -6.921584141056093e-02   -1.390134004275165e-01   +2.652487976546207e-01   -1.751597762892762e-01   +4.348355949762865e-03   +5.972985919075217e-01   +9.464468987166440e-01   +7.400930796729280e-01   +6.882228915689940e-01; -3.515089470217716e-01   +6.733769146140157e-01   +2.822393812101203e-01   +5.812100571971639e-01   -4.673498181470309e-01   +2.988978323249574e-02   -2.365735333305678e-01   +4.020257887893046e-01   +2.584028887488438e-01   -2.956468585262977e-01   +6.048675201047761e-01   +3.540378095049364e-01];
L2E_Input1_iAMPA_netcon = [+2.801322306435939e-01   +4.153113439551270e-01   +4.117186200721938e-01   -2.802860049345945e-01   -4.336868893230358e-01   +2.181764456609300e-01   -7.518309690859493e-01   +4.470878317359013e-01];
L2I_Input2_iAMPA_netcon = [-1.696155294891186e-01   +3.012668730975984e-02   +3.719330569581912e-01   +2.104236341565020e-01   +8.380084675884432e-01   +4.522306206491167e-01   -1.259130721494370e-01   -1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
