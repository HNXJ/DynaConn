function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.048164927014919e-04   +8.872603879148028e-03   +7.782087964089763e-03   +1.547834987053297e-02   +3.799128280731074e-03   +1.276619877246017e-02   +5.483224929002292e-03   -1.065838132479957e-03   +2.766457513409990e-03   +8.386999059338481e-03   +8.393579044835273e-03   +2.479679878783515e-03   +7.429846728271334e-03   +1.200092030763082e-02   +8.445938691726947e-03   -7.233418517531804e-03; +5.820536136412579e-03   -1.924674296712526e-03   +8.058920059401046e-03   +1.335610564804129e-02   -8.475971446047740e-04   -4.538536054846573e-04   +1.047839507416354e-02   +9.965944794520912e-03   +8.779030554717350e-03   +9.783086221396779e-03   +1.015663939254128e-02   +7.070226868790882e-03   -3.512980558911394e-03   -4.087775026409298e-03   +6.841177981142275e-03   +1.826895316858576e-03; +3.182345892126014e-03   +1.071455564511818e-02   +1.251065129785611e-02   +9.124020304790528e-03   -5.165311609052590e-03   +9.763291022525765e-03   +1.064810076381542e-02   +4.817319990993770e-03   +5.995954269452841e-03   +2.912537583979809e-03   +8.952039673968973e-03   +1.432175506482767e-03   +4.050481172009185e-03   +6.804997944320600e-03   +1.204344877886167e-02   +8.856644915496207e-03; +8.010002262524116e-04   -1.709156775033534e-03   +3.373544812854888e-03   +4.760435464520952e-03   +5.303279145154761e-04   +8.140007639414101e-03   +1.100988919351150e-02   +7.566215274290805e-03   +1.036183902528159e-02   +9.009729314936391e-04   +1.325275427521455e-02   +9.759371700564309e-03   +6.650238926526832e-03   +1.534343664840848e-02   +6.147095858953196e-03   +4.437610526457690e-03; +5.150900655732646e-03   +7.823202520359354e-03   +3.510549515244662e-03   +8.721333313338528e-03   +8.570365710559079e-03   +1.273704703033973e-02   +4.022248998050797e-03   +6.431095849238823e-03   +4.709800892025004e-03   +1.733322793623830e-02   +2.009146393279948e-03   +8.588277258226798e-03   +3.232828936977616e-03   +1.064746393277323e-02   +1.353955530917117e-02   -2.859505981946005e-03; +7.112103012052988e-03   +3.459720190600135e-03   +1.145338838427135e-02   +1.692895386461443e-03   +4.988931719055365e-03   +8.251876610794946e-03   +7.435887208279729e-03   -1.278742755413870e-03   +2.821647386478321e-03   +5.404706504473872e-03   +7.607028825991845e-03   +4.993055279928236e-03   +3.028329154378949e-03   +4.372543025211043e-03   +4.996910225731506e-03   +1.292394950182175e-02; +3.916883904226066e-03   +7.265109774542604e-03   +1.395309140428072e-02   +8.091003029932150e-03   +1.137789298638615e-02   +5.271692859001796e-03   +5.113863403549605e-03   +1.401156384634172e-02   +1.627998709086665e-02   +5.711541772249040e-03   +3.499617543932194e-03   +6.244957086321346e-03   +6.261359951339042e-04   +1.085224211659928e-02   -6.259826809824578e-04   -3.122437121046334e-03; +1.081699312534666e-02   -8.599052556933239e-04   +1.444555806091696e-02   +1.035107325789028e-02   +1.059369594181686e-02   -1.847790102577621e-03   -2.892176932833837e-03   +1.168945437148958e-03   +1.303307422191711e-02   +1.031425090834658e-02   +4.126111516621227e-03   +1.028994266302518e-02   +1.819028645844608e-03   +1.633428357369619e-03   +1.037491265074860e-02   +1.149216569276378e-02; -3.963669221501502e-03   +8.216518990886299e-03   +7.666431082348305e-03   +1.206244452810463e-02   -6.885507663879241e-04   +1.259829510167223e-02   +5.204497381647275e-03   +6.157395812841662e-03   +4.638907573762841e-03   +1.082513052942434e-02   +2.625527129537626e-03   +1.205916414553513e-02   +5.330042329145850e-03   +1.176318438805644e-02   -3.017285327802830e-03   +3.486035451759131e-03; +2.468941670808565e-03   +5.355186546423566e-03   +1.715721104182265e-02   +5.995539419768359e-03   +6.952373436564923e-03   +2.197402211644371e-03   +3.223556694886577e-03   -2.269184499942628e-03   +4.238281017555033e-03   -9.370659495477947e-04   +7.708573723624072e-03   +4.242015243760600e-03   +1.041315478373247e-02   +8.714494323777824e-03   +1.644676205390434e-02   +5.238228316218431e-03; +8.315434108454854e-03   +3.965676513041746e-03   +9.619566920948305e-03   +1.317142027490695e-02   +7.170773089351429e-03   +4.791702902040883e-03   +7.116537360929490e-03   +8.926065944406942e-03   +2.150464624148511e-03   +2.891314802487089e-03   +1.102864143452098e-02   +1.070492282378988e-02   +4.815213126061300e-03   +4.885073254379138e-03   +1.279522649065304e-02   +7.101731890591250e-03; +7.607294800148189e-03   -1.313122454051726e-03   +1.643707566023702e-03   +6.341157581375810e-03   +9.441367536516296e-03   +1.530716088841957e-02   +2.573182173514751e-03   +6.436478003556559e-03   +1.125555725585300e-02   +6.530795820248957e-04   -2.636880731444281e-03   -1.328668854434114e-03   +1.152955083722704e-02   +2.297911185276518e-03   +2.791258345834407e-03   +7.195291860299464e-03; +2.404159374185833e-03   +1.009064915349885e-02   +1.158482377878188e-02   +1.449886834153458e-03   +1.593132855453313e-02   +3.117250924978982e-03   +1.076262251530772e-02   +1.526819034086394e-02   +8.084586873539398e-03   +1.924172973617588e-03   -4.581552987748848e-04   +1.085589636777508e-02   +1.107261928134277e-02   +9.505638854284088e-03   +1.115017505295297e-02   +9.435050929132638e-03; +8.057539925570487e-03   +1.082914005012407e-02   +6.595458932007654e-03   +8.885170381933899e-03   -5.827111480224739e-04   +6.335910926356705e-03   -2.128666350483032e-03   +6.595406580476276e-03   -1.913947972111375e-03   +8.553984290859100e-03   +2.519766941666087e-03   +1.513320245667329e-02   +8.795464081889137e-03   +7.119409235179625e-03   -2.691570963674545e-03   +2.957342339873474e-03; -3.698951706151044e-03   +1.292801510727445e-02   +9.649190137995771e-03   +5.453151601447266e-03   +6.681873303049315e-03   +2.014874248850715e-03   +1.228934141574310e-03   +5.892270171848158e-03   +1.963670562261180e-03   +1.612307533836110e-02   +8.601467639932733e-03   +1.748913085615645e-03   -5.500030627005087e-04   +1.707994339610455e-02   -1.294884712697818e-03   +6.932815508758085e-03; +9.534811161249471e-03   +7.087048335260692e-03   -4.753783919045011e-03   +1.623293744565832e-02   +1.350555115125743e-03   +5.596559311836136e-04   +5.369625674485597e-03   +3.939675325051806e-04   -1.456201375985248e-03   +1.411094860676514e-02   +1.047485717982100e-02   -1.026821683253714e-03   +1.396848355191603e-02   +1.076600248829049e-02   +1.132495768070167e-02   +1.216982684911422e-02];
L1E_L1I_iGABA_netcon = [+9.312916332777605e-03   +8.834018933707952e-03   +1.638871836267678e-03   +9.895934971673010e-03   +1.145423425306918e-02   +7.975422685018180e-03   +5.620699674018524e-03   -2.562440658733529e-03   -2.029691361028784e-03   -1.317258188327450e-03   +3.695945269986305e-03   +3.471264197585220e-03   +3.934457552973743e-03   +1.673224141109300e-02   -5.216182160649162e-03   +2.905744681805243e-03; +5.111383031858071e-03   +6.561207048795660e-03   +9.531665207781237e-03   +1.184136617566808e-02   +4.389364814939175e-03   +3.134893049292071e-03   -1.563865113849411e-03   +1.262721489585436e-02   +1.088727156583778e-02   -6.487749005033116e-03   -1.645740071378183e-03   +8.573700097922051e-03   +2.576040126470022e-03   +8.619482530565051e-03   +4.552402630812824e-03   +7.912527282029761e-03; +6.184731690603500e-03   +1.365846075244210e-02   +8.933206077492380e-03   +5.810803680372766e-03   +1.840549134446496e-03   +6.574706372885399e-03   +8.301404038831391e-03   +7.820323140959045e-03   +1.104387557334492e-02   +1.404837994683418e-02   +7.037586524860718e-03   +6.219945718999498e-03   +1.004349584838368e-02   +7.528465808811087e-03   +2.223466441887919e-03   +8.105051875327975e-03; -1.112367227013007e-03   +6.496773829694821e-03   +1.349984893006885e-02   +6.530573710194658e-03   -5.017763892089166e-03   +1.167047160934443e-02   +8.340700922022930e-03   +1.301823684554140e-02   +6.035943908753643e-03   +9.612510860858644e-03   +1.082152089728605e-02   +2.678176941314496e-03   +3.508502844532803e-03   +3.646201090845022e-03   +7.383336939521024e-03   +1.046351414351723e-02; +2.705794874862013e-03   +1.530387996652568e-02   +7.285583688112792e-03   -1.592745523142721e-04   +5.220011179215175e-03   +1.361159627373898e-02   +8.142416095675993e-03   +8.243206096181718e-03   -8.214182004736732e-04   +6.172292093426842e-03   +6.259348691438847e-03   +8.332432760681675e-03   +3.125538910814097e-03   +9.175828175759532e-04   +5.493660965513429e-03   +6.141492658308895e-03; +1.109187158329528e-02   +9.143743937187431e-03   -1.066978982171562e-03   +1.397981786310009e-02   +1.612712354126240e-03   -6.423646965848415e-04   +1.321318764744573e-02   +4.659546061711589e-03   +1.392304314372563e-02   +4.551686027965665e-03   +1.050601804410945e-02   +2.847363055176756e-03   +4.414313396190237e-03   -2.248239009906388e-03   +6.215323285146417e-03   -4.393249800356316e-03; +8.084803976726300e-03   +2.711317026876612e-03   -1.682359035939175e-03   +4.234247066947606e-03   +2.725588349691807e-03   +1.030100831900622e-02   +8.709110756774991e-03   +3.109302079989210e-03   +1.151020330292812e-02   +5.030389168601641e-04   +1.574119336986680e-02   +1.493902352543514e-02   +1.408718958294249e-02   +9.178961328763528e-03   +4.830944760226193e-03   +5.476632889165281e-03; +5.886569910058654e-03   +4.274331291103104e-03   +6.920710571174865e-04   +3.329673993988578e-03   +6.933390317694368e-03   +8.149803916699259e-03   +1.325962003154504e-02   +6.544696624229351e-03   +1.355747419528733e-03   +6.138941767305010e-03   +4.762474983616067e-03   +1.549743418501208e-02   +4.276769997884033e-03   +7.137470714630180e-03   +4.467814178660797e-03   +5.184286482694119e-03; +6.306448552085993e-03   +3.757446383587258e-03   +3.076468016917021e-03   -2.833648307372449e-03   +3.441279223410445e-03   +1.264253049725590e-02   +1.356191374601713e-02   +1.348512794814210e-02   +5.778904513765485e-03   +3.323676581170232e-03   +1.114464852958707e-02   +4.050171158466031e-03   +1.522498991103831e-02   +1.608002279672914e-02   +6.209010124895926e-03   +6.933268838377782e-03; -1.665466109787394e-03   +1.423589597436849e-03   -2.332075027354955e-03   +1.060936670170660e-02   +6.322477674150573e-03   +1.383023819668073e-02   +2.030795553353910e-03   +3.956513644389830e-03   +1.591004040707539e-02   +1.406522539254815e-02   -2.051366752378885e-03   +1.427016420782545e-02   +1.504212768804573e-02   +1.014953992537513e-02   +1.127063518713544e-02   +2.457996876929665e-03; +1.332946943574513e-02   +1.708157848260458e-03   +5.508210662251937e-03   +3.467851123033712e-03   +1.370271971802557e-02   +5.766066458762101e-03   +6.868783596387428e-03   +1.291992680983916e-02   +7.524120311994885e-03   +3.542159990439281e-03   +6.663440689875523e-03   +9.976818211641796e-03   +7.472617951949654e-03   +1.767301146124640e-02   +1.252067953145202e-02   +4.144433528224660e-03; +7.509690250750586e-03   +1.316702453540226e-02   +8.335220704461634e-03   +8.436677559761874e-03   +1.315342889536458e-02   +4.311621035372912e-03   +6.472405627162502e-03   -9.582469506724562e-04   +8.363317305314033e-03   +3.458687399613385e-03   -1.638354581294652e-04   +1.164104874258247e-02   +5.418438859688108e-03   +9.772992701736746e-03   +7.748651660611314e-03   +1.390687523529863e-03; +1.440700124274920e-02   +2.906249530347031e-03   +1.184325954139607e-02   -3.165019296576325e-03   +5.533363629054972e-03   +8.233926299351314e-03   +9.180941570463674e-03   +2.000905219637341e-03   +1.282571203460187e-02   +7.335908952959462e-03   +6.394833611360092e-03   +8.904047483512471e-03   +1.319505038448983e-02   +6.781062554480098e-03   +3.171938532899478e-03   +3.683648920490179e-03; +4.732926489214875e-03   +4.375310889451315e-03   -1.349081074126423e-03   -4.506576032291619e-03   +1.459364317161595e-03   +1.241512561314309e-02   +1.787343657257566e-02   +8.079759441793306e-03   -1.226337483967294e-03   +7.703760623578027e-03   +9.319647763519116e-03   +1.063718134588091e-02   +6.585570623956215e-03   +1.609709037672414e-02   +9.186418825771399e-03   +7.671345045996376e-03; +8.604594545970415e-03   +1.405519344594169e-03   +8.579707677430749e-03   +1.389594870791137e-02   +3.334448922349738e-03   +1.590627200225930e-03   +4.159177132978845e-03   +7.769842735520084e-04   +5.781009903974847e-03   +9.112001102120845e-03   +2.323236975482285e-03   +7.013743758539708e-03   -3.570243349392003e-04   -1.770746752651301e-03   +8.312474066839985e-04   +5.377929248427539e-03; +6.157223961042150e-03   +6.885182288183879e-03   +3.101457499831612e-03   +8.547366853097463e-03   +1.416643883657457e-02   +5.693467365953631e-03   +3.844465806466360e-03   +1.304647033131272e-02   +9.783973615521892e-03   -2.567121351958016e-03   -4.358405846393742e-04   +8.339976277630582e-03   +1.118418242834818e-02   +6.387066519811087e-03   +6.340472730428794e-03   +1.085418223374553e-02];
L2I_L1I_iGABA_netcon = [+1.263312627120993e-02   +1.750986959681623e-03   +9.938989608404534e-04   +1.404564975376353e-02   +1.371500788005428e-02   +1.097010410327772e-02   +2.631901144264899e-03   +1.379611731652211e-02; +1.139773705043082e-02   +6.689316442123431e-03   +6.386635109128841e-03   +4.461549019290550e-03   +4.862010609881603e-03   +8.949932022346231e-03   +1.005605359355487e-02   -4.165153659928862e-03; +8.127551003806988e-04   +5.119384671243858e-03   +1.188127288698028e-03   +9.444642143420463e-03   +1.574949383287737e-02   +1.347561859070109e-02   +8.202433460620362e-03   +1.275880555687755e-02; +4.434794493268491e-03   +7.505197766093132e-03   +1.119426248820297e-02   +9.622626071906858e-03   +1.011184199273273e-02   +6.385260257711652e-03   +3.547994928453799e-03   +1.328945505088258e-02; +9.788352808257843e-03   +1.078909701103202e-03   +8.475195220674459e-03   +8.156919068314245e-03   +6.415452720076390e-03   +1.373834550387284e-02   +7.495100833935564e-03   +7.043649424530282e-03; +1.212335218105688e-02   +3.406182765496208e-03   +5.361195750637896e-03   +1.069990741484300e-02   +1.011976701738932e-02   +9.283393748426752e-03   -2.629748673975143e-03   +3.937258813528934e-03; -2.885961594540693e-03   +3.744745351085779e-03   +5.421681662049553e-03   +9.428622888302460e-03   +9.112276634655352e-03   -3.014008257395491e-03   +8.240961823149739e-03   +1.356298948639284e-02; +5.962104288250039e-03   +2.840313163579040e-03   +8.819790892708962e-03   +7.188952377262792e-03   +2.286160854191393e-03   +1.395844308112781e-02   +1.110526425654076e-02   -8.312783109680976e-05; +3.685543762282303e-03   +6.731002841536235e-03   +4.001361932340930e-03   +7.860912638070754e-03   +5.036358589408889e-03   +3.593123703004888e-03   +2.542260195976386e-03   +8.939174054775012e-03; +1.376638292515860e-03   +4.790362294694477e-03   -1.917335601257591e-03   +4.073376914859840e-03   +6.297972077345653e-04   +8.305198831885846e-04   +1.435167829933860e-02   +2.315998657030325e-03; +5.188021730935302e-03   +1.587583393132340e-02   +1.409114489873504e-02   +3.344300500199191e-03   +1.405237795082049e-02   +9.506730897120445e-03   +4.553426637962711e-03   +8.961288319406806e-03; +7.667965080479433e-03   +4.569475218682642e-03   +5.687639401121457e-03   +2.383596961400570e-03   +1.634786270981696e-02   +4.982682989328351e-03   +1.016374685006921e-02   +3.529139933718704e-03; -1.983849174590717e-03   +1.141306021139138e-02   +7.093719373147762e-03   +1.183782128757381e-03   +6.994358058597419e-03   +1.520811649548226e-03   +1.240263607836311e-02   +1.023890215095187e-02; +9.639849083888175e-03   -8.006024397061684e-04   +1.238285052965223e-02   +3.679871883025985e-03   +8.786800864795821e-03   -1.239573376316662e-04   +1.290184738312521e-02   +1.655551798027018e-03; +1.016628149477715e-02   +5.959399236689866e-03   -1.139751801442906e-03   +1.604791694508887e-02   +1.234462283920817e-02   +1.053892219126738e-03   +7.417888579568931e-03   +8.446770251316415e-03; +8.686641887642743e-04   +8.018094062459380e-03   +9.694921074642820e-03   +6.970030142469449e-03   +1.032116272689344e-02   -7.312743569255402e-03   +8.319851907433786e-03   +6.277182283479763e-03];
L1I_L2I_iGABA_netcon = [+1.425441370451987e-02   +1.292340272449905e-02   +1.283261485202570e-03   +2.912338092465634e-03   +3.294138545565501e-03   +1.116779430265213e-02   +1.436355694704940e-02   +1.180071120729317e-02   +1.194483790703057e-02   +1.138003265109560e-02   -6.075564120905775e-03   -5.940124851022842e-04   +4.640172826985653e-03   +3.886782308244231e-03   +2.303101062239208e-03   +1.433190371753847e-02; +1.368560661265384e-02   +9.525687345542756e-03   +2.981828539498626e-03   +8.959533571722755e-03   +9.428469352303664e-03   +9.601460868749074e-03   +1.023615030232829e-02   +1.565905385434842e-02   +6.463410097449304e-03   +1.691905364019358e-02   +1.045511341839754e-02   +3.850242286500401e-03   +9.358269906820141e-04   +6.724566575821464e-03   +6.356308743657490e-05   +1.309568355971009e-02; +7.319107788942111e-03   +7.328432175375665e-03   +1.805578088253292e-03   +1.051749860966532e-02   +6.663261859149012e-04   +9.625420928917766e-03   +5.481725444312776e-03   +9.355207033665883e-03   +2.832329775196916e-03   +1.047578170882591e-02   +1.186404775157197e-02   +2.851591307892647e-03   +7.866056225792882e-03   +9.035194504510157e-04   +9.296319744289008e-03   +1.845260233272737e-03; +3.986976719413654e-03   +3.418838714700817e-03   +8.608214993116401e-03   +1.137740559792516e-02   -3.555455454615301e-03   -2.887653553507891e-03   +4.439583126149366e-03   +6.263984749573651e-03   +4.736651818504229e-03   +4.716445079601915e-03   +5.302031145657103e-03   +2.646423927398565e-03   +2.576580765487288e-03   +1.013152734491428e-04   +1.024445534925222e-02   +6.437506995998269e-03; +1.902154865009104e-03   +1.409035991041252e-02   +1.112871527167437e-02   +6.512460781370084e-03   +7.985496319563759e-03   +1.051039694404682e-02   +1.320482552151067e-02   +1.714903440996295e-02   +6.166803634956065e-03   +2.863815841385990e-03   +6.756759804389458e-03   +3.941429580677966e-03   +8.329875693450575e-03   +1.091845805614205e-02   +5.460922295619544e-03   +5.661004458038082e-03; +6.306095217532100e-03   +9.831276959599127e-03   +2.112557365016008e-03   +1.083903891904921e-02   +8.845844208834063e-03   +9.758741087577152e-03   +1.318816706956499e-02   +1.040680587764460e-02   +1.191552013046648e-02   +6.047315188873703e-03   +1.208772650238496e-02   +1.118957523152861e-02   +3.153913994796168e-03   +1.363851261624677e-02   +1.499912176230352e-02   +1.385030881296196e-02; +1.118165954688637e-02   +2.575285810506601e-03   +9.099767172158517e-03   +1.249853582258198e-02   +9.662887792547040e-03   +1.749714451627639e-02   +1.021540596855724e-02   +2.683963741059414e-03   -4.128735142310510e-03   +9.652418272736805e-03   +3.989419729305446e-03   +1.405424716665762e-03   +1.343309658851417e-02   +4.397970053033782e-03   +1.088735837919313e-02   +8.370880745250863e-03; +1.186959403842380e-02   +1.422462085763816e-03   +5.508330356841584e-03   +8.406333168006604e-03   -1.721974332684712e-04   +9.414344484245852e-03   +8.930606429074041e-03   +1.283108144220148e-02   +4.842271298843995e-03   +8.884512966143203e-03   +3.542940701259313e-03   +5.414661509343667e-03   +1.357763043634932e-03   +9.268222450257921e-04   +1.042713076718852e-02   +7.224798565108104e-03];
L2E_L1E_iAMPA_netcon = [+7.776590325166415e-03   +1.657763522475802e-03   +2.621560226995926e-04   +8.661625106455250e-03   -2.919945743246041e-03   -8.686730023710320e-04   +1.013436775369470e-02   +3.195747260503796e-03; +8.630735623849917e-03   +7.252937271206962e-03   +5.561248747867832e-03   +6.501635751444690e-03   +1.256453891825001e-02   +5.344704804494201e-03   +1.000157437805621e-02   +6.859434331201684e-03; -1.571740271177408e-03   -3.155783377519514e-03   +4.677725005109380e-03   +1.058743261242051e-02   +2.133686859246275e-03   +1.212002754508743e-02   +7.951741653411152e-04   +8.830597549658124e-03; -2.319959871014388e-03   +1.117588254537213e-02   +3.212402763725712e-03   +1.367408645878883e-02   +1.512617610820059e-02   +8.434477147221096e-03   +1.426701037204060e-02   +1.104520155360866e-02; +2.302287243493664e-03   +1.351963173337038e-02   +1.435734849909920e-03   -3.154175738205254e-03   +1.084106190439194e-02   +1.252722882281549e-02   +1.459399819914728e-02   +5.447100003017589e-03; +6.624284738243528e-03   +2.867446128769031e-03   +1.560443099840032e-02   +1.067836326914575e-02   +6.391161861383879e-03   +1.838803984746967e-04   +7.966090889330375e-03   +7.055472980788183e-03; +3.860372842472140e-03   +8.299345021002399e-03   -2.183068048437210e-03   +2.606336118057426e-03   +1.049740622889321e-02   +6.256833383916614e-03   +3.446068905782453e-03   +6.334253728464672e-03; +3.948185908431818e-03   -7.396775864455907e-03   +2.182210931909413e-03   +1.240106427778386e-02   +6.320939806405045e-03   +1.460628552784540e-02   +1.278627279082760e-02   +1.353369597712659e-02; +3.820889089144047e-03   +1.583574561589321e-02   +2.141763134832968e-03   +2.195478895013053e-03   +6.644122583856044e-04   +1.565055572856914e-02   +9.586683625502176e-03   +8.571857319180615e-03; +7.996130637113009e-03   +1.923117143765985e-03   +1.192401517611282e-02   +8.859844227029491e-03   +1.747848557063036e-02   +5.262448976667949e-03   -1.914397864354107e-03   +5.020272145729766e-03; +1.250214489975753e-02   +9.183890071734147e-03   -2.656372684466739e-03   +4.021156167692590e-03   +9.266779944953649e-03   +1.697867143924142e-03   +1.437259307784249e-02   +1.306898455438005e-02; -5.282315591816836e-04   +7.447166108498436e-03   +1.286638924388294e-02   +6.091076638426713e-03   +6.752482916702053e-03   -2.648788492160447e-03   +1.327787889685827e-02   +2.067557411419032e-03; +3.649933620206702e-03   +5.973103985644123e-03   -2.850878087541955e-03   +1.084195250848917e-03   +1.803610671090984e-02   +7.338423631195357e-04   +8.052746318413262e-03   +9.328566731654902e-03; +3.632037326894105e-03   +3.691677570024691e-03   +3.555895274176663e-03   +1.040884456738098e-02   +6.052079628687843e-03   +3.943370648194737e-03   +1.682011338511583e-03   +1.422710582183629e-02; +5.988931616439131e-03   +8.360929479096297e-03   +3.066278501910881e-03   +1.355559547747778e-02   +5.068263603089287e-04   -1.814467821758078e-03   +9.017535396667784e-03   -1.429594859220846e-03; +9.929522781745579e-03   +5.947106172006849e-03   +9.177944105598931e-04   +4.356781996280274e-03   -5.856274632113353e-03   +6.089756117341572e-03   +3.341676243600671e-03   +9.326849482619378e-03];
L1E_L2E_iAMPA_netcon = [+7.891067385757181e-04   -4.196977256610937e-03   +8.103326208566949e-03   +1.489580008340483e-02   +1.241861345358248e-02   +1.521384191497024e-02   +9.484348794598300e-03   +1.364058367897431e-02   +2.740696527524090e-03   +4.735045197532383e-04   +7.613853922221196e-03   +1.252561399993361e-03   +6.234807279724208e-03   +1.152785012668831e-02   +7.547248006686386e-03   +8.972860777025816e-03; +4.914959965494118e-04   +9.045805939497033e-03   +4.565970138358776e-03   +9.792714800236696e-04   +3.623179748365409e-03   +1.260178153954589e-02   -1.197141877123294e-03   +4.026958713027560e-03   +9.742722056683090e-04   +3.275763297123971e-03   +5.764155805555902e-03   +1.080924846055086e-02   +2.108574385847099e-03   +1.386370867133964e-03   +4.228480315478996e-03   +3.591664082389132e-03; +4.609151089449042e-03   +1.132233715052784e-02   +1.489689099975169e-02   +1.553511539828948e-02   +1.551358973664574e-02   +4.855859880278741e-03   +1.110618636416249e-02   -2.091016821405783e-03   +4.738111183488334e-03   +6.206307289748354e-03   +2.631751529171280e-03   -4.865316030350812e-04   +5.873578183110974e-03   +7.080652068662971e-03   +1.131057477721446e-02   -2.226373243024870e-03; +1.063907994413039e-02   -1.966218042056562e-03   +1.725111545989908e-03   -2.924921780071352e-05   +1.060254729865817e-02   +4.557680952794847e-03   +1.181970536477287e-02   +7.853247683089568e-03   +1.139779187514721e-02   +1.097464530844161e-02   +1.632220889557822e-03   +1.090122166614690e-02   +1.358654915157141e-02   -5.015260455018166e-04   +1.618127230235212e-02   +1.243137339352378e-02; +4.625544875681687e-03   +1.229555585691763e-02   +5.546387732270791e-03   +5.528541117669303e-04   +7.745488183717140e-04   +1.000661150483009e-02   +8.470495806529393e-03   +3.559025558175617e-03   +3.602735446493502e-03   +2.895863757508435e-03   +2.742892636733349e-03   +1.252434724018639e-02   +8.643227735152945e-03   +9.139937349033501e-03   +1.917364659025629e-02   -9.142333100246001e-05; +4.715979416300274e-03   +1.020686594730245e-02   -4.272563251994390e-03   +1.328194614719654e-02   +1.672083162117649e-02   +1.321009828850656e-02   +7.081587814219407e-03   +7.398868516061213e-03   +5.319866323062547e-03   +6.509369600518524e-03   +6.224158881806760e-03   +1.535741914721491e-02   +1.504252875633986e-02   +6.769821528347056e-03   -1.970721633458731e-03   +1.279383532307499e-02; +7.212023217404393e-03   +1.124851060526946e-03   +1.407735755443475e-02   +4.077919252534915e-03   +3.155192638625585e-03   +6.636714967593348e-03   +6.911935944414965e-03   +1.373101504484045e-02   +5.925015770378847e-03   +1.535967522556091e-02   +6.260875373232699e-03   -7.428040676591215e-03   +6.953280558102392e-03   +8.798020939428322e-03   -1.852769155624093e-03   +5.214278438449620e-03; +3.937744280454428e-05   +6.529295082380628e-03   +6.268909282048435e-03   +2.263241061110670e-03   +3.915523975012466e-03   +1.516051507893806e-02   +9.478987343378325e-03   +1.222360651009557e-02   +1.370929489388128e-02   +4.235269291780905e-03   -1.015864202513761e-05   +1.455233468837380e-02   +1.393780495752633e-02   +8.115757363885218e-03   +5.514586278963644e-03   -1.650932886041540e-03];
L2I_L2E_iAMPA_netcon = [+7.403665672466840e-03   +8.869899258253187e-03   +1.523539473232623e-02   +8.457036773540453e-03   +1.281116931196211e-02   +5.654794002243847e-03   +6.814434202276377e-03   +6.403173284443991e-03; -3.794738136803826e-04   +1.430389750068734e-03   +8.686093654683282e-03   +1.455127318705707e-02   +7.806242393264901e-03   +7.472727809067136e-03   +5.438470398266631e-03   +9.713784547566110e-03; +1.223707858174601e-02   +1.057912009539633e-02   +1.142217918830640e-02   +9.159398058791846e-03   +5.109329039129826e-03   +7.606227518862467e-03   +8.481275559408055e-03   +7.861337064014845e-03; -1.549505758559671e-04   +2.273196475862689e-03   +1.209317086144699e-02   +8.384488888039745e-03   +1.692243115647247e-02   +7.799149724631747e-04   -3.883310059810370e-03   +1.524126626312729e-02; +5.758581419664959e-03   +6.628177306735531e-03   +2.458911354684039e-03   +3.269939460583942e-04   +8.963172462143280e-03   +8.574993307757864e-03   +1.809659383287734e-03   +7.399694587770901e-03; +9.962036736375348e-03   +3.582676780728843e-03   +7.329099425649459e-03   +9.871515083642320e-03   +5.426928923172424e-03   +6.412622232397289e-03   -4.852287704029523e-03   +1.279946670812385e-02; +1.331865576843400e-02   +5.854506962124688e-03   -5.622834411358114e-03   +1.960727959206156e-03   -4.030046148688649e-03   +5.764519702995618e-03   +8.589645301228502e-04   +5.235094733598175e-03; +1.352673080002813e-02   -1.525764714692520e-03   -2.835171857768694e-03   +7.285873855325663e-03   +1.275339631648846e-02   +3.156610547055588e-03   +6.683501253108808e-03   +5.017921211359682e-03];
L2E_L2I_iGABA_netcon = [+1.305476000222991e-02   +3.468897826486820e-04   +5.370749281840206e-03   +3.995799901747338e-03   +1.400556136900685e-02   +8.252322474911547e-03   +5.082733778912272e-03   +1.293771238037521e-02; +5.933064151641347e-04   +1.108391418557018e-02   +6.065418295392503e-03   +1.580308735985017e-03   +1.390923566975482e-02   +8.279221316267215e-03   +1.453140216010535e-02   +7.810084697487272e-04; +5.246122649342595e-03   +2.929367931681828e-03   +4.529420930221743e-03   +7.641529720789945e-03   +7.775283705108453e-03   -4.617412636023103e-03   +9.562100357629935e-03   +8.881294416719190e-03; +1.041769419610799e-02   +6.422249892766754e-04   +5.568041002786573e-04   +1.321470370509824e-02   +7.779589126717739e-03   +1.157811293801469e-02   +1.178828388317784e-02   +9.365228546743657e-03; +2.288963720285736e-03   +8.122848834087698e-03   +8.700533881959469e-03   +1.003649634681652e-02   +7.801093654404390e-03   +2.129169125702625e-03   +6.902387622104407e-03   -3.018882379096646e-03; +1.056179605345790e-02   -3.914899561038482e-03   +6.439122271080178e-03   +1.089592412554776e-02   +1.352545723748509e-02   +2.687309272935738e-03   +1.341215236581522e-02   +7.336303356422863e-03; +1.025730506969242e-04   +1.749440906109620e-02   -7.223020540054205e-04   -8.932330504297634e-03   +1.042529147375096e-02   +3.117723034125006e-03   +5.972924485999309e-03   +4.158346566630549e-03; +1.672043196709989e-02   +6.616807075118664e-04   +5.160992420971504e-03   -3.784354136325489e-03   +5.065761475643975e-03   +1.208618893535983e-02   +1.385278114595051e-02   +1.332024498526669e-02];
L3E_L2E_iAMPA_netcon = [+8.007701604213338e-03   +1.311939712812475e-02   +4.538515829690086e-03   +8.507901737116081e-04   -8.807903882894170e-03   +1.102311055230228e-02   +3.943661481037089e-03   +1.540838886472175e-02   +2.586944960871123e-03   +4.741099456097321e-03   +2.892277970588821e-03   -1.523240415396726e-03; +7.045434995236301e-03   +1.233092521883872e-02   +2.767925906896863e-03   +9.890949502822217e-03   +5.579394477117378e-03   +4.034681551177128e-03   +1.321649344812299e-02   +1.625051310072823e-02   +1.286651800094998e-02   +1.435997202576120e-02   +9.483113579154186e-03   +6.868900273834093e-04; +2.254803937705928e-03   +8.089898279086119e-03   -6.909767443202126e-04   +1.166636939424079e-02   -3.422271143590589e-03   -2.853314902832161e-03   +7.677312418511282e-03   +1.692483679832787e-02   +6.144696639890406e-03   +5.585665920291510e-03   +6.852537259641438e-03   +1.320304085571270e-02; +3.626799112102763e-03   +9.036122004556166e-04   +8.278211032711605e-03   +1.350956995648748e-02   +3.228506113305394e-03   +2.629916126811234e-04   +8.218234808591827e-03   -4.275578298491736e-05   +4.666792444570467e-03   +8.362556596687580e-03   +4.126798497980188e-03   +7.237740679216356e-03; +1.291866908480815e-02   +2.841121172085503e-03   +5.659477106909934e-03   +1.825972231739294e-02   +6.337339453782936e-03   +3.035310123075277e-03   +1.437640623312684e-02   -5.401138025873027e-04   +5.048300014415638e-03   +1.431664090958507e-02   +9.415488524998605e-03   +2.930552969942185e-03; +1.153355066715667e-02   +6.308294015082995e-03   +4.308783849967227e-03   +4.547482129651132e-03   +1.815506247748928e-03   +1.679934899061397e-02   +1.336370421072007e-02   +8.623234026643211e-03   +4.964365723068897e-03   -3.684985288439126e-04   +1.366668174178601e-02   +1.872987197890173e-03; +8.302583998460957e-03   +2.414868851996859e-03   +1.254293846743179e-02   +3.501520594566888e-03   -4.357693771818359e-03   +4.944645748728029e-03   +4.367045261232098e-03   +6.990846765187601e-03   +2.896567695879581e-03   +1.750634320463361e-03   +1.639183773407238e-03   +6.263435778408985e-03; +1.248281314590075e-02   -1.181964326550935e-03   +2.458799361395786e-03   +3.852651537052968e-03   +7.863994068055713e-03   +4.637231075822047e-03   -1.272837832813033e-03   +2.561390097453956e-03   +1.806457777093807e-03   +1.231823228838651e-02   +8.019005319702387e-04   +3.407543001728275e-03];
L3I_L2I_iGABA_netcon = [+1.074926922471979e-02   +6.863999155591678e-03   +9.794315069162616e-03   +7.959256435445594e-03   +1.529113428024818e-02   +1.132783296711177e-02   +5.433763392923327e-03   -4.329949395587281e-03   +1.359666700528062e-02   +9.698872357540432e-03   -4.250588996911031e-03   +1.667162920553885e-02; +9.181418275194976e-03   +1.146016497875142e-02   +1.655815947833159e-02   +1.817810374807562e-03   +5.943349758553939e-03   +1.309628935008612e-02   +1.811036068267178e-03   +2.619189588108146e-03   +9.552972328926840e-03   +7.360229754778365e-03   -2.302859454123126e-03   +3.539286202000048e-03; -1.368522540075695e-03   +4.167739547518038e-03   +8.797945742692020e-03   -2.464235464194222e-03   +9.155300431556091e-03   -1.080548762296048e-03   +1.146604505806294e-02   +1.003395703653757e-02   +8.756745460174509e-03   -3.075272102795469e-03   +7.575240389984065e-03   +3.403208901776868e-04; +1.723315462730767e-02   +2.471073450923441e-03   -4.313575572749690e-03   +9.447806166726302e-03   +1.278724004582250e-02   +1.051032307445051e-02   -3.330078709745733e-03   +6.999369893967350e-03   +1.124585422621199e-02   +3.626545945663121e-03   +1.118228320168790e-02   +1.345849847855183e-02; +6.996893723473630e-03   +1.821419244228557e-02   -1.178513787297854e-03   +3.966106591606405e-04   +4.149986410336173e-03   +1.149871471487622e-02   -6.506608719250737e-04   -2.819802149718435e-04   +1.425557633161077e-02   +1.178161276801158e-02   -5.099154810961687e-03   +6.511307919817447e-03; +9.673938624182031e-04   +9.632264930459667e-03   +7.788475411144450e-03   +2.585557724527464e-03   +6.447142814318179e-03   +5.744953887425787e-03   +9.864898042864402e-03   +6.956996675450053e-03   -1.789249197426818e-04   +7.002091866323907e-03   +4.212590487273530e-03   -1.050892844675149e-04; +1.294243288895862e-02   +7.415877835389439e-03   +7.960798405035201e-03   +1.124035151613697e-02   +5.996169514561337e-03   +4.864006453151037e-03   +1.695873911070934e-03   +4.561358939162454e-03   +1.160625803190982e-02   +6.351871717765233e-03   +4.900584874569732e-03   +9.806170314193181e-04; +3.827811286131207e-03   +4.192012391506818e-03   +5.949148620526369e-03   +7.904137821673896e-03   +5.664307964604359e-03   -7.896592854073894e-05   +2.773180431465087e-03   +1.913458532870940e-03   +1.273830713750554e-02   +4.658579012011433e-03   +4.436563556969613e-03   +9.389373817423205e-03];
L2E_L3E_iAMPA_netcon = [+1.261381071471281e-02   +1.161104293547446e-02   +9.822559952052192e-03   +1.013943321799218e-02   +2.761892550636720e-03   +7.197751150260363e-03   +1.350115635705181e-02   +1.372206606479113e-02; +7.464023602005578e-03   +1.273139393179144e-02   +1.087373559566784e-02   +7.152915911740361e-03   +8.124762547438186e-03   +1.034652409372740e-02   +1.223977263976516e-02   +1.044680069245622e-02; +1.229322237462468e-02   +1.147469182397204e-02   +1.594627324049937e-02   +1.099934850534560e-02   +8.540516820857042e-03   +1.190002240102103e-02   +5.975880606586204e-03   +1.000367602869499e-02; +5.269479923125988e-03   +1.022973077632573e-02   +9.438485569080893e-03   +2.199266499642766e-04   +5.713238076862373e-03   +1.021647076938242e-02   -6.001845590808215e-04   +1.349952983152534e-03; +7.885991668620179e-03   +7.692976325018874e-03   +5.272661718628202e-05   -2.522866859518418e-04   +1.845781485424136e-03   +2.445230128907119e-03   +1.023814061646334e-02   +8.296146506635056e-03; +1.204071643324670e-02   +1.686487022555621e-02   +1.070616848644071e-02   +1.599793218072339e-03   +1.167724551025820e-02   +1.938617404534445e-02   +6.181949648278677e-03   +1.187280046671560e-02; +3.867587702923176e-03   +3.467708300258256e-03   +7.961936752320884e-03   -2.146058030280047e-03   +7.634555886680869e-03   +1.234989157791117e-02   +1.435054477440811e-03   +5.288977818536186e-03; +1.513400975867119e-02   +8.857342286462542e-03   +1.273337342746286e-02   +1.587062453780302e-02   +7.587832672654130e-03   +1.620449549230872e-02   +9.123342375763057e-03   +2.543009349005898e-03; +6.820751557263325e-03   +4.241694608106949e-03   +1.177152766167490e-02   +1.255943665742810e-02   +1.043124294834042e-02   +6.744933748988794e-03   +1.130923612970382e-02   +6.236085319608664e-03; -2.475840120661120e-03   +8.057016953769650e-03   +7.146707830169357e-03   +1.056147836234752e-02   +1.473819684961033e-02   +3.229638529051073e-03   +2.446403520848769e-03   +1.224776381905124e-02; +1.153579295577568e-02   +1.186479151682155e-03   +9.904976853521767e-03   +7.422030069345431e-03   +1.902436502327687e-02   +1.136597787475051e-02   +5.071105793956044e-03   +3.806574968991120e-03; +2.234343496506328e-03   +1.121108319169995e-02   +4.846662991079045e-03   +8.921173132762753e-03   +8.928875705057786e-03   -1.630314179615096e-03   +1.422165564237898e-02   +1.547328404878875e-02];
L2I_L3I_iGABA_netcon = [+1.535774328107420e-02   +7.286101423959189e-03   +1.883319723073055e-03   +7.193810300215823e-03   +8.560862747966204e-03   +1.517457520501257e-02   -5.136852006410838e-03   +5.436164282766156e-03; +6.810328625195428e-03   +1.285163641090769e-02   +1.597187185720712e-02   -2.027811274238795e-03   +1.069327504254682e-02   +1.220260004244596e-02   +5.621368766077439e-03   +6.771575186433207e-03; +8.028259167898909e-03   +1.114249183169069e-02   +9.090619114909715e-03   +7.694963712708947e-03   +2.352956004457192e-03   +5.610622188774500e-03   +5.832298850498989e-03   +2.806914490029838e-03; -2.975685311361237e-03   +9.489160792933417e-03   -8.109439935888680e-04   +1.471154170199306e-03   -1.104946257753773e-03   +2.534053275838978e-04   +6.036502692194755e-03   +9.030995967397650e-03; +3.103077554258864e-03   +4.102532251140400e-03   +2.254748029757784e-03   +6.045901929810624e-03   +8.974399427156263e-03   +5.153937509182523e-04   +2.507252009922418e-03   +4.147229129956373e-03; -3.412505641700693e-04   -3.906764428481122e-03   +1.104070629422296e-02   +6.686446080386403e-03   +3.342576455271358e-03   +5.882534148465774e-03   +1.008583869776801e-02   +9.276102761792391e-03; -4.292741457740832e-05   +1.072618968650846e-02   +1.100076956902802e-02   +9.711097464952941e-03   +7.709450747381661e-03   +2.277221935469274e-03   +3.933963364378113e-03   +1.016408710854433e-02; -2.399830390912145e-03   +1.930158262770837e-02   -4.528929793563273e-04   +4.506682201546601e-03   +6.323420810922485e-03   +1.170359074192399e-02   +8.083404188257957e-03   +6.599716251351554e-03; +1.099588570885229e-02   +9.674273086964027e-03   +1.762151183468120e-02   +4.609641689512640e-03   +3.969620700000224e-03   +1.218228043250307e-03   +3.986403046974717e-03   +7.701629293713010e-03; +1.252927069292349e-02   +1.233355062034330e-02   -4.559048360286214e-04   +6.472987932415609e-03   +2.310377005788457e-04   -5.195352984677059e-03   +6.331878333215801e-03   +6.905531969636466e-03; +1.326244884783738e-02   +1.499514154918171e-02   +3.788885979005330e-03   +3.799060707020654e-03   +6.290999484423424e-03   +3.417890274713948e-03   +1.031711599375294e-02   -2.005320338582511e-03; +1.010286130817800e-02   -7.855109368114822e-04   -2.218791488483920e-03   +5.792429616750995e-03   -5.432153185382806e-04   +1.066131496181236e-02   +8.211967002158066e-03   +5.759580836068358e-03];
L3I_L3E_iAMPA_netcon = [+6.784766003379794e-03   +1.304240693699376e-02   +6.326325419998909e-03   +1.105039921986605e-02   +1.237849977294540e-02   +5.174764142359679e-03   +9.346343102303610e-03   -8.891680337733110e-04   +8.388560486812951e-03   +1.787834590973664e-03   +3.664593681237512e-03   +2.125639812917524e-03; +4.379919804110526e-03   +6.867975644169353e-03   +1.120420070340974e-04   +6.398753058839193e-03   -5.451129417275336e-03   +9.626474967027381e-03   +8.773056172217169e-03   +3.823287632993277e-03   +3.280163880439660e-03   +7.162539464918337e-03   +1.350675893509607e-02   +8.568791185288424e-03; +5.854255550065059e-03   +1.165031228093539e-02   +1.419801055406360e-03   +1.365071781501377e-02   +6.481031135234884e-03   +7.971334413720098e-03   +5.590976876270745e-03   +3.505436010407174e-03   +1.034444998435309e-02   +8.067517566764120e-03   +4.442228140264170e-03   +1.238153175490382e-02; +1.109807184571670e-02   +1.041829370005727e-02   +5.985204164885776e-03   +4.009616121157166e-03   +5.572433218159560e-03   +1.061487419460314e-02   +1.606682669436583e-02   +2.835714822569037e-03   +9.761430776748110e-03   +1.766213852178706e-02   +1.066043366652257e-02   +1.317292574022741e-02; +2.998253166296363e-03   +7.175480599758420e-03   +5.350796867421068e-03   +1.003092612817487e-02   +8.143822156865453e-03   +3.703120483589935e-03   +1.491621380954710e-02   -3.421883930040490e-03   +7.962081671755532e-03   +4.711573924386916e-03   +4.313133277467541e-03   +8.612486416364369e-03; -3.252730912488943e-04   +4.431697389834677e-03   +1.328013735161315e-02   +1.059866206045541e-02   +1.084382653305666e-02   +7.943444628136292e-03   +1.342012048108033e-02   +4.072227172419263e-04   +7.267107392189043e-03   +1.838367769198498e-03   -4.662966366564048e-04   +5.637182251485528e-03; +8.178389876717445e-03   -2.115633577310456e-04   +7.154516722925299e-03   +3.790842090234368e-03   +7.098921187103968e-03   +1.367705293521125e-05   +2.640643539367496e-03   +9.493105339850285e-03   +7.578717556195288e-03   +1.410360065001208e-02   +4.681185140145620e-03   +8.325081114478619e-03; +1.016917136020580e-02   +3.269600525955743e-03   +1.474462432010425e-02   +5.587718403848219e-03   +1.330926118852438e-02   +4.826965402897743e-03   +8.323272091000080e-04   +4.905255450160672e-03   +5.485048380493118e-04   +5.493074027717650e-03   +5.519470362261952e-03   +1.336485382273225e-02; +4.686614902412596e-03   +8.365695770035365e-03   +3.791093226497204e-03   +8.264308034009040e-03   +8.376792616125159e-03   +1.386223762999325e-02   -2.160948326424194e-03   +1.177284693625002e-02   +1.123700412537611e-02   +9.396255326105274e-03   +6.222700941049690e-03   -2.926242751890734e-03; +1.166962755940608e-02   +9.806671538020416e-03   +1.294183872817397e-02   +9.621398392700188e-03   +1.113997306019844e-02   +1.322765231178046e-02   +3.249530665908721e-03   +2.012961158858374e-02   +8.895334503146409e-03   +3.730374446736570e-03   +9.442815438358966e-03   +4.670002325310381e-03; +7.207478191728759e-03   +6.580600737097295e-03   +1.448294584059345e-02   +1.451090441988681e-02   -4.998661888954625e-03   +9.243844160669852e-03   +2.666339387665666e-03   +4.189228284265815e-03   +1.159130695974910e-03   +8.462752677980336e-03   +4.494548660737754e-03   +3.693975020749104e-03; +2.523123145410005e-03   +5.660014416302900e-03   -1.792486733983101e-04   +1.002665430724668e-02   +6.349993196172448e-03   +2.828087221923856e-03   +1.769675618750673e-02   -1.470828762389571e-03   +8.675381593803677e-04   +1.082991414321803e-03   +1.557709197279213e-02   +5.213399217315895e-03];
L3E_L3I_iGABA_netcon = [-1.983522439378584e-03   +6.501016997576488e-03   +2.532027520529870e-03   +1.330383040943126e-02   +1.128459058203168e-02   +1.350909911409954e-02   +7.334699920170383e-03   +8.338019460427663e-03   +8.192630633243913e-03   +1.087258669350371e-02   +7.969385584006181e-03   -1.343942110505646e-03; +8.856494352906450e-03   +8.946917056330625e-03   +5.132483871063696e-03   +1.359440813782189e-03   +5.548292630085883e-03   +9.177650046580910e-03   +5.975213537980157e-03   +1.147303546463769e-02   +1.296890368095667e-02   +9.598402269584012e-03   +4.868200601602956e-03   +1.615431368197442e-03; -1.686948123799735e-03   +9.261489107636522e-03   +7.799131891331043e-03   +6.603976604746910e-03   -3.289852278734800e-03   +1.344810058568376e-02   +8.727387186877966e-03   +1.364072758983930e-02   +7.707938857773785e-03   +4.674561315556480e-03   +6.267652160068790e-03   -2.854598940244076e-04; +6.546295012855518e-04   -1.010498173488044e-03   +1.650253439905613e-03   +1.272387981114576e-02   +9.258411249675450e-03   +4.539489588640851e-03   -1.357159673310024e-03   +1.544603384479660e-03   +8.358201483149315e-03   +1.249468622579129e-03   -2.025726417159607e-03   +9.024179518966580e-03; -1.336494846646736e-03   +1.169548526257253e-02   +1.502286037009205e-02   +6.629600745336214e-03   +6.329800287674580e-03   +9.224323883835674e-03   +1.218505887408907e-02   +1.454034463073759e-02   +6.783123327996559e-03   +1.280757097797758e-02   +1.516302738218312e-02   +3.299332593538341e-03; +1.014816713823542e-02   +3.637053676082643e-03   +1.605527660193356e-02   +6.767104678878122e-03   +5.369713459053984e-05   +1.811630687020218e-02   +8.654446969863509e-04   -4.212446385756250e-03   +9.033657143590638e-03   +1.012505206975362e-02   +5.180492681721196e-03   -2.965345737666438e-03; +7.271812818221691e-03   +6.656798154945206e-03   +4.484388345240339e-03   +8.929624351835683e-03   +7.784059984487495e-03   +9.103733060340380e-03   +4.837826915453846e-03   -1.732521552209073e-03   +9.963284895481846e-03   -2.081798179694828e-03   +1.619722153879956e-03   +7.285045813959710e-03; +3.873156335124355e-03   +3.628405425166273e-03   +8.417410585655410e-03   +1.471309335364262e-02   +4.367476462313621e-03   +1.335952479668884e-02   +6.699042722416021e-03   +7.728284942185367e-03   +1.148904312532819e-02   +1.169181192887764e-02   +2.949254103020279e-03   +1.345946912514554e-02; +3.305846056607058e-03   +1.224780229122421e-04   +1.256388027869842e-02   +3.985171686101035e-03   +1.247997996235771e-02   +1.069080857648552e-02   +4.926687579893937e-03   +1.913612475238663e-02   +2.220329495008142e-03   +1.750814342776387e-03   +6.037728270833311e-03   +1.157065060282642e-02; +1.353084021264614e-02   +2.533017398716326e-03   +1.407673357617644e-02   -9.028528306281522e-04   +1.856424927763303e-04   +1.579224037338638e-02   +8.885565597856297e-03   +4.307293497829128e-03   +1.065641546903226e-02   +1.497578574484861e-02   +5.555247565963046e-03   -1.301335524404215e-03; +3.801677633816405e-03   +4.028323558191937e-03   +8.200563626814751e-04   +4.057106804965354e-03   +1.039354285701139e-02   +6.913929006652044e-03   +1.376115161140133e-02   +9.753644745342634e-03   +1.138058765493802e-02   +5.229258880231188e-03   -2.864541937854411e-03   +1.157761864825816e-02; +6.552406052669425e-03   +4.710053236405589e-03   +9.279327334155572e-03   +8.121527799008307e-03   +7.233597648164961e-04   +2.692818649705298e-03   +1.429279512933877e-02   -5.096287145928729e-03   +1.776796908417514e-02   +9.577948881018756e-03   +6.097131538279296e-03   +6.237568898467490e-03];
L2E_Input1_iAMPA_netcon = [+9.627898687671138e-03   +9.724684800434640e-03   +6.509726406744045e-03   +1.413814445182769e-02   +2.041789613864441e-02   +1.377793252654247e-02   +9.816211023986681e-03   +3.256212500998267e-03];
L2I_Input2_iAMPA_netcon = [+8.433426330311336e-03   +1.606068065246790e-02   +1.495444170277733e-02   +1.242999946355467e-02   +9.193988538494085e-03   +1.320535104286673e-02   +1.681379035006703e-02   +1.176182495409865e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
