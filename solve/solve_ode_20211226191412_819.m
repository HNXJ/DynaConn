function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.596024282449311e-01   +2.326968733592333e-01   +5.637981031749031e-02   +7.249760428345575e-02   +7.276775457716644e-02   -3.524144213486637e-02   +3.026419462987375e-02   -2.175773130774171e-01   -7.792288539746192e-02   -2.423313658277444e-02   +1.588616662519790e-01   +7.689832930738352e-02   -1.488953650170347e-01   +4.595906553695146e-02   -1.199352858078176e-01   +1.594475551840846e-01; +1.498120357468604e-02   -1.920238701313596e-01   +2.603162367204954e-02   +1.636936719263371e-01   -2.264653093849114e-01   +1.772518512355427e-01   -7.691350214594342e-03   -1.631761116955934e-01   -3.469229546429596e-01   +1.300038205359371e-01   -1.572258644468190e-01   +6.594813012595006e-03   +3.110620085219718e-01   -2.039090672823531e-01   +2.911291833868679e-01   -1.095663885075748e-01; +3.106693665913943e-01   -1.639773366613002e-01   +1.774684823285990e-01   +2.196489464559719e-01   -1.496246440645225e-01   +1.025969665296714e-01   -4.658785883370625e-03   +2.134948431197888e-01   -8.335237483719601e-02   +1.060239925764014e-01   -5.234033664921431e-02   -8.509746730872692e-02   -1.003088330042268e-01   +3.013672181610058e-01   +1.369734112051032e-01   -8.671598607932593e-02; -7.748566060927714e-02   -2.235439070940003e-01   -1.704268533174880e-01   +1.027950840339412e-01   -3.022454092828910e-01   +9.978174809083050e-02   +2.149867147972300e-01   +1.174583636840926e-02   +4.064215584270900e-01   -2.214783288654082e-01   -5.982996443124991e-02   +4.570545232684577e-02   -7.340234708225797e-02   +2.318586696579805e-01   -2.987623589278201e-01   +3.147800083537458e-01; -1.900479557020780e-01   -2.901632574838497e-03   +2.412756009207801e-01   -3.934435073293498e-02   -1.538461064339537e-02   +6.459087659191873e-02   +1.234831762350734e-01   +2.850436822600664e-01   -1.387240358422275e-01   -2.054987553129181e-02   +1.642589122706396e-01   -1.284095932046742e-01   +4.228252285662851e-01   -8.380114717005760e-02   +4.717103996329380e-03   +3.291935419566302e-01; -1.549702307691303e-02   -2.657167474783368e-01   +1.908738026966463e-01   +4.452107405868905e-03   -1.072997019267471e-01   -2.893494386420307e-01   +2.090366953632405e-02   +1.645908144369477e-01   +1.064261898924013e-01   -1.505229373512058e-01   +3.100101364974289e-01   -1.153982172248827e-01   +1.059927785517789e-01   -2.552014927780488e-01   +1.615049198141840e-01   +4.660877000894098e-02; -1.506779141560089e-01   -2.200935122088160e-01   -3.067732111562226e-02   +2.534734024642865e-01   -2.733582503350865e-01   -1.221983596612396e-01   -1.858247054829947e-01   +1.020987413365073e-01   +2.931555938771149e-02   +1.663859383061544e-03   -2.555582318884824e-01   +2.370401179244151e-01   +1.155771131061448e-01   +3.239802829691460e-01   +7.114451109425371e-02   +1.139921861402105e-01; -1.854773820799238e-02   +1.009582770470252e-01   +1.874439364017841e-01   -1.819059686726107e-01   -4.629295019455915e-02   -3.339312090622160e-01   -4.360310747617635e-02   -1.064061150169270e-01   +1.165538301556414e-01   -1.591490335694353e-01   -1.611076463471005e-01   -1.303994035301886e-01   +3.216128950627480e-01   -2.352581069702855e-01   -2.886397463633496e-01   +9.127728186719812e-02; -1.730544766783952e-01   +1.133298833760368e-01   -1.986667999774104e-01   -4.727310822916930e-02   +1.088494323327806e-01   -3.578990854697697e-01   -5.840636865889869e-02   -2.210769354541086e-01   -2.654199623511425e-01   +2.394341805486921e-01   -2.626006917031589e-01   -7.475086564937172e-03   +8.524109407738226e-02   -6.769630757002880e-02   +8.285862277852947e-02   +1.523707045274644e-01; +1.066935262482994e-01   -1.428585139963681e-01   -8.089783012450651e-02   +3.662183659282103e-02   +1.953095829849511e-01   -4.889369839357963e-02   -2.417497048792288e-01   +2.021191670146266e-02   +6.451543181280239e-02   +1.897364670627041e-01   -1.593868806418489e-01   -1.331387931769090e-01   -1.423280180083042e-01   -2.874162428730591e-02   -3.646067525154155e-02   -5.595212267529335e-02; -1.740130294273751e-01   -6.772902275066002e-02   -3.277189837477292e-01   -2.268602884070586e-01   +1.790172767663287e-03   +1.644902453332963e-01   -1.386580417044513e-01   +1.768690312765686e-01   -4.103534604312129e-01   +5.506356460462334e-02   -2.552522721867057e-01   +1.770000243735853e-01   +2.681189340560303e-01   -6.706486426798236e-02   +7.410149873175617e-02   +1.545741206006456e-01; -4.176372279817306e-01   +4.717528991981024e-02   +1.834764679482807e-01   -9.391129346687313e-02   +2.460704263868726e-01   +1.033280712419441e-01   +3.317422008844745e-01   +1.195606083394520e-01   -6.948495713089439e-02   +4.721809930212894e-01   +1.328824095722417e-01   -2.601169685141993e-01   +2.631169270563447e-01   +4.575987044502033e-02   -3.031374760182572e-02   +1.146426558503135e-01; +2.942872413431035e-01   +9.321117373316931e-02   -9.215830284907445e-02   +1.608665454089038e-01   -4.466306441465379e-02   +1.049679083064379e-01   +1.368358191169107e-01   -2.254034640496529e-01   -3.996556935730937e-01   -3.151278748602691e-01   +3.817467572370635e-01   -2.047566607836195e-01   -7.703061208385327e-02   +1.624658964687617e-01   +1.454869872770526e-01   +5.114621253881454e-02; +8.703206099136557e-02   +2.570313808571055e-01   +2.342517019097005e-01   +1.987072287368458e-01   -1.380829583361206e-01   +2.339398388103201e-01   -3.556566154483749e-01   -1.205279361652047e-01   +2.931171110087210e-01   -2.914538220070366e-01   -2.222632942461441e-01   -2.737263668213765e-01   -1.840053249642757e-01   -7.681717906701921e-02   +2.209787353867104e-01   -2.608032136063158e-01; -5.259143849469263e-02   +2.556363040096638e-01   +1.304959848982670e-01   -4.330692734726793e-02   +1.274063949028208e-01   -1.393013267053345e-01   -7.877472599318054e-02   -1.107863705744545e-01   +1.652090874309187e-01   -3.404503238514370e-01   +1.558314367090462e-01   -5.440631958624139e-02   -1.491778296879607e-01   +9.951625708452620e-02   -3.925851241350646e-02   +1.248696454333033e-01; -8.663616644578948e-02   +2.269417711518261e-01   -4.816715831447982e-02   -6.470740913389730e-02   -6.812902708481959e-02   -1.165634744382590e-02   +6.034824104060908e-02   +5.432359890472777e-03   -2.799437902852023e-01   -3.839877459595721e-02   -3.713877450364592e-01   +1.984630497565951e-02   +1.703656932003330e-01   -5.236777451440307e-02   +2.800492440425164e-01   -1.829049773554862e-01];
L1E_L1I_iGABA_netcon = [-1.259854453434801e-01   +9.043701003322355e-02   +1.908077580661297e-01   -1.792288543584797e-01   -1.106772840774572e-01   -3.984098406626217e-03   +4.138447722383701e-01   -1.644835449106349e-01   -2.692712119393341e-01   -1.136257888573161e-01   -3.792510640621730e-01   +2.689702581870685e-01   +2.584429201810884e-02   -9.494121962809743e-04   +2.612158343158793e-01   +2.132472220157463e-01; +3.549423083852634e-02   +2.358821029452580e-01   +5.443258184932181e-02   -2.313825264267587e-01   +3.597042662209657e-01   -6.554229706066741e-03   -2.773229366277143e-01   -9.995264276515239e-02   -2.007913448439965e-01   +6.960689495030364e-02   -2.828938032795293e-02   -8.102249461021421e-03   -1.428338430471260e-01   +1.214709708924371e-01   +1.435266467149444e-01   -5.578484649746472e-02; -1.218446071018943e-01   +1.460499068453590e-01   -1.078443555849202e-01   +2.353607693006382e-01   +1.933030552219547e-01   -2.121475370338605e-01   +2.050076877790559e-01   -2.732553530259803e-01   -2.534158795698984e-01   -1.362041936848713e-01   +2.244731792485525e-01   +3.168717162387190e-01   -3.574969049928882e-01   -9.779787800037555e-03   +1.267261683259746e-01   +4.420308337605751e-01; +3.728619856431419e-01   +2.089467701114348e-02   -7.500803845154685e-02   -1.136121899228720e-01   -1.328796198837912e-01   -2.919890134793199e-02   -2.905814238186657e-01   -3.100046942072514e-01   -2.871980287082452e-01   +2.479863908087991e-01   -1.330476058678500e-01   -1.813471765363323e-01   -2.063788984685953e-02   -2.108383004434581e-01   +2.455444375388436e-01   -1.206922377957451e-01; +9.430349438927645e-02   +1.065251252996354e-01   -2.896225484345933e-01   +8.854224780451597e-02   +1.704211439662485e-01   -2.103057019907537e-01   +3.763749481984238e-02   -1.482456277214730e-03   +1.771514080967352e-02   -1.520919175284502e-01   -8.357482521039218e-03   -3.759429217796544e-01   -3.766722160947148e-01   -6.987044555236394e-02   +7.413087636644014e-02   +1.137204375279360e-01; +1.209589538336597e-01   -8.090263717490791e-02   +2.025982712048757e-01   +3.099822279949194e-01   +8.481199711827536e-02   -1.313810904247840e-01   +1.481971205141485e-01   +7.700140367391650e-02   -5.588490561038374e-02   +3.058880276435258e-02   -6.375363334784495e-02   +1.166171100578992e-01   +1.340823921929670e-01   -9.831970732905104e-02   -1.920153259758898e-01   +1.990540364526605e-01; -1.532169858100101e-01   -9.764895878661700e-02   +1.384120279487980e-01   -3.944435153095501e-01   -6.878076648818809e-02   +3.309441755794663e-01   -2.466599943968094e-01   -9.523858233778179e-02   -6.247031957274501e-02   -3.325965162856633e-01   +9.232390377059609e-02   +6.937540974587195e-03   -2.826117581167925e-02   +8.530917699802350e-02   +6.800937518454263e-02   +3.387454726953362e-02; -8.575879752267251e-02   -3.578822395138860e-01   -1.288072471915385e-01   +3.056017763590712e-01   +1.121115255739012e-03   +3.671935946798654e-01   -3.309144374398112e-01   +1.745349175040015e-01   +1.021734899482466e-01   +2.738219333497053e-01   +2.190730272908154e-01   +3.097063687398091e-01   -4.911623921180316e-02   +2.886232000930813e-01   -4.101921010604035e-01   +4.381107070440583e-01; -2.834425576095702e-01   +2.922885237407636e-01   +1.783048893990108e-01   +2.837124218020931e-01   -2.006198708316516e-01   +1.313605144941807e-01   -3.068125431289265e-01   -3.353490464628738e-01   +2.845719328633154e-01   -5.001735128321730e-02   -2.508215228336773e-01   -1.422540890700002e-01   +2.474718936174878e-01   +6.747322971626810e-02   -1.631957425836897e-01   +2.939906934542332e-01; -6.997934911195584e-02   -1.157683537618593e-01   -4.934234533631562e-01   -4.804659341799722e-02   -1.145261789124565e-01   -3.981245415592699e-02   -1.483226505234393e-01   +7.125496748523669e-03   -3.203733076046510e-01   -1.783312463784572e-01   -4.887212470385693e-01   +5.894039804872209e-02   -3.131692607622605e-01   -3.297602205565456e-01   -1.762400446926512e-01   +1.387023830529217e-01; +3.393091627113470e-02   +2.978061608312561e-01   -2.360350469335869e-01   -6.066435246450334e-02   +2.149200782876139e-01   -3.162297669768510e-01   -2.358401837737565e-01   -6.184540034820482e-02   +1.885915198329521e-03   +1.039386232319313e-01   -4.840282870735227e-02   +1.150192852018878e-01   +1.326079957986479e-01   -5.830333896373078e-02   +1.556407026828092e-01   -9.094878839892021e-02; +2.415354807511158e-01   -2.171989782297698e-01   -7.371908066619970e-03   -8.300637408101819e-02   +1.222526062323469e-01   -1.116905678031576e-01   +2.492126677033388e-01   +1.303007777441762e-01   +1.117434726377303e-01   +7.647053202386619e-02   -6.948101726142286e-02   +1.977600548010540e-01   +7.871786898729093e-02   +1.681382489582792e-01   -6.328993755144849e-02   +1.200718181236690e-01; +1.601006179784389e-01   +1.030602595803259e-01   +3.072095386721138e-01   +3.137926463898870e-01   -1.435121107138587e-01   +2.714376853479682e-01   +1.401075109965771e-01   +2.654173942793342e-01   +3.374792802552011e-01   -1.320647930402435e-01   +8.612844888033004e-02   -1.533541898578022e-01   -2.380527111251914e-02   +1.656140695857017e-02   +1.414424167508130e-01   +1.539195773095654e-02; +2.015356333182704e-01   +1.360536975559959e-02   -1.081705951508666e-01   +6.072707175885353e-02   -2.256566462884351e-01   +4.388572084822769e-01   +2.485838275357546e-02   +2.121452601803222e-01   -2.480331552862217e-01   +1.246298589776574e-01   +1.056992157406222e-01   +3.428654159871309e-01   -1.439633614144950e-01   -1.098596942573778e-01   -3.603980611526235e-01   +4.771177673321335e-01; -3.947137499885601e-01   +3.488291639619550e-01   -2.199708697391695e-03   -1.418099980520537e-01   -2.615957826632505e-01   +3.910219656299910e-02   -8.110584229538254e-02   -2.326471172918191e-01   +5.336809897589316e-01   +1.874731985790555e-01   -3.937635047284762e-01   -3.113560524720724e-01   -6.071611966228355e-02   +6.148489554035894e-02   +1.522448739211155e-01   +1.979249932362103e-01; +1.176737720133302e-01   +2.448876425546357e-01   +4.137727906251495e-01   +1.601780714597676e-01   -3.228329229816740e-02   +9.323055478726501e-02   +3.550724885182572e-01   +9.718152996706102e-02   -4.847081387808980e-02   -7.490891577788629e-02   +5.432328883162754e-02   -7.861718120962327e-02   +3.278518717379497e-01   -2.771822316615390e-01   -9.606644104655350e-02   +1.730785176745430e-01];
L2I_L1I_iGABA_netcon = [-1.597962483448818e-01   +1.533269756200225e-01   -1.375549176114224e-02   -1.443856686895035e-01   +9.828483051380929e-02   +1.560874424756322e-01   -3.541477162430107e-01   -1.978681579941664e-01; -2.746873888166218e-01   +3.887250471011662e-02   -1.097653293088295e-01   +3.572711700052837e-01   -1.920838442017880e-01   +2.082597006932490e-01   +2.456269747209392e-01   -1.444615750927472e-02; -2.332772696030686e-01   +1.358530216677346e-01   -5.409932737134847e-02   +2.280897534471407e-02   -7.263287776426361e-02   +1.790707998100962e-01   +1.272306540136701e-01   +1.182925495533743e-01; -1.973334859900222e-01   +5.584829240416426e-02   -1.790864291524321e-01   +1.142131026932867e-01   +3.540999008485968e-01   +7.209969045605669e-02   +3.142474536699677e-02   +3.209864741040336e-02; -1.218833554792280e-01   +1.301364371396828e-01   -8.712306988384341e-02   +9.379992848193804e-02   +3.579409660240478e-01   -3.178041273213630e-02   +2.832714732246238e-01   -3.012125749595936e-01; +9.195773165080505e-02   +3.639278801545895e-01   -2.691584131121988e-01   -1.764059001315941e-01   +1.172559842444199e-01   -4.084314804791969e-02   -1.599864482372231e-01   +3.392297491869772e-02; +1.761896618014155e-01   -3.631548911342581e-01   -1.832023651438882e-01   -1.318956044800537e-01   -1.006177331855371e-01   -3.570940743413358e-01   +1.231707162024382e-01   -2.527251504027870e-01; -8.016890849849689e-02   +5.297683828418291e-02   +1.790867026688560e-01   +5.578636562594147e-02   +3.052507993021565e-01   +1.312831848804879e-01   +2.484757492730438e-01   +9.866218590569922e-04; -1.575758003235888e-01   -3.608542903384555e-01   +1.321844163474685e-01   +8.740245883011833e-03   +2.631021713430310e-01   +6.833494099138022e-02   -2.478666803217571e-01   +1.248208691958825e-01; -8.595564254963900e-02   -4.749015552575858e-02   -5.547399143356900e-02   +7.637991427830727e-02   -1.468213906201594e-01   +1.644763797773762e-01   -3.939511528401186e-01   -3.135322209281458e-01; +6.149954644586567e-02   -2.212501060681741e-01   +2.524360188937054e-01   -2.326654958547197e-01   -5.045840192199974e-03   +3.435243529543194e-02   -2.185074055605561e-01   -7.750136390683321e-02; -1.934415625118975e-01   +1.438521275043886e-01   +2.663707189863837e-01   +3.523821194324251e-01   +2.613594479750672e-01   +1.022259837350262e-02   +1.198421547370399e-01   +2.085923735605559e-01; -9.427115688294981e-02   +3.469836684335464e-01   -2.007695495080636e-01   +1.713732020115178e-01   -6.220339292786230e-02   -3.147359556265237e-01   +3.162429949735299e-01   -3.028618323345210e-01; -3.143657594281996e-01   -1.833325713078374e-01   -3.809005128226609e-02   +1.803525842782704e-01   +1.945715046229412e-01   +3.211645191854313e-01   -2.074936095644476e-01   -1.464154324611609e-01; -2.485981057224922e-01   +3.757382920492985e-02   -7.985413779546893e-02   +1.585740210665624e-01   -1.486769683215953e-01   +2.629913517757597e-01   +4.398560499527776e-03   +1.077339344763795e-01; +2.523042899405500e-01   -4.879211630513133e-02   +1.186251824568852e-01   +7.224486042480394e-02   -1.521645130079059e-01   +3.762359463224374e-01   -1.450123225485676e-01   +2.039855464488776e-01];
L1I_L2I_iGABA_netcon = [-7.433989382893122e-02   +2.673610474892801e-01   -6.396360566110940e-02   -1.461517822631666e-01   -1.949060502573199e-01   +5.552182808029438e-03   -3.945848800347415e-01   +7.740542104849753e-02   +4.197616592453066e-01   -1.649866104469458e-01   +2.292102088530736e-01   +1.622663193481991e-01   +2.530500729216935e-01   +2.345520843691989e-01   -6.687210576505789e-02   +1.549624669293332e-01; +2.851516853573697e-01   +9.383127304885250e-02   -1.666108929303117e-01   -2.292135853605008e-01   -1.656583350711137e-01   -4.911802381576758e-02   -1.533915933605307e-01   +3.732757028072379e-01   +1.081332105726722e-01   -3.272444646180437e-01   -2.113580598003932e-01   -2.108330897731258e-01   +3.575554655328917e-01   -6.286409627112650e-02   -3.162398509860394e-02   +1.682326143833704e-01; +1.849371345424337e-01   -2.185548820489729e-01   +2.099876475717461e-01   +7.393805924718833e-02   +2.678035427066791e-01   +1.713701129491115e-01   -3.186311599891407e-01   +6.878511556184308e-02   -3.562203528618135e-04   -2.085294199865435e-01   -3.675930511974181e-01   +4.498704660145588e-01   -2.985115022128344e-02   +4.804501707496220e-02   +1.576817686007062e-01   -1.139829474226535e-01; +1.153514612163861e-01   -1.002919689362277e-01   -1.165698021918628e-01   +2.633103270074930e-01   +4.434178332145783e-02   -2.464248963282155e-01   +2.568848784938723e-01   +2.008481919838224e-01   -2.243763466054434e-01   -2.280838867755003e-01   -5.699486713301147e-02   -1.389879093291160e-01   +1.703616588996077e-01   +3.556188917643296e-02   -4.586208561967882e-02   -1.578844897862099e-01; +2.202190795548409e-02   +1.288080507708423e-01   +1.807925017222223e-01   -3.026732940849969e-01   -2.106151399109314e-01   -8.026833333920000e-03   -1.615820729243317e-02   +2.804234967370099e-01   -2.128233400128884e-01   -1.300452764102376e-01   -1.453415799085925e-02   -2.050428651309816e-01   -1.446664503422797e-01   -1.565724458520441e-01   -1.143241807249363e-01   -1.507561854843802e-01; -5.329351869950615e-02   +1.798878501144603e-01   -2.070962782936882e-01   -1.609311951177724e-01   +3.840383004863024e-01   -2.608297852021381e-02   -2.511843750345581e-01   +7.723068237861620e-02   +4.075488665005701e-01   -2.619602397702226e-01   -2.930560744431405e-01   +1.484603186638284e-01   +1.823741156444518e-01   +2.124855021204179e-01   +2.633212225469719e-01   -1.283350933425809e-01; -9.068624023706284e-02   -8.546249873395831e-02   +9.290831115948821e-02   +3.819889687328234e-01   -2.203081649756478e-01   +3.841152906936521e-02   +2.794679500305370e-01   -1.010002418224217e-01   -3.235555198855363e-01   +2.909610001450853e-01   +1.629438499340868e-01   +3.590839004237716e-01   +5.409204162635714e-02   +2.381479781378167e-01   -3.308019832962013e-01   +1.573239614137841e-01; -6.747267102266026e-02   +4.010252645084725e-02   -1.687760893872864e-01   +2.079898123503763e-01   -1.303526389404799e-01   +4.579017488589276e-02   +1.425031983597837e-01   +1.037725324838810e-01   -1.212395152265908e-01   +8.456117690899483e-03   -2.238641070775464e-01   +9.475002359717290e-02   +2.374416000816914e-01   -6.097574481500116e-02   -1.235586707107871e-01   -2.829805974925459e-01];
L2E_L1E_iAMPA_netcon = [-2.028391269512629e-01   -7.109775359393720e-02   -2.095232368218205e-01   -1.779712995015878e-01   -1.446377401126981e-01   -2.435519399831702e-01   +2.649791478972728e-01   -2.974568757997870e-01; +2.496050327095690e-01   -1.044181058627499e-01   -1.439710910781216e-01   +3.733440479105311e-01   +9.815894464623871e-02   +2.374385666433884e-01   -3.412328658614777e-01   -8.516282354321383e-02; +8.281449112601626e-02   -7.440643133418338e-02   -1.967705764242025e-02   -1.484141240357414e-01   +9.392362973122340e-02   +1.057086219328764e-01   -3.071090686202055e-01   +2.361413395337214e-01; -4.402253564653874e-02   -2.653846155129568e-01   +9.721514605631064e-02   +2.679491174627587e-02   +1.028097385391300e-01   +1.216703117089716e-02   -3.389462304271861e-01   +3.299887214221174e-01; -5.531766735524488e-02   -8.943065905740624e-02   -1.910451767275476e-01   +2.660850415365885e-01   -5.292171046032931e-02   -7.635452907978642e-02   +1.286657869914966e-01   -2.773173795005404e-02; -1.077970108018785e-01   -3.142531276057278e-01   +2.794211451678030e-01   -5.594806108261430e-02   +1.742386392007597e-01   +3.121755249355663e-01   -1.144611601745967e-01   -1.059471397935021e-01; +2.804134680704197e-01   -1.752459984500348e-01   +2.606596057472337e-01   -6.179623215505376e-02   -8.918467724688156e-03   -1.374223923128960e-01   -2.161816178548936e-01   -4.685467196600028e-01; +6.243185586865821e-02   +8.969181876114435e-02   +3.525582552561216e-01   -1.776101393898517e-01   +9.294755555309374e-02   +4.185804663681947e-02   +1.859020284954182e-01   -3.513446721141854e-01; +3.515415416695256e-01   +1.076927310330013e-01   -2.235205092585579e-01   -6.509232182176493e-02   -1.595368432954170e-02   -1.757579489876923e-01   +3.653740852101311e-02   +4.816017312128929e-02; -2.066444245741716e-01   -5.999452132206839e-02   +2.202782524305997e-01   +1.695141602251160e-01   -2.608501159424523e-01   -1.169629515218431e-01   +1.151723710402380e-01   -1.391102997501067e-02; -7.025788194145829e-02   +3.387429480958173e-01   -3.297830810317254e-01   +2.359510681559603e-01   -6.104252865463576e-02   +2.002659271884649e-01   -2.867255020222610e-02   +4.263084827006981e-01; +9.136186017581713e-02   -2.478911604796312e-02   -5.887129063584266e-02   -1.597579639405829e-01   +5.471697409601235e-02   +4.877914665349067e-02   -9.716968318449497e-02   +1.724213221721102e-01; +3.243224000772992e-01   -4.889564403906296e-02   -3.600152156146207e-01   +1.458356134776319e-01   +2.966992986588686e-01   -1.847020065386892e-01   -6.635201395617221e-02   +2.023490382976107e-01; +1.059377587052996e-01   -3.546922684853210e-02   -6.603786697877156e-02   -3.880701528065781e-01   -7.795758212539768e-02   -1.428185282204343e-01   -1.018934220789159e-01   -2.826719349866801e-01; +8.032768022563136e-02   +2.879018866814326e-01   +1.700061116627871e-01   -4.405807536425891e-01   -2.290194972078018e-01   +1.397291236329801e-01   +7.171260824103194e-02   -1.431770740817046e-01; -4.839925232112084e-01   +2.842626551737544e-01   +2.277988481582539e-01   +1.999651835719381e-01   -3.321110960079269e-01   +1.488363477991229e-01   +1.557638862822801e-01   -3.421359262819106e-01];
L1E_L2E_iAMPA_netcon = [-1.431136889169734e-01   +4.520997478380456e-02   -6.901981408723448e-02   -6.541434549142180e-02   -2.971175322992409e-01   -3.077750673450184e-01   -1.938529725898511e-02   +2.124859778953090e-01   -1.052727773216747e-01   +2.378981231811023e-01   +6.465424737404858e-02   -2.638592960975974e-01   +2.404748851063807e-01   +1.460515676823556e-01   +3.050756567967325e-02   +1.334822302976162e-01; -1.785154582021567e-01   -1.784953247211885e-01   -1.482389851451019e-01   +2.630434818699131e-01   +6.988155717080875e-02   +6.253272753864302e-02   -2.069059772816981e-01   -1.686737743749743e-01   +2.150832559759789e-01   +2.206698197083445e-01   -7.596671048646345e-02   +2.545384256835931e-02   +3.711905179151516e-01   -1.636699281167709e-01   +1.920480596443268e-01   +3.659050547289732e-01; -2.865215288992912e-01   -7.675492490323266e-02   +1.703680696782907e-01   -2.741576984937555e-01   +2.483268862487976e-02   -9.244688707014964e-02   -2.275713506262829e-01   +2.261988955629266e-01   +6.827249527015050e-03   -6.788233910614198e-02   +6.041752252394062e-02   -2.110372354466846e-01   -1.148791687506278e-01   -1.066843765601018e-01   +3.660053767165122e-01   +1.188877131782798e-02; +2.327995509905586e-01   -1.514396147078007e-01   +2.887610995858726e-01   +6.283924134092622e-03   +1.487710331155533e-01   +7.241490622799028e-02   +7.995096099709620e-02   -1.791840313390358e-02   +7.720371113137851e-02   -2.478129453488855e-02   -3.746977183588819e-01   +3.874199739037909e-01   +4.061295689006297e-02   -1.297798551517798e-01   -1.151019400294718e-01   -1.002849606547071e-01; +1.248564099531868e-01   -2.447067833201196e-01   +2.504924031001118e-01   +1.465579578635606e-02   +4.698194266478338e-02   +3.343255545756705e-01   -4.313370593334533e-03   +1.128125706724663e-01   -2.525581142581729e-01   +3.346959905099830e-02   +1.584980903957106e-01   +2.530371162967421e-03   +1.908129026096961e-01   -7.705088401841681e-02   +7.195311464524205e-02   -1.207127700772687e-02; -4.423832025484573e-01   +2.052677317722094e-01   +2.948848944838818e-01   -3.175069635969706e-01   +4.941480620736374e-02   +5.599073747347810e-02   +5.840208458882779e-02   +2.476298272386652e-01   -2.683737698005019e-01   +3.566126130688071e-02   +3.277166393609187e-01   +1.359446749621179e-01   -6.699381664835025e-03   -1.232487023283044e-02   -4.061368097829075e-02   -1.491923212185798e-01; -1.938164443489464e-02   -1.701489861575144e-01   -1.872100948262208e-01   -7.530656929967634e-02   +1.312468946704058e-01   -6.925193220353840e-02   +1.073128836561192e-01   +2.125573924070096e-01   -4.106985779911243e-02   +8.103245467839962e-02   +1.920605225750807e-01   +1.095521144613423e-01   +1.109981135722692e-01   -2.383706220163301e-02   -5.382220299439661e-03   +1.220680837809880e-01; +1.985249757975225e-01   -1.986068312134536e-01   +1.452017780526310e-01   +2.791442972559676e-01   +2.701557106229581e-01   +3.589685973991710e-01   -2.462131143388601e-01   +4.399446753506885e-01   +1.728425516880107e-01   +1.477336913506896e-01   +9.851417089405534e-02   +2.714187929987617e-01   -1.462790608203681e-01   -1.533313824725595e-01   +5.847123073089459e-03   -2.890156508380642e-01];
L2I_L2E_iAMPA_netcon = [+2.556245143663950e-01   +1.204348376018259e-01   +2.585672108191200e-01   -2.158106244944916e-01   +2.599142874987856e-01   -3.863881931809113e-02   -1.806134565474665e-01   -2.046127633596257e-02; -2.107837336070790e-01   +4.922315673766490e-01   +2.594993321020865e-01   +1.982911413927984e-01   +1.560103193613447e-01   +2.069583170006601e-01   +3.573195607229684e-01   +3.167789063429133e-01; +2.321893348928905e-01   +2.728726260684881e-02   -2.727040359636053e-01   -1.157040451680582e-02   +2.944209361898406e-01   +3.194595080787403e-01   -3.532503299523655e-01   +2.280182411986844e-01; +2.463645699749669e-01   +7.424108029358588e-02   -1.981341215051431e-01   -1.918413816111545e-01   -1.585334984721175e-02   -8.215363016926236e-02   -1.949331284380499e-01   +4.599876713167672e-02; -1.855327814611795e-01   -3.516623185439124e-02   -9.743583741161330e-02   +1.329938413493006e-01   +2.272049043300292e-03   -3.722856207148548e-01   -1.588115361650855e-01   -2.706992365540951e-01; +2.063511122182161e-01   -6.310885263038681e-02   +3.056798365080409e-01   +5.086044781096117e-03   +1.949125770103834e-01   -1.866140783615345e-02   +4.200284099436608e-01   -2.782973479049554e-01; -2.558823127502396e-02   +1.422784172627804e-01   -2.174795467677696e-01   -2.154218629193961e-01   -1.493752419353918e-01   -1.044329263657410e-01   -4.277258579786632e-01   -1.089222431582911e-01; -3.981248607664204e-01   -2.336576336685080e-01   -4.721784251122332e-02   +4.125592068747535e-01   +3.825399452748772e-01   -1.665097108240530e-01   -1.481816115687841e-01   +3.507377637082177e-01];
L2E_L2I_iGABA_netcon = [+8.198547617464602e-02   -7.975044871883635e-02   +4.234341471585969e-02   +2.823067094098224e-01   +2.999766289938677e-01   -1.319310609501933e-01   +3.684356546227080e-01   +2.835036022685696e-02; -5.225803081477207e-02   -1.437839014129079e-01   +1.071410848718298e-01   +1.690311664061663e-01   -2.898686227242706e-01   +5.961818887398770e-02   +2.211535085737674e-01   +6.545364514296159e-02; -1.355726532787919e-01   -6.685227469231393e-02   -8.441317506224086e-02   +3.815296320264251e-02   +4.018091716700606e-02   +2.313444332870255e-01   +1.473751616723695e-02   -9.724772964718437e-02; -1.357212753171567e-01   +1.770578934713530e-02   -6.230575560833358e-02   +9.787139918460230e-02   -3.534445015924027e-01   -2.589289789435013e-02   +6.098129139364122e-02   -3.103783773700598e-02; -8.441212324019298e-02   +9.748890559569040e-02   +1.503695728501230e-01   -2.064785221949652e-01   +9.146704393329605e-02   -8.739633517317710e-02   -1.335197071212162e-01   +2.574258927820556e-01; +1.456925230269757e-01   -1.461609137958232e-01   +1.090536042628348e-02   +1.829176186901703e-01   +1.180186807508852e-01   -2.234815355579118e-01   +1.322370834388970e-01   -2.386386478048494e-01; +9.799482877630397e-02   -8.901050706857916e-02   +3.129526419993610e-01   -5.698773064643546e-02   +5.759859851952458e-02   -3.525319623150022e-01   -1.821771919623534e-01   -3.188902378642934e-01; +1.569036117869706e-01   +1.248945200087747e-01   -1.694439372429542e-01   +8.975825442822238e-02   +1.079662040355294e-01   -1.306348419277724e-01   +1.477722694097614e-01   -1.538705376229996e-03];
L3E_L2E_iAMPA_netcon = [+1.101992971352058e-01   -2.567396470382323e-02   +6.716333020172095e-02   -2.137062662337869e-02   -1.834829021584385e-01   +2.562924298414662e-02   +1.144009662971884e-01   -5.861066579168517e-02   +1.796832016228467e-01   -2.295427020973489e-03   +3.310332382926355e-01   -1.829774598867583e-01; +1.368425218049396e-01   +1.677396213607868e-01   -8.649854524595146e-02   -8.566044975605575e-02   +8.910877930496747e-02   +2.673214708917413e-01   -3.765740353156881e-01   +2.163361841823060e-01   -3.111820982915188e-01   +1.236983616782984e-01   -3.277844767422763e-02   +2.493282374101115e-01; -3.364869900477313e-01   +2.651764068109989e-01   +1.417190038124068e-01   +1.071659939719160e-01   -1.461713422831359e-01   +2.375915445982324e-01   -3.362166759607221e-02   -1.871907783084555e-01   +7.130885233089204e-02   -2.790277206977444e-01   +1.914720883912374e-02   +9.519166914405613e-02; +4.675557332901595e-01   -2.019630859521528e-01   -2.313195240022710e-01   -2.184286939695326e-01   +1.668687107290209e-01   -1.826222538045004e-01   -3.343929543514600e-02   +1.256134152497202e-01   -9.082871739589390e-02   +9.068132383369058e-03   -2.086111872502300e-01   +1.461516762132064e-01; +1.333352411209075e-01   -2.055575766036771e-02   -1.333108305662961e-01   +5.145835653731295e-02   -3.145751836600845e-01   +2.117404943199271e-01   -2.128461025556288e-01   +2.495943576289503e-01   -8.190736278581245e-03   -1.808702449078847e-01   -1.219913570191389e-02   +1.207423756904866e-01; -6.609283417434009e-02   -1.947178788310374e-01   -2.657417114448718e-02   +9.319957425478755e-02   +3.169352713590768e-01   +6.997355095468094e-02   +2.610284869232956e-02   -1.059531277953758e-01   +8.894623401329148e-03   +2.207439291854812e-01   -5.250492860550979e-02   -2.203855622757744e-01; +1.644766255778510e-02   -5.930312241933268e-02   -1.996744703522271e-01   -1.850354997090589e-01   -6.044480810402021e-02   +1.794127687221743e-01   +3.543223618320966e-02   -9.363274813700460e-02   +1.812246984752531e-01   +1.267734166394342e-02   -3.229603134679953e-01   -1.555604067034391e-01; -1.210984292355226e-01   +4.442715238579575e-02   -1.451038364919963e-01   -4.415035902450273e-01   +2.631338344799591e-01   -3.706605397864616e-01   -2.568092574689297e-01   -1.066569448779839e-01   -6.407266341648328e-02   -8.158203036392885e-02   -5.110096659956458e-02   +2.790510484596688e-01];
L3I_L2I_iGABA_netcon = [-4.127071682102607e-03   -4.316506219045115e-01   +2.990279318587837e-01   +1.428402972185921e-01   -2.661493187617814e-01   +1.933822198860559e-01   +3.696554595044961e-01   -2.528125195246905e-01   +8.646497376187331e-02   -2.538524447964305e-01   +2.035998588207316e-01   -5.774387124383689e-02; -6.984872665636446e-02   -4.877167822144601e-02   +2.470964426782145e-01   +2.814355884032678e-02   +2.990558206536243e-01   +1.123140256805962e-01   +1.851026361342432e-01   -1.576595842434184e-01   +3.066340652882656e-02   +7.518424665274009e-02   -1.308681603197115e-01   +3.054401512756414e-01; -1.663171309751477e-01   -3.475028679318233e-01   -5.734271686494596e-02   +2.973186414906713e-01   +1.916191719571255e-01   -5.612581293800860e-02   -5.207843240349827e-03   +8.423376559734576e-02   +4.304942966667551e-01   +3.937243948773977e-02   -1.460352495753161e-01   +1.717752864020465e-01; +1.681617284306868e-01   +8.670079352725119e-02   +7.067662708151855e-02   -7.447151242266686e-02   +4.784711892430999e-01   +2.858674250622510e-01   -9.570529198182917e-02   +2.728120448119902e-01   +9.440647150428153e-02   -3.768367975655769e-02   -1.158409674175077e-01   -4.046345289841068e-01; -3.237392563536071e-01   +1.354314508257815e-01   -3.784482336560259e-01   -3.726630710409931e-02   +1.768444596664734e-01   -2.172505559941215e-01   +3.283015555224169e-01   +2.197040635996679e-01   -1.175005199762834e-01   -1.361199897357916e-01   -2.629084494401971e-01   +1.882068150649078e-01; +1.038999950000200e-01   -3.022763103118294e-02   -2.291461357885223e-01   -6.991924939990002e-02   -1.365234473301407e-01   -1.746811995636649e-01   +3.438096768293104e-01   +3.421473122601804e-01   +2.068411584662788e-02   -1.639552827668461e-01   +1.394431649017301e-01   +2.379932982980043e-01; +2.678247022680272e-01   -1.704625957675500e-01   +1.403735375535814e-01   +1.731866602086096e-01   +3.525556584801388e-01   +7.796110131364456e-02   +2.352988376900812e-01   +2.158565408767286e-01   -2.223283425433623e-01   +2.842130157898992e-02   -2.470375455300449e-01   -2.199961719914375e-01; -1.221926337322476e-01   -3.987432885332887e-02   +2.121275652423058e-01   -1.428841392339097e-01   -3.316305581649511e-02   -1.712525527249073e-01   -2.256715781870792e-01   +1.906190464188174e-01   -1.294357743364553e-01   +3.494774981554480e-01   -2.396444452186759e-01   +1.243946810519835e-01];
L2E_L3E_iAMPA_netcon = [+1.113082329342594e-01   -1.323376081445271e-01   -1.031230957781012e-01   +1.713834939427198e-01   -8.606381109642221e-02   +2.298704974417221e-01   -2.384532113075394e-01   -2.110604792747124e-01; +1.885799058923393e-01   -3.194445343631768e-01   +7.071107409519863e-02   +3.246504738341565e-01   -2.180094713953876e-01   -6.421453489551643e-03   -1.021561960383101e-01   -1.470447417674849e-01; +3.702651128858757e-01   -1.123114283492493e-02   -1.553641477005113e-01   -2.505270853217855e-01   +2.132407182100442e-02   -3.703364196156994e-03   +6.362263020747630e-02   +2.582528778699302e-01; -3.386426004255869e-01   +1.723891393039393e-01   -5.279488021657457e-02   +3.749974453330326e-01   +1.520066184592075e-02   -5.400227598029199e-02   +2.072895192264545e-01   +1.021511461906402e-01; +3.442672589886591e-01   -1.309198014479849e-01   +3.106510198334297e-01   -1.013671919207609e-02   -5.009553650784022e-02   -1.890121581729964e-01   +3.938612150028187e-01   +1.073382974302748e-01; -1.542869065839780e-01   -1.313730773441205e-01   +9.432096369076955e-02   -5.002583120635978e-01   +1.692937741234165e-01   -5.516275131767945e-02   +2.645336545808448e-01   +1.488322000666180e-01; +2.049663593737127e-01   +2.508322600260030e-01   -1.763558594694538e-02   -1.135254482714831e-01   -1.728721050643502e-01   +1.892819051896446e-01   -3.324396864184659e-01   -6.673036611812175e-02; +1.217271715067768e-01   -5.220260060353696e-01   +1.968976782860429e-01   +1.233366512365988e-01   -4.514282828200979e-02   -2.151587128024797e-01   +1.354187042646527e-01   -1.888256612537376e-01; +2.120482096490737e-01   -1.590708991283379e-01   -1.640715827480284e-01   -1.205692160315559e-01   +3.845563046925332e-01   +3.086833906478997e-02   +2.445086785874765e-01   -7.198542224439872e-02; +2.003797040892108e-02   +7.337849573780200e-02   +1.589035586148725e-01   +2.238718414505433e-01   +2.405277521497782e-01   -1.001499338324697e-01   +3.286598732022156e-01   -1.146620695234642e-01; -2.479968295266036e-01   -4.017058387658478e-01   -3.709277845519018e-01   +2.543416449794895e-01   +6.885340458073326e-02   -8.174271336146136e-03   +2.494225551207936e-01   +6.121994232954575e-02; -1.550161635274841e-01   -7.844854354996011e-02   -2.238849140043405e-01   -2.926724769006113e-01   +2.561536496054302e-01   +2.184641466069266e-01   -1.369710310002964e-01   +1.225965518867460e-01];
L2I_L3I_iGABA_netcon = [-2.225287791112191e-01   -1.479417787645658e-01   +3.327015187675516e-01   -8.928794783143226e-02   -1.939209111673150e-01   -1.403793858252433e-01   -2.635627437087101e-02   +1.816875784060994e-01; +1.779955622150942e-03   -1.488159794167093e-01   -1.354276530353250e-01   -1.121255068178771e-01   +1.930094067886558e-01   +2.209182512399607e-01   -2.522348898046594e-01   -3.099442759948911e-01; -9.164486392135937e-02   +6.203352590920921e-02   -5.565719766921537e-03   +2.697577796725564e-01   +2.233133598870466e-01   -5.428138315592395e-02   -1.466687334989441e-01   -1.995852939137407e-02; -1.677487239205949e-01   -1.304402514779183e-01   -2.532243644629548e-02   +2.175614688198704e-02   -1.552019474203738e-01   +5.987039858470702e-02   -3.434232508833796e-01   -1.562952761655527e-01; +7.085976725580832e-02   +1.924274397677599e-01   +1.252614639043026e-01   -7.852602055528463e-02   -1.704259426258382e-01   +3.665983755303636e-01   -1.405060221327223e-01   -2.880568460320775e-01; +8.888869913491725e-02   -1.043879040893162e-01   +7.788973937181837e-02   -2.424419517078578e-01   -1.073490129830097e-01   +4.134959070302410e-02   -9.530281714901917e-03   +2.262495226508922e-01; -3.223395143589897e-01   +8.961271523819531e-02   -1.381991882583734e-01   -2.408646158675486e-01   +4.722728068908198e-02   +2.058184631710800e-01   +1.529892417965720e-01   -3.745466063583661e-02; -2.116029266843129e-01   +3.271425766003659e-01   -1.862409182670497e-01   -8.331624904339639e-02   -2.215010326425595e-01   +5.467290366634253e-02   +1.042515456421799e-01   +3.241226883821924e-01; -2.243417681188480e-01   -2.344001715632057e-01   +5.549514408846955e-02   +1.534633216406672e-01   -2.484658788890069e-02   +1.744609856786777e-01   -1.480118555562273e-02   +2.639691910938657e-01; +3.947952606100999e-01   -2.264994621293700e-01   +3.257596344330488e-01   +1.784445933508033e-01   +1.442595985876809e-01   -1.362682174584920e-01   -1.171970231795653e-01   +8.308678765977245e-02; +1.514965876995160e-01   -1.986556169166924e-01   -2.967294047850691e-02   -3.405401024765856e-02   -1.395651085471234e-01   -4.452405361265403e-02   +3.498370765713847e-01   +3.149265458929801e-02; -1.133185335703709e-01   +5.846763234297646e-02   -6.800474248785604e-02   -3.719080368072640e-01   +1.484059982781064e-01   -1.434478025707848e-01   +4.530839731539802e-01   -2.230646712228324e-01];
L3I_L3E_iAMPA_netcon = [+5.873224306348859e-02   -6.708337189054778e-02   +1.479804460760847e-01   +1.550049754253130e-01   -1.131584556634418e-01   -2.089535284195915e-01   -3.754729816594076e-01   +2.864863997737984e-01   +1.662177560595517e-02   +2.161740203481722e-01   -1.812882369171230e-01   +2.224144731212892e-01; +4.776583990642229e-02   -1.409910246603207e-01   -4.678493392583077e-01   +1.220527962246841e-01   -1.719133345249763e-01   -6.288333726259299e-02   -2.395061748430085e-01   +2.455573043081924e-01   +6.193332610999408e-02   +2.919661712740577e-01   +4.089547678862966e-01   +3.203024886537092e-01; -1.454859002384782e-01   -2.474148482176970e-01   +1.219029052412745e-01   +2.514896489166699e-01   -5.385082195133593e-02   -1.635747207339614e-01   -7.145975710373056e-02   +2.599009532565468e-01   -1.284606142712072e-01   +2.528492505087233e-01   -1.711287521433595e-01   -7.456967483137386e-02; -1.228508549425389e-01   -1.780837587028848e-02   -2.217951039193657e-01   -2.704798845282876e-01   -1.189537068486545e-01   +6.731708648832987e-02   -1.098407147703472e-01   -3.368565917604373e-01   +8.758857787478959e-02   +4.344139322781229e-03   -1.795310464169911e-01   +2.051602500834451e-01; -1.881463838594766e-01   +3.705042294176676e-01   -6.308183039235787e-02   +5.858124972684467e-03   +1.355575214193783e-02   +7.721162191485439e-02   +3.242110623326060e-01   -2.698830889456558e-01   +1.216394416711069e-01   +7.266373346010696e-02   -1.295949970321001e-01   -7.892271801179758e-02; -1.451644936062070e-01   -7.557537710555605e-02   -3.179015246149872e-01   +5.955785376544117e-02   -2.704873387340925e-01   +3.395587146745623e-01   +1.446691780472962e-01   +2.966420168639163e-03   -2.202191050819781e-01   +9.222911620154942e-02   -1.127036185429250e-01   +4.424127781121566e-01; +8.343019262757696e-02   +5.068620640381531e-02   +1.299753801040765e-01   +1.627279163350425e-01   -3.187437122841050e-01   -1.610779823849960e-01   -1.726668167165342e-01   +3.051626363809795e-01   -6.962873664283560e-02   -1.295863222931654e-01   +3.505545727913005e-01   -4.255418196383485e-01; +3.054391761568515e-01   -3.038846795864366e-01   +2.132856321156727e-01   +5.704797111581746e-02   -1.013491276118316e-01   +2.132311253529218e-01   +3.480390711078023e-02   +1.345889782819635e-01   +1.521706056551833e-02   -6.864994468439428e-02   -1.348465170959329e-02   -1.958772000116185e-01; -2.632177533631553e-01   -3.883637874219472e-01   +2.742617843318796e-01   -1.995911084058990e-01   -1.650642245635560e-01   +6.533432287217170e-02   +1.913581737944584e-01   +6.223579621697750e-02   +2.904947444132486e-01   -3.661359870264980e-01   -1.703706219936535e-01   +1.364939962869432e-02; +7.732501943683812e-02   -3.314563213884688e-01   -2.910936507393924e-01   -1.534961456406488e-01   +7.954726184252739e-02   +1.368547536720751e-01   -3.009540207393447e-01   +1.320911789321957e-01   +7.912845666009090e-03   +1.617764362596517e-01   +1.206131310973589e-01   +8.661165121043497e-02; -1.674931726995209e-01   -9.470292211335929e-02   -2.385351623821450e-01   -3.528043066901314e-01   -1.085303070944965e-01   -1.901021228308125e-01   +5.147861888293565e-02   -1.273330014386024e-01   -1.378777360321271e-01   +1.800273585197490e-01   +3.573040810092571e-01   +1.265549597864038e-01; +2.946636296243992e-02   +2.367998882146043e-02   -1.407881537050735e-01   +3.242821447655840e-01   +1.468965565424238e-01   +2.575321652148188e-01   +6.969606996954904e-02   -8.370493982479060e-02   -1.148626367179090e-01   -2.625953138277421e-01   -2.707705743969253e-01   -3.276723308204343e-01];
L3E_L3I_iGABA_netcon = [+4.509332572011510e-02   -3.446183071843709e-01   +3.510887628853420e-01   -1.375566823528608e-01   +1.698569705806365e-01   -8.653720693689734e-02   +4.721084778060859e-02   +4.925868071415179e-03   +5.008701474082319e-02   -3.455573422685438e-01   +4.776799792258937e-02   +2.085600838042521e-01; +7.903857994701723e-02   +7.653944290399020e-03   +3.658721114177192e-01   +8.830706358870621e-02   -4.020755323812815e-01   -9.035167251919046e-02   -1.076712381856769e-02   -8.605229238149439e-02   -2.023549649014949e-01   -4.600940155816040e-01   -1.776823957384991e-01   +3.294687532451882e-01; +3.857936657539665e-01   +9.220284129057640e-02   -1.684942085549218e-01   -7.022543426912151e-02   -3.746039728395294e-01   -4.876521222463442e-02   +1.943102992868574e-02   +8.201484086872809e-02   -4.018647491249301e-02   +2.492895345428722e-01   -8.273158637974662e-02   -4.670804660365318e-01; +1.349588824370774e-01   -1.028422809187084e-01   +1.981188242882237e-02   +6.416765517942805e-02   +2.246112042548419e-01   +5.224230279514180e-02   -1.179083674253405e-02   -1.494023056618302e-01   +2.080914916748221e-01   +2.718320989536587e-01   +2.535640715205094e-02   +1.259888509715801e-01; +1.596559643953246e-01   +6.714366349297016e-02   -3.226181988530202e-01   +9.965832476149394e-02   -1.904820372246307e-01   +3.269245176619389e-01   -3.743146079596261e-01   +1.013026226122884e-01   +2.417626237243836e-02   +7.220667471982932e-02   -1.146409135748653e-01   -9.596633062050264e-02; +1.937790120241427e-01   +1.251190970702659e-01   +2.511863488264138e-02   +2.027779445293630e-01   -2.500927395878685e-01   +3.055500249718976e-01   +1.073028385820933e-01   +2.218653906296756e-01   -9.256708101722963e-02   -1.307789265890717e-02   +2.718532614755488e-01   +5.110051607288921e-01; +3.385252650565046e-01   -1.006273522847047e-01   +1.254648146464522e-01   -6.446705379749595e-02   -7.040257743473763e-02   +1.938439353131293e-01   -2.015575551489926e-02   +7.448858412130316e-02   +2.269374082378929e-01   -1.257078329388287e-01   +1.305365321527305e-01   +8.097998404961215e-02; -2.210956587260426e-01   -1.022149056729290e-01   -1.135084539265836e-01   -7.241319984965555e-02   -1.837529448399347e-01   -5.322267216831387e-02   +1.940656948218908e-01   -8.227845522048929e-02   -3.331011224544024e-01   -3.675802415839663e-01   +2.159657582369519e-01   -1.327190936140107e-01; -5.561871330205394e-02   -3.875282048269803e-02   +1.079257968094974e-01   +3.174126959691801e-01   -2.396616788528776e-01   -1.482782713513246e-01   +1.843812040403436e-02   +2.959358516631948e-02   +6.590086297286477e-02   -3.261234558799014e-02   +2.593885715421290e-01   +3.364740261080649e-01; -3.292780139308464e-01   +1.473539416987486e-01   +1.884572703107346e-01   +2.126932308477036e-01   +1.010754882988011e-01   -2.254807521702821e-01   -1.629561885660721e-01   +2.947324297919357e-01   -2.656948728850134e-01   -1.713728997021628e-01   -5.000219769427063e-02   +1.769210758591064e-01; +8.282839314312139e-03   +5.794062821293086e-02   -9.734884350970030e-02   +3.247614856290378e-01   -4.405597188314406e-02   -3.885894808849735e-01   -4.167579865376875e-02   -4.707940915969085e-01   +7.537967787688632e-02   -1.068339586477340e-01   -3.144091924248785e-01   +1.983126949705766e-01; +2.740961846009465e-01   -7.950293842321524e-02   -1.184602336654486e-01   -1.508661137678209e-01   -4.267462433682665e-01   +4.430152545088964e-01   +1.068332599988448e-01   +1.417651083940563e-01   +9.789514703234688e-02   -3.964810947372327e-02   -1.892446670783589e-01   +1.979601900465102e-01];
L2E_Input1_iAMPA_netcon = [-2.371103681844696e-01   +2.103436574991307e-01   +1.023271092426538e-01   -1.680658479618851e-01   +1.326789657280361e-02   -2.609646654588105e-01   +3.930335059887774e-01   -2.200955621750706e-01];
L2I_Input2_iAMPA_netcon = [-1.509378286756442e-01   -1.582303748410244e-02   +2.521063015384616e-01   -2.709931638606568e-01   +1.670340456847410e-01   -1.619342524828050e-01   -8.272797291782834e-02   +4.544557478338223e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
