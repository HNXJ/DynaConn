function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.592076871669598e-01   -5.234931865996071e-01   -4.648341805103470e-01   -1.086489007859416e-01   -2.281906686984826e-01   -5.625980336233581e-01   -1.021378760349720e-01   +3.066820417981593e-01   -3.095305197619845e-01   -1.534790809835541e-02   +5.267590581206864e-01   +1.056331330441709e-01   -4.203483144064805e-02   +7.130295182205274e-01   -2.217470280783078e-01   +1.621337544934416e-01; -3.857475380314496e-02   +2.064690347556176e-02   -2.988739665094031e-01   -8.476912840740646e-01   +3.766417210693048e-02   -5.355631910078441e-01   -2.484396696916666e-01   -3.013276299202603e-02   -3.866029162219571e-01   -3.531245427909297e-01   +1.705521800163333e-01   -5.436678722539150e-01   +2.110834435379215e-01   -4.216815365964728e-01   -2.313382613543781e-01   +1.919057198706056e-01; +3.623777041387741e-03   +6.341193593317338e-01   +4.405591700197228e-01   -2.215422850134216e-01   -2.492771260057416e-01   +8.216085173606258e-01   +4.170091820509226e-01   +7.913168655243972e-01   +2.072001070582648e-02   -4.990177357820198e-01   +3.740433426080882e-01   -2.318501377837368e-01   +8.484143834716079e-01   +7.360079337212041e-01   -6.862623584513500e-01   -1.597318648996104e-01; -1.211903137692188e-02   -3.514086449213524e-01   +3.161172115164409e-01   -2.263175604954023e-01   -1.764601319164047e-02   +6.214408942432608e-01   -1.397148099295817e-01   +1.326250206370079e-01   -1.374793809871989e-01   -3.558487485881800e-01   -3.093552979562305e-02   -3.578747747538943e-01   +7.768475828566140e-02   -1.222036645239458e-01   -4.543084299696583e-01   +7.459805686140621e-02; +6.633158538298648e-01   +4.475276900498394e-01   -3.777300905396119e-01   +3.028948030472853e-03   -8.926699487406710e-01   +5.093350707182654e-01   +2.313190615287308e-01   +9.971947671681575e-02   +4.082954305503966e-01   +2.052770607927888e-01   -6.866682440307298e-02   -7.146776131864496e-01   +5.079324338467909e-02   +7.067508605697526e-01   +3.379768932901798e-01   -7.514927350605121e-01; -1.346227744550210e-01   +4.279723779889710e-01   +1.900146773931328e-01   -1.849974534071296e-02   -9.040986864776255e-01   -3.761968597191940e-01   +1.077308268104794e-01   -3.545887169074349e-01   -6.471951486962795e-01   +3.345658438574087e-01   -5.346177239450621e-01   +5.139869233264659e-01   +3.072751687864665e-01   -1.641595185830391e-01   +8.555589079862083e-01   +2.451907131940164e-01; -4.791813111111513e-01   -2.235355600107943e-01   +1.917474847407704e-01   +2.900257748906019e-01   +3.136247308162103e-01   -5.841962207951138e-01   +2.518961042106284e-01   +3.696995188325943e-01   -6.479711906169326e-01   -1.504929285403893e-01   -3.867774187144163e-01   -6.207934330597397e-04   +4.393530055544359e-02   +4.893279788719013e-01   -2.650797073570249e-01   +1.494812614702429e-01; -2.113114975785362e-01   -5.036261049422230e-01   +2.681875096496291e-01   +6.411285624557456e-01   -1.049855026690837e-01   -1.449541778820614e-01   +8.715570108993823e-03   -1.000000000000000e+00   -6.035549239701152e-01   -2.165015652817795e-01   +7.979877821276800e-01   -9.766206815716481e-02   +3.818173828078868e-01   -7.386756521899579e-01   -2.106744110602553e-02   +4.684764866412659e-02; +1.027306826972214e-01   +3.554872294438974e-01   -3.385696137175360e-01   +2.112466082476360e-01   +2.782964696311234e-01   -1.976255666554189e-01   +3.525459639429043e-01   -8.495585506756292e-01   +1.257032017884165e-01   +2.088682141294063e-01   +6.376088102388786e-01   +2.155940777742578e-01   -6.926502759973355e-01   -2.539053896563472e-01   +9.265314904017728e-02   +2.293794478318424e-01; -3.542371287350347e-01   +4.137821442115825e-01   +6.298447327406745e-01   +4.729286872227505e-01   -1.369766829895140e-01   -9.158895252369356e-02   -5.056568019878842e-01   +6.581372041544029e-01   -3.113246709614935e-01   -8.947603067226561e-01   +3.364758508519530e-01   -2.688531737704717e-01   -3.549055512542580e-01   +7.086599470673610e-02   +1.459418572647660e-01   +3.036771843167088e-01; -2.170340137624582e-01   -2.170484328766974e-01   -7.395127847730683e-01   +8.916557588912178e-03   +2.016998486770486e-01   +6.917825614584907e-01   +5.585683324934230e-01   +8.359970521188175e-01   -3.699671325604704e-01   +5.404333825311618e-02   +2.203842375833463e-01   +2.713992702064232e-01   -5.411974097628436e-01   +1.310661016582724e-01   -2.112633681431305e-01   -5.827688968449726e-01; -1.158523375532508e-01   +3.366346831771927e-01   +8.093511591006701e-01   +8.886218306189293e-01   +8.102690832359452e-01   -1.133057807848693e-01   +3.576884632031725e-01   -1.935897664586758e-01   +5.150644896289636e-02   +6.124453671487011e-01   +7.289747019924818e-02   +1.043157404159298e-01   +6.659892756690124e-01   -8.357747280130930e-01   +4.488484470231621e-02   -2.511384173636451e-02; -2.046446909512405e-01   -5.368675229011882e-01   -1.472766081627518e-01   -5.564850421256462e-01   +1.430827333438170e-03   -7.052794796336993e-02   -5.756931783113454e-01   +7.324114758363505e-01   +7.411200176834536e-01   +5.640091346665944e-01   +4.735630005790809e-01   -4.039001110367782e-02   +3.725236493744931e-01   +3.298520428118024e-01   -2.142530556969048e-01   -5.675462041925866e-01; -3.976299928066081e-01   -1.248515746354609e-01   +5.952870927825578e-01   -5.322936277631329e-02   +7.017904163136343e-01   -6.106890074437018e-02   -7.602239766003083e-02   -1.101772814645253e-01   -2.719930002970098e-01   +1.251753827372422e-01   +6.459648257929299e-02   -2.143723747200329e-01   +2.948627042947721e-01   -1.245878908822615e-01   +9.921537232886472e-02   +9.231529754601150e-02; -1.243406571948020e-01   -1.473990016442906e-01   -2.365367099476792e-01   +2.340386420570369e-01   +7.926261658104272e-02   +7.627853357194582e-02   -6.663853974791702e-01   -3.866398792648461e-01   +6.426963650529590e-01   -9.453590565327381e-02   +7.609024841487027e-01   -6.612134484568302e-01   +5.095698642228735e-01   +1.223831784911229e-01   -4.940020489126829e-01   +1.563079490608003e-01; +1.933324775303639e-01   -2.338022403718187e-01   -2.908292156020354e-01   +6.131381941909724e-01   +1.489127008144083e-01   +3.865797291221149e-01   -9.162545934482311e-02   -8.988210169325825e-01   -4.276841669951327e-01   +7.134545988414612e-01   +2.515900780209548e-01   -4.058885420817465e-01   -6.949311126958292e-02   +1.392241792821661e-01   +6.388875314752258e-01   -6.259496903975582e-01];
L1E_L1I_iGABA_netcon = [+3.895785652293541e-01   -3.148598500143761e-01   +9.211829529812068e-01   +5.712442234399815e-01   -4.792899552765514e-01   -2.451241627902274e-01   +2.019208998482930e-02   +4.442697359340967e-01   +1.000000000000000e+00   +7.348897408923007e-01   -1.293836233663724e-01   -4.503526159109637e-01   +1.113522770521364e-01   +2.259066047893465e-01   +2.124639106560376e-01   -3.870812516143289e-01; +8.862844240811035e-01   +4.908867114913146e-01   -3.812222727325891e-02   +4.924954450477978e-01   -5.198934257220182e-01   -6.685425881432424e-01   -3.285176627874524e-03   +1.284883053926213e-01   +3.461257279675220e-01   +2.897550022926709e-01   -5.360351386079441e-01   +2.999336407989604e-01   +5.198167551549492e-01   +2.674810251919590e-01   +9.749656383475933e-02   -5.240816003206988e-01; +2.323356615843526e-03   +1.264115909557652e-03   +3.240005110259229e-02   -3.018017900452422e-01   +1.340375402387351e-01   +2.103328115794848e-01   -1.291475755512896e-01   +1.990564360603879e-01   +3.050382007218487e-01   +1.401504618600529e-01   +3.675140240848397e-01   -5.042156177146446e-01   +3.131133655763899e-01   -1.449677296178680e-01   -2.834083016828715e-01   -6.372666949319623e-01; +2.388646863431003e-01   -4.241239657037291e-01   +1.617666089423454e-01   -7.189994974440393e-02   +2.065557529471020e-01   -4.656235673424887e-01   -4.306263446840333e-02   +5.232264661186481e-01   -7.519458182227412e-02   -4.893958695362022e-01   +4.019442190415878e-01   +1.223171895510762e-01   +4.722170791529797e-01   +1.460849755711922e-01   -2.422111824344449e-01   -5.868528194073943e-01; +4.680132228936295e-01   -1.198169786034292e-01   +2.534899046958700e-02   +7.147744364576134e-01   +5.184413610129739e-01   -1.105408337170268e-01   -2.161511281396217e-01   +5.438147856804281e-01   +1.765128589538823e-02   -5.989673535564514e-01   +2.424552209025169e-01   +1.349215237483438e-02   -7.659054066345056e-01   +7.432113930393102e-01   +1.601298546087809e-01   +3.565418792209395e-02; -3.867178129192990e-01   -1.255968302947477e-01   +1.661883243990281e-01   +7.021284579910767e-01   +4.033325027646605e-01   +8.661201997977094e-02   -3.318607854149642e-02   -4.891390959044728e-01   +1.615578751024075e-01   +1.707903183522296e-01   -2.391060646098397e-01   +1.853046551407611e-01   +2.970131168556449e-01   +5.828137152485314e-01   +4.071772831629512e-01   +5.433096756973668e-01; -4.538770186713236e-01   +4.479667967776358e-01   +7.540483539468304e-02   +1.726666155180654e-01   +6.276425359346456e-01   -3.840348474059602e-01   +1.073546117212664e-01   -3.940787306943120e-01   -1.015173133147176e-01   +2.723571221472117e-01   -5.309144302100859e-02   -8.225984696790436e-01   -6.192610645491637e-02   +4.595945302140176e-01   -1.059415564146724e-02   +2.520104775701949e-01; -6.331304621466591e-01   -4.402085119238657e-01   -1.232213503343238e-01   -2.429529873054261e-01   -2.311195897241761e-01   -4.915528255997106e-01   +5.702648888072549e-01   -8.309465964668571e-02   -5.178901349212929e-01   -1.787853595890986e-01   -1.119941770552496e-01   +2.462116374482451e-01   +2.438278766170970e-01   +5.799773968040224e-01   -4.666012118494162e-01   -7.325595816734162e-02; -5.241775238560009e-02   +2.059841676913697e-01   -3.812327449552083e-01   -9.176439853725418e-02   +3.910007671893223e-01   -2.036436637676801e-01   -2.722238895766386e-01   +1.425588952382728e-01   +4.089022792013757e-01   +6.706432432582654e-01   -1.430648945325569e-01   -7.210951233846798e-01   +2.546656794455095e-02   +4.360207191610397e-01   +3.630026306257581e-01   +6.108784694402578e-01; -2.192412225328270e-01   +2.815821107072192e-01   +8.649224726583264e-01   -7.021446987102416e-03   -5.699057504059905e-02   +7.142799331762744e-01   -1.363832461970519e-01   -3.991753415647848e-01   -9.003212204694661e-01   +3.454355616572357e-01   -3.900276977621499e-02   -3.755298206679534e-01   +2.350451178614365e-01   +7.376232258377709e-02   +2.101224484472514e-01   +1.437024545822294e-01; -6.138469894210113e-02   +3.597204568542373e-02   -3.721724165585919e-01   +1.302448744003251e-01   -5.494531186723823e-01   -7.356878558456105e-01   +3.467005603995994e-01   +2.186850673393832e-01   -5.154905623394304e-01   -5.491730503547294e-01   +6.294385945944111e-01   -1.221241247938032e-01   -5.145496250705753e-02   +2.444000260359921e-01   -3.307614856107072e-01   +1.451206079490222e-01; +4.542039508307683e-01   +4.721916587452142e-01   +3.455027337393368e-02   +4.604555619929103e-01   +6.029272652233125e-01   -1.238033145729738e-01   +3.207459988292451e-01   +7.683422072751510e-02   +4.192994590322194e-01   +2.381864291472230e-01   +4.082511941664476e-01   +4.052598217289418e-01   -5.601677333417282e-01   -3.232744447567897e-01   +1.297969866656808e-01   -3.524948866147875e-01; -8.151529646879693e-01   -5.876663368250237e-02   +8.831801303978150e-01   -1.982833320722522e-01   -3.745809270510050e-01   -5.579951430661505e-02   -5.449595797356813e-01   -2.624280357613420e-01   +5.940903848735967e-02   -2.479283565608227e-01   -2.031105395729957e-01   -1.562147195098164e-01   +4.995523961587880e-02   -1.779337020688798e-01   -5.073242382797853e-02   +3.373086961339510e-01; -2.556856487958951e-01   +3.475990233097714e-01   -4.409030573457548e-01   -7.164462744608995e-01   +1.606456889853726e-01   -2.637371035766002e-01   +1.015925673584608e-01   +5.052224914590165e-01   -3.661955985313398e-02   -2.938174159913773e-01   +3.830465865341637e-02   -2.521737692740230e-01   -6.495949003828119e-02   +3.834134650331144e-01   +1.221023713418466e-01   -2.047699416053221e-01; +1.900506646405258e-01   +6.587812687493824e-01   +2.392873455128364e-01   +3.179654174532792e-01   +3.794997123576958e-01   -3.545358305006789e-01   -6.664577182452754e-01   -7.250945095179351e-01   +6.393323401181196e-01   -6.091490755777236e-02   +5.472046300365107e-02   +3.226775109104853e-01   -5.077811298883341e-01   +6.326859086820322e-02   -5.098040629797067e-02   +2.431477704768623e-01; -8.135575444171247e-01   +1.689393480750660e-01   +2.879951230850602e-02   +2.122548570664905e-01   -1.538783869006500e-02   -4.577762115256790e-01   +1.338288017196425e-01   -5.317221259514673e-01   +1.171531766198221e-01   +5.481472612807385e-01   -2.003627703155522e-02   +1.961216631572605e-01   +7.272452672027040e-02   +4.167383173991031e-01   +2.319027680625139e-01   -2.901796608388860e-01];
L2I_L1I_iGABA_netcon = [-6.424948686433058e-01   -3.469826312086770e-02   -3.443580694535787e-02   +1.161488326238835e-01   -2.582986583269043e-01   -4.140817430816045e-01   -2.841418291234293e-01   -1.707406434601584e-01; -2.011838345196147e-01   -5.432584377032889e-01   +4.116899343564614e-01   +8.656606280821421e-03   -5.287815993268374e-01   +4.509345581314882e-02   +2.652708107127553e-01   -1.462319043208009e-01; -5.922190735457256e-01   -4.135562781506212e-01   +4.131932045463408e-02   +7.728205079465286e-01   +7.410257572574029e-01   +3.467322519103093e-01   -5.981437372711756e-01   -7.235671411276327e-02; +3.472662546853871e-01   -3.430622487547071e-01   -2.234054649053940e-01   +7.545359257013269e-01   -4.992432379394702e-01   +1.000000000000000e+00   +3.140351818295951e-01   +4.068778049868137e-02; -7.450006102820940e-01   -5.248053911894354e-02   +2.167286958869953e-02   -1.362918735114248e-01   -2.944651304071202e-02   +1.074140998324541e-02   -8.832850257534329e-02   +3.974833235020037e-01; +2.651316501322603e-01   +8.227234071167739e-01   -8.230081291708904e-01   +1.751748668093522e-01   +5.156411033865876e-01   +1.849711197646678e-01   +4.449036758196052e-01   -6.949348136401685e-02; -1.059279049229461e-01   -2.373119598043857e-01   +1.636181472431827e-02   -9.206841363086391e-01   +4.777741509531809e-01   -6.983316042028637e-01   -1.709324429459869e-01   +1.949763879028634e-01; -3.168421275259279e-02   -4.658585970735617e-01   +3.512845442027916e-01   +1.167926550676973e-01   +5.596734570739713e-02   +2.341783072045241e-02   -4.237829396777463e-01   +1.460270850453813e-01; +1.476614473895694e-01   +2.767836809011285e-01   -5.436719527459865e-01   -1.761767446787619e-01   -1.373137664928853e-01   +7.882759167392221e-02   +2.596192266612379e-01   -3.516393973834591e-01; -3.554041239123442e-01   +6.968565004458467e-01   +5.786468617853053e-01   -6.895613214579427e-01   +1.553377195843702e-02   -8.541305201206122e-03   -1.966366407016913e-01   -9.272096988285973e-02; +1.355937040233079e-01   +2.278736276052913e-01   +3.103550979744996e-01   +1.714615278812444e-01   -1.597034095372860e-01   -1.126635256729115e-02   -5.280427582531660e-01   -1.005961233634331e-01; +1.508324448307642e-01   -2.383091206678338e-01   -1.547729226630447e-01   +6.952075798671396e-02   -1.426427298636810e-01   -3.444616003785403e-01   -8.323547869878003e-01   -3.711607779963099e-01; -2.413896745399443e-01   +1.310579894740402e-01   -2.657980982959074e-01   +4.261484369300199e-01   -4.832942491418705e-01   +3.075306836683915e-01   +2.604651259295149e-01   +4.302400068153311e-01; +6.266835852598223e-01   +2.763496686079513e-01   -4.093218324353076e-01   +1.614962428371713e-01   -2.593754546919820e-01   -4.747800123274736e-02   +3.663174052139417e-01   -3.454278880735853e-01; -7.586989835828896e-02   -9.267824194876978e-02   +8.793980226436870e-02   -3.289206364188602e-01   -7.821577626105011e-02   +2.384193123164668e-01   -1.508951246648290e-01   -2.931292062926793e-01; -2.501055362282262e-02   +3.612953365293828e-01   +7.173434564664592e-02   -1.618185575928536e-01   +8.233457930160480e-01   -1.297986333648815e-01   +2.525718200064257e-02   +4.124286903833364e-01];
L1I_L2I_iGABA_netcon = [+3.443875071625201e-01   +2.832901486795554e-01   +4.063542840057314e-02   +4.281573118349785e-01   -1.496073303426099e-01   +3.920094475315467e-01   +2.157246044301889e-01   +6.778675053469256e-01   +2.639485755893953e-01   -3.568742329527718e-01   +4.068544094445370e-01   -1.133796938044672e-01   -2.292002426685201e-01   +8.157427992927611e-01   +8.825889656761936e-01   +7.969700766240911e-01; -1.107085450565940e-01   +7.780587027987448e-02   -1.849126512973809e-01   +3.857347869544293e-01   +4.723143836649097e-01   -7.518393210055302e-01   +3.374416311301154e-01   -4.630215746058116e-01   -4.479565215597561e-01   +2.835167866040368e-01   -5.446239585162808e-02   +5.466988893977400e-01   -6.160688071527517e-01   +7.301677019566984e-02   +6.129918066833683e-02   -1.233410750009132e-01; -4.124160797976985e-01   +2.999382149230285e-01   +1.214168619977657e-01   -4.941697887087124e-01   -9.179357671432851e-01   -7.177583673361715e-02   +4.826976993850460e-01   +1.128051811523035e-01   -5.276027027548339e-01   -8.093318590909326e-02   +7.686389255185687e-01   -2.329526958287814e-01   +7.482392614246852e-01   +6.727771204656216e-02   +1.104184698208215e-01   -5.449432450985378e-01; +8.240979158510950e-02   +1.439784622750692e-01   -3.235016360907975e-02   -4.382260997184269e-01   -2.644189833994015e-01   +5.413844817151713e-02   -5.019347545356377e-01   +5.161400755264937e-01   -7.632075109707968e-02   -1.502281622686938e-01   -5.872127784404382e-02   -4.043104267859691e-01   -7.168716531124631e-01   -4.225671500968819e-01   +1.608965230926520e-01   +2.350859554681139e-01; -1.248439337584131e-01   -4.696005255452402e-01   -1.524720081432792e-01   +6.437084160057600e-01   -6.343353099826914e-02   -3.901790266783632e-01   -7.199904137622957e-01   -4.367571685475293e-01   +4.094654461963774e-01   +1.535300960365510e-01   -7.637504618356430e-02   -5.847022807930280e-02   -8.508529841186880e-03   -3.233347971184996e-01   -1.625324921253035e-01   -5.387148562689876e-01; +7.940524183875871e-01   -9.585141597468126e-02   -2.887955188042057e-01   -7.889426941754821e-01   -6.631211677108820e-02   -6.700953560304490e-01   +1.874906831067994e-01   -2.412107712165661e-01   -1.205569085811004e-01   +2.476997727435452e-01   -5.270045738859913e-01   +6.712586321761855e-03   +5.957046248971189e-02   -3.231299467893954e-01   +1.269120961339213e-01   -2.930913782910322e-01; +1.460157673555368e-01   +5.428001773657403e-01   -5.845733177431816e-01   +4.824114595632854e-01   -7.403438446429664e-02   +1.555669724819659e-01   -2.282422639052513e-03   -5.367944028571543e-01   -4.506932029425356e-01   +6.769296240613553e-01   +3.685666085187432e-01   +1.681442668885140e-01   -1.577049715508848e-01   +2.871395341428737e-01   -1.537691241322643e-01   +8.259723995433871e-01; +2.714933847744464e-01   +4.535887708517002e-01   +8.582080290828945e-01   -1.735480572915318e-01   -1.858571110665117e-01   -6.899387634230117e-01   +2.054447873591126e-01   -6.697782822632466e-01   +1.608869917208569e-01   -1.000000000000000e+00   +4.713587658581158e-01   -3.470785249691801e-02   -3.250547679849081e-01   +5.800317228259659e-02   -3.813145761529658e-01   +1.081498080087171e-01];
L2E_L1E_iAMPA_netcon = [+3.093243738987425e-01   +1.359241543864525e-01   +2.973601228829270e-01   -1.184080446681315e-01   -1.977661962112026e-01   -5.085678727975937e-01   -1.067383262191953e-01   -2.503702642823861e-01; -2.370662747413591e-01   -2.707479551407144e-01   +3.086089139523568e-01   -1.971248361965053e-01   -3.735499239169680e-02   -1.615858092936369e-01   -2.259970588011447e-01   +5.235653960832507e-01; -3.146244922278368e-01   +1.601840629842088e-01   -6.466630037404143e-01   +2.793701911433262e-01   -6.229692812051950e-01   -8.348315268611169e-01   +3.929648874133509e-01   -4.215649288522623e-01; -2.862397862872544e-01   +2.490590505943271e-01   -3.083541892257381e-02   -3.866865643667985e-01   -7.927020302499362e-03   -1.059657391628411e-01   -1.452337230247142e-01   -8.051945408437400e-01; -2.532109597083075e-01   -1.651979840931266e-01   -5.742603678122374e-02   -4.046349311233282e-02   +3.330518193086866e-01   +1.168286663355212e-01   -3.700423716915330e-02   +1.251624424299484e-01; -4.165790459571020e-01   +1.804030407487413e-01   -3.722405987107805e-01   -8.593610058114567e-03   -8.954003546319640e-01   +6.169424835414443e-01   -1.839514719623125e-02   +5.303177802130254e-01; -1.031282120149929e-01   +9.118074706374429e-02   +5.218231955383142e-01   -3.790691316091923e-01   -3.203188251680767e-01   +8.233148035528315e-01   +4.566594196649887e-01   +4.376166516869073e-01; +5.776713472211720e-01   -6.349528435781906e-01   -3.858905185531862e-01   -2.207871679678674e-01   +6.938869784148359e-02   +3.254523847985427e-01   +2.141613622961727e-01   -5.526686855334684e-01; -4.152794470648909e-01   -2.675114051793289e-01   +5.347486781972580e-01   -1.101086910591810e-01   +7.532115753829488e-01   +2.597254789452375e-01   -9.094988797430269e-02   +6.027575944224184e-01; +2.636039275642851e-01   +4.662314548533323e-02   -7.215171979441549e-01   +2.267056007486076e-01   +4.714727852175833e-01   -4.541893525262301e-01   -6.242848024463880e-01   +5.115504491620116e-01; -5.098646574553260e-02   +1.000000000000000e+00   -1.338016588090911e-01   -6.687565276963839e-01   +5.349967041746081e-01   -4.109456150799527e-01   -2.736259042903998e-01   -6.012120827964633e-01; +4.227659800190186e-01   +3.120960170071821e-01   +1.628571116037946e-01   -6.697839478431646e-01   -7.541386007346595e-02   -2.781043319367410e-01   -2.100002084605316e-02   +2.706777345764251e-01; -4.586571423807433e-01   -2.539689379297869e-01   +3.076564789738957e-01   +4.337280430449175e-01   -8.872527968821442e-02   -3.875124214862020e-02   +1.686587799878449e-01   -2.670954887261102e-01; -2.301497259991718e-02   +8.892917937023566e-01   -3.590210768480805e-01   -1.999401759605362e-01   -6.448717021914438e-02   +3.824117801053363e-01   +3.162640093680347e-01   -4.785168180154187e-02; -6.615289741803666e-01   +4.746048702074460e-01   -1.367948328386293e-01   -3.917110182506189e-01   -1.064009115670912e-01   -1.368931599184820e-01   -2.571972721656232e-01   +4.909504910248290e-01; +3.765068555288700e-02   +5.837596046630072e-01   +5.417642088152917e-01   +6.687246488443632e-01   -7.641052807841008e-01   -6.813640745163985e-02   -1.339429490292433e-01   +6.700622099139750e-01];
L1E_L2E_iAMPA_netcon = [+1.058418671552603e-01   -2.778291451256611e-01   +9.409815812173732e-02   -6.140374136786068e-01   -6.503080404844552e-01   -1.896067635257993e-01   -6.077606139102629e-02   -8.769055889842352e-02   -1.424572628965967e-01   +1.552553563961611e-01   -5.775161072328246e-01   -2.667206397240208e-01   +1.840997880569249e-01   -6.402845017443644e-02   -2.114868056006587e-01   +3.865133776719540e-01; +2.770263024853568e-02   -1.171708604862272e-01   +5.425725805479800e-01   +5.448693865342606e-02   +1.431370101382205e-01   +2.010863428182593e-01   +8.446327008373579e-02   +6.648428108822118e-01   +2.676992247119210e-03   -9.613330591940851e-02   +6.538506691027154e-01   +6.076095259953643e-01   -6.899976515513643e-01   -5.793933033156259e-01   +1.610884996674750e-01   -4.399172605533537e-01; +3.629799119360648e-02   +1.287529401148023e-03   +7.071529152367990e-01   +4.359334496039891e-01   +4.760996691840996e-01   +1.511977913559298e-01   +7.797961056763844e-02   +7.709583738800346e-02   -5.562186689149472e-02   -8.748070379501560e-02   +1.986302649840648e-01   -8.007526788825130e-02   +4.506185951630250e-01   +1.486942469778816e-01   +5.446389316443714e-02   +2.776212559631682e-01; +6.982326403914516e-03   -4.770101634197534e-01   -3.872473473230211e-01   +2.782555860387619e-01   -6.260353626988827e-01   -5.042857032184542e-01   +1.874302653981771e-01   +2.149895914538320e-01   -4.058918932212625e-01   +2.339176275038732e-02   -1.091915588779860e-01   -3.620481592117691e-01   +5.252015228902243e-01   -5.267751034231130e-01   -3.077881967381002e-01   +4.801813002187078e-02; +6.756655337087468e-02   +6.007089981101159e-02   -3.435924779493865e-01   -1.561019927555978e-01   +3.256134775454942e-01   -5.744796939054744e-02   -4.942085663747954e-01   +2.892488427340651e-01   +3.708446151097678e-01   +7.237504700764863e-01   +2.823107882351415e-01   +2.427883858386026e-01   -1.968035987675261e-01   +3.275072072839673e-01   -3.415962341332862e-01   +5.920405986430108e-01; +1.680211103163586e-01   +2.208127788467523e-01   -5.144042031976179e-01   +2.659196210849357e-01   -2.973479127559170e-01   +1.000000000000000e+00   -2.927684183925372e-01   +3.871599592298641e-01   -3.666186360553543e-01   +1.394061778037438e-01   -2.527995558433130e-01   -3.631942822605626e-02   +5.606168494300912e-01   +5.181490914788187e-02   +2.457365855413402e-02   +4.846779679318500e-01; -2.787959647574029e-01   -1.683115337042451e-02   -4.431973576324542e-01   -1.430538253983030e-01   +1.995675113279478e-01   -1.672092958860049e-01   +2.906085001763149e-01   +3.267168564892580e-01   -2.361414174676029e-03   +7.630814080974224e-02   +3.869612617791536e-01   -5.524153958502070e-01   -1.549184142895766e-01   -9.029085708369286e-02   -1.221515306239560e-01   +6.724631692920686e-01; +1.070233718139833e-01   +3.906081628324772e-01   -2.625893256250152e-01   +6.686743329118234e-01   +1.492372476156181e-01   +1.592682631113031e-01   +3.005631707047828e-01   +3.507076065043551e-01   -4.996825139071031e-01   +2.713869598168677e-01   -6.898668827344628e-01   -3.030050051107165e-01   -1.553374653985319e-01   -2.790644584559899e-01   -1.537655378543802e-01   +4.588595862103320e-02];
L2I_L2E_iAMPA_netcon = [-2.668091238425591e-01   -3.712411972586228e-01   +6.425700042010302e-01   +2.895601836652152e-01   -3.429539169681834e-01   -3.088094790783774e-01   -1.033680450782259e-01   +3.305265612344368e-01; +2.431487476233247e-01   +3.615412773388506e-01   -3.795254536096438e-01   -1.662705247920119e-01   -7.070967064959476e-02   -3.069916789717184e-01   -1.317532304331497e-01   +1.087105658057001e-01; -4.421488365925837e-01   +3.823719153599229e-01   -1.110045218969526e-01   -1.084879229677049e-01   +7.365153564937210e-01   -3.121189001363126e-01   +4.572251170511737e-01   +4.900228770556863e-01; +1.875453094375036e-01   +4.014073369473876e-01   -3.554572166949429e-02   -2.924598859171265e-01   +1.610389087612682e-02   +3.893394325565048e-01   -2.721062272654126e-01   +2.717497466043520e-01; -3.422189622039108e-01   +4.470847106440853e-01   -6.238214182004446e-01   -1.788204276381843e-02   -4.815683892104272e-01   +3.106345348622366e-01   -4.283061154502493e-02   +4.694769868463902e-02; +4.934880125308798e-01   -3.757633749865601e-02   -1.000000000000000e+00   +1.814586210316798e-01   +3.282501258917162e-01   -1.598328856693157e-01   +1.688330771331511e-02   -6.701444727276732e-01; -1.771919596612045e-01   +4.081923604191171e-01   -3.607604319973077e-01   +8.012799297079673e-02   +1.329746306620946e-01   +4.672533180185696e-02   -3.600757691386514e-01   -1.397393001461336e-01; +5.699499734379880e-02   -3.496649185443721e-02   +2.328995537267111e-01   +2.570453926450055e-01   -8.880395529237399e-02   +1.829974225642715e-01   +7.911982650761586e-02   -1.403650362051720e-01];
L2E_L2I_iGABA_netcon = [-3.421611670462840e-01   +2.647087861114668e-01   +7.697637911862200e-01   -2.110925923891977e-01   -2.988896466692424e-01   +3.359096215237521e-01   +3.376726643035951e-01   +8.586952684851035e-03; -2.752459885924361e-01   +9.919211797859567e-01   +4.797019381669283e-01   +1.623044501340933e-01   +6.347126951857063e-01   +4.593202170041100e-01   -4.985780424120917e-01   +2.901900125798572e-01; -3.329020232084579e-01   -7.466448827309781e-03   -1.812363089924513e-01   -7.371851328197263e-01   +1.107166038060353e-01   +6.217491092456170e-02   -4.512402173226995e-01   -6.199726538302660e-01; -4.918578609500667e-01   +1.602979123033417e-01   -1.473688086783748e-01   +4.239973942428871e-01   -1.754945004778780e-02   +4.653950654564124e-01   -2.791770748093892e-01   +2.579208949774137e-01; +1.529339467899104e-02   +5.033786508567758e-01   -4.646215582746721e-01   +1.000000000000000e+00   -7.499394016776788e-01   +4.103101214848437e-01   +3.598686889060337e-02   +9.399258048400685e-02; -4.412521401297583e-01   -1.568671735646697e-01   +6.556946305930660e-01   -8.880487805757861e-02   -3.322234278224572e-01   +4.504219889218706e-02   +8.337560682618358e-01   -4.459788421014337e-01; +8.844422691463388e-02   +3.276784730486264e-01   -6.555753891529617e-01   +5.391681835270656e-02   +2.230526407512069e-01   -3.071266236962570e-01   +4.165200327569482e-02   +4.205535038659938e-01; -7.008687510382838e-02   -7.322385037781811e-01   -1.286942142722453e-01   -6.036901526153103e-01   +8.821327569220043e-02   -2.982842960292125e-01   +4.463507924628776e-01   -2.493006203735246e-01];
L3E_L2E_iAMPA_netcon = [+3.188981838321574e-01   +3.951168989841650e-01   +7.638970440944430e-02   -5.265288716706554e-01   -4.493980998747784e-01   +4.838243432608936e-03   +5.873467800862246e-02   -1.752300744544695e-01   -3.853060052977923e-01   +5.142158483167631e-01   -1.598216753669389e-01   -9.092239018300343e-01; +2.080936609216869e-01   +4.211947601322342e-01   -2.512874964568692e-02   +3.119030613216776e-02   +4.667794029461002e-01   +2.422585375615811e-01   +4.609341357695098e-01   +1.304788570930446e-02   +1.906899041462792e-01   +3.241207242859774e-01   +1.256790389169961e-01   +4.764831534803821e-01; -4.600095892567373e-01   +1.134868379315360e-02   -9.100828709873768e-01   -1.444210219076829e-01   -1.516642262887611e-02   +3.556028224808703e-01   +3.052041817590747e-01   -3.819091118265314e-01   +4.910904838288938e-01   +4.099839644097024e-01   -1.551251963830175e-01   -7.070561885128648e-01; +8.696296393353939e-02   -7.131486535570025e-01   -1.109207943300643e-01   -4.583711067719216e-01   +5.290942298519306e-02   -6.418471852883255e-01   +8.626488058709522e-01   -3.244671224812054e-01   +5.662008435931769e-01   -7.778697316772101e-01   +2.291329969576779e-01   +5.048619285568480e-01; +9.196273880923262e-01   +7.440397064508995e-01   +6.800506302391436e-01   -4.526641844089724e-01   +1.000000000000000e+00   +2.767579491393599e-02   -7.437082723452995e-01   -1.904813121568555e-01   -4.396472634196739e-01   +2.625139471149840e-01   +1.379883397075903e-01   -3.627470427063548e-01; +3.553506265194744e-01   -2.404407659361351e-01   -2.156158962693778e-01   +4.005713239578138e-01   +1.929905821526068e-01   -1.297911778496735e-02   +3.898272555984724e-01   +3.854429727902118e-01   +2.896951492910332e-01   -7.203125543716717e-02   +5.974101377501773e-01   -5.694871936516569e-01; -6.727201412710155e-01   +5.150762657534552e-01   +8.816615777391956e-02   -8.886477334611641e-01   +2.047560835399364e-01   +7.318835767842612e-01   -4.176880039082213e-01   +5.051598353792124e-01   -9.357707947451184e-01   -1.537861013596607e-01   -5.827643767143095e-01   +3.347657925279983e-01; -1.341181902067246e-01   +4.947873452085378e-01   -3.182427920659149e-01   +1.460712514097385e-01   +3.498756025859132e-01   -9.437436352107887e-03   -1.879557105787895e-01   -1.985208935514330e-01   -3.247136978776360e-01   +9.060194908419640e-01   -3.725187553871627e-01   -3.822220468951461e-01];
L3I_L2I_iGABA_netcon = [-5.973476221413817e-01   -2.563825266941633e-01   +9.475194043130859e-02   -4.407003427450761e-02   +1.042612860099706e-01   +1.090312449653574e-02   +1.222506610486041e-01   +5.493383995752029e-01   -2.836432220704193e-01   -4.690939108023897e-01   +1.452131547842522e-02   -2.003347995821350e-01; +1.182639099091269e-02   +9.580727006073604e-01   +5.082831877135335e-01   +3.801390294749382e-01   -6.969882325483013e-01   +2.047872281475855e-01   +2.902552222425636e-01   +1.677548221962794e-01   -7.608247269553893e-01   -2.498359030877162e-01   -6.078932685878720e-01   +4.146565615263778e-01; -4.928378121553161e-01   -3.398884007807665e-01   +2.134108942872877e-01   -3.007634452718341e-01   -9.340299963436146e-01   -5.101589440200861e-01   -4.128748988065981e-01   +3.561452727972175e-01   -5.036252987489945e-01   +4.825681677656761e-01   -1.481267487785615e-01   +1.950216101125417e-01; +3.861424760254797e-01   -6.552830665270218e-02   -9.268018584040455e-01   +7.451598944978902e-01   +1.544607093645240e-01   -9.079325701962809e-01   -1.407910531550410e-01   +4.807030221943792e-01   +5.775474537294982e-01   -5.123348916003215e-01   +9.297180098696900e-01   -5.769196179177775e-01; -4.461983721640185e-01   +5.823778024317056e-01   +4.598188848139823e-01   +4.201974022716588e-01   +1.169303625352459e-02   +6.489976628549620e-01   +1.966513210763126e-01   -1.901995679747689e-01   +2.114940279916369e-01   +8.780063399639670e-01   -4.357610525858807e-01   +9.440453397093131e-02; -1.148626555657612e-01   -3.958043463760491e-01   -3.345220503143982e-01   +9.687062087370669e-02   -5.412622255374939e-01   +2.084345517129838e-01   +1.699566233581981e-01   +4.618172133292247e-01   +3.217921880950134e-01   +8.450252473586336e-01   +1.032111481868166e-02   -6.397589904215373e-01; +5.255308025065339e-01   +5.843620281833086e-01   +3.483291619141813e-01   -4.538476808428212e-01   -1.057617924110003e-01   -4.636524044343304e-01   -4.546491736557191e-01   -2.050265695756984e-01   -4.815271419905644e-01   +3.914201663208660e-01   +2.462662538798455e-02   -1.986842976696199e-01; +6.783052239766204e-01   +5.793818997776524e-02   +1.434659022937976e-01   +6.065653978448003e-02   -6.368499636585190e-02   +1.586096425007386e-01   +5.886906520643590e-01   -1.000000000000000e+00   -1.206015588285256e-02   +4.052796043590021e-01   -4.280736157122795e-01   +2.016757646787898e-02];
L2E_L3E_iAMPA_netcon = [-3.191348228138116e-01   -7.733715907104961e-02   -3.226818261331511e-02   -1.274604995707167e-01   +6.904743742483882e-02   -2.557676688900352e-01   -2.087497961711147e-01   +1.435042643779518e-02; +6.055572901966039e-01   +1.403457000188285e-01   +1.362090026096373e-01   -7.861816173374326e-01   -1.781758041659596e-01   -5.566894757275916e-01   -2.087009990455607e-01   -1.276745363681930e-01; +5.200511666101982e-01   -5.986567500372408e-01   +6.067456737082844e-01   -3.603159336299322e-01   -4.545753721613575e-01   -4.046297015393506e-01   +7.880890937045278e-01   +6.655249113772752e-01; +4.311680857943156e-01   -3.149900598341038e-02   -3.053853025896630e-01   +3.106640165687792e-01   -1.000000000000000e+00   +2.729555882498434e-02   +5.452468738467341e-01   +4.408359349597349e-01; -2.488765163364476e-01   -1.892290614106268e-01   +7.806000830331705e-01   +1.248482067994004e-01   +1.976509137563860e-01   -1.388001230592933e-01   +2.381716170269704e-01   -3.617417934599021e-02; -9.712215656041438e-02   +1.704131093982729e-01   -2.090027530477938e-02   +1.481266322542040e-01   -7.240284270446828e-01   -5.639356882399503e-02   +6.740362270459268e-01   +6.060261332628026e-01; -5.245806400714372e-01   +1.339635358302392e-01   -4.659520029608529e-01   -7.924432604366228e-01   +7.782389413648474e-01   +2.641197841329895e-01   -2.364868970412847e-01   -5.599072128717568e-01; +4.069895549252884e-01   +1.187066959136422e-01   -7.542190908999366e-02   -7.858354953808766e-01   -2.084944071100965e-01   +4.673074328322941e-01   -4.632361005454000e-01   +6.486354702399824e-02; +1.633407378593199e-01   +7.170506198968220e-02   -2.967094168711947e-01   -5.325270219531537e-02   +1.911838138677975e-01   +3.541427252017279e-01   +3.165016165968074e-01   +2.100995936033790e-01; -1.005042506901589e-02   -4.725081539884936e-01   +1.314835904349916e-01   +7.156511142744707e-01   +2.855686518817986e-01   -3.053329964609351e-01   -3.154016518200201e-01   -1.141694140436283e-01; -3.034487883377441e-01   +3.541513363124794e-01   -3.532999829283953e-01   +9.650427808069877e-02   +9.843443572485922e-01   -2.358163035500561e-01   +1.089943482642615e-01   +3.391777781558894e-01; -8.616756378914949e-01   +3.644819578950695e-01   -9.873530281885727e-01   -1.642179828264711e-01   +5.135274702075109e-01   -7.666455780466369e-01   -2.565015432327194e-01   +3.958885068395205e-01];
L2I_L3I_iGABA_netcon = [-9.365382665072074e-01   -9.457538024575362e-01   +4.382717479057882e-01   +7.112124441222437e-01   -2.467395406694827e-01   +1.359884088057191e-01   +7.036566653872668e-01   +1.000000000000000e+00; +2.419387159038293e-01   -1.037747583693221e-01   +4.318314935078089e-01   -4.352238481628895e-01   -2.088618510444385e-02   +3.052796188981424e-01   +3.417451319350545e-01   -1.635983296564306e-01; -2.643801229009489e-01   -5.042375144731585e-01   -6.704010266237476e-01   -2.300294161753174e-01   -4.404723011472090e-01   +3.630294186649898e-01   -1.254059835403659e-01   +1.641389364160725e-01; +1.643960039669394e-01   -1.377159572278817e-01   +1.397091736441756e-01   +1.881599005085450e-01   -1.669801586060837e-01   -2.232998792184303e-01   +7.647177006022721e-02   -2.272382140343396e-01; -3.792831407515153e-01   +1.355088204489909e-01   -2.564453939872904e-01   -3.824988458490499e-01   -3.337911280186275e-01   -2.036212115465194e-01   +3.346156929470361e-01   -1.431607421318817e-01; +4.057702423902083e-02   +3.531401897908329e-01   -3.304285611514508e-01   -1.596586821785758e-01   -1.472580215656356e-01   +3.274927377949557e-01   +4.517231634570842e-02   +1.163529463543341e-02; +2.883531459726251e-01   -9.131697918615084e-02   -2.230918871888605e-01   -5.242358018583172e-01   -7.359601577964865e-02   +9.210242666031553e-01   +5.022791638252495e-01   +7.489081119098145e-01; +3.463022638667197e-01   -4.190237725840649e-01   +3.713221477706279e-01   -3.178482757130283e-03   -5.268827243741845e-01   +2.567874449383251e-01   -6.449001918364698e-01   +3.416248799886101e-01; +4.497020814012279e-01   +3.435941495193383e-01   -2.915774967476080e-01   +2.308696718430875e-01   -1.527345396296719e-01   -9.103206121016909e-02   -5.079066071511821e-02   +2.973196480261569e-01; +8.209808613701992e-02   -9.809855386413377e-02   +8.048693969816751e-01   -3.372631226963103e-01   -6.898478340996764e-01   +3.314514458446936e-01   +7.034519670573505e-01   +1.048517367093880e-01; -3.113955855916151e-01   -2.890860939834598e-01   +1.277233135638253e-01   +6.932023916084314e-01   +4.843398967604310e-01   +1.185376586896683e-01   -4.828612029567922e-01   +5.626075594479064e-01; +2.429279395135509e-01   +2.988087694918409e-01   -2.365182682549191e-01   +4.242977461270446e-01   -2.089303123262443e-01   -1.553900814770847e-02   -6.504649042704467e-01   +1.694763004203223e-01];
L3I_L3E_iAMPA_netcon = [+3.650326643691154e-01   -9.270153095730269e-02   -6.386810483477560e-01   -1.312669756698472e-01   +3.633170062959612e-01   +1.201159587567530e-01   -3.153141330046430e-02   +2.340501616497080e-01   +6.529836569719335e-01   -6.706893793758987e-01   -1.373557701659790e-01   +3.426750215748997e-01; +3.345627435776882e-01   +1.126503190803081e-01   -2.098801194775527e-01   +1.000000000000000e+00   -3.584803754496473e-01   +1.007226539705194e-01   -3.182685879147512e-01   -3.867241926866597e-01   +1.903462006610951e-01   +2.603848754816563e-01   +1.921052715822686e-01   -1.362881168059635e-01; +3.048475154146274e-01   -5.287614618163973e-01   +3.619668680106735e-02   -4.610658384043788e-01   -1.572810083292878e-01   -1.413139563353900e-01   +2.369199885497031e-01   -4.548651795170728e-01   +5.597659383638237e-01   +2.600166925336577e-01   -2.289359003848710e-01   +7.037866515422573e-03; -5.328206857058303e-01   +5.501188554432532e-01   +5.455069037485600e-01   +9.283553221930489e-02   +9.216811792034717e-02   -1.804758531960475e-01   +3.421197132702603e-01   +8.417140783593920e-02   -7.704369907014788e-01   -5.709838567339620e-01   -3.207591425606049e-01   +4.415035392385447e-01; +3.818897729683980e-01   +2.937714989187565e-01   +1.477750566098068e-01   +4.014812152848355e-01   -4.492835519859423e-01   -8.261985607434311e-01   +1.356726843924823e-01   +1.355473981127032e-01   -3.393725641481656e-02   +3.953556749840068e-01   -4.280938540007828e-01   -4.109437277106134e-01; -2.132151276739386e-01   +3.047089921019919e-01   +1.140713478188880e-01   +2.321530940921191e-01   -6.897315949930424e-02   -2.848779804022782e-01   -1.128101137343586e-02   -1.423298777091325e-02   -3.756996166840976e-01   -1.463741303929740e-01   +8.850609275684155e-03   -5.683798791241519e-01; -8.909356097158518e-02   +1.969713959195509e-01   -1.361687108217118e-01   -3.169915566043056e-01   -6.609435971511907e-01   -3.137469412786948e-01   -2.247614591070341e-01   -2.541976534175440e-02   +2.108515378132359e-01   +5.419367810130390e-01   +4.182961826026625e-01   -1.184149906407955e-01; -2.817674582431657e-01   +3.101541739949026e-01   +4.255837072518934e-01   -6.149406202516951e-02   -1.829847240047114e-01   +3.951777673503411e-01   -5.858833336331642e-01   +3.484159703900784e-01   +1.322198682427441e-01   +3.945051676045915e-01   -4.830497886886296e-01   -3.990662521228172e-01; +5.469809501076358e-01   +3.550301125995687e-01   +2.719629701285708e-01   +7.022839922062277e-02   -6.355495309293642e-02   +2.639337088985004e-01   -2.518384448813744e-01   -7.201023616023371e-01   -4.882641623096952e-01   -5.054406388475106e-01   -6.533872804569421e-03   +2.484769933079357e-01; -4.866927186790680e-01   +5.891499278498082e-02   +2.399835272304083e-01   -3.850266758688997e-02   -2.755516950226639e-01   +1.650475589669058e-01   +2.167660243152724e-01   +4.111776666361658e-03   +1.443565243098009e-01   -7.245381322963698e-01   -7.186575552822681e-02   +2.974390522372269e-01; -1.843952448479504e-01   -1.753280987171811e-01   -4.826551407071256e-01   -1.173133236398005e-01   +4.584701421168099e-01   +4.201473611744308e-01   +1.783251692607585e-01   -5.023827983777414e-01   +3.672656484982844e-01   -7.587641907861260e-01   -6.180482250948297e-01   -3.760246645385411e-01; +3.928893620172272e-01   -4.026369812043001e-01   +6.462375307750708e-01   +1.409690687296008e-01   +2.749965827440273e-01   -3.902807268374862e-02   +5.971951475895537e-01   -1.440160695429002e-01   -6.386180971928545e-01   +2.357253576220193e-01   -3.294112056895805e-01   -4.647814845089597e-01];
L3E_L3I_iGABA_netcon = [+4.524593577929475e-01   -2.151685688727016e-01   +1.259119993949882e-02   +7.652936589870414e-01   -3.239250717080686e-02   +2.670595841257081e-01   -2.974021733752971e-01   -3.098799244776529e-01   +6.042506417298189e-01   -3.091253054247420e-01   -5.566754584327121e-02   -3.435559431938704e-01; -5.641325195155599e-01   +5.967448055859430e-01   -7.016066589487484e-01   -7.581775156879735e-01   -2.218232582275597e-01   +1.545760075915885e-01   -2.887538617673289e-01   -3.293472758632279e-01   -8.582658841889892e-01   +4.471141724644117e-01   -2.798373817615568e-01   -7.461976432438301e-01; -3.318884039290393e-03   -1.012999052990796e-01   -6.400768128770985e-01   +3.359945652056653e-01   -2.564057732871097e-01   +8.208862591447404e-01   +7.329739762892153e-01   -5.015578498606171e-01   -4.060107835065759e-01   +1.558368707381652e-01   +2.859754208916093e-01   +5.095637260240476e-01; +5.014472617901954e-01   +3.263603358097136e-01   -7.370314316533704e-01   +6.393904987904037e-01   +3.099861335728183e-01   +3.942664537658407e-01   -7.738845733785304e-02   +5.985335267658073e-02   -4.375736561999844e-02   -4.597911524291639e-01   +2.187993501734176e-02   -6.414122137339956e-03; +1.615408057933524e-01   +3.929921354151179e-01   +5.270939178959247e-01   +2.035897609631327e-02   -1.350042585863168e-01   -8.133107033331823e-02   +1.000000000000000e+00   -5.353719330625576e-01   -1.151833515784568e-01   +2.757290835856024e-02   +1.298729834911544e-01   -3.238061086106193e-03; -5.188006606837058e-01   +6.278285432520268e-02   +1.035119133448242e-01   +8.321299316297870e-02   -1.082590084754414e-01   +6.785815867434564e-01   +3.602665818632585e-01   -3.438826045515606e-01   +8.771169213055749e-01   -3.884461246650205e-01   -6.870778190657287e-01   +9.007174620089435e-02; -2.903059420149939e-01   -4.705269013800438e-01   -1.612598625601425e-01   -2.139230263479483e-02   -5.511826728595822e-01   +7.920656181253816e-02   +6.084748381466637e-02   -3.037833676775528e-02   -5.139368373270484e-01   +3.467443442656007e-01   +7.108815371157655e-01   +4.320826118632775e-01; -1.909569688244126e-01   -6.144645406721448e-01   +2.467365557412790e-01   -9.033505914282982e-01   +2.340557985711504e-01   +3.398825526833218e-01   +4.327180681408709e-02   +7.422993414572334e-01   +5.114406978446451e-01   +6.759671305755406e-01   -4.122684242207205e-01   +1.100279816200511e-01; -2.316828075524928e-01   +4.338431580331245e-01   +6.315508412147980e-02   -6.145985106274627e-01   -2.190933216935994e-01   +7.646634865952738e-01   +1.241941858232577e-02   +7.625097913830369e-01   +1.644932577580077e-01   -3.580643552044387e-01   -2.888376135189753e-01   +2.896915881984351e-01; -8.451176560774175e-01   +5.876280473878601e-01   -7.185816883305265e-02   +1.339097773416437e-01   +3.675609896736517e-01   +1.018649666391913e-01   -8.321237211460969e-02   +9.563309288262031e-02   +6.729282487616657e-02   -4.959465450030872e-01   -6.451622417798980e-01   -9.572255630864664e-01; -7.512482452500316e-02   +9.468192194184993e-02   +6.004948760540147e-01   +1.502115637560034e-01   -8.361216091794335e-01   +4.944863301566178e-01   +7.932209184293268e-01   -1.704695302732865e-01   +2.656719312931902e-01   +1.908591625156122e-01   -2.677662259924920e-01   -2.163853826422026e-01; -6.297840279322047e-01   -5.094535182619201e-01   +5.611969485695761e-02   -3.427231537232518e-01   -2.550308052801724e-01   +3.565917257795500e-01   +6.513740880528612e-01   -5.944681534121944e-01   +7.296340362273455e-01   -3.816023078014822e-01   +3.751845194753701e-01   +5.871328472462000e-01];
L2E_Input1_iAMPA_netcon = [-2.784868337479079e-01   -3.565822026615437e-01   -9.935117956449059e-02   -1.150821264662131e-01   -6.307482228356649e-01   +5.015831793773163e-01   +1.498518324472339e-01   +1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [+3.931857837234171e-01   +9.602019010101280e-01   -1.189324315436976e-01   +8.698128902092241e-01   -1.000000000000000e+00   +1.474697134414419e-01   +2.618608053116826e-01   +5.064632375535265e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
