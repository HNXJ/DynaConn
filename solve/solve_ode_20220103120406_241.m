function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.177686607716339e-01   +4.731347899865099e-02   +4.662480820666657e-01   -5.759711528650751e-03   +1.139013340452026e-01   +4.794106432291329e-01   +7.455779097834649e-02   +3.034803126880644e-01   +2.046620196205350e-01   +6.790967316581278e-01   +2.673262328736208e-03   +2.173660954020698e-01   +1.591185348201658e-01   +3.916003392085574e-01   +3.802578337972751e-01   -2.418057449703269e-02; +5.082805533114220e-01   +2.703015539980647e-01   -1.521554395295364e-01   +4.779612747994107e-02   +5.232851432463933e-01   +4.006684805938032e-01   +2.447648795363047e-02   +3.044359604098064e-01   +3.949966528652525e-01   +2.070865715988138e-01   +3.845584058730294e-01   +4.457308265213852e-01   +2.909788790858602e-01   +6.944872866470404e-01   -1.838152137858764e-01   +3.463992796398429e-01; +5.061127962522263e-01   +4.404402573109424e-01   -8.890810478041947e-02   +2.742411871998236e-01   +4.811123153944498e-01   +2.482662922079036e-01   +1.838463921699184e-01   +1.899452377485015e-01   +1.269267606610888e-01   +5.085005872907079e-01   -2.167873779263705e-03   +1.349453879890320e-01   +3.779394147162194e-01   +4.653018438435720e-01   -7.660121509653257e-02   +3.028908689062780e-01; +5.892352495123322e-01   +2.081345219337897e-01   +5.417358925217034e-01   +1.000000000000000e+00   +6.504355505808268e-01   +4.868714281447452e-01   +7.583696663635349e-01   +8.720223534386176e-01   +9.224787717303014e-01   +3.951906092278660e-01   +4.111300232400179e-01   +1.828944929016355e-01   +3.692868940762177e-01   +4.516143925848946e-01   +2.447783937608020e-01   +3.230247302694098e-01; +4.489665787990695e-01   +5.606522119968961e-01   +3.743165207681436e-01   +8.571956466242842e-01   +3.583730403331151e-02   -9.761270007119102e-02   +1.641664177308677e-01   +8.122981028840236e-01   +4.499698151444515e-01   +3.933318107686099e-01   +8.576999249508573e-01   +4.308391671693065e-01   +6.508915399069659e-01   -1.135648990866424e-01   +7.147444391395756e-02   +5.736742768173450e-01; +2.237469970797588e-01   +2.918913706909822e-01   +4.433540066504995e-01   -1.142443439849265e-01   +3.612834248321282e-02   +6.154130091974770e-01   +3.595971629983241e-01   +4.856411897936162e-01   +3.311875029580231e-01   +3.985962278785599e-01   +7.115691004445170e-02   +5.587321449413847e-01   -2.010107072350810e-02   +4.041696122574049e-01   +3.332549010406611e-01   +6.637114861444945e-01; +5.590743100544285e-01   +5.467450299199293e-01   +1.629721904038055e-01   +5.906192613783937e-02   +3.436412575995761e-01   +4.931571255161765e-01   +6.341810412985515e-01   -1.466673914566457e-01   +2.423169496634614e-01   +3.553215681815130e-01   +4.829865833464093e-01   +4.389889621010838e-01   +5.318355478167819e-01   +1.384758838432150e-01   -4.045650284031151e-02   +9.733590203438780e-02; +7.001818537805545e-01   +6.926522273567398e-01   +2.622420144842261e-01   -3.121958529735902e-02   +3.633315940421123e-01   -1.037632133346854e-01   +4.132499287182869e-01   +2.191894189918137e-01   +4.151211137054099e-01   +5.192716260382114e-01   +2.679952964448987e-01   +1.468504772244342e-01   +2.412143439440438e-01   +2.901101363782206e-01   +5.051063952725110e-02   +6.198867955466358e-01; +2.430414080538071e-01   +4.382918353387819e-01   +6.187088962399882e-02   +3.547241856536523e-01   +6.053410289356660e-01   -1.055776171382704e-01   +3.554392598908220e-01   +4.238157453685766e-01   +2.447734683431863e-01   +1.785181078726699e-01   +3.879861190909677e-01   -8.247104200906061e-02   +2.203512246622619e-01   +3.419728963216666e-01   +2.741273271067594e-01   +1.433585756630891e-02; +2.570120804182973e-01   +5.801188006863417e-01   +2.260553334955286e-01   +3.694840570006012e-01   +4.745995703613904e-01   +4.410230123422483e-01   +5.784029871524592e-01   +2.583308223705370e-01   -1.673028142502221e-02   +1.220261108866387e-01   +2.513491785737970e-01   +3.882122462377602e-01   +5.552214179068757e-01   +5.981993029139986e-01   +2.556589687881731e-01   +5.053665575874942e-01; +3.225871904929003e-01   +3.718219731398617e-01   +1.046077568941513e-01   +5.625484359421886e-01   +4.966113367140589e-01   +2.350681181511359e-01   +4.046360980476518e-01   +6.223109830691819e-01   +3.780137313861356e-01   -1.619604047485456e-01   -8.430211832277601e-02   +5.659677151910889e-01   +5.319185389038835e-01   +3.777762293007351e-01   +3.833622244135338e-01   -3.280800786450831e-02; +1.910229224350359e-01   -1.073094609964823e-02   +3.878317939322128e-01   +4.311232173510664e-01   +3.549700365216641e-01   +3.702488662608232e-02   +1.543786948181153e-01   -1.782854029384016e-01   -1.277188266770099e-01   +4.906302153018003e-01   +1.844523612490835e-01   -1.847162217184897e-01   +5.328020788367193e-01   +5.853650997370633e-01   +7.562671871151144e-03   +2.640824791869529e-01; +1.939947523902289e-01   +2.198984675814885e-01   +8.763721390533664e-01   +6.765356214390920e-01   +4.613120213202066e-01   +8.306885342281467e-01   +2.769809448775934e-01   +3.383623977308607e-01   -3.894167800092018e-02   +1.608000151957629e-01   +3.087405911398800e-01   +6.405337211481532e-01   +4.442005461450740e-01   +4.804486314120853e-01   +3.360986070509350e-01   +2.808644149993562e-01; +4.310093870578757e-01   +7.137020204182215e-01   +5.499034777208102e-01   +5.370314369379283e-01   +6.777992072989182e-01   +5.199405456166133e-01   +1.733988833526507e-01   +2.001522164168802e-01   +4.508732022153896e-01   -9.902665916928338e-02   +3.800688237060769e-01   +1.682290157597578e-01   +1.306384709609189e-01   -1.134741230249989e-01   -1.094761549568158e-01   +5.860782127935245e-02; +1.036586713343268e-02   +4.822872561689537e-01   +3.424717691871887e-01   +5.007641580297385e-01   +3.783392185449221e-01   +7.911750319309165e-01   -1.379123298183237e-01   +1.688671438831635e-01   -1.686075269054688e-01   +3.693789296533183e-01   +4.506217614112015e-01   +7.386014045530496e-01   +4.964327649666130e-01   +7.242890188379603e-01   +3.775993998727836e-01   +2.096436024376235e-01; +5.187005203289264e-01   +1.372074718531738e-01   -1.142709908974429e-01   +9.037112618711629e-02   +6.161847599079591e-01   +2.765561487904016e-01   +1.852939493067699e-02   +2.179240652238837e-02   +3.363870885849636e-01   +3.367532481039858e-01   +3.929293868144750e-01   +3.866506660500883e-01   +4.795381033070447e-01   -3.036648892690106e-01   +6.279932703264954e-01   +3.367012565894023e-01];
L1E_L1I_iGABA_netcon = [+4.486189503005782e-01   +5.758928773574914e-01   +6.718679542907853e-01   -4.058140244007499e-02   +3.163263115491787e-02   -1.413611270288802e-01   +4.719100065162027e-01   +7.339543739908448e-02   +6.697798708197864e-01   +4.895287327369634e-01   +6.554515785772530e-01   +4.716418752658492e-01   +6.546388605520768e-01   +3.120763304006001e-01   +4.214762533077047e-01   +1.880266904634615e-01; +1.869222707790126e-02   +3.116785626110030e-01   +1.342985826544279e-01   +2.103931306953148e-01   +2.237260450379112e-01   +2.561309150511145e-01   +3.708131901015431e-01   -2.965218969177630e-01   +8.143982717739772e-01   +4.472384204504659e-01   +6.015371781144556e-01   +6.944977871046182e-02   +3.274081388402654e-01   +1.900849735211128e-01   +3.104463623740290e-01   +3.520455288185771e-01; +6.214526631060895e-01   +3.386745024658705e-01   +4.745225538794437e-01   +1.006559530482285e-02   +6.180629771623863e-01   +7.810724098818826e-01   +2.535627603780682e-01   +2.430330447167759e-01   +4.425607848784097e-01   +1.806679110990384e-01   +6.510175312627742e-01   +5.982862974757650e-01   +6.815760732331901e-01   +1.046033618788250e-01   +5.712111179510869e-01   +5.819021638574540e-01; +1.186532681979042e-01   +1.100765091639659e-02   +8.938681041695545e-02   +6.036488839369938e-01   +6.371870443032537e-01   +2.624129342981648e-01   +6.731756418304083e-01   +4.038332561570555e-01   +5.492913804519139e-01   +7.764253998700800e-01   +1.856851933191662e-01   +2.439908768168534e-01   +7.221618381077163e-01   +8.421379196843264e-02   +4.409218445714426e-01   +6.075077540310228e-01; +6.017168750455024e-02   +2.599280114207244e-01   -7.497477497341276e-02   +3.020511717657811e-01   +3.574936260676586e-01   +4.982523429558606e-01   +7.109414826569082e-01   +5.037032925831673e-01   +3.037453689143257e-01   +5.245556223893917e-01   +1.838322191860469e-01   +5.590033869748311e-01   +2.085325561081794e-01   +2.632333887311666e-01   +4.265862793654528e-01   +1.912633272702444e-01; +5.969421825890310e-01   +3.913135823954177e-01   +3.072575422228483e-01   +1.269495449556803e-01   +3.059265257821289e-01   +1.276869118704314e-01   +3.507018619986266e-01   +2.684097724375251e-01   +1.249219558404755e-02   +6.507329519321031e-01   +4.190283106857116e-01   +2.851767519258260e-01   +8.840225429477613e-02   +3.846932129849061e-01   +4.128351414450280e-01   +4.943901644694202e-01; +9.096095116566527e-02   +6.263057313708442e-01   +9.474073128870243e-02   +2.728359430465906e-01   +4.545565407753243e-02   -4.180033321009541e-01   +8.724182633755793e-01   +6.165774627520042e-01   +3.530482152993387e-01   -1.999856167596003e-01   +1.807085444078481e-01   -1.224451157444002e-02   +2.105910950919007e-01   +6.185776485175154e-01   +5.493405315862495e-01   +3.940096493304619e-01; +4.100711598398840e-01   +8.268361177150206e-01   +7.441952532634054e-01   +2.179254207108609e-01   +3.152334199763009e-01   +6.024422439350521e-01   +1.038264081900173e-01   -1.287437819065787e-01   +2.783796498634422e-01   +4.716079159540854e-01   +6.998339478366409e-01   -4.318997730394832e-02   +5.119296027094192e-01   +7.181418537156808e-01   +3.573647722559442e-01   +8.064358765038844e-02; +2.078802428317099e-02   +8.587007338927120e-02   +3.309571415570666e-01   +5.499253427591680e-01   +6.281470829851297e-01   +2.095932168115583e-01   +6.533511612218468e-01   +1.596907571016130e-01   +5.671368264899384e-01   +5.850253592940872e-02   -1.721818986318200e-01   +3.986754415437784e-01   +2.848921202398592e-01   +6.266199803955539e-01   +2.877263545530072e-01   +1.494949689763168e-01; +2.057650514852882e-02   +7.593397405321404e-01   +4.127389519544299e-01   +9.485363604393764e-02   +2.443919211932681e-01   +4.557540539859972e-01   +2.443043372020735e-01   +1.358783481926900e-01   +3.049097060566353e-01   +4.036299968561946e-01   +3.791416503101822e-01   +7.386727283960490e-01   +3.658257684722077e-01   +2.250096138762742e-01   +4.382072561672163e-01   +4.942289145402672e-02; +9.583853957345927e-02   +5.999789024380642e-01   +8.378146889954526e-01   +6.494348020908988e-01   +4.361830678007708e-01   +1.303843559057685e-01   +1.273650799001216e-01   +6.904924611970085e-01   +5.781900498305429e-01   +4.987870057081563e-01   +5.823209610601808e-01   +4.270997725858857e-01   +9.709433013108830e-02   +6.282545435449078e-01   +1.845290772354512e-01   +5.763889770269837e-01; +6.304139411677411e-01   -1.388161500701760e-03   +5.970952082508223e-02   +4.844988101346866e-01   +5.525322821381951e-01   +1.602792355949515e-01   +2.527295195175820e-01   +5.042116675332992e-01   -1.190418424655921e-02   +2.459533570625559e-01   +4.659115818659493e-01   +4.881281500689131e-01   +2.041212445840463e-02   +6.124966890555224e-02   +2.119630168124977e-01   +5.890051008218581e-01; +5.289078088654330e-01   +7.248042421742799e-01   +7.079360616216206e-01   +2.645214334481676e-01   +3.103680539937558e-01   +8.160435625696866e-01   +1.233995736574139e-01   +4.157218838388923e-01   +5.356297326542979e-01   +6.151381880116757e-01   +8.379197372260757e-01   +1.086919019487003e-02   +7.371907334789575e-01   +2.700357866820297e-01   +7.512428150125511e-02   +4.276217309804044e-01; +3.940488629968971e-01   +4.026051329032153e-01   +3.644524138104980e-01   +6.194642337635978e-01   +9.368277793920476e-01   +6.344966010647614e-01   +6.906992140668604e-01   -8.328356828574125e-02   +1.519992509026520e-01   +2.609219219277897e-01   +2.544642110181750e-02   +6.734706734850043e-01   +4.885669793147460e-01   +2.754642840455652e-01   +5.055815140993065e-01   +5.195284263384506e-01; +6.432771042735679e-01   +1.000000000000000e+00   +2.048851672191774e-01   -1.701316271384770e-01   +5.494367560585864e-01   +1.619475119605114e-01   +4.768872404725831e-01   +1.497804927120905e-01   +5.076443696636735e-01   -1.179845126108560e-01   +4.134867798040582e-01   +3.469409037480439e-01   +6.829736229549198e-01   -2.066223048993029e-01   +2.200914680382140e-01   -3.236654281952438e-01; -1.424965253790677e-01   +3.745739360438313e-01   +7.387302662395635e-01   +8.327282058846601e-02   +2.626614239246483e-01   +4.290770455864039e-01   +2.176743406535701e-01   +6.663506183633223e-01   +4.385785733809237e-01   +2.005427621214596e-01   +3.116608835831332e-01   +6.929326425012626e-01   -8.669456776607742e-02   +7.611787911034854e-02   +1.439346250179028e-01   +1.552423618049313e-01];
L2I_L1I_iGABA_netcon = [+2.775502144273050e-01   +1.943191453998117e-01   +8.092511903116545e-01   +9.355596190234346e-02   +6.075163245060101e-01   +5.637141135363015e-01   +6.387606431693764e-01   +1.000000000000000e+00; +2.131704394243991e-01   +1.735334086549712e-01   +4.429333990044969e-01   +3.426212826848919e-01   +6.502676374832576e-01   -9.692374352696506e-02   +2.507732462517776e-01   -1.374947855868962e-02; +6.054994226014365e-01   +4.697348310846127e-01   -4.257034322008649e-02   +2.625031867817069e-01   +5.374303948200445e-01   +1.581679023581032e-01   +4.627823280041524e-01   +4.088914149816655e-01; +5.354902074932605e-01   +6.006991905514164e-01   +3.901194890777407e-02   +4.930987206316136e-01   +1.511868134321266e-01   +1.125171526590701e-01   -6.313528046618498e-02   -7.562660069905520e-02; +3.659610434438372e-01   +5.047853319360243e-01   +4.402645117535176e-02   +1.929175758505571e-02   +6.449814155044348e-01   +2.246809202597946e-01   +5.684916765889476e-01   +4.769607354739533e-01; +5.631510961556542e-01   +5.258523533913978e-01   +4.931329790367177e-01   +5.698100702238074e-01   +3.968802206074336e-01   +1.332193165808258e-02   +4.836562242827388e-01   +2.202537604962392e-02; +3.187762015557332e-01   +5.888045109365938e-01   +4.242974776119919e-01   +6.734490282422002e-01   +7.954569108367975e-02   +2.096140145841027e-01   +1.485036047018390e-01   +4.185378125232797e-01; +5.843720401397432e-01   +3.456442742524059e-01   -1.100086072061334e-01   +3.727679020348862e-01   +1.479255629170364e-01   +3.974988070382023e-01   +3.135403922895324e-01   +2.209040938770824e-01; +2.605557660409358e-01   +1.409376540184623e-01   +5.966084748693957e-01   +2.695947769975006e-01   +3.003308693743161e-01   +9.720419426400335e-01   +3.041755874006750e-01   +8.603539225153206e-01; +5.957988312285337e-01   +3.959171728312055e-01   +1.526266154079272e-02   +3.803802920987304e-02   +4.777291311957998e-01   -2.521886910426564e-01   +1.437360070319968e-01   +3.628997180508823e-01; +2.749177160325785e-01   +5.699371736404686e-01   +3.614611294385187e-01   +8.280112386565156e-01   +2.268814174362913e-01   +4.552611817029897e-01   +9.069192994182370e-01   +6.923086712875605e-01; +6.252491224286754e-01   +9.088274801837071e-01   -2.332238840068153e-01   +9.075120306151152e-02   +2.866054214245706e-01   +4.818204118228184e-01   +3.992620212968107e-01   +3.418908453984403e-01; +9.810850008910584e-01   +3.305741666165865e-01   +6.150176836511073e-01   +1.255628837878450e-01   +4.671262686716464e-01   +1.535919362177063e-01   +7.107211553668399e-01   +1.267892102746357e-01; +5.312398558330261e-01   +3.761889226694750e-01   +4.849481976961594e-01   +1.327367880912762e-01   +3.205235257351261e-01   +3.630197799916264e-01   +3.725952915651822e-02   +4.367502205274304e-02; -1.820428885166032e-01   +7.227508741117924e-01   +5.351578970769855e-01   +2.298390882065221e-01   +3.369619104729090e-01   +5.992787296386199e-01   +3.206616802872187e-02   +4.800544567727633e-01; +1.327051564707771e-01   +6.613166233360038e-01   +2.291009611163231e-01   +4.119535172785140e-01   +1.795578752969775e-01   +3.520325915018904e-01   +2.014539696566746e-01   -5.577666044108489e-02];
L1I_L2I_iGABA_netcon = [+3.424620756302751e-01   +4.379182462149686e-01   +3.171167509148237e-01   +4.377236437962604e-01   +6.673212123084110e-01   -4.105481775356020e-02   +5.905463770417219e-01   +5.314943970554918e-02   +2.908381530029446e-01   +4.938107183370105e-01   +4.333577426439508e-01   +5.646263053665118e-01   +6.139093797228421e-01   +2.262994467415264e-01   -4.654830571892610e-02   +5.653181461326174e-01; +6.884992485510321e-01   +5.043563720173242e-01   +5.911213784576677e-01   +5.764770531026523e-01   +6.850031193242014e-01   +9.901664354387739e-01   +5.883556623951336e-01   +2.010467495696908e-01   +5.043405502142632e-01   -2.537434119123818e-02   -1.962536026966814e-02   +8.016992432724217e-01   +5.107616373699408e-01   +2.998438406345764e-01   +5.790848860347531e-01   +8.747027604919477e-01; +2.377342302000297e-01   -1.978474511833064e-02   +4.471858423300095e-01   +5.126418186136569e-01   +3.511451606682515e-01   +6.527920651887922e-01   +2.951976847947849e-01   +6.027113617013566e-01   +4.710988680512067e-01   +4.291063971516128e-01   -8.378815395001246e-02   +2.802083953161921e-01   -6.744079899447164e-02   +8.186491287826385e-01   +3.541942626683316e-01   +2.690495092320904e-01; -2.015051010867174e-01   +6.580086353467561e-01   +4.990141139885301e-01   -6.562555716835237e-02   +4.440226944284735e-01   +4.982858059376998e-01   +8.396546483545404e-01   +3.716602342426548e-01   +7.623752396328104e-01   +1.414531808588963e-01   +2.898090464511860e-01   +8.546218161158740e-01   +4.867022889071931e-01   +3.679311728760057e-01   +6.958949727132037e-01   +5.466797357010442e-01; +5.757992740616714e-01   +7.803663884532109e-01   +3.224792792297547e-01   +3.681442677599698e-01   +1.069145552300107e-01   +1.387418105385772e-01   +6.195316821680789e-01   +6.306547664229252e-02   -1.860645958081695e-01   +5.441956842691255e-01   +6.130499119210325e-01   +5.550924364179189e-01   -6.229665010472066e-03   -3.462495423989189e-03   +6.337721105169463e-01   +7.780388638547655e-01; +6.865801070105084e-01   +5.787472368605596e-01   +4.234430545590593e-01   -7.368873723665922e-02   +2.438197907964501e-01   +1.485573716638556e-01   +8.022804932318852e-01   +2.286911066602046e-01   +3.157564877622659e-01   +7.249237373977178e-01   +1.000000000000000e+00   +8.262583562949202e-02   +2.163769499938435e-01   +5.266098841315741e-01   +2.349672747001207e-01   +4.139197951286361e-01; +2.644199253642222e-01   +7.412486223428635e-01   +6.626248178453584e-01   +3.368350498144122e-01   +3.241786379746681e-01   +8.010743172809609e-01   +6.022402681797427e-01   +1.809265722587388e-01   +5.451829581129988e-02   -7.743592851303377e-02   +4.953738218578659e-01   +4.969524978881067e-02   +6.238054393546050e-01   +8.828652288769251e-01   +1.301149683797223e-01   +4.869319100079838e-01; +3.259066646184323e-01   +7.410530146105572e-01   +4.867752108413951e-01   +8.791093760590838e-01   +4.808402966810066e-01   +3.266120482409727e-01   +5.358453108384600e-01   -1.453428987705533e-01   -5.565433140344863e-02   +2.384370821200437e-01   +1.609664767780888e-01   +4.046686468193462e-01   +4.908108043236399e-02   +6.590081563798263e-01   +3.885597680972694e-01   +5.681602616278834e-01];
L2E_L1E_iAMPA_netcon = [+7.069885138526283e-02   +2.821738516552906e-01   +6.648632972620396e-01   +6.009838475182174e-01   +6.755160688909115e-01   +3.720888716813965e-01   +4.567865169058006e-01   +7.206162298086700e-01; +7.294988355285321e-01   +2.108511324806382e-01   +1.294574565104204e-01   +2.808583223924520e-01   +2.800609486895444e-01   +4.776968809311977e-01   +1.856735574490167e-01   +3.954315681866662e-01; +1.617481240798119e-01   +2.679799775263789e-01   +5.333275045833930e-01   +1.000000000000000e+00   +1.351859027620188e-01   +3.156626163940595e-01   -9.471436354248342e-02   +7.082042686568542e-01; +2.286927495428724e-01   +4.761720255006289e-03   +4.018295425563368e-01   +5.013803425372589e-01   +6.283435300030694e-01   +3.699316288918770e-01   +5.450812889179854e-01   +3.891541078782805e-01; +7.537714900703707e-01   +6.989856033322996e-01   +1.945178067242751e-01   +1.804253020110631e-01   +2.499559204511742e-01   +3.149359078804284e-01   +3.285156835314935e-01   +2.431397136486400e-01; +6.172756109318687e-01   +2.194642801317732e-01   +7.563005129494814e-01   +6.495197724370786e-01   +5.724543312404593e-01   +5.317639028735569e-01   +5.528286202496543e-01   +9.170186240165510e-01; +6.411104826183261e-01   +3.480876735912133e-01   +2.644719183155007e-01   +1.331111886497247e-03   +4.685347551920890e-01   +5.332453266142313e-01   +2.674622263119593e-01   +6.836966026165636e-01; +5.907017863970190e-01   +4.729309290706370e-01   +3.575244018502536e-01   +3.925046464643990e-01   +1.236006646347493e-01   -2.531068153538693e-02   +3.524174394449378e-01   +8.517892086377236e-01; +1.529858025502799e-01   +6.619180266205223e-02   +3.538839164062298e-01   +1.762997241188805e-01   +7.042705970808795e-01   +4.985970563375418e-01   +3.573657751419361e-01   +3.332612885220292e-02; +2.535007236548362e-01   +4.083816345406669e-01   +2.702234878931509e-01   +6.945097362148861e-01   +4.968179340063260e-01   -2.710926605653601e-01   +9.331237646742608e-01   +8.707041339440636e-03; -1.657153654482718e-02   +1.649942034566510e-01   +2.987071948366160e-01   +5.188841369321973e-01   +2.251787651022745e-01   +4.354854750211093e-01   +7.398626690101056e-01   +4.347148784003494e-01; +6.226374813208897e-01   +9.662494279631889e-02   -2.833097046443681e-02   +7.926212823067208e-01   +6.107493043158375e-01   +1.530527968678326e-01   +4.272296426195765e-01   +6.328577894284818e-01; +6.163977261925830e-02   +5.922436088781134e-01   +3.094203145421520e-01   +2.178521067637404e-01   +3.230344783738425e-01   +3.674676376254255e-01   +3.196147870656031e-02   +2.605858432438878e-01; -3.615853244096891e-02   +4.906071570387695e-01   +7.141229975832921e-01   +3.932123720799180e-01   +2.380672767365115e-01   +4.313507275212657e-01   +2.238817974671339e-01   +6.408889512749590e-01; +2.853398688464313e-01   +2.869307075846761e-01   +3.450396965345910e-01   +6.071525468367702e-01   +4.888250205895397e-01   +4.586182314511557e-01   +3.748487829327905e-01   +6.644145096305456e-01; +3.029772264289475e-01   +2.645250787026244e-01   +3.316644737704522e-01   +3.050700484798320e-01   +7.623657678750594e-01   +1.331393762693518e-01   -4.637749151114788e-03   +1.218728862300658e-01];
L1E_L2E_iAMPA_netcon = [+4.529238092474559e-01   +6.186197657126171e-01   +2.375012550140556e-01   +4.449945811013151e-01   -1.134681689391283e-01   +3.144742753338644e-01   +6.070297689256404e-03   +7.687461285941888e-01   +7.270631925144495e-01   +3.152737435064731e-01   +5.617612905568474e-01   +6.788504197371042e-01   +6.789266600453006e-01   +1.707513560760247e-01   -8.861736586312582e-02   +7.077381411793751e-01; +3.500494742082684e-01   +6.270196857475193e-01   +7.780804305879114e-01   +6.521663869725517e-01   +4.802298771206974e-01   +4.993318385012113e-01   +4.792719154528637e-01   -2.847713057018724e-01   +3.269669205156510e-01   +6.861981070309178e-01   +2.348166988452443e-01   -1.928614580557191e-01   +4.452926572817742e-01   +4.962434088998277e-02   +1.273996578623784e-01   +2.524696063227252e-01; +7.680952107069733e-03   +4.241318787313190e-01   +5.536304234230855e-01   +7.413937412612941e-01   -1.431391085294792e-01   +3.421333216071237e-01   +2.921998166503403e-02   +1.535746868890183e-01   +2.205568599883558e-01   +2.991383086268813e-01   +7.833716638150751e-01   +4.822575547209222e-01   +2.600979149793423e-01   +6.690544671388100e-01   +6.024841843380219e-01   +4.701501541585599e-01; -1.489155086877289e-01   +6.689776742391396e-01   +3.151077407462270e-01   +5.127381781671908e-01   -5.975553735130656e-02   +5.532241826038574e-01   -4.283065460747000e-02   +8.169726376824403e-02   +1.851690378724998e-01   +4.044943822435528e-01   +4.209354853529095e-01   +2.885852310529200e-01   +3.412005916135372e-01   +2.755400679757816e-01   +1.474041244206253e-01   +9.226729432087644e-02; +1.929179717072986e-01   +6.697235403111306e-01   +6.241151156482492e-01   +1.807490920489523e-01   +3.517713322708229e-01   +8.032113103319418e-01   +5.670120974424653e-01   +1.741165461890276e-01   +5.938922592812343e-01   +6.088278856908732e-01   +8.730041460054850e-01   -7.487959432005246e-03   +6.931749964117021e-01   +6.966881214803645e-01   +2.763213939451556e-01   +7.166041426937114e-02; +2.800457172517355e-01   +2.032281201572819e-02   +3.803631495096481e-01   +6.364870691313460e-01   +4.860318124654729e-01   +4.885122177010108e-01   +8.095875691655700e-01   +3.477474331984080e-01   +9.177301781490135e-02   +5.625680353885991e-01   +1.515726580244472e-01   +4.054891277220936e-01   +4.356292527533716e-01   +3.212005464668070e-01   +5.553078608054642e-01   +6.914522015476477e-01; +5.219725009625883e-01   +1.648916953897800e-01   +3.340628727814364e-01   +6.137337430917662e-01   +4.130979406501059e-01   +3.027564328509808e-01   +9.401474071116080e-01   +8.111032880807854e-01   +2.344955470089567e-01   +3.925653924338238e-01   +6.446503063865110e-01   +5.002397567183559e-01   +9.203647557026134e-02   +5.744577245097116e-01   +3.735286346972351e-01   +3.054736148382237e-01; +6.108481077139396e-01   +5.136211424245164e-01   +4.238304673446915e-01   +3.835677881812002e-02   +7.578953996182380e-01   +2.239160220783299e-01   +2.757176801062754e-01   +4.789601982047291e-01   +4.382232195586767e-01   +2.821993630512684e-01   +5.402321223945417e-01   +2.728453924965328e-01   -1.068057402231245e-01   -1.933046291442316e-01   +4.411340769902016e-01   +4.330225239294180e-01];
L2I_L2E_iAMPA_netcon = [+2.843431829534211e-01   +7.934909570331047e-01   +7.152951643101931e-01   +5.992862619277768e-01   +4.080337983324370e-01   -1.203331133509446e-01   +7.507261328573402e-01   +6.865327155825253e-01; +6.990560799760536e-01   +1.000000000000000e+00   +9.652075931644184e-02   -1.405643550305303e-01   +5.196571272057532e-01   -1.067533761540030e-01   +1.932919991185568e-01   +3.212371739178100e-01; +6.731625791886630e-01   +6.082665795236182e-01   +7.913262197668528e-01   +1.856128447591130e-01   +3.983180695626656e-01   +7.206228335923149e-01   +7.604397897728504e-02   +2.981384867006246e-01; +5.362651428889288e-01   +6.419468943704112e-01   +3.291180679727387e-01   +1.671641259326105e-01   +6.652087986855220e-01   +9.180634183363073e-01   +7.540390497241229e-01   +7.485963178585414e-01; +8.358451562026126e-01   +1.368626520682312e-01   +5.473888266803295e-01   -7.301563935604391e-03   +1.638825986713719e-01   +7.959229079550193e-01   +4.449104972895029e-01   +2.393800398734486e-01; -1.313766864926813e-02   +1.906691606517704e-01   -1.633310021180389e-02   +2.489646106559080e-01   -7.242354546645773e-03   +6.809685060870225e-01   +6.614900248475127e-01   +2.408024905813470e-01; +8.970844242742343e-01   +1.852518250190725e-01   +3.986065136814019e-01   +1.159659034667972e-01   +2.437517428488491e-01   +2.281264161681078e-01   +5.826806261239228e-01   +4.924687378598431e-01; +2.654156248594777e-02   +2.292103836177609e-01   +3.345013718714995e-01   +7.426496078586610e-03   +8.081638254435033e-01   +6.838308297046979e-01   +2.499499059554946e-01   +4.067316756531961e-02];
L2E_L2I_iGABA_netcon = [+8.097872404481521e-01   +7.409314584874286e-01   +8.554803736998281e-01   +6.044523623865564e-01   +4.547805417329961e-01   +1.996250356662528e-01   +2.514263475735081e-01   +3.694952223353567e-01; +4.063177279933788e-01   +8.976111967950844e-01   +9.816681857144665e-01   +9.876889988483121e-01   +2.869679817070979e-01   +3.195872570578645e-01   +5.426613539303599e-03   +8.106334754253126e-01; -1.286215571308606e-02   +6.716287192146241e-01   +8.533502608500119e-01   +7.390896102197224e-01   +5.861063431852054e-01   -5.127686834638333e-02   +6.951035884586004e-01   +1.368112732563258e-01; +5.697150383798355e-01   +3.364899747880972e-01   +8.462439938444800e-01   +5.721158130268272e-02   +5.853904369073698e-01   +4.272973913748830e-01   +3.604510246955471e-01   -2.222622912155822e-01; +4.671069182699041e-01   +9.321460278893996e-01   +7.013387459434928e-01   +4.654520711231768e-01   +4.133836781042682e-01   +2.753873600261812e-01   +7.563696106249687e-01   -6.351110213846242e-02; -7.973980789776031e-02   +1.931454279648682e-01   -3.053913124679923e-01   +3.669011494590277e-01   +7.494548512821545e-01   +4.409705059737991e-01   +4.076662681565800e-01   +1.242719497840763e-01; +5.508507137386175e-01   +8.291145627417419e-01   +5.195354175845296e-02   +5.088822792721939e-01   +4.216857735897448e-01   +8.707462243737514e-01   +4.984104623330434e-01   +6.985095670854370e-01; +3.771009239138720e-01   +2.435679445599621e-01   +3.863733653003198e-01   +7.073666700104632e-01   +4.637246250284403e-01   +2.935472507630869e-01   +2.031210787317095e-01   +7.753543972126312e-03];
L3E_L2E_iAMPA_netcon = [+2.057453558406325e-01   +2.652035698131862e-01   +6.366707274533232e-01   +2.861971096836872e-01   +4.831967596014463e-01   +3.221083739996806e-01   +4.644934573984415e-01   +4.691501948908376e-01   +2.239407590515008e-01   +5.536603932621872e-01   +8.474207815759968e-01   +4.040528957881146e-01; +3.480747792148055e-01   +1.908512686262882e-01   +6.302788820878816e-01   +3.361946273594762e-01   +1.582422035422713e-01   +3.131930148517757e-01   +1.284089382464349e-01   +8.340187708387096e-01   +2.156843332933438e-01   +4.249462731463527e-01   +4.170783586316387e-01   -1.765565587230836e-02; +7.589573779426521e-03   +1.151161653989689e-01   -9.587336007747331e-03   +4.499800583083315e-01   +1.055593902783822e-02   +3.623884635691702e-01   +1.356544491514060e-01   +2.581800406580889e-01   -3.784019822664622e-02   +3.405760687521237e-02   +2.630012822579081e-01   +2.279739409927004e-01; +4.747741581442527e-01   +2.923528489672354e-01   -1.252963542587361e-02   +3.052860945975023e-01   +3.869177802710785e-01   +1.461398577416983e-01   +2.786433410107209e-01   +7.685867726404871e-02   +6.153875565281959e-01   +1.637978814742128e-01   +4.113208965211817e-01   +4.713865048198789e-01; +6.725042531959623e-01   -8.920704615541973e-02   +4.882921022714490e-01   +4.466209722860404e-01   +3.170234251772473e-01   +8.095396233809325e-01   +4.001057010833960e-01   +6.278157724404343e-01   +3.483353688323346e-02   +6.846304257461668e-01   +5.420840376732683e-01   +3.778774688167917e-01; +6.323218663246314e-01   +4.905160322996058e-01   -9.870326502942095e-02   +5.312820667821344e-01   +1.650138005907944e-01   +6.119892580092565e-01   +5.854024757717536e-01   -8.327916929810374e-02   +9.983097756328047e-02   +5.765873108928306e-01   +1.891655003935845e-01   +4.969153973991024e-01; +1.720973713320881e-01   +4.177170665032818e-01   +2.202377621532142e-01   -1.568002834443984e-01   +1.000000000000000e+00   +1.321184446900862e-02   +2.856910281897451e-01   +5.712111409467545e-01   -2.151377184653870e-02   +4.203341164967310e-01   +1.519578442172782e-01   +7.112847238797816e-01; +3.263539454489031e-01   +8.683001373919332e-02   -1.123366510684213e-01   +2.210800377441536e-02   +5.211026065465693e-01   -1.439233376193488e-01   +4.131703982507290e-01   +2.050340196709878e-01   +2.378579646335750e-01   +4.045239418340990e-01   +5.027705211840734e-01   -9.780530453739842e-03];
L3I_L2I_iGABA_netcon = [+5.926873750556361e-01   +3.902899634745564e-01   +5.615772885195150e-01   +9.861982967006702e-02   +7.257364186215907e-02   +4.616603919582240e-01   +4.067324346951304e-01   +7.377518820397290e-02   +2.125076741954234e-01   +2.912042159037232e-01   +4.918166028546365e-01   +6.833002412893415e-01; +3.643567325510768e-01   -3.547590880916796e-01   -1.489383156425842e-01   +6.048521048497103e-01   +3.228495488600920e-01   +5.283569619607399e-01   +3.453789043912474e-01   +1.384277973744717e-01   +7.428940171958625e-01   +5.015128907348671e-02   +6.790794677358413e-01   +3.942449049902736e-01; +9.187646777137995e-02   +5.274554194900997e-01   +6.626081129392913e-01   +6.258793301353639e-01   -1.324095324531253e-02   +3.188919699355022e-01   +1.495623213613324e-01   +5.589549207968798e-01   +3.917877235759888e-01   +3.583759960341363e-01   +7.073176736810862e-01   +7.459167490932692e-01; -2.080191829025374e-01   +2.235208661761707e-01   +8.446353258301453e-01   +3.667526668308886e-01   +4.870141455043056e-01   +4.488083600126567e-01   +1.388374222912303e-01   +3.921404250059879e-01   -1.542116906679058e-02   +2.850018948479956e-01   -3.650237753070724e-02   +2.031416010014164e-02; +1.130262621341455e-01   +3.526993945510443e-01   +6.230144269268564e-02   +8.857479927946349e-02   +2.424343918211370e-01   +3.089652059769883e-01   +3.552522394302254e-02   +2.591169066171428e-01   +2.660561306161826e-01   +5.510093054097207e-01   +7.040000940658407e-01   +6.647078174096632e-01; -2.281154609919347e-02   +5.455395402860393e-01   +6.184187433745848e-02   +3.820920740601731e-01   +7.610148880008938e-02   +1.149667289384738e-01   -1.636989252459798e-01   +1.204746297496185e-01   +1.118166675039321e-01   +6.611742286591358e-01   +6.320463506707222e-01   +6.666875930194890e-01; +5.577230725884591e-01   +5.513679604573675e-01   +4.876612602323112e-01   +4.260931371923980e-01   +4.445095700513082e-01   +2.845675676927021e-01   +3.992686417812719e-01   +2.120646851993745e-01   +1.576488129008615e-01   +7.376596740588287e-01   +2.202580569422716e-01   +4.833036839340326e-01; +4.989052683262932e-01   +7.319703494976910e-01   +3.045562471501987e-01   +9.212740762095085e-02   +4.060380440300046e-01   -1.795771770630617e-01   +1.000000000000000e+00   +6.027374648987476e-01   +7.257364616547597e-01   +5.379801571290382e-01   +3.868526534996228e-01   +6.380030857699237e-01];
L2E_L3E_iAMPA_netcon = [+6.698832408769032e-02   +2.659907122247155e-01   +1.678842984429669e-01   +4.985572410366532e-01   +5.642648012640366e-01   +2.491265211408697e-01   +1.744485860182166e-01   +5.937693452827624e-02; +5.969415910782985e-01   +5.539246235339063e-01   +1.823970432513554e-01   +5.755339468616617e-01   +1.516628571768473e-01   +5.378614557505598e-01   +7.159787666596241e-02   +6.196093792818984e-01; +6.329259234087272e-01   +4.586426110989826e-01   +9.996125945300782e-02   -4.649393060942910e-02   +6.722373576023183e-01   -1.692717466695300e-03   +2.092239669708919e-01   +3.152711510420204e-01; +2.615705779468485e-01   +5.776739434168054e-01   +4.226026671508050e-01   +3.898017151610397e-01   +5.999077823109009e-01   +3.484029009384030e-01   +1.559415642209116e-01   +5.026906118454456e-01; +1.987875901981368e-01   -1.151532261062326e-01   +4.777920331066874e-01   +4.969369313298930e-01   +3.100201521343158e-01   +1.016525529588606e-01   +6.925225945838410e-01   +1.426507902082985e-01; +4.688852160245359e-01   +4.795892532380732e-01   +3.127678896770050e-01   +8.150160789073334e-01   +1.092647319673068e-01   +5.263140543632614e-01   +3.393564890597870e-01   +6.307245614379219e-01; -3.440936088128106e-01   +3.274245216533080e-01   +3.313006797413640e-01   +3.885964229966891e-01   +6.219692671583486e-02   +3.809640247547233e-02   +7.290007151898742e-01   +4.509435686210838e-01; +1.524297962317048e-01   +7.840561694357288e-01   +2.532855057323586e-01   +2.459247783971101e-01   +2.966604652515594e-01   +4.305728429753566e-01   +5.535800638639787e-01   +9.346659542428376e-02; +6.815833290303764e-01   +7.303770484787443e-01   +4.382158500131328e-01   +7.378527371095907e-01   +1.766610238635735e-01   +4.659593483726698e-01   +5.501493194001734e-01   +1.000000000000000e+00; +3.474112714551608e-01   +7.439289762722899e-02   +2.226495182648143e-01   +6.178776690242710e-01   +3.249541075355745e-01   +2.104991235995088e-01   +7.435187176807716e-01   -2.741612538310735e-01; +7.694933220539944e-02   +3.344000810307288e-01   +6.347150955843134e-02   -6.525003329023860e-02   +2.614229228017709e-01   -5.653556504283944e-02   +2.251266548750539e-01   +8.650895537695000e-01; +4.539474654700525e-01   +2.232536595357124e-01   +5.126023687155176e-01   +6.303454106371447e-01   +7.661594213540455e-01   +1.293932082200495e-01   -4.557521955917451e-03   +5.246706361392305e-01];
L2I_L3I_iGABA_netcon = [+2.463220374727366e-01   +3.894849494392590e-01   +3.356158907935655e-03   +9.925913870977283e-01   +3.345403647748367e-01   +2.189579252393424e-02   +5.584338327282017e-01   +2.146733390291525e-01; +2.570374205428744e-01   +1.946620286142486e-01   +1.093578455150278e-01   +2.505018570844181e-01   +5.166606709111321e-02   +4.376646558419656e-01   +8.721322036974268e-01   +3.286284740254702e-01; -9.643581295839712e-03   +4.180340830429761e-01   -1.548101807273293e-01   +6.596967461661781e-01   +1.822773427181476e-01   +1.545568983504137e-02   +2.051525863045617e-01   +4.518061931485566e-01; +1.215028443540515e-01   -5.052654094774509e-01   +4.197063395071091e-01   +4.991403391670726e-01   +7.055276151509358e-01   +2.311757052823789e-01   +5.886821872574923e-01   +1.655320590913076e-01; +3.196835320390113e-01   +4.619885306264994e-01   +3.920314095138140e-01   -4.813977131509285e-02   +3.949109162913458e-01   +2.527411222144772e-01   +3.631893479444877e-01   +6.630920696866239e-01; +9.033000047532294e-02   +4.741346804842813e-01   -6.995536604980369e-02   +5.216160076247023e-01   +4.037089751605752e-01   +7.402500398501159e-01   +4.935140444220147e-02   +5.046659636154200e-01; +6.206229030794769e-01   +2.766933602529002e-01   +4.270607266205173e-01   +5.536373501846752e-01   +4.154078071343324e-01   -1.662687389128272e-01   +9.996265206842263e-02   +3.450055346999753e-01; +4.256098382882405e-01   +7.245299739818525e-01   +5.128052791889052e-01   +1.703046340099184e-01   +1.147972821086475e-01   +5.211464353318318e-01   +2.197570619256678e-01   -1.788044257803085e-01; +3.322458292071543e-02   +1.138635762903937e-01   +3.073671865031905e-01   +3.646555879926285e-01   +6.239578322979976e-01   +5.160023554615830e-01   +4.155863701447811e-01   +2.373696320770385e-01; +5.385151129117181e-01   +9.705540417954907e-02   +4.474090377033929e-01   +3.240394445165118e-01   +4.254037330449041e-01   -8.339833074964056e-02   -7.288704301114056e-02   -3.899258254741633e-02; +3.120066481488806e-01   +7.899953736615497e-01   +2.338256486135153e-01   +5.340496936819042e-01   +1.883132407599123e-01   +1.114548950093397e-02   +3.260920803065275e-01   +1.290764092439959e-01; +4.258466629290852e-02   +3.338027445764323e-01   -3.419612329438056e-02   +1.889167033587950e-01   +7.004117382735123e-01   +5.965961712749376e-01   +7.159256962510991e-01   +2.020294978723339e-01];
L3I_L3E_iAMPA_netcon = [+1.628915733687774e-01   +6.791946317879741e-01   -1.447148398960814e-01   +2.787896102662553e-01   +9.330697068795500e-01   +1.428642633399516e-01   +5.800180131767015e-01   +7.088247901690596e-01   +6.621339975633013e-02   +1.365354649740627e-01   +1.897703568739184e-01   +3.970420207320632e-01; +6.554283465221020e-01   +8.037523829369962e-01   +3.807355442343452e-01   +2.938816120658136e-01   -1.350761423403574e-01   +6.916728321851990e-01   +5.748746829646589e-01   +8.763424407295162e-01   +9.984050676964538e-03   +7.629199807242723e-01   +3.344083754935139e-01   +5.093486014081838e-01; +5.391307091155044e-01   +6.093310000383380e-01   +1.453518690933063e-01   -3.288509738716012e-01   +7.963983224093406e-01   +6.562274634081857e-01   +4.793275242447422e-01   +8.088119482960685e-01   +1.250275023640585e-01   +4.620218491946340e-01   +8.921307924079834e-01   +4.380918312158081e-01; +7.052679769425961e-01   +3.817308930154730e-01   +3.645566948787006e-01   +8.733586289626505e-01   +8.224116297286083e-01   +9.167859159994521e-01   +8.222197120786381e-01   +6.730229900449497e-01   +5.980495622356440e-02   +6.179314713276927e-01   +3.864993564042952e-01   +7.492412436677632e-01; +2.367692101226748e-02   +7.590379022497495e-02   +2.465975551156783e-01   -1.579779482776993e-01   +6.608661884383219e-01   +8.689363254789583e-01   +8.249340537521078e-02   +7.387087201926493e-01   +8.381789278270257e-01   +3.380314183526973e-01   +6.592451859221554e-01   -2.013567706358535e-01; +2.920895421474232e-01   +8.570205553213779e-01   +1.579767270831959e-01   +5.313094253162972e-01   +4.467364630761204e-01   +1.032596943027640e-01   +3.836112786441304e-01   -1.466566032770291e-01   +3.318463723918434e-01   +3.138521741317004e-01   +3.148142348303565e-01   +2.913000796759990e-01; +1.920399615473160e-01   +2.122695909713755e-01   +2.953180032092208e-01   +6.574997772339237e-02   +1.000000000000000e+00   +3.473485155207099e-01   +4.319906046141297e-01   +5.676734148589153e-01   +2.173082653865984e-01   +5.162652406064703e-01   +3.221547572604804e-01   +2.915835425203666e-01; +3.105942425084339e-01   -3.159501604814997e-02   +3.916563230513293e-01   +1.175752385436647e-01   +2.577145794766535e-01   -5.277748919390020e-02   +1.813377997465776e-01   +3.224315832085047e-01   +7.859916420415272e-02   +7.145624077791382e-01   +3.140324275869179e-01   +4.232593187158680e-01; +2.051949743280149e-01   +3.551771948116304e-01   +4.912466604550275e-01   +2.928372129936130e-01   +4.851502275626768e-01   +1.090004782705164e-01   +2.379382223679543e-01   +1.874350723723232e-01   +5.754881642549333e-01   +3.625381930220559e-04   +3.576776053071877e-01   +4.831273792082722e-01; +5.311101877925088e-01   +6.617779510695386e-01   +4.765238109302446e-01   +5.033316260287731e-01   -1.374090910879797e-01   +4.679902144348559e-01   +6.753139205033271e-01   +5.960570377219830e-01   +7.728039019990799e-01   -1.403974595349989e-01   +6.442014980774942e-01   +3.199348548098733e-01; +2.832528458471098e-02   +1.301742897914132e-01   +3.761465906282929e-01   +4.250508968809952e-01   +1.508741359641403e-01   +2.904197056994308e-01   +1.235575398002157e-01   +6.421459745479299e-01   +9.110947597436448e-01   +7.323983544856408e-01   +1.764948156372781e-01   +4.219705310694318e-01; +1.218263900388257e-02   +4.522598597992161e-01   +8.787087794985389e-02   +6.434678232020798e-01   +9.298890675633944e-01   +1.126995993195062e-01   +2.486537125377401e-01   +3.318995697972033e-01   +5.406522866909813e-01   +4.090367438334251e-01   +4.419318948561062e-01   +2.982342902163080e-01];
L3E_L3I_iGABA_netcon = [+6.324102788486374e-01   +5.550726535102354e-02   +1.057722326738236e-01   +5.811870672393447e-01   +4.437203714395209e-01   +8.181025742994996e-01   +7.221187038806044e-01   +7.622055773914993e-01   +5.942577608393034e-01   +1.794178066261391e-01   +2.574245880145449e-01   +4.999010822616115e-01; +4.846075682321236e-01   +2.360307960503162e-01   +7.529934889184232e-01   +1.235902973792641e-01   +2.940959968165119e-01   +7.289295185038477e-01   +9.470712563841976e-01   +1.552606128262279e-01   +4.037858999475247e-01   +2.697542242154333e-01   +1.337964958238790e-01   +4.868031404829558e-01; +9.318815440999204e-03   +8.183387295285428e-02   -1.755223057227285e-01   +3.673559552046621e-01   +1.587834951375196e-01   +4.029156275180431e-01   +4.339654964568984e-01   +6.052614791518411e-01   +6.161743638959445e-01   +6.349187315136927e-01   +5.265493619768251e-01   +3.420467708166021e-01; +4.559352226346981e-01   +7.217342940155824e-01   +5.673067341903320e-01   +1.379293250178550e-01   +6.116196122116244e-01   +6.211277603051073e-02   +3.855422483510287e-01   +4.006555622876492e-01   +4.064637734569976e-01   -5.746502964063843e-03   +4.142629141332943e-01   +3.881214582141120e-01; +2.139875970023827e-02   -5.614589777936310e-02   +3.358630235947321e-01   +3.919134561859097e-01   +2.777754770490290e-01   +9.756789667585891e-02   +5.370845866652707e-01   +3.634012680142505e-01   +2.655847891615595e-01   +1.617037890105058e-01   +3.417532491068198e-01   -4.188197044553577e-02; +6.100429013056468e-02   +3.646437845272671e-02   +5.955471450754357e-01   +6.210394151997116e-01   +5.015513729772729e-01   +8.935543136205004e-02   +6.068363253903331e-02   +1.858680136285123e-01   +3.618648489708887e-01   +5.012332471766621e-01   +4.850943773212364e-01   -2.102629884657723e-01; +6.095476287055870e-01   +2.042515705496640e-01   +5.809845230588317e-01   +2.094023901004395e-01   +4.627372857155953e-01   +3.519494085600481e-01   -1.288648947348377e-01   +5.836181103520717e-01   +4.965435933069139e-01   +2.973191772804092e-01   +4.821760637823441e-01   +2.802058495728321e-01; +7.134488741198666e-02   +1.033349122974152e-01   +2.124928626437785e-01   +6.548986187037589e-01   +5.770536974308762e-01   +1.632196435328513e-01   +5.453835050374918e-01   +4.734953974222436e-02   +2.874432519298686e-01   +1.576899844642200e-01   +4.625705657957117e-01   +6.872506701571913e-01; +3.221567422247871e-01   +2.937047206039286e-01   +5.245334111201748e-01   +7.261293445774826e-01   +5.038072445485053e-01   -1.806047659359034e-01   +5.422281047010361e-01   +5.491588502168351e-01   +2.894209904862289e-01   +9.935545516706674e-02   +4.373925666431640e-01   +6.425977182433664e-01; +3.051621800690828e-01   +8.011315196261433e-01   +8.818060147713890e-01   +8.759089340372923e-01   +2.718484058474190e-01   +2.161382843371704e-01   +6.864829396217574e-01   -1.726471275429603e-01   +7.758235551437349e-01   +4.235102039999630e-01   +2.745714782158071e-01   +1.501174371328623e-01; +1.781183347735366e-01   +4.280814640449955e-01   +1.583192017119711e-01   +5.473270172483318e-01   +5.215912669990749e-01   +1.717192476427340e-01   +5.538251900069686e-01   +6.345516220612855e-01   +6.606992220222420e-01   +3.141604825613476e-01   +1.534497255576900e-01   +7.388525304564478e-01; +7.390538031262465e-01   +1.688854375763967e-01   +4.063135737061944e-01   +5.127644732952693e-01   +4.223408717068152e-01   +5.062177315358812e-01   +3.917408972729748e-01   +3.713733020416463e-01   +1.667227234987165e-01   +3.806256584112088e-01   -7.898426833532719e-02   +2.128410386434018e-01];
L2E_Input1_iAMPA_netcon = [+5.211003032650544e-01   +6.738023626967580e-01   +5.457541421471381e-01   +6.851632183957551e-01   +8.234238659600251e-01   +5.238066546896634e-01   +9.477132206404437e-01   +4.996474860211488e-01];
L2I_Input2_iAMPA_netcon = [+7.603020172729040e-01   +5.477636064498574e-01   +6.298723749609919e-01   +6.446250055802167e-01   +6.003072457907715e-01   +8.399446455261852e-01   +2.499735798425988e-01   +5.357920742537984e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
