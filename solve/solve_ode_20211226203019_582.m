function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.212793390953659e-02   +1.408100455542004e-01   -2.319516579291031e-01   +1.278373197320469e-01   +3.874824939520239e-01   +1.829661606648178e-02   +4.571344051708457e-01   -2.500727353489951e-01   -3.799823050447180e-01   +2.763810794179602e-01   -8.234796225844900e-02   +5.136237680104743e-01   +1.516542746047217e-01   +5.562230437735236e-01   +1.937963136705647e-01   -1.319186975797764e-01; +2.284981696778257e-01   -1.810545280983514e-01   -2.319282470982600e-01   -3.402124351525036e-01   -2.324045112979355e-01   +2.995793842395479e-01   +1.109817395440862e-01   -7.878130251180682e-02   -4.654675639382486e-02   +2.175584453586746e-01   +5.209219440936971e-02   +1.069243216340596e-02   -3.666742821940874e-01   -1.734965416760059e-01   +9.516892456625299e-02   +2.315994004872632e-01; +2.994308490128623e-01   -5.978410709241960e-02   -6.599299521212559e-02   -1.418971230209605e-01   -2.379517500469109e-01   +1.246261407957266e-01   -5.749862160033165e-02   -4.632280962024843e-02   -1.625994310348025e-01   -1.693609687824817e-01   +3.052970285431054e-01   +9.567341198068983e-02   +2.433387916760763e-01   -1.805239758992749e-01   -3.280155985533638e-01   -3.522276674532434e-01; -8.344434850556977e-03   +2.454682778579335e-01   -1.462309292047964e-02   -4.425772866653287e-01   -6.816724155227069e-02   +9.272991740043726e-02   +1.974819959904294e-01   -3.818112892540535e-02   +3.724933924879886e-01   +2.014486783773069e-01   -1.081001598430522e-01   +7.341376697550978e-02   +2.062902764791352e-01   -1.014135322490058e-01   -3.753538965978651e-01   -4.204708388426175e-01; +3.598195811726820e-01   -1.095714106382426e-01   +2.752573603031099e-01   +1.045132193226528e-01   +3.838367563681089e-01   -2.825786174661290e-01   +3.554437550724814e-01   +3.574216645037883e-01   +1.572087141491046e-01   -1.780888319969655e-01   -1.065976224836453e-01   -1.221457836451182e-01   +2.218052628766766e-01   -9.187084136144784e-02   -5.554826691575396e-01   +2.956659323980090e-01; -1.007488337175110e-01   +3.692215092528386e-01   -1.724334292364059e-01   -1.729038068622434e-01   -2.290505483600774e-01   -4.338694467025043e-01   -5.484501478839263e-02   +2.508149031858486e-01   +1.296412336951295e-01   +1.782790105598078e-01   +3.570154476615101e-01   +1.057100337059475e-01   -5.554590909719061e-02   -1.672669608573557e-01   -4.371420746602004e-01   +1.952244928969733e-02; -3.993804784238864e-02   -1.590827213672368e-01   +3.338984960628063e-01   +2.308839805788438e-01   -1.291237232665859e-01   -2.924657732876081e-01   +1.275508454313518e-01   -2.869869982161266e-01   +6.565091492015564e-02   -8.666908205768023e-02   -2.893812838162020e-01   +1.012176886556716e-01   -1.661463301661382e-01   -1.709048178821189e-01   -5.375075533100937e-02   +4.254648054174996e-01; -6.648116434171978e-01   -9.163246119123225e-03   +5.943468301293132e-02   +2.406308849767411e-02   +1.136821907103656e-01   -3.982149121066943e-02   -1.771821721251924e-01   -2.123306562883264e-01   +7.945478186294203e-02   +5.494676723331827e-02   -2.018803275409586e-02   +4.609864240230648e-01   +4.015929404731106e-01   -6.100970617313283e-01   +1.172551774461176e-01   +3.038097213705140e-01; -1.808706465134639e-01   +3.044511579718160e-01   +3.726394772595001e-01   +1.589224095062458e-01   -2.402762331092269e-01   -3.477545304272892e-01   +2.752062496422323e-01   -2.038462449031331e-01   +1.807621589190417e-01   -4.026976926902668e-01   -9.983536859443370e-02   -1.709442004986111e-01   -2.202183926100571e-01   +3.826162899208942e-02   -8.476181369281538e-02   +5.390214168399299e-03; +6.208532849546437e-02   -1.936314249158193e-01   +2.770987183133121e-01   -1.090726073420428e-01   +1.878360725245368e-01   +3.202701491290139e-02   +1.677375546952364e-01   -1.930344713790810e-01   +3.019451124456358e-01   -2.340668626022698e-02   +7.334951221674398e-02   +6.728682628686225e-02   -4.013295513921674e-01   -1.421019288927753e-01   +6.087504987849501e-02   +4.127735041764216e-01; +3.559335549774116e-01   +1.168203270585402e-01   +1.065801003009970e-01   +3.391609943033816e-02   +9.628758353583891e-02   -2.946955225893738e-01   -1.148593541684971e-01   +2.916687169291340e-01   +4.273266657855005e-01   +4.545592008860062e-02   -3.899310851240792e-01   -6.824123896409152e-02   +2.270947104636382e-01   -8.878091150570522e-02   +5.016868861965015e-01   +1.848780293795798e-01; -1.925024910216993e-01   -1.841269886226191e-01   +6.006702497608432e-02   -2.823782390262846e-01   -2.847257435567688e-01   -2.000798947050474e-01   -2.290236287764359e-02   -1.340358907571746e-01   +2.578242946726987e-01   +3.633772190995521e-02   -1.714770610210687e-01   -5.807027970622658e-03   -4.140268808937292e-01   -1.046424329194356e-01   -1.457444119681374e-01   -3.618963964239810e-01; -5.245283868420622e-01   -2.102923460728240e-01   +3.929136057536202e-01   +3.866220350873630e-01   -1.838021780276432e-01   -8.870614784249151e-03   -4.209956228513597e-01   -7.859263214774707e-02   +7.824363277238791e-02   +4.472270645631804e-01   -4.612876263637224e-02   +8.882032519948196e-02   +2.364964372917446e-01   -2.013216328805453e-02   +3.040008334907788e-01   +1.087012994365712e-01; +2.032937504973886e-01   -2.042084154487392e-01   -1.041390680357175e-01   -1.818124028533016e-01   +1.135794610938264e-01   +2.282689377203040e-02   +1.155256450515894e-01   +4.054815144676128e-01   -3.351436982263465e-01   +2.114957651303384e-01   -3.044616895334674e-01   -1.819322977906969e-01   -5.016243947442203e-02   -1.354029942629108e-01   -2.758492853430335e-01   -1.751383336646516e-01; +1.813513565646680e-01   -7.657432148998755e-02   +3.583347307309717e-01   -2.655734911346050e-01   +7.632147664612571e-02   -2.906126205235348e-01   -3.755550845334297e-01   +2.106626464403266e-01   +5.875274288997141e-02   -6.030029587606911e-02   +1.139236585399605e-01   -3.295848866483533e-01   +2.458072188112638e-01   -1.077202782555196e-01   +3.273765385880837e-01   +1.610343695308484e-01; -1.538587701020894e-01   -3.688359339266213e-01   +1.414869765396969e-01   -3.351068163930213e-01   -4.102052819297739e-01   -2.874880088560683e-01   -1.357481754502183e-01   -3.425971068875944e-01   -1.719307956958651e-01   -1.286807666174817e-01   -1.774704314954543e-01   +3.383487092864196e-01   -3.349898724935303e-01   -2.918373131840138e-01   -1.702528310467413e-01   +1.344371537491213e-01];
L1E_L1I_iGABA_netcon = [+6.804145486367923e-02   -1.260169493423557e-01   -3.744112463835502e-01   -7.932336477981589e-02   +3.123188848436374e-02   -4.003381319257064e-01   +1.051692769504880e-01   +4.085702307559697e-02   -2.042721786489296e-02   +1.224219266599453e-01   -4.769935988756496e-01   +1.962860410917502e-01   -3.051238036286249e-01   -1.380858171570171e-01   +4.523664215730904e-01   -1.254632759779707e-01; -4.963367102951441e-01   -1.632620103947510e-01   +1.787535578646091e-01   +1.469614148459747e-01   -2.366840663431489e-01   -1.259502449508697e-01   +6.853136392610856e-02   +2.073937299280763e-01   -6.188523673984822e-02   +1.114821683593982e-01   -1.063983912005753e-01   -2.337755442737316e-01   +2.462974486034038e-01   -2.526463930650169e-01   -1.234978203610823e-01   -2.338875737046436e-01; +1.353405198535264e-01   +9.045099589399631e-03   +5.555365889692154e-01   +2.788852495475163e-01   +5.041693182238158e-01   -1.714987783939587e-01   +1.748111457870173e-01   -1.476814198975372e-02   +3.034711335386078e-01   -1.267208544844337e-01   -4.148835197333810e-01   +5.349610897309914e-02   +1.178405009074738e-01   -5.255500588918878e-02   -3.041730251622636e-01   -1.326445702665467e-01; -3.563631064240751e-01   +1.039864381756999e-01   -3.141402733940439e-01   -1.782228234775830e-01   +8.691604340639084e-02   +1.727878663422907e-01   +3.715131550558813e-01   -1.883232158062566e-01   -3.378042919532537e-01   -4.393384506966644e-01   +4.811676689833391e-02   +2.168431879118051e-02   -4.220552102992847e-02   +9.782961518479920e-02   -1.207347671118541e-01   +2.207150308594880e-01; +3.103147944834436e-02   -1.632027719521837e-01   +1.360554105604128e-01   +4.075972182229597e-01   +6.098127081908337e-02   +2.236792666948910e-01   -3.999784516109336e-01   -4.608641165061825e-02   +4.313073559182617e-01   +3.340832254604501e-01   -3.151686506173343e-01   -2.417368265982837e-01   +2.851837520738125e-01   +1.506889952394891e-01   +2.309446653851950e-01   -2.406060843486688e-01; -7.862845444984157e-02   +3.799182082383457e-01   -3.292169856631681e-01   +4.587075873538106e-02   +1.401217550391928e-01   +2.906533707701080e-01   -1.944039800050179e-01   -1.633331856764487e-01   -4.210256978332219e-02   -2.678581171350691e-01   -3.392905232598526e-01   -1.770650229114696e-01   -6.803765339372041e-02   +1.879509447213609e-01   -1.317076061723501e-02   -8.023431156243979e-02; +3.756071049054789e-01   -4.976115909918964e-01   -6.037011164234773e-03   +1.795960387093324e-01   -3.500204154249659e-02   +5.704482609046659e-02   +2.177088350412698e-01   -7.829302050796549e-02   +2.528974199180808e-01   -4.536446596627727e-01   +4.191050269530543e-02   -1.286094888932798e-01   +2.890748835130367e-01   +2.461238344924762e-01   +9.573925131430333e-02   +1.467776469703297e-01; +1.882504659339004e-01   -1.961552565029709e-01   -2.207411122927761e-01   +4.025818529847034e-01   +9.279014226673665e-02   +3.351793320708547e-02   -1.534182248355592e-01   +3.202029519693791e-01   -7.639653567717221e-02   +6.800068664585368e-01   -2.713726929592900e-01   -3.810364096459160e-02   +2.945012687085120e-01   -2.612238954203150e-01   -3.468135533810130e-01   -3.771130409085700e-01; -4.021391509644896e-02   -1.988081991154092e-01   -3.778162307010731e-01   -9.058817009277383e-02   -4.608859592029302e-02   +3.710128076828714e-01   -9.348012532988552e-02   +5.564007653723516e-03   -5.612834110382151e-02   -5.902963763296005e-02   +9.271615433914153e-02   +1.202984332731109e-01   -2.325441367492971e-01   +1.905301182249561e-01   +3.068559382484499e-01   -2.957982607199129e-01; -3.997737327044306e-01   +1.102557082825169e-01   +2.102793271281162e-01   -1.677535443275556e-01   -7.758470256182370e-02   +1.857275646276398e-01   -2.239240893320126e-01   +2.610716943322318e-01   -1.865486415780146e-01   +5.456305176444681e-02   -5.398838122031263e-03   -2.913141840924032e-01   -3.630389534310217e-01   -2.909696495152632e-01   -1.363251745355070e-01   +5.748981503493628e-02; -3.585069053858359e-02   -3.131414300172671e-01   -2.863941458999372e-01   -2.655964439605871e-02   +2.101334973446356e-01   -2.781407532301345e-01   +4.594261012532398e-01   +1.800321022430651e-01   +3.253101036106918e-01   +1.303648538619878e-01   +5.551902934973174e-02   -4.524818673433151e-02   -1.055443238085700e-01   +1.318039769493695e-02   +3.486806356069886e-01   +3.060849902624587e-01; +5.762215529496109e-01   -1.865817499781047e-01   +3.254760306327689e-01   +3.586355424322248e-01   -3.481198333742053e-01   -9.048993825618956e-02   -4.565621003838427e-02   -1.404535104600586e-01   -1.251559106968195e-01   +2.383094891495205e-01   -1.703930471012919e-03   -8.099732052682798e-02   +3.351419340310785e-02   +1.581261506585867e-01   -4.132530926437017e-01   +6.658684732513059e-02; -3.549738513542588e-01   -2.151893017284773e-01   -8.652262882610937e-02   +5.555210208876571e-02   +5.512532843913264e-02   -3.511279197682887e-02   +2.239619830645553e-01   +2.321612815079960e-01   +3.088902848039933e-01   -3.882673320228405e-01   +2.825125994026028e-01   -2.951388708751320e-01   +2.458478433205499e-01   -1.055446755101107e-01   +1.952482589093384e-01   -3.458932737547341e-03; -1.397452371002270e-01   -3.990964672342389e-01   +3.971046049811569e-01   -1.251131659296172e-01   -2.605273336716868e-01   -1.534057113221306e-02   +3.498951416316431e-02   +2.875704660858939e-01   -2.024458015953863e-01   -8.742428971875679e-02   -1.576461610977686e-01   +1.290377080696196e-01   -1.081117170845790e-01   +6.927050262713115e-02   -4.239476912854341e-01   -1.606395004497033e-01; -4.034384989950610e-01   -1.011821993244905e-01   -1.106048450361639e-01   +6.371080307472449e-02   -1.322713861949780e-01   -8.762348307522350e-02   -3.093155152837812e-02   -2.638204772479500e-01   -3.599342940793303e-01   +1.685596145529726e-01   +1.990102672344818e-01   -3.269777267704477e-01   -1.903293730746840e-01   +1.315037810855716e-01   -3.708890175251998e-02   -1.369563985677110e-01; -4.431867778391010e-01   -6.016998393783870e-02   +1.488627409490794e-01   +5.062208017872599e-01   +3.318178991697889e-01   -2.910414685045241e-01   +2.521380987121488e-02   -1.062895647492143e-01   +2.244687905772456e-01   -3.849428085914053e-02   +2.731273823420034e-01   +1.103690837709305e-01   -4.488159371874878e-02   +2.506016667826323e-02   +4.418992456132965e-01   +2.783255781994141e-01];
L2I_L1I_iGABA_netcon = [+3.391068178004168e-01   -1.419588103312933e-01   +3.212902690437791e-01   -4.688833061161848e-02   +2.411072095973479e-01   -2.678946911715248e-01   +3.835674369011323e-01   +8.249972204199593e-02; +2.466239082483630e-01   +1.454775462426880e-01   -2.495670056597308e-01   +2.443446183451573e-01   -9.813098615637127e-02   -3.277946567295784e-01   +3.470485413711289e-01   -2.823268223511579e-01; +2.429298729348542e-01   +3.565802826821692e-01   +4.948549477192935e-02   -2.082861387423781e-01   +3.297059788676995e-01   +3.329991766308622e-01   +2.795203094424749e-03   -2.191770077296654e-01; -3.350622553872373e-01   +2.038189975267916e-01   +1.018771126103746e-01   -5.373708505147443e-03   -1.415326000088558e-01   +3.191811423853760e-01   +8.023121619316512e-02   +4.195723587979552e-01; -5.335795441889454e-02   -2.029699235808490e-01   -2.937617905764300e-02   -2.772503726235847e-01   -1.041205879575126e-01   +2.613177192480610e-01   +3.363148802290664e-02   +4.659850941999503e-01; -1.354980032732080e-03   -7.743668260215733e-02   +2.423035065788862e-01   +3.394338834933172e-01   -2.586004483775802e-01   -4.086320399766507e-01   -7.391854405853847e-03   +2.753221706095156e-01; -1.310343412267799e-01   -1.776185008417930e-01   -7.469043428772745e-02   -2.653042744894704e-01   +3.110840781109455e-01   -9.833581239238459e-02   -2.195654982616642e-01   +1.122046310728037e-01; -2.212273626366937e-01   +2.467551299856750e-01   +2.912949482267658e-01   +8.876867288435825e-02   -2.944959116952377e-01   +3.187297069983543e-01   +2.676345436406735e-01   -3.901366387578741e-01; +1.963638814656042e-01   -6.299783225150070e-02   +2.442164988801157e-01   +8.349122769838715e-02   +4.295475120097100e-01   -1.584538556926683e-01   -1.720713199364239e-01   -4.737349290912550e-01; +3.298639400246641e-01   +3.683889624025220e-02   +5.813345352192115e-02   +2.847415051876746e-01   -8.020087333389371e-02   +1.040224329170448e-01   -1.485850935089527e-01   +2.440843891647987e-01; +4.020888097792000e-01   -1.824430034577565e-01   -1.702133857613369e-02   +2.551934533799234e-01   -1.780623009186813e-01   -1.448426142412156e-01   +2.617351609743060e-02   +3.146938521926271e-02; +7.207818680683956e-02   +3.225332144579261e-01   -1.235358904793500e-01   +2.667302590414889e-01   -2.210472171090702e-02   -1.504909241765480e-01   +3.416769231042239e-01   -2.566795707038649e-02; +3.876033587697845e-01   +6.535224994238351e-02   +2.810600004905638e-02   +1.065945819381954e-01   +5.642194980118962e-01   -6.148718267084774e-02   +2.524538261809726e-01   -3.109090221251241e-01; +2.062221497572432e-01   +1.584832749922978e-01   +1.473537734416866e-01   -9.783303628865601e-02   -3.067782543015484e-01   -2.617335283374174e-01   -1.952293831810576e-01   -2.608419949295373e-01; +2.486438057882734e-02   -4.289033351906834e-01   +1.855330588436787e-01   +3.280545740078575e-01   -1.492121549075783e-01   +1.463633701197250e-01   -6.109935845346148e-02   -3.547974546609307e-01; +1.266177536565049e-01   +1.091221301542258e-01   +3.692363648597171e-01   +3.746369440876740e-01   -8.993921078631839e-02   -1.511092791171899e-01   +4.003029279221750e-01   -2.592385079961488e-02];
L1I_L2I_iGABA_netcon = [+1.639719829310152e-01   -1.107703683968564e-02   +3.265882966380884e-02   +3.427455249223642e-02   -2.721156537621762e-01   +1.232709269677433e-01   +1.105703675989750e-01   +4.474846960441412e-02   -4.927979992388218e-01   +1.772444580911776e-01   +4.734228094740590e-01   +6.879579718142856e-02   +1.356459614051107e-01   +2.275543087501612e-02   -3.208244024216906e-01   -2.729350884058916e-01; +3.097334406624033e-01   -7.819041555101006e-02   +1.844977806362536e-01   -8.230697843900255e-02   +1.630507449177631e-01   -3.657825763535840e-01   -6.271138422998179e-02   -1.780546044959968e-01   +2.375416338513665e-01   +3.159247467540628e-03   -3.526843658937281e-02   -4.971844925359623e-01   -3.006352885744766e-01   -4.403822981193530e-01   +1.002953940905368e-01   +3.846249041788858e-01; -4.202260847921567e-01   +1.741476508925517e-01   -4.065133733543921e-02   +1.872021920735404e-01   -1.645942021281185e-01   -3.039784324315214e-01   +2.218139336132557e-01   -2.151207491217516e-01   +1.040820553498312e-01   -1.908278638367002e-01   +3.190711955398045e-02   -3.273178193337593e-01   -2.828617873861063e-01   +2.870596354085156e-01   +2.271915257912872e-01   +1.873898573989278e-01; +3.012831483757199e-02   +1.410965336024833e-01   +2.126080345438604e-02   -3.644967655925566e-01   -1.049578354153753e-01   -3.942792467973952e-02   -9.335670880863632e-02   +2.297166333290626e-02   +1.101325784341726e-01   +2.983938219998811e-02   +1.221229022275133e-02   +5.746419518978401e-01   -3.499942666293562e-01   -4.575849769282383e-01   +2.927205365056618e-02   -1.584813568496606e-01; +3.297034062500674e-01   -1.698900730265894e-01   +6.821488336996791e-02   +1.341261211705859e-01   +3.914053919495573e-01   -1.420215620266797e-01   +1.361850176476821e-02   -4.941833962959000e-01   -1.318318313107791e-01   +1.982437361062413e-01   -7.553647392007035e-02   +2.103619191574458e-01   -1.768004871297687e-01   -2.021397873732766e-02   -5.371633313511398e-02   +2.093071578484191e-01; +2.684577486175732e-01   -4.962163296286398e-02   +7.514112100435608e-02   -2.006671946626207e-01   -2.821235442435360e-01   -1.812128974192367e-01   +6.527749702665375e-02   +2.955932171755617e-01   +1.220886671063037e-01   -8.704415968033401e-02   -3.237232058536276e-01   +8.945010698959657e-02   -3.420972523081912e-01   -3.100144876565529e-01   -1.805090711827548e-01   +1.387952576807403e-01; +2.630748098894825e-03   -2.919635877141420e-01   -9.135731890812152e-02   -2.252520236771605e-02   -1.847664610328148e-01   +4.457178279607377e-01   -1.285689550869573e-01   +3.824164334168703e-01   -1.335280311362507e-01   -1.692779023308593e-01   -4.982944148095256e-01   -3.294848393996567e-01   +4.444172838799744e-02   +1.794823543255679e-01   -1.295607031736244e-02   -9.492013022121441e-03; -4.359245079392969e-01   -5.672073059827246e-02   -1.815095653854247e-01   -2.782653964480418e-01   +2.205562040014378e-01   +5.723479325984317e-02   -2.337918534038543e-01   -3.848302484219246e-01   -8.517983489124321e-02   +3.903090801915609e-01   -3.974304684329379e-01   +1.631025303510232e-01   -2.812676392086505e-01   +2.928947353867036e-01   +2.527604690407486e-01   +4.618493733939938e-01];
L2E_L1E_iAMPA_netcon = [+8.980811719449383e-02   -3.895166028456153e-01   -3.218738369414041e-01   -1.538844288903668e-01   +2.431584512368430e-01   +4.257653463238013e-01   -1.489499845881222e-01   -4.754791001882962e-02; -4.234964412198244e-01   +1.529669922638818e-01   +2.995479665930050e-01   +1.993757857657199e-03   -1.900752020074791e-01   -4.529784714617066e-01   -7.669883247037473e-02   +6.979903388648839e-02; +1.689111136789008e-02   -1.982415134017040e-01   +1.126193771711489e-01   +4.852703445293939e-02   +1.902584660039480e-01   -4.795031653751662e-01   +3.006768182287155e-01   +2.144540520724366e-01; -3.141475814460038e-01   +7.634187581800636e-02   -4.522806713695464e-01   +1.867857877071162e-01   -3.652572419352231e-01   +7.193603540614740e-02   +5.893241426603274e-01   -1.135713816343724e-01; +3.655757630127232e-02   -3.453819781271866e-01   -1.025448060824670e-01   +2.070679475953418e-01   +1.026229602327841e-01   +1.445148674818100e-02   -2.972054893889681e-01   +1.331605135482555e-01; +1.196787227856728e-01   -1.066276801967637e-01   +7.104728025373180e-02   +1.763073947497767e-01   -7.938476069725464e-02   +2.600317587776662e-01   +2.184050989984168e-01   -3.133808088949758e-01; -3.091282538252887e-02   -3.089290773008141e-01   +4.368380115264914e-01   -1.983245935687764e-02   +2.401328011015960e-01   -5.388330643259269e-02   +1.890320346271155e-01   +1.857461299507981e-01; +2.665129630733400e-01   -1.283843864783239e-01   -2.141703619397722e-01   +8.582954800481593e-02   +3.167621571665930e-01   +5.086368078755960e-02   +2.543280457984829e-01   -3.569094611633561e-02; -3.007729403403678e-01   -1.203979106000698e-01   -3.438604495721974e-01   -5.357126024569232e-01   -3.369141989152129e-01   +1.792007733896457e-01   -7.242796379542896e-02   -7.610072763913511e-03; -2.841274048832441e-01   +4.126636268109772e-01   +3.874438675446278e-02   -2.935410137821063e-02   +1.756684086468988e-01   -5.386689066026078e-02   -1.097745134460162e-01   -6.058059570600713e-02; +3.387680975738162e-02   -2.409348269994981e-01   +8.205478711550024e-02   -1.834461639965259e-01   +3.267992627969810e-02   -4.760823788657076e-01   -3.044407014945160e-01   -4.626406914103921e-01; +9.807949331505042e-02   -5.933060414496739e-01   +4.066939764563866e-02   -4.905153749054144e-01   -1.097230888087808e-01   -2.266801124850785e-01   +2.487231707896609e-01   +3.095144377089201e-01; -5.670923643587348e-01   -4.471815889678057e-02   +5.426745187747593e-02   -3.993315321502425e-01   +3.519409141836447e-01   -1.915831121501442e-01   +5.058157942936345e-01   -8.243238065829106e-02; -9.792487048955302e-02   -2.843942713829299e-02   +2.740367918413990e-01   +1.522750373870719e-01   +3.549872585087028e-01   +2.442361925513368e-01   +2.571034831408601e-01   +3.920848395044620e-01; +2.928694486982593e-01   -1.232243129771001e-01   -1.128233113859978e-01   -1.281409326015019e-01   -1.125958544209040e-01   +6.437633439050279e-02   -2.686783239598242e-02   +3.791398703438392e-01; +7.668850757149879e-03   +1.589528226533592e-01   +6.400249846980600e-03   +4.750042739999165e-01   -2.749897108893377e-01   +3.114707664773697e-01   +3.133158793901023e-01   -2.386118253707476e-01];
L1E_L2E_iAMPA_netcon = [-3.846029491217076e-02   +3.696317211662573e-01   -9.239260954811496e-02   -2.679449397267979e-01   +3.572467387201189e-01   -1.335470575200201e-01   +3.786890601580089e-01   +4.401511507699984e-01   +2.402682812567809e-01   +3.380175429936412e-01   -2.224636669526306e-01   -3.198978572526407e-01   +5.465037925089966e-01   -1.249519676140422e-01   +4.551893469930782e-01   -1.872724980862031e-01; +3.521710212325571e-01   -8.168874250291447e-02   -9.372423552116566e-02   +1.603796945998025e-01   +1.800054321538168e-01   +1.655958253607269e-01   -4.022521403092997e-01   +5.529820807037406e-02   +2.467693369557337e-01   +6.680844085993916e-02   +4.035465986474529e-03   -2.199593804955275e-01   +1.681224861363834e-01   +3.939397373183069e-01   +2.540961200007210e-01   -2.763986788191641e-01; -2.834373985737948e-01   -1.566384679932461e-01   +2.336924638418255e-01   +1.032768726338226e-01   -2.858505094233347e-01   +4.147769367064451e-01   -2.601829434451078e-01   -8.715153867801975e-02   +1.865978524056586e-01   +2.370906703997938e-01   +3.252755075021846e-02   +1.865492985488169e-01   -4.786997636457527e-01   -2.589694791895993e-01   +2.098066763631005e-01   +6.007024733836364e-02; +3.596278873374265e-02   -2.353694198395825e-01   -2.687055818151364e-01   +1.201273569232822e-02   -1.052193876128549e-01   +3.130003583152391e-01   -9.877765538500903e-02   -1.866547031893058e-01   +4.819105978381744e-02   -1.915241030971085e-01   -1.416336675685112e-01   -8.626184953532492e-02   -5.796282614871928e-01   +5.854077710615280e-02   -5.795083828542213e-03   -1.456118923962356e-01; -1.339024048210143e-01   -6.401732949802691e-02   -1.582117019579243e-01   +4.354020138265977e-01   -1.535627256208629e-01   -2.634618941740460e-02   -1.253936390354101e-01   +5.122063856712683e-02   -2.751868351193194e-02   +5.293888135541936e-01   -4.606908523408010e-01   -2.990167935110120e-01   +6.723018673055460e-02   -2.328392563545317e-01   +4.182375452979429e-01   +4.299648368313360e-01; -8.063678225270111e-02   +2.088891131966824e-01   +1.163730939390538e-01   +2.470930199845324e-01   +4.397794893555327e-01   +1.256797442154058e-02   -2.855770163576264e-01   -2.217453109257352e-02   -2.963710040561916e-03   -2.276502286145382e-01   -4.200880436204235e-01   +2.755309804225921e-01   +1.350421817939146e-01   -1.164536101747081e-01   -4.702377401428064e-01   -1.376826731565936e-01; -6.552866411352160e-02   -2.123516234426286e-02   -2.994682196910369e-01   +1.741494745411923e-01   +1.638568778760053e-01   +1.532524148662469e-01   -2.759245442574189e-01   +7.962621486609614e-02   +3.843695435675547e-01   +4.357120921360770e-02   +5.794952178808693e-02   -2.958005377111955e-01   +4.593686553374028e-01   -3.181182783175401e-01   -1.675258113167025e-01   +4.809484584840595e-02; -1.412127039454260e-01   -1.139759221734925e-01   -3.485281958093053e-01   +3.486566818600138e-02   -3.637530169647072e-01   -3.084387254559762e-01   -2.772918443424833e-01   -7.287015016348877e-02   +3.252299602875888e-01   -1.497689674251221e-01   -1.678024012556770e-01   -3.213901378331868e-01   -1.982538690428688e-01   -3.618982057544295e-01   -1.926867965787103e-01   -4.226449018119173e-01];
L2I_L2E_iAMPA_netcon = [+2.177794552606501e-01   -1.024913887426151e-01   +3.566894159354351e-01   -2.559972708285789e-01   +2.581026675727301e-02   +3.000458037326290e-01   -3.170715079069727e-01   -2.904084347857426e-01; -8.377765902760662e-02   -2.409388022648196e-01   +1.329557804503358e-01   +1.518014800734722e-01   +1.038005124965080e-01   -1.764138556474517e-01   -9.984947356120809e-02   -3.301251434890313e-01; -1.760113038675288e-01   -1.405009748236588e-01   -4.185128002354797e-01   -2.494081621151751e-01   +1.863196045078397e-02   -1.867750696456381e-01   +4.472565038454269e-01   -1.614261515155209e-01; -8.569833792415778e-02   +2.177738271856333e-01   +1.218796565557433e-01   +5.625705155048102e-02   -3.052767271891272e-01   -1.071576657991639e-01   +2.496027594143853e-01   -2.184073328604207e-01; -4.572914209912650e-01   +4.085594457106316e-01   -1.727968014605662e-01   -1.288275881175470e-01   +5.102953140224739e-01   -2.664841684207824e-01   +6.280192556530284e-01   -3.322999999953795e-01; -2.113520929145890e-01   +3.638589102681978e-01   +1.340816002528914e-01   -2.305364293161288e-02   -6.304822011273502e-02   -1.535880577030149e-01   -2.251710299200940e-02   +1.056465647593852e-01; -1.609013417250521e-02   +3.213489238606981e-02   -3.217024692476615e-01   +2.922275928166265e-01   -2.852548516942741e-01   -2.058272707782625e-01   -1.025440249982883e-01   -1.400436546697332e-01; -4.132409549258691e-01   -3.850379914100578e-01   -4.657169820625240e-02   +4.749249005310405e-01   -2.861050278253351e-01   -3.224609150098515e-01   -2.122871445466455e-01   +4.097989449125020e-01];
L2E_L2I_iGABA_netcon = [+1.711152692991282e-01   +2.257370378221085e-01   +1.313662752821455e-01   -5.202167379309380e-02   -2.494636085914256e-01   -1.503726328023793e-01   -4.428645756078541e-01   +2.672686281987866e-02; -3.530192496550842e-01   -3.514237286079188e-01   -4.203123100872063e-02   +8.906499719787001e-02   +3.595143051281947e-01   -9.418142670447356e-02   +3.551155351955696e-01   +1.532370452717843e-02; +2.352138376198035e-03   -9.054369636269438e-02   -2.485154012811831e-03   +6.392431034421744e-02   +2.890378645919911e-01   -9.695101669877418e-02   -6.213852968762138e-02   +4.651304794753253e-02; +1.317745297400491e-02   -3.801533717849770e-01   -5.571728434202364e-02   +5.991603362899141e-01   -2.011792543072666e-01   -8.558393933719134e-02   -1.342530771177188e-01   -3.631694479146258e-01; +4.771818602671674e-01   -4.531537127858704e-01   +3.221581192314185e-01   +3.234338417931591e-01   -2.859777410257496e-01   +4.058543631190855e-01   +9.685684879471188e-02   +1.225006360980913e-02; +3.581348680772416e-01   +9.379592806427464e-02   -1.920402945963220e-01   -3.066047711467400e-02   +2.115999024339879e-02   -1.708000048142920e-02   -2.311645443187424e-01   -1.152285668619537e-01; -1.026513432569039e-01   +9.905520767991999e-02   +3.724227833483272e-01   -1.367779924383012e-01   +9.037049874056310e-02   -2.275579698182950e-01   +4.203209556034523e-02   +9.294495074873635e-03; -1.182326451715040e-01   -4.155632522345444e-01   +9.874639956084214e-02   -2.994800046363006e-01   -1.688446201311871e-01   -3.196983696715175e-02   -1.319182327438133e-01   -3.241964391130897e-02];
L3E_L2E_iAMPA_netcon = [-1.500937921128479e-01   -2.550331034820712e-01   -1.778903503788241e-01   +9.626363377590940e-03   +2.455179978349216e-01   -8.834939828033431e-02   -5.081445933557677e-02   -9.027441984787429e-03   -1.172893118013055e-02   -3.206551942929079e-01   -5.010035072378070e-01   +2.750911117668038e-02; +1.434419126252027e-01   +1.972281700718176e-01   -1.393689120964632e-01   -1.800678736455460e-01   -9.785954691234666e-03   -2.796645321486534e-01   +1.616019539849558e-02   +2.798028698750555e-01   +9.868136758739930e-02   +1.873262268512835e-01   +2.113149893582562e-01   -1.303585589389689e-01; -2.568255499997849e-01   +1.098700866057720e-01   -2.418362416410527e-01   +2.135193605205697e-01   -2.450372040620607e-01   +4.089728524576805e-02   +2.300459534322336e-01   -2.807522020829700e-01   +3.188846549832368e-01   +1.710588981414486e-01   -3.820657098591730e-01   -1.269516752530523e-01; -3.501476964185736e-01   -1.366567658942916e-01   +1.991055824069983e-01   +3.116675635763276e-02   +9.974995164795904e-02   +1.433958553518888e-01   +3.358400644607333e-01   -2.170614214170992e-02   +2.704616979518119e-02   -2.624004056072313e-02   -1.400729999456504e-01   -2.745416898730291e-01; -2.218830386810697e-01   -3.562048218564683e-01   -3.025934673274217e-02   +2.376393607196300e-01   +9.598769015469803e-02   +4.914174691037276e-03   -1.148925522364051e-01   -2.013250225090169e-01   +1.473856825575865e-01   -1.512603420026085e-01   +1.734138112347055e-01   +9.484232035624987e-02; -1.504306967500428e-01   -6.417341635498755e-02   +1.778441822822506e-01   +1.597748714898261e-01   -2.150274472257550e-01   +3.202786522436007e-01   +2.650308240298316e-01   -3.854266651991364e-01   -3.134417061419853e-02   +1.953528592588728e-01   -9.143824729378985e-02   +2.404308670608958e-02; -3.389267404054840e-01   -4.642486517463920e-03   +9.526439262368319e-03   -2.193706280368964e-01   +1.114595877918614e-01   -3.509043500514912e-02   -3.652262907878799e-01   +2.747677961754535e-01   -5.457172672844897e-02   -1.667548154092041e-01   -2.387414229519733e-01   -1.908538145120152e-01; -3.974915866870746e-01   -6.177580346592614e-02   +4.119551287831834e-01   +3.566974663775847e-01   -3.877040111899814e-01   +2.568711062904371e-01   -3.234975882255651e-01   -4.349601997106006e-01   -3.362542946500824e-01   +1.170233016113245e-01   +2.637638614898929e-01   +3.533614289043655e-01];
L3I_L2I_iGABA_netcon = [-1.571281866016207e-01   +4.311920712696720e-01   +2.399089692049455e-01   +2.241738974062782e-03   -2.800008734584053e-01   -1.190394888721933e-01   +2.953611128491855e-01   +1.302421364370097e-01   +4.289538217206535e-01   -1.716298362173532e-01   +2.300856143326236e-01   +3.713760481782065e-01; +1.235985755527963e-01   -1.388336596368858e-01   -2.497477801180815e-01   +1.608087812009583e-01   +4.590471741697408e-02   +1.231962895771553e-01   +7.521908149721160e-02   +5.111246514023090e-01   -8.733122247400400e-02   +1.232134080436764e-01   -9.527015620504550e-03   +7.231714725508986e-03; +1.712827571850697e-02   +2.841748134172110e-01   +3.663386574248530e-01   -1.661322560583151e-01   +1.109129636530561e-02   -6.120986412969337e-02   -6.256918778689510e-02   -1.468050044754055e-01   -3.621191925899849e-01   +8.221948745198744e-02   -2.511279998241299e-01   +6.828188964207345e-02; -4.343874502441444e-02   +1.229591641950717e-01   +1.187088133516294e-01   +3.799368422298068e-01   -9.408053496275803e-02   -9.859964112020689e-02   -1.029356258386065e-01   -1.454535370272859e-01   +1.908433727503136e-01   +4.272242194766067e-02   -1.940323897616081e-01   +2.568932138332972e-02; -1.502256318718340e-02   -1.462891904907452e-01   -8.983058254827977e-02   -2.675291295329276e-01   +4.116584935725319e-01   +2.491444318386168e-01   +5.293808048649290e-02   +6.946273333977666e-02   +4.274948160610260e-01   -1.468425505363580e-03   -1.946831765120550e-01   +3.310315527214368e-01; +4.926289031508885e-01   +3.869680006800585e-01   -3.865011888565462e-01   -2.948527644724165e-01   -3.117145344108563e-03   +2.494945793074818e-01   -2.720149505968517e-02   -1.505596925547237e-01   +1.415605605773300e-01   -1.769741478358700e-01   -4.132779501326629e-01   +1.678967877221666e-01; +3.804187782756941e-01   -4.612865720676174e-02   -2.674337802572074e-01   -1.351443356814939e-01   -4.447305412255468e-01   +3.754815580526519e-01   +9.385066133708908e-02   -1.358385026534892e-01   -1.825634569151172e-01   +6.623490582972444e-02   +1.212299264176270e-01   +5.189194634171676e-02; -3.615955707652783e-01   -2.178652865814849e-01   +3.393555480801723e-01   -2.495709411313426e-01   -1.694975872290672e-01   +3.780109514319447e-02   -8.509299113847979e-02   -3.024868340459364e-01   +8.431417247308096e-02   +1.451027777228855e-01   +7.476952697886567e-02   +2.864570855092475e-01];
L2E_L3E_iAMPA_netcon = [-4.672736535839112e-02   -4.746779892940757e-01   +1.674757069000253e-01   -4.705729800542104e-02   -1.708433521845728e-01   +2.235646027383150e-01   +2.503845232873575e-02   -6.866642046507097e-02; +2.218599309833814e-02   -6.942990322105015e-02   +2.384298155670397e-01   +4.327149271034451e-02   +3.969636750283222e-01   +7.716426599607473e-02   -4.558701952834380e-01   -1.654687525334093e-01; +8.624395817332012e-02   -2.195989443586955e-01   +2.950697989643440e-02   +1.362707778303900e-01   -3.162430059959276e-01   +7.160857406397315e-02   -9.782538344609332e-02   -9.538414630663966e-02; +1.801656503900614e-03   +7.990747087693392e-02   -1.209012809559593e-01   +2.413293779154316e-01   +2.149753766904513e-01   -1.945231530263918e-01   -6.180880613876067e-01   -1.657409120184541e-01; +3.620395385524334e-01   -2.991250620241144e-01   -1.908608451839913e-01   +9.521545648942781e-03   -1.126884377105647e-01   -3.420956791894827e-02   -8.049277423411297e-02   -3.677408800895704e-01; -1.039608402146966e-01   -1.588722841591964e-01   -4.413810079825321e-01   -5.020172803219024e-01   -1.437552936015664e-02   +3.848372204381235e-01   -3.459214573134377e-01   +9.206080844017495e-02; +5.416779375336953e-02   -5.206255699472667e-02   +1.953777627038346e-01   -3.777249628933718e-01   -4.695343720926317e-01   -4.296161595862094e-01   +4.734706721514036e-01   +2.710108637708809e-01; -1.515759628857417e-01   +4.291587179894170e-01   -1.084290368556069e-02   +9.257486592059193e-02   -5.381118744306225e-01   -2.687634677740665e-01   +2.201678261336077e-01   +8.158717989707605e-02; +3.336024821965287e-01   -1.853380260256139e-01   -2.147569407977083e-01   -1.793150481677989e-01   +1.955634713838194e-01   +2.282538976000035e-01   +1.642010751553083e-01   -4.927478438540938e-01; +4.334378856376481e-02   -1.417512912566422e-01   -7.331584923603568e-02   -2.138323963777630e-01   +3.648147368697395e-01   +2.982753145559998e-01   +2.775530650088018e-01   +2.045354742392233e-01; -2.441647469421256e-01   -2.631855643872144e-01   -7.609950126145541e-02   -1.382307485641264e-01   +2.598302818782470e-01   -1.698260540799681e-01   +4.544236657866138e-01   -1.463880202932744e-01; +5.876831614942873e-03   -3.303004443916308e-02   +5.024316899498411e-01   +9.278071835572538e-02   -2.347024941605955e-01   -2.056157564850187e-01   +1.727794462969520e-02   +9.042846289654674e-02];
L2I_L3I_iGABA_netcon = [-3.431383844265153e-01   -8.354205883848327e-02   +5.725353264767479e-01   -8.197788854553320e-02   -2.673999321987048e-01   +2.666728667389095e-01   +1.489670529082619e-01   +1.480769134003270e-01; -2.453933220088663e-01   -1.832874150585100e-01   +1.626295206861475e-01   -4.265767351998045e-03   -4.976723082430079e-02   -2.596476273456206e-01   +1.148294703841402e-01   -1.265225620986652e-01; +5.939984736154485e-02   +3.792353654378346e-01   +6.422837439940250e-02   +9.478600062277592e-02   -1.767138159459049e-01   +1.223437393692834e-01   +4.600158478607894e-01   -2.614714076426816e-02; +7.085719344807215e-02   -2.257941314885129e-01   +5.702628674770863e-02   +1.301382782432216e-01   -2.290314119817570e-01   -2.118960605291938e-01   +2.329639122326463e-01   +1.780164090349410e-01; -7.227174169992531e-02   +1.778045476943930e-01   +2.128208316520409e-01   +4.471598773497886e-01   +2.107042472223532e-01   -3.290811368188586e-01   +3.615358441437865e-01   -4.663556059172387e-02; +3.304135169495162e-01   -1.172810335679760e-01   -1.533887849521412e-01   +3.682939228552264e-02   +1.636838942402612e-01   -4.906658577281077e-01   +8.737216997321136e-02   +1.988668368439193e-01; +3.696303564761205e-01   +5.361505038566811e-02   +4.115361284053341e-01   +1.411846771728261e-01   +1.497051022075150e-01   +2.088455339775377e-01   +4.263697582430178e-01   -1.803909462828827e-01; +1.694085001279259e-02   +9.591587851069003e-02   +3.291246684437212e-01   +4.972550358675661e-02   +5.215631147367976e-01   -5.078712665449806e-01   +3.968390488026508e-02   +2.340525139752831e-01; -2.840303653326298e-01   +2.262212718357316e-01   -1.369794111364211e-01   +3.903875018568276e-01   +3.206124668043807e-01   +4.329831524531406e-01   +2.856886851117302e-01   +2.054254755699592e-01; +4.558598841143583e-01   +2.610064897611665e-01   -5.468703392519164e-02   -4.714490889947384e-01   -1.195089492554252e-01   +7.060579703607794e-02   -7.597551803376908e-02   -1.767365636838504e-01; +1.892886965663544e-01   -2.682857472246620e-01   +1.410087465388400e-01   -2.132313992739411e-01   -2.880934449853824e-01   +5.708657895122221e-02   +1.663239598457235e-01   +3.418211727692281e-01; +9.511306998618717e-02   -3.477388608179779e-02   +1.686304215467982e-01   +4.288767314779137e-01   -3.005727025303531e-01   -2.226773275922243e-01   -4.533721244572176e-01   -2.001346625191374e-01];
L3I_L3E_iAMPA_netcon = [-6.243449466198800e-02   -1.755512493408769e-01   -6.270108389275711e-02   +3.397392131619155e-01   -5.761404036632621e-02   +2.773581416385454e-01   -3.002808052155913e-01   -1.970630088739998e-01   +2.416187284820546e-01   -5.333976739999606e-01   +2.601031355711984e-02   +2.560717248090257e-01; +2.440960637052816e-02   +5.863802072361485e-02   -3.002227298013992e-01   +1.472587716467262e-01   +4.043715750062495e-01   +2.932035016500139e-01   -9.614627608433889e-02   -5.028145552590181e-01   +2.418306932216870e-01   -2.057692626428395e-02   -1.977647162438635e-01   +2.270868049582369e-01; -9.815768045751906e-02   +1.786944547290635e-01   +4.272485257101488e-01   -1.549516693053165e-01   -1.898043281823864e-01   +1.809163421325124e-01   +2.074586873472974e-01   +2.311608125678584e-01   +3.923278087911871e-01   +1.326106158627064e-01   -2.952029745066161e-01   +8.727013026764485e-03; +3.789314448560058e-02   -1.492313953002754e-01   +3.330572810154760e-01   +4.360363283345490e-01   +3.150595562751100e-01   -4.388094296267459e-01   +3.696333580729323e-01   -1.751375881399143e-01   +2.059348769152551e-01   +1.685103356528508e-01   +2.754008900640967e-01   +2.087476440466365e-01; +2.228268950889160e-01   +4.333461362301499e-02   -3.356443960214665e-01   +3.726974602686304e-01   +9.410496956556219e-02   +1.471188171737300e-01   +1.724661488931429e-01   -1.326941028408209e-01   +3.595865075778692e-02   -1.187793989908583e-01   +1.710098152535138e-01   +1.977516642949354e-01; +3.591586669378418e-01   -1.473209968238113e-01   -3.895752955082152e-01   +4.432503455978528e-01   +1.910453351651130e-01   -4.508615816651916e-01   +7.071584137795325e-02   -1.157841782653977e-01   -3.731311016023462e-01   +4.423623450422085e-01   -3.014354006880848e-01   -3.256761360474559e-01; +2.060729156342941e-01   -2.250525422235621e-01   -3.485797078753327e-01   +1.450581561714573e-01   +3.965774824983317e-02   -1.506259882775705e-01   -8.932340518372428e-02   -2.156326433398985e-01   -2.062203321074474e-01   -7.844538668080520e-03   +4.002672682175398e-01   +3.180950774588426e-01; +2.194184006038247e-01   -2.285141889239895e-01   -3.822594529641339e-02   -9.418454901803811e-02   +1.830260829925885e-01   +3.879355964798301e-01   -3.964427336177666e-01   +1.561783430427772e-01   -2.425826075182641e-02   +5.784287435355895e-02   +2.568858952285620e-01   +3.528547653965836e-01; +2.862616001715944e-01   -8.705744780440355e-02   +6.663542716053286e-02   +2.338420100911341e-01   -1.192188536249081e-01   -1.576621383671289e-01   +2.595681721570172e-01   +3.327117420574519e-01   -3.316174717608785e-01   -1.800977099132879e-01   -6.758146911113548e-02   +2.171661749038084e-01; +6.752599024932515e-02   -2.213762340571111e-01   -1.930529925774996e-01   +3.214581556380848e-01   -1.889568993729274e-03   -2.767511192312011e-01   -1.821440070058163e-01   +3.714135886959617e-01   -1.843383966598235e-01   -4.193383050414194e-01   +3.500030382960077e-01   +1.684910721140133e-01; -1.426815772850717e-01   -1.217601105622692e-01   +2.171994828984029e-01   -2.081595323269049e-01   +4.117227944239706e-01   -2.924960148425892e-01   -3.804779129815516e-02   +1.800875324426337e-01   +5.832428969515782e-02   +4.028410842444450e-01   +1.832636795219357e-01   -1.251593462766100e-01; +3.647939165727201e-02   -1.161742779308323e-01   +4.511499465587636e-01   +2.423444892051338e-01   -3.540309724251838e-01   +7.781338174706315e-02   +6.410312226278347e-02   -4.024199072698706e-01   +2.780703697022847e-01   +2.298427518291773e-01   -5.474747477216908e-02   -2.917089430317746e-02];
L3E_L3I_iGABA_netcon = [+1.496320698350992e-01   +1.371583508504136e-01   +1.382911053028738e-01   -4.931158050637580e-02   +4.103107030315591e-01   -5.190463242122568e-01   +2.282167405343172e-01   -1.178523665612070e-01   +1.071541772589936e-01   -2.441305975585131e-02   -1.599526546545572e-01   +8.880958093619090e-02; +5.650268813917267e-03   +1.981282291840756e-01   +2.292722031973699e-01   -2.136480870074882e-01   +4.336507944853182e-02   -1.908291864206580e-01   +1.089624252069338e-01   -2.159649525810745e-02   -7.113745402196570e-02   -5.549040418139553e-01   -5.414659564523021e-01   -4.328309751287032e-02; -1.592047070636268e-02   -1.769169452331013e-01   -9.628489519934269e-02   -2.630350524496652e-01   +1.718456202523131e-01   -7.966308842011272e-02   +2.020037322957157e-01   -7.006325123953447e-02   +4.749312671751931e-01   +3.620517969017367e-01   +2.814174460329026e-01   -8.788548392308136e-02; +3.149061959046490e-01   +2.160152484624429e-01   +1.052092934411954e-02   +1.811055983686585e-01   +1.171211191812515e-01   -3.233494821367487e-02   -3.002934753521755e-01   -1.727854094942951e-01   +1.174733813711958e-01   +1.196029393625732e-02   +2.860818211736413e-01   -1.123384969451354e-01; -2.092578738574468e-01   +1.873772281314691e-01   +1.353751909903921e-01   +5.866701772689425e-02   -2.738553030517801e-01   +6.455205403601412e-02   +3.419461567055426e-01   -4.294173650001352e-01   -4.202614574520662e-01   -6.641181001153310e-03   +2.718559698515691e-02   -2.627784334894194e-01; +1.093880891936748e-02   -7.635774172466951e-02   -1.571887753780963e-01   +4.099979922107461e-01   +3.336488849387644e-01   -2.786873061732061e-01   +1.152923917053080e-01   +5.783305051332344e-02   +8.191500727358772e-02   -3.700477301117439e-01   +2.345164110952203e-01   -2.524513065990132e-01; -7.458951505208611e-02   -6.218312798501204e-01   +2.999576849034032e-01   -5.043870660123000e-02   -1.557005447574589e-01   +3.039924711938464e-01   +2.144306647646539e-01   +5.661374515433442e-02   +1.693264038204783e-01   +3.391591434613624e-01   +3.482117761730048e-01   -3.012708190969565e-01; +7.691424592390252e-02   -9.625108051348243e-02   +4.724306069356393e-02   +3.065067079219086e-02   -2.611451361035594e-01   -2.030674795086093e-01   +1.206711920153564e-01   -4.893205256324756e-02   +7.357421726606039e-02   -2.258936251271323e-01   -4.826312418345185e-01   -1.784008558066965e-01; -1.494616702555820e-01   -5.097668365346478e-02   -1.029591916118649e-01   +2.906860668130021e-01   +5.041421790983627e-02   -1.734494683930289e-01   -4.209212237575675e-01   +3.581850227914969e-01   +9.592856726927092e-03   -1.778363587213279e-01   -1.253907748675425e-01   -7.149632833241513e-04; +9.231965238391587e-02   -1.013748054422179e-01   -4.431955139099254e-03   +8.249903410323609e-02   -2.144861269521431e-01   -3.030395072075060e-02   -5.071536033798219e-02   -8.220610845898521e-02   -3.543920603568302e-01   -1.941446346591834e-01   +4.017216768907191e-02   +2.861425473375895e-01; -1.290966234064289e-01   +2.155051399893808e-01   -1.162636429919593e-01   -5.960174173806752e-03   -1.634028604618273e-01   +1.762328848392089e-01   -3.863770069980606e-02   -3.426094999930199e-02   -3.294709853756362e-01   -4.627394693249979e-01   -8.713919321809621e-02   +2.443372519752934e-01; -1.257235702345336e-01   -4.434807273086337e-01   -3.873413071348203e-02   +4.226784055398297e-02   +1.032334988314208e-01   -2.619034743996617e-01   +3.635452764183011e-01   -4.334960930659051e-01   +1.939971480679988e-02   +1.793985472718881e-01   -2.427125274404187e-01   -3.105270766779596e-01];
L2E_Input1_iAMPA_netcon = [+6.152152985448338e-02   +1.399495329630996e-01   -1.020161558911992e-01   -2.333672685150777e-01   +1.932610173172449e-01   -3.617252322991897e-02   -8.097139330861915e-02   -1.204132341556193e-01];
L2I_Input2_iAMPA_netcon = [+2.056193506993261e-01   +4.830069220285744e-02   +1.189383509907499e-01   -1.429139553472501e-02   +2.770010148742152e-01   -1.741368296078164e-01   -6.249382408127332e-02   +5.930404474756603e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
