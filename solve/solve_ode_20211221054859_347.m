function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.790582393775360e-01   -1.160025769504181e-01   -2.819007788428786e-01   +3.727991984636808e-01   -3.127577796834848e-01   +3.494384130612317e-01   -8.790441310201930e-03   +1.379659073244630e-02   +1.291389217626071e-02   -2.032735540411561e-01   +7.365103565150889e-01   +6.522404073083879e-01   -3.251132748118321e-01   +2.041413292696985e-01   +2.036802149490921e-01   +6.434502289215698e-01; -6.427515259757301e-03   -4.483058235825896e-01   -3.524272034883734e-01   +9.364536111452676e-02   +2.229573031814709e-01   -2.125732986174044e-01   -1.725005796620112e-02   -4.516590086164114e-01   -2.381252860699128e-01   +1.419874515067919e-02   +5.152181269876978e-02   +4.138638353990540e-01   -4.906498884622494e-01   +1.509978779014507e-01   +4.207430206851027e-01   +2.309183494381448e-02; +3.395534233771238e-01   -4.754211335265981e-01   +4.858977070461312e-01   -2.890601225066253e-02   -1.607708288596784e-01   +4.206771809429470e-01   +1.260839784163210e-01   +3.998358486796898e-01   +2.880746500983197e-02   +7.277131183226305e-01   +2.639618133463201e-01   +2.078172936142608e-01   -2.805687012294523e-01   -2.525071446571697e-01   -9.340021644408118e-02   +1.585629918739533e-01; -1.718267316479753e-01   +6.031774351673685e-02   +2.088077354043922e-01   +5.053530672045711e-01   -1.481470482274951e-01   +3.595056214996271e-01   +5.142736080746921e-01   -3.214168819123598e-01   +3.927467265794392e-01   +2.686621615508261e-01   +1.005570976365504e-01   -4.391482989711162e-02   +5.864780373734586e-01   -3.093620910720971e-02   +1.166037569269176e-01   +4.067628326256383e-01; +3.016074794663199e-01   +5.638465689786668e-02   +5.021832892872163e-01   +8.333724268649498e-02   +4.110268622091269e-01   -3.355709988904009e-01   +3.848797832127734e-01   +6.717193956526014e-01   +3.166297122985404e-01   +4.001017402389425e-01   +3.481859974206164e-01   +1.006847039368595e-01   +3.260331378959813e-03   -1.647851863412913e-01   +5.025654196361912e-01   +5.372954226373423e-01; +6.376533715659713e-01   +4.465261053865222e-01   +3.088921500084341e-01   +1.852927724445414e-01   +2.032875982288790e-01   +1.640859148182126e-01   +3.242036567165791e-01   -4.026948420908236e-01   +3.679426864774241e-01   +3.035533517478594e-01   -2.702253696492594e-02   +2.172079270992871e-02   +5.318178895963502e-01   +8.902332591601481e-02   -3.737841768670860e-01   +1.582581964058916e-02; +3.332170195210361e-02   -1.943273891177096e-01   +1.760402822352107e-01   -1.792801842859709e-03   +5.450624985619533e-01   -2.468407938618309e-01   +1.317210058212457e-01   +3.738488719257655e-01   -7.092493460427785e-03   +5.282329514235505e-01   +2.739052772719531e-01   -6.385953433191519e-02   +2.095768421692345e-02   +1.934547916235979e-02   +3.303131748691736e-01   -1.499511175094534e-01; +8.445331129374004e-02   +4.249292506404788e-01   +3.476883727879129e-01   +5.305518279424720e-01   -5.611749932482515e-02   -1.540285560464836e-01   +2.970116133619009e-01   +2.715526061063273e-01   -2.205204133187192e-01   +4.363896474966226e-01   +4.318875563422729e-01   +3.325703052858672e-01   +6.197565096715996e-01   +3.272487477669240e-01   -4.548933132372766e-02   +8.151799862309640e-02; +2.932884902477517e-01   +6.123546052939550e-01   -4.120055598400395e-02   +3.571061192510359e-01   -7.326637102005529e-02   +2.212131216259389e-01   +6.915803245038270e-02   +2.680139587507949e-01   +3.903122433018282e-01   -4.289093235119056e-02   +5.047454884770280e-01   -3.145632557666769e-02   +1.630577131877620e-01   -2.730151306194448e-01   -1.650508556181432e-01   +6.532340058561158e-01; -4.358315355768060e-01   +5.358533456919772e-02   +3.791749109237240e-02   +7.363181842194774e-01   +1.922651642786019e-01   -2.944717390173798e-01   +5.711515051520731e-01   +9.632513261535151e-02   +6.093412071955555e-02   +4.008507372347487e-01   -2.098100114292881e-01   +4.032209793667659e-01   -1.220735038458340e-02   +6.850037858492402e-01   +1.050271905832571e-01   +7.053534369800550e-02; +7.491589090225127e-01   -3.834662788358980e-01   +4.578366362369650e-01   -1.252442614503246e-02   +1.164148430499706e-01   -1.339784152427676e-01   -1.478772058002188e-01   -2.659138516775747e-01   -2.918324933422245e-01   +4.908149418798963e-01   +4.646061056248542e-01   -4.676953564925280e-01   +8.005271477127449e-02   -3.349222316155980e-02   -2.485016509679782e-01   -3.903956940889589e-01; +4.531760255066677e-01   -1.239316573811158e-01   +2.251709554677693e-01   +2.927823935148268e-01   +3.320694538971820e-01   +3.845540562349015e-01   -1.323803556715674e-01   -2.123986404542442e-01   +3.517059657174035e-01   +3.884834797131163e-01   -1.396110459237470e-01   -1.319947951453393e-01   +5.575189255354656e-01   +1.957568935177668e-01   -5.264455172530853e-02   +1.017246278402684e-01; +1.831113226914753e-01   -1.121325722018160e-01   +7.176106487845503e-02   -4.401258738523775e-02   -3.940832055669700e-01   +4.603858903615103e-01   +6.274853156187012e-01   +3.399653166581980e-01   +2.267377745763450e-01   +1.871993090310614e-01   +1.190202570425440e-01   +2.005033061118606e-01   +6.802979083077051e-01   -1.907170186573343e-02   +4.225668393359666e-01   -7.596085353860127e-02; +2.037427056476169e-01   +6.664045832096236e-01   -2.511077813510922e-02   +3.301645505413494e-01   +3.406046772456664e-01   +2.753230164228798e-01   -1.091359771109180e-01   +7.165172291685989e-01   +2.419433769877936e-01   +6.399265983197761e-01   +3.891791103230069e-01   +1.082701136676541e-01   +4.750104314326267e-01   +3.542229272798256e-01   +3.920943569154290e-01   -4.755530037690281e-01; -1.705164242244779e-02   +9.735393726935285e-02   +1.392887633606944e-01   -2.836178451571739e-01   -1.096198100112660e-01   +1.735168381826268e-01   -9.838508162057653e-02   -4.134780128875219e-02   +4.871063864494791e-01   +2.667855994879759e-01   +4.405429349550285e-01   +7.842136362772843e-03   +6.881853404448410e-01   -1.141770744404658e-01   -2.220425124665073e-01   +5.221071107326926e-01; -3.059958963521947e-01   -2.263823512989382e-01   +1.077582440777620e-01   -1.122219909450190e-01   +1.849282641319501e-02   -6.242262300934900e-02   +8.712726228196445e-02   +4.240761435792716e-01   +6.051397686804764e-01   -3.797336113139282e-02   +3.357723982013180e-01   +3.584138050582846e-02   +2.676544353384267e-01   +5.999651152273062e-01   -1.193250735998369e-01   -5.034529572496890e-01];
L1E_L1I_iGABA_netcon = [+2.280374745417776e-01   +2.953422764044427e-01   +1.256349670824506e-01   -7.665152192233737e-03   +1.381495797596242e-01   -8.887693517614408e-02   +4.907608638038824e-02   +4.351199909737270e-01   +3.435117416277522e-01   -1.350554077583448e-01   -1.799768403666815e-01   +5.962467108292915e-01   +1.212383935003292e-02   +1.481716347461730e-01   -3.740548673934351e-01   -1.855294115577188e-01; -4.265833084510774e-01   +1.107165276341266e-01   -7.354183832094892e-02   -2.757865170971738e-02   +1.376708783923882e-01   +5.821426497356406e-01   -3.156961149962155e-01   -5.136307700172579e-02   +2.977119477681235e-02   +3.253447273899627e-01   +1.939838502754498e-01   -2.549197453486068e-01   +3.561715529626790e-01   -2.801987339643783e-02   +1.712777895018126e-01   +7.056605222784295e-01; -3.455278946609799e-01   +1.914092192145134e-02   -1.751269685897287e-01   -2.178470987379696e-01   +6.377377342515589e-01   +4.961320168008437e-01   +5.918920261214413e-02   +6.410943287284891e-01   +2.587768799891826e-01   -3.698941543258034e-01   +4.930551066114963e-01   +2.482078401315096e-01   +1.324650532143140e-01   -7.253525341278169e-02   +2.651209489060575e-01   +4.036737547181874e-01; +5.548172406706494e-01   +2.275802317375308e-01   -5.255300716645385e-01   -2.632026812540557e-02   +8.946719848010015e-03   -7.647784916624900e-02   +8.317594866869843e-02   -1.035127163062341e-01   +5.120246523571956e-01   -7.288298307924865e-02   -1.353242672959740e-01   +3.866579802928606e-01   +3.490564669078562e-01   -3.557486508925211e-01   +2.669061237435536e-01   +1.803685807248538e-01; +7.708378322011387e-01   +6.639601033470599e-02   +4.788306019229091e-01   -2.591560396387491e-01   +2.047732672675302e-01   -4.242373253880215e-01   +1.963669911993330e-01   +1.472589198915324e-01   -2.645238536899766e-01   +2.998932887427251e-01   +5.491567372586871e-01   +1.887557018080261e-02   +4.904483140879974e-01   +2.369604172173286e-01   +1.059244299001742e-01   +5.698366747022975e-01; +1.693309733895636e-01   -4.970275938190732e-02   -3.263498411109518e-02   +2.989135126676054e-01   -1.364456587481277e-01   +3.615246583678158e-01   +3.219927654030584e-01   +1.248829954485394e-01   +1.725420700391528e-01   +2.067901118590944e-01   +4.664348654844619e-01   +5.064039695538315e-01   -1.878560350861952e-01   -2.580728767499608e-01   +2.018672600010984e-01   -2.128371058948678e-01; +1.874025918455835e-01   -8.738016505220200e-02   +2.133141443157617e-01   -9.238315877978183e-02   +6.766198400290210e-01   -1.469050494760805e-01   +8.857196597483727e-02   +4.225322912461144e-01   -2.348195598202805e-01   +2.818519145174128e-01   -2.481964393735812e-01   +4.648309459522827e-01   +1.069453048693075e-05   -1.702016284134175e-01   +5.063182914919103e-01   +3.109933066728435e-01; -2.828232295292410e-01   -4.319169374828617e-01   -4.742926460131906e-02   -9.227622983625033e-02   +2.808114004909387e-01   +1.413081455167033e-01   -4.711767946822769e-01   +5.484151304360252e-01   -4.670862396849243e-02   -2.654869618070563e-01   +2.453520691414624e-01   +3.947428524995175e-01   +2.193715617711120e-01   +1.625290283386289e-01   +1.914931687536068e-01   +5.935498376751484e-01; -2.291517814970357e-01   -3.637473481950603e-01   -2.888604739276313e-01   -2.077019744326199e-01   +2.001146869860722e-01   +4.667385896121606e-01   +4.609442640966669e-01   -1.834440613391586e-01   +4.058969962919202e-01   +3.101340849433223e-01   +6.636914823911615e-01   +1.875883790179612e-01   -6.919641927812235e-02   -1.522496012279096e-01   -1.852816880067271e-01   -2.091319496313561e-01; +1.065865442967369e-01   +7.882398230254933e-02   +2.591493374942663e-01   +2.295105010843634e-01   +7.437455251045605e-02   -9.755546681682790e-03   +4.681773961615986e-01   +2.706465196555144e-01   +7.283281942242935e-01   +5.289864445105072e-01   +1.735520121910606e-01   +4.397459629995521e-01   +3.259410134452869e-02   +9.679317102141265e-02   +7.454132993936394e-02   +9.129985177271438e-02; -6.675471670058217e-02   +1.388948780716459e-01   +6.190357753085884e-02   +2.817636230414727e-01   +1.395139352401633e-01   -6.893315397594442e-02   -4.269730258285026e-01   -4.140501194982313e-03   +6.815789804749970e-01   +1.176252301710356e-01   +1.799910032870189e-01   +4.734109940900656e-01   +3.035743566132753e-02   +1.148296116905339e-01   +2.173464969310386e-02   +3.081796803262756e-01; -3.199453332114411e-01   +9.346718650268995e-02   +8.158370253474580e-02   +5.694907211202997e-02   +5.160888105984944e-01   -1.106765895063225e-01   -1.161805356113372e-01   +3.314339800519403e-02   -3.658019596021925e-01   +1.906893483162272e-01   +1.116678559913296e-01   +3.406535773484577e-01   -3.773112787798683e-01   +3.411768667031962e-01   +3.521615815632054e-01   +7.346721978384717e-01; -1.638906954607529e-02   +1.901140857427983e-01   +2.317848367188001e-01   +2.942759053804744e-01   +1.945633483592531e-01   -2.978446978427469e-01   -1.911776837077485e-01   -3.667923295373954e-02   -2.514306042258019e-01   +1.775862963474490e-01   -1.367305038326118e-01   -2.470450084125687e-02   +3.533162065414490e-01   +1.189627162762073e-01   +1.615278209573631e-02   +4.641145824711884e-01; +4.213029839192731e-01   +9.185638647768861e-02   +2.093897811692265e-01   -4.491920992372331e-02   +1.869932244795341e-01   +7.723355742367729e-01   -2.568193646120342e-01   +4.369395648332863e-01   +3.588446694171170e-02   +9.129794912953640e-02   +2.214357334147716e-01   +6.396157634499555e-01   +2.366471330173176e-01   -1.528479258263756e-01   -4.122842063055295e-01   +1.655368952339292e-02; +1.100920915621047e-01   +6.246999134489883e-01   +5.692649196437206e-01   +3.724380580833502e-01   -4.715992941555909e-01   +6.771791374653452e-01   -2.424454009786592e-02   -1.518026457222799e-01   +9.138321552238725e-02   +3.238304445853770e-01   -2.163672449655731e-02   -1.042401770897719e-02   -3.377163326594070e-01   +6.775259515785509e-02   +1.252527656573409e-01   +3.434008184160166e-02; +4.041355073593891e-01   +4.361852040548265e-01   -3.931312492117726e-01   +5.254039663649439e-01   +3.150258047715361e-01   +2.895901910309281e-01   -3.472347311549180e-01   +2.077944991097262e-01   +6.215825028077420e-02   +2.592644410300257e-03   +4.536466170261797e-01   +1.851332854639803e-02   +8.741420622340081e-01   +6.081967472862819e-01   -1.083345987079622e-01   +2.271251260079613e-01];
L2I_L1I_iGABA_netcon = [-2.120808155190387e-01   +2.325762480380897e-01   +4.620174126271354e-01   +4.017469448285425e-01   +4.882681187325518e-01   +3.634840571200522e-01   +4.055957200126972e-01   +3.024295001882160e-01; +4.131647285900074e-01   -1.763140484933264e-01   +4.716337275789760e-01   -1.562311358120254e-01   +6.736047605682772e-01   +5.275232757263580e-01   -3.362969167662366e-02   -1.271073341579627e-01; +6.666926734720938e-01   +1.783033657640587e-01   -1.628993988358637e-01   +3.481976790863761e-01   -2.566828390010870e-01   -8.427498649154755e-02   +2.495642925536018e-02   +4.753038366038884e-01; +9.026029813245572e-02   +9.232195008003034e-02   +4.424997743450876e-01   +2.063747770678033e-01   +7.965194531635839e-02   +2.152347773298375e-01   +1.633727852227974e-01   -1.308424414986349e-01; +2.248912643814854e-03   -1.368925169902928e-01   +8.998599939412766e-03   +3.713956817879738e-01   -2.015449023810209e-01   +4.428611273452377e-01   +1.184049446750348e-01   -4.427741891541713e-01; +1.283253871451800e-01   +2.958206256767489e-01   +2.655506396443534e-01   +2.520222276222738e-01   +5.215047768518871e-01   +4.845109396552022e-01   -6.757191888380971e-02   -4.046340175864215e-01; -3.478989447030000e-01   +2.701449187707307e-01   +1.002877707585599e-01   +2.861889927061250e-01   +3.797523606822160e-01   +5.494259653864093e-01   +1.991475976663370e-01   +7.429665206148812e-01; +2.479248127831361e-01   -3.036378832637300e-01   +4.957542450145016e-01   +4.619271090081215e-01   +4.477214902134692e-01   +2.926942517030207e-01   +5.217717587909159e-01   -1.711362148904436e-01; -1.734310876684291e-01   +1.776203253157444e-01   +2.928127469403852e-01   -7.251661886591318e-02   +7.745941182255710e-01   -1.415431122658552e-01   -4.789807341661223e-02   +7.855550595359726e-01; +5.684628979598413e-03   +5.194353999907394e-01   +2.180353526064460e-01   +1.499529270022619e-01   +1.980125429572506e-01   +1.494753583518158e-01   +3.160946058615974e-01   +2.301441647195971e-01; +2.670930636372956e-01   +2.770875335750137e-01   +2.232055811510370e-01   +1.390127149598256e-01   -2.284996316577234e-01   +6.519303189816151e-01   +1.380417489191164e-01   -1.018801405371479e-02; +2.113874415678555e-02   +2.664175497487212e-01   +3.882925013973429e-01   -1.269686246479503e-01   -2.514773079327417e-01   +6.497525817052505e-02   -4.220844378535266e-02   +3.852773481298745e-01; +4.162724192995131e-01   +3.378682679981068e-01   +1.694962806761492e-01   -2.203170504896299e-01   -4.546293068305215e-01   -1.756951132593032e-01   +4.820639043151130e-02   +3.898960702996915e-01; +1.930357697286622e-02   +3.125661437694883e-01   +1.812273363154748e-01   +1.435138039578475e-01   +6.584659636580330e-01   +7.567655156721434e-02   -2.738493435260818e-01   +7.857986604729049e-02; +8.522875561334213e-01   +4.194033047495019e-01   +1.722693018513617e-02   -9.198291242182524e-02   +4.577119171286735e-01   -3.445727118624132e-01   +1.903452844242781e-01   +2.323232826007471e-01; -1.771872102869103e-01   +4.940054947958851e-01   +3.305568479069523e-01   -2.459705598354248e-01   +6.626027395474913e-01   -5.003730157026526e-02   -2.953085174494398e-02   +2.552957849441674e-01];
L1I_L2I_iGABA_netcon = [+5.440276440635665e-01   -9.169596022498827e-02   -1.694776108845823e-01   -1.354341588785611e-01   -1.472316032188326e-02   +4.629095341548560e-02   +3.858406713269864e-02   -4.197807894404294e-01   +5.118880723817977e-01   +8.054932254890111e-01   +2.221876316803450e-01   +3.749259687708090e-01   +2.074541624187764e-01   +5.706781452583367e-01   +1.533665978593814e-01   +7.595703224386789e-01; +1.163719094828796e-01   +5.548282438393414e-01   +4.783891352220049e-01   +6.541448410299250e-01   -2.910495324997688e-01   +1.019706472865634e-01   +4.372087541918285e-01   +2.813340713038806e-01   -5.662178426459102e-01   +4.908350371904151e-02   +5.771289384410869e-01   -1.808612128962848e-01   +1.034617339249561e-02   +3.758466724745438e-01   +4.117237919344961e-02   -1.092094173044284e-01; -1.099930076123089e-01   +2.503611722577412e-01   +1.865598828649805e-01   +6.315506758503866e-01   +3.295312663028132e-01   -1.996021177780319e-03   -1.095668321118901e-01   +1.280689309522563e-01   -1.324263202234793e-02   +2.922067014240122e-01   -4.787676939734906e-02   +2.629751817864950e-01   +3.204760120606457e-02   -1.836366936951455e-01   -3.115420413182333e-01   +2.950655908278199e-01; +4.595373503313377e-01   +1.299498914665111e-01   -4.068980464411304e-01   +1.640612519539809e-01   +1.949650874098645e-01   +3.756294024991128e-03   +7.833942170002409e-02   +3.874570493127496e-01   -1.173572050281546e-01   +1.623943151560599e-01   -1.715086322580048e-01   +1.215731767259805e-01   +2.553921482527791e-01   +3.492394456037829e-01   +4.777175752070596e-01   -7.602038226623532e-02; -6.254222039674801e-01   +1.622468510630608e-01   -1.318088863141881e-01   +7.518576671660770e-01   +7.127245835328256e-01   -1.460776366643324e-01   +3.561758769528878e-01   +1.462982419839446e-01   +2.513503667186157e-01   +4.446614163656572e-01   +3.396029899730407e-02   +3.662799949700659e-01   -3.861581263562552e-01   +1.633968273815470e-01   +2.073081424212780e-02   +1.052970567820979e-01; +6.287008118703314e-01   +2.070354330680954e-01   +7.423086306573615e-02   +2.845541050738233e-01   +2.674510592980098e-01   +4.408171122150867e-02   +1.992608652900512e-01   -2.763669856187672e-01   +1.508129374086944e-01   -2.791698495347698e-01   -4.087636344742004e-03   +4.276148941242321e-01   +4.394797010154768e-01   +2.023361711825401e-01   -5.468101635899490e-01   +3.966549758366962e-02; +1.561763628792134e-02   +3.282386479112293e-01   -3.939299906904509e-01   -2.719531408814855e-02   +1.353094854169353e-02   +8.276507057087054e-02   +5.368725631701777e-01   +1.560058262069236e-01   +5.202798737037972e-01   -1.796044213884490e-01   +1.802154242006080e-01   -1.239361491707601e-01   -4.088839030217406e-01   +2.022249154452503e-01   +1.725488563173805e-01   -2.058968691996015e-01; +1.791059993104622e-01   +4.228784028986399e-01   +9.561522946002088e-02   +2.826976566838209e-01   -4.346360668064833e-01   +2.332099604255956e-01   +5.504646203530000e-01   +7.262067356430808e-02   +5.082306992312053e-01   +8.334734296946970e-01   -1.935481424402655e-01   +5.299209595933143e-01   +3.958119144717365e-01   +3.080268100349060e-01   -2.106873924270974e-01   +1.370718485617936e-01];
L2E_L1E_iAMPA_netcon = [+4.739943085591791e-02   +3.818757750395783e-01   -3.377585146943395e-02   +3.173122825620001e-01   +2.452925338720472e-01   +4.686567898925074e-01   -1.313342320891885e-01   -6.755017279928088e-02; -7.585789518366357e-02   +3.438257542176942e-01   +1.541669504699182e-01   -7.415158493523810e-02   +5.369902414370461e-01   +1.547737358370196e-01   +4.650641258979795e-01   -8.171564071775975e-02; +1.480152681498371e-01   +1.996212418022266e-01   +3.542997310301876e-01   -9.320415304264706e-02   +3.336781046065045e-01   +1.062778145687165e-01   +9.164176801418514e-03   -2.011608678105886e-01; +2.320263541105255e-01   +5.922379867474264e-03   +5.007786462541632e-01   +2.210213263114515e-01   -1.713125794329550e-01   +2.599185593070201e-01   -1.426738198966178e-01   +2.887618798787671e-01; +2.455910021112263e-02   +3.883448742361524e-01   +4.286211353341868e-01   +6.124145245636626e-02   +4.680476969719990e-01   +6.285703729639848e-02   -4.187529815384116e-02   +2.286918031232417e-01; +7.878207988580916e-01   +3.975253969495043e-01   +1.829852911348691e-01   +3.090836506462852e-01   +1.877573428962518e-01   -1.597790647278316e-01   +2.337881803244695e-01   -2.774837720942773e-01; +5.729121294356698e-01   +4.913571568319551e-01   -3.931896527453033e-01   +6.322537424465353e-02   -4.794490394315066e-02   +4.296283835732517e-01   -4.121091267650718e-01   +2.404318715822841e-01; -2.650945472850429e-01   -1.072449150658057e-01   +4.049826356062242e-01   -1.489077841753514e-01   +7.317971236558141e-02   +2.853811254969768e-01   -4.906513114240579e-02   -4.237519623407496e-01; +4.664860801617796e-02   -1.738648009790227e-02   -1.015971621567755e-01   +2.727871792524213e-01   +2.250591611048154e-01   +1.771787968274997e-01   -2.338420841159081e-01   +6.813177705956464e-02; +4.089413914894452e-01   -2.228190307594048e-01   +3.741007760057364e-01   +3.164865953005934e-01   -1.047525031711266e-01   +2.126759646677870e-01   +3.049411222730194e-01   +8.718770066258403e-01; +1.127337815435791e-01   +3.434013055639989e-01   +1.115299107158477e-01   +1.990099706188954e-01   -2.456009374559269e-01   -5.519033913754061e-02   -1.130609322295807e-01   -1.949568372381260e-01; +3.412367046191582e-01   -2.700432645681300e-01   +3.746370612561434e-01   -1.147264579246000e-01   +8.343706003906368e-02   -3.287888107064218e-01   -2.066171102369364e-01   -8.101177440122932e-02; -2.488098348152389e-02   -4.326850751354290e-01   +5.648002672084161e-02   +1.907422653967985e-01   -2.517092492470049e-02   -1.326735790442015e-01   +6.373850888570132e-02   -2.186934365892735e-01; +2.435671667307385e-01   +3.885063957390072e-01   -2.976075727649447e-01   +1.296475956250826e-01   -1.309091322636290e-01   -3.176818097645597e-02   +4.468022554224673e-01   -1.727111960216902e-01; +1.163553916101734e-03   -1.771674628314721e-01   +1.290409571424549e-01   +3.108803910455015e-01   +8.509373114366520e-02   +3.421648491901295e-01   -3.244529489538479e-01   +1.908360529611196e-01; +3.791580816344548e-01   -4.221572205949310e-01   -5.537427035966175e-02   -2.165761225950978e-01   +3.067393946259434e-02   +9.328937325786779e-02   -6.461887470831107e-02   +6.163465632695909e-02];
L1E_L2E_iAMPA_netcon = [+3.223051831334612e-01   +2.740179763305045e-01   +6.897481831723211e-01   -8.360330149657318e-02   +5.805955000463646e-02   +4.881170715066401e-01   +1.601471349184182e-03   +6.185375694616183e-01   +5.294496050351807e-01   +2.195243586469420e-01   +4.486960363861953e-01   -6.392557057705010e-02   +3.411116075668576e-01   +2.481017207230640e-01   -9.181768073116492e-03   +3.993361727725796e-01; +3.854802029917668e-01   +4.014502647304600e-01   +3.474944145597839e-01   +4.028581434349744e-01   +6.538745366039746e-02   -2.115321764849780e-02   +4.533967928638043e-01   +1.584842991299553e-01   +1.527335599423157e-01   -2.256254223429829e-02   +1.388094022815931e-01   +8.428911080917407e-01   -2.103624182042848e-01   +4.314052621641083e-01   +4.070142871358856e-01   +6.705282196688042e-01; -4.466961180912170e-02   +2.814149791040630e-01   +4.836874055107910e-01   +1.768664378065457e-01   -4.637644591525951e-01   +2.904287359407761e-01   +3.831080861839610e-01   +2.076548138789988e-01   -1.510114808847591e-01   -1.878534375054552e-01   +6.195092770233195e-01   -4.615026922528299e-01   +1.952079186573288e-01   +5.096545587934531e-02   -2.529901404948957e-01   +1.760658122582005e-01; -2.236700310138810e-02   -1.773347681672603e-01   +6.524808189176831e-02   +3.059867431239928e-01   -4.693047162329489e-01   +4.436879121628177e-01   -6.871994860457538e-02   -1.056869327982052e-01   -5.945389118094178e-02   +1.859956755516951e-01   +1.939828556578391e-01   +1.937496114345487e-01   +7.535651534567125e-01   +3.748614186438290e-01   +2.220051696381416e-01   +1.401074550938753e-01; +3.341444146200724e-01   -5.532564075195887e-02   -2.660391796991112e-01   +1.201393258861801e-01   -1.301702434204592e-01   +6.046827026576932e-01   +3.294281215259567e-02   +3.592135675385528e-01   +4.165426137452728e-02   +1.486874613359407e-01   -1.877540565926372e-01   -2.593287370382305e-02   +4.641951566555573e-02   +1.430408413656913e-02   +4.710631302383386e-02   -3.340538679842313e-01; +6.795121770883317e-01   -1.505313292720353e-02   +3.421209949138523e-01   +5.307393793597770e-01   -3.319711138606757e-01   +4.142842354027239e-01   +1.800553666095061e-01   +5.145275234241103e-01   -3.025090297584094e-01   +1.047626745692016e-01   +6.413814774807483e-01   +2.164953364136791e-01   +3.338450211327900e-01   -4.747185915302508e-01   +4.747458307085941e-01   -6.610918350170478e-02; -5.302181391593789e-01   +1.262006956545095e-01   +2.565287182527747e-01   +7.888833665753717e-02   +5.665715003298171e-01   +3.600887340988813e-01   +6.989404994682099e-01   +2.489607102045413e-01   +2.893037020674194e-01   -1.856650087050549e-02   +3.608797152984557e-01   +3.461079063530109e-01   +5.436215107443871e-01   +3.096243567132128e-01   +5.272621122162280e-01   +7.090146760445971e-01; +4.651350147428511e-01   +1.411490127859680e-01   +1.361250705553339e-01   +7.013965786505042e-01   +1.235621040775468e-01   +2.788298635688354e-01   +1.296137455560787e-01   +4.591906843306456e-01   -5.787456210146921e-02   -1.166669491632606e-01   -4.565145302793395e-01   -2.772794225289696e-01   +4.613028117351953e-02   +3.708737880636238e-01   +2.061544414732802e-01   -2.554364085577937e-01];
L2I_L2E_iAMPA_netcon = [+8.635720252777121e-02   +3.036716701905139e-01   +4.568479498559905e-01   +1.868482706349828e-02   +3.698034549358790e-01   +7.518428444996967e-01   +1.379987474369224e-01   +3.130805552725367e-01; +2.921002084340964e-01   +4.572675338038082e-01   +9.294069976576452e-02   +3.338791750004345e-01   +2.205286340732639e-01   -3.656625889981585e-02   +1.712077960118872e-01   +3.400120467901371e-01; -9.008081174164508e-02   +3.420458187287181e-01   +4.592176705818966e-01   +3.668273688936800e-01   -3.435232455320595e-01   -1.969486674493008e-01   +2.287584452583884e-01   +1.734299681436788e-01; +4.239190670720233e-01   +8.634409603251311e-01   +9.200897682044773e-02   -1.441485325529483e-01   +2.656161319397363e-01   -1.256346929204532e-01   +5.238002411075430e-01   +7.252956951175324e-03; +3.913667862404443e-01   +1.410692509126465e-02   +7.107642091836621e-01   +6.900689439178929e-01   +1.626335179850364e-02   +2.984641067440703e-01   +4.550477272892245e-01   +6.384316891359593e-01; -2.315181602268057e-02   -4.494327648226219e-02   -2.649741993504545e-02   +2.972427887563655e-01   +4.055108786932080e-01   -1.354542877494660e-01   +1.398039103059994e-01   +2.910942595907714e-01; +5.336019582341596e-01   +4.385650154933874e-01   +2.982481356358467e-01   +1.617219346409322e-01   +4.667184923370229e-01   +8.681941729297427e-04   -1.421458889637525e-01   +4.906387234144639e-01; +2.506089305037889e-01   +1.285458489864027e-01   +1.917164793313017e-01   +3.011813224992428e-01   -2.809241493344767e-01   -1.619344424771960e-01   +5.270890718056397e-02   +1.275922416027780e-01];
L2E_L2I_iGABA_netcon = [+2.559233044663897e-01   +1.245299705638281e-01   -7.380104240965335e-02   -1.295024712198688e-04   -8.430113060323377e-02   -2.516781832352063e-01   +3.512591518732880e-01   +7.603215445399267e-02; +1.437775993566923e-01   +5.166051968045021e-01   -2.723580999684993e-01   +6.236810470341142e-01   -4.293298672678716e-01   +2.250265916474289e-01   -7.730549723326108e-02   +2.472715645062436e-01; -4.944728633851900e-01   +3.558677278831514e-02   +9.347847523298278e-02   -2.178390859773772e-01   +3.105266767950919e-01   +4.606574439504096e-01   +2.692142500376443e-01   -2.778212851231707e-01; -7.249059451068121e-02   +5.725947848547496e-01   -1.206485065339569e-01   -3.314305952486192e-01   +2.713815655919147e-01   +8.875089341887228e-02   -2.170941439788412e-01   +5.725506902437705e-02; +1.554588144192179e-01   +6.366597611376826e-02   +4.324903495261265e-01   +7.621777430248500e-02   +1.889405016023835e-01   +4.402755614972254e-01   +1.881312385865755e-01   +2.292764734878220e-01; +1.800866025645772e-03   +4.373057371102786e-01   +3.758490083753606e-01   +1.987521383323054e-01   +4.959801361567086e-01   +5.169830264877244e-01   -9.691015201686658e-02   +7.393092708293193e-01; +2.356829734801244e-01   -3.057580037558104e-01   +2.428546460420722e-01   -6.150972898925557e-01   -4.108600156704031e-01   +3.505912255594220e-01   -4.898568416726866e-02   +5.689718065471958e-02; -4.637641440272440e-01   -1.638378306205122e-01   +3.163310310134077e-03   +6.666925620736397e-02   +2.074799268617798e-01   +1.116132068061092e-01   +1.759387968132867e-01   +5.311668332499000e-02];
L3E_L2E_iAMPA_netcon = [+2.350683331519324e-01   +4.444325108001295e-01   +3.299287073369313e-01   +4.532757225043587e-01   -5.603466509108627e-02   -1.709669940941392e-01   +7.824813368501621e-02   -1.706945763995847e-01   +4.702613956240362e-01   -1.164692029961238e-01   +7.305635205590147e-02   +1.460832326550167e-01; +1.354043971751534e-01   +1.270388229675878e-01   +1.591668264735923e-01   -3.507039663847979e-01   -1.292901660142749e-02   -1.958333098591782e-02   -2.343359469212589e-01   -1.730439222640636e-01   +5.149371763418107e-02   -1.926104754913215e-01   +6.244463497183506e-02   -1.037844639349000e-04; +1.683834625260759e-01   +4.885291849781674e-01   +2.713370260483111e-02   +1.487991452586795e-03   +3.296674984601426e-02   +5.815965766495192e-01   +2.928034316006254e-02   +2.555829806598564e-01   +3.665008631508860e-01   +3.542574514627794e-01   -2.173815775666421e-01   -1.223895924209672e-01; -1.415912927822441e-02   -3.418871608432031e-03   -3.226107981309691e-01   +1.278044164741124e-01   +1.669977182924455e-01   -8.353914202261543e-02   -3.437825935129034e-01   +4.051920645290518e-01   +3.743321217662940e-02   -2.493765704400417e-01   -1.206840458809134e-01   +7.108249030609944e-01; +8.539354115253230e-02   +1.982916364005855e-01   -1.324643904564675e-02   +4.788330454373545e-01   -2.165430332804444e-01   +9.201244145724201e-02   +2.061680386808376e-01   +1.186233813582585e-01   +4.538586202563547e-01   -8.673225350981528e-03   +2.564949391725594e-01   +2.842843103303210e-01; -1.140109000789151e-01   -4.671526932059741e-01   +4.987617661779976e-01   +2.222881867910013e-02   +3.410204299903598e-02   +5.060002749056401e-02   -1.183924956895801e-01   +2.053701461964610e-01   +2.057366976344877e-01   -3.543602527393339e-01   +5.874076384952053e-01   -5.153326933341115e-02; +3.605535755230194e-02   +4.884342918103024e-01   +3.601945277666603e-01   +2.693644431270986e-01   +2.615959430821321e-01   +1.173570683133584e-01   +2.799265151582182e-02   -3.011789858785274e-02   +4.341931050841137e-02   +1.395550504630432e-01   +1.891085598283412e-01   -7.061402142552832e-02; +4.378918328550925e-01   -1.364898246795929e-01   +6.128363770143221e-01   -2.179299105265603e-01   -2.677546945803512e-01   +2.636654473364260e-02   +1.122587282110992e-01   +2.112967232729841e-01   +4.728745701362123e-01   +2.640173609381700e-01   +3.733492282481988e-01   +1.867084588115903e-01];
L3I_L2I_iGABA_netcon = [-1.829208541752587e-01   +3.088399674058863e-01   +2.171138794488261e-01   +1.215565309608010e-01   -1.532333145094973e-01   -7.397427793646802e-02   +5.303099777917567e-01   +2.273407359081862e-01   +4.629155891309575e-01   +8.739750059811913e-02   +3.061117786344523e-01   -6.492556568098329e-02; +2.861822960908763e-01   -1.782353161929298e-01   -3.121074718520833e-01   -1.641948638902429e-01   +2.263779005578652e-01   +2.479711057108171e-02   +7.316214752741141e-01   -5.173613978394407e-01   +1.689488040106248e-01   +1.462280670715025e-01   -2.486531511609648e-01   +2.264691189405134e-01; +6.471510441577455e-04   +2.993529865747758e-01   -2.297767375454374e-01   +6.668317544731297e-01   +8.872820403838564e-01   -1.967812825816584e-01   +3.788896367263869e-01   +3.673167439739649e-01   +7.564184470689943e-01   +7.717722824052100e-01   +3.702232985832227e-01   -2.403704692573495e-01; -2.969966800365744e-01   +5.020301767538450e-01   +3.194308739733218e-01   +1.026948089204245e-01   +5.593178947689097e-02   +2.036479565891778e-01   +2.697347908517749e-01   +1.177489657985755e-01   -2.780844739889747e-01   +4.206275277423654e-01   +4.796167465150348e-01   +1.169393690822065e-01; -2.483364726343356e-01   +2.008138061494625e-01   +1.496662285601342e-01   +2.782568900310594e-01   +2.959790434037180e-02   +3.596841311503391e-01   -3.895383601372838e-01   +4.707258814268690e-02   -4.137605917331742e-02   +2.892667805194235e-01   +1.782233633915946e-01   +2.467581270830017e-01; +3.333388190031389e-01   +1.451616276787558e-01   +4.998496938926054e-02   +1.104058542596754e-01   +7.003812953047952e-01   +1.799662281177797e-02   -2.959944308243352e-01   -6.329476878961307e-03   +1.536386039387659e-02   -1.287413817458467e-01   -1.999610066665189e-01   -2.571548259967606e-02; +5.449745726842945e-01   +8.443216807722284e-02   +1.034334656084847e-02   -2.624483582378555e-01   -1.171039765428099e-01   +3.619649377818115e-01   +8.653075646224462e-02   +2.622391691212463e-01   +2.068179153918843e-01   -5.812540896807585e-01   +2.123455221396308e-01   -3.343399148270266e-01; +4.265267101361776e-01   +2.788367670759063e-01   -5.087373403321598e-01   +3.281071264887761e-01   +6.610893752479280e-01   +9.782460360861699e-02   +1.775335815650391e-01   +2.988562695909860e-01   -9.042613146480905e-02   +6.062117298974550e-01   -1.143837138058902e-01   -4.177006811014755e-01];
L2E_L3E_iAMPA_netcon = [+5.523859977676708e-02   -1.285949978069241e-01   +3.123235476665361e-01   -8.362938088722868e-02   -3.623231014198753e-01   +8.781515459424874e-02   +5.022270192407978e-01   +4.062263566000753e-01; +2.445488817321314e-01   +1.731773178943507e-01   +1.641212290681125e-01   -1.522442114084989e-01   +3.478432149908214e-02   +2.421950969570232e-01   +7.158836410405600e-01   +2.230146551732980e-01; -2.699140733603251e-01   +1.579782357450004e-01   -4.262868581500734e-01   +3.641399270068399e-01   +5.291617006544218e-01   +1.586633179447433e-01   +4.106175496148896e-01   +3.825035541806417e-01; +4.273135844535751e-01   -1.974148420177984e-01   -2.829323319620829e-02   -1.026977860723031e-01   +5.969296933247106e-01   -1.333645674705001e-01   +2.207267978758008e-01   -2.568486264215189e-01; +6.135526575455792e-01   +2.509454847680419e-01   +3.414713414476781e-01   -5.909817569633119e-02   +7.290706464695742e-01   +2.522909275043048e-01   +2.617843391818994e-02   +5.725896413666850e-02; +4.191902239273202e-01   +4.657810999319965e-01   -2.679659256848335e-03   +3.206461054685759e-01   -3.884971079453411e-01   +3.839712796556015e-01   +9.284635944746086e-02   +1.986374875699954e-01; +4.556886593831256e-01   +1.595555890645832e-01   +6.814653121954737e-01   +2.567152722677908e-02   -4.916457012318695e-02   +1.009951859844903e-02   +3.957311347015417e-02   -6.950999447111121e-02; +3.926937830425871e-01   +5.018626930093164e-02   +7.088375217384082e-02   +1.741787022573439e-01   +1.463182057788169e-01   -8.830611370436535e-02   +2.565904640433542e-01   +4.485163071753450e-01; +3.712376600855171e-01   +9.602438915485390e-02   +2.037754450538518e-01   +5.702614582279054e-02   +2.588245285058716e-02   -8.866991289224840e-02   +2.223942905911835e-01   -2.928103535158664e-01; -8.031535367955883e-02   +5.728647596738440e-01   -1.804068056669427e-01   +4.487900134530777e-01   -9.968794263110645e-02   +3.070251628707669e-02   -2.087917449706982e-03   -8.463567912019321e-02; +6.994273795901885e-01   -1.241179285800720e-01   -3.915172394131827e-01   +5.560610817388880e-01   -2.399951528450885e-01   +2.935847554219098e-01   +6.431648507825090e-02   +7.323453340083970e-01; -7.649308290756432e-02   +6.453778995295336e-01   -3.407993846495863e-01   +1.431988646281126e-01   -1.011351886283506e-01   +4.773467925327033e-01   +1.243984150852718e-01   +2.168750976848036e-02];
L2I_L3I_iGABA_netcon = [+2.875707288381902e-01   +8.767348780211023e-02   +1.540280016753834e-01   +7.727721856796047e-02   +3.574775761050742e-01   +1.760845031359504e-01   +3.562781444789056e-01   +8.708750922082809e-01; -3.207737614759016e-01   +1.460539582891781e-02   -7.636583359256609e-02   +4.491431939503897e-01   +1.595640840691750e-01   -3.860644180192009e-02   +6.087614839833515e-01   +2.570765670616095e-01; +2.860166994494229e-02   -9.965205537357077e-02   +1.454933102001471e-02   -3.701080907732175e-02   -3.800458083048226e-02   +3.263787126829469e-01   +5.200909282024487e-01   -3.749424674101465e-01; +3.665970815499720e-01   -4.468439804793852e-02   -3.817664197839175e-01   +2.315059170844576e-01   -3.491075014613926e-01   +4.894804201353022e-02   +3.038688441778911e-01   +2.175696247208729e-01; +4.964851114051212e-01   +6.693476264239633e-02   -3.771596128265522e-01   -1.903537365417945e-02   +3.204057236771560e-01   +1.412606986780895e-01   +4.513882278886739e-01   +6.862139101563133e-01; +7.025139988898962e-01   +6.584982859367395e-01   +1.430055955552879e-01   +1.809130910945176e-01   +3.984566456223765e-01   +3.345188874957789e-01   +2.725477742448794e-01   +5.987001876174404e-01; -7.411322203919897e-02   +1.821013634606249e-01   +3.606974863408878e-01   +2.641435680122234e-01   -2.654631306072598e-01   +4.211505801789581e-01   -1.090337935188953e-01   -3.979115385210956e-01; -8.148194416263597e-02   +2.132169064393026e-01   +1.487581858061039e-01   +3.455840979025940e-01   +4.102657586710501e-01   +2.656078403608073e-01   -2.847151915334805e-01   -1.684832932417383e-02; +5.162620971522307e-02   +1.605850962005483e-01   -5.676123719809643e-01   +3.198464898001160e-01   +3.638392887367908e-01   +6.283724904141342e-01   +3.954005493387567e-01   -3.614230435520284e-01; +2.424260487331100e-01   +5.016640015592537e-02   +1.806881749149212e-01   +4.630036735682002e-01   -9.728260483636300e-02   +2.197794920780230e-01   -9.812278096341695e-02   +4.714704137179522e-01; +5.439147682122879e-02   -5.240446272072613e-01   +5.540257574475316e-01   +5.601375314603504e-01   +7.797904422464361e-01   +6.541894258319751e-01   +4.188826368056409e-01   +1.755695430984950e-01; +5.009899952675798e-01   +1.573234864588261e-01   +1.760780077139806e-01   -5.343464044089130e-02   +1.715591942374632e-01   -4.525766928774726e-01   -9.081384002680370e-02   +3.239968509668538e-01];
L3I_L3E_iAMPA_netcon = [+3.065814063238815e-01   -8.323005167779879e-02   +5.482230367229035e-01   +2.307226142100132e-01   -6.303094565940068e-03   +2.832572781007274e-01   -6.549033822934270e-01   +8.745000436115205e-01   +2.764719987803967e-01   +6.801751924849750e-02   +6.442535950379109e-01   +2.501676288195301e-01; +2.269928997571337e-02   -3.527332534227094e-01   -1.821559406475840e-01   +8.941853933144605e-01   +2.955193758104889e-01   +3.332922484694514e-01   +5.561850018210106e-01   -3.545175913799452e-01   -1.411923529604802e-01   -3.478153688993439e-01   +3.992608931163113e-01   -9.608700928971105e-02; +2.651699241965126e-01   +1.699471244348164e-01   -5.734766400944437e-02   +1.731729395348308e-01   -1.926069451784729e-02   +3.447225539848455e-01   -4.195459669980586e-02   +3.769470990071724e-01   +3.143269532102917e-01   -1.997838881039356e-01   +4.973681485399309e-01   +4.605132905073576e-02; -7.029832509812470e-02   +2.872210754140081e-01   -1.679715761878193e-01   -1.437174352167440e-01   +1.952980816013019e-01   +8.116530474287869e-01   +1.400252187230822e-01   +1.486819656936442e-02   +4.902082561132456e-01   +4.219290645566415e-01   -4.160322394174149e-01   +3.419680229253980e-01; +2.639614882009393e-01   +6.515355246243145e-01   -1.206612873964779e-01   +3.421392525183595e-01   -2.590809117119319e-01   +2.239372097430918e-01   -2.683732208158141e-01   -1.237092983152215e-01   +6.414713871961992e-01   +3.894438790014871e-01   +5.481334054452034e-01   +7.115351417259940e-01; +6.023826787721289e-02   +6.414934271501302e-02   +2.868629601783425e-01   +8.417166975290266e-02   +1.291704600187677e-02   +7.125302855399253e-01   +5.713034924366871e-01   +5.661585420942263e-01   +7.968541276773293e-02   -2.234630404470165e-01   -2.496678496839660e-02   +4.312130751412577e-01; +5.173886661909692e-01   +7.095291507896737e-02   -1.539462980537147e-01   +4.616779508799359e-01   +4.218448997019214e-01   +6.192987135076461e-01   +1.160222687911027e-01   +1.627979602740666e-01   -3.189693637326193e-01   +3.335067411553458e-01   +3.074785409411020e-02   -4.313306433724304e-02; +9.683730714677199e-02   -1.324716574372937e-01   -4.033963959473896e-02   +2.519665669414985e-01   +2.582912885496528e-01   +3.593620062710652e-01   +5.361215767642294e-01   +1.620292400976162e-01   -8.950289169741860e-03   +2.220659150322944e-01   -3.136427140253641e-01   +5.728713656160108e-01; -1.858659975331055e-01   -9.008210809934358e-02   -1.350263698133940e-01   -1.576687691615566e-01   -4.910135264353743e-01   +1.700438367035172e-01   +2.185270595065441e-01   +5.233063959804718e-01   +1.797985942691164e-01   +5.246525904251961e-02   +3.767533480299481e-02   -5.099393843477516e-02; +1.514578197689331e-01   -3.062679250974483e-01   -1.382971073802648e-01   +2.534243868749804e-01   +6.202854434782248e-02   -2.404012388302452e-01   +5.962311744488402e-01   +1.200725965255828e-01   -2.690199057955188e-01   -5.565256146853943e-02   -4.880205479665278e-03   -2.736880098336082e-02; +3.601069826548101e-01   -4.354096291383416e-01   +2.526326854080168e-01   +3.156233498945010e-01   +2.269227202103686e-01   -2.058499027758534e-01   +3.503264745016338e-02   +1.112782996098089e-01   +1.470252155176641e-01   -8.335098889411988e-02   +2.207219192570520e-01   +7.137829986010481e-01; +2.403457811079805e-01   -3.502688418238707e-01   -5.166808499748821e-01   +6.898667013974186e-01   +6.761206546188194e-01   +3.947814929858748e-02   +5.377782460546834e-01   +7.605796667307473e-01   -2.497130539996529e-01   +3.411805342603491e-01   -4.577182211117255e-01   +1.215855408817487e-01];
L3E_L3I_iGABA_netcon = [-1.605574437912368e-01   +1.616351490183422e-01   -1.457161830377618e-01   +3.049147981529863e-01   +3.680741294721606e-01   +1.414236542155630e-01   -1.770994468703708e-01   +3.863027033255243e-01   +6.398402208599367e-01   +6.330456988804406e-01   -4.149050381486067e-01   -2.733753722555626e-01; +2.124615980219504e-01   -2.498917928564129e-01   +1.788217825830873e-01   +1.690010630848762e-01   +2.828241108851640e-02   +3.482313269561920e-01   +5.068978420682008e-02   +1.049850851123172e-02   +3.274210304756360e-02   -2.766491155586535e-01   -1.060920355680630e-01   -1.445897335839901e-01; -2.762779388750523e-01   +4.683487237586610e-01   +4.365767979212306e-01   +3.297606979790657e-01   +3.948143291626685e-01   +1.855535957539971e-01   -1.712368864455613e-01   +6.813009119985208e-01   +2.071758745198011e-01   +7.613301596781007e-01   -2.740675278737481e-01   -4.449329819496267e-01; -3.072449223028063e-01   +4.724113790553365e-01   +5.326995623205181e-01   +3.668275269236598e-01   -6.322140226026408e-02   -2.921633883870756e-02   +1.576366910889637e-02   +4.752456172393552e-01   +4.251910217113266e-01   -2.734528590907641e-01   +2.356831135283824e-01   -3.730344239805369e-01; -1.607399448116090e-01   +5.506396615520577e-02   -3.721723519645689e-01   +6.570549361623060e-01   +3.249491069415002e-02   +2.173894715120596e-01   -1.576900201912479e-01   +3.281425312031972e-01   -5.089978427727387e-01   +1.149832689948765e-02   +2.497201785257900e-01   -1.445214081394246e-01; +3.009776465596076e-02   +3.762248967343118e-01   +4.133357734408656e-01   -1.927380330555731e-01   +2.143513772667984e-01   +4.478387835853685e-01   -3.762092785954164e-01   +5.160652543397962e-01   -3.411503556709157e-01   -2.314153088450867e-01   +7.267477393408670e-01   +2.995736931170602e-01; +1.233292388621870e-01   -1.036886028560425e-01   -4.022903797827521e-02   +1.319170969634056e-02   +4.737963160296325e-01   +5.419119092065257e-01   +1.522470975682189e-02   -2.478025444082751e-01   -9.334496260413608e-02   +3.237591117706813e-01   -2.854971940327563e-01   +2.199774054258834e-01; +5.898661654455504e-01   -4.077961689785851e-01   +9.496160894322661e-02   +2.841862042355957e-01   -2.268094271336848e-01   +2.169773100165590e-01   +2.485321075008163e-01   +1.126463570959994e-01   +2.268309049691953e-01   -3.762719165328690e-01   -4.914256787380945e-02   +3.088958363626870e-02; +1.410269131849775e-01   +3.795430084347783e-01   -4.927035367694631e-02   +3.494965625621763e-01   +1.462302152718301e-01   +4.138027586775364e-01   +7.228934955278061e-01   +2.819117970054387e-01   -2.320873275315668e-01   -1.672676468850146e-01   +5.119594686724009e-01   +1.882594293103074e-01; +5.448028281474310e-01   +2.433650125838901e-01   +1.278330364160566e-01   +1.769631538256478e-01   +6.764191190149027e-01   +5.040597470673939e-01   +4.728281749701174e-01   +4.385559963725398e-01   -2.134059944824126e-02   +1.846400404694969e-01   +3.173220102725704e-01   +4.107625123726982e-01; -1.442174186878555e-01   +8.249978438458018e-02   +2.692143544702318e-01   +5.975985471118928e-03   -2.458348256987714e-01   +1.923883350396548e-01   +5.668489184574098e-01   +7.857715435327032e-01   +3.794495681651567e-01   +1.862133370610301e-01   +4.438963207276703e-01   +3.260451373750523e-01; +3.902478883696872e-01   +2.704024708280294e-01   +1.751388026365965e-01   +2.706155660110918e-01   +4.828704259977595e-01   +8.958947378607807e-03   +2.642385220299344e-02   +2.102609671837437e-01   +5.853627236406217e-01   +7.120304724137580e-02   +5.552027994738464e-01   +2.099427510097732e-01];
L2E_Input1_iAMPA_netcon = [+7.728651620322196e-01   +6.395701387314112e-01   -3.307098028699950e-01   +1.402777964285449e-01   +2.236712366524408e-01   +2.712953534884691e-01   +5.087883402844778e-01   +9.271481497077412e-01];
L2I_Input2_iAMPA_netcon = [-4.311865261077871e-01   +1.450659333013739e-01   +8.256345322994878e-01   -5.518522044249672e-01   +3.480332430771222e-01   +3.984362022706273e-01   +5.614931519306660e-01   +4.460285210827777e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
