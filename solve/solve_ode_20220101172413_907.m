function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.858722575764105e-01   +1.535819917398550e-01   +1.715975110340771e-01   +5.473867696344166e-01   +4.185372523439316e-01   +2.230165213272197e-02   +7.308717183532589e-01   +6.503500283972435e-01   +3.521117249849200e-01   +5.956879158880524e-01   +2.880458144487875e-01   +1.029785243361596e-02   +1.002240316581433e-01   +4.967831484888093e-01   +3.126069720253490e-01   +4.603301176856208e-01; +9.403631046010694e-02   +3.256449581281299e-01   +6.442538477850092e-01   +5.485769946301839e-01   +5.534767086084008e-01   +7.238943043244849e-01   +2.725302739997348e-01   +3.023200282379845e-01   +4.678254678647270e-03   +2.369808301921801e-01   +7.565296133796630e-02   +2.026461451794855e-01   +1.343933583215365e-01   +5.715835672747648e-01   +2.518855769376023e-01   +3.319163365048648e-01; +1.653305622024752e-01   +4.734987172784781e-01   +1.361896600272784e-01   +1.463973778691506e-01   +7.832495848397402e-01   +1.086985510610419e-01   +4.940265888876811e-01   +6.494236037722613e-01   +5.549711855951576e-01   +6.172414214895313e-01   +5.729815075121339e-01   +3.469749337951993e-01   +4.119226847239312e-01   +6.994715922620079e-01   +5.578768093526703e-01   +1.072608552746253e-01; +3.584704933897497e-01   +3.532776431647356e-01   +4.443072135902335e-02   +4.374748861037460e-01   +3.697502011277530e-01   +3.305833058065006e-01   +4.228368159915975e-02   +5.851110807346941e-01   +5.111833543506789e-02   +7.069292515500097e-01   +5.340706676285094e-02   +3.272544986070893e-01   +4.951715947207419e-01   +3.341873846625102e-01   +5.094107264233858e-01   +7.407658830616891e-01; +7.929849102549972e-01   +4.814471095180457e-02   +9.320034830478940e-02   +6.311848971315203e-01   +8.674461546052827e-02   +6.090801782152341e-01   +5.559753354891291e-01   +1.232567674751317e-01   +3.441020707588404e-01   +4.206866716848254e-01   +7.118440835676485e-01   +9.710653039210612e-02   +4.618284013269265e-02   +3.743054971070001e-01   +6.302154025149952e-01   +7.479636453921699e-01; +3.813158008902169e-01   +2.607366511626990e-02   +7.314155293194986e-01   +5.849056505788613e-02   +2.116867203626122e-01   +5.340809928534084e-01   +7.885723100102736e-01   +9.064145707971591e-02   +5.720589534832686e-01   +6.416817477435136e-01   +5.793494209822126e-01   +3.779145463692015e-01   +5.351198884349787e-01   +6.051628092714681e-01   +2.479798605775978e-01   +6.799292645368250e-01; +1.491402820982513e-01   +4.376520907380783e-01   +5.737091497808197e-01   +4.977165338386412e-01   +8.857622715156735e-02   +1.311315320024818e-01   +2.936216473489893e-01   +8.602371472522530e-02   +6.550765248180730e-01   +4.222751109775605e-01   +2.118750636197186e-01   +1.344251349767103e-01   +7.740857363735363e-01   +6.829136749580025e-01   +2.398465990835240e-01   +1.000737301112180e-01; +5.824951288449450e-01   +6.896498327072172e-01   +3.589136582989579e-01   +2.538104445140738e-02   +7.662297577379817e-01   +2.687801546829312e-01   +3.192463579535157e-01   +3.885426014442440e-01   +7.361952257548269e-01   +5.186287001389360e-01   +5.374418574538593e-01   +5.989652428379578e-02   +3.402825006124948e-01   +1.544336423327673e-01   +2.906254090719389e-01   +7.535259429240255e-01; +1.086013220965849e-01   +3.549947846934722e-01   +6.818243148379741e-01   +1.077856797366658e-01   +7.375633039076870e-02   +1.774230254379120e-01   +2.148017589518482e-01   +5.343570624648850e-01   +5.223539904743543e-01   +4.084126731580699e-01   +1.780127004907386e-01   +7.371111900881015e-02   +6.069195071123873e-01   +3.768561300566791e-01   +1.839459262903198e-01   +4.763114289285000e-01; +3.634274587939476e-01   +7.906392685557707e-01   +5.422462988272528e-01   +5.358212856868743e-01   +5.463537143311611e-01   +2.789767635166026e-02   +5.469928105918350e-01   +1.404738522842740e-01   +6.026621353206020e-01   +2.025210826164271e-01   +3.367109718317830e-01   +7.607996328708698e-01   +2.636234063742285e-01   +5.358004301191746e-01   +1.254184777874903e-01   +2.780662306566124e-02; +1.803979396369705e-01   +2.704660603771275e-01   +2.098983968289811e-01   +3.948439759257931e-01   +1.042147430137761e-02   +3.792268399671736e-01   +7.448875010080009e-01   +2.296776805699343e-01   +5.441244398339832e-01   +6.138020673992695e-03   +2.947280954027945e-02   +9.776807163095265e-02   +6.767345448078049e-01   +6.106322540095033e-01   +3.918843070513102e-01   +8.969252497722666e-02; +7.562482105163452e-01   +2.942104870498827e-01   +3.993707448461049e-01   +5.164812317360833e-01   +2.937002897615085e-01   +3.443315758739679e-01   +3.516644102859692e-01   +6.308819815089559e-01   +5.297703042051625e-01   +1.144665905627352e-01   +2.186535127585188e-02   +2.003818629952462e-01   +9.460304417895206e-02   +6.578400875974760e-01   +1.168286626191624e-01   +4.668929691304911e-01; +1.600154060602964e-01   +7.765338785745691e-01   +7.023758333329269e-02   +1.805385521409173e-01   +6.464854511383591e-01   +5.986720938661205e-02   +3.821907853438364e-01   +4.608457134169289e-01   +4.330419041606875e-01   +3.869415735275559e-01   +6.959646102978346e-01   +7.106524852368930e-01   +6.288775641203146e-01   +5.933156538101307e-02   +2.855919232909329e-01   +1.823044855500993e-01; +4.846724764497837e-01   +7.351360848923250e-01   +3.920420772893491e-01   +8.428316539238430e-02   +6.621787411723317e-01   +3.212916515157709e-01   +2.879096064692989e-01   +4.728201423847468e-02   +5.913956971501489e-01   +2.891473713356201e-01   +3.505438390061993e-01   +4.769858174685545e-01   +4.012212112749882e-01   +5.141220811976472e-01   +1.397013599843494e-01   +1.399418196616731e-01; +7.767666590279515e-01   +5.104073277084656e-01   +6.988445345741553e-01   +5.722824998009582e-01   +4.620356078475892e-01   +5.055069529393432e-01   +6.141051369234789e-01   +2.245227582027629e-01   +3.504243861255283e-01   +6.777658877743183e-01   +1.700916036318435e-01   +2.339276901422200e-01   +4.972255429462117e-01   +3.756188944493008e-01   +3.729842329837548e-01   +6.234369999878713e-01; +5.897062409110311e-01   +5.956731802274090e-01   +3.055841123456881e-01   +4.644564928529195e-01   +7.261375167626241e-01   +8.987895637551212e-02   +4.250440976512466e-01   +7.057815109283695e-01   +7.261208493849659e-02   +2.442848446442226e-01   +7.177516045025857e-01   +6.148711691032936e-01   +3.012003582842774e-01   +5.227802030792819e-01   +3.854387496035935e-01   +5.387604770746131e-01];
L1E_L1I_iGABA_netcon = [+4.670106249399559e-01   +1.032323720220265e-01   +1.538569246217413e-01   +2.039640364640354e-01   +4.696694850224307e-01   +6.281935182827766e-01   +2.969124483150435e-02   +2.022763091655513e-01   +3.485599674986034e-01   +1.056764025469996e-01   +4.305521960325082e-01   +3.230831840764979e-01   +6.516145455059659e-01   +2.298158481192208e-01   +2.169025366839636e-01   +5.434372851237904e-01; +5.608838179728104e-01   +7.448111814035042e-01   +7.605235621937553e-01   +5.150057438690658e-01   +2.326117674240273e-01   +7.733475276187725e-01   +4.343497008628700e-01   +5.906422725461588e-01   +5.784265208683093e-01   +6.486785802007652e-01   +3.159934311322825e-01   +1.976387499412795e-02   +7.056887581575382e-01   +3.041748410359927e-01   +1.589896277865603e-01   +1.066844661246708e-01; +8.607217479243714e-02   +3.981704376264381e-01   +3.601657870341899e-01   +3.684080495921598e-01   +6.950957507773565e-01   +7.696456696601688e-01   +3.791632528318656e-01   +5.352990528310011e-01   +6.170220369462709e-01   +4.679832873790321e-01   +3.997944329631085e-01   +3.120469748540460e-02   +7.780920340615783e-01   +6.026557385615464e-01   +5.717644032253516e-01   +1.709744222529671e-01; +4.327552715453666e-01   +3.097990504636519e-01   +1.925428264563706e-01   +6.304425665562760e-01   +1.133336383747216e-01   +5.176751199313581e-01   +2.655637224547178e-01   +5.279543607078369e-01   +4.875078718759762e-01   +1.791684892685496e-01   +4.774711429068559e-02   +6.750991480141914e-01   +5.670423290692438e-01   +4.773328383442964e-01   +4.853566891952555e-01   +3.295455163316429e-01; +1.898061946047528e-01   +4.857492581121191e-01   +1.302107193967013e-01   +7.532333360669113e-01   +3.536703321782102e-02   +8.009234395596371e-01   +5.789329937600263e-01   +4.531046188703014e-01   +5.855562280401015e-01   +7.462191492554684e-01   +7.500110728323927e-01   +3.917714326171263e-01   +3.895508156738109e-01   +6.382442873087555e-01   +8.751554642413298e-02   +5.851183578628739e-01; +3.033308807279540e-01   +3.196711130318367e-01   +6.633123367125938e-01   +7.085128943678228e-01   +3.557148996789445e-01   +7.142226695831843e-01   +1.863719196805697e-02   +3.254090809784377e-01   +5.816645239571996e-01   +3.426864546376397e-01   +4.954466043429349e-01   +5.884163613193604e-01   +3.960311760188334e-01   +3.963698164289646e-01   +4.798321772058708e-01   +3.594797731830867e-01; +9.458969452475821e-02   +4.327629253740728e-01   +1.365379760895989e-01   +5.856432383446084e-01   +9.366618024905339e-02   +1.447645931134011e-01   +3.828684302115847e-01   +2.876063830356534e-02   +5.817268793794785e-01   +6.912154937372710e-01   +6.152806703154781e-01   +3.189234340287957e-01   +2.755633786946422e-01   +4.310085830120357e-01   +1.042820386568759e-01   +7.934621843791136e-01; +3.743362417474330e-01   +1.063797670488521e-01   +4.431686615238692e-01   +5.545958477403610e-01   +1.270866116478891e-01   +6.489202841129813e-01   +5.463898102584269e-01   +1.065618242772547e-01   +1.335009848399371e-01   +6.728366727601923e-02   +7.903207712394875e-01   +5.396072109270466e-03   +2.352784760582083e-01   +1.922413319678821e-01   +5.382797060518380e-02   +5.444660727078470e-01; +4.639232587003174e-01   +3.243878042685499e-01   +2.914674695161525e-01   +6.509008863489365e-01   +2.408053155927456e-02   +5.149321200511083e-01   +1.821256684026167e-01   +2.650751402620841e-01   +2.023289684014782e-01   +4.673728806987559e-01   +8.754487829215923e-02   +5.960583507472189e-02   +4.743704737219720e-01   +8.792444294094191e-02   +5.428067352884557e-01   +3.541402889947905e-01; +6.343308232753522e-01   +6.956948191301918e-01   +7.142185003780628e-01   +2.041518269409050e-01   +6.909855410287523e-01   +6.359929272656676e-01   +5.330242517879594e-01   +2.050923894853478e-01   +6.591117042748662e-01   +6.571947348771726e-01   +2.598524677187398e-01   +5.033349530760596e-01   +5.846041239916714e-01   +4.244269882493162e-01   +1.664987495659451e-01   +4.535621296602836e-01; +2.997006478776216e-02   +4.306505008310492e-01   +6.722511492276121e-01   +6.050647621384068e-01   +3.817387109872735e-01   +7.514857666729863e-01   +5.831257937045199e-03   +1.977787593937178e-01   +3.268290944544306e-01   +2.694635950430335e-01   +6.802182349017446e-01   +1.322837910909614e-01   +5.797319245164919e-01   +5.591172483217166e-01   +6.328670860005053e-02   +5.235480078849105e-01; +6.937925740170742e-01   +1.990600805504585e-01   +4.065408303879722e-01   +4.960542854122790e-01   +7.891490341844335e-01   +2.926719152013387e-01   +3.876317433214481e-01   +7.974497979809526e-01   +2.040634549548256e-01   +5.224487844952522e-01   +2.916281167991813e-01   +6.369529747622221e-01   +5.104044947474449e-01   +1.726088808363599e-01   +3.673112576108111e-01   +5.295074608177095e-01; +6.564019849900313e-01   +3.810929063088025e-02   +4.905432560211631e-01   +4.564624668801564e-01   +5.176952282162465e-01   +6.827053501075261e-01   +1.259686142157895e-01   +2.875848912469981e-01   +7.609348723709826e-01   +1.260255508239754e-01   +9.503503129368368e-02   +7.495539125668801e-01   +7.083182153046990e-01   +5.453726942386413e-01   +5.525544629943453e-01   +1.814816756408179e-01; +1.301511525458650e-01   +2.535215116050294e-01   +7.000512700034532e-01   +4.012465342561762e-01   +5.873023409665650e-01   +6.017321120034045e-01   +1.735330111699889e-01   +6.056851732681002e-01   +2.540176005218595e-01   +3.665203554906004e-01   +7.139082289075485e-02   +6.925579932062861e-01   +6.172812448252893e-01   +2.777172245413564e-01   +3.478458635872833e-01   +3.843768996708383e-01; +2.152119484077579e-02   +6.474644455263080e-01   +6.950346041199449e-01   +2.837229208363822e-01   +5.941762240472499e-01   +4.075983637973435e-01   +3.038931841392734e-01   +1.940308634193846e-01   +4.323275010242451e-01   +6.948399125196868e-01   +6.690824699217190e-01   +7.008092278978891e-01   +2.522020292513588e-01   +2.905384784316774e-02   +2.251644634858659e-01   +4.910898784825639e-01; +6.632963244303881e-02   +5.375309628720973e-01   +6.807522696565985e-01   +4.834947164981626e-01   +7.276397966407541e-01   +3.353858549262467e-01   +2.518415988851069e-01   +4.762451400493006e-01   +4.296808555345436e-01   +4.507880246494638e-01   +2.528244205251302e-01   +4.750369206858007e-01   +6.474999750383530e-01   +2.316432462368243e-01   +9.218279071728935e-02   +2.958919687588338e-01];
L2I_L1I_iGABA_netcon = [+4.950642584834946e-02   +1.114315766290271e-01   +7.169247520130276e-02   +4.574872054920489e-01   +3.934580279942394e-01   +3.054426302593133e-02   +2.131375747787185e-01   +5.831616940157777e-01; +1.882822013854032e-01   +4.133588338723886e-01   +6.519985635010995e-01   +7.073326424516247e-01   +4.601477668610348e-01   +2.939842310264529e-01   +6.860935203102196e-01   +3.741077932869190e-01; +7.292213426984815e-01   +7.541021152711079e-02   +5.766933515035013e-01   -1.756293128701890e-04   +7.837067199978905e-01   +9.196245042736814e-02   +2.591719153096976e-01   +4.766469621862992e-01; +2.565099890685476e-01   +1.078594281054828e-01   +5.231022338774758e-01   +4.963010599581190e-01   +3.768000510360521e-01   +7.443644186863425e-01   +6.236661024066816e-01   +5.202700437946632e-01; +5.091389555000418e-01   +2.620927073661348e-01   +2.983222705118522e-01   +3.742562047681496e-01   +3.904267050357169e-01   +4.599270713456897e-01   +6.119119905213829e-01   +6.868650064829694e-02; +5.291166853766854e-01   +1.810872923489922e-01   +7.776849141473486e-01   +9.549425818543571e-02   +6.973569913159907e-01   +1.589296959068601e-01   +5.705268309048277e-01   +1.507489412146708e-01; +1.520310934046254e-01   +7.787515698547494e-01   +4.118115889022544e-01   +7.942105299402432e-01   +7.432514600852885e-01   +2.377989654651098e-01   +7.262365187538967e-01   +3.859377995225090e-01; +3.254651826501865e-01   +2.905797037422768e-01   +3.455382507499647e-01   +1.003466995707956e-01   +3.190960615040447e-01   +8.883149968990501e-03   +6.711051397426240e-01   +7.176150122041310e-01; +1.024854806593461e-02   +6.587005013250511e-01   +2.260489437848160e-01   +3.900279929450364e-01   +6.089507805923656e-01   +7.832028862215415e-01   +4.618284632158145e-01   +1.504482572670867e-01; +1.538092351454206e-01   +4.415997007219261e-01   +4.317873074946699e-01   +3.147003368288548e-02   +5.714557517518773e-01   +5.825251905413500e-01   +1.354625408303771e-01   +3.445202894785363e-02; +4.149334385579636e-01   +2.947760920752333e-02   +3.083963883976089e-01   +1.209571297212960e-01   +2.104283850179872e-01   +7.123954916580082e-01   +7.853000628499146e-02   +2.392533075747057e-01; +1.505482459638764e-01   +1.075266130139320e-02   +6.932087773476370e-02   +5.508572722808612e-01   +2.815695526715811e-01   +5.124967812052941e-01   +5.533439959560807e-01   +6.476752845606765e-01; +6.049461663780782e-01   +2.415491340685172e-01   +6.563829560315687e-01   +4.433008576433127e-01   +3.006291096635722e-01   +4.190091695436299e-01   +2.688060157193872e-01   +6.026985552541598e-01; +1.421598365115887e-01   +7.402449040978675e-01   +5.646954535182171e-01   +6.808489296862510e-02   +7.941211455096435e-01   +4.817715004404958e-01   +1.774543944799551e-01   +4.729384953734754e-01; +7.028165116569077e-01   +4.541826447011509e-01   +5.309178898889094e-02   +7.950793904762918e-02   +1.602468886127252e-01   +3.586797404156164e-01   +6.828268918109275e-01   +7.071395841200945e-01; +7.977606508104474e-01   +6.987679988178287e-02   +9.234787158054956e-02   +6.783705852301977e-02   +6.686926103418243e-01   +2.380028313047640e-01   +4.884802638798165e-01   +6.235239168400808e-01];
L1I_L2I_iGABA_netcon = [+2.245055862792687e-01   +7.898204551949570e-01   +5.733070662472056e-01   +1.101120891230381e-01   +7.892887139172073e-01   +1.276663592821228e-02   +5.003568267423087e-01   +9.675220084703529e-02   +2.728169017364730e-01   +6.368662693330558e-01   +4.385020375440542e-01   +6.849193937505266e-01   +6.424111048288806e-01   +6.028475023841658e-01   +3.885650575561794e-01   +7.868866816367809e-01; +4.909075052389704e-01   +3.355136847705909e-02   +3.463155902404174e-01   +4.901919385025499e-01   +1.597487853683533e-01   +3.411641392025874e-01   +1.439089070685790e-01   +7.311499664049277e-01   +4.568295019471496e-01   +5.646131414398268e-01   +6.716077504527191e-01   +7.843821119686651e-01   +2.150036357700457e-01   +1.980075405631471e-01   +4.128777787880367e-01   +3.695388003887254e-01; +5.826197412005163e-01   +1.889299286809765e-01   +7.218108477366600e-01   +3.757225554952038e-01   +2.499861083076172e-01   +4.925334846656121e-01   +6.377371289027286e-01   +2.003426491603182e-01   +6.970455245439909e-01   +1.511358625000758e-01   +3.629279110190865e-01   +2.870211825047333e-02   +4.204842473010816e-02   +2.495658190982465e-02   +2.647045429586732e-01   +2.999333788983637e-01; +3.993140910826851e-01   +6.075308482024083e-01   +8.350254912180566e-02   +5.706301304415929e-01   +7.883744116561313e-02   +6.397391505155713e-01   +5.681037726584790e-01   +2.025483910271113e-02   +6.968529942132804e-01   +7.598480615689480e-01   +2.207556713501426e-01   +6.261222208197419e-01   +4.929987853564069e-01   +5.006970062610026e-01   +1.906221932255633e-01   +7.086101993828340e-01; +1.662864461287831e-01   +5.916450936439078e-01   +1.208330312372699e-01   +3.200051081418927e-02   +7.625372962312524e-01   +2.640966645626971e-01   +4.935623787455788e-01   +2.420138914407356e-01   +1.372029941661889e-01   +6.195153551455664e-01   +6.750662746847339e-01   +6.972692587320057e-01   +2.534797573634062e-01   +3.634378338914732e-01   +6.933412183171362e-01   +7.879307723708336e-01; +6.748816040558046e-01   +4.240606651449657e-01   +6.138025661154863e-01   +5.168561729781985e-01   +5.117343348798011e-01   +6.621404867099858e-01   +3.203240236919275e-01   +5.638782232300469e-01   +2.071101139447973e-02   +3.353661415482236e-01   +1.423447026710925e-02   +5.943340392583689e-01   +1.130309121235299e-01   +7.391777981045777e-02   +7.539297295305466e-01   +3.931146281997176e-02; +5.024058064433806e-01   +2.839015967356307e-01   +2.914665354184763e-01   +7.593489061862160e-01   +5.556799854902439e-01   +3.911451629050657e-01   +7.060893034286905e-01   +1.049405285730446e-01   +1.121786002283861e-01   +6.044041773120196e-01   +2.460481258136877e-01   +2.919226932585735e-02   +3.276314194529679e-01   +8.654050143359308e-02   +5.731143934285847e-02   +3.880640456545005e-01; +7.332335930018277e-01   +4.301204351435407e-01   +1.901698891867620e-01   +5.386457820196110e-01   +3.586827051536504e-01   +5.004806226241127e-02   +1.649203562600093e-01   +6.798867802647325e-01   +4.357267006510176e-02   +4.502889094299152e-01   +4.770661279683112e-01   +2.381519201572662e-01   +2.949570535816405e-01   +5.916346459605515e-01   +6.805492949628960e-01   +2.015048876129659e-02];
L2E_L1E_iAMPA_netcon = [+7.094826820340913e-01   +2.857608489804160e-01   +6.613018281864013e-01   +1.002360637127698e-01   +7.668848711146451e-01   +5.760891218827151e-01   +7.643179231323657e-04   +3.675921878722661e-02; +5.991485246466003e-01   +9.771217699689598e-02   +3.948845563331749e-01   +3.011403696551601e-01   +3.071051061533329e-02   +4.989972257534698e-01   +3.175600920838724e-01   +3.063311422137087e-01; +1.282645701682781e-01   +2.508950063661625e-01   +1.113662932158579e-01   +3.725592724338166e-01   +6.603080181228157e-01   +6.347855122234781e-02   +4.327019424509157e-01   +4.944658832983290e-02; +2.659563480829785e-01   +3.942620409471974e-01   +1.709640936694958e-01   +3.814340585777812e-01   +3.203071607586751e-01   +1.539473600045433e-01   +5.471344442630846e-01   +5.570558660402867e-01; +3.230267810138021e-01   +4.344712379620714e-01   +1.484295054288889e-01   +6.319945902553852e-01   +7.127896817457255e-01   +1.640478161772447e-01   +5.849492237491664e-01   +1.191310521558311e-01; +4.647635676556061e-01   +1.503099256007361e-01   +5.869010288226369e-01   +6.592682909521108e-01   +1.577991208914239e-01   +3.510220173931672e-02   +2.162864844356342e-01   +4.533742086933639e-01; +2.592792041243964e-01   +7.369641083800599e-01   +5.256987986090251e-01   +5.790652484989299e-01   +3.701183193485946e-01   +5.658524811421698e-01   +3.376696292778216e-01   +1.802580247710307e-01; +1.720143396057125e-01   +5.651346096339703e-01   +3.544673235355173e-01   +5.639757339664960e-02   +2.950986828349700e-01   +6.782311429118659e-01   +7.904716324284841e-01   +6.674115236047198e-01; +9.860905169885673e-02   +5.845975931694376e-01   +4.073314366369736e-01   +4.718178355583476e-01   +4.111265491556172e-01   +6.851795911962304e-01   +3.211163923203817e-01   +7.595284922112241e-01; +7.057813249836875e-01   +6.929470951720812e-02   +1.476364036000446e-01   +1.962796758466840e-01   +6.095084258716587e-01   +6.330969177768139e-01   +8.801378035900422e-02   +4.225823609027657e-02; +4.024839216218443e-01   +7.314234364651409e-01   +6.720079652820259e-01   +2.562848004592019e-01   +2.903435262433455e-01   +5.805690213700186e-01   +1.439273492418358e-01   +1.329116242598985e-01; +6.289295748582709e-02   +7.219832349933933e-01   +7.205693839861230e-02   +2.780364024937878e-01   +2.498576773297143e-01   +3.787983769852580e-01   +7.904228361051902e-01   +6.113806947609050e-01; +1.364988417852754e-01   +6.961668207809469e-01   +5.577247269886455e-01   +4.624540423440429e-01   +3.994370592961862e-01   +5.005033068361846e-01   +1.311708322208406e-01   +5.773004181153674e-01; +7.808585855389717e-02   +2.931561591065899e-01   +9.448928723065528e-02   +5.584773297353091e-01   +6.969861615515061e-01   +6.030732712945174e-02   +3.920777445422201e-01   +5.374867076973415e-01; +6.415525491670545e-01   +4.918863112318236e-01   +1.364273991995217e-01   +5.812705452801048e-01   +5.994200905284359e-01   +2.791753105947377e-01   +1.008297995753250e-01   +6.431504619342018e-01; +7.728398544135430e-01   +2.423035012759991e-01   +2.345943179680624e-01   +3.533684745044964e-01   +4.507221500114377e-01   +5.076632759698223e-01   +2.224618716795854e-01   +6.247586919403908e-01];
L1E_L2E_iAMPA_netcon = [+7.692887592337440e-02   +6.835313877485909e-02   +2.956188077183561e-01   +5.781666932867190e-02   +6.288402709438987e-01   +2.772026254605544e-01   +2.138009598145107e-01   +6.023878149908158e-01   +6.171933403386833e-01   +7.421645823853297e-01   +7.638564880165528e-01   +4.548695619206692e-01   +7.287502440387178e-01   +6.621224030778581e-03   +2.343757906042111e-02   +5.391279591697181e-01; +2.479169485093609e-01   +6.693781371483432e-01   +7.668754857384914e-01   +2.820509965003295e-01   +1.811494606426453e-01   +8.823006340280420e-02   +5.173123376143610e-02   +2.075176837997757e-02   +2.833703865251584e-01   +6.542256945387672e-01   +2.608777807174408e-01   +3.440994561432778e-01   +5.894854436721094e-01   +7.608294970309464e-01   +1.602029151739204e-01   +4.193671000360092e-01; +4.059394481668487e-01   +6.628936865284686e-01   +7.006769819224558e-01   +4.823580387811524e-01   +5.085478358009550e-01   +7.051528979386222e-01   +5.309110748983427e-01   +2.124657067879596e-01   +1.338457264646997e-01   +4.844484453151646e-01   +1.868545408731775e-01   +8.144223257697455e-02   +6.076139632241738e-01   +2.435758866199300e-01   +5.737416009606969e-01   +2.705184513458017e-02; +4.077167833418286e-01   +1.380512271401809e-01   +4.947559126486625e-01   +4.951320907784452e-02   +1.519524027792704e-01   +4.080667146971230e-01   +5.849476872641880e-01   +2.928421124485516e-02   +7.886655571591357e-01   +4.993927171273497e-01   +1.399909958229272e-01   +1.171492004814840e-01   +2.548706234613048e-01   +4.091208534568096e-01   +4.674771710666418e-01   +5.670373063216601e-02; +6.531446879952156e-01   +3.689219131322675e-01   +4.527419401044275e-02   +6.683590485579464e-01   +6.725545034007688e-01   +3.160341307648090e-02   +3.826490951717679e-01   +4.902537407714365e-01   +3.321994387156256e-01   +7.474680324633965e-01   +3.270523470979452e-01   +6.323387660076265e-01   +2.108330717867097e-01   +1.555584268968667e-01   +1.551519245492463e-01   +4.741568000893785e-01; +5.803141185677276e-03   +4.167331745033917e-01   +1.653645749240780e-01   +4.958149665475239e-02   +2.217435312442965e-01   +1.508942578765525e-01   +2.681985965527107e-01   +7.543944710990415e-02   +3.086804256450197e-01   +4.500004571170907e-01   +4.670987138122280e-01   +9.069595785594713e-02   +4.488973823262474e-01   +3.056125514394072e-01   +6.532066217203403e-01   +7.634859963864533e-01; +4.265483308847767e-01   +6.769496313030874e-01   +5.686358046205029e-01   +6.555512232388914e-01   +2.643399335777186e-01   +3.429226311773335e-01   +4.005147607763670e-01   +2.087776054056954e-01   +7.294785813612433e-01   +6.629908778849650e-01   +5.024780470134828e-01   +8.858292966502429e-02   +2.249237270558181e-01   +2.527852213161231e-01   +2.879226269432678e-01   +3.345493010027203e-01; +7.141690045003659e-01   +1.414268789288632e-01   +4.424647784714220e-01   +1.162494980329303e-01   +5.166608835676941e-01   +7.012601686574691e-01   +2.316325939548682e-01   +7.379513997109567e-01   +7.438472010580129e-01   +7.072245924111685e-01   +2.246840359028664e-01   +9.065422122509707e-03   +4.109577793630916e-01   +6.403036370625471e-01   +7.156255428249237e-01   +4.595581997578291e-01];
L2I_L2E_iAMPA_netcon = [+3.102625124189028e-01   +4.735169302711421e-01   +4.007241271456106e-01   +7.772808056991698e-02   +1.307934310964552e-01   +1.528244405924732e-01   +7.943108445969232e-01   +6.529494658867828e-01; +9.574562920401528e-02   +3.400599122336834e-01   +2.630002445628082e-01   +4.674615777801871e-01   +3.761845968066699e-01   +6.447753908422376e-01   +6.475230469851235e-01   +3.110213893818628e-01; +2.177157649451131e-01   +6.382773902649030e-01   +1.696778101990085e-01   +1.666936167016561e-01   +1.982631000912501e-01   +4.515796555191285e-01   +7.514677659586453e-01   +5.314241013845445e-01; +6.644315669393643e-01   +2.292975614011471e-01   +4.771745437339105e-01   +4.916327763827734e-01   +2.677869817218226e-01   +5.405034083990473e-01   +4.435612830685799e-01   +5.228206779158427e-01; +4.493195345458489e-01   +3.857290872609553e-01   +4.334547898266088e-01   +5.805037150616645e-01   +1.661208985358083e-03   +5.933793803044104e-01   +4.979875317659410e-01   +1.992182570429742e-01; +6.676389468325957e-01   +5.166556040898018e-01   +5.668594413565815e-01   +8.076785071391477e-03   +1.688572232314944e-01   +6.460144113257393e-01   +6.494594664293982e-01   +9.052299401997357e-02; +6.140569194351055e-01   +2.212564433096973e-01   +4.976647556179681e-01   +3.877119536555334e-01   +3.489713816530664e-01   +4.168722028140694e-02   +1.070101868462116e-01   +1.391567334389089e-01; +2.293049745969250e-01   +3.689723095934916e-01   +5.828958435281595e-01   +6.288766316028277e-01   +6.987058881009851e-01   +2.946825099758314e-01   +6.153623801128673e-01   +4.352812579905134e-01];
L2E_L2I_iGABA_netcon = [+3.763902960048970e-01   +4.047938896143711e-01   +7.152126737008521e-01   +2.565194808806197e-01   +5.611003130630161e-01   +6.672394515739951e-03   +3.621392954995920e-01   +6.824971740206602e-01; +2.767300049306881e-01   +4.149594577426893e-02   +5.319675181533029e-01   +7.728602904223125e-01   +2.375553658485048e-01   +4.272527767211990e-01   +7.037335499871965e-01   +4.164974875589357e-01; +3.810403156827094e-01   +1.091447306558264e-01   +6.414866729006299e-01   +1.806075572156636e-01   +1.608047603280419e-01   +6.978663860069768e-01   +1.912173823329093e-01   +6.368783231733727e-01; +7.813180848523003e-01   +4.736526176384238e-01   +4.643734257706624e-01   +2.986794596725274e-01   +2.869592381290982e-01   +4.072012839180361e-01   +7.221984575453551e-01   +6.034062639401768e-01; +5.930720021248271e-01   +3.102548687658738e-01   +3.104241774928687e-02   +1.986135019645295e-01   +5.732420475676672e-02   +1.696111680832809e-01   +3.044780100410771e-01   +2.182743879302406e-01; +7.755792169994287e-02   +5.709695685626233e-01   +7.270628840029563e-01   +3.823750767242652e-02   +3.648049054682059e-01   +6.359838440447474e-01   +2.200878556197786e-01   +1.607786514474421e-01; +1.787011512761555e-01   +5.772026756389779e-01   +3.797826993703570e-01   +6.862468300765177e-01   +7.925925182002850e-01   +4.719008433669091e-01   +2.960154298206611e-01   +5.235434752836013e-01; +2.306217037567206e-01   +1.994983992230159e-01   +4.622528685969197e-01   +2.090819512103375e-01   +7.666772665568276e-01   +7.904815153040230e-01   +6.062239352931688e-01   +8.496123616211820e-02];
L3E_L2E_iAMPA_netcon = [+2.939227924537083e-01   +3.393658928867467e-01   +7.791911945606942e-01   +6.976123404007005e-01   +7.830396804775823e-01   +4.738682014770132e-01   +1.717373247014455e-01   +2.398033171154202e-01   +5.943414193135860e-01   +5.511205750461338e-01   +2.819144816374770e-01   +2.676175707602971e-01; +5.917644560409099e-01   +4.290923188901548e-01   +5.379769463862603e-02   +7.900196347694570e-01   +1.711621030138876e-01   +3.536865295848722e-01   +2.834190109420608e-01   +6.583339806376127e-01   +5.735091931138707e-01   +5.112708406647973e-01   +3.378799094743173e-01   +3.148312494603406e-01; +6.018559381869680e-01   +5.600206665604577e-01   +4.049946603423575e-01   +5.621112507704294e-01   +3.239331352445677e-01   +6.806447583249923e-01   +5.918390653607942e-01   +2.181952635497142e-01   +5.580237681594546e-01   +1.298163609777533e-01   +3.993883247676551e-01   +5.689463968338059e-02; +4.101824420852479e-01   +3.552334023758437e-01   +2.499369180797689e-01   +7.222464679314327e-01   +7.615592754437525e-01   +6.463009552350794e-01   +8.002233492531168e-01   +2.331332913928267e-01   +6.455879893859815e-01   +3.012736820855410e-01   +5.633478414338070e-02   +3.916187743612312e-01; +3.476893981130740e-01   +6.301113021400914e-01   +4.779561134947684e-01   +4.040828848695538e-01   +5.307648330347289e-01   +7.545986460613121e-01   +4.634321834974893e-01   +3.143452489349912e-01   +1.077632790982283e-01   +5.562910234260460e-01   +7.861466254965214e-01   +6.066766451217948e-01; +1.712813074300201e-01   +7.252987123143289e-01   +6.614266469598946e-02   +1.166782427662590e-01   +5.119275806426139e-01   +6.725752338291503e-01   +4.860182143307464e-01   +9.732903555039971e-02   +7.267929881953048e-01   +4.833553969857002e-01   +5.126926341411548e-01   +3.707919775147318e-01; +5.051618055866772e-01   +1.623308854061678e-02   +1.606534831418976e-01   +4.676956340060494e-01   +6.742936360382553e-01   +4.413555862052728e-01   +4.418785660561234e-01   +3.603881172136367e-01   +4.514192253068610e-01   +1.887116409589457e-01   +4.760108061737091e-01   +7.672593357127335e-01; +7.688473725153734e-01   +1.276406523721461e-01   +8.805157227622520e-02   +7.353813545222176e-01   +7.451990969394705e-01   +2.071265940062388e-01   +5.448032787452404e-01   +3.995336890369506e-01   +3.518107586962698e-01   +1.712860832402255e-01   +2.495367326753011e-01   +1.593180259965609e-01];
L3I_L2I_iGABA_netcon = [+5.556939214422199e-01   +4.285601867120288e-01   +4.188905760763959e-01   +1.059918328945456e-02   +7.596982417748700e-01   +5.374612105150719e-01   +6.169414608718002e-01   +3.195514594544311e-01   +6.326880621082975e-01   +2.701772968928940e-01   +1.631396344954844e-01   +6.440876366080518e-01; +4.758362519911836e-01   +6.716085669808488e-01   +7.854646897524690e-01   +4.167938617912101e-01   +6.137880086222948e-01   +2.831959165079103e-01   +7.884657615836739e-01   +5.348055325992637e-01   +1.617386027247205e-01   +1.357663272636027e-01   +5.653802169216160e-01   +2.230976747465274e-01; +2.754668512341119e-01   +5.409482092337661e-01   +5.253164224440483e-02   +7.934132989891252e-01   +4.448913738630982e-01   +7.951943202893451e-01   +1.939307095976820e-01   +7.116834425609658e-01   +4.783739651795152e-01   +2.427589659744329e-01   +3.768469566594812e-01   +2.141297005263242e-01; +6.698033497412265e-01   +4.605877181446297e-01   +7.309029479480147e-01   +4.428696420947949e-02   +1.122901716436218e-01   +6.557398957991775e-01   +6.553619006775108e-01   +6.147971446355294e-02   +7.804643609064069e-01   +7.749574317613711e-01   +7.416736877158413e-01   +1.527154389506003e-01; +1.381708721301265e-01   +7.873202744663722e-01   +6.248707790697913e-01   +7.677413962106151e-01   +7.294818715021434e-01   +5.109722261742701e-01   +4.753883641756023e-01   +2.497955537948818e-01   +7.161670080971215e-01   +1.113051311372015e-02   +1.085520479711586e-01   +3.049380032465978e-02; +1.381121840696489e-01   +5.115475058060474e-01   +3.883844962134789e-01   +4.259961751469900e-01   +4.890644382847859e-01   +7.927237719824591e-02   +2.102247062511534e-01   +2.576227401205963e-01   +1.369753041301767e-01   +3.442039571809766e-01   +4.149079814464682e-01   +6.004130916202026e-01; +4.967595084384710e-01   +6.445448736381700e-01   +8.749295486385687e-02   +5.589162164920117e-01   +3.189101813245203e-01   +2.905659446225070e-01   +2.807171120507783e-01   +5.885046115302367e-01   +5.552619480965497e-01   +5.580594729028258e-01   +5.328429577229333e-01   +5.935722391495667e-01; +2.607054759101610e-01   +1.959904746039019e-01   +2.194669119490534e-01   +6.459741624905255e-01   +6.887757636625383e-01   +3.948260801184677e-01   +6.359684658240270e-01   +7.014431034346558e-01   +7.628899830588127e-01   +5.918482332888739e-01   +6.130732463237847e-01   +3.303443490461093e-01];
L2E_L3E_iAMPA_netcon = [+3.916741741372204e-01   +6.221706571315955e-01   +1.812813956608994e-01   +7.371238399458307e-01   +6.057653724993068e-01   +1.119334028055340e-01   +6.866990561026893e-01   +4.474355248474253e-01; +2.961260011968757e-01   +7.359554444810521e-01   +1.552308154724466e-01   +2.824052745152049e-01   +6.025647149126220e-01   +9.551591327524102e-02   +1.998063722645582e-01   +5.240985077874627e-01; +7.315055189833906e-01   +2.367969322047220e-01   +5.872770913398435e-01   +1.511560726338501e-01   +7.248633487991251e-01   +3.290166058829729e-02   +4.332812407528898e-01   +1.774428432071327e-01; +2.373829214229755e-01   +5.613482807892957e-01   +8.797249246794055e-02   +7.847743736791437e-01   +3.270629033946452e-01   +1.247963671609683e-01   +5.283074194111402e-01   +5.939603536628132e-01; +2.039754007643781e-01   +2.979023692011986e-01   +2.222847084844825e-01   +4.679641802926446e-01   +5.231754563383069e-01   +6.408348241188446e-01   +3.821877357177348e-01   +7.233281667275472e-01; +6.552219335569847e-01   +7.660808410515046e-01   +4.582127730747407e-01   +5.348091941924882e-01   +2.077624086528610e-01   +2.979648599531102e-01   +5.508215596959287e-01   +3.297479363494143e-01; +8.037578144093549e-01   +3.782324516719588e-01   +9.574070281424107e-02   +2.625121401564127e-01   +4.436028870683209e-01   +7.669433038484350e-01   +1.410248107188855e-01   +7.708420119099300e-01; +6.733109337538450e-02   +2.198579403985184e-02   +7.158650890178458e-01   +1.999298293545611e-02   +4.531512865504115e-01   +6.621024723154724e-01   +7.863427299005272e-01   +4.034894929570805e-01; +4.177664831500243e-01   +7.701315244630984e-01   +2.662773448616998e-01   +2.196459869612837e-01   +4.997621227375694e-01   +1.087892698290644e-01   +2.676799333238798e-01   +7.133443842075857e-01; +1.859226616318840e-01   +6.986323193208119e-01   +5.007553648458715e-02   +1.184067327337766e-01   +3.384896342506506e-01   +4.817439544986012e-02   +4.848442706474287e-01   +2.279036015578782e-01; +4.185166515864326e-01   +1.707058842197798e-01   +6.911501824601369e-01   +4.474954655325194e-01   +4.673609834360238e-01   +3.157923614292179e-01   +2.020719166944362e-01   +5.990823861807087e-01; +2.424331031948531e-01   +2.789602987800043e-01   +2.182595511151051e-01   +7.058215714148554e-01   +3.436258061515466e-01   +5.177688008300983e-03   +1.127689947770713e-01   +1.864310364771382e-01];
L2I_L3I_iGABA_netcon = [+1.160209578679234e-01   +5.004216296946088e-01   +5.891696689793524e-01   +5.007703460631053e-01   +1.077309797404682e-01   +2.422103681407304e-01   +3.832929403820256e-01   +1.750554156277289e-01; +6.831470420159506e-01   +1.775389362471565e-02   +5.316184869190232e-01   +6.756382278012653e-01   +6.735042609325329e-01   +7.281811462747426e-01   +4.762268807498655e-01   +7.798190026316068e-01; +6.348585862206698e-01   +4.985986460745390e-01   +5.510855907501683e-01   +4.714159890545374e-01   +3.371396117299553e-02   +1.089976596680671e-01   +3.864037635954736e-01   +6.015073093882036e-01; +1.414476026246927e-01   +3.974565497731988e-01   +4.638867215862262e-02   +3.613268179608151e-01   +3.527683201536329e-01   +8.106721221213455e-03   +7.470061315671852e-01   +7.820179621598473e-01; +6.733830452977830e-01   +7.639693862348832e-01   +2.591712533712067e-01   +3.106636061980442e-01   +2.235606627581540e-01   +4.311459118418728e-01   +7.754687152287773e-01   +7.322879797538003e-01; +3.956009878863712e-01   +3.307262398746623e-01   +5.437499669978639e-01   +7.122855597440670e-01   +7.846277911210644e-01   +6.169710265930559e-01   +5.631903273096395e-01   +6.448222123950893e-01; +5.647375986582941e-01   +3.371697588244428e-01   +2.419330175533428e-01   +1.245245584788049e-01   +7.877122818263094e-01   +5.735621155752135e-01   +5.341804781361216e-01   +3.693443848254189e-01; +3.862259524503400e-01   +4.466678175755270e-01   +5.622152007033294e-01   +5.032643867745606e-01   +2.255718168028957e-01   +4.968683322004683e-01   +3.763803467486788e-01   +5.399167530910138e-01; +9.167591075695360e-02   +3.636599492105886e-01   +4.592210850864382e-01   +4.183789699089053e-01   +1.965950405480077e-01   +3.799871665567296e-01   +1.738225850356447e-01   +4.776125186358002e-01; +6.780787646055302e-01   +2.818010336360012e-01   +5.204241565694970e-03   +9.299745143585414e-03   +4.860147770703259e-01   +7.366338643297203e-01   +6.291718825217606e-01   +5.968417964996845e-01; +6.473259268837329e-01   +7.380594192470605e-02   +5.085240108152808e-01   +6.492164387093210e-01   +7.992404295279116e-01   +6.292232897800631e-02   +3.384873024697649e-01   +5.557152619541202e-01; +5.300473702088798e-01   +8.971383094175370e-02   +3.348183390743979e-01   +1.228585833442757e-01   +3.928218273232397e-01   +6.867892869548865e-01   +2.655094074024655e-01   +3.824091738625343e-01];
L3I_L3E_iAMPA_netcon = [+5.951173669835735e-02   +6.685415103103770e-01   +6.291579090506946e-01   +5.089151933251639e-01   +2.353536598681028e-01   +4.854389432273159e-01   +6.936583834188606e-02   +8.374306389429979e-02   +2.957067227820288e-01   +2.271072706099914e-01   +2.728774136247193e-01   +5.720513493281502e-01; +3.846470280190542e-01   +4.417004225380013e-01   +2.291042791057075e-01   +6.725274995567000e-01   +4.552065580783680e-01   +6.234802716516803e-01   +1.267484064758688e-02   +3.579595737972683e-01   +3.351607382076598e-01   +3.688481367901114e-01   +1.103940736972580e-01   +5.914571239632802e-01; +6.279765385532534e-01   +3.385795486571453e-01   +7.321896746904949e-01   +1.411227156938468e-01   +5.040915002066666e-01   +6.515774333934886e-01   +4.964203928684475e-01   +3.583049933725002e-01   +2.242324596406600e-01   +2.357901307455766e-02   +3.033299791292630e-01   +7.613780410514719e-01; +3.815002435647275e-01   +7.831525240844494e-01   +6.205195829321662e-01   +3.022285253549861e-01   +2.346227568440142e-01   +1.921256149558891e-01   +5.736383487402791e-01   +3.857540299261761e-01   +1.829931976857730e-01   +1.043907368312144e-01   +6.966547989242601e-01   +1.652251016799399e-01; +7.857812417585517e-01   +6.598154193569524e-01   +6.209013305399638e-01   +2.879985377676774e-01   +3.333881753626199e-01   +7.442440811482773e-01   +5.026960826219271e-01   +5.037823550645188e-01   +5.692962410421210e-01   +1.931327869984267e-01   +5.376787932200369e-01   +6.681107986790396e-01; +4.453322286681373e-03   +5.473226194278068e-01   +4.399912490970920e-01   +4.426521494219714e-01   +1.942596944757397e-01   +3.864589590732943e-02   +6.518616815932504e-01   +3.903926547277661e-01   +7.714361883652665e-01   +5.817113957642747e-01   +1.119668232128907e-01   +1.892455028189793e-01; +1.877317794852924e-01   +5.434588428618704e-01   +4.386528694409582e-01   +6.400627467491691e-01   +1.581648627374482e-01   +3.891215814867311e-02   +2.678303010179234e-01   +7.189514163800594e-01   +2.240748165693562e-01   +4.342774218382204e-01   +3.205682668249556e-01   +2.186688546762017e-01; +2.256054264091577e-01   +5.007783615075438e-01   +4.034753535622285e-01   +4.456212774052864e-01   +7.429371785840884e-01   +3.269773182018014e-01   +4.635025062612967e-01   +7.104589999359974e-01   +7.369828741777442e-01   +5.654871293895098e-01   +1.389891335848107e-01   +2.639240105825164e-01; +7.550811708261670e-01   +3.038992935589027e-01   +4.017439477780207e-01   +7.481818161887339e-01   +4.399142937112736e-01   +1.561825370203755e-01   +3.988056389287216e-01   +7.331934897855262e-01   +1.531476184081663e-01   +7.814537666589774e-01   +5.701078672889914e-01   +2.686125169482917e-01; +7.914386418279261e-01   +1.478009288593140e-01   +5.053682661685469e-01   +2.142474380695077e-01   +2.882579127802013e-01   +6.298705681488919e-01   +6.870927936924527e-01   +3.170949135466187e-01   +3.965376750396690e-01   +3.375561105566532e-01   +6.515267867859525e-01   +4.694094450450174e-01; +2.527236106442929e-01   +7.442295258057710e-01   +7.304761684232627e-01   +1.432807701077601e-01   +5.866035769659701e-02   +2.969192139797135e-01   +2.709176709333205e-01   +7.925665773034449e-01   +4.730436080698392e-02   +1.151315917674404e-01   +6.754672723465428e-01   +6.384095084646171e-01; +7.017543308286400e-01   +2.116213573290144e-02   +5.728473706069113e-01   +2.288618670766263e-01   +3.709490956694927e-02   +3.701873584494764e-01   +2.752409694704911e-01   +7.723728794455605e-01   +7.939975411871223e-01   +2.660877218225527e-01   +2.987650786641648e-01   +2.492368806089207e-01];
L3E_L3I_iGABA_netcon = [+1.092557522851741e-01   +6.541322127541814e-01   +7.953371004843431e-01   +5.559133445684667e-01   +4.274740080987627e-01   +1.201834870906226e-01   +3.171081792524540e-01   +6.521033577281192e-01   +6.928534885075954e-01   +2.167010217544719e-01   +1.869381386006497e-02   +3.095880854383218e-01; +7.435158867704863e-01   +4.977849840976615e-01   +8.688447509171034e-02   +6.593177221854674e-01   +1.232426908993288e-01   +1.155214900767431e-01   +3.771149717454139e-02   +2.590361772838775e-01   +7.881507162299872e-01   +1.194918296176591e-01   +2.426447332132774e-02   +2.752408028515895e-01; +1.668762409855210e-01   +2.858688364035594e-01   +6.079987277946860e-01   +5.901024926987479e-01   +3.704655699964287e-01   +2.616508727764341e-01   +3.170164755636580e-01   +1.730647370821074e-01   +2.580149044345682e-01   +5.517034943647101e-01   +4.025985804547660e-01   +6.810771493266059e-01; +3.998187279233599e-01   +5.676100757846007e-01   +3.067206747524088e-01   +1.229802730196172e-01   +3.898281748937131e-01   +6.485055218729213e-01   +1.430977182513739e-01   +1.604658846293092e-01   +6.935041286449457e-01   +1.202490184840842e-01   +1.063062596136748e-01   +4.326565146953644e-01; +5.020443273838809e-01   +3.852820418771485e-01   +5.131577963411248e-01   +6.123819919216428e-01   +6.107860585990135e-01   +7.086613090248125e-01   +4.184040922685720e-02   +2.555759159244162e-01   +4.488954955166991e-01   +3.563097030409361e-01   +5.873007848832934e-01   +6.534347320699740e-01; +6.721174121010082e-01   +5.145465923166517e-01   +5.995987880908509e-01   +2.665375286916802e-01   +1.976749347856104e-01   +1.582429769970335e-02   +3.330138753248174e-02   +1.891728418539285e-01   +9.897722082222843e-02   +3.124358793131780e-01   +3.450744732982110e-02   +3.119332045992017e-01; +2.400767604934991e-01   +6.003165613259639e-01   +2.033727697907186e-01   +2.579664518375581e-01   +1.254413078156637e-01   +2.436355912236393e-01   +7.708510257040820e-01   +1.432662097272505e-01   +5.662226073851961e-01   +7.836650554127157e-01   +1.173710885405026e-01   +4.353008262117170e-01; +5.354828065465818e-01   +3.466796076988081e-01   +7.940198661301858e-01   +1.387022197296062e-01   +3.494571356458276e-02   +8.167465732694966e-02   +4.657456297536336e-01   +2.068400432551580e-01   +2.389468648154917e-01   +5.507549830265678e-02   +3.045800000021650e-01   +7.011911392579493e-01; +7.844100574483830e-01   +1.417070060830382e-01   +5.705091412892390e-02   +7.138625240034961e-01   +1.981765261462095e-01   +6.609684116056435e-01   +1.300304611594609e-01   +3.859215837769834e-01   +4.323512965342388e-01   +3.332462115766351e-01   +7.141615418618227e-01   +4.300334270446790e-01; +7.463426545107640e-01   +6.627395027655619e-03   +3.922967691831808e-01   +1.361073901522279e-01   +2.519194254401599e-01   +1.169247026933684e-02   -2.164345720439839e-03   +2.105978651404906e-01   +2.129482059973887e-01   +3.052743958056301e-01   +2.533624928026119e-01   +3.941907918889033e-01; +3.817613212163538e-01   +3.095084608799330e-01   +2.347556987175069e-01   +2.012194163828636e-01   +7.212613432107665e-01   +3.749794187979844e-01   +3.468640545956490e-01   +8.546198335251295e-02   +4.017572182529736e-01   +3.852360771112378e-01   +1.725146328011881e-01   +5.199385228423729e-01; +5.539643829896532e-01   +2.996112475643806e-01   +4.005795145332791e-01   +6.207140873135178e-01   +7.061888397146947e-01   +4.660222424641461e-01   +5.241696219702234e-01   +7.576021084978836e-01   +8.165268836451196e-02   +2.541937326669998e-02   +4.133628601124596e-01   +2.053662099937263e-01];
L2E_Input1_iAMPA_netcon = [+6.382267465418742e-02   +3.904318426825162e-01   +9.132647940248624e-03   +5.342749285760068e-01   +7.584088776490300e-02   +6.768387642285877e-01   +1.950625811143023e-01   +3.854284553180781e-02];
L2I_Input2_iAMPA_netcon = [+2.922371155869742e-01   +7.433841469681928e-01   +2.812152827165643e-01   +6.486222300171042e-01   +3.579125166603143e-01   +3.083508389865120e-01   +2.578396866671963e-01   +1.782576931928076e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  5.6 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
