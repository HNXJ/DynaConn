function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.669392110012483e-01   +5.785152952859180e-02   +3.429295200915042e-01   +5.344424394204604e-01   +1.188207051881721e-01   +3.595124275413034e-01   +2.163682588943400e-01   +7.055394346596940e-01   -1.121967521190503e-01   -7.156192168404641e-01   +1.449509098295050e-01   +5.250366537376677e-01   +1.414792083090570e-01   -2.617987886053555e-01   -1.177960433102344e-01   -3.145500886896567e-01; -3.206068416724769e-01   +5.500972958661609e-01   +7.596649337038663e-02   +3.582292407542593e-01   -3.964323784603750e-01   -2.606806625556574e-01   -8.166839124624778e-01   +3.228232370751437e-02   +1.906464831160594e-01   -1.639143348069669e-01   +1.183058835165101e-01   -3.159006443789499e-01   +3.179720361719708e-02   -2.694192875627450e-01   -4.527573705354608e-01   -5.397932611992280e-01; +1.579017103021162e-01   -3.494060773915948e-01   -4.948260113770387e-01   -6.498977308444923e-02   +9.738957482765841e-03   +2.360690325813423e-01   +3.419851243922695e-01   -5.311532686555201e-01   -3.373771018410820e-02   -6.814507428397705e-01   -4.488351606883508e-01   -1.143845236171466e-01   +7.131211515506189e-01   -1.960428611144133e-01   +1.488662403434146e-02   -3.857453430466924e-01; +7.728574186663643e-02   -1.087272683340413e-01   +6.753329506075177e-02   +2.512313673636520e-01   +3.176730850289116e-01   +7.456286594430630e-01   +8.375419699477435e-02   +1.406717443804221e-01   -4.619603923975698e-01   +2.094365383294314e-01   -8.370057144648166e-01   -4.166495944153176e-01   +1.193138218888881e-01   -2.896286822314574e-02   +4.762251797734055e-02   -5.369251458751430e-01; +5.018464862450566e-02   +1.091905376852288e-01   -6.096091534962584e-02   +4.291748203809246e-01   -3.088444160815850e-01   +1.694124251077913e-02   +2.363689403978289e-01   -3.074514136477979e-01   +2.325896746204992e-02   -1.524200209883760e-01   +1.651766973551851e-01   -2.355876814389333e-02   +1.790663906074407e-01   -2.120273263678598e-01   -4.213814978817166e-02   +2.051296160086637e-01; +3.903525600932625e-01   -3.436395711377896e-01   +1.000000000000000e+00   +2.086857375815565e-02   +6.808966179104272e-01   +9.509944924565675e-02   -1.455853004112154e-01   -3.701981244998379e-01   -1.725962230456118e-01   +1.666295137410090e-01   +2.836630523204854e-02   -3.615099522408042e-01   +3.079433792878969e-01   +2.199334654700911e-01   -1.601268433548986e-01   +5.974065096668751e-02; -4.585449991026986e-01   +4.427443289455724e-01   -1.141882541676720e-01   +5.566322102498370e-01   -1.800767712064022e-02   -1.596595781566052e-01   -9.875721691503059e-02   +2.425790899115149e-01   +1.758521218092867e-01   -7.965604755411311e-01   -4.639575455065339e-02   -2.342481007193179e-01   +6.516874032696916e-02   +3.307178110665088e-01   -8.654907238903544e-03   -3.825178038685110e-01; +2.204136302990474e-01   -3.576245687618423e-01   +6.010881712604148e-01   +5.600146707648608e-01   -5.784848499383297e-01   +4.461471434471926e-01   +1.815802472884842e-01   -6.449466064653052e-01   -3.252067488321627e-01   -1.052910024794255e-01   +1.405808406474469e-01   +1.303263517046059e-01   -4.912731048293594e-02   -2.422860361003326e-02   -5.343055852382527e-01   -6.395594101531969e-01; +1.338405013972774e-01   -6.829123419740430e-01   +1.471430231654071e-01   -3.985628893151056e-01   -3.448850911645204e-01   +1.683160667325451e-01   +2.155875204607764e-02   -4.463140037800916e-01   +2.244107108443676e-01   +1.359764428335871e-01   -4.178993885347502e-01   +5.358664158725654e-02   -1.023032765948028e-01   +3.166321579966414e-01   -2.598983156833186e-01   +7.697505469161937e-01; +8.774145988729841e-02   +1.773975196878735e-01   +4.584027080060807e-01   -3.665286992041915e-01   +8.115351617580857e-02   +1.937025362639890e-01   -1.605686743699906e-02   +1.056506424961735e-01   +4.576801179694227e-01   -2.602804169581339e-01   +3.178187027165119e-01   -1.669020792463025e-01   -4.848293775862952e-01   +2.758516868635029e-01   -3.508412198473873e-01   +1.753319441011027e-01; -1.818447435966246e-01   -1.371064883978965e-01   -7.149872068776109e-01   +2.753278791003110e-01   -2.040552547403520e-01   -2.297151175663866e-01   -1.758703226784427e-01   +1.981489070347757e-01   +1.668866352844347e-01   -2.599035502244534e-01   -2.017472585494854e-01   +5.243697123428783e-01   -2.071082606190929e-01   +2.393913417867931e-01   +2.009558004799912e-01   +9.706126591758786e-02; +6.054905594367234e-02   -2.269948072699240e-01   +5.604518118800346e-01   +2.867629554055129e-01   -2.160298745432617e-01   +7.208334983015209e-01   +4.512882551919177e-01   +5.688225378461823e-01   +7.101467286406520e-02   -3.672925243295235e-01   -2.079149063956492e-01   +6.491465706805659e-01   +5.277767828062787e-01   -9.769395000401962e-02   -3.425473755579119e-01   +5.369436623440202e-01; +1.432054981233025e-01   -2.313142501535071e-01   -1.791663215964044e-01   +7.321596271796077e-02   -1.836598984573761e-01   +6.070193872981506e-01   -3.157588065605843e-01   +2.731746720778122e-02   -4.196433483904870e-01   +7.633668019607584e-02   +3.880119478327080e-01   -4.149274227597422e-01   +1.301962407356586e-01   +6.459492799946949e-01   -7.524322477200407e-04   +4.225488673647313e-01; -2.773572973494658e-01   +5.571803924696528e-01   -1.115157991500242e-01   -8.495969790186683e-02   -8.012958182356671e-01   -8.292532840661518e-02   +2.877623299970927e-01   -2.177532852564237e-01   -1.071401746418430e-01   -4.953167428735718e-01   -2.498287728460692e-01   -3.740914294567168e-02   -2.528992241788322e-01   +5.270948357431050e-01   +1.490446011225526e-01   +2.467639053749070e-01; +1.113114845962906e-01   -2.592619579870542e-01   +2.611965923596290e-01   +6.433637545416020e-01   +1.126256736122830e-02   -3.416158663344219e-01   -9.644932955336696e-02   +2.094404648669790e-01   -7.549773368626940e-01   +2.782078644227122e-01   +1.920234709551092e-01   -2.090044396463544e-01   +4.823745238128554e-01   -6.481683223760810e-02   -3.776360234810200e-01   -2.863539717751360e-01; +1.162317618359020e-01   -9.235422065329278e-02   -4.415518673612733e-01   -2.241330798529736e-01   -1.976829794782675e-02   -1.954686890171226e-02   -2.118082047039864e-01   +5.324198135263407e-01   -3.587107225583602e-01   -3.483189906633778e-02   -1.869659489040104e-01   -2.489562152771503e-01   +4.464158522847909e-01   -3.970559231938771e-01   +1.348732676474503e-01   +3.860459620467876e-02];
L1E_L1I_iGABA_netcon = [+7.121122139039580e-01   +2.638361694820299e-02   +2.684848552090791e-01   +9.859082897260628e-02   -2.929208478370243e-01   -1.775566345077345e-01   +6.567275576821939e-02   +4.016344860606775e-01   -2.454908862433672e-02   -2.571801265595918e-01   -2.895010550524127e-01   +8.790719676070410e-01   +4.600200479996363e-01   +4.551200503692471e-02   +4.859592859139032e-01   -1.088737651244013e-01; +9.252908589439442e-02   +6.186563099147430e-01   -2.405415506698607e-01   +2.107055116810873e-01   +4.896573748408307e-01   -7.844829167836025e-01   +1.466597700662616e-01   +3.791517695819452e-01   -2.253570630299449e-01   +4.886016100274975e-01   -6.269048102873915e-01   +8.453075151335651e-01   -5.877340853519182e-01   +4.190351520577126e-01   +3.235568304773447e-01   -3.645419446318187e-01; +8.100212462341432e-01   -5.022889542474753e-01   +3.756650278808589e-01   -6.081330369269632e-01   +3.406360037021678e-01   +1.043610162261793e-01   -4.265261375564411e-01   -4.390712875498035e-01   +7.674645104791558e-01   -1.384229711922302e-01   -7.438694576766123e-01   +4.937906794491557e-01   +5.265207532994574e-01   -2.542531063519058e-01   -7.718760810419448e-03   -4.538594036479041e-01; -2.930759693994285e-01   +2.506363397067394e-02   +4.554054811817068e-03   -5.070179774955028e-01   -3.320635726662270e-01   +5.148273904747948e-01   -6.960943052666660e-02   -4.149266340573426e-01   -7.511275048898083e-02   +4.190781686277811e-01   -1.026516776542680e-01   +3.709876076768363e-01   -3.006298632009174e-03   -3.187763209970403e-02   +3.158470602700409e-02   +9.100906736416024e-02; -2.166512591781416e-01   -5.014872209241931e-01   -2.848163141257548e-01   +3.205114900533570e-01   +2.078546552916038e-01   +4.123069823321577e-01   +6.069899091012371e-02   -6.091010148272711e-01   -3.832376177982078e-01   -2.817065337609874e-01   +5.827756354571327e-02   -5.085723222055543e-01   +5.010552072785437e-01   -5.147449227120102e-01   -6.268019257623120e-02   -3.264641838602758e-01; +4.854113776079424e-01   +4.916122046549513e-01   -1.029966321140559e-01   +4.257229742950237e-01   -5.520505115973933e-01   +2.112738200909705e-01   +5.828688207071729e-01   -1.639722917767116e-02   +5.326705363253045e-01   +1.393787976300870e-02   +3.046865883587655e-02   +3.981194162447848e-01   -4.278288581364680e-01   +1.820287952045933e-01   -5.730662177770648e-01   +1.470795210447936e-01; +4.599856195145633e-01   +2.559521080061919e-01   -3.141771238387424e-01   -1.842736694593212e-01   -1.647519981587295e-01   -2.645535292616282e-01   +2.136974772645621e-01   +1.005140399074323e-01   -5.957953411701895e-03   +2.567584809097011e-01   +1.000000000000000e+00   -8.364873490112323e-01   -1.187963199459335e-02   +6.415997153921320e-01   -8.128410821456379e-01   -9.452572471405229e-02; +2.698199455387153e-01   -1.759884882069713e-01   -3.386389626023530e-01   +5.045935856473601e-01   -5.128059083989431e-01   +1.090331061004317e-01   +2.970203885928782e-01   +1.003385138866710e-01   +4.800312790765117e-01   -1.400052918732680e-01   -4.652897498308349e-01   +3.319368614413135e-01   +3.402588334498619e-01   +1.432833709589035e-01   +6.646426182898290e-01   -4.913083390196938e-01; +4.688931475218339e-01   +7.966400152809319e-01   +7.604773343805203e-01   -5.854837330109283e-02   -6.277060722628251e-02   -3.584531687420462e-01   -2.861243225570291e-01   +2.206933300209304e-01   -1.256295919976803e-01   +2.962383306633017e-02   +2.287596362449415e-01   +4.724941982995812e-01   +3.042583958665260e-01   +2.479313012739643e-01   +3.601580555509330e-01   +6.081177537277815e-02; -3.959440992871083e-02   +2.288386887914383e-01   +6.666893849399748e-01   +7.845616058927007e-01   +7.488968446359257e-02   -1.268939134667753e-02   +3.986135743279748e-01   +1.861278927795434e-01   +3.103464272918282e-01   +6.625097815907331e-01   -5.076508676556700e-01   -4.400700150381586e-02   -4.783992591638330e-01   +3.582999456302992e-01   +3.336245315149102e-01   -2.186973213750917e-01; +6.703779006436792e-01   +2.172004820836207e-01   +2.117223615208201e-01   +4.875899798474592e-01   -1.369007718916558e-01   -3.401521324991192e-01   -1.369175404854445e-01   +6.502658846260087e-02   -5.673085153845931e-02   -2.411087023970862e-01   +3.600250335896575e-01   +1.015825045640604e-01   +1.423378493230933e-02   -4.079254612660336e-01   -2.231023104733338e-01   +7.956833828491455e-02; +9.434321531635023e-02   -9.817535003705910e-02   +4.938924719451857e-02   +4.180128385563254e-01   +4.168221724440022e-01   -6.056549188002391e-01   -5.961467081567078e-01   -3.015377855392189e-01   -1.036044280078782e-01   +5.190173747308957e-02   +4.732592114202075e-01   -5.073293009568322e-01   -9.422981727995181e-02   +2.378248936136631e-02   +3.482485359972417e-01   -2.008146409060806e-01; -2.551832754067586e-01   +2.144615270723543e-01   +4.316347968815256e-01   +1.594553092064196e-01   -1.003698377058626e-01   -4.621269103852378e-01   +4.281095926733808e-02   +8.291385257268107e-02   +6.711850811087537e-01   -2.905898979238259e-01   +1.004115694230412e-01   -3.286428837068085e-01   -6.463070815842649e-01   +2.693230259911149e-02   -1.111578042332870e-01   -2.585149908251270e-01; +3.084898762697748e-01   -1.144412884588003e-01   +2.095233554602039e-01   -4.036829982881002e-01   +1.617673958842832e-01   +2.768563032417823e-01   -5.540126753290324e-01   +3.167567235870584e-03   +2.815338060961584e-01   -3.847975430506376e-01   +4.045730319065693e-01   -5.265609781493805e-01   +2.090072499590013e-01   -1.813898226210373e-01   +9.221383655130083e-02   -1.755925352118879e-01; +1.593716363237708e-01   +7.799928968614420e-01   +4.602877003683738e-01   -4.039078256529549e-01   -5.850607777643589e-01   +1.601209632889768e-02   +1.806366741659228e-01   +5.299587717954066e-02   +5.397565978421296e-02   +4.601182074352975e-02   +4.505709834030229e-01   +9.784489408577397e-02   +1.589838125630767e-01   -1.227862726241851e-01   +4.316116947632060e-01   -1.522555865578059e-01; +4.131239678953239e-01   -3.302210162897707e-01   -6.180698274553588e-01   +7.559461904702236e-01   -1.369659396471341e-01   +5.749233839204150e-01   +9.371664036899220e-01   -5.900977925794006e-02   -2.774105037885056e-01   -2.802700092109147e-01   +4.306279971892586e-02   -1.956764033810588e-01   -1.637405192553819e-01   -2.991866413410367e-01   -3.520122283505429e-01   +1.712479616723775e-02];
L2I_L1I_iGABA_netcon = [+2.562725937275168e-01   -7.832342697620521e-01   -3.318598447425817e-01   +1.931017470501305e-01   -1.325920338337762e-01   +2.088043923247518e-02   +4.079901592647609e-01   -2.232403048926289e-01; -4.283302644053286e-01   +6.458211635376261e-01   +3.377475825552769e-01   +1.529463025035513e-01   +2.420816691409613e-01   -3.314272073271802e-01   +4.834595698772540e-01   -1.363346967757181e-01; +4.163606041764608e-01   +1.988399410187984e-01   +2.774957715478762e-01   -4.369981200051474e-01   +7.879296191299218e-02   -5.014235908660873e-01   +3.927101443714426e-01   -2.166657072321773e-01; +5.364979954962416e-01   -2.296327922548547e-01   -4.461771768735528e-01   +4.256270404012186e-01   +7.806578771689837e-01   +2.564806060218074e-01   -3.283142088569143e-01   +5.312549335647444e-01; -2.238511184145592e-01   -3.471408195579724e-01   -1.292286887514417e-01   -5.716854237613935e-01   +3.457318460448444e-02   +8.689449287189710e-02   -2.810558593772865e-02   +5.450922067224891e-01; +1.251307583724549e-01   -3.462397376350274e-01   -1.572484123724419e-01   +7.288346812186737e-01   -3.404128737770425e-01   -1.831965732593497e-01   -2.384562552727580e-01   -6.100549251965385e-01; +3.027307695538319e-01   -2.459892909264442e-01   +3.257152141208338e-01   +7.402913703780521e-01   -7.181638250284944e-01   +4.244116348483519e-01   -3.275361519512473e-02   -3.369527805052721e-01; -3.732268648624011e-01   -6.107740986960494e-01   +8.764244716387110e-02   +4.010024390210130e-01   +2.706383215243523e-01   -6.663381726186818e-01   +3.540297077485283e-02   +6.508242179498132e-01; -1.493846690577417e-01   -2.670930466983240e-03   -2.104156219551002e-01   -3.052485084128633e-01   -4.241685159180216e-01   -2.286276195511588e-01   -2.537672663301647e-01   +5.156692733138992e-01; -4.245373537403982e-01   -5.177100580448804e-01   +5.967982205880026e-02   -3.459414376643853e-01   -4.175868273071333e-01   -9.798267755281878e-01   +5.661944946615824e-01   +6.619916474021958e-01; +6.397693361898310e-01   -6.563737904064652e-02   -2.139218128896039e-01   +1.091659961988613e-01   -3.369437776630543e-01   -3.571806264651841e-01   +3.148537273523112e-01   -1.030586199239269e-01; -8.031001485909614e-02   -1.837533997479366e-01   +3.947823904521096e-01   -5.445145352137643e-02   -9.116248603920282e-02   -2.806762384615991e-01   -7.557058844146264e-02   -2.005572335777150e-01; +2.545378247809066e-02   +2.128664921186249e-01   +7.289689986270914e-02   -5.311692603499116e-01   -1.008904478403473e-01   -4.021747299950227e-01   -2.735901136190170e-01   +3.331822447593252e-01; -9.550224913269621e-02   +2.778292332100885e-01   +7.653856739909734e-02   +5.383887596673468e-01   -1.915372409423935e-01   +1.143554702092812e-01   -6.852393226870162e-01   +3.488601478500106e-01; -1.057201571988179e-01   +2.792825825234330e-01   -8.428850166325784e-02   +2.431069666243629e-01   +1.436017095708856e-01   +1.000000000000000e+00   +7.139283231019463e-01   +6.413784723251460e-01; -3.279794093278370e-01   +1.244384464772106e-01   +1.680964591978598e-04   +1.229432902078498e-01   -4.734279720407334e-01   +1.464406847171174e-01   -1.920514422627073e-01   +1.346342705922065e-01];
L1I_L2I_iGABA_netcon = [+2.485428680852315e-01   +3.046836790263167e-01   +5.484230046879172e-01   -3.561511111011433e-01   +8.723482557150863e-02   -3.078829578181814e-01   -5.475977009678257e-01   -1.176532455373120e-01   -1.409335810658365e-01   -1.000000000000000e+00   +5.109809591069382e-01   +1.753298659607427e-01   -2.173450479151554e-01   -4.538068439581333e-01   -3.117147555255683e-01   -4.597314056102551e-01; +3.848158777008742e-02   +4.155882159212265e-03   +1.967158435748172e-01   +2.141686947994667e-01   -4.687264739904930e-01   +9.843394754434127e-02   +7.500635508258489e-01   +3.581838616879731e-01   +2.016788695034306e-01   -8.673161012294510e-02   +3.232819319193643e-01   -6.142167113199392e-01   -6.346162908944454e-01   +3.811120510454565e-01   +3.125588680405846e-01   -1.578872674256297e-02; +2.334660645822282e-01   -2.571564100286867e-01   +1.940856641659567e-01   +6.060846991726444e-01   -1.360627857389052e-02   +2.468488064547661e-01   -4.870933977833596e-01   -3.480490088207533e-01   -2.133466324994188e-01   -5.447957281489254e-01   +7.705458979115952e-02   +6.450239204180883e-03   -9.395522149832556e-01   +4.294863539497665e-01   +8.076163800257267e-01   +1.393969034369913e-01; +6.780389666491288e-01   -8.998858858894045e-01   +4.463816721106670e-01   -6.674933647175078e-01   +5.281771619809712e-01   +3.029911432107748e-01   +4.880109414817079e-01   -2.949390052930089e-01   +5.235880114425582e-01   +2.444192087211211e-01   -3.908725894353796e-01   +3.770275910463307e-01   -6.904502271625345e-01   +1.000640921374959e-01   +1.458919621666292e-01   +8.943293896262590e-01; -1.146150784074347e-01   -1.613602271662155e-01   -2.275438378135171e-01   +2.740029139211397e-01   -5.610522439396669e-01   +4.667674160602851e-01   +4.651334873581254e-01   +4.797361620388431e-01   +3.550064583696483e-01   -9.169847787574790e-01   +4.021095153218261e-01   +8.208181788786750e-01   -4.399453525509911e-01   +4.731802342273669e-01   -1.948936967221339e-01   -5.371994509419765e-01; -5.347537475000312e-01   +1.992563578190563e-02   -2.102906998679236e-01   +1.940496363970051e-01   +1.442669523495199e-01   -5.480453750309217e-01   +2.538721484660916e-01   -5.690291317783085e-01   -4.768739837409197e-01   -5.707560999608230e-01   -9.734316139097961e-02   -3.215319764747558e-01   -4.207289288551955e-01   -1.221491724531532e-01   -3.326619268401729e-01   -1.795009363751673e-01; -1.329643031728653e-02   -1.101079676103160e-03   -4.565924297239191e-01   +2.694608850321151e-01   +2.223671991051924e-01   +5.129691563644808e-01   +1.760015946635110e-01   -3.023880899269217e-02   +4.296760975070024e-01   -3.728894765641615e-01   -5.801179870689599e-01   -5.994413907783579e-01   -2.659004885155601e-01   -4.516077198163757e-01   -6.253726496661784e-02   +3.551603125109307e-01; -4.335259805932985e-01   +2.468297683899290e-01   -3.998263671918216e-01   +4.545914704756102e-01   -6.391176169660284e-01   +5.033093649890925e-01   +5.111124110199111e-01   +1.775997842781086e-01   +2.024602465312475e-01   +4.972516445278881e-01   +5.808608933517337e-02   -4.062703068579146e-01   +5.952298855864616e-01   +4.738564589794531e-01   +2.907760222980978e-01   +1.151149950536863e-01];
L2E_L1E_iAMPA_netcon = [+3.201512518084294e-01   +1.195014853178008e-01   -3.622632321911380e-02   -6.033756549044409e-01   +7.995741584430873e-01   +8.070100603219489e-01   +1.790299049442076e-01   +3.830661435283197e-02; +6.353534534295758e-01   +7.458111826520229e-02   -1.000000000000000e+00   -9.546397541949848e-02   +4.659132522454271e-01   +1.470820188130383e-01   +2.099636107379786e-01   -2.796446787671231e-01; +7.376299546409061e-02   -1.097141466644870e-01   +5.539809145156626e-02   -2.352441271919798e-01   -1.563786633461657e-01   -3.423746632117945e-01   +4.458640360142114e-01   -2.867178923749205e-01; -4.700570806150692e-01   +1.762994463201876e-01   -3.743768365585683e-01   -7.509596023297083e-01   +6.109873785035629e-02   -2.360998705387415e-02   -6.070367570068018e-01   +3.909454463271172e-02; -5.166191985337182e-01   -6.299135657748900e-02   +3.207997829329698e-02   -4.303693460768128e-01   -3.409509836977631e-01   -4.456018942274381e-01   +9.065650371770957e-02   -5.825502714391856e-01; -2.637541045438530e-01   -2.012356965898763e-01   -4.018763570298987e-01   -1.607785755125408e-01   +7.624212726726197e-01   -2.315495949861800e-01   -1.555720698069209e-01   +2.459921945634357e-01; +1.931492711685816e-01   +4.534216578352383e-02   +4.354497586248658e-01   +3.883597627535446e-02   -8.821870908616927e-01   +1.568242612206753e-03   -8.542432872587509e-02   -2.819815555070785e-01; +8.513556435173528e-02   -4.161373873477046e-01   -2.145953086113433e-01   +6.023427404759025e-01   -3.449891012514425e-01   -2.017515698555489e-02   +4.482126777291505e-01   +5.628944732881458e-02; -2.861397035225485e-01   +6.963609211290100e-01   +2.560648673918572e-02   +4.918401546676716e-01   -5.820457629379534e-01   -2.612350654215291e-02   +5.878019719079989e-01   +2.368398555920317e-01; -3.038752724438737e-01   -1.833857474696031e-01   +2.595283478061088e-01   -2.362758864696904e-01   +2.325955880475487e-01   +8.714396865866234e-02   +7.481770661033552e-01   -8.642826114808626e-01; -2.003501396836353e-01   -3.336459291759073e-01   -7.719157716439081e-01   +2.103700630859314e-01   -4.700843152313189e-02   +6.719040706117183e-02   +1.389578821436701e-01   +3.753720920398780e-02; -2.043216775106066e-01   -2.552137135468054e-01   -4.142740771856291e-01   -1.978147176457574e-01   -2.949183939739291e-01   +3.561862489187778e-01   -3.834214817867142e-02   -5.535238841458515e-01; +6.231759754961763e-01   +1.333503261471337e-01   +7.031003165511091e-01   -6.668913894364735e-01   +1.234090719139836e-01   +6.213179921207013e-01   +2.754784107462832e-01   -2.603188768543517e-01; -1.016370234850562e-01   +5.190621216092063e-01   -1.680386808326087e-01   -7.557230266549561e-01   -1.072188871858920e-01   -4.755822548229733e-01   +7.427766822323230e-01   -4.100344908417689e-01; +1.845515189563527e-01   -8.108017211335865e-01   -4.389276192211462e-01   +3.291195495180823e-01   +7.478079389137442e-01   -2.639386151623435e-02   +3.696811503533368e-01   -6.449870242299593e-01; -5.217485175654777e-01   +1.694425727551561e-01   -5.120420700284969e-02   +2.349881018058484e-01   +4.888503873759484e-01   -2.376936234412836e-02   -8.657279287589245e-02   -8.005569420299147e-02];
L1E_L2E_iAMPA_netcon = [-3.814702990776924e-01   +4.990600990131880e-02   -2.056614097183046e-01   +2.191748109128983e-01   -1.794402674539342e-01   +1.882065512498797e-01   -3.227364856890967e-03   -3.982111513106310e-02   +5.772912381604343e-01   +9.482845713237524e-02   -6.733137543313089e-02   +7.562850240806688e-01   +2.673418112071220e-01   -2.784719289395108e-01   -7.343518758906865e-01   +5.541969541290457e-01; +1.166475085969426e-01   -3.380014378441000e-02   -3.632281703392266e-01   +1.057223144237815e-01   +2.488866264586411e-01   -6.037302092113814e-01   -1.077761878035381e-01   -5.515059664002899e-01   -2.601330646336797e-02   +8.527048772091865e-02   +4.130386168409564e-01   +4.543540539463609e-02   +4.133117244414160e-01   +1.788571023403815e-01   -1.510978942505242e-01   -8.093092891806840e-01; -5.000731029899460e-01   -5.167456148117660e-03   +7.065198700777996e-02   -7.415915570049590e-02   -4.954054279664440e-01   +3.345001501460529e-01   +3.939295024556225e-01   +1.042124482023078e-01   +2.885004699949297e-01   -6.345576392890820e-02   +4.238092758911747e-01   +2.025457711761571e-01   +1.000000000000000e+00   +5.572740319950906e-01   -3.849589677795284e-02   +7.351738004197330e-01; -2.256429135488294e-01   +1.719782802958917e-01   +9.608038329258041e-01   +7.466433192058523e-02   +1.845671573414810e-01   -3.971912860550931e-01   +4.743136642453566e-01   -1.310070239426473e-01   +1.200193992297559e-01   -1.472996533995741e-01   +2.513812427872317e-02   -3.985651801041188e-01   +3.214378467625713e-01   +4.107277444733125e-01   +3.020040397669332e-01   -7.886788847216879e-01; -2.130927623143170e-01   +2.219436721603911e-01   -1.442337076245042e-01   -1.621406493597152e-02   -1.320171552358271e-01   +1.992686096063288e-01   -1.761339803013547e-01   +3.813779663903375e-01   -3.723287720927775e-02   +8.788323703359924e-02   -1.912701565223409e-01   -3.059819883892993e-01   -1.703033194133496e-01   -6.462639709369129e-01   +3.002335360538279e-01   +4.408767630312269e-01; +1.673480660951998e-01   +3.544705739498660e-01   -3.733914695989309e-01   -3.214816046807893e-01   +2.092665389507954e-01   +1.522642468277885e-01   -1.128430366320155e-02   -1.344973780422805e-01   -6.342906466572813e-01   +5.934085877274268e-01   +1.277289014245573e-01   +2.275468513761193e-01   -1.170978122910768e-01   +7.754113246814536e-01   +6.406050615201846e-01   +3.335403357551687e-01; +4.098304890700659e-01   +7.038766557491120e-01   -8.354350478247710e-02   +4.387029064550017e-04   +2.366308318332244e-01   +4.207400792142972e-01   +5.009687031549835e-01   +3.345261688445834e-01   +9.399352564635030e-02   +3.671639949349223e-01   +2.326280815739882e-02   -1.560468135034868e-01   +6.703341714594077e-02   +4.804029110091818e-01   -2.759491266943689e-01   +6.632018699911727e-01; +2.881202244750898e-01   +2.807213828042168e-01   -2.244902644599119e-01   +3.932542101376471e-01   +5.446044951666692e-01   +6.283023199955126e-01   -3.188958205242368e-01   -7.589239102871022e-01   +1.612891007235553e-01   +1.300907444129157e-01   +2.147188257689437e-01   +2.335971645640102e-01   -4.603794139240359e-01   +6.223812802077924e-01   -7.335706757479218e-01   +8.924006123347158e-02];
L2I_L2E_iAMPA_netcon = [+7.221193974411445e-02   +1.129289473412299e-01   +1.685220913955486e-01   +2.942325420731733e-01   -3.963735508258021e-01   -3.011048129796406e-01   +1.581649658316550e-01   -5.705195461036175e-01; +1.752728351509297e-01   +6.980470728753243e-01   -3.977428807529853e-01   -5.711148307853004e-02   -3.669147247000639e-01   -4.762399535234278e-01   -8.588070357112554e-01   +3.527665301777462e-01; -9.271645104391124e-01   -1.313931292058912e-01   -9.817731802872755e-02   -1.009904040925037e-01   +6.504527000206889e-01   +6.957218824134660e-02   +2.664224797704657e-01   +1.797678867481217e-01; +4.782930343256825e-01   -2.696798577069035e-01   -1.030719473686011e-01   +2.535383605926755e-01   +5.030399711839293e-01   -6.964134837921422e-01   +9.229376004683337e-02   -6.379447498801702e-01; -6.296208252270150e-01   -6.653969889137414e-01   -6.232182387432619e-01   -6.168404808857275e-01   -3.557184045129229e-01   +3.933924236091112e-02   -4.538248713723197e-01   -1.625922474615830e-01; +1.000000000000000e+00   +3.481872695316704e-01   +1.669917283295932e-01   +1.248693755256404e-01   -2.543805762453535e-01   +9.892596778976981e-01   +9.209827399612878e-02   +3.222654965327025e-01; -1.264444602034724e-01   -1.600811371740432e-01   -9.474975712228689e-01   -3.404021584514996e-01   -8.149627699922650e-01   -2.998527115231442e-01   -9.544738580378301e-01   +2.461925847485177e-01; +1.605263122778049e-01   +9.655744825456718e-01   +6.987887394137687e-01   +1.165039114846082e-01   -2.480643792369792e-01   -3.341556318929840e-01   +8.104167743663974e-02   -5.128585476797612e-01];
L2E_L2I_iGABA_netcon = [-5.004133868896381e-01   +8.232454209940677e-01   +5.008863249934681e-01   -4.805304629800489e-01   -1.289193760943260e-01   -1.507770807793340e-01   +2.074024606171403e-01   +1.484271601401452e-01; +2.078258263641654e-01   +4.699142888041230e-01   +8.567683451788822e-01   -1.010564108427338e-01   +5.310576610821953e-01   +2.227608671435734e-01   -1.734421845618389e-01   +3.149071044170915e-02; +4.876660722349843e-01   -5.976037712495570e-01   +8.425537724406724e-01   +6.658603427734375e-02   +1.144492989225816e-01   +4.733362666454326e-01   +8.990387123469945e-01   -5.395064638696909e-01; -4.132807914675948e-01   +2.456867918452464e-01   -1.541474457105604e-01   +6.642401414867061e-01   -1.046225015080285e-01   +5.616554145740331e-01   -4.777592095786633e-01   -7.601855400692323e-01; +2.264198907389809e-01   +4.724528518193256e-01   +2.439316098111989e-01   +3.964507619505125e-01   -5.221678575133619e-01   -4.596056688118677e-02   -2.198110456340511e-01   +3.057331969443070e-01; -1.272176256716855e-01   -5.221603503897387e-01   -5.524394219290729e-01   -7.793727327682463e-02   -1.327703357530350e-01   +6.199450225319036e-03   +7.665441846603855e-01   +1.331380516194125e-01; -3.044535366804759e-01   +3.091155057359177e-01   -1.155368799719166e-01   +8.829463748406947e-01   -3.392766962844982e-01   -7.187374425791402e-01   +4.974738351685236e-01   -4.279131791916903e-01; +2.675775690858441e-01   -2.982454084565312e-01   -1.016504886807589e-01   -2.623496704018488e-01   -6.685906000430273e-01   +1.732475446577051e-01   +8.686721065888682e-01   -4.883819877915445e-01];
L3E_L2E_iAMPA_netcon = [+6.196073267235461e-01   +3.608661599250057e-01   +6.406023105954435e-02   -3.670936435604727e-01   +4.908005715051832e-01   +2.007294611606595e-01   +6.337920155606362e-01   +1.342956710247370e-01   +2.872954299494890e-01   +5.571595011657600e-01   +6.462889746506217e-01   -5.137311837231421e-02; +7.779120691495945e-01   +9.876161644603607e-02   +7.674681080740222e-01   +2.407828228524318e-01   -9.570676029559749e-02   +2.920347085166785e-01   -1.618722746240862e-01   +5.997698822071982e-01   +3.484631546188383e-02   -5.953016759035966e-01   +1.490842519027815e-01   +8.401853671827195e-01; -4.280586383184188e-01   +3.227926045154283e-02   +3.155839703407669e-01   -1.000000000000000e+00   -1.664768659110265e-01   -4.707098537099891e-01   -2.418661392529835e-01   -1.902987795677563e-01   -4.123969839302601e-01   -1.677239528372823e-01   +3.271893630977557e-02   +2.674568449131255e-01; -4.674510947852097e-01   +1.334774265929369e-02   -8.170864371756559e-02   -5.587578036862462e-01   -2.403822435810964e-01   +4.873168611187096e-01   +4.905217247514454e-01   +2.542371513156335e-01   -1.847366600899965e-01   +3.385540090219093e-01   +1.649851364751687e-01   +5.662587184777073e-01; -4.409429887636601e-01   -3.180318407509617e-02   -5.016607294799207e-01   +7.357581379994471e-03   -3.463779441307126e-01   +4.334859209724559e-01   -9.104779533147767e-01   -3.870217836833922e-01   +5.830388701623636e-01   +3.285913054786074e-03   +4.805640441814211e-01   +5.243906286904219e-01; +1.833672610091970e-01   -2.205314995368622e-01   +1.391816383104149e-01   +7.373758158018386e-02   +1.423997395476061e-02   -2.515104577790694e-01   +1.287656443944033e-01   +4.410156262667479e-02   +5.820649498543337e-01   -1.792329076342957e-02   -5.183283183867528e-01   -1.140464386840065e-01; +1.144973216925231e-01   +3.080709812097831e-01   -3.060568091356400e-02   -4.588492741300474e-01   -3.757142215124816e-01   +7.547870945001868e-03   +5.809417126903328e-01   +7.842342539161698e-02   +1.611855406597055e-01   -1.215315383565369e-01   -1.568087207786863e-01   -1.163800658565214e-01; -2.459118397234820e-01   +2.791179005757810e-01   +6.053156206708069e-01   +4.329063306253823e-01   -5.904405983872706e-01   -2.382833626617281e-01   +5.113804986436653e-02   +6.030721665830320e-01   -1.194256287165510e-02   +3.338085813120822e-01   +1.364354618017934e-01   -2.022398434921533e-02];
L3I_L2I_iGABA_netcon = [+2.704079883782241e-01   -4.345392021098410e-01   +7.189704029242722e-02   -2.403307542259270e-01   +4.056783044837117e-01   +1.699597204399288e-01   +3.904605070220954e-01   +3.440212833381033e-01   +2.291936128600013e-01   +6.812500033119608e-01   -8.927881727178549e-02   -2.368780698728156e-01; +1.494162196209498e-01   +5.315602238325065e-01   +2.926966953595566e-01   -5.961426617691776e-01   +2.971389767463765e-01   +9.131947517544021e-03   -9.134811784822677e-02   -6.584733740059481e-02   +6.898798685210192e-02   -2.121346068811374e-01   -5.955182530869745e-02   -4.108120742621107e-02; +6.970974561685007e-02   -3.553789359991610e-01   -5.421365917054132e-01   -2.901160857192834e-01   -1.724203792137128e-02   -1.912768090913131e-01   -3.454280684625100e-01   +1.348606275376515e-01   -5.288633904510105e-01   -6.714215757539659e-01   -2.535316575776231e-01   -2.212626963762408e-01; +5.490752688498735e-02   +1.173605273586293e-01   -1.684099619667959e-02   +2.201841221390842e-01   +7.224183165344561e-01   -3.949073061398995e-01   +8.734325205161168e-02   +6.865501365953607e-01   +4.416402121041677e-02   +1.857680225777170e-01   +3.266216037206013e-01   +7.951419372220539e-02; -7.896870343088799e-02   +2.162367981516147e-01   +2.132010752046490e-03   -1.932013425949979e-01   -3.590391107203035e-01   +3.339416742026404e-01   -2.413701448598177e-01   -4.404946984287572e-01   +2.124027740132512e-01   -3.968326658665881e-01   -4.336697808406841e-01   -1.341502565479782e-01; +4.553217633024048e-01   -2.837808352245065e-01   -4.623699157963768e-02   -2.838137551015355e-01   -1.687009242298384e-01   +3.369338143482433e-01   +6.110209542865078e-01   -3.207614072977087e-01   -1.191682438520707e-02   +3.603031157916590e-01   -4.461141455367296e-01   -1.190153929776880e-01; +1.000000000000000e+00   -5.665805091987006e-02   -3.451032827362506e-01   -3.004378637617536e-01   -3.372092255678195e-01   +1.183404868516792e-01   +1.631173562755225e-01   +6.412587618778260e-01   +8.585670334697361e-01   +1.967402828302797e-01   -3.325940877374745e-02   -1.360217532032769e-01; +1.569469910294632e-01   +3.795056113239832e-01   -2.315934680846571e-01   -6.131223748081798e-01   +1.081308783364905e-01   +3.718961792483004e-01   +2.797504730817780e-01   +1.003787135570806e-01   -5.515507551708720e-02   -5.142269950039784e-01   +4.283861846441366e-01   -5.903024389952550e-01];
L2E_L3E_iAMPA_netcon = [-4.689674808122385e-01   -5.336424387075488e-01   +5.132282314215537e-03   -3.945709715006567e-01   +1.000000000000000e+00   +1.814038173051560e-01   -3.693979161319525e-01   +2.566960443825184e-01; +3.540156613080255e-01   +3.264363127291229e-01   +3.026855041557509e-01   +4.694546855507578e-02   +2.561759380937528e-01   -1.773928436004312e-02   +8.807917634418935e-02   +2.541391896818557e-01; +3.086365880615541e-01   +6.661793507106024e-02   -3.521020973847682e-01   +2.475004985089222e-01   +1.271668884338163e-01   -4.733879500112108e-01   -4.968283714006619e-01   +8.496908214153166e-02; -1.261960669054438e-03   -2.405567363631934e-01   +9.572440983357351e-02   -2.780720430681308e-01   -4.530043140307798e-01   +2.114942115513249e-01   -4.023107124057362e-01   +3.343160287074065e-01; +4.440959122858671e-01   +3.264132143245517e-01   -1.494027962973388e-01   -4.254023554048399e-01   -1.334813784220942e-01   -4.332843887780526e-02   -4.565338769021788e-01   -6.316979477029570e-02; -1.614376824317865e-01   -2.063849660876120e-01   -5.316154583424796e-01   +7.407896000900296e-01   -6.130232480199952e-01   -6.164188812424803e-01   +7.622394106004306e-02   -3.270291403807347e-02; +2.532316169490846e-02   +8.457022923608609e-02   +3.960380482173960e-01   -6.402205744611391e-01   -5.518110390751413e-01   -5.263040335127220e-01   -7.144930219618988e-01   -4.243660638686581e-03; +6.485994672573550e-01   +1.753181472008354e-01   +4.046433746728573e-01   +4.274076972329182e-01   -5.330258800476780e-01   +2.400686355877361e-01   -9.952717760094269e-02   +6.786349855649318e-01; +8.022817125550538e-01   -4.967533313054056e-02   -5.303454622026862e-02   -1.784726933355663e-01   -8.458515216282270e-02   +2.886768917748372e-01   -6.098062784959700e-01   -2.328639561664799e-01; +1.090996368667701e-01   +8.435106769769576e-01   -3.987246458920995e-01   -1.400448683212472e-02   -6.046486356514474e-01   -6.200425174401308e-02   -5.821508290803166e-01   -1.315707580025281e-01; -5.274649395962681e-01   +4.989184520595705e-01   -5.043402655300917e-01   +5.017990693210845e-01   +5.162887704567686e-01   +1.698269593995230e-01   -5.382900619232454e-01   -7.123843021138533e-01; -3.358411260255048e-01   +6.220096279454965e-02   -4.945910518176120e-01   +1.319263149270086e-04   +7.439672749902877e-01   +9.327825987116041e-03   +2.509216240805709e-01   -2.156094380503121e-01];
L2I_L3I_iGABA_netcon = [+2.558592589229342e-01   +5.346131922255236e-01   +1.000000000000000e+00   -5.186166215160022e-01   -7.428314188322922e-03   +3.419288831106537e-01   +3.414468542510411e-01   -5.484522851247522e-01; +1.334672171301259e-01   +1.383457178674453e-01   +3.718161724793998e-01   +7.491054911950033e-02   +3.702614291149410e-01   +7.875754386986730e-01   +3.506439238437024e-01   -4.525170152792150e-01; -4.063519459983103e-01   -8.953237490688452e-01   -2.088990616945333e-01   +4.106236172206831e-02   -5.945466196249135e-02   -4.995878019283190e-01   -7.255327064695353e-01   +3.201123215673267e-01; -1.570403173916208e-01   +6.011648708299994e-01   -1.922864931613091e-01   +4.507034829803176e-01   -2.259679148855348e-01   +2.659837492719986e-01   -5.587265104869492e-01   +5.151846959745858e-01; +2.201057739933879e-01   -9.298207577930362e-02   +4.529534086183182e-02   +3.149025259038845e-01   -2.123287735495557e-01   -2.223836320481832e-01   -6.747345937769730e-01   -2.881899147519905e-02; +3.404530796728653e-01   -6.318513227312026e-01   -3.605916431112972e-01   +5.080607480737247e-01   +6.613110458833157e-01   -7.679414171507453e-01   +4.195007437379309e-01   -1.675676172893004e-01; -4.710183006630709e-01   -1.755786161523051e-01   -3.050584508610268e-01   +1.262938218044721e-01   -2.052162172942015e-02   -3.004140269555010e-02   -1.691826565445284e-01   -8.450399621756844e-01; +1.752876406257058e-01   +2.861518068275662e-01   -1.754091799355444e-01   +4.768265653362108e-01   +3.791698629166684e-01   -3.004510947483670e-01   +7.429002209011722e-01   +4.463465116956352e-01; +7.073058154382703e-01   +2.184489260274355e-01   +3.913486468681023e-01   +2.715278638501685e-02   -6.446493820048516e-02   -9.688554817372962e-02   -3.539445651062870e-01   -1.511659987551285e-01; -2.844111230776976e-01   +2.959617810055988e-01   +3.607707626856724e-01   -9.583832151516596e-02   +3.637149557186948e-01   -3.896086454634344e-01   -2.178990779263726e-01   -7.099005153757695e-01; -7.338064749575255e-01   -2.471855870791207e-01   -3.861601453941271e-01   -6.631409295436781e-01   -7.087482603231235e-02   -1.579322755371323e-01   -6.711787059223869e-01   +3.533670594965039e-01; +1.606456998703833e-01   -1.516577876172765e-01   -2.484865134201015e-01   -4.722496890081503e-01   -6.845284111591986e-01   +2.078993222004440e-01   -8.525438451023546e-01   -1.903989433151856e-01];
L3I_L3E_iAMPA_netcon = [+7.291480101093148e-01   +2.746706057903522e-02   -1.388992517586040e-01   +8.503249064698599e-02   -4.724158708849849e-01   -1.856548735570833e-01   -7.865114017920116e-02   -2.108023203977264e-01   +2.319286174579000e-01   +7.768859360147401e-02   +6.007287253698234e-01   -4.664862291750134e-01; -6.839224700947962e-01   -1.163676893991854e-01   +1.848957206104564e-01   -7.376115290349717e-01   +4.657502212860202e-01   -4.276943413156061e-01   -1.838086192660974e-01   +5.038827172361863e-01   +2.887895888725266e-02   +5.049710898827103e-01   +8.243301547295200e-01   -8.877616875791758e-01; -5.251429358347313e-02   -9.165776404420817e-02   -8.051530265782987e-02   +5.088586761145498e-01   +1.523453218633779e-01   +4.450532924703184e-01   +5.263072133196280e-01   -1.000000000000000e+00   -6.834808049851820e-02   -3.357635302235076e-01   -8.781184745264254e-01   +6.620020891068498e-02; -4.012477911869183e-01   +5.194109295173561e-01   +6.431570022818821e-01   +3.365796848122622e-01   +3.809337137992768e-01   +3.187071118538967e-01   +1.541016604781287e-01   +8.072432167113630e-01   +5.103287771740941e-01   +1.336330868094908e-01   -6.488870819223309e-01   +1.241305640738940e-01; +3.775677701020103e-01   +1.262908353936633e-01   -2.503971504613939e-01   +9.049666473787901e-02   +2.474841361289573e-01   -1.979750237543250e-01   -3.206272090561134e-01   +6.209311033920570e-01   -1.592073232273120e-01   -9.389959906538410e-02   +5.819865661736319e-01   -2.153785424790184e-02; -8.178192958609859e-01   +9.501448812769681e-02   +3.338050647104719e-01   +4.318150518069007e-01   +1.131121121741518e-01   -8.923325119864790e-01   -4.189465918050088e-01   +3.853261463914014e-01   -1.116148853613388e-01   +6.420293244228389e-02   -1.515866690387510e-01   -5.244213764361711e-01; +4.578120275321936e-02   +1.492994175198018e-01   -7.371454854150706e-01   +6.523969725957904e-01   +7.440265149730692e-01   +4.671731953260743e-01   -4.711086192797343e-01   -4.694558525623583e-01   -5.631225262001577e-01   +3.612541456470875e-01   -1.704174749830667e-01   +1.316779868197588e-01; +6.629316663880694e-01   +2.843318954405216e-01   -1.327504865912774e-01   -1.352731929173784e-01   -4.086784617955523e-01   +4.743687055237265e-02   -1.174661306330393e-01   +5.792365429577637e-02   -4.458433121578835e-01   +1.588177460311811e-01   +2.921720922437348e-01   +3.050977495417934e-01; +5.148736176320795e-01   +3.833577506808017e-02   -3.144403397303888e-01   +2.262912042713356e-01   +8.454116498848345e-01   +3.204443721951116e-01   -3.723506207474947e-02   -3.980015404276183e-01   -2.490993494068109e-01   -3.985931273141252e-01   +3.113026681421480e-01   +3.428880948481860e-01; -1.226189985487240e-01   +1.214726316720185e-01   +6.187172841000245e-01   +4.657583578160227e-01   +1.906069203273524e-01   +7.569959616713223e-02   -6.101490993767792e-02   -8.306492262903900e-02   -2.152684803425389e-01   -3.680686122231601e-02   -1.873274879825658e-01   +1.499921986707985e-01; -1.167081710640081e-01   +7.177136510428368e-02   -1.442442001173090e-01   +5.125985366351137e-01   -5.036491619474466e-02   -4.815685091413772e-01   -5.828382285322675e-01   +5.486687975709083e-01   +2.005295357089434e-01   +2.681423603212144e-01   -5.807626393233134e-01   +5.753787792284210e-01; +9.282068131528370e-02   -1.366954401440356e-01   -2.319823311661850e-01   +2.422641621585759e-01   -5.297851461276062e-01   +8.084804839506272e-01   -5.456802670311016e-01   -2.623243943166170e-01   -2.226237831260777e-01   -2.072328282313740e-01   +6.421182963907798e-01   -3.848531085209494e-01];
L3E_L3I_iGABA_netcon = [+4.117575477781826e-01   +1.917263123231307e-01   -2.358556439594648e-01   +5.185775677235470e-01   -1.856387442840095e-01   -1.000000000000000e+00   -3.471864795464227e-01   -5.039778030962028e-01   +2.082493771998018e-01   +1.920701270618462e-01   +6.230107102539200e-01   -1.581380921525818e-01; -3.571531062434268e-01   -6.816223436969592e-01   -3.780429907520447e-01   -3.700385832881565e-01   -4.910917364940370e-02   -1.662210144375641e-01   -4.130012062827773e-01   -5.278437842393963e-01   +2.271017629575824e-01   +2.420113862308782e-02   +2.430863905477623e-01   +2.852157705778016e-01; -3.415931287024596e-02   -6.510959265937981e-01   +4.367111500472058e-01   -1.957125423170721e-01   -2.401022728535815e-02   +7.244917624871554e-02   -3.472248578501359e-02   +7.791192481465471e-02   +7.003495884597563e-01   +4.989551285719272e-01   -2.949376551299142e-01   -4.307303148328971e-01; -1.695406304587062e-01   -1.035610815682128e-01   +3.200570455836338e-01   -2.836529924404800e-02   -4.206234846465596e-01   +7.646969656404843e-01   +1.648266944372148e-01   +3.445730697521109e-01   -1.091534144544777e-01   +3.800564129788884e-02   +3.118260494919389e-01   -1.025387686673900e-02; +3.474950632390394e-01   +3.089448208801935e-01   -7.807467153120662e-01   -9.776698404918982e-02   -6.024216142452278e-01   -4.699133138719678e-01   -2.620198639511508e-01   +6.240709699240378e-01   -3.653164927919302e-01   +1.507600046410391e-01   +7.862427630078798e-01   +8.052150176757106e-02; +3.666280598657286e-01   -7.750707955015727e-02   +1.600968541433090e-01   +1.085971563387753e-01   -2.588319098956982e-01   -3.555805808944438e-01   -3.398318177464528e-01   +1.008959764022889e-01   -6.686795136750835e-02   -1.954992422925486e-01   -6.507224927612659e-01   +2.815992852472070e-02; +1.516234521384975e-01   -2.859100821081461e-01   +7.023545845510976e-02   +3.190054871901110e-01   +4.340074834042206e-01   -6.427651796102796e-01   +1.979558861380128e-01   +2.244941496673763e-01   -1.537245561087833e-01   +5.570125282944930e-02   +6.131528742440153e-02   +7.793663371609060e-01; -7.525490013525309e-01   -3.240746703563281e-01   -3.304819694251113e-01   +5.050854626173765e-02   +7.904730266925281e-02   +6.035555163784186e-02   -6.626999096422672e-01   +1.618316809694921e-01   -7.346228673396094e-01   -5.123954414379545e-01   +4.187653340063807e-01   +5.454601240398474e-01; -2.810247413205917e-01   +1.107177905509685e-01   -2.486774104915392e-01   +3.146333463199967e-01   -9.589861524800537e-01   +4.232620449104005e-01   +2.079794359651338e-01   +2.829901315365650e-01   +3.505194389684675e-01   -3.442484121717985e-01   -1.357336468579778e-01   -1.213448543491874e-01; -7.851371344092162e-02   +1.269996713361661e-01   -3.205755164614451e-01   -3.518685161555671e-01   +3.345020349653163e-01   -1.806694581278397e-02   +1.701263281147739e-01   -6.962545153853428e-01   +1.954067343590699e-01   -3.630454631745101e-01   +4.837261159136389e-01   +6.106160252333827e-01; +1.456994051872520e-02   +2.109803625190207e-01   -2.692777460764116e-01   +6.965717247024433e-02   +1.981495640742043e-01   -5.793950476091862e-02   +3.115116026946733e-01   -7.073557111378023e-01   +3.794504947624032e-01   -2.991968299942894e-01   +4.546375918472557e-01   +4.341188582109995e-01; -6.119970079028996e-02   +8.977885754253958e-03   -4.345939663263921e-01   +4.302407808766089e-01   -2.673780936842754e-01   -1.676944534353933e-01   -4.136311523218959e-01   +7.709914459591072e-01   +3.866369570726822e-01   -4.034112045019338e-01   +2.089109785640287e-01   +5.099603346276834e-01];
L2E_Input1_iAMPA_netcon = [-5.705021100038610e-01   -4.429903167228141e-01   +8.035447612908912e-02   -4.495360341165205e-02   -2.702923642947170e-01   +2.470250230108923e-01   -5.579845063255692e-01   -1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [+2.727401551286223e-01   +2.983629179027173e-01   -2.419620846790722e-01   -3.436202761568271e-01   -8.611359667655719e-01   +6.588754671802424e-01   -2.922360966659563e-01   -5.779160056637014e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
