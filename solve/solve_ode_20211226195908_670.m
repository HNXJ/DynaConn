function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.339064511045911e-01   -2.797298144402887e-01   -3.456130187781091e-02   +1.908483521626200e-01   +2.236885248518547e-01   +2.402634930043878e-01   -3.056971447652657e-01   -3.414726951166397e-01   -2.103183765860576e-01   -1.057623878833976e-01   +1.067625493235328e-02   +8.268274419735544e-02   +5.332040653448265e-01   -1.589244333681563e-01   +5.180928480216775e-02   +6.304515381931375e-01; +3.471150045059039e-01   +3.745008089647188e-01   +4.955277899717309e-01   +1.650613494526183e-01   -6.974108552083227e-02   -1.471612141539866e-01   +2.275782820231075e-01   +2.178808841098738e-01   -2.032167331858683e-02   +1.596406024841921e-01   -2.410035059321175e-02   -9.042064585695198e-02   -3.103193419410461e-01   -3.155762421348890e-02   -2.540750204755970e-03   +1.682503730761794e-01; +3.338387265121989e-01   -7.082866877287018e-02   +3.864807107863805e-02   -2.581649787410263e-01   +8.940389729782940e-01   +1.666924805585414e-01   +2.563827364996857e-01   +4.869865435763173e-01   +2.350987902572068e-01   +4.924736696847976e-01   -1.455317115266181e-01   +1.358334243491691e-01   -9.809746433654142e-02   +5.791925638905417e-01   +1.364857997911666e-01   +1.327439681474411e-01; +4.625798830002850e-01   +5.050866759798257e-02   -2.686034630352175e-01   -2.204653716806310e-02   +1.697148446139637e-01   -3.732496391787272e-02   +3.221907987026972e-01   -7.093845940158718e-02   +4.640862309934108e-01   +6.752697677515750e-01   +4.407921724807073e-02   +4.928445731310029e-01   +1.448298111636888e-01   +6.354518842644599e-02   +6.572614741519500e-01   +3.016832501568259e-01; -1.620456701223768e-01   -6.174660713425136e-02   -7.360872043808467e-02   -2.336184579628847e-01   -1.835424812578832e-01   +4.582443886140262e-01   -2.100823815678827e-01   +3.493222031721249e-01   +5.063344603075111e-01   +2.864519110777412e-01   +8.146839720339699e-02   +1.006029396555851e-01   +4.392381618593346e-01   +6.371065262767424e-01   -8.389400552094196e-02   -2.611417416902918e-01; +3.863285937144529e-01   -2.785515829220904e-01   +2.251419818776786e-01   +2.576737370127699e-01   -3.261046783378257e-01   -1.704630595261612e-02   -9.139316621353699e-03   +4.011290310277484e-01   -4.465383380862234e-01   -1.505585861992444e-01   -2.190192518466290e-01   +9.979910844504637e-02   -2.330797727698941e-01   +8.794812303804223e-02   +2.861202882613699e-01   -2.459653686166207e-01; -1.916296538350267e-01   -1.220085332925884e-01   +4.189992115509075e-01   -3.486820713005213e-01   -2.695021635377627e-01   -1.050312046743597e-01   +1.686864422252730e-01   -5.677560794317235e-03   -1.628448401963160e-01   +4.021041367484228e-01   +8.179764592297123e-02   +3.313210735738910e-01   +1.132784647350145e-01   -4.029307025070304e-02   +2.259711844182614e-01   +3.258000739510735e-02; -7.267309031940591e-02   -5.016103981869382e-01   +1.464743692758509e-01   -1.216789810431763e-02   +1.032499753764536e-02   -1.744140146693700e-02   +8.601677446337724e-02   +3.656621115034280e-01   -1.982224098912113e-01   +3.630013478152531e-01   -3.827928042444143e-01   +1.875198053961681e-01   -9.471931153671692e-02   -4.618002581515401e-03   +1.625836231006607e-01   +4.947616915686587e-02; +5.244631009919068e-01   +2.690627801917799e-01   -8.605164012610644e-02   +3.858668719171234e-01   -7.864984561524146e-02   +1.120533989899287e-01   +3.924126871956972e-01   +2.558485328798258e-02   -2.794996662359888e-01   +2.384188135034273e-01   +2.242124833796932e-01   -8.376229137621964e-02   +1.228111903928018e-01   +3.629583788270446e-01   +1.036033182744467e-01   -3.596525590060639e-01; +7.696629369458615e-01   +2.138043872912750e-01   +8.576516647599855e-02   +2.068664866482055e-01   +1.867546159478731e-02   +5.369549770467903e-02   +1.025047117746880e-02   +1.429361302412602e-01   -5.131494871810229e-01   -2.452911620551125e-01   +5.026524139711431e-01   +4.833454400841569e-01   +2.993710076078168e-04   +6.406573844314649e-02   +1.585179972636146e-01   +2.823501867533796e-01; -3.888356701176254e-01   -6.360400621515305e-02   -2.764078686543729e-01   -5.214583754054580e-01   +1.826524954232067e-02   +1.953979045299678e-01   +3.422452343560735e-01   +4.379897601022729e-02   +3.350431895369108e-01   +8.682009211678597e-02   +1.051561621674579e-02   -1.299927274749985e-01   +1.731996023787834e-01   +3.513600439360847e-01   +2.337040530418281e-01   -2.641792749224441e-01; -2.630190980440458e-01   +1.450422448548370e-01   -7.347764162077153e-02   +2.251053134421299e-02   +1.392900778145496e-01   +4.387213687630469e-01   +5.547858285647821e-01   +6.313446799568953e-02   -2.404393302243917e-01   -3.196567375338283e-01   -3.272707827613033e-01   -1.560555268384825e-01   +3.884616735471068e-01   -3.239524961474003e-01   +2.669112380494658e-01   +1.330039460188626e-01; +3.504620893391497e-01   +6.375698684072775e-01   +2.519158142555124e-01   +3.560189131217342e-02   -1.554416340770493e-01   -2.382212208412088e-01   +4.648027815817297e-01   -4.883103642688252e-02   +1.048328112626672e-01   +2.999456410460642e-01   -5.441222442156091e-01   +9.338823683085520e-02   +2.576191051598778e-01   +1.173201348956848e-01   -1.486219124867572e-01   -2.317454968075647e-01; +4.935194937606914e-01   +2.400609790808198e-01   -5.961782755136424e-03   +3.394258568730482e-01   +8.972549434710864e-02   -1.627818373541968e-01   +1.984934236100945e-01   +1.203039789500077e-01   +1.965332734940860e-01   -1.773852415351879e-01   -2.121594272540088e-01   +4.312467147943642e-01   +4.042550291081812e-01   +3.817843932049236e-02   +3.318805055643099e-01   -4.937985557198442e-01; -1.855023430756989e-01   -2.208381418796609e-01   -8.989576066901156e-02   -3.024037892834351e-01   +1.900296550436964e-01   +6.537183403434532e-02   -1.493648656838181e-01   +3.776458776167024e-01   -1.135965745080220e-01   +1.810636541489418e-01   -2.181262711944301e-01   +3.459052700497707e-01   +6.944900441980736e-01   -1.403347772846614e-01   +2.971327479301686e-02   -1.705091296030900e-02; -1.087172798797443e-01   -3.127300815516251e-01   -1.323950469348231e-01   -3.526415360045254e-02   -3.137875391055793e-01   +1.794899821950295e-01   +4.966319673252810e-01   -8.435107909900282e-02   +5.086350381022908e-01   +1.775468010830010e-01   +4.277075924411495e-01   -1.098190911409796e-01   -2.351482111899056e-01   +2.213562557409370e-01   +1.246355157468315e-01   -1.861259306000551e-02];
L1E_L1I_iGABA_netcon = [+4.649159785215993e-01   -9.649999314811553e-02   +3.320458932228006e-01   +3.735920054703838e-01   -3.036287574656636e-01   -1.035413037922362e-01   -3.592544879283515e-01   +4.406650239430612e-01   +4.155968731754088e-01   +1.856644223118921e-01   -3.525612493454794e-02   -3.057808012316837e-01   -1.589965891717194e-01   +2.752798075846777e-01   -2.440088602392578e-01   +3.909755472855587e-01; -7.974977639510189e-02   +1.317462924187043e-01   +1.531430020802020e-01   -1.733084512666334e-01   +9.650793416244592e-03   +2.196843865421107e-02   +1.186294722913595e-01   +3.579241738871643e-01   -6.144335071132623e-02   +1.545911146344990e-01   +4.574921228251283e-01   +4.606112435175853e-01   -8.492332486473958e-02   +5.555359679662198e-01   +2.811399777946634e-01   +1.340312746535849e-01; -1.700366347567699e-01   +2.449004086558542e-01   +4.329720341172623e-01   -2.583558723515663e-01   +1.645700468196791e-01   +3.457154212107277e-01   +1.526758921842598e-01   +9.469797471196165e-02   +2.216253971366955e-02   +6.944667143312849e-02   -1.240180969294074e-01   -9.826154601521309e-03   -3.146914648530491e-01   +1.309814862283087e-01   +2.014330754979263e-01   +6.133186284497858e-01; +7.683920527921823e-02   +9.969959953925553e-02   -1.317016916117734e-01   +2.744152854473872e-01   +4.295241130693872e-01   +3.827550691944058e-01   -2.313055092560048e-01   +4.938558264793426e-01   -4.095884472754904e-01   -3.167646176216432e-01   -4.103279523740732e-01   +3.782188234615962e-01   +4.382871191019707e-01   -2.234020486221106e-01   +5.805678571687308e-01   -1.968809378963916e-01; +6.109722991449533e-01   -4.702887853102567e-01   +4.990120609866342e-02   +1.862901566180242e-03   +5.111786254385156e-01   +3.941036837624244e-01   -3.377825791522905e-01   +6.312053196634335e-01   +1.524039111851664e-01   +3.860201142683294e-02   -3.419278826003131e-01   +3.922452006502852e-01   +1.713278403980296e-01   -2.933042959417884e-02   +3.548143348785245e-01   +4.909507835810321e-01; +2.502972598166242e-01   +3.824755605533718e-01   +4.762589075523229e-01   +3.728496822236082e-01   +2.467076915118658e-01   +4.190020152217082e-01   +3.783139210404096e-01   -2.041666316443952e-01   +6.213066807139411e-02   +4.178929573694705e-01   +5.854072518641983e-01   +3.925119390627574e-01   -2.605241578371811e-01   +3.563707618501090e-01   -1.250527755005887e-02   -2.851466744693590e-01; +2.794695928452311e-01   -2.140930009384966e-01   +5.597368405684067e-01   +2.275910335869908e-01   +3.813406618723707e-02   +1.210954988707368e-01   +5.034547473314115e-01   +1.007052630689965e-01   +1.601281593455974e-01   -1.557161211987531e-01   +6.457446502405730e-02   -1.198564439110769e-01   +6.432352077791086e-02   -5.887292506916737e-02   -2.915958520006102e-01   -2.995986750921475e-02; +5.016329967703611e-01   +3.715431002005362e-01   +6.071268476000049e-01   -7.981392118529612e-02   -2.596636194354540e-01   +5.701313129397145e-03   +1.880795547506428e-02   -4.514972453757067e-01   -2.703782559693918e-01   +1.785210150799129e-01   -2.980315253744864e-01   -9.677902549582307e-02   +3.107017345248776e-01   +6.019449295147599e-01   +3.294596390420098e-01   +7.427013909383079e-02; +3.235490622001926e-01   +4.483207839039784e-01   +1.316368214780640e-01   -3.260910642907301e-01   +3.718839437711141e-01   -3.568776566855516e-01   +2.219089799112484e-01   -4.515514608012614e-01   +3.291168160529656e-06   +4.458204295834740e-01   +4.014268003662697e-02   +6.125402654354679e-01   +2.979892273757776e-01   +3.551337921669308e-01   +3.600699043455425e-01   +3.970530695765978e-01; +8.660393367577499e-02   -7.136412630526406e-02   +1.233751003219891e-01   +1.711654631718603e-01   +1.560937316597872e-01   +5.091099117260566e-01   +6.959375210091125e-01   +4.787607523394855e-01   +6.378747799455789e-02   -2.128303183250168e-01   -1.121498276325390e-01   +2.617163467214163e-01   -3.770524589663189e-01   -9.763748278092649e-02   +4.184711647191336e-01   +2.838451338005578e-01; +1.120666592963909e-01   +4.000036024092319e-01   -2.619054892162072e-01   -1.606902703502522e-01   +3.727189284940836e-01   -2.718462265107842e-01   +4.735880885504290e-01   -2.757930927114498e-01   +3.399737456556390e-03   +5.094359686726729e-02   -8.689700683588775e-02   +9.905732624795766e-02   -3.979781164978261e-02   -1.415227391685983e-01   +1.942139031318579e-01   +5.613693446743896e-02; -2.760001656588373e-01   +5.571117727864749e-02   +4.573212286101370e-01   +3.243164960862975e-01   +2.864429665730890e-01   +2.493381367944114e-01   -2.005979222742745e-01   +6.032410289525585e-01   +1.874883026280318e-01   +4.673835677936595e-01   +4.537884295517302e-01   +1.073115547019135e-01   -4.078000882652337e-01   -8.560222364684932e-02   +5.273508986020489e-01   -3.725510215936842e-02; +1.798507810996477e-01   +1.467791968030048e-01   +2.788412706816474e-01   -1.829034127003489e-01   +4.661068880286331e-01   -2.403107717502631e-02   -2.765132226074940e-03   -2.282265659357642e-01   -7.545769347565703e-02   +3.901184870872005e-04   +4.114740251437564e-01   +1.059670721255765e-01   -3.539048245003491e-01   +1.244514798365982e-01   -2.648307013076501e-02   -2.059197499716992e-01; +8.223634709201921e-02   -3.756843783336595e-01   -3.787368160752993e-02   +4.337671064395168e-01   +4.403520747123685e-02   +4.395083099089809e-01   +7.247795489761330e-02   +3.737020806208702e-01   +3.788254097430395e-01   +3.034912355886831e-01   +2.491294137665234e-01   +3.538747084770495e-01   +1.729708431996446e-01   +4.345087320323043e-01   -3.158049387481935e-01   +4.694946205108262e-01; +2.146551241374223e-01   +6.256018218744115e-01   -1.382156409133119e-01   +8.017089323571720e-02   -7.998928756692743e-02   +8.443429158518748e-02   +6.550215130667358e-02   -1.568174543599219e-01   +8.995400108334184e-02   +4.144013041353662e-02   -5.426353824584958e-02   -1.502082569192198e-01   -2.016518873906374e-01   -5.244179550402543e-01   +1.283879246346211e-01   +1.010291345492084e-01; +4.488466197974561e-01   +3.606862710225694e-01   -2.664640755954416e-01   +2.212181207516848e-01   -3.383785172038742e-01   +1.644409850238336e-01   +4.627267686094130e-02   +2.870272912859831e-01   +3.388391383854431e-01   +4.558066364572397e-01   +2.810740723499683e-01   +2.167152055059506e-01   +8.572903540209365e-02   -2.265835732244592e-02   -2.426429109249022e-01   +2.214736537362789e-01];
L2I_L1I_iGABA_netcon = [+2.165385802617962e-01   +2.252574254969174e-01   +3.375299088710050e-01   +7.673289912558844e-02   +2.769703826807087e-01   +5.238816089455955e-01   +3.395893702671561e-02   +9.892269202818160e-03; +6.868663449744218e-02   +5.741427367068221e-01   +1.253135039409723e-01   -1.752118159545287e-01   +6.453142627427688e-02   +4.107799820952405e-01   +2.100121766213968e-01   +1.119221918341754e-01; +3.683939101700940e-01   +7.692523973430510e-03   +2.871351299393072e-01   -1.542464831528660e-01   +1.636468235033234e-01   +3.043623046628271e-01   -4.513910719126533e-01   -1.005752423208767e-02; +8.848787159783063e-02   +2.132145260979056e-01   -7.196899269038531e-02   -1.946591884189204e-01   +1.348377222304843e-01   +1.311533968962153e-01   +4.006461476921400e-01   +1.192353870862706e-01; +2.340750968618489e-01   -5.769933756929052e-02   -2.870231560464334e-01   -1.252174423802662e-01   +4.572541688521592e-02   -3.798663183283870e-01   +2.439304061410502e-01   +3.794152746102022e-01; -4.234956522907753e-02   -4.535523762587853e-01   -9.508264307395403e-03   +3.863860053433742e-01   -1.231703136618029e-01   +5.813355296047673e-02   +1.412945649803651e-01   +1.761596488101269e-01; +3.389007687840435e-01   +5.558410297725981e-01   -4.270892186796774e-01   +2.662084691247042e-01   -2.859804272247957e-02   +5.415217206066344e-02   +2.852969651110276e-01   -7.638461869289716e-02; -1.688384040241319e-01   +7.514869388640889e-02   +1.227267021950294e-02   +3.323316435436097e-02   -1.926579841130047e-01   +2.314492184448081e-01   -3.295803133806716e-01   -1.457515245220822e-01; -1.098539535059894e-01   -1.528226307836592e-01   +2.645995264246576e-02   +1.142260446023324e-01   +4.421801626849361e-01   +5.581603397364943e-02   -2.290660285353121e-02   +4.049430893446349e-02; -1.658965410319821e-01   -2.691437394490359e-02   -6.088961788225809e-02   -1.476221203561884e-01   +1.636066238551670e-03   -3.142481375004746e-02   -1.379729323768644e-01   -1.158171471606161e-01; +3.994230072065569e-01   -3.532737241341860e-01   +2.591648688785502e-01   -3.362999452352740e-02   +6.661426303890416e-02   +4.452209978876933e-01   +3.829425628887634e-01   +5.086709102854139e-01; +1.401063085157978e-01   -2.304409911519310e-01   -1.195239486711807e-01   +5.058065448049541e-01   +3.487079235984924e-01   +3.873156748144587e-01   -8.974594906755276e-02   +4.033855356575605e-01; +1.588691790853720e-01   +4.694737486451142e-02   -1.172470930134530e-01   +1.335037709566606e-01   +4.220442420556884e-01   +3.196221942913082e-01   +4.966667961978075e-01   -1.471695021561129e-01; -4.981504490284402e-01   +5.310571504396463e-01   -2.277638075304934e-01   -4.783539630410478e-01   +3.136609805564375e-01   +1.569850045330854e-01   -2.044065597556340e-01   -3.400054815352809e-01; +3.403207680980025e-01   -7.361209196824875e-02   +9.052850288859840e-02   +2.721803597134106e-01   +1.792966773388975e-01   +3.664344666030446e-01   +3.261554923164331e-01   -3.493182174935702e-01; -3.293539217527247e-02   -1.939763669412076e-01   +1.568249647587175e-01   +2.716904315941170e-01   -2.787404432276723e-01   -1.150046390832098e-01   +1.812536676317641e-01   -3.296533672780832e-01];
L1I_L2I_iGABA_netcon = [-7.338799733115700e-02   -3.648783511674460e-01   +2.432267458198619e-01   -1.168277537051763e-01   +1.139031422598892e-01   -4.377848905289775e-01   +2.058523057391538e-01   -2.587216996276085e-01   -2.362446315489609e-01   +5.090672134242965e-02   -1.963759271925916e-01   +1.440886412476255e-01   +4.620390952556826e-01   +4.817668978990401e-01   -2.521274443605534e-01   -3.008230803510396e-01; +4.375242580867481e-01   -1.055172975684083e-01   +3.214994743604236e-02   -1.135185649092755e-01   +6.817328019649510e-02   +6.049845485892767e-02   -1.000971817599291e-01   +2.335306572605675e-01   +1.265735097619538e-01   +2.921993503233467e-01   -2.882387350863815e-02   +2.959497074717855e-01   -2.368167239811897e-01   -8.124612350084590e-02   +2.548218083876729e-01   -1.078280585408281e-01; -5.775746035726254e-02   +3.917598773471007e-01   -6.361228790249279e-02   +4.706554541264868e-03   +5.409165553195301e-01   -1.416758843713767e-01   -2.780768074351395e-01   +1.965732209868671e-01   +1.901591657924949e-01   -1.491937371033862e-01   -2.462127147275492e-01   +8.574593065620753e-02   +1.820673306323153e-01   -1.361221688725468e-01   +1.640529254709244e-01   +1.611642776840534e-01; +5.187080773195973e-02   +5.676336583445778e-01   +3.773579593686497e-01   +3.049850882918833e-02   +4.113566971787757e-01   -9.801779789095573e-02   -3.366410668500769e-01   -2.064517319104875e-02   -5.923461036877258e-02   +5.320989087309610e-01   -1.485420192293746e-01   -2.056732343259701e-01   +2.950674993933750e-01   +3.976415117216868e-01   +4.179039695091252e-01   +4.655488448103214e-01; -6.107298529861052e-02   +3.970660957539559e-03   +6.209234521371720e-02   -1.560550356979860e-01   -1.022952402121910e-02   -9.665317718946595e-02   -9.196206476355535e-02   +1.871030391254345e-01   +8.183545459521881e-02   -1.096721332927317e-01   +7.324298338648114e-01   -1.705537534930699e-01   -4.104672013135390e-01   +3.055584094200051e-01   +7.502948021445553e-02   +6.009828801136523e-02; -5.429896556438527e-01   -3.783141882506505e-01   -1.047803739677169e-01   -1.035629086688716e-01   +3.452370771060511e-01   -2.257151204857948e-01   -7.794592465346969e-02   -2.356428419846247e-02   -1.264094364159958e-01   -4.630824682381462e-01   +3.436865579964862e-01   +4.850330269977726e-01   +7.055471756743701e-01   +2.881755916187651e-01   -1.956916409016582e-01   -1.769953603042804e-02; +3.904974227789754e-02   +2.386660974630049e-01   +2.433139391075059e-02   +1.856676796232354e-01   +2.821489561645031e-01   +6.825696888941030e-02   +1.840020756259754e-01   +3.138872838731148e-01   +3.366812190051380e-01   +3.559599934793887e-01   -4.593660753915976e-01   +2.197735912522537e-01   +4.891660493267570e-01   +2.146473548564711e-01   +2.917737105891165e-01   +1.335663504381678e-01; -3.096673435743667e-01   +3.460515958992434e-01   -1.344876450034235e-01   +3.328691714951498e-02   +1.912245400043288e-01   -7.717971031686154e-02   -2.566138485643330e-01   -4.783343929118000e-02   -2.636992803341554e-01   +3.976990985240471e-01   +2.661096726966655e-01   +9.568255936336745e-02   -4.374522329230150e-01   -2.094051263817194e-02   +5.731531515790991e-01   -2.484184052088811e-01];
L2E_L1E_iAMPA_netcon = [+1.934892125832892e-01   +2.232950356324597e-01   +9.742543512101337e-02   -3.263698563840373e-01   +4.725886587305655e-01   +2.532256808338724e-01   -2.333711434099857e-01   -1.989050484187494e-01; +2.121100038516254e-01   -6.867694718772255e-02   +1.161282308611287e-01   -4.690591952124248e-01   +3.382927704628598e-01   -3.110841588953283e-01   -3.946078108930125e-02   +6.515753529976771e-02; +4.149197289473484e-01   +6.640418132356575e-01   +3.947763154530844e-01   -1.759131259896912e-02   +3.588027664202809e-01   +7.188171631964452e-02   +4.055600924189389e-01   +8.330274574277501e-02; +7.655888530393868e-01   +3.408655564780287e-01   -3.585287076639497e-01   +3.152730165256429e-01   +1.918381182667583e-01   +6.700376846618670e-01   -9.990422994559510e-02   -1.162698117393604e-01; +5.425210688460465e-01   +5.790086098782933e-01   -3.797286749942096e-02   +3.591594832592778e-01   +2.482796028183807e-01   -2.449731951631024e-01   -1.342248116314303e-01   +4.933723959409743e-01; -8.433658998675228e-02   +3.501310868803368e-01   +1.590033750138156e-02   +1.655213332384738e-01   -1.404176531516147e-01   -2.503958723119629e-01   +2.499298442879463e-02   -2.561746453632619e-01; +3.419863603622761e-01   +3.717995227738207e-01   +5.568598854196329e-01   +4.084781960915206e-01   -2.972496453216047e-01   -7.257509919022750e-02   -1.900332819553525e-01   +4.701090695443433e-01; +1.919408744514879e-01   +4.031089249780069e-01   +1.752077987253388e-01   -3.779519495677200e-01   -6.970332882139460e-02   -1.605559438575616e-01   -4.025081226252425e-01   +3.235475997922360e-01; +6.037942322651735e-01   +1.980248038135012e-01   +3.497187948104640e-01   -3.951616094692173e-02   -1.618297275351031e-01   -1.260706177053921e-01   -3.662643915640195e-01   +3.904255617835272e-01; -1.423190416724606e-01   +3.395131661015832e-01   -1.497104902381425e-01   +6.658732133132531e-02   -2.338261537997127e-02   +2.191255723185608e-01   +4.341580036600354e-01   +2.062618348706580e-01; -3.076808012683322e-01   -2.209977308025945e-02   +2.675219427766412e-01   -4.020174177829943e-01   -1.752705412917354e-01   -1.614073182801288e-01   +7.588895519323841e-02   +1.320979160992073e-01; -2.038435990820986e-04   -3.213491736987793e-02   +3.372343167303989e-01   +1.020446707249897e-01   -4.739730349728918e-02   +1.241491909609506e-01   +2.207871873534833e-01   +9.496320879762854e-02; -9.803914790057175e-02   +1.383710907305140e-01   +9.566823571355285e-03   +3.231611773589138e-01   +2.368452860904750e-01   +1.367242542073279e-01   +6.764478078422353e-02   +1.549214041961763e-01; +1.669487534418572e-02   +1.736473640266264e-01   -3.639922842712338e-01   +2.393837326614367e-01   -5.867385548513040e-01   -2.177140353824136e-02   -1.552901126773544e-01   -6.409371808535888e-02; -2.868021404701067e-01   +1.055474351217133e-01   -1.154832798173685e-01   +4.019962028230869e-01   +3.037722419544252e-01   +6.119400051959017e-03   +5.424365493225131e-01   +3.997834134275937e-01; -1.993894623281595e-01   -8.272938450176943e-02   -1.872799955802198e-01   +5.850632810620140e-01   +3.895975515502905e-01   +3.412239053674614e-01   +2.167675976745814e-02   -4.608171231496207e-02];
L1E_L2E_iAMPA_netcon = [+6.447829551354411e-01   -1.805137570140911e-01   -7.950735442522000e-02   +6.526760975481433e-02   -3.334785233664881e-01   +3.971735427802736e-01   +2.342100057870226e-01   +5.286668800936792e-02   +1.344411658662812e-01   +3.611010383239108e-01   +1.043706236135765e-01   +1.863374277329401e-01   +6.534322044713122e-01   -2.049658460839727e-01   +9.586880587017314e-02   -4.587840782889808e-01; -5.498925598140529e-02   -1.874094104975899e-01   +3.193587204294763e-01   -1.284826062704575e-02   -1.366825118879617e-01   +3.553168108892167e-01   +3.798438898196666e-01   -4.488551510686214e-01   +2.592412639298916e-02   +2.520909385280174e-01   -3.587233981995396e-01   -8.134410493288174e-02   +5.529771857411818e-01   -1.806520463860074e-01   +2.217456537831204e-01   -3.502462468901649e-01; -4.381007013790955e-01   -4.056948095153361e-01   -4.065740101545046e-01   +2.041239425690508e-01   +1.912263637935368e-01   +1.278067351960288e-01   +3.844414155989713e-01   -7.013587404447902e-02   +2.599807563744776e-01   -8.204769841284348e-03   -1.320057569503816e-01   -3.914413668408328e-01   +4.079382100622626e-02   -3.072583805224869e-01   +2.195726895208396e-01   +2.271695156104936e-01; +2.389868006105668e-01   -2.793874553322299e-01   +3.936709306345055e-01   -4.350420370065412e-02   -2.934548789327823e-01   +5.517339778468459e-01   -1.886184791101501e-01   -1.425883885174109e-02   +8.416858267724495e-02   -4.823354966859247e-02   +4.679454413554442e-01   -4.044381137030972e-02   +1.180515616457371e-01   +1.375585638178937e-01   +1.936007644980179e-01   -1.483181372456496e-01; +1.059387181528698e-01   +1.241400715260230e-01   +3.617593359807790e-01   +1.671303651717714e-01   +1.254632096705524e-01   +2.513644144348051e-01   +1.442209410702877e-01   -3.680108807662348e-01   +1.172012874105142e-02   -1.675876952209900e-01   -3.182806359203933e-01   -1.963103988299933e-01   -4.122368718037135e-01   +3.187162866379448e-01   +1.796826838450452e-01   +2.469833186208618e-01; +3.059861784508177e-01   -3.636225485936373e-01   -7.533960819144310e-02   -2.151930645700971e-01   +3.653186706970093e-01   -1.853287625198324e-01   -3.727872798977210e-01   -1.207362044587323e-03   +2.901050346207649e-01   +4.738450666450358e-02   +5.309151530119088e-02   -1.596333964708241e-01   +5.668658317851992e-01   -6.977971161554880e-03   +2.606087845006550e-01   +2.504855655798872e-01; +4.075198531077762e-01   +4.108324327215597e-01   +5.638263521888920e-02   +1.393227026079150e-03   -3.178762942154783e-01   +2.731050953384562e-01   +2.115948117572800e-01   -1.224670659774586e-01   +3.270441555296590e-01   -4.245206631084678e-01   -1.614187112757987e-01   +4.273300916324362e-01   +3.301345864751540e-01   +3.724675796631017e-01   +8.644057524609831e-02   -3.742124273273088e-02; +2.597119266384129e-01   -9.305717353400533e-02   +2.222166901276696e-01   -4.030253171519786e-01   +1.030139618676911e-01   -5.658648249404000e-02   -9.414856508749972e-03   +2.706733738891775e-01   -4.340535903544864e-01   -1.149833353187972e-01   +6.545918277753138e-03   +3.473392403054590e-01   +1.331108431939341e-01   +5.085623192999473e-01   -5.137353726690104e-01   -6.884736413274449e-02];
L2I_L2E_iAMPA_netcon = [+6.775829429111297e-01   +3.208507916209081e-01   +4.259908442821068e-01   +5.859861277952941e-01   +2.529034258696214e-01   +1.353826215618033e-01   -4.290164631045204e-01   +2.201864347953080e-01; +1.649128233991757e-01   +5.455635904737879e-01   -4.985110514325398e-02   +3.516629569219694e-01   +2.402753133250887e-02   +4.697015838311820e-01   +9.779500612448083e-02   +3.173964280339207e-01; +6.219572730361772e-02   +2.082136902050943e-01   -4.504339841534898e-02   +2.787521162091762e-01   -1.793786472271819e-01   +4.100251920952565e-01   +3.528007923525080e-01   +9.657246460293395e-03; -3.382809622562005e-01   +3.119633059441498e-02   +4.032244658585632e-01   +5.562209539695352e-01   +4.622787877543466e-02   +2.789227962434693e-03   +1.686026800955895e-01   -5.213133741277165e-01; +2.539875230196366e-01   +6.613656217485294e-01   -1.704330471425028e-01   -1.592783618186124e-01   -9.268569489625370e-02   +5.508200714081040e-01   +2.679632219374543e-01   -8.487778008454611e-02; +2.670762195766345e-01   +2.552428177019999e-01   -2.367560525352042e-01   -2.169660683338778e-01   +2.330368698438495e-01   +1.503011015019972e-01   +7.480063967471222e-01   +3.327553621922980e-01; +7.213058912718624e-02   -3.032263922741981e-01   +1.549512919931919e-01   +2.647338583347612e-01   +2.135887636459968e-01   -6.326760327320935e-04   -1.115835504016638e-01   +9.633172148697507e-02; +2.760392571215647e-01   +5.181672707080137e-01   -1.979160769885561e-01   +4.197716551432091e-01   +7.940806765265904e-02   +9.459229346845713e-02   -3.858209972274396e-02   +1.806785483250201e-01];
L2E_L2I_iGABA_netcon = [+1.212777299892038e-01   -3.545536939456218e-02   +4.733850009984847e-01   +3.362814843534222e-02   +2.208876982396994e-01   +3.436037581662382e-01   +1.471999126688744e-01   -7.558331837134977e-02; +2.514974134523567e-02   +1.834669549548931e-01   +1.460828146810209e-01   -4.186548902219473e-01   +5.859597970353693e-01   -5.608954881933196e-02   +5.033296009458971e-01   +6.501665467273682e-02; -1.136784981182089e-01   -4.296701062546453e-02   +2.182491375288997e-01   +3.629257862954797e-01   -1.455208221916053e-01   +4.260412170786485e-01   +8.334005202725601e-02   -1.648149489477881e-01; +2.589054719352998e-01   -1.432515779532739e-03   +4.592844224475444e-01   +3.632240819687294e-01   +2.916562047597629e-01   +1.141910916392781e-01   -3.699894347538305e-01   +1.906625287763170e-02; +1.521478469734778e-01   -1.408804466445890e-02   +1.100235341296062e-01   +1.362855921258987e-01   -6.483032975913526e-02   -4.204079972212710e-02   +3.460718398904888e-01   +4.022544959005878e-01; +3.711116693889703e-01   -4.439227505151583e-01   -1.992198124912919e-01   +2.623536494616242e-01   +2.323788430789869e-01   -2.711887751217889e-01   -2.739255669495100e-02   +4.403698826223340e-01; +7.615856738971194e-02   +3.605797584265571e-01   +5.877891110721398e-01   -3.463022740869373e-01   +2.749565439151767e-02   +6.041398058340668e-01   -1.628981906771232e-02   -1.067074232684460e-01; +5.513734950805869e-01   -5.488421082495736e-02   -1.022911421589763e-01   -4.910833589656216e-03   +3.336957212465241e-03   -3.803038633279406e-01   +8.011237100813862e-02   +5.557424345989488e-01];
L3E_L2E_iAMPA_netcon = [+2.758644448196134e-01   -1.455941933662198e-01   +1.247055651937993e-01   -4.120411717642746e-01   +1.295350967093394e-01   +1.912693234695008e-01   +1.697167637217976e-01   +5.582317331773512e-01   +2.776630128637925e-01   +4.139329621627536e-01   +3.782063368395461e-02   +6.310758171508826e-01; -2.146312501198045e-01   -8.721952657711263e-02   +4.999654643000188e-01   +9.604551089694691e-02   -2.150817179966041e-01   -8.943083727975153e-02   +1.075491664514970e-01   +1.624165440307437e-01   -1.638037938073056e-01   +1.417690932437453e-01   -2.536563614755356e-02   -3.197623612682668e-01; -9.275781653014084e-02   -1.180232731743386e-02   +4.582592820170988e-01   -3.291422093619545e-01   -9.546896740113613e-02   +8.407270943169101e-02   +5.732649185441743e-01   +2.397826120446264e-01   +4.811012865226957e-02   +2.299400983823283e-02   +3.647202079063577e-01   -1.883077050932190e-01; +1.879621121850877e-01   -2.700002840893518e-01   +5.059753267374028e-01   +2.474619679494948e-01   -1.867712031665063e-01   +9.596277743935824e-02   -4.945388769707718e-02   -2.848662157951941e-01   -1.818998827610707e-02   -1.295126242301059e-01   +3.056111735346562e-03   -2.595386590807887e-01; +5.787841469715362e-01   +6.675963205976039e-01   +5.361396805037759e-01   -2.290185761760709e-01   +1.371882181317434e-01   +2.273036040434523e-01   -1.724577258624020e-01   +3.614798363432782e-01   -3.633451456788901e-01   +2.126646037938000e-01   +2.839125644164127e-01   +5.369443820108546e-01; +3.397907897568866e-01   -6.238405448277735e-02   +2.714706938413657e-01   +2.319629987050481e-01   +3.457990893185140e-01   +5.273612392226130e-01   -1.350776840521521e-02   -3.526484790096607e-01   -3.172856946066161e-01   -1.549815960989453e-01   +2.032678060036700e-01   -2.211756877314284e-01; +3.607819956910039e-01   +2.238153528598047e-01   +1.167739846956355e-01   -2.214512990791406e-02   +5.344559297915942e-01   +2.784160640626672e-01   +5.029333361758641e-01   +1.372769304079314e-01   -1.725982063892484e-01   -1.188791379006666e-01   +9.655068350746049e-02   -1.630051411358063e-01; -4.984471745289925e-01   +2.817953088242772e-01   -6.662385847920438e-02   +8.383244821180422e-02   +1.578130730337041e-01   -1.240376475437533e-01   +1.838017529707307e-02   -8.944378558741957e-02   -4.445906770314342e-01   +5.014609844992782e-01   +2.506472181894370e-01   +6.110586446012829e-01];
L3I_L2I_iGABA_netcon = [+2.910319097281172e-02   +8.031766523700736e-01   -2.015619669999514e-01   -4.099496526950457e-02   -1.535943812205135e-01   +1.884032374469555e-01   -3.043161950627953e-01   +2.452837907148223e-01   +2.404747717617339e-03   +2.501409717043337e-01   -1.762564485930262e-01   +3.425297920769362e-01; +1.723715347071093e-01   +2.880810339648304e-01   +2.142379956787730e-01   +3.516516453315029e-02   +6.703174924378691e-02   -9.116686568210877e-02   -4.102818019670562e-01   +2.605008409016886e-02   +2.181067940994462e-01   -1.611491528942639e-01   +4.432873354373503e-01   +1.237258310137943e-01; +4.699181849779629e-01   -4.671090171149462e-02   +2.352688147471526e-01   -2.289707780020055e-01   -2.970061025755640e-01   +3.259262831485896e-02   +6.066533926521001e-02   -7.227002600118493e-03   +2.501458783168228e-01   -1.270465794677506e-01   +3.242297468278801e-01   -1.745910303215980e-01; +4.521595576145280e-01   +3.690987764473685e-02   +6.877554799248647e-02   +2.123757242367888e-01   -1.073935638202630e-01   +3.840132948729038e-01   +1.695468094556413e-01   +2.944181595764491e-01   +2.105678367845848e-01   +1.267609406744015e-01   +2.356583500627064e-01   +3.913489860705816e-01; +2.928668717622590e-01   +5.327385933693956e-01   +7.065471903009002e-01   +1.569698572373470e-01   -2.991130899328701e-01   -2.027943008648320e-01   +1.048678293559146e-01   +1.801426055751097e-01   +6.733291824915237e-02   +3.791477621167144e-01   +1.552194514146772e-01   +2.661065715522244e-01; -1.746827698318764e-01   +1.211149221494738e-01   +2.970754826600838e-01   +1.724121520779507e-01   +7.290254813860493e-01   -6.027308484377136e-02   -5.276317460666188e-03   -1.325961729016044e-01   +3.110418992491818e-01   +3.675033289133584e-02   +2.421789738005957e-01   +2.848332627812602e-01; +8.234551156456149e-02   -1.720647065881016e-01   +5.032932901313506e-01   -3.501601721716291e-02   +3.567488141781480e-01   +1.692167950822647e-01   +5.284590049931106e-01   +5.829198158655808e-01   +4.383398187338285e-01   -1.437472570760724e-01   +1.888375626976322e-01   +6.493818455253629e-02; +3.644518146879189e-01   +8.997583079884100e-02   -2.588529491189975e-02   +2.640336757759817e-01   -2.301396533547417e-01   +2.155188678177304e-01   -5.053196079371400e-02   +1.239923898191637e-01   -3.592537504854003e-01   -4.679463926356728e-01   +7.163543950225830e-02   +1.527220026100169e-01];
L2E_L3E_iAMPA_netcon = [+3.347108112527925e-01   +5.285775811721516e-01   +2.537117233935623e-01   +3.962868426599631e-01   +4.249223920308159e-01   +3.287480093106365e-01   -4.261664295522178e-01   -2.229221775709213e-01; +8.785159979617588e-02   +3.027844717979319e-01   +4.029388027316531e-01   +2.002788526300225e-01   +2.685408235503494e-01   -1.757217242867518e-01   +2.707696914718783e-01   -3.338174737073171e-01; +3.088092707561649e-01   +3.097847126977086e-01   -6.207380608856566e-02   -1.521067897634889e-01   -1.264588898372487e-01   -3.281129014496261e-01   -2.209154260103292e-01   -3.966236750996222e-02; +3.404844073218087e-01   +5.362528810033722e-01   +6.435093346259455e-03   +9.865234782665627e-02   +5.459557274179987e-01   +6.264280180826939e-01   +3.196115779216437e-01   +3.305628828600377e-01; -1.170457276011329e-01   +3.953415174757077e-01   -1.065592916627400e-02   -5.391220651087505e-01   -2.536293303884529e-01   +3.946169804807161e-01   +5.094154186398855e-02   -3.884670896637257e-01; +1.690456118673919e-01   +3.287389126059330e-02   +2.199133449540674e-01   -5.597300081507778e-02   +5.401883334829741e-01   -2.034932740386081e-01   -6.045625227785559e-02   -7.871720769620749e-02; -1.351533664410303e-01   +1.342979307929918e-01   -4.811331797520891e-01   +3.447943097101248e-01   -8.837738190129230e-02   +3.376887721512736e-01   +1.881790247438693e-02   +3.904177575207752e-01; -9.491748897158628e-02   +3.674337415798443e-01   -3.454617033345421e-01   +4.042042349904494e-01   +7.840399927389516e-02   +3.396360259849728e-01   +1.858954144793383e-01   +1.682594857261709e-01; -1.152064860980126e-01   -1.113698688279375e-01   +5.073857671108475e-03   +3.734283273835147e-01   +1.568678475359441e-01   -4.607892914186758e-01   -5.310330816032707e-02   -1.713309320839400e-01; +1.767765663119824e-01   +4.832473408939378e-01   +4.496353034952574e-02   +1.538018518185910e-01   +3.165448767245400e-02   -1.679242490838112e-02   -1.203125619264482e-01   +6.568734483298553e-01; +3.181893852305392e-02   +1.001116729051080e-02   +2.751174143764736e-01   +6.510222197176380e-02   +4.267417326550783e-01   -1.112492241581215e-01   +4.053334696771221e-01   +6.290608672884503e-01; +3.706034890515364e-01   -1.098793711200446e-04   -1.478122067882764e-01   +2.838637910961121e-01   +3.839690437479783e-01   -8.605017857554875e-02   +3.418533567084826e-01   -3.952364337635649e-01];
L2I_L3I_iGABA_netcon = [-3.556410252637632e-01   +1.363757782677968e-01   +3.722061124219972e-01   -7.637667710340568e-02   +6.515774659799926e-01   +5.902449405671188e-01   +1.620311863762400e-02   -3.542595464445794e-01; +2.293707330294764e-01   +5.512491988748501e-01   -4.263409665406389e-01   -4.834110370373835e-01   +1.726593011603109e-01   +3.679819043545081e-01   +1.697467434848714e-01   +7.645128628523234e-02; +5.372665850240893e-01   +1.245276200062985e-01   -3.317565149112572e-01   +3.852188582814695e-01   -1.230956808320746e-01   -2.994146790138961e-01   +1.608326383537849e-01   -2.322823809113800e-02; +1.823508664701304e-02   -9.163036088019594e-02   +1.026781460777926e-02   +2.382449851195524e-01   -1.781628705968401e-01   +4.655860790591995e-01   +5.964727786435423e-02   +1.723950730018345e-01; -1.876340595635392e-01   +3.448186263468633e-02   -2.553150511672242e-01   +1.430222847395203e-01   +2.582638616485920e-02   -4.840990022995992e-01   -1.117797332502919e-01   -1.188562271950392e-01; +1.181741211780982e-01   -5.088706640493346e-02   -3.747546174569539e-01   +8.937801889748720e-02   -4.032955576217501e-02   +2.129504186339799e-01   +4.741220227738702e-01   +1.935054629322194e-01; +3.903952135615721e-02   +2.834787527325804e-01   -1.999896649146030e-02   -3.440733477626046e-02   -2.137897277109228e-01   +3.931659493251295e-01   -1.469987789892550e-01   -1.798169185599985e-02; +2.383483783608081e-02   -9.531748834032192e-02   +9.266407125829088e-03   +1.667074687831595e-01   +3.365128698004133e-02   +1.581048136072825e-01   -4.888816528894660e-02   +4.559943518581036e-01; -3.887335759320213e-01   +2.634026578601315e-01   -4.950314040384447e-02   -3.073820727987983e-01   +5.432809350359729e-01   +2.535209987121821e-01   +1.452607491857016e-01   -1.213775402610599e-01; +1.634912773211083e-01   +5.744115582560503e-01   -2.202787621008132e-01   +4.971211702497687e-02   -2.352761301610639e-01   +4.466432825596084e-01   -1.067791212029640e-01   +4.377555143536033e-01; -4.741090129185299e-01   +1.039868588192047e-01   +1.380692764913765e-01   -1.175381689909771e-01   -5.118033497774505e-02   -3.137176316987042e-01   +2.576285591295238e-01   -1.614592404112252e-01; +1.951662446847866e-01   -5.226701734903995e-02   +1.104283007100111e-01   +5.492866924093206e-01   -3.173308344317227e-01   -1.337833450784756e-02   -1.946039198673246e-01   +1.541994718674738e-02];
L3I_L3E_iAMPA_netcon = [+1.558836020939900e-01   -4.330155175761726e-01   -1.082521468572090e-01   +5.783049787571153e-01   -5.767775362715939e-02   +1.728153513300454e-01   +3.621938367806921e-02   +1.970720382679750e-01   -1.607228646069540e-01   +1.945179760962224e-01   -2.191678699822029e-01   -2.376310405149093e-01; +2.154910605301651e-01   -2.070442689845515e-01   +3.094092202177586e-01   -4.275596176882601e-02   +3.356023283288906e-01   -3.136362741972177e-01   +2.794286969753774e-01   +5.005416965880316e-01   +1.780732666883818e-01   +2.564192829033251e-01   -3.874388029254846e-01   +3.795517002437175e-01; +5.203996165437778e-01   -1.834150840281589e-01   -5.037973343462392e-01   -3.497468719104094e-01   +1.014831080917175e-01   +5.210202079074945e-02   +4.649428388488159e-01   +1.255428030667759e-01   +2.545895749431312e-02   +1.230528651342392e-01   -8.616405924180101e-02   +2.788123619588730e-01; -2.895605467157133e-01   +5.990834064998365e-01   -2.479495757637947e-01   +2.297982676834454e-01   +5.330386207862764e-02   -1.063787238044190e-01   +2.269344887070132e-01   -8.817790809368516e-02   +1.260581553437990e-01   +1.996883458625709e-01   +4.736163006204869e-02   +3.394634013067224e-01; +3.698643909593639e-01   +3.442871254497238e-01   +6.321110839306795e-01   +1.138870995794655e-03   +4.635440159959739e-01   -2.954364137086514e-01   +2.530734251728459e-01   +2.258401456660886e-02   +3.488974465144273e-01   +9.280430896503400e-02   -1.650597768968949e-01   -1.672621044482072e-01; +3.994101092068595e-01   +4.168242058905220e-01   +6.906833272616025e-01   -5.319512156917616e-03   -2.313483742999002e-01   -3.092495681778266e-01   -1.484074810638168e-01   -8.698538515718283e-02   +6.235471594452966e-01   +4.767887355061304e-01   +2.062690162901613e-01   +5.961920277557299e-01; +3.222672853209042e-01   +7.591146445815020e-02   +5.678765396049994e-01   +3.771529900255803e-01   +9.124271175394272e-03   +2.490852796245294e-01   +5.621740397387724e-01   -1.164716312598026e-01   +2.782505461590795e-02   +1.450724033169306e-01   +3.370428243557511e-01   +1.257962142050580e-01; -2.484900437076764e-01   -1.124584537917754e-01   -1.399296876874789e-01   +3.846552975177833e-01   +8.292713801853166e-02   -5.073432877110767e-02   +2.133656815119414e-01   +3.853683124108453e-01   +8.721027521165445e-02   -6.300855907770325e-02   -3.322048853376518e-01   +5.191268449160413e-01; +2.057370282121567e-01   +2.255683082139791e-01   -1.487418060734497e-02   +4.982040154031029e-01   +2.597420258491271e-01   -1.457227219387650e-01   +2.587755472780284e-01   -3.217881066573858e-02   -1.804920452356010e-01   -2.454621680454061e-02   +2.079779539294716e-01   +2.030647380113993e-01; +4.489127830502486e-01   +2.050155790514484e-02   -2.908938515347600e-01   -5.991265353618676e-02   +2.115188814087556e-01   +7.280934017984272e-01   +5.018499570780690e-02   +1.838618052647113e-02   -1.482735600034353e-01   -2.984777228696069e-01   +1.780612599847816e-01   +2.499513315850615e-01; +2.755271231751303e-01   +3.411352018144563e-01   +1.832669669457260e-01   -6.929443595718160e-02   -2.193250319242479e-01   +2.818904948542986e-01   +2.379300167496268e-01   +1.643668905255386e-01   +1.759592639239325e-01   -2.896908378185687e-01   -2.179707662909620e-01   +1.443181572259755e-01; +4.488112404348788e-01   -3.091288436491539e-02   +4.778598906456875e-01   +1.760249309950807e-01   +4.215794762943225e-01   -3.661031094893497e-01   -2.015802209393154e-01   -2.831343483124045e-01   -1.320038673468333e-01   -8.392423966932072e-03   -1.475205612081634e-01   +1.371809701740048e-01];
L3E_L3I_iGABA_netcon = [-2.174417735365279e-01   +4.347640623004668e-01   +9.472169303436406e-02   +2.592808956546034e-01   +6.949840855010295e-02   +2.301433304996413e-01   -1.304731902314115e-01   +5.599685595210578e-01   +2.418757809932254e-01   +4.697844815654528e-01   -2.413261203436442e-01   +2.300138563574389e-01; +3.478150593085230e-01   +5.002725634196461e-02   -1.644377855056922e-01   +5.127239991011281e-02   -2.021876875844761e-01   -3.696936697970257e-01   +2.153574976232759e-01   +2.599460385247073e-01   +2.361501415399408e-01   +1.076630603798129e-02   +5.163194939446736e-02   +2.075735359357138e-01; +1.181851372547338e-01   -4.133027545429091e-02   -1.201810798348508e-01   +4.663046552836156e-01   +2.327486441079487e-01   +8.520640977571290e-01   -3.121012771888064e-02   +2.637879396781149e-01   -8.919041040596415e-02   +1.544303601359791e-01   -1.205317843207587e-01   +5.935485411065979e-02; +1.014783611301796e-01   +7.317381553496201e-02   +3.777132202414660e-01   -3.881081012009642e-01   -2.169054576046784e-01   -9.451352474335498e-02   +8.087372741464079e-02   +5.975483041599685e-01   +1.506071093853228e-01   +1.363419485973924e-01   -3.073966109112088e-01   -6.577029452160049e-02; +4.153803481744003e-01   -3.721350196745243e-01   +4.842278876346574e-01   -4.083293310460713e-01   +1.000930958753972e-01   -4.005293571629123e-01   +3.121106200488517e-01   +4.361648753644475e-01   -8.095302127093404e-02   +1.122471040048288e-01   -4.276656228678486e-01   +1.593468602064053e-01; +2.856258434003340e-01   +1.823456293771570e-01   +5.541918922344742e-01   +8.849076516083899e-02   -2.363294219641737e-01   -9.606126280203767e-02   -9.357314634953021e-02   -1.017525617704043e-01   -4.956562457519896e-02   -1.804084655090311e-01   +1.733610350530333e-01   +2.222753111896316e-01; -5.682792706666044e-02   +5.279743237836111e-02   +1.269466087965952e-02   -2.914418859684425e-01   +5.758287662317135e-01   +3.784097375420694e-01   -1.490600400908619e-01   +2.058081911127722e-01   +5.562078186374060e-01   -1.353535528888905e-01   +2.160883932256015e-01   -2.302468951992951e-01; +1.317039776561441e-01   +1.016568769949462e-01   +3.060580084743623e-01   +1.242276748077542e-02   +3.055329428502928e-01   -4.863977033966516e-03   -5.451844214833457e-02   +2.669415606772700e-01   +2.986027385656989e-02   -1.027422724457616e-01   -1.442304360085397e-01   +1.293225529645031e-01; -3.725559326867375e-01   -1.608953230189705e-02   -3.288289707479253e-01   +1.970018291883434e-01   +6.342987744471951e-02   -3.736613736954528e-02   +3.008691204839232e-01   -3.947608913822775e-01   +3.099306116094081e-01   -1.980375646258070e-02   +3.136620540464695e-01   +4.876849345897311e-01; +1.613135102586182e-01   -1.724484442868024e-01   +6.760132042285110e-01   +8.299393956425860e-02   -2.428925697178650e-01   +3.887082332042456e-01   -9.389951898613853e-02   -4.408362614087794e-01   -4.099482129835366e-01   +5.633769827652372e-01   +1.401669563592201e-01   +2.352634941439015e-01; +6.117383753579743e-01   -2.874240896771104e-01   -4.690817502278954e-02   +1.314400254874789e-01   +2.807225154468564e-01   +2.985116577832403e-01   +1.706062207850077e-01   -2.509499332650751e-02   +6.964851443243715e-02   +9.551312796473893e-03   -1.324926643318733e-02   +1.918324331285471e-01; -2.525746989649068e-01   +2.854976225774380e-01   -1.561951260551194e-01   -1.081214412670743e-01   +3.409908928227848e-01   +3.906530392719275e-01   -4.183636646907962e-01   -1.090711478222109e-01   +4.697092763878880e-02   +1.524738266806763e-01   +9.421157040848965e-02   -1.032850465318954e-01];
L2E_Input1_iAMPA_netcon = [-2.899001085322840e-01   -1.332301275455956e-01   -1.445489264784145e-01   +3.276294731858557e-01   +1.926673910035864e-01   -1.325736516706679e-01   +7.395667291471397e-01   +1.120460939092268e-01];
L2I_Input2_iAMPA_netcon = [-1.446221374997934e-01   -1.140590703543634e-01   +6.315703544142409e-02   -1.178773039839832e-01   +3.012113341686935e-01   +1.149627756611628e-01   -1.990314784434537e-01   +6.627222873383980e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
