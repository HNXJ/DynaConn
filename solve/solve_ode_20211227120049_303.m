function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-9.119364467643137e-03   -8.746225208245728e-02   +2.253207902426262e-01   -6.762437175660999e-02   +2.406297255565541e-01   -2.674061241029081e-01   +1.912688659010471e-01   -1.564854636822816e-01   -2.745256801026940e-01   +1.713385305660197e-01   +2.943626017787063e-01   +1.821275230045320e-01   +1.306465621882231e-01   -3.486691361993510e-01   +4.862629165153395e-02   +2.869891035744029e-01; -3.404446875925300e-01   +2.595702471567156e-01   +1.623930890336818e-01   +1.736909665646004e-01   -3.599308084226042e-01   -4.612673046932442e-03   -1.531133669598254e-01   +3.628066170791009e-01   +6.924549309015010e-02   +5.004492430895405e-02   -3.059473367607800e-02   -1.856770752479224e-02   +6.119144034348249e-02   +1.303607172126743e-01   -1.001146482959773e-01   +1.122866661777080e-02; -1.434600668574933e-01   -3.518803878499902e-02   -1.459147215553067e-01   +1.902930300549373e-01   +4.533076297844435e-02   +1.399894671191573e-01   -3.589876219600108e-01   -3.781540912380241e-01   +2.359265067601157e-01   -1.884049192792744e-01   +1.316248748296509e-01   -1.251603350918191e-01   -1.420490008205058e-01   -2.323789017381914e-01   -1.444057367244700e-01   +4.357827071514916e-02; +1.506347429114350e-01   +6.521229217216507e-02   -2.125593929657674e-01   +4.777593241101249e-02   +1.722615360016772e-01   -3.939293012249942e-02   -1.648246106555684e-01   -1.479473525002116e-01   +1.108721252973529e-01   +3.008042847245274e-01   +2.748398405718224e-01   -1.288660678596700e-01   -6.918769442540151e-02   -5.710276775993192e-02   +9.939936742776975e-02   -5.537681104287781e-02; +8.455836345375538e-02   -5.169495599089255e-01   -1.994853076446674e-01   +7.743183803476703e-03   -5.751548954858310e-02   -3.856748203361425e-01   +2.161115605315080e-01   -5.736881919628722e-02   +5.464675863369109e-02   -1.750532443064389e-01   +6.489175029163136e-02   +4.848213648902450e-03   -1.765243461564335e-01   +2.664629116351273e-01   -8.416049126710373e-03   -3.095936135818938e-02; +3.266497906872520e-01   +3.328515342702860e-01   -1.512053770058256e-01   +2.263975243729816e-01   +1.018758460159234e-01   +2.526765414480612e-01   +9.500730423998502e-03   -3.876184216865081e-02   +5.211773928345409e-02   -2.557660284575143e-01   +3.181445546000216e-01   -1.936949402055598e-01   +1.827710663769766e-01   +2.416858964952838e-01   -9.002468458147364e-02   +1.519756408102982e-01; -1.239435301864778e-01   -5.212963078833205e-02   -9.790920968357994e-02   -8.029036119267910e-02   +2.765080188291136e-04   -5.107479733276736e-01   -2.049130303161614e-02   +2.406779443946168e-02   -1.362234981843877e-03   -3.340979484466338e-01   +2.175891211543183e-02   +1.145416196022333e-01   +2.424583345792252e-01   -3.985902994784630e-01   +2.125915540121703e-01   +8.206765999398971e-03; -2.339537812982281e-01   -7.427005090986745e-02   +1.852607613876205e-02   -1.099031579756833e-01   +2.696822568311728e-01   -1.583622269413491e-01   +4.001046292378315e-01   -1.250703840818861e-01   +1.015292512766250e-02   -9.028213844283309e-02   +4.697042533244457e-01   +2.529949331665503e-01   -9.154073333257397e-02   -3.094296620015502e-01   +1.514803759135281e-01   -4.442612270136397e-02; -3.389130556555380e-01   +2.327561578151983e-01   +3.952041372413423e-01   -2.338079725813840e-01   -2.527843203573742e-01   -4.116215472009969e-01   -1.677554199179644e-01   -1.953174088603482e-01   +1.360471526333926e-01   +7.097892201277553e-02   +9.795802488244863e-02   -5.290515682973626e-02   -1.778609043306860e-01   +1.442737515722820e-01   +2.845787137714967e-02   +1.493706103425537e-01; -1.076569942246981e-01   -1.285933180221348e-03   +4.040888212516580e-01   +4.476522033452465e-01   +2.198152000945878e-01   -8.878984183520516e-02   -4.126389602955172e-02   -5.008810076368134e-01   +1.695541646801283e-01   +1.195241749767711e-02   +1.463444126900522e-01   -1.172625775159400e-01   +7.074877755894252e-02   -2.435782523011729e-02   -2.187302701658383e-01   +6.775510533418370e-02; -3.370540721834621e-01   +1.865860468849500e-01   -2.688418621249407e-01   +1.754326004613642e-01   +8.324483579335450e-02   +1.964666937611127e-01   -1.536811557172854e-01   -1.049837426624308e-01   -8.085935747763449e-02   -3.850475142274482e-01   +2.678267587099073e-02   +1.687913244462538e-01   -2.533547809962769e-01   -9.395482264690047e-02   +1.210737284544094e-01   -6.583188815745754e-02; -1.471627380552284e-01   -1.772777288656943e-01   -8.919475698301862e-02   +4.443852156560881e-01   -6.738306857746554e-02   +2.542240732526309e-01   -1.540516739352281e-01   -9.148577380658471e-02   +5.729927363108706e-02   +5.054249379042957e-01   +1.436196791610270e-01   -3.692705168133130e-03   -1.666704711080323e-01   +1.758137485130660e-01   +1.177978152031954e-01   +1.949503754265998e-01; +7.822346053967667e-02   +5.837077539339571e-02   -1.778734745508492e-01   +1.360580532985810e-02   -3.034069598694772e-01   -1.025788613560678e-01   +1.411298713523098e-01   +6.286601682878515e-02   -2.360851097681396e-02   +1.477889435404180e-01   +1.931911720618772e-01   -1.779883846870457e-01   -3.569883366739955e-01   +8.983662852759905e-02   +2.178281991707963e-01   +1.237380168185661e-01; -4.138509171326096e-02   -3.067547808033105e-02   -2.864079344031824e-01   +8.364091271828167e-02   +2.953258673326398e-01   +2.260542372873873e-01   -3.585994640932141e-01   +2.779738602194047e-01   +1.291537530129280e-01   -3.408103515950653e-01   +3.662876154597503e-02   +2.616437553067386e-01   +2.373854696206733e-01   +6.574809031239344e-02   -2.786499504303004e-01   -2.596262353132835e-01; -1.053239452600918e-01   -2.158227694732610e-01   -3.206410792722343e-01   -5.219138742210347e-03   +4.585505383777468e-02   +3.016063065651573e-01   +3.400944687303153e-01   +3.742228977068139e-01   -7.914924549444585e-02   +9.055109267195494e-03   +3.137812574662496e-02   -1.169958775385497e-01   +1.638821517600694e-01   -3.275489067104413e-01   -1.282619148415684e-01   -1.900279711755690e-01; -1.789675360863670e-01   +1.268648958193680e-01   +5.704913184159979e-02   -6.074473702295784e-02   +2.727921929039282e-01   +5.915151372553525e-02   +1.031546251154676e-01   +1.151108172020338e-01   +7.263316816045541e-02   -4.256147724049245e-01   +1.100777838981458e-02   +1.408562282593220e-01   +1.375287461218017e-01   -4.535170484203194e-01   +1.286061980955897e-02   -2.444037813327735e-03];
L1E_L1I_iGABA_netcon = [+1.673807139320121e-01   -1.695379335976116e-01   +1.211863610704439e-01   +1.684793497898078e-02   +2.410328263868282e-01   +4.542119827917148e-01   -3.673468073655349e-01   +5.002419223259932e-02   -1.055009392008150e-01   +1.438130803307828e-01   -3.451455686279448e-01   -1.141988499730456e-01   +1.687245248275341e-01   -2.086040666658284e-01   -2.414875237128159e-01   -1.738854559069177e-01; -2.700365256493832e-01   +6.925012931676483e-02   +2.224712040254230e-01   -1.528707969379252e-01   -5.875954686130944e-02   +2.098298205701875e-01   -3.082266399031033e-01   +5.887413236414382e-02   -2.651901232993809e-01   -3.665164550249157e-01   +1.182859029803531e-01   +2.633836510190553e-01   -2.110777914547738e-02   +7.715912305536221e-02   -1.336396094930815e-01   +2.623351054170999e-01; -5.906423177698139e-02   +4.065128169363910e-01   -9.077972627638714e-02   -3.443023810308658e-01   +3.201139720605088e-02   +1.758461354818110e-01   +2.862957336930028e-01   +3.211215163155868e-01   +9.196836249467963e-02   +1.965692313570138e-01   +3.041062914325879e-01   +1.405385033104634e-01   +1.119657400996551e-01   -9.352351512902184e-03   -3.990415197484892e-02   +2.718922184763239e-01; +1.121642140673532e-01   -1.981355046215595e-01   -3.590274458296238e-01   -6.905262617502461e-02   -2.525190351776788e-01   -4.199293996614321e-02   +2.114853801577110e-01   +2.782129666923601e-01   +1.213536553293565e-01   -7.273045440422249e-02   -3.898849412534845e-02   +2.499273421173874e-01   -1.108915858432321e-01   -1.819339378811057e-01   -2.215742164388511e-01   -6.884139805377512e-02; -2.341697095200541e-01   -5.120459065991601e-01   -4.512912369599562e-02   -2.627111844397054e-01   -1.245041548837612e-01   +7.679684874557413e-02   +2.702919204021210e-01   -1.270648316228633e-01   +2.315889039616281e-01   +2.545363700088692e-01   +3.664017204180609e-02   +1.179398312348038e-01   -8.946134160896610e-02   +9.629031067343997e-02   +1.706187669360876e-01   +1.095227333887480e-02; -2.449831407572481e-01   -5.551966275062317e-01   -2.102061249535661e-01   -7.852462078208711e-02   +1.132095964566143e-01   +1.845069553019566e-01   -1.543150242274555e-01   +1.571532739167308e-01   -1.268394770845605e-01   -1.847212350811423e-01   +1.189188659881799e-01   -1.178912385535469e-01   -4.014126449595072e-01   -1.114585352927479e-01   -4.463396348623842e-01   +1.307009443831259e-01; +3.117487496338556e-04   -6.657997683468433e-02   +4.714545004854812e-02   +3.401572562150848e-01   -3.511028541511258e-01   +7.257159431367702e-02   -5.266143728836824e-02   -2.588373424876246e-01   -1.917555660921938e-02   -1.469019466207951e-01   +1.175610065968289e-01   +2.337458547397916e-01   +4.403490280743699e-02   -5.174682636950363e-02   +1.419694111267678e-01   +7.233520105273952e-02; +1.816231284334385e-01   -8.384726251419278e-02   +3.262326875313920e-01   -1.596025242733310e-01   -1.840598181568121e-01   +3.872020456407948e-01   -1.696690303481127e-01   +1.665176866087016e-01   -9.255145245098120e-02   +1.337401177392508e-01   -3.485804094532853e-02   -9.856436672656667e-02   -2.513482939022364e-02   +2.063557923162639e-01   +2.270862657360283e-01   -3.535786383882463e-01; -3.527525116407844e-01   +3.363633837731613e-01   -2.662685552041460e-01   -1.361452248093245e-01   -3.073867506690687e-01   +2.855640290849127e-01   +1.324222468151334e-02   +4.196914901871839e-02   -3.870174394467290e-01   +3.453457752327296e-01   -2.086086979095859e-01   -7.108995022164701e-02   -2.145302802629068e-01   +6.215190510981725e-01   -3.752119273972044e-01   +1.523814163207292e-01; +8.645698225461124e-02   -7.925317139188562e-02   +7.157979504481198e-02   +4.656486717321463e-02   -1.879012803495239e-01   +2.461082424661563e-01   -1.390838129384684e-01   -4.933684293739318e-02   -2.097464906498410e-01   +6.343344710476885e-02   -1.535562065089762e-01   -1.755032407718474e-03   -4.141996762244138e-01   +2.146641899827035e-01   -2.131153423023141e-02   -3.748831746339708e-01; +1.341096390117551e-01   -3.248965562994021e-01   +8.955865067646605e-02   +1.478711401277175e-01   -4.475484807539129e-02   -1.107632047465455e-01   -1.359033328693450e-01   +1.872424786646831e-01   +1.512670376771564e-01   +1.526172910969938e-03   +4.519668579536535e-01   -9.907904782808509e-02   +9.001002675757586e-02   +5.193389432572438e-02   +3.079790958926034e-01   +3.009901251641017e-01; +2.451290682187486e-01   +2.655706785729327e-01   -1.313262966917423e-01   +3.152252589727965e-01   +3.868426030316338e-02   +8.632364771626796e-02   -2.706372829517193e-01   +5.182778455269385e-02   -1.897581944661900e-01   -7.419969892596055e-03   +3.187039418286483e-01   -9.980736677610473e-02   -7.903229107878246e-02   -3.656130535848766e-01   +2.324177144378271e-01   +1.456028969030688e-01; +2.298280468009940e-01   +1.149245152813089e-01   +1.445207803806408e-01   +4.172548390503458e-01   +2.709770684629142e-01   -1.416630976518590e-02   -2.100926722673186e-01   -1.824388955727415e-01   +2.197517778268011e-01   -5.170696486474888e-02   -6.602490162342664e-02   +2.830252498354762e-01   -1.377772678502211e-01   +4.106390533609536e-02   -3.460452973450077e-01   +8.748253730578251e-02; +5.776290421030181e-02   +2.807075963787700e-02   -2.406469116887646e-01   +1.045891222539540e-01   -1.883532664068854e-01   -7.199297681358814e-02   -3.282087348318866e-01   -1.551191800194477e-01   +6.219462942978336e-03   +1.564244288255091e-01   -1.120323426374273e-02   +2.819158178059880e-01   -6.531167309626085e-02   -1.102344820807570e-01   +3.982857573857250e-02   +9.778920425166399e-03; -5.657654130259067e-02   +2.088638477324608e-01   +2.115830753546923e-01   -4.615434518541857e-02   -2.384836541198766e-01   +3.710760218582852e-02   +2.590689958946049e-01   -1.866111409112001e-01   -4.602352085047483e-02   +2.469203166076696e-01   +3.748478300409956e-02   -2.592297355415691e-01   -7.115016970594951e-02   -9.350036531354231e-02   -1.810888900046079e-02   -1.685872084003003e-01; +5.069862767004533e-02   -1.841258848783803e-01   -9.763475317822609e-03   -9.302280587272599e-02   -1.569141490358434e-01   +2.412876067261700e-01   +5.150267098929774e-02   +1.094592621771009e-01   +2.961636977331585e-02   +3.425007516169172e-01   +8.562283011666441e-02   +5.254868612436048e-01   -1.642925256597899e-03   +3.551460321240640e-02   +1.577022232355443e-01   -3.022748898672033e-01];
L2I_L1I_iGABA_netcon = [+4.075793622952987e-01   -1.988645059473915e-01   -1.679363673868064e-01   +2.871426770968738e-02   +7.740699349888303e-03   +1.897434595837466e-01   +3.868299425545345e-01   -1.145433782649224e-02; -2.550497647109641e-01   -2.507029557659501e-01   +1.432870300352315e-01   +2.465011895384396e-01   -1.640560848255734e-01   -3.066005186398822e-02   +2.634473225922371e-01   +6.423401216062166e-02; +7.935746065194738e-02   -2.256388360826710e-01   -6.796813307501351e-02   +1.023417606866896e-03   -6.888208386122928e-02   +1.147896931201397e-01   +2.907991460894621e-01   +2.086831034814648e-01; -4.197478052155795e-01   +3.332027017043094e-01   -9.549069620164423e-02   +1.389638265678427e-01   +1.801208183027853e-01   -2.744596360327517e-01   +5.712664233900924e-02   -2.751009492689949e-01; -3.944240704111296e-01   +7.621678392267860e-02   +3.629616928121156e-01   +1.605434837766559e-01   +3.622614649469231e-01   -7.833041534221445e-02   +2.435471265190955e-02   -3.780580331744107e-01; -2.221870710326248e-01   -2.485957342254871e-01   +1.451987851982431e-01   +1.406562851806308e-01   +9.283381565898242e-02   -9.342430915500355e-02   -1.628764185259964e-01   +1.738789426416439e-01; -9.259134648941310e-02   -4.665118970922750e-01   -1.109749151017724e-01   +2.836713273729474e-04   +1.782857476668360e-01   +4.473383925756661e-01   +3.389428370157247e-01   +1.308618227301450e-01; +3.730399387241399e-01   +2.341290147068252e-01   +2.827603884500801e-01   +1.537810679229678e-01   -1.668585866472590e-01   +1.839783528135803e-01   -9.245768170118837e-02   -6.409981420743863e-02; +2.744218919239096e-01   +1.757690079466000e-01   +2.552102950401477e-01   +1.402864557576939e-01   -2.223880672837525e-01   +5.325590061535461e-02   +4.262773077125567e-01   -7.869675581618422e-02; -2.266627972657294e-01   +1.752011870591293e-01   +1.581245427920715e-01   -3.339938187600808e-01   -2.291570963353992e-01   +2.918565957855548e-01   -1.420503191218452e-01   -1.798166731749118e-01; -5.025274721757753e-02   +3.065821618655552e-02   +4.117662855585875e-02   +2.316925370200444e-01   -2.840464694191657e-02   -2.312381953156611e-01   -1.210200710364292e-02   +2.845567015923206e-02; -1.002000277796124e-01   -1.468291242686575e-01   +6.948763762913307e-02   +2.275045258268649e-01   +5.411618291243234e-02   +1.021959410160695e-01   -1.713978416463919e-01   +2.133974466500422e-01; -1.648521820945374e-01   +1.063153382554425e-01   -4.468152037029102e-03   +5.297531607693705e-02   -1.278462187488724e-01   -2.833906015555736e-01   -1.386552909996583e-01   -2.668829871186470e-01; +2.412309846900050e-01   -6.884658179644614e-02   +2.254508209003972e-01   -8.125773532512889e-02   +1.135683698618082e-01   +1.011933116499519e-01   +4.221632700188336e-01   +6.192163407694144e-02; -1.893474558703671e-01   -2.107751354495946e-01   +1.636791633044037e-01   -3.680030813357241e-01   +3.852461510172867e-01   -3.151940045898207e-02   -8.721926237642880e-02   +1.203246293350807e-02; -1.802525749490501e-01   +3.661691564127432e-01   -2.432084317576873e-01   -3.357345126458788e-01   +2.046034925756374e-02   +1.153414483921454e-01   +2.940668575909421e-01   -4.903560337516018e-02];
L1I_L2I_iGABA_netcon = [+1.505714387782376e-01   -1.808912280851597e-01   -8.419206208649999e-02   +1.001430986346435e-03   -8.877194124546559e-02   -2.206582132031920e-01   +1.532206632158910e-01   +1.966462516067051e-01   +4.874608102207056e-02   +8.893915353200409e-02   -1.527810684000999e-03   -2.702812264391719e-02   -1.649524137090781e-01   +8.012457833739964e-02   +1.706984565638829e-01   -3.678570622998870e-01; -2.529802557393512e-01   -1.866138856144847e-01   -1.923491917519036e-01   -1.227373477783926e-01   +3.644314605230982e-01   -1.817679025035308e-01   -2.500211755471013e-01   -2.291167980074091e-01   +7.016639815866402e-02   +4.622174405456270e-02   +4.392666822970648e-01   +1.020430240866874e-01   +1.561634682985352e-01   +1.081637541587278e-01   -3.283561119734700e-02   +2.932744429061411e-01; -2.274145703004904e-01   -1.021318433936134e-01   +2.050784609950946e-01   +7.691075494909384e-02   -1.602937863746844e-01   +3.214844452113682e-01   +8.636582410022900e-02   +1.900633101057903e-01   +2.255550620822503e-01   -1.797530451860873e-01   -4.175657099407224e-02   +1.091655814431434e-01   -5.034932230744645e-01   +1.718322279106462e-01   -2.845201330423619e-01   +6.983887387894341e-02; +2.766050543402012e-01   +1.156800439961743e-01   +7.410067302256228e-02   +1.867539518585501e-01   +1.499738862583311e-01   -5.901062093114751e-02   -4.051880575489616e-02   -1.830458071183282e-02   +8.521583693937997e-02   -1.277356202859554e-01   -3.287756390318289e-01   -1.172129603389340e-01   -3.543968510781109e-01   -2.277589910833545e-01   -1.081609673199961e-01   -3.149046156651502e-01; +9.416241872307440e-02   +1.505926685128270e-01   +2.026219157079677e-01   -2.351567077929357e-01   -2.553943694017454e-02   -9.142641516146613e-02   -4.124405233280131e-01   +3.577390779348906e-01   -1.740672341314446e-01   -1.825491726205950e-01   +4.256968028276923e-01   -1.528575649743213e-02   -4.320175267052553e-02   +2.885684186207099e-01   +1.200908296269181e-01   -5.866129254664795e-02; -2.609912778578264e-01   -2.119704614876156e-01   -9.370600305664473e-03   -2.738464562214681e-01   -1.157786635850284e-01   +1.883561566068725e-01   +3.024482059726006e-01   +8.542242608299377e-02   +3.077253821899137e-01   -1.992530768106337e-01   +2.027653743586414e-01   -2.621384447977870e-02   +2.778029674369346e-01   -3.776734594518175e-01   +9.463270072280607e-02   +1.486256883077348e-01; +9.562232117887659e-02   +1.301671745683515e-01   -2.020259790514312e-01   +1.260115425537829e-01   +2.609057848852580e-03   -1.500855653189398e-01   +4.234154458478501e-02   -1.914586565625513e-01   +1.885568385830738e-01   -2.254269321181639e-01   -3.502035659871234e-01   -2.385976526615195e-01   -1.546525170598070e-01   +1.877048156630872e-01   +2.897621220962194e-01   +1.345319199815480e-01; -1.251109403943091e-01   +2.981899708610586e-01   -3.440827919516558e-01   -3.763060899517607e-02   +2.086633882247348e-01   +3.535413935733892e-01   -1.566886171461043e-03   -1.281135782299204e-01   +1.349008243690704e-01   -2.300939268832446e-01   -6.009589182046941e-02   -8.518735036051209e-02   -1.820025997623292e-02   -2.184443042106414e-01   +3.978276741769224e-01   -1.519312645526038e-01];
L2E_L1E_iAMPA_netcon = [-2.931724525904367e-02   -2.339651091415755e-01   +7.618113458153797e-02   -1.142919273222884e-02   -1.307129614586818e-01   +7.327497696003887e-02   +2.225758227786989e-01   +3.248407885704664e-01; -7.415513815917187e-02   -1.568240274853896e-01   +2.536361445535864e-01   +3.262258207659027e-01   +1.978732113772323e-01   -2.547198581028376e-01   -6.496861572964210e-03   -2.668744007460779e-01; -2.428416458990127e-01   -6.426253130944359e-02   +3.230820549695307e-02   +2.076409504674578e-01   +2.198534169258498e-01   +5.605982695586668e-02   -1.339792923732027e-01   +1.809945011971603e-01; +2.269912494223295e-01   +2.253210675984549e-01   +1.065430422132546e-01   -1.659187778194689e-01   -5.793439223859727e-03   -3.288532402643702e-01   +8.722558829326307e-03   -3.680044187745649e-01; -1.525333795896112e-01   +5.413258665402600e-02   -1.720705484510580e-01   +8.458395925576333e-02   +1.609364443252973e-01   +1.771623009345202e-02   +4.730758928457585e-02   +2.624922106995259e-01; +6.143431131276963e-02   +1.184450179956879e-01   -1.567172396209971e-01   -3.624702403731271e-01   +3.767336092682440e-01   -2.236970544258412e-01   +1.864562412323159e-01   +1.588726919487368e-02; +1.720182405767217e-01   +1.517275282349629e-01   +1.959170271916001e-01   -2.305915656000904e-02   +1.825352559603408e-03   -2.755844971105971e-01   -9.325994892559458e-02   -2.401996273869900e-01; +2.090985144646864e-01   +3.351997526066823e-01   -1.553917412865827e-01   -2.051074423178834e-01   -1.280626223657873e-02   -2.074894090632684e-02   +5.966045922470587e-02   +1.685048986686599e-01; +3.519813665220824e-02   +2.035565990674941e-01   +7.622716143569620e-02   +1.608525098469550e-01   +2.746455981744204e-01   +4.023491482515193e-01   -2.424516829325967e-01   -9.846514935826142e-02; -3.469226806403450e-01   -2.866034039255808e-01   +1.740664320682632e-01   -2.797209575245366e-01   -2.228554954534483e-01   +1.728196318432699e-01   +3.718692363766559e-02   +2.811559855264066e-01; +4.315179259769457e-01   +4.212601328893703e-01   +1.912821794506950e-01   +3.181220404965144e-01   +1.044602985881516e-01   +1.077380728350422e-01   +6.722155770128660e-02   +1.761101276814059e-01; +3.758902907570374e-03   +2.211775239750041e-01   +8.166932391149498e-02   +3.174113086385488e-03   -9.169551390694404e-02   +1.824464580858632e-01   +2.427321493033027e-03   -4.916690672294137e-01; -2.305257187010997e-02   -2.979469282274770e-01   -9.794867974271081e-02   +1.316856975423095e-01   +5.001805723571010e-02   -2.294404209916921e-01   -2.296275438183080e-02   +1.514839279224908e-01; +3.315061388561198e-01   +1.789744871494725e-02   -2.137195961277946e-02   -3.141284790615120e-01   +1.519623094023698e-01   +6.528092637329229e-03   +7.170498274396650e-02   -1.146025715766945e-01; +1.398436650814603e-01   -6.321750048768393e-02   -1.382200082574496e-01   -1.851271154957357e-01   +4.771508675590078e-02   -1.190854563356655e-02   +1.101691032497335e-01   +1.221209255683194e-01; -1.377850668448903e-01   -1.015398235654305e-01   +4.182475433134606e-01   -1.894440230874139e-01   -2.331131897002032e-01   +7.457783227455517e-02   -1.315399743623360e-01   -3.519150588544884e-01];
L1E_L2E_iAMPA_netcon = [-7.013812971222354e-03   -3.718911977374708e-02   +2.462758200567209e-01   -2.237725384744243e-01   +5.969666135600177e-02   -9.908692942234784e-02   -1.708666880693979e-01   -1.092861935872862e-01   +2.488256056815921e-01   -1.797638114456003e-01   -1.757481740321753e-01   -1.649197748410531e-01   +4.224004073276892e-01   -3.754634202946677e-02   -3.270044647143419e-01   +1.510183733408081e-01; +2.019914942994440e-01   +2.871845947740466e-01   +2.051739706627968e-02   -2.779736626293299e-01   -1.611650593231936e-02   +4.502383142161391e-02   -2.639134482399249e-01   -2.866350126461131e-01   +6.967881268348544e-02   -9.538121453628248e-02   -3.610163908448575e-01   +2.392862378796847e-01   -2.415135922789027e-01   +1.294244370416615e-01   +4.090185820198503e-02   -2.040909886175681e-01; +2.382315768860999e-01   +9.705109759094302e-02   +1.888259554792739e-01   +3.486138433658308e-01   -1.758336305232022e-01   -2.930954067908688e-01   +1.915393210180557e-01   +1.482967517486478e-01   +1.833407339212170e-01   +4.070405591408897e-01   +4.560695378166269e-01   +2.557348186665599e-01   +1.772185299633970e-02   +2.060205407936029e-01   -3.621320034160361e-01   +1.522691091256614e-02; +8.206014804793399e-02   +1.593029933781684e-01   +4.587010194184073e-02   -6.951759779726424e-02   -5.116404167976264e-02   -4.967590529329174e-02   +1.753764659591542e-01   +3.934395623175804e-02   +1.502288021049382e-01   +5.387134167087762e-02   +2.013876345821737e-01   -1.238075040243408e-01   -3.087266287747226e-01   -1.680887499367309e-02   +2.657942527769433e-01   -8.985240129183200e-02; +2.610363584358812e-01   +1.671965267219604e-01   -2.540525366456061e-01   -7.105362546756108e-02   -7.296432775745060e-02   +1.690590560025906e-01   -3.175511993507129e-01   -1.934157580664754e-01   +3.119097807531713e-01   -3.423769684728326e-02   +7.773340315300220e-02   -1.249940063657440e-01   +3.456997589426469e-01   -1.413005172867867e-01   -2.603225976513783e-01   +8.241984021898301e-02; +9.321695304301131e-02   -8.596122523044361e-02   +1.378312682531124e-02   -1.033933295210110e-01   -1.418340102065315e-01   +2.397724165882256e-01   +9.992241743106660e-02   -1.076220228537393e-03   -3.073948302168772e-01   +1.473498980841844e-01   -2.688020337447619e-01   -4.142085161948951e-03   -4.518297285163590e-02   -5.620553758371465e-02   -1.242169933210849e-02   -2.403092485027408e-02; -4.820443063255783e-02   +8.983321072006314e-02   +5.603704471048851e-02   +1.076604256136767e-01   +4.500120961661259e-02   +1.625308246258624e-01   +1.350790394035564e-01   -3.272600361812714e-02   +4.843787128516173e-02   -3.100372227704831e-02   -8.628596562034616e-02   +2.318181880343029e-01   +6.038721728197477e-02   +2.243902157721102e-01   -2.048779162773894e-01   -8.933766822065058e-02; +1.694590724924941e-01   +4.628728982696270e-02   -2.647305111575773e-01   -7.310635193585127e-02   +1.464123133199838e-01   -7.104789858053251e-02   -6.868336477657230e-02   +5.640187226741623e-01   +4.345973900650500e-01   +2.605858512738248e-01   -1.200830051823983e-01   -4.204655801483507e-01   +3.234656095424422e-02   -1.106856714530965e-01   -3.021675733276137e-01   +1.846113166380496e-01];
L2I_L2E_iAMPA_netcon = [+3.057797092148275e-02   -9.226853786620920e-02   -1.225041757631119e-01   +5.208345899564186e-02   +2.149178067464636e-01   +1.190439781241341e-01   +1.442992901923663e-01   -1.006086181009125e-01; +5.303315790524116e-02   +1.526677285568629e-01   -1.135977569171592e-01   -2.526680815899222e-01   -2.981387472203575e-02   +4.122267621671899e-01   +2.409300663535605e-02   -7.477608344599415e-02; -1.317997523224249e-02   +3.227474842186526e-01   +1.908870415405500e-01   +3.127467814193949e-01   +3.093501568147501e-01   +3.637045038858366e-01   +1.940280074713663e-01   -2.745819231857700e-01; +2.753554226660294e-01   -1.219389791313782e-01   -3.099740764991377e-01   +1.206697546564566e-01   -1.304640591227777e-01   -8.831688387497963e-02   +3.445448775014711e-01   -1.829681220429851e-01; +1.648121590932154e-01   -1.117460269370436e-01   -2.828764818405173e-01   +6.849068861754631e-02   +1.747361407010356e-02   +1.346427612761182e-01   +6.598432391242194e-02   +2.102749767549316e-01; -1.468362728069873e-01   +9.653342793053717e-02   -1.291494501377128e-01   +2.783137948358294e-01   +1.055199001045353e-01   -1.189268603152445e-01   +1.315615512963886e-01   -1.590645103964875e-01; +1.719275978549379e-01   +1.530592109071296e-01   -1.957353004037483e-01   -8.625861865726626e-02   +2.575195047347961e-02   -2.592090030517120e-01   +1.903302686960143e-01   +5.240819921162232e-02; -3.683332495519540e-01   -5.862341388970127e-02   -5.151391235262051e-02   +3.516518356857226e-01   +1.441608345856858e-02   -3.822363752679317e-01   -4.629268527416950e-01   +3.663255595163678e-01];
L2E_L2I_iGABA_netcon = [-4.071593927869442e-02   -1.055688222859315e-01   +9.724572810860269e-02   +2.658751925428707e-01   -1.132433260377119e-01   -2.194402356905783e-01   -1.861863748592056e-01   -1.628267867266072e-01; +2.667512674305661e-01   -2.472192119862004e-01   -2.356591904567955e-01   -5.995693240016717e-01   +5.335935911758322e-02   -2.612413724109419e-03   +2.769992081993228e-01   +5.152663547475866e-02; -1.476376734162159e-01   +1.606973519837163e-01   -1.365873087895068e-01   +1.861136176548704e-01   -1.645807450551889e-01   -2.921293036007752e-01   -4.580523214847746e-01   +7.812259879150309e-02; +3.469732302184713e-01   +3.890610932964069e-01   +1.909968764772056e-01   +3.335260552776969e-01   -8.895531422158104e-02   +2.510304376586530e-01   -1.269510668346386e-01   +1.641813670452224e-01; -2.234722667000669e-02   -2.650700352461465e-02   +1.466040635359188e-01   -1.336673762444016e-01   +1.529368405733231e-01   -8.378922356160515e-03   -1.278659450143928e-02   -1.644982855534253e-01; -1.427994515039919e-01   +2.576599665183203e-01   +1.745938112122677e-01   -2.065473233733509e-01   -1.870734604831759e-01   -2.738576976595858e-02   +1.347791530205035e-01   -6.919442557097744e-02; +3.064142818701804e-01   -7.368715276574622e-02   -1.632114965805630e-01   -1.269827055884624e-01   -1.414267678295017e-01   +3.579033882955854e-02   +3.225404438378334e-01   +1.341146223816879e-01; -3.702180365699786e-01   -5.801282388488716e-02   +4.230396186779894e-02   +6.777871163472246e-02   -7.835623221486014e-02   -4.044096920484784e-01   +5.004307828020216e-02   -1.548051490368769e-01];
L3E_L2E_iAMPA_netcon = [-7.443611469377012e-02   -2.472708170626652e-02   +1.828029508149644e-02   +1.858579798147476e-01   -2.190322998214013e-01   +3.331363732037692e-01   +1.969210558339030e-01   -6.576385895488458e-02   +2.085906450199765e-01   +3.351909298831973e-02   -5.012429984785958e-01   +6.429087951324633e-02; +2.186369797196221e-01   +7.540023747680624e-02   +3.459177767549710e-01   -3.832107266775041e-02   -3.011564542404566e-01   +4.192518496108390e-02   -2.681647650292823e-01   +2.144066875316192e-01   -1.466414128161374e-01   +9.030260656793576e-02   +5.391911100713759e-02   +6.577082243862033e-02; +1.218176421109987e-01   -2.632417920394106e-02   -1.418289185886893e-01   +1.604465793146635e-01   +1.143978222724565e-02   -8.551308665278745e-02   -3.346509165109341e-01   +1.772155877675259e-01   +2.203577943007009e-01   +1.118047286906015e-01   +1.659920628059707e-01   +6.046140795010492e-02; +1.937622828672373e-01   -2.359051768171010e-01   -1.925286124804016e-01   +1.330797703450681e-03   -8.614378845467191e-02   +2.054512031925423e-01   -7.429771700782632e-02   -1.823054896689036e-02   +2.905519125131226e-02   -2.377235350810938e-01   -2.119132033665578e-01   +8.873929263321945e-02; -7.127998078948942e-02   -5.405950885222639e-02   +2.141670422846707e-02   +7.854602968843460e-02   -3.857701204454986e-01   +4.408783303069805e-03   -3.504348609698778e-01   -2.125217528894029e-01   -2.328755380207521e-01   +1.209299622041311e-01   +3.000630191422488e-01   +8.889794001409186e-02; -8.898066797421225e-02   -2.140107775726063e-01   +6.148533057948656e-02   +2.963279804304413e-01   +2.578824971913676e-01   -1.685384733149569e-01   -1.340899635235344e-01   -3.487121843412571e-01   -1.403653785053681e-01   +9.343139821369831e-02   -2.110837969616348e-01   -4.016416344785595e-01; -7.215962306894134e-03   -1.129676781978602e-01   +2.363577528787392e-01   -8.105525592502623e-02   -1.248223439545378e-01   +9.673379149590129e-02   +1.716005983051533e-01   +1.301483325980962e-01   +7.200174545617427e-02   -1.027144472642178e-01   -3.116868555500705e-01   -1.205379573330272e-01; -4.148387123077767e-01   -7.688218334806669e-02   -2.926046510906584e-02   +7.190491739323830e-02   +7.992618843269163e-02   +3.909917523540575e-01   +2.221691013202862e-01   -4.193630768632876e-02   +1.428866646248949e-01   -1.729128384515534e-01   -8.590329093419462e-03   -1.341268595570458e-01];
L3I_L2I_iGABA_netcon = [+1.294909663034378e-01   +2.270924909645269e-01   -2.260375744474276e-02   +9.254275190982361e-02   -2.214963333187554e-02   -2.050984733558306e-01   +2.638189069824412e-02   +4.138996950137488e-02   -1.727985030515183e-02   -1.269637909055561e-01   +9.043852079257200e-02   -3.543310306430120e-02; +8.937897398584582e-04   -1.459004377011270e-01   -2.208926672804918e-01   -3.351106002573820e-01   +1.422580213338800e-01   +2.269064691167829e-02   +4.334071079555468e-01   -1.378982578533579e-01   +2.210023810572623e-01   -2.645776338227011e-01   +1.404057367457003e-01   -6.997652707987163e-02; +4.822778957924995e-02   -2.630459700919859e-01   +1.213952630572806e-01   +1.096468893621797e-01   -1.944074856994759e-01   -4.735940401448769e-01   +1.533864730976980e-01   -2.406594533596797e-01   -1.955127999158560e-01   -4.738782941915710e-01   +1.435059743574504e-01   +2.566266214177026e-01; -2.618930538872886e-01   -3.007062473200501e-01   +4.326688435444944e-01   +2.713854485099490e-01   -7.055806786373965e-02   -1.523188622556909e-02   +2.157366945502809e-01   +3.457977268075493e-01   -3.204352489258906e-02   +2.659241022699335e-01   +1.285114054484812e-01   -2.422121266842002e-01; -4.063275032582639e-01   +2.052668273059172e-02   +2.426411530725100e-01   -2.487596082629640e-01   -1.088820091757562e-01   +3.054328203588715e-01   -1.122436467984254e-01   -2.346223658886255e-01   -3.854458180686473e-01   -1.477397261703123e-01   +3.565832415891906e-02   +1.206644032817257e-01; -1.307481288264447e-01   +4.692318082054651e-01   -2.356804486906660e-01   +1.689784607427144e-01   -3.763424723591426e-01   +1.823491362864672e-01   -3.445428411948329e-01   +1.558291535955850e-01   -4.069050670832730e-01   -1.135431061034965e-01   -1.168881034491950e-01   -8.776277131135865e-02; -1.721963509497005e-01   -4.653811655176709e-01   -3.154571106167928e-02   +3.283536624607825e-01   -1.362904770213521e-01   +2.919109060179997e-01   -1.114825536088483e-01   +7.615163660997723e-03   +1.622173720138733e-01   -4.223254041810412e-01   -1.259653904946105e-01   -1.802980116861140e-01; -2.640137468913716e-01   -3.610720814733076e-02   +3.381352623602915e-02   +2.148265956035191e-01   +1.914620372807686e-01   +1.750242335260233e-01   +1.383982422677129e-01   -1.012424655658134e-01   -2.118419726855354e-01   -1.601024745844578e-01   +2.003325392407591e-01   -2.694343568438304e-02];
L2E_L3E_iAMPA_netcon = [+7.546516009626444e-02   +9.437859903006854e-02   -1.371010625062875e-01   +4.790748899141880e-02   +2.652046935270271e-01   -1.034177369784587e-01   +2.675194262674133e-01   -4.355624650919017e-01; -1.250453259340234e-01   -5.001669532684833e-01   -3.110045990025748e-01   -4.926503216581642e-02   -2.862877579224799e-01   +1.199906902116910e-01   -2.820377151401373e-01   +1.238199808026368e-01; +2.792263640957789e-01   +1.573687478270445e-02   -2.314020397996445e-01   -9.657332442964092e-02   +2.861125589797064e-01   +1.072626956499617e-02   +7.301545199787099e-02   +1.014816854965896e-01; +2.102387473773885e-01   +7.439140890304416e-02   +1.508185366063096e-01   +1.376973551227149e-02   -1.199935699948815e-01   +1.106441657389249e-01   +1.210554165925515e-02   +8.210630031754262e-02; +6.526802428705442e-02   +1.300849291638292e-02   +3.872691110812163e-01   +1.390858127664290e-01   -1.227300593718673e-01   -1.701034351681406e-01   +2.979010387682294e-01   -1.436253212508473e-01; +6.080410494552416e-02   -6.594458807323952e-02   +1.637459355004391e-01   -2.491332832021409e-01   -2.687909597826900e-01   -1.191181512741521e-01   -2.072569615300719e-01   +3.772342113553104e-02; +2.253449805076787e-01   -1.933578268347228e-01   -2.407226225418974e-01   -7.180489588708475e-02   -1.735143123229000e-01   -2.405447949640331e-02   +3.948651405341758e-04   +1.100936277430954e-01; -1.776078481156114e-01   +3.606957844169063e-01   -2.314746689577404e-01   -2.307634137820314e-01   +1.676500652768626e-01   -1.007328450390198e-01   +3.825749071185089e-02   -8.528513235592936e-03; -1.207727222866057e-01   -1.553966958242071e-01   +2.196530762189969e-02   +3.565763918140512e-01   -3.539611278228043e-01   +1.991680757817108e-01   +1.217315472906553e-01   -6.335843665430022e-02; +1.036615690953291e-01   -1.864133033414217e-02   +1.060314343475043e-01   +6.872643680098461e-03   +3.745897163903975e-02   +3.070507639311297e-01   -1.575000080015177e-02   -1.395057224380090e-01; +2.176649425048953e-01   -4.733920995567949e-02   +4.516540066242664e-02   +7.161686073703988e-03   +3.086463769866913e-01   -1.584074029444067e-01   -1.739296554491795e-01   -5.590175968744127e-02; +2.142339217841939e-01   +1.033923299189478e-02   -5.530731801891138e-02   +2.382232303581945e-01   +2.143472475160229e-01   -2.859580546939883e-02   +3.241356453193421e-01   +1.915184686526427e-01];
L2I_L3I_iGABA_netcon = [+2.180366589304092e-01   -1.155436784589283e-01   +1.217645440451050e-01   -3.896888338628849e-02   +1.285951131082657e-01   +4.063833687515431e-02   -2.962962276968612e-01   +1.662416590586976e-01; +1.645880323546012e-01   +1.771624598648806e-01   +7.199211697104413e-02   -2.593959250506428e-04   +3.314994209018712e-02   +2.777332596100718e-02   -1.412644041663857e-01   -1.075296670366206e-01; -2.010975467435183e-02   +4.957191994367573e-02   -4.935415428915500e-02   -1.098118319264190e-01   +2.190594132918466e-01   -1.409137897209942e-01   -4.084886574538525e-01   -1.311711784975886e-01; -2.456846703425445e-01   -3.599908835229491e-02   -3.914659276368097e-01   +1.845413305052906e-01   -1.872471894316391e-02   -4.776871545436509e-03   +2.037429536948612e-01   -4.374872775977399e-02; -7.621398787047762e-02   -1.435064981511498e-01   +1.464370486512216e-01   -2.609854591036238e-01   -9.318592068546536e-02   -1.513834652945770e-01   -1.085158396690908e-02   +2.631481723161010e-01; +2.475838832101691e-01   +4.491645834226045e-01   -1.937930570377594e-01   +1.165281290719896e-01   +2.039154121481990e-01   +2.420006278699892e-02   +3.912424630516841e-02   -1.832262031555995e-01; -1.347732086238632e-01   -2.077941364033613e-01   -8.733358466338774e-02   +4.771667865143463e-02   -2.974674303604418e-01   -2.081894777355283e-01   -1.583544419741196e-01   +2.895672076165455e-01; +5.061030007448217e-03   +4.327519439498158e-01   -1.621322095329230e-02   +2.873216314533231e-01   -1.641604864718366e-01   +1.501522843789700e-01   +3.776258924777600e-01   -2.648166110936873e-01; +3.557749956593639e-02   -4.509090669937205e-02   -1.111491829527552e-01   +6.883587350009501e-02   +8.641367522185583e-02   +3.586465760945143e-01   +4.967861064991616e-02   -4.393488912743086e-02; +1.336522579395891e-01   +1.321496777409889e-01   +2.860455741432624e-01   -3.585025946831492e-01   +1.570495717092329e-01   +3.187626415480855e-01   +1.777473733720167e-01   +4.524519678001928e-01; -1.348606061294472e-01   -5.673732571400336e-02   -3.317476115297976e-01   -2.350414227969627e-01   -9.303324416348853e-02   -4.033843688951508e-02   +1.185221083082159e-01   +4.959325970298617e-02; +7.211142036756212e-02   +6.205948562334594e-02   +1.504807735376890e-01   +1.264709718353055e-01   +3.745414911170792e-01   -1.310817409796450e-01   -1.073659116087192e-01   -3.957540564780798e-01];
L3I_L3E_iAMPA_netcon = [+2.352008912981067e-01   -5.421539202911933e-02   +1.871668784442752e-01   -5.940433211160762e-02   -2.104479720304972e-01   -1.665270550025130e-02   +2.382050884341468e-01   +5.620586218946066e-03   +1.510519972805026e-01   -2.881876843043303e-01   -9.814805492975953e-02   -4.110446315387877e-01; -1.232985707861211e-01   -8.142351203860411e-02   -2.875310105833441e-01   +3.401548660123281e-02   -5.170289370934222e-03   -1.906439458880885e-01   +2.025090055847300e-01   +3.039750133612452e-01   +1.375452183374793e-01   -1.359539168968543e-01   -7.405580019483632e-02   -3.876528268121111e-02; -4.449354796984537e-02   -1.591164274914366e-01   -2.758321789146621e-01   +3.962134236251355e-01   +1.754986891626939e-01   +1.820773367474128e-01   +2.932717561693341e-01   -3.553419651321378e-01   +3.665967446422750e-01   -1.418526560105205e-01   +3.633322306190645e-01   -1.577993829565106e-01; +9.586749355162535e-02   +1.077178056942895e-01   +1.085269549758470e-01   +3.122036236573192e-01   +1.916419976567302e-01   +2.904209492856077e-01   +1.668420485026263e-02   +1.128833136350788e-01   +2.069587076194820e-01   +1.204896812474277e-01   -1.321817165292741e-02   +1.801315189392135e-01; +1.367401959473356e-01   -1.065455024380784e-01   -4.344583297617659e-02   +1.675000495191021e-01   -1.647484480926389e-01   -1.426156021156839e-01   -1.219050429323101e-01   +6.207983015930418e-02   -2.580364737583127e-01   -9.629116096679485e-02   -2.864307316128725e-01   -2.449804215794091e-03; +9.698189174573524e-02   -1.340540328927126e-02   -1.049048054561022e-01   +1.855676088238430e-01   -1.586839418393221e-01   +1.762597067887521e-01   +4.688813900946054e-03   +1.267850362079913e-01   +7.797896268016122e-02   +4.070289139616232e-02   -2.915394601713062e-02   -6.920278568302171e-02; -7.175934961795093e-02   +6.566339981551916e-02   +9.381683845050290e-02   +2.502805730289034e-02   +5.815095478911744e-01   -2.604110286659717e-01   -1.815100648864540e-02   +1.575330084443356e-02   -1.923204765788099e-03   +2.055928873037764e-01   +1.756691035696244e-01   -5.968425446223283e-02; -1.017705211369514e-01   +1.364953260995379e-02   +2.255348449331134e-02   +2.814801760750709e-01   -5.593761369363781e-02   +9.217069802058039e-02   +3.459131416727519e-01   -2.024320143324495e-01   -1.640656734247554e-01   +2.133674603661073e-02   -1.773258218447272e-01   -7.976071514523661e-02; -1.426571014855404e-01   +3.728110847059884e-01   +2.552666637361326e-01   -1.495487349414320e-01   +3.554152931845921e-01   -4.000755977568530e-01   -1.492646793191072e-01   -3.710438235817447e-02   +2.505840712434511e-01   -9.368733488576181e-02   -4.218995061933077e-01   -4.457706207863165e-01; -1.491004792414477e-01   +5.462288753314087e-03   +1.706656799996130e-01   +1.227075678626853e-01   -2.665502696422893e-01   -1.165864689027779e-02   -1.293540510176744e-01   +2.386517699412576e-01   +2.843182769045879e-01   -7.107668950685331e-02   +2.439367886975925e-02   -5.279761185740801e-01; +9.712326033211360e-02   -2.065015415441659e-01   -1.556767791760417e-01   +5.672153334446257e-02   +4.781010045981023e-02   +4.322868148480498e-02   -2.232554236134350e-01   +2.034279703087612e-01   -2.731267008304631e-01   +2.458207248724674e-01   +1.918728574941935e-01   +1.337128988576206e-01; +1.796907671554037e-01   -4.810307209233378e-02   +1.664253587474681e-01   -1.885251343563258e-01   +5.360899776946776e-02   +2.351890353697924e-01   -1.099589177266212e-01   +8.010424492554490e-02   +5.493099339098086e-03   -1.578130872784684e-01   -2.179535809880870e-01   -2.884096137249187e-01];
L3E_L3I_iGABA_netcon = [+1.503362588816698e-01   +1.682861267723761e-01   +1.558417173568734e-01   -1.317253945829464e-01   +3.148551938287589e-01   -1.387992891237731e-01   -2.011776520136464e-01   +1.593334307137857e-02   -2.423696190680508e-01   +1.228628221221524e-01   +2.021881527773513e-02   -2.443629241066765e-01; +1.077001851198395e-01   +7.938852154736713e-02   +2.988492299744301e-01   +4.311443703383646e-01   -1.468488582766443e-01   -2.500193704405935e-01   +8.213425766975144e-02   +7.725499979234281e-02   +3.313727620896171e-01   -2.591115270613211e-01   +1.958046850350522e-01   -2.897370923343102e-01; -1.124227558487425e-02   +5.549994516028850e-02   -2.190354104707178e-02   -2.617921015304476e-01   -8.192886296330368e-02   -8.375067155844482e-02   -1.526688222487719e-01   +2.743759411943383e-01   +9.441736171030565e-02   -4.920949353058487e-02   +5.748216366245222e-02   -1.585909926493740e-01; +1.835435287122562e-01   +2.346528405052618e-01   -1.195686426915354e-01   +6.048188358142453e-02   -3.036698050281732e-01   -7.097645396721772e-02   -2.119988979031676e-01   -1.219174122994085e-01   -8.199694397911404e-02   +2.628497093415749e-01   +3.357686795143630e-02   -1.584462531036309e-01; -7.831415471955844e-03   +9.064827783997580e-02   +2.018808762335797e-01   +2.659582086226031e-01   +1.407462526681101e-02   -2.518768260371175e-01   -9.451171054762178e-02   +1.147935409740161e-01   +5.264973466510227e-01   -5.751576144373842e-01   -2.408674818301168e-01   -7.725033006255473e-02; -5.326010844888559e-01   +7.655226865210821e-03   -2.646816673221847e-01   -4.103734662698075e-03   +1.774918545723123e-01   -3.587771683304278e-02   +1.026518235665062e-01   +4.548677672731996e-02   +3.260937828303818e-01   -2.262552245348185e-01   +3.301984988800294e-01   -2.341721013615933e-03; -4.389059091675640e-01   +3.777599375875392e-01   +9.354488963980609e-02   +3.366491976542491e-01   +2.624049363669143e-01   -2.530578826312194e-01   -3.015277053730238e-01   +2.875388213348324e-01   +9.052986125088724e-02   -7.654502116133459e-02   -1.189089444341342e-02   -1.534003790224837e-01; -4.382861316743746e-01   -3.165787982056841e-01   +2.105529497683523e-01   +1.935696667676298e-01   -1.863133761097195e-02   +2.307828598833769e-01   +1.751489197957122e-02   +1.513898279779025e-01   -3.215918097960868e-01   +3.067295624268029e-02   -1.370511737978894e-01   -3.248566266185168e-01; +5.285204716084598e-01   -6.861703711442053e-02   +4.334298395443780e-02   -1.735791565037537e-01   +2.384781959265801e-01   +2.301890370063122e-01   -4.840291024179277e-02   +3.543623794302286e-02   -2.046049852302102e-01   +2.465559609323894e-01   -3.662463840727435e-01   +9.192843302179787e-03; -3.528398700329405e-01   +1.497673886161550e-01   +1.226959347571283e-01   -8.401546565080427e-02   -2.260546218716423e-01   -5.700043978948361e-02   -1.640276806206393e-01   -8.826983750190821e-02   -4.985244673311319e-02   -4.178044402832592e-02   -1.501660483402534e-01   +8.574939216299703e-02; -1.482095722072964e-01   -1.968183815700685e-01   +2.551881083416518e-01   +1.120741923233279e-01   -1.022506795484284e-01   -3.828903102698544e-01   -9.412012983516706e-02   -9.426056005199920e-02   -3.048166189740081e-01   -1.023135235016772e-01   -1.480679430560684e-01   -2.239841598193511e-01; +1.674811128826565e-01   +6.374032713230424e-02   +1.214562397044753e-01   -4.232807497783778e-03   +3.410866872049308e-01   -3.763840387984724e-01   -1.976076612433628e-01   +4.061643070944750e-01   -1.927447968361506e-01   -2.598015397835311e-01   +2.724367989120396e-01   -7.025199899595244e-02];
L2E_Input1_iAMPA_netcon = [-3.426036243953787e-02   +3.641293770932622e-01   +1.349500566458397e-02   +9.598672584668064e-02   +2.518500219973938e-01   -1.468990980567893e-01   -2.386090269780496e-02   +9.118791931392067e-02];
L2I_Input2_iAMPA_netcon = [+3.414021912530055e-01   -2.355869894122266e-01   +1.785406668620171e-01   -1.392561306782481e-01   -3.131354697625095e-02   +5.946972254488352e-02   -1.413428762790113e-01   +7.060467462459512e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
