function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.738827300710977e-01   +4.331864588184438e-01   +2.906164627513615e-01   +1.655848117664649e-01   +5.093510616219741e-01   +5.644305088589281e-01   +1.912625599912868e-01   +3.985555560758813e-02   +6.168691194147174e-01   +3.110007105931536e-01   +3.287318175010336e-01   +2.100994281078055e-01   +5.270425678885034e-02   +3.990005046499527e-02   +5.998615124523912e-01   +4.538486347410818e-01; +9.242932399759436e-02   +6.159900518343479e-01   -2.362962941812444e-03   +9.172509974895965e-02   +4.643392759346079e-01   +3.805458452096908e-01   +1.234335902369084e-01   +6.177730327991634e-01   +5.225221598853899e-01   +4.176273866063538e-01   +2.914881223683258e-01   +6.353647741406222e-01   +4.133557370904092e-02   +3.159349910253465e-01   +2.487012608437519e-01   +1.250287646012957e-01; +6.333964494367833e-01   +5.712205052885048e-01   +3.959114053067869e-01   +1.789157016894939e-01   +3.602515461367140e-01   +1.939159515045764e-01   +1.388426985212592e-01   +2.153350042582400e-01   +4.443550936066335e-01   +2.110872131490999e-01   +6.274450229891543e-01   +3.750243363615852e-01   +2.913543021114019e-01   +5.285683599675361e-01   +4.569847569429758e-01   +5.800821622825028e-01; +3.006743400567061e-01   +8.672024676555078e-02   +1.726600690336521e-01   +1.212190748795832e-01   +1.021532909851711e-02   +2.961811157036032e-01   +1.956673097974408e-01   +1.664783039468949e-01   +1.798833615269013e-01   +4.706606719609041e-01   +6.232439652847624e-01   +1.151090492244511e-01   +1.897190377867048e-01   +4.148516361044484e-01   +2.476055838211306e-01   +1.123078291353419e-01; +6.021572851411123e-01   +1.980125340764245e-01   +4.221995471132213e-01   +2.134279170787984e-01   +5.730562019194397e-01   +5.548858113096375e-01   +1.240348296278867e-01   +4.838762297349082e-01   +1.832779288975943e-01   +4.235871086000884e-01   +1.243212845555652e-01   +4.324796230240376e-01   +5.247428909791783e-01   +5.610959152420835e-01   +5.342986534103764e-01   +5.264487514546291e-01; +6.278939175186042e-01   +2.812329096023094e-01   +6.289609639094111e-01   +2.665553479096248e-01   +2.083078606744126e-01   +5.151758134281958e-02   +2.589113212341765e-01   +2.447561096101942e-01   +1.291234645796361e-01   +3.853317935466918e-01   +1.456651114262831e-01   +2.262820321375711e-01   +4.155847782756271e-01   +5.201251022901084e-02   +2.642777821281574e-01   +5.732936807695890e-01; +1.645198487422033e-01   +5.679550441099306e-01   +3.606139738017755e-03   +4.834536840113656e-01   +1.731073282285389e-01   +3.339001046540405e-01   +6.326092454303818e-01   +4.054426993554425e-01   +4.627840062388923e-01   +4.209412050017307e-01   +4.017509360772414e-01   +6.403780911634591e-01   +3.571930891602723e-01   +4.857477731082445e-01   +3.561005475947663e-01   +4.007057325463613e-01; +4.136210714689906e-01   +5.941853468174286e-01   +1.521735771500599e-01   +2.373533973663021e-02   +4.670398431339394e-01   +3.192492452434674e-01   +2.182086209447479e-02   +3.920890010751667e-01   +2.830197111646893e-01   +5.369064737925111e-01   +4.801440073769577e-01   +1.426326616459657e-01   +1.765028780378531e-01   +4.106891623667320e-01   +2.773442454394651e-02   +4.097698733912448e-01; +3.773467061331716e-01   +1.241156884747705e-02   +3.086901480046874e-01   +5.928382958243447e-02   +2.394143383193513e-01   +5.382493068185047e-01   +2.411035870388302e-01   +5.758276878166085e-01   +3.545009336702233e-01   +3.874349831498051e-01   +1.566367599538555e-01   +2.608012925029186e-01   +3.415781219514788e-01   +1.580650440601584e-01   +3.362319280587996e-02   +1.540668889637798e-01; +5.118749844885889e-01   +1.068247721315452e-01   +5.287092998136829e-01   +5.431436447337465e-01   +1.834599928173165e-01   +2.540012848344665e-01   +3.233791236551686e-01   +1.702984367723216e-01   +3.800919121241026e-01   +2.320569164877216e-01   +1.607311082253085e-01   +4.809343064304260e-01   +3.573047408990407e-01   +2.830797247976141e-01   +2.998759432795482e-01   +1.779894431783403e-01; +3.580888392800003e-01   +5.994181925743171e-01   +2.818000831065656e-01   +2.750284884700478e-01   +2.069756410271510e-01   +1.153919839720566e-01   +4.444923288155559e-01   +1.064892255744350e-01   +4.897611083441883e-01   +3.483082075533796e-01   +5.960552481797305e-01   +5.430459593549958e-01   +3.140154551439500e-01   +3.445892637399462e-01   +1.053029593949590e-01   +6.099764885134452e-01; +3.727231314609898e-01   +5.632049490671902e-02   +2.404502648688015e-01   +6.171260270029162e-01   +2.892065671348817e-01   +5.132996177649110e-01   +3.481899709813747e-01   +4.310505562912228e-01   +1.580319728552705e-01   +4.658369602052504e-01   +3.411065535051887e-01   +5.642727020305929e-01   +5.201766833726366e-01   +5.202884393695888e-01   +3.304051537364787e-03   +5.011382564103873e-01; +5.789452711791051e-01   +1.603969505026573e-01   +1.649988221370300e-01   +6.460748441734959e-01   +1.334261526626899e-01   +4.433293462107253e-01   +3.746075731483351e-01   +6.138383979620751e-01   +7.819812089129340e-02   +3.431225528982080e-01   +3.217445774137100e-01   +3.983542671129977e-01   +5.027129063993889e-01   +3.909161423173910e-01   +1.040485245088573e-02   +6.261561072292262e-01; +4.097079179996698e-01   +1.855397546643238e-02   +6.368160183227055e-01   +6.094369922395740e-01   +5.565278394061167e-01   +2.080261461063941e-01   +7.002459191203864e-02   +4.864941234801209e-01   +4.542994505570779e-01   +1.539342386420069e-01   +2.715465156033920e-01   +3.413880733067756e-01   +4.324189994168420e-01   +2.157192617781572e-01   +5.993029938675303e-01   +1.651224491284754e-01; +2.619796461931875e-01   +5.989652729853899e-01   +3.511458275682254e-01   +5.941890101787838e-01   +4.350361081377699e-01   +3.039068415050435e-01   +2.742935125160751e-01   +6.340443761473394e-02   +1.273549811788911e-01   +6.414305515427731e-01   +1.417097859024155e-01   +1.678753681321611e-01   +5.824550406810549e-01   +2.661566820238855e-01   +9.718024625648690e-02   +4.405881017502983e-01; +6.312482804927346e-01   +1.466466187545444e-01   +2.187617687772163e-01   +2.883317279185676e-01   +1.294928009346291e-01   +3.351299689263885e-01   +5.610663530345451e-01   +9.447513743844067e-02   +4.749575182396037e-01   +3.730521493373871e-01   +3.428715491112238e-01   +2.931993172147118e-01   +1.073947580368335e-01   +4.919502388794696e-01   +1.599274793790671e-01   +2.689651251510745e-01];
L1E_L1I_iGABA_netcon = [+5.430834102863222e-01   +6.011867283516654e-01   +1.175556796894859e-01   +1.502094756090128e-01   +1.218072391868308e-02   +5.426725769151710e-01   +3.708579142822154e-01   +5.884283020731492e-01   +1.008784661818597e-01   +1.941528859690613e-03   +1.266305144234280e-01   +3.647315022915560e-01   +4.898607125178331e-02   +1.443850604245339e-01   +1.470608485735378e-01   +2.591155285013695e-01; +4.340867896735152e-01   +3.731629310314933e-01   +6.088610282508593e-02   +4.316148126289576e-01   +4.384090236978270e-01   +4.944920051441894e-01   +1.895397393725485e-01   +5.204431259051420e-02   +6.323688567305727e-01   +6.463533239938110e-02   +5.648302436441766e-01   +2.400646743858637e-01   +2.727862249636802e-02   +5.642034313594975e-01   +5.508607127062818e-01   +2.872181797792166e-01; +6.301929331816661e-01   +4.449261586281426e-01   +5.816058625155810e-01   +5.956306713232314e-01   +5.830143529079380e-01   +1.544822185164948e-01   +2.457076720353106e-01   +1.540647870117808e-01   +4.686158315425661e-01   +5.279647646568310e-01   +9.036882928125695e-02   +4.476892246484150e-02   +5.623108554864430e-01   +4.658251656616247e-01   +1.157508010492500e-02   +3.276326204586091e-01; +4.137502696883277e-01   +3.544341154492485e-01   +4.499238530182176e-02   +4.107461136806123e-01   +2.509157928277734e-01   +5.226834946271713e-01   +5.955225607907956e-03   +2.886371243008031e-01   +3.565302141247544e-01   +2.551013286684133e-01   +3.466806567364168e-02   +5.585030582065685e-01   +1.052761358407260e-01   +4.065783951696821e-01   +4.357773075294122e-01   +4.157765136395611e-01; +3.318033886861032e-01   +4.322522034621499e-01   +5.503497501979298e-01   +4.778623551595951e-01   +7.968294724214380e-02   +2.884150980750594e-02   +7.421798794932770e-02   +5.678164867223811e-01   +5.826338173526734e-01   +5.958574162791787e-01   +3.969435425983712e-01   +2.843466292206765e-01   +3.940762845548343e-01   +3.611158357729234e-01   +3.339333950902795e-01   +3.683971472978446e-01; +3.506828715664816e-01   +3.376369684968087e-01   +8.715011934733001e-02   +1.356319805868137e-02   +4.633881034961820e-01   +3.958598196479264e-01   +2.122505625001139e-01   +6.446288359134212e-01   +6.326914066847710e-01   +3.905108003394956e-01   +1.036030101550324e-01   +1.906869363947562e-01   +5.937730191570547e-01   +5.271908598450291e-01   +3.056425831598849e-02   +2.652012781746958e-01; +6.097834865286524e-01   +5.520385289382425e-01   +2.323411152476176e-01   +4.986464375981443e-01   +4.044387685660787e-01   +8.572024351353927e-02   +3.209252726307420e-02   +5.700772862283101e-01   +4.972316752202971e-01   +6.934789232749797e-02   +5.528076292071070e-01   +1.385036592367475e-01   +1.095495934390005e-01   +2.119484085898505e-01   +5.018385006632504e-01   +6.224496380016283e-01; +2.530305846231278e-01   +6.116823542521790e-01   +3.388984430565790e-01   +4.385898600970003e-01   +6.077540464591235e-01   +2.057790610796295e-01   +2.791972347835955e-01   +2.582739837820104e-01   +4.599703295031994e-01   +1.169922039485949e-01   +1.542045855045694e-01   +6.325469580129812e-01   +3.494465603433871e-03   +5.401160020881598e-01   +2.807929536957810e-03   +2.396774359279132e-01; +5.262425384145112e-01   +2.930432537011541e-02   +6.029841898817642e-01   +1.373220885082289e-01   +6.104162092129344e-02   +9.586916194685437e-02   +6.128205889058842e-01   +4.067025315797093e-01   +5.932795159151169e-01   +6.185933402684203e-01   +2.464703967535972e-01   +5.512992638902545e-01   +3.840821184314845e-01   +2.377507057285491e-01   +4.587944160745802e-01   +2.144072459848137e-01; +1.064017156924254e-01   +3.904126327260050e-02   +3.299652616248986e-01   +5.646134148236831e-01   +4.536233074791507e-01   +6.147052483284878e-01   +4.283796631869685e-01   +5.165931247695257e-01   +2.270510626253534e-01   +6.174262863751792e-01   +2.867746434815664e-02   +2.511757371843790e-01   +1.201150850349042e-01   +2.767161032909661e-01   +5.477778311826164e-01   +3.836770773274617e-01; +1.389174593891836e-01   +1.179363364864971e-01   +6.323848623644504e-01   +5.870664691698784e-01   +1.659608583196219e-01   +4.342278524892889e-01   +4.390571814317029e-01   +5.698289382799393e-01   +2.156069813127264e-01   +1.633247281827994e-01   +5.988771631348186e-01   +2.551416609345054e-01   +5.305889077613952e-01   +5.101020047333922e-01   +2.199678241028813e-01   +6.365477957248159e-01; +5.404228463286076e-01   +9.562659936679690e-02   +5.959886066573007e-01   +1.748811847821396e-01   +2.200841130602155e-01   +5.633030900897015e-01   +5.442165140665439e-01   +1.718137012324615e-01   +4.220577812166998e-01   +6.387497062032478e-01   +2.633501038934752e-01   +3.860334556278047e-01   +4.702420506742743e-01   +3.272744558711940e-01   +2.272671004754476e-01   +8.403861876342136e-02; +2.073866930942805e-01   +3.950011930172592e-02   +2.389563713854740e-01   -8.311118362151734e-04   +6.297952308607627e-02   +4.051952177556796e-01   +2.730340242522366e-01   +1.368379259210545e-01   +3.832914803852679e-01   +4.380490902244925e-01   +6.872095700580441e-02   +5.528701834573075e-01   +1.727862735526069e-01   +2.015147202638007e-01   +2.080615889230802e-01   +3.591503089966370e-01; +5.108018355001256e-01   +3.960101936407137e-01   +5.980882538883936e-01   +2.874075640228880e-01   +6.247588376924587e-01   +3.691500346017408e-01   +2.946518274462725e-02   +3.351591884195573e-01   +2.722605006627724e-01   +6.376719439645896e-01   +1.722018975448873e-01   +1.530974560662207e-01   +1.275058346109743e-01   +2.197568381759161e-01   +1.584987806282347e-01   +4.621883597743317e-01; +5.039593753428575e-01   +1.801569446703762e-01   +3.422422567817255e-01   +2.132765162270697e-01   +3.492548824224389e-01   +1.159126948523345e-01   +5.513419262677118e-01   +3.248543389874662e-01   +1.686056470312776e-01   +7.101787482933489e-02   +3.685042942970011e-02   +5.421984371403989e-01   +1.259756619371123e-01   +5.825125254126279e-01   +3.867069242182371e-01   +6.303023362095874e-01; +9.605490833084698e-02   +1.620753374246041e-02   +4.218748144655284e-01   +1.563017444795421e-01   +2.134392017861639e-02   +3.842173749740437e-01   +2.031431884108025e-02   +1.287504635524241e-01   +2.812405877030118e-01   +3.868497328242923e-01   +2.755255711502264e-01   +8.645760919088627e-02   +3.200801743323544e-01   +4.730477571366435e-01   +4.146002810388171e-01   +3.728611299362846e-01];
L2I_L1I_iGABA_netcon = [+3.020517944275491e-01   +4.162147251616944e-01   +3.969933035410517e-01   +1.972648909939691e-01   +1.361097431028796e-01   +5.956819690847611e-01   +3.337053749320835e-02   +5.951499023799656e-01; +5.556146028339548e-01   +3.132064534693386e-01   +2.703107046339585e-01   +5.252084297506843e-01   +1.929566203526080e-01   +1.396658796754899e-01   +2.170208454860873e-01   +4.553699016626233e-01; +6.045341056003563e-01   +4.197707306420832e-02   +7.051947566185900e-02   +6.047086021875792e-02   +3.577125410058347e-02   +6.071649810583690e-01   +3.934759684229850e-01   +2.112566417533300e-01; +2.933254208496972e-01   +5.468185091737892e-01   +2.662767598740782e-01   +5.179919826431180e-01   +3.488525428974884e-01   +4.718307051362125e-01   +3.385903512149241e-01   +1.875062413938038e-01; +5.566629551150267e-02   +5.810450238069332e-01   +2.941374654105529e-01   +1.791255089831337e-01   +1.384094658645159e-01   +9.926651249557282e-02   +3.761716962528656e-01   +2.908690485154861e-01; +1.311826115814502e-01   +7.786129086557147e-03   +5.150945095616940e-01   +3.786420552916617e-01   +4.770144292844280e-01   +3.810340630088082e-02   +5.855503996818755e-01   +5.237625013387369e-01; +1.787010682126075e-01   +2.960031415854872e-01   +4.795015875913598e-01   +5.305960180808109e-01   +2.881846085200985e-01   +3.350673306701728e-02   +5.379688026424611e-01   +1.691183285506982e-02; +3.953302399094527e-01   +5.672446087702266e-01   +1.903804252166854e-01   +8.347290345031692e-02   +6.627627034989546e-02   +1.304057872099291e-02   +5.287856738392873e-01   +5.198762217427030e-02; +3.307497077465993e-01   +5.585343573151523e-01   +4.004450645749439e-01   +5.563973423200465e-01   +1.219485412993813e-01   +3.545370853498999e-01   +3.198585623935009e-02   +5.404836803743304e-01; +5.281040254249474e-01   +8.509133184187340e-02   +3.658347879691993e-01   +1.348527216621888e-01   +4.926294756926687e-01   +4.442518998161574e-01   +8.983225757970134e-02   +3.876179316866464e-01; +2.098503882016755e-01   +3.960058768627087e-01   +4.001363341698803e-01   +3.066837094015168e-01   +1.585081526148052e-01   +2.844363907438109e-01   +3.098770826093258e-01   +1.990714399962096e-01; +3.159261775939540e-01   +3.031990164963527e-01   +5.550876369204365e-01   +6.860106722602380e-02   +4.120950791483592e-01   +3.827983321065382e-01   +3.876312837019196e-01   +1.889626481097542e-01; +3.049997148833533e-01   +5.750150720889147e-01   +1.533136714929733e-01   +1.803233506839304e-01   +3.964971317888036e-01   +2.176094837065601e-01   +5.190737743693221e-01   +1.640438138055696e-01; +4.995409608887735e-01   +3.540845753976566e-01   +3.484352300094421e-01   +3.932010726140918e-01   +7.070189040851544e-03   +3.262592485410838e-01   +4.488878891275160e-01   +5.931977765902492e-01; +1.760735505557633e-01   +6.088697101877624e-02   +5.009059960844903e-01   +7.921323729146275e-02   +2.259155482069205e-01   +1.535785066580776e-01   +2.395168438199775e-01   +9.321295441418215e-02; +6.333740115516769e-01   +2.528205861712683e-01   +7.948915383019201e-02   +4.459581956030598e-01   +3.581296678364207e-01   +2.888931420386840e-02   +6.259295546076380e-01   +6.104710115121825e-01];
L1I_L2I_iGABA_netcon = [+4.711188832989226e-01   +1.184368588197646e-02   +3.899384417376734e-01   +6.344482135662290e-02   +4.906876987244036e-01   +5.136639143237901e-01   +2.828333521242551e-01   +1.324649982340355e-01   +8.126902501024229e-02   +3.068079634132467e-01   +4.235453265877741e-01   +5.285677427511204e-01   +3.910106645022131e-01   +3.285243330718131e-01   +5.411707578529931e-01   +2.417825177978837e-01; +2.473120445974571e-01   +2.370716887027747e-01   +3.736804053088153e-01   +6.184479167670488e-01   +2.893367854893838e-01   +6.262978196730976e-01   +1.142643594544508e-01   +8.158791597400267e-02   +6.207210683640371e-01   +6.364818437507737e-01   +5.668786543595163e-01   +4.211917147321168e-01   +4.511672698996143e-01   +3.685160228902091e-01   +5.852736853617200e-01   +5.930740220419646e-01; +4.797225660256339e-01   +2.794742157459360e-01   +5.196265689896357e-01   +3.838563452116106e-01   +5.782526965889470e-01   +4.993185146605333e-01   +6.093409690392955e-01   +3.763057400918212e-01   +5.429108240620668e-01   +1.648085568593029e-02   +6.012004995033340e-01   +2.510319216418299e-02   +1.501014086497573e-01   +3.222525064065299e-01   +2.727834988039621e-01   +6.012912375721668e-01; +2.217051050185709e-01   +2.928933532398099e-01   +2.215496714579071e-02   +6.730646658616095e-02   +6.262012051934832e-01   +3.749704559181858e-01   +3.893401269222029e-01   +3.710526378308966e-01   +1.905451885854493e-01   +2.034411234620429e-02   +9.548398442441362e-02   +9.902680178743668e-02   +1.491862363683014e-01   +5.798303799795458e-01   +9.447060163428514e-02   +2.985175661489484e-01; +5.439287339237250e-01   +9.458280403880451e-02   +7.479090084625525e-02   +1.322258497207573e-01   +4.568130608049170e-01   +7.374502380354503e-02   +5.257200806821504e-01   +1.763943730275361e-01   +1.991514375196177e-01   +2.515632528477118e-01   +3.156534697093160e-01   +3.606917335572506e-01   +2.767268828365891e-01   +5.160078457280795e-01   +3.837597783023272e-01   +5.762550995478305e-01; +3.609787685113494e-01   +2.673662681062818e-01   +4.375950526021527e-01   +5.424666639713479e-02   +4.354102615584440e-01   +2.383769181927820e-01   +4.727331558272894e-01   +9.268529488131481e-02   +3.035967045304580e-01   +4.752708401802147e-01   +9.079889669242787e-02   +3.103882732367354e-01   +8.367092729149664e-02   +5.592838646856080e-01   +2.060532221996282e-01   +2.086991293250000e-01; +4.719552299274190e-01   +1.724993522714218e-02   +3.395988941359250e-01   +2.311618577470432e-01   +2.037284129626751e-01   +8.830585129249538e-03   +3.737659642423987e-01   +4.466490307067444e-02   +2.471012788159801e-01   +4.448248340765686e-01   +3.682886209524707e-01   +4.097718714390543e-01   +1.463340713134044e-01   +1.875396893946006e-01   +3.138602671332942e-01   +5.787096191062524e-01; +4.812642634501108e-01   +4.525016493213380e-01   +1.275854902770667e-01   +3.273501902613971e-01   +6.391804864443373e-02   +5.699352655151806e-02   +1.823297695674079e-02   +5.367234787522058e-01   +4.816794689127498e-01   +5.876241383779391e-01   +3.341057492334996e-02   +4.840596380072684e-01   +1.368618834420097e-01   +4.718455542929864e-01   +3.766173502057831e-01   +1.601033282960560e-01];
L2E_L1E_iAMPA_netcon = [+5.239075404619892e-02   +1.315376798245458e-01   +5.291665831710504e-01   +1.160159308859313e-02   +1.515491710389532e-01   +1.228188511844761e-01   +4.536302884965928e-01   +6.084596592511807e-01; +6.280928150856718e-01   +2.155032594754378e-01   +3.308749920311354e-01   +3.079377075552208e-01   +4.440612226290179e-01   +5.696765951451024e-01   +2.967802657503638e-01   +2.322984005503819e-01; +8.338989027094589e-02   +2.710468097901255e-01   +1.339630306526341e-02   +5.591102606777254e-01   +3.692516064831380e-01   +1.035526509346062e-01   +4.317506989302756e-01   +5.279966842891031e-01; +5.451690258303690e-01   +3.154325064213157e-01   +5.856310901420125e-02   +3.611838804186844e-01   +3.705207921629516e-01   +3.777838033627794e-01   +2.807274514590417e-01   +2.506135362739983e-01; +2.916935256536305e-01   +3.728285243961805e-01   +3.448930956943748e-01   +2.795258307732769e-02   +3.968483935238195e-01   +4.511348030858127e-01   +6.098556600589071e-01   +5.524125157518311e-01; +4.574473047549205e-01   +4.961123202123884e-01   +3.421522125460017e-01   +3.869630087790339e-01   +1.844574236696270e-02   +5.109897221077009e-01   +3.245853104678730e-01   +5.628920135556288e-02; +5.788362283225784e-01   +1.059820121401131e-01   +3.851566096298535e-01   +1.604588719772281e-01   +2.282678996279257e-01   +2.488225994917135e-01   +3.371440753443117e-02   +1.248510895992996e-01; +2.842838345543815e-01   +8.654600435911372e-02   +1.723809994953952e-01   +5.166492459005533e-01   +2.724022121123162e-01   +2.093929604513161e-01   +3.950341368193414e-01   +7.856554726142793e-03; +3.164738602791584e-02   +2.010761290637071e-02   +3.082405034929195e-01   +1.913373481025258e-01   +4.288192473636490e-01   +3.070154593497213e-01   +2.377013014854343e-01   +1.355892422849324e-01; +1.549009137359621e-02   +2.098521906273777e-01   +1.208538596633711e-01   +3.030749366862165e-01   +4.551640163390836e-01   +2.665796784566981e-01   +2.667412271120099e-01   +5.569136764122513e-01; +3.730084519798413e-01   +2.930622127469213e-01   +4.761392467128352e-01   +4.132114240797761e-01   +3.056250610467433e-01   +1.972531590989718e-01   +1.747600897125932e-01   +1.049727178709024e-01; +3.593534169974778e-01   +3.867965214730170e-02   +8.414329134908038e-02   +1.674881828037489e-01   +2.758715302319965e-01   +1.941221022848561e-01   +2.414471515196248e-01   +2.260072898343755e-01; +2.630670539741649e-01   +3.890438798675959e-01   +6.197857368507792e-01   +6.087782209890761e-01   +4.419395222015436e-01   +1.091994119163242e-01   +4.640346134097488e-01   +3.419419576222452e-01; +1.466439005944498e-01   +3.292668620544709e-01   +2.200758624263210e-01   +2.438756978198429e-01   +2.240589077793520e-01   +2.162975577306088e-01   +5.588421575305249e-01   +2.385445732879643e-01; +3.640545634322344e-01   +5.451410416381807e-01   +1.461646094259149e-01   +6.149472887333491e-01   +3.155410294847849e-01   +4.072262417921616e-01   +1.126109269121428e-01   +5.245960415253699e-01; +8.490935614805808e-02   +6.278803179729782e-01   +3.584914557156518e-02   +5.738765085713456e-01   +4.738573766244654e-01   +2.585224892725601e-01   +1.742303939689666e-01   +3.523858844945788e-01];
L1E_L2E_iAMPA_netcon = [+1.255595273662469e-01   +4.422312337461139e-02   +1.672053170981677e-01   +4.486655817631436e-01   +1.096769069828093e-01   +6.182623581865561e-01   +5.368750725216792e-01   +1.567642503343907e-01   +5.371568798699496e-01   +4.173318807163326e-01   +6.067350097635421e-03   +5.113173736382952e-01   +6.758817173623269e-02   +5.842533069313396e-01   +1.867871227720958e-01   +6.080720474099115e-01; +2.660699072357831e-01   +1.409767965596788e-01   +8.996261792570637e-02   +5.050625914050623e-02   +1.063878236550519e-01   +4.576216192725074e-01   +3.615650835420861e-01   +2.584122172833071e-01   +4.893850004450319e-01   +2.172418326573637e-01   +1.478041253561240e-02   +4.275400951390033e-01   +3.905847255378685e-02   +2.595795268883408e-01   +2.731797772887723e-01   +2.654289214338407e-01; +4.035365034864971e-01   +3.856422192281829e-01   +2.951853143966364e-01   +2.614967510175398e-01   +3.445319915912260e-01   +2.507049013647282e-01   +4.656540704707384e-01   +6.325089921787158e-01   +1.382321894229545e-02   +4.404906823166753e-02   +2.787459385765650e-01   +5.160711862874273e-01   +1.208331735446697e-01   +1.905463833005325e-02   +4.119014158797183e-01   +2.632525504126619e-01; +1.703836791929458e-01   +3.009506806245176e-01   +5.604224222177987e-01   +3.502700861623045e-01   +3.044264845818278e-01   +4.196236156652973e-01   +6.017221479549042e-01   +1.369561779735169e-01   +2.325376673815511e-01   +9.697007752582998e-03   +5.122761761045330e-01   +2.597566340193484e-01   +2.036975140075819e-02   +3.369350078797608e-01   +6.309264675998804e-01   +6.370842299703842e-01; +3.623648356987145e-01   +5.790332479328398e-01   +3.221971025099941e-01   +1.460959078647464e-01   +2.751291845292073e-01   +5.353495613393287e-01   +2.832078568732910e-01   +3.330740106267122e-02   +5.314917741365000e-01   +2.673410427603347e-01   +1.502644787798276e-01   +5.661246407388856e-02   +5.937961921719818e-01   +4.447490529752846e-01   +4.968925032134729e-01   +3.029955298076040e-01; +3.277609180585193e-01   +4.641198292004106e-01   +2.153593143154470e-01   +4.254776573694757e-01   +4.458311459727387e-01   +1.047369384497532e-01   +1.586990472115363e-01   +1.764551130681443e-01   +2.226134598428759e-01   +5.803629453336782e-01   +3.020283402621799e-02   +4.731970784149547e-01   +5.134700060038289e-01   +2.465565943802974e-01   +4.821502914778538e-01   +2.599566547284879e-01; +3.077509022547714e-01   +3.018375755583099e-01   +4.054288846072093e-01   +2.479724786652573e-01   +3.427937861460555e-01   +3.669762797267977e-03   +4.005790763893703e-01   +5.262107631355084e-02   +1.830253944071376e-02   +2.868006279027373e-01   +5.246167015009253e-01   +2.433403431195706e-01   +3.723766687980103e-01   +8.349401399055953e-02   +1.313421615110851e-01   +5.475749654710690e-01; +3.991069098799985e-01   +1.324396340654610e-01   +4.573908522524307e-01   +3.780552712601736e-01   +2.571360102809891e-01   +2.336052868542775e-01   +5.096731027910937e-01   +5.053389130551118e-01   +1.548793955833289e-01   +5.737411771973699e-02   +4.929481674713476e-01   +1.651136206244077e-01   +4.956318892795975e-01   +4.904749769659446e-01   +5.586510994768323e-01   +1.455697107247635e-01];
L2I_L2E_iAMPA_netcon = [+3.971299669941845e-01   +8.949989126736997e-02   +5.114696974493890e-01   +3.968621143488691e-01   +4.573676677490900e-01   +5.898857990679607e-01   +2.790095990213458e-02   +8.723728761507157e-02; +4.788246464665842e-01   +2.027840034876309e-01   +6.325992926599875e-01   +5.812874860706934e-01   +2.798269018792620e-01   +2.164352634382287e-01   +1.847096372744939e-01   +3.911208864356344e-01; +6.248963365894468e-01   +5.930421784272520e-01   +2.375402092578535e-01   +8.332779953156652e-02   +4.291225492090505e-01   +4.900324976803214e-01   +5.315475041032752e-01   +5.553336421310706e-01; +1.147155561242226e-01   +1.156317720508354e-01   +2.916342348592962e-01   +2.877359269880240e-01   +3.089804654714610e-01   +3.335150168832404e-01   +5.996021526220477e-01   +2.853453925338937e-01; +6.714251017788907e-02   +4.075378280686704e-01   +2.921695754131974e-01   +2.518236164179766e-01   +5.506771255657443e-01   +6.153190138181919e-01   +4.556936456379113e-01   +4.343807991703433e-02; +3.625284364357700e-01   +4.518092227053564e-01   +1.473925688554911e-01   +5.647025966479253e-01   +2.554334919974083e-01   +3.391463487090898e-01   +4.220187331391219e-01   +5.332264525768236e-02; +6.153264800197962e-01   +1.522858419299119e-02   +4.888144345206176e-01   +7.782507721029024e-02   +2.583811074865948e-01   +3.963423637222844e-01   +9.557237575094263e-02   +5.720394129763053e-01; +8.637727909171254e-02   +4.217833992105270e-01   +1.484017878350841e-02   +1.626807079713594e-01   +4.501847952180562e-01   +5.439500044249098e-01   +3.085522013799005e-01   +3.013306674758704e-02];
L2E_L2I_iGABA_netcon = [+6.252829177991468e-01   +3.892837048664777e-01   +3.711054635348794e-01   +4.403542170240085e-01   +5.392418216966919e-02   +6.076511767042521e-01   +1.048505805209139e-01   +4.522972402043199e-01; +4.529263934123850e-01   +2.450384535172302e-01   +3.613680572130362e-01   +1.832169346309436e-01   +2.587676686627869e-01   +3.900978247588626e-01   +3.427235106686828e-01   +6.311500138828181e-01; +4.294631952802949e-01   +7.222275404599771e-02   +4.150625159222859e-01   +7.301054686647411e-02   +2.995812226662173e-01   +7.479037676839909e-02   +6.351907968264748e-01   +4.202596488604619e-02; +5.738552594848265e-01   +1.271703286905831e-01   +3.656411424847942e-01   +6.051495720371912e-01   +4.695187300929322e-04   +6.071671771513466e-01   +4.723438038677143e-02   +2.346906241318349e-01; +5.990793976695041e-01   +4.646768973020316e-01   +3.558176868237176e-01   +2.776202150502888e-01   +3.972837849670350e-01   +5.866439592064122e-01   +2.674725053628103e-01   +2.304085622465591e-01; +2.556642115618996e-01   +3.790278956131092e-01   +3.708124225215940e-01   +4.998325262041361e-01   +3.257420646806439e-02   +5.913363524971231e-01   +1.174809101868502e-01   +5.341992308413955e-01; +5.842015036787441e-01   +4.455065054916320e-01   +3.735877452146010e-01   +2.983335152306988e-01   +4.637908037355093e-01   +4.588124829123876e-01   +2.294209751130481e-01   +1.631009831759184e-01; +5.229942261278490e-01   +1.410221376662787e-02   +5.745944822213673e-01   +1.931120118198242e-01   +5.327341865429438e-01   +3.893292566684193e-01   +5.700109477442137e-01   +1.787857570121964e-01];
L3E_L2E_iAMPA_netcon = [+2.076029078176400e-01   +3.492939467934588e-01   +3.754948408929188e-01   +5.515750723192659e-01   +8.215600387737690e-02   +5.082151422980618e-01   +4.162516509995517e-01   +5.207187539896790e-02   +5.652629478308235e-01   +4.568561334365807e-01   +2.870256398904517e-01   +3.569611199658240e-01; +2.962768898443525e-01   +2.736255972008168e-01   +1.888149128060939e-01   +3.052732646906343e-01   +1.273004485391328e-01   +3.291479846933353e-01   +4.783763486815240e-01   +8.201965453982279e-02   +5.825148418708210e-01   +3.796054097688772e-01   +5.573498790279117e-01   +5.208790337023915e-01; +4.530369161420055e-01   +5.941300496773336e-01   +4.867151782617992e-01   +5.441243089245823e-01   +1.233180154461998e-01   +1.428819083957286e-01   +2.571848508067250e-01   +6.254657210979674e-01   +4.146125742552421e-01   +2.117953794354425e-01   +2.177146329832066e-01   +4.193033131238265e-01; +1.978832486888953e-02   +5.377883927529725e-02   +3.914901713959404e-01   +1.798488434602420e-01   +1.946082128420993e-01   +5.710091073119061e-01   +3.540960745463755e-01   +3.759804973470217e-01   +2.000074360500756e-01   +5.510970282219310e-01   +6.365083487230617e-01   +1.317710211546362e-01; +6.254745482499457e-01   +1.349670854744255e-01   +1.932118625079160e-01   +3.878807556424519e-01   +2.974058508943193e-01   +8.352124823205152e-02   +1.822573683526853e-01   +5.188971301883095e-01   +3.343345547081136e-01   +5.952207797442033e-01   +5.174512186281065e-01   +1.186892684227307e-01; +4.000669760163674e-01   +2.929292965719144e-01   +1.156515554191608e-01   +5.979983725513764e-01   +5.259216593895609e-01   +1.142679755848937e-01   +6.131604653781882e-01   +1.425277050163899e-01   +4.210955853146686e-01   +3.011118628857474e-01   +3.479026142997974e-01   +5.439468089748462e-01; +3.955688421069443e-01   +4.732363679055416e-01   +3.828030564462993e-01   +4.062861720192860e-01   +5.560895664931073e-01   +2.622228793115155e-02   +2.334343609241155e-02   +9.566914826433545e-02   +5.041040626342480e-01   +6.843023010940381e-02   +5.667403007520272e-01   +3.716543389272173e-01; +2.996371509294373e-02   +1.738904273190074e-01   +3.353975162594842e-01   +2.743012737261399e-02   +5.775143626378501e-01   +2.375838894470346e-01   +4.787699300489011e-01   +6.266425646562673e-01   +8.719875542864215e-02   +3.465193982356179e-01   +3.377282566698608e-01   +5.669759694445601e-01];
L3I_L2I_iGABA_netcon = [+4.780257135042782e-01   +3.745761641218339e-02   +5.144652805245598e-03   +3.380383483842860e-01   +2.607189385181835e-01   +1.215212415299054e-01   +4.582119920315589e-01   +4.985089669834584e-01   +5.534615952974542e-01   +4.779555012598589e-01   +3.945795323422423e-01   +1.447954392785035e-01; +2.964592089926434e-01   +6.368488533616067e-02   +3.983316452355504e-01   +2.491392634585077e-01   +2.590822546342966e-01   +1.839458616682178e-01   +3.171789919744489e-01   +3.898305146751687e-01   +3.381652787980995e-01   +5.747642384248127e-01   +1.533754142893601e-01   +5.064861360831018e-01; +6.200812245432866e-01   +1.304340469778213e-01   +3.587402894913066e-01   +4.919978917629631e-02   +3.691256536165989e-01   +3.402811617564605e-01   +3.280522451594447e-01   +7.665799760649410e-02   +3.083453945558238e-01   +9.641222434423383e-02   +4.029452549352064e-01   +1.591492092272447e-01; +1.357704838660258e-01   +2.396798451673528e-01   +2.913860535129879e-01   +6.695894942958999e-02   +1.831996251815714e-01   +4.918535247623505e-01   +2.672540129312466e-01   +4.758579310930915e-01   +4.696034768365497e-01   +3.597706167932378e-01   +2.295418329093555e-01   +3.713766456728450e-01; +6.254456490786352e-01   +6.312856566580874e-01   +4.971840175584494e-01   +1.073555488776158e-01   +3.253958541483701e-01   +4.693524194359464e-01   +3.478916379830255e-01   +4.979716934500300e-01   +6.290707205913150e-01   +1.815818161478532e-01   +1.577999564951602e-01   +9.130895064579334e-02; +5.719911386396470e-01   +6.302210434837160e-01   +1.223994300528828e-01   +3.883337047289279e-01   +1.375466165375567e-01   +2.457544397780055e-01   +4.938017472869848e-01   +4.390321174252241e-01   +2.239601138132587e-02   +1.696354014945708e-01   +9.799250457950177e-02   +2.694018482984365e-01; +5.237250683999986e-01   +2.149665915135087e-02   +4.954671325466517e-02   +7.284772353532215e-02   +8.471115892477964e-02   +9.763271000081782e-02   +4.931899199992192e-01   +5.164083812207059e-01   +4.954539514682256e-02   +4.778629334176969e-01   +2.027494550727386e-01   +4.695633909677562e-01; +2.189969871796496e-01   +5.188352111682734e-01   +4.100058843250330e-01   +4.405377135624517e-01   +3.700959782620289e-01   +1.846306495659636e-01   +6.344322969989531e-02   +5.679675513412362e-01   +6.093439835777020e-01   +4.253028766649778e-01   +1.295645397169330e-01   +1.267709760751251e-02];
L2E_L3E_iAMPA_netcon = [+9.210068904157849e-02   +2.654577200063974e-01   +2.748333757007325e-01   +4.817950010146983e-01   +3.771098071112003e-01   +1.464914615144828e-01   +2.404721024128806e-01   +3.860056618647618e-01; +6.067254126985187e-01   +5.875738066077982e-01   +5.413028245092387e-01   +1.309820340124542e-01   +4.018781725519529e-01   +1.630755228501131e-01   +4.141551887387679e-02   +1.005825274938649e-01; +4.438639962244382e-01   +3.904257045578576e-01   +2.672046960472639e-01   +3.896779584543748e-02   +3.784777686916639e-01   +4.420068475582085e-01   -9.303851061104682e-04   +9.610599067174590e-02; +4.159636249203141e-01   +5.751921008118499e-01   +5.955863258637907e-01   +4.112911375171502e-01   +1.598061377954135e-01   +4.348738119298322e-01   +3.124960539624222e-01   +3.506908432063181e-02; +2.404211005037704e-01   +1.771061552850612e-01   +4.829446147720341e-01   +6.054377347210909e-01   +5.536949681591654e-01   +2.638804249698767e-01   +3.759232035162399e-01   +5.630594262901915e-01; +4.732323601637369e-01   +5.187176478707753e-01   +1.208469822161303e-02   +3.726930791453391e-01   +3.435117026032777e-02   +2.643805869165480e-01   +1.135587971836453e-01   +3.698271502917830e-01; +4.501879113621801e-01   +4.662205592369600e-02   +1.670758283464298e-01   +4.945870425341994e-01   -2.836498808697392e-03   +4.063499053507575e-01   +4.508500459785558e-01   +2.581004068027689e-01; +3.964313406150626e-01   +2.458962782553677e-01   +2.896223674633021e-01   +5.763192983012240e-01   +4.823404786752582e-02   +1.866176111247996e-01   +2.334521809324313e-01   +4.609809923619548e-01; +1.285228844548042e-02   +1.226302942081803e-01   +3.500818999868406e-01   +5.418678615072545e-01   +2.403157507337204e-01   +4.088887553028573e-01   +1.760669482626984e-01   +2.699290444745612e-01; +1.383328438939527e-01   +9.381956090929727e-02   +5.650784404621664e-01   +2.878783024219396e-01   +5.433610674963676e-01   +9.632555417364778e-02   +5.728792319393238e-01   +1.169205237710285e-01; +7.283644932240461e-02   +3.010310603693148e-01   +2.841761522818074e-01   +3.491551304542085e-01   +2.848261103924807e-02   +4.059964417361597e-01   +3.987079980661386e-02   +4.985024869516909e-01; +5.250237248871865e-01   +9.343794478859628e-02   +4.857519496794167e-02   +6.709947375435292e-02   +3.405159294373014e-01   +1.122129905824041e-01   +5.175489092383361e-01   +2.999135336448986e-01];
L2I_L3I_iGABA_netcon = [+1.566849020429647e-01   +1.939392171929303e-01   +2.001540233854755e-01   +1.409031318658364e-01   +5.722668341222149e-01   +4.292197931056301e-01   +5.198326348710336e-02   +2.178547643674519e-01; +4.382655387218641e-01   +3.664323243528456e-02   +1.394200376614494e-01   +3.391134075153651e-01   +6.056945234917602e-01   +4.005765112486913e-01   +3.233129529422774e-01   +5.483123184083071e-01; +4.939681841209068e-02   +4.168915121723193e-01   +6.145261035394457e-01   +3.054680977263195e-01   +6.168814409174656e-01   +1.291300408642545e-01   +1.206219879371183e-01   +3.513475607073716e-01; +4.674705477290789e-01   +3.839030559070287e-01   +2.751465081669898e-01   +1.813120446506474e-01   +6.214928121387920e-01   +5.200838241440242e-01   +2.505584198480214e-01   +4.484894276958607e-01; +3.831093044031386e-01   +4.719131028841445e-01   +3.963391709116623e-01   +9.904887418762848e-02   +3.840064834271810e-01   +4.438347019000375e-01   +5.283940325533277e-01   +4.643732355833510e-01; +1.905603204926721e-01   +1.518705338586760e-01   +2.570649759841098e-02   +4.680713430477590e-01   +1.406620467411022e-01   +6.256050329398569e-01   +4.623568942908205e-01   +6.351365758974883e-01; +4.365601160176420e-02   +1.362670175522737e-01   +1.350994266937717e-01   +4.773309488044251e-01   +6.350858937341602e-02   +2.024877817011534e-01   +2.456538861722518e-01   +7.071049443502712e-02; +3.271800304792842e-01   +2.314322258275683e-01   +5.560086205971051e-01   +2.884565882855429e-01   +2.993106275501252e-01   +1.200563909857810e-01   +5.615212680048515e-01   +5.708581976848079e-01; +5.553986285511451e-01   +5.512294592008854e-01   +5.502828493165470e-01   +4.304874253324820e-01   +3.828532875321779e-02   +5.521451652172674e-01   +2.502295213141827e-01   +3.187511926515134e-01; +5.353442984580312e-01   +3.115605878364392e-01   +1.071528534193590e-02   +2.349964595918977e-01   +5.289717537790402e-01   +5.681625073493926e-01   +3.231658604653339e-01   +5.975462094733817e-01; +4.018929182039966e-01   +6.312836390458714e-01   +5.171930848537707e-01   +4.790287250211789e-01   +1.117409866202096e-01   +5.634123401240164e-01   +2.859247690583189e-01   +5.959760139616771e-01; +3.687984883449220e-01   +5.124308962554285e-01   +2.145722588076941e-01   +4.984102412845357e-01   +5.761990036714175e-01   +1.119834340324190e-01   +2.181461054177001e-01   +8.868911589288987e-02];
L3I_L3E_iAMPA_netcon = [+5.239925809773692e-01   +6.439918889370146e-01   +3.991854849458269e-01   +3.428968879089303e-01   +1.515595401037863e-01   +4.837727323719421e-01   +2.731772688351686e-01   +2.029940426844364e-02   +1.369492818483622e-01   +1.668176208317551e-01   +6.019343508972984e-01   +4.525990449253365e-01; +1.889905889397974e-01   +4.504699446211418e-02   +6.013922196795362e-01   +3.444126274379435e-01   +4.412364688467924e-01   +3.331134169612318e-01   +5.981957653684637e-02   +5.853862439671104e-01   +8.353350220514096e-02   +1.368404621664523e-01   +3.187444994635425e-01   +1.981155327214724e-01; +5.981966695631675e-01   +2.461697401717707e-01   +6.012554373517741e-01   +2.103503311447106e-01   +1.027701373835470e-01   +4.307141780576741e-01   +3.722675458480713e-01   +2.792475901494655e-01   +1.670407004931856e-01   +4.109586731817039e-01   +3.679990300433441e-02   +4.823608929880237e-01; +4.046689467697392e-01   +4.699628390891798e-01   +3.143883743933106e-01   +5.643741567089237e-01   +6.007443772879598e-01   +1.139603669598376e-01   +4.457155727571867e-01   +4.719215760753253e-01   +6.043819390683020e-01   +3.642145890079441e-01   +3.229554378028850e-02   +4.036665693216906e-01; +4.484291489537572e-01   +1.397008349548682e-01   +4.673621632400688e-01   +6.280947964093333e-01   +5.364970879886923e-01   +1.203933970760143e-01   +4.983249193971171e-01   +2.079467688768052e-01   +3.201413541489089e-01   +4.989633803379434e-01   +2.638033541747360e-01   +4.974725601712921e-03; +5.263276988140465e-01   +3.614695790616033e-01   +6.316095972136475e-01   +9.789807149554916e-02   +1.183306300901595e-01   +3.365102911108180e-03   +4.971006631418141e-02   +2.245264584790974e-02   +5.476358855604598e-01   +6.352000223855752e-01   +4.659632249936140e-01   +4.484839273351506e-01; +4.592802235003719e-01   +3.010218772913703e-01   +4.934649913743751e-01   +5.900650429422014e-01   +2.569961774951314e-01   +4.044891130715281e-01   +3.284334679261483e-01   +3.375785533203638e-01   +4.246011367909784e-01   +3.539823357916648e-01   +6.028530312047039e-01   +2.515471717576659e-01; +4.541757327003420e-01   +4.397380440229199e-01   +1.793340939952850e-01   +5.463022297903168e-01   +2.232405323247214e-01   +5.680018294309942e-01   +3.440062825246649e-01   +4.824521703606942e-01   +5.507493328231792e-01   +6.366525459821547e-01   +1.237465386959706e-01   +1.602288815335302e-01; +7.872780766999599e-02   +4.274475454522821e-01   +3.204816651842135e-01   +5.961151042241764e-01   +2.579912778082117e-01   +2.203574739824201e-01   +3.991555214440125e-01   +4.659724523735599e-01   +3.409340450513225e-01   +1.196982207741776e-02   +5.343605495246229e-01   +5.462274087360022e-01; +4.835340458434240e-01   +1.785527190459562e-01   +1.398634110047936e-01   +2.299350674691691e-01   +4.305409787844654e-01   +1.188737662921852e-01   +1.007437272600214e-01   +1.730204353453651e-01   +1.531141780554228e-01   +1.019256683109095e-01   +8.778629365467698e-02   +3.983521459843911e-01; +2.802297136564352e-01   +3.976234981904863e-01   +6.410519921660931e-01   +3.563704157073973e-02   +3.773818741820934e-01   +1.858630949014210e-01   +5.660387812958794e-01   +1.101796634369126e-01   +6.159536625627977e-01   +2.208030811844394e-01   +2.048114067890064e-01   +5.826094568628389e-01; +5.875033899475571e-01   +3.061289866404588e-01   +4.089031432301306e-02   +3.124289465836156e-01   +2.374595764233206e-03   +3.408537031090312e-01   +6.308915035391236e-01   +4.081767574317091e-01   +3.098121629501165e-01   +4.831549200730321e-01   +5.824062502051284e-01   +3.998059628837521e-01];
L3E_L3I_iGABA_netcon = [+2.849798714599358e-01   +2.553744655062280e-01   +5.095809714853829e-01   +1.505560417255754e-01   +1.097658425038690e-02   +4.753932149833949e-01   +6.106315050499048e-01   +5.780732807082349e-01   +5.638107986861555e-01   +3.547652798286047e-01   +2.863643428498053e-01   +4.591607906559931e-01; +4.786709438592018e-02   +1.306361704354104e-01   +1.364273163225222e-01   +2.571816785331127e-01   +4.106336502346337e-01   +4.540607842556830e-01   +5.591627870750946e-01   +5.319058130029348e-01   +1.215644107064607e-01   +5.510257418655088e-01   +6.491484324128600e-02   +5.890787740570196e-01; +6.143899554183629e-03   +2.404346491248756e-01   +4.409856242923068e-01   +4.370230062229531e-01   +3.568634893745057e-01   +2.435512580602271e-01   +5.860121353655542e-02   +9.159086661576302e-02   +2.050919953503454e-02   +6.589379562928349e-02   +1.108312179483010e-01   +2.008238826374444e-01; +5.942842849808223e-01   +3.439075847732846e-01   +5.207722744555774e-01   +6.252506275977165e-01   +1.113612943001516e-02   +3.411429445088629e-01   +2.267435243537216e-01   +6.199804957731296e-01   +1.145183423866677e-01   +5.155461753473733e-02   +5.374208301859243e-01   +5.676911512893681e-01; +1.561062118755498e-01   +6.515952351266723e-02   +1.007571005306398e-01   +7.403611197134842e-02   +3.153535622625558e-01   +1.047816074764681e-01   +4.469294852971590e-01   +2.620560709548926e-01   +5.611724971967819e-01   +6.102362420245740e-01   +6.937220044936108e-02   +2.240915224060694e-01; +4.405784374680735e-02   +4.661822805242748e-01   +4.263059849321085e-01   +5.419146538087836e-01   +4.138999978915674e-01   +6.150224373325505e-01   +5.354927494975148e-01   +1.409531784047428e-01   +5.283643728591446e-01   +1.139386966879958e-01   +2.340589064113554e-02   +4.428917948545260e-01; +1.878820387526126e-01   +2.455044681743443e-01   +4.951890682751118e-01   +2.487712320034729e-01   +5.513857527575112e-01   +3.852930175460674e-01   +4.059811987982442e-01   +4.555165651176249e-01   +5.061524718919342e-01   +1.919702151147943e-01   +4.927440960133135e-01   +2.455172756492470e-01; +5.334847014848028e-01   +2.031756126851457e-01   +2.746013308728349e-01   +1.693999800340427e-01   +1.047874404375804e-02   +6.064202534210333e-01   +3.964476558038170e-01   +3.822008833142943e-01   +4.656083020398755e-01   +1.640923192176951e-01   +6.060048425446825e-01   +2.368144118317448e-01; +1.236654557349429e-01   +1.276761648183129e-01   +5.820544160404975e-01   +1.947938754455351e-02   +4.201688920739613e-01   +4.598877725984480e-01   +2.524952938307867e-01   +4.781713496922749e-01   +6.036976634092183e-01   +5.909109468034775e-02   +4.174232802910195e-01   +3.013656325140585e-01; +4.295442970352665e-01   +1.491682338729416e-01   +4.773214853122908e-01   +4.282731946454175e-01   +2.580402571692977e-01   +2.461898866856178e-01   +4.619176616921007e-01   +3.648114325834750e-02   +6.334684854681667e-02   +3.485535838521089e-01   +4.517452523097480e-01   +4.779925854160008e-01; +1.830776324763777e-01   +3.735011578724568e-01   +5.608540276534307e-01   +2.671161855786990e-01   +6.121491513227839e-01   +5.712532939360077e-01   +3.635849383344120e-01   +5.358985839052018e-01   +3.060695686976047e-01   +6.819262651575890e-02   +5.150264292330224e-01   +3.670519720688083e-01; +5.513535428920815e-01   +3.846623395310710e-01   +2.784058052340362e-01   +1.029407058018185e-01   +4.523244137246652e-01   +1.206310280238048e-01   +6.111796264523819e-01   +1.062597827456186e-01   +4.668955773044333e-01   +2.906231651924185e-01   +9.696463195873245e-02   +4.760248420785107e-01];
L2E_Input1_iAMPA_netcon = [+3.606871036072568e-01   +3.949136931809897e-01   +5.458650073886534e-01   +3.955630386519740e-01   +2.293532996326983e-01   +5.574223856120960e-01   +4.863930307079751e-01   +3.617994443801879e-01];
L2I_Input2_iAMPA_netcon = [+2.292128812922542e-01   +2.193034230764967e-01   +2.110507584571299e-01   +3.023964814717491e-01   +4.958315077580966e-01   +7.916427631337211e-02   +3.377154695635988e-01   +1.837590870303074e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -20*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
