function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.925541144029716e-01   +4.519231619767972e-03   +5.713548456837515e-01   +2.853186159432369e-01   +6.487330839205365e-01   +5.971449551064236e-01   +7.626277438403318e-01   +1.018584600689364e-01   +3.892356969617150e-02   +2.217851619298183e-02   +1.095836840522404e-01   +9.133545835833290e-02   +8.604498492758543e-01   +4.602371737653448e-01   +6.220607903110754e-01   +7.915654598457040e-01; +2.328884470246231e-01   +7.296795074762013e-01   +7.930464131839142e-01   +1.083845338496436e-02   +8.335395102009638e-01   +2.778556550659367e-01   +3.873483932735164e-01   +1.002816034834073e-01   +5.644345918310394e-01   +9.119889113792972e-01   +8.875487231408172e-01   +7.302222722084962e-01   +3.166916092338269e-01   +7.292379463720783e-01   +5.518768092209938e-01   +6.435701587834755e-01; +1.835086685844433e-01   +3.540921261479159e-01   +1.997749882906386e-02   +1.074708842776957e-01   +6.783072648666363e-01   +6.366127164883532e-01   +8.562246431179110e-01   +5.223437785728333e-01   +6.145919626637710e-01   +4.240241328272027e-01   +5.128453307290285e-01   +1.694982822474215e-01   +6.450270866325789e-01   +2.523810654582377e-01   +1.408267036967531e-01   +6.850357429130817e-01; +1.263256586601021e-01   +5.023404929086009e-01   +8.940895074733899e-01   +1.533191218627025e-01   +6.329398327755379e-01   +7.242907347114036e-01   +2.849742540592473e-01   +6.796074740106413e-01   +3.794901607707123e-01   +6.328489838318974e-01   +2.976387856259851e-01   +3.629642852984281e-01   +8.283238899299612e-01   +8.119272011905099e-03   +9.428105995149019e-01   +3.396594104174230e-01; +3.961734378995982e-01   +8.839237016449408e-01   +4.823716999798233e-01   +4.004488391704617e-01   +5.167973308783108e-01   +6.397985246357404e-01   +3.652811081279336e-01   +6.121507443491879e-01   +5.430320958398311e-01   +1.314740844123442e-01   +2.483581659925901e-01   +2.629024714133510e-02   +7.254547976261216e-02   +1.757991394277996e-01   +7.966154399047986e-01   +4.327142976248813e-01; +3.055033827658461e-01   +7.884229722471492e-02   +3.901799902961055e-01   +7.138108088531150e-01   +7.396818416771590e-01   +5.560864526658715e-01   +2.099582700494543e-01   +9.289836181334261e-01   +1.657201856357496e-01   +5.938338282616463e-01   +5.667771857747017e-02   +1.246176757773865e-01   +7.702257822152301e-01   +3.260187379983980e-01   +6.811371894488893e-02   +3.152110420487999e-01; +6.631359846014234e-01   +2.764577310330771e-01   +1.438084587724461e-01   +3.304792556398177e-01   +9.666683959962662e-01   +8.809107178716957e-02   +3.435461379115514e-01   +4.784742048642463e-01   +1.934569404919995e-01   +2.804486818578772e-01   +7.903593022015296e-01   +3.062396752046580e-01   +8.860963750092321e-02   +8.294853171531855e-01   +2.826839571843280e-01   +8.953854737168107e-01; +7.730135372633792e-01   +4.451067085235679e-01   +2.293355708266253e-01   +7.265509483962292e-01   +1.440282626866224e-01   +3.006642852022769e-01   +5.182644650843586e-01   +2.514813192612566e-01   +7.186341700302665e-01   +8.289733670050043e-01   +8.982996556257813e-01   +1.350173683345586e-01   +2.141534486437779e-01   +3.058836669032223e-01   +3.716044022261548e-01   +9.128094084347480e-01; +3.788777064045817e-01   +2.352027535638318e-01   +9.310823911991908e-01   +6.935389453201375e-01   +2.170534145133439e-01   +4.450923839344108e-01   +2.937763830322783e-01   +8.596002324086522e-01   +7.906653986960296e-01   +7.058485870132132e-01   +5.767265770218489e-01   +5.206525768321505e-01   +4.862094305710905e-01   +8.768528717558137e-01   +7.837734223528598e-01   +2.121870332656186e-01; +4.696373556946369e-01   +6.797944791253955e-01   +2.885782099710704e-01   +6.963293868653284e-01   +4.291966566175787e-02   +8.543964022934580e-01   +4.318972509137486e-01   +2.584635723528450e-02   +5.289357624808122e-01   +9.581908540153096e-01   +5.505064873267995e-02   +6.958167751158091e-01   +3.784573563964282e-01   +2.255504396510960e-01   +6.655366074549518e-01   +9.074551717424119e-01; +3.722117266302984e-01   +9.779036561337083e-01   +9.528438374793067e-01   +4.929752787125767e-01   +9.601518812462916e-01   +6.236706083094857e-01   +8.948274424098279e-01   +2.226105877691009e-01   +2.174846426122721e-01   +3.509433043210844e-01   +5.127469527250343e-01   +8.891586109765629e-01   +2.892562403276245e-01   +9.708134112399304e-01   +2.669250574602604e-01   +4.037624157021507e-01; +1.540244446052281e-01   +4.314350585898435e-01   +8.175024036546585e-01   +3.816714883045724e-02   +6.010169905059591e-01   +4.999746542611444e-01   +3.002110890519326e-01   +6.317570493803115e-02   +5.822640508518003e-01   +8.850154807050878e-01   +6.192712318193966e-01   +4.442275864323729e-01   +1.709803086083065e-01   +3.271066941165914e-01   +6.810231593756807e-01   +5.826139001996783e-01; +3.526635900926655e-01   +7.528486282490131e-01   +2.364748816725437e-02   +7.607810755244970e-03   +7.366821239279198e-02   +8.683843137961770e-01   +6.707901613977895e-01   +5.677290243726876e-01   +2.279695330357926e-01   +5.911504606414917e-01   +6.549269152962245e-01   +7.920148143567047e-01   +2.732463091705184e-01   +9.204482862075649e-01   +9.030715139887266e-01   +4.319298448600034e-01; +5.018638728489899e-02   +3.423712383976104e-01   +4.085250692879114e-01   +7.026826811811638e-01   +1.465485328488724e-01   +7.698530024023034e-01   +9.579555400952482e-01   +5.699996346299230e-02   +1.393507809883709e-01   +4.995906590002397e-01   +3.940116596411669e-02   +3.779015626497089e-01   +1.388069434048659e-01   +4.809815538422004e-01   +3.750084585768269e-01   +5.944967460345509e-01; +4.340234089569761e-02   +2.582705100820233e-01   +5.918737379232731e-01   +1.821046875480229e-01   +8.607412175612204e-01   +9.044119698863728e-01   +3.298782469808140e-01   +3.270130018610978e-01   +3.342174148453039e-01   +8.478853920315673e-01   +6.312906593905276e-01   +3.534544520426286e-02   +1.222020711025096e-01   +1.629869626368574e-01   +2.427499171028039e-01   +2.362309095121745e-01; +4.434897666048143e-02   +4.767023776535130e-01   +7.142368066494903e-01   +6.369678699463790e-01   +4.055581997308733e-02   +4.030042086995010e-01   +1.206577909805235e-01   +1.710005582569046e-01   +2.109459060176815e-01   +4.245750969922391e-02   +8.351208220943156e-01   +2.041482205596870e-01   +7.303692228309311e-01   +4.604297827974911e-01   +5.271806824840486e-01   +7.457171983935460e-01];
L1E_L1I_iGABA_netcon = [+5.237809478340574e-01   +2.089612981130645e-01   +5.068299877007322e-01   +1.246135287403839e-01   +9.801985725200831e-01   +6.554866694794304e-01   +2.958974182006904e-01   +1.772939193956302e-01   +9.057661953870774e-01   +9.034626652514111e-01   +3.287543789299172e-01   +8.792745375247650e-01   +6.768241197221673e-01   +7.895356076672391e-01   +5.519002827245796e-01   +9.063159918567276e-02; +1.186395013073884e-01   +5.310027876601214e-01   +8.806077699389012e-01   +8.277015584019706e-01   +8.348072416257792e-01   +6.128241581504548e-01   +3.025041265930462e-01   +8.812417400536010e-01   +1.020745984306946e-01   +9.057056733604061e-01   +9.555923581340675e-02   +9.937232598149842e-01   +1.319984674208690e-01   +4.717972066712450e-02   +1.062035915935430e-01   +1.184387773078592e-01; +8.714161352269321e-01   +2.007234930668810e-01   +4.534542263209050e-01   +1.645829387127801e-01   +3.245798435516939e-01   +2.603904568604173e-01   +7.444795835190291e-01   +9.518117641668294e-01   +1.381247003498953e-03   +2.363460062555199e-01   +9.045158401192096e-01   +1.511281520943264e-03   +1.892789479916872e-01   +8.973722956692729e-01   +8.317230981566109e-01   +1.551205513715226e-02; +8.409545477052249e-01   +8.174239673847945e-01   +6.828437586655107e-01   +2.102313920848220e-01   +2.766813327133666e-02   +4.836869033019325e-01   +1.195054692670519e-01   +7.781932876023118e-01   +1.000806719588074e-01   +9.525165914908047e-01   +1.559244627204560e-01   +7.655124177261077e-01   +7.313704458612016e-01   +2.662616688116125e-01   +6.008458903540054e-01   +6.736377740562924e-01; +5.360209650780072e-01   +9.174927198625878e-01   +7.956455953286210e-01   +9.344760722656937e-01   +6.135024767724548e-01   +4.104530649789779e-01   +1.738271306589926e-01   +9.587143460760020e-01   +2.146788867711283e-01   +2.606077617684971e-01   +4.765352683749891e-03   +2.620195009261682e-01   +8.852529214917797e-01   +6.312168498878896e-01   +6.282009754714833e-01   +7.570040773573627e-01; +4.967140702967910e-01   +4.711390313483516e-01   +1.920630599652685e-01   +5.557448259638281e-01   +1.708446621169230e-01   +5.909438787214638e-02   +5.660531603157460e-01   +3.262416402114222e-01   +8.865756927526467e-01   +4.297037409493151e-01   +7.020599449985926e-01   +6.142831991690664e-01   +8.193893376862714e-01   +5.547050681196548e-01   +8.070881742973126e-01   +2.335762868936242e-02; +6.046949867311129e-01   +2.539074765470005e-01   +5.640943393432365e-01   +2.056467371902079e-01   +4.706878181951711e-01   +6.905471433758819e-01   +4.453071229988297e-01   +6.064471711227426e-02   +3.916116871434950e-01   +7.845562174097481e-01   +8.233334877602039e-02   +8.432145056758159e-01   +6.297846119897186e-01   +5.176880874371439e-01   +8.758501104157584e-01   +6.078993273375149e-01; +5.030228966456486e-01   +3.912440868211420e-02   +1.771404963236520e-01   +4.905756330791896e-01   +3.344608606009880e-01   +4.544381374919867e-01   +8.286216501764569e-01   +6.288356705034738e-01   +3.813236111192637e-01   +3.422496405601756e-01   +5.442539443999485e-01   +6.987757021026800e-01   +7.600668685103104e-01   +9.882407118350005e-01   +7.806850813817399e-01   +2.944595780129911e-02; +1.161007398618947e-01   +5.073694041185450e-01   +2.722854950013871e-01   +1.440362059123569e-01   +7.124195032660362e-01   +4.996528218957993e-01   +3.927113569935404e-01   +6.502409504478261e-01   +7.614065101671981e-01   +8.605587042989374e-01   +9.401086716774502e-01   +8.929578508276709e-01   +3.250372666026100e-01   +6.883176695324121e-01   +2.775827032068542e-01   +7.634039780995644e-01; +7.747063541127239e-01   +9.259512836279360e-02   +5.721730802518525e-01   +5.226800532848901e-01   +7.663828131016257e-01   +2.257840889603481e-01   +6.953153821227300e-01   +9.364868049831353e-01   +9.153925293481948e-01   +5.983828938002205e-01   +2.066461804887243e-01   +6.829842769185925e-01   +5.769834390687226e-01   +7.390156774577555e-01   +4.291145587032332e-01   +7.097873616964018e-01; +3.899639896221182e-01   +3.213547813978201e-01   +9.323628483813269e-01   +1.933669681924216e-01   +6.654661095544679e-01   +2.817267514379054e-01   +1.387224783320942e-01   +3.111890820553195e-01   +7.288377441542471e-01   +1.356342661524739e-01   +2.876859353931217e-01   +4.365194540563918e-01   +8.747807959775620e-01   +2.823180353735322e-01   +5.066794754104104e-01   +5.767326425755956e-01; +4.637464533084906e-01   +7.350307397539433e-01   +3.092160059890637e-01   +7.980099388524273e-01   +8.847732484013723e-01   +6.115047912650505e-01   +9.475798803021351e-01   +1.245291325418868e-01   +6.342780268229704e-01   +9.080751887502880e-01   +2.765571169057449e-01   +8.900264714817752e-02   +9.151135318131365e-01   +7.492675208206976e-01   +2.427363321228873e-01   +6.355773913073439e-01; +1.200380207985023e-01   +7.126654399503675e-01   +7.369089440918908e-02   +9.738635188757254e-01   +8.293257929085099e-01   +4.388647249032136e-01   +5.493931183669359e-01   +9.672949645382001e-01   +1.463289351490473e-01   +1.966059193746607e-01   +1.035309416374717e-01   +8.644043032690655e-01   +3.657692555935680e-01   +9.957153617714093e-01   +2.632369984275706e-02   +6.241115959949924e-01; +6.690508964402612e-01   +2.121298579778360e-01   +7.323117774063437e-01   +2.997259307840183e-02   +9.363591043759915e-01   +6.051118838091561e-01   +3.429814852923009e-01   +7.971974272893179e-01   +7.906652420920430e-01   +7.534926820693345e-01   +5.097167972727410e-01   +1.974439790109849e-01   +7.278053881976438e-01   +1.359132218121382e-01   +8.920614711054839e-01   +1.291196235215080e-01; +3.068208937289052e-02   +9.430443962291098e-01   +3.812457485683027e-01   +9.429360264671159e-01   +9.202484541519462e-01   +5.608877247611500e-01   +8.606951936337180e-01   +3.736216325187702e-01   +5.735172574749461e-01   +8.605761384867491e-01   +1.280790737158771e-01   +6.891408645329099e-01   +5.477050895876160e-01   +9.538133076869333e-01   +3.722563191332124e-01   +5.684105515099257e-01; +1.019965264848021e-01   +8.669166732692957e-01   +1.965892030179263e-01   +9.029790817214001e-02   +1.357104575987969e-01   +3.525542742832131e-01   +4.454471794594557e-01   +8.743289146610526e-01   +8.874060582594177e-01   +5.759371297576358e-01   +8.565178716589218e-01   +1.846824029203071e-01   +1.548068067079532e-01   +7.076201298882158e-01   +9.409024689083935e-01   +6.118412651293816e-01];
L2I_L1I_iGABA_netcon = [+8.105485020163878e-01   +3.408710938472661e-01   +6.684160573025819e-01   +1.957826405283934e-01   +1.855151961675717e-01   +7.187889004720973e-01   +5.520342306770697e-01   +3.404585513815050e-01; +1.226105554539878e-01   +3.263374016216182e-01   +1.556948715552202e-01   +5.552749112732884e-01   +3.659877907607074e-01   +1.004987350370787e-01   +9.195075233988885e-01   +7.145584101330891e-01; +5.943188005621491e-01   +3.426581466162115e-02   +6.586202860399677e-01   +6.260485285607025e-01   +3.332065663185647e-01   +8.774388423219720e-01   +6.193532302771028e-01   +5.146291537385732e-01; +4.892737104724026e-01   +5.353644930449010e-01   +8.015547845143485e-01   +9.479033837775752e-02   +1.984922256023682e-01   +8.223667156902472e-01   +2.871242357547326e-01   +8.992188993579388e-01; +7.214735212555368e-01   +6.021920250634816e-01   +5.412392956124701e-01   +7.326614831798026e-01   +1.695114048783964e-01   +5.727567178204829e-01   +4.342083988928206e-01   +8.158808852044340e-01; +3.281246552471860e-01   +7.393137163107965e-01   +5.579585859657094e-01   +1.457283096499972e-01   +5.110016401853845e-01   +5.747282827883055e-01   +3.000360616073250e-02   +7.110831061467165e-01; +6.348009547610601e-01   +7.452478055357084e-01   +1.508533630133675e-01   +8.384404676089119e-01   +7.497616058854575e-01   +1.078538293992307e-01   +3.738115157949082e-01   +2.693076508013647e-01; +9.560150520535476e-01   +8.747363559082070e-01   +8.155094960772831e-01   +5.574193586065375e-01   +8.582829265101641e-01   +5.393452300144729e-01   +2.648356496542201e-01   +5.438935671075888e-01; +2.811811895670376e-01   +5.323029540161701e-01   +6.154350631955452e-01   +9.622699994934786e-01   +9.442788900726244e-01   +9.295189435836431e-01   +8.907423477424394e-01   +7.651933669338199e-01; +8.285883966087573e-01   +1.878915983374987e-01   +8.536312171152032e-01   +9.274891173403588e-01   +8.043478357537421e-01   +5.783757684893487e-02   +7.246852372246617e-01   +7.380663398043344e-01; +6.162325653566186e-01   +3.733345733810063e-01   +8.933610810330379e-01   +4.881084360316895e-01   +5.207063500820887e-01   +4.576371878496143e-01   +1.141860172119255e-01   +3.715691027295339e-01; +7.738876822390655e-01   +7.851591121001373e-01   +6.947472118033281e-01   +1.397886061381930e-01   +7.869482257758805e-01   +6.742815808411005e-01   +3.857652329414211e-01   +3.812673379990643e-01; +6.499152998493095e-01   +8.155065618481596e-01   +2.899010647824195e-01   +8.309595156179345e-01   +8.206894746966521e-01   +8.620368408074668e-01   +3.115263247105801e-01   +8.279854512094525e-01; +9.396931222705739e-01   +5.653319932301292e-01   +6.573114452091329e-01   +5.905594620413992e-01   +9.639596288124105e-01   +3.057470910553961e-01   +4.530031436723583e-01   +4.362053315331003e-01; +6.490936117009674e-01   +8.360239108259977e-01   +3.601969440525752e-01   +4.229483111733962e-01   +7.734800225752081e-02   +1.543151325375044e-01   +3.606105655002151e-01   +9.101448131430430e-01; +9.452383809688388e-01   +7.584022278620839e-01   +7.306642280222552e-01   +4.534780819337842e-01   +8.788996004066855e-01   +9.179464335131711e-01   +5.485913183578320e-01   +8.392973474624936e-01];
L1I_L2I_iGABA_netcon = [+7.261722692715733e-02   +1.747913323231883e-01   +6.817983409281780e-02   +7.339242347089251e-01   +5.541474260157625e-01   +3.943697503414263e-01   +2.254330396542643e-01   +4.753074418863158e-01   +5.190613926793316e-01   +1.265869868053930e-01   +5.875609536195774e-01   +3.194069425857623e-01   +7.678534256715264e-02   +4.302720109727942e-02   +8.815471604511356e-01   +6.852874078394741e-01; +3.512295836203926e-01   +1.668912991049719e-01   +6.406891203930397e-01   +5.123672833743005e-01   +1.664730463416773e-01   +1.166731960103379e-01   +9.721355896219053e-02   +4.757269505542669e-01   +7.528659250057353e-01   +8.417784823937305e-01   +9.360872896539919e-01   +7.481856867550942e-01   +2.012622819550206e-01   +6.818243113622769e-01   +8.098724096564707e-01   +6.751062006021447e-01; +1.967493827415039e-01   +6.347053300051384e-01   +1.328993752648833e-02   +1.421951919991629e-01   +9.631121093084278e-01   +5.601115120750415e-01   +1.148594521280013e-01   +6.506010668924023e-01   +8.215408442539400e-01   +3.390396323848598e-01   +4.336635281440867e-01   +6.848793307771346e-01   +9.058843150384006e-01   +6.656870170559130e-01   +2.873995655944579e-01   +6.602847081079015e-01; +6.818384291529012e-01   +4.696231220803965e-01   +5.483255714756529e-01   +9.716844517499428e-01   +6.191208126130923e-01   +7.472758027557078e-01   +2.457552194778034e-02   +5.454516861821058e-01   +8.766770538734695e-01   +5.609299252235761e-01   +4.767446002899790e-01   +8.244647248543515e-01   +2.054559232926678e-01   +6.398990235247369e-01   +2.086154642600160e-01   +3.976320548880091e-01; +3.277907121328788e-01   +1.013219564009031e-01   +8.781679080182332e-01   +6.627670512046265e-01   +2.238034280946167e-01   +5.221126739427659e-01   +8.032899804196602e-01   +4.465991978778017e-02   +9.115368011842556e-01   +4.367938627948021e-01   +6.293433137355275e-02   +4.842036873936637e-01   +5.207898765939500e-02   +7.680112435033828e-01   +6.556932248456666e-01   +1.251435716667419e-01; +2.834716270453345e-01   +8.397431853781075e-01   +4.574303662482139e-01   +8.685533821716621e-01   +2.144254398783807e-02   +4.031991472646794e-01   +8.579034680750796e-01   +7.512612928592454e-01   +7.096142355470396e-01   +3.361350573290592e-01   +6.149602425238075e-01   +6.076989616758046e-01   +4.334484876406485e-01   +8.329152054266977e-01   +8.864717497831057e-01   +4.818817590696056e-02; +5.027412425084928e-01   +7.370262685472230e-01   +1.348276874682088e-01   +2.029911009706796e-01   +1.877822044739017e-01   +8.136316448646722e-01   +3.586570783326881e-02   +3.053090051894378e-01   +7.409908703361374e-01   +2.889887143777609e-01   +5.438526326680061e-01   +2.802356296252215e-01   +8.517330744107643e-01   +4.870773216353398e-01   +4.572542045205289e-01   +4.866369598785548e-01; +8.031373432134441e-01   +2.877465177212113e-02   +9.183125916799060e-01   +6.410138743410997e-01   +6.112560258790245e-01   +4.773712398075398e-01   +9.133853494689280e-01   +4.986843572037793e-01   +6.343863637821791e-01   +8.039321385325426e-01   +3.340458161747708e-01   +6.163984572020486e-01   +7.376570168576834e-01   +9.842865969109608e-01   +4.892609102115419e-02   +9.649130233443528e-01];
L2E_L1E_iAMPA_netcon = [+2.826689587923497e-01   +4.668571229905805e-01   +7.053800309915644e-01   +9.487945082436841e-01   +6.843581259652394e-01   +7.246714274887367e-01   +5.516625912557995e-01   +2.034199348305027e-01; +5.106088437422991e-01   +3.529732249492817e-01   +2.028779468123820e-01   +4.902929014404448e-01   +3.996040584310570e-01   +3.915272227466360e-01   +8.255834846141467e-01   +4.879144552893482e-01; +3.648494692160871e-01   +4.923382078626497e-01   +1.680359176049534e-01   +9.638641394156139e-01   +3.413717194200083e-02   +5.657103090715166e-01   +2.708346612506903e-01   +4.741188023777765e-02; +7.204253411923974e-01   +2.464155897680606e-01   +1.030012102875953e-01   +5.867583282958595e-01   +7.127763845838896e-01   +3.099968366189046e-01   +9.048759508720534e-01   +3.904462780494478e-01; +8.812770901423205e-01   +7.331541416562359e-01   +3.395847994916489e-01   +6.774909244988628e-01   +6.307436641837987e-01   +2.244163199230726e-01   +7.988463921038574e-01   +7.654932655940041e-01; +5.965196209334889e-01   +9.256981616632267e-01   +1.566238278486644e-01   +2.743103755049257e-01   +9.388763097666619e-01   +9.248172593914953e-01   +9.961655589368013e-03   +6.924109110090499e-01; +7.962546543995204e-01   +2.062890416332075e-01   +4.886311784048928e-01   +9.458458033881900e-04   +3.052047083786464e-01   +3.010703884621813e-02   +7.652333327084617e-01   +7.135064841796855e-01; +3.752368636743578e-01   +7.605009702087647e-01   +6.079922389714533e-01   +6.459273381059013e-01   +2.853894143725888e-02   +9.657453532069473e-01   +6.208279031982828e-01   +2.273605633018753e-01; +3.388101171071594e-01   +9.819317111096466e-01   +1.135885052313468e-02   +6.662146383843530e-01   +7.945600946052128e-01   +9.756955257959465e-01   +7.567766200867581e-01   +1.660787796939108e-01; +4.073764682989093e-01   +9.682776265459787e-01   +5.513016818036131e-01   +2.958830868305472e-01   +1.856010021786434e-01   +2.496961998239767e-01   +9.448751995632715e-01   +3.507418999471829e-01; +9.147637059986329e-01   +3.595085305005297e-03   +6.277402463776365e-01   +3.231459241107855e-01   +5.853779427736749e-02   +7.929798337098338e-01   +2.183358128046957e-01   +8.861673105558470e-01; +9.064855784480430e-02   +9.233778896145672e-02   +9.201368797912087e-01   +1.619044540364046e-01   +1.302799907386438e-01   +8.121040794019528e-01   +8.728630347400124e-02   +3.914411748744263e-01; +6.077844733748927e-01   +7.208589844399678e-01   +2.652060473943877e-01   +4.561056554438336e-01   +2.942298201272762e-01   +6.584020958518270e-01   +4.978142195091959e-01   +8.037397487358743e-01; +9.500978241283001e-01   +1.031064333008056e-01   +8.661423507947623e-01   +9.769972738536539e-01   +8.530363654429591e-01   +9.995187306249459e-01   +2.932970610069142e-01   +5.918560079323563e-01; +6.730189133190891e-01   +7.506337203595832e-01   +3.063319413938180e-01   +8.176765424099854e-01   +4.692677335045823e-01   +2.380200665136961e-01   +2.443115939780794e-01   +4.651106787717462e-01; +6.162063635803402e-01   +9.850651387886977e-01   +1.877712112750433e-01   +6.809877039292532e-01   +7.175601399178804e-01   +5.586943087799867e-01   +8.379043524294568e-01   +9.005219775919915e-02];
L1E_L2E_iAMPA_netcon = [+9.350307255425051e-01   +3.178566056609404e-01   +5.561271872735193e-01   +1.333015508678222e-01   +1.502017460084460e-01   +8.631135384475107e-01   +9.969007680924094e-01   +8.386672033183827e-01   +3.675974792943246e-01   +5.936808344501765e-01   +4.046012724415774e-01   +8.503083384330551e-01   +4.985511412019572e-02   +1.957215771428988e-01   +4.194916078077376e-01   +9.397323228085165e-01; +1.215719459751193e-01   +3.437651659178698e-02   +7.858290964606821e-01   +2.987590193313564e-01   +6.710353366284716e-02   +4.592803102004319e-01   +3.848922538556442e-01   +3.826589303882496e-01   +2.998490755428801e-01   +1.002922864691644e-01   +3.062328070210081e-01   +9.126770662625519e-01   +3.159081019815625e-01   +7.036342155856055e-01   +9.738471526050451e-01   +7.267513699810324e-01; +2.979645451168862e-01   +9.687592615656260e-02   +5.634668229742981e-01   +2.091108566020382e-01   +4.710570602045340e-01   +2.579845282435009e-01   +3.259861179145934e-01   +3.576814418005536e-02   +2.244189230406594e-01   +3.031779577419511e-01   +5.894368373078646e-01   +2.707080492890435e-01   +8.941793689619645e-01   +1.111186302970171e-01   +4.523389387381836e-01   +7.681572991598532e-01; +7.895877813981251e-01   +7.573329528470503e-01   +2.982711253281237e-01   +3.120751454283655e-01   +6.355219912052525e-01   +6.311491865712057e-01   +1.353116822495628e-01   +3.315677020108242e-01   +7.844175957180206e-01   +9.848466941533971e-01   +1.699647220350927e-01   +2.621728997279819e-01   +7.897194047073445e-01   +7.436373882420837e-01   +7.650546205473274e-01   +5.987136764750246e-01; +6.360699941777085e-01   +2.471698579151921e-01   +8.724328474850871e-01   +4.128737850046880e-01   +5.232932822919253e-01   +8.009234076337287e-01   +1.552942195957158e-01   +4.906791807527352e-01   +8.410063090397060e-01   +9.785308024332197e-01   +1.358272960342494e-01   +9.270386005718584e-01   +2.267883659736467e-01   +8.512265075336348e-01   +9.933614278419223e-02   +8.451893385556610e-01; +1.653397530889860e-01   +1.486720863621491e-01   +1.527743788485708e-01   +5.504843815115434e-01   +2.410872576489905e-01   +6.754985273085452e-01   +6.057366197806862e-01   +4.787364995249231e-01   +8.176869434287132e-01   +3.102848413531824e-01   +8.600478701751023e-01   +8.673638135816181e-01   +5.612594800977360e-01   +9.530497078434614e-01   +7.134497585085413e-01   +2.672280987102993e-01; +8.864514750790410e-01   +2.713136164726571e-01   +9.461358664299994e-01   +3.418795261712110e-01   +6.750054937172350e-01   +4.000972012795986e-01   +2.973849353338213e-01   +1.999022562972815e-01   +8.818625362777645e-01   +9.397101660152775e-01   +8.714418458362259e-01   +3.653233021739819e-01   +2.978195478545203e-01   +1.982022756730573e-01   +5.117141425668329e-01   +3.478523031966363e-02; +5.615918037444995e-01   +6.381842263333845e-01   +5.297205819548199e-01   +6.002021727682262e-01   +1.789345511402182e-01   +6.893087424305174e-01   +1.876092334197511e-01   +9.127847046655009e-01   +7.403220021495475e-01   +3.290538967748278e-01   +9.808411405731243e-01   +1.567716268612178e-01   +1.634880799155877e-01   +4.073666727059662e-01   +3.706884779749117e-01   +6.854232412095622e-01];
L2I_L2E_iAMPA_netcon = [+4.900353817006863e-01   +5.820985235790274e-01   +3.627361642912673e-01   +2.095427226869738e-01   +9.588828184340836e-02   +5.543963671509955e-02   +4.489144216527281e-01   +8.062453710597320e-01; +8.270991393153722e-01   +8.115269653454961e-01   +2.205475696006486e-01   +7.203889968695495e-01   +9.504491045249754e-01   +8.733244829808753e-01   +7.085485536795189e-02   +5.242579291933287e-01; +1.868963186142947e-02   +9.735682636210427e-01   +3.395814983965284e-02   +7.078814680567662e-01   +6.606042881614289e-01   +8.907360491813795e-01   +3.056635553747277e-01   +4.527747705526981e-01; +5.896502425583775e-01   +2.703943271331534e-01   +2.298130587316630e-01   +4.879859775213138e-01   +1.339430314037848e-02   +6.783162795234993e-01   +8.930762324540591e-01   +4.238372586440459e-01; +5.843428689335880e-01   +1.804105890736740e-02   +3.694320778793684e-01   +2.907840774387980e-01   +3.296755888912468e-01   +8.125044441340410e-01   +6.665809875308216e-01   +1.722576166227116e-01; +7.635442583095514e-01   +2.261166329448439e-01   +5.415186838437673e-01   +4.678203367325590e-01   +4.502618904042532e-01   +5.672195533281896e-01   +6.839961470328436e-01   +4.082382246073958e-01; +3.109244764237027e-01   +1.207096216240970e-01   +2.064734132300634e-01   +2.300516564107702e-02   +5.861585620495727e-01   +1.771282643724645e-01   +4.189427949555528e-01   +1.175303832273429e-01; +4.690498137910223e-01   +2.864430176368057e-01   +1.927966028297508e-01   +6.109833178802450e-01   +9.057931277900786e-01   +9.008234830976348e-01   +8.278593108294435e-01   +1.051811533361178e-01];
L2E_L2I_iGABA_netcon = [+5.062768029348131e-01   +5.291578095522603e-01   +1.703505362320216e-01   +9.689144470442101e-01   +4.410827987460342e-01   +7.307441061507836e-02   +9.483030548336115e-01   +1.784231420216813e-01; +4.348476090976020e-01   +1.033567844114360e-01   +1.739617387342101e-01   +8.676674887856481e-01   +8.777602987220698e-01   +1.712448338142873e-01   +1.838272617465873e-01   +6.124624276662405e-02; +9.698437081572810e-01   +1.920402089511299e-01   +3.544777976338525e-01   +1.418871815870840e-01   +5.730588307412398e-01   +3.402130496709255e-02   +7.550313986653234e-02   +3.159081941907186e-01; +3.993903488952595e-01   +1.439167954384313e-02   +2.740852527225328e-01   +6.454931300280584e-01   +8.130284006825059e-01   +5.781078184562807e-01   +8.478745633539877e-01   +2.529143209509573e-01; +7.290863317790376e-01   +2.639981399581482e-01   +5.712373114183376e-01   +6.170730960994376e-01   +7.755449160869927e-01   +2.114616517194807e-01   +2.553375632936180e-01   +9.453004242595285e-01; +2.009986091647797e-01   +8.594816469364962e-01   +7.637097897583159e-01   +6.618389762362725e-01   +3.289510266584785e-01   +7.271447094175876e-01   +5.369204424604694e-01   +9.127971110015504e-01; +2.925912190859453e-01   +3.464941191697466e-01   +4.807121099464279e-01   +1.658114982230871e-01   +5.139860157507464e-01   +4.896098781319744e-01   +2.802269214177856e-01   +3.262884970609873e-01; +3.750050184311327e-02   +3.747789111507815e-01   +8.241686192210576e-01   +5.169309177674816e-01   +8.510915212732930e-01   +6.203593974849997e-02   +2.912621771584789e-01   +4.350070346447618e-01];
L3E_L2E_iAMPA_netcon = [+8.764263905861615e-01   +1.282313749100268e-01   +9.477891944331165e-01   +1.645358569999705e-01   +4.544820323126674e-01   +8.244133350788332e-01   +6.479170307040845e-01   +4.707391711782227e-01   +2.353845084863943e-01   +4.195228517636781e-01   +7.250844322504990e-01   +9.421745550231712e-01; +7.913924514654596e-01   +6.564383935405360e-01   +5.872764445733812e-01   +6.889819836844684e-01   +5.388965981904092e-02   +7.974739741515884e-01   +9.442942802845075e-01   +8.141683714419129e-01   +4.674366722652812e-02   +9.666967129450629e-01   +2.243453770466397e-02   +7.241499413479993e-01; +2.138224486910223e-01   +7.468201804193390e-01   +2.228824292012128e-01   +8.217201182137805e-01   +6.435330062210306e-01   +4.897440773147124e-01   +2.216061001629002e-01   +5.265227940003013e-01   +5.924685261327689e-02   +3.003920016018108e-01   +8.131970186988302e-02   +6.088022576251717e-02; +3.348593752753545e-01   +4.236179533629303e-01   +6.367647317194051e-01   +5.534379978861939e-01   +3.718251072270752e-01   +7.678493874707211e-01   +9.901510151047949e-01   +6.443313749851667e-01   +3.758934742096443e-01   +6.236606559535605e-01   +3.020069076087503e-01   +6.159259679969263e-01; +6.665405012228128e-01   +4.948169459635768e-01   +3.824619609448408e-01   +3.228963628501241e-01   +9.663326899146472e-01   +9.676645426244332e-01   +2.921677472736727e-01   +2.205017077766471e-01   +8.073268383522025e-01   +1.314806278232393e-01   +3.871866186236484e-01   +9.615550571222230e-01; +2.152910288053608e-01   +1.000019572344679e-01   +3.548747925275006e-01   +4.786054490685205e-01   +6.620586401510458e-01   +9.943150139061389e-01   +4.683929884508053e-03   +6.825703521434552e-01   +6.566037981814898e-02   +7.617065654050161e-01   +8.661324968346471e-01   +6.731424049342379e-01; +6.961917948871312e-01   +3.283995312787954e-01   +9.916946004166237e-01   +8.969019479834316e-01   +4.063786534686162e-01   +3.308617703406899e-01   +5.944501343160874e-01   +1.920726338632276e-01   +8.594773148911972e-01   +7.447614736688642e-01   +1.691155629830525e-01   +2.950359180046676e-01; +4.737387068758492e-02   +9.817933249497657e-01   +5.507654088837770e-01   +9.212232260873221e-02   +9.971914047044758e-01   +3.791192759750593e-01   +1.293729794762323e-01   +5.219612794528190e-01   +9.773877524768405e-01   +1.336840889830040e-01   +4.453183866418533e-01   +2.356357657329355e-01];
L3I_L2I_iGABA_netcon = [+9.977410818698568e-01   +1.620391928416764e-01   +2.517829767068591e-01   +4.206971538097214e-01   +6.636646019174881e-01   +3.490168534426282e-01   +5.947507250153339e-02   +2.004156585593865e-01   +4.421484145932980e-01   +8.273849818181537e-01   +8.121201709164523e-01   +2.511045574245451e-01; +5.126601054566050e-01   +7.175034309110937e-01   +5.981045304571199e-01   +3.137611214685809e-03   +1.830835882030604e-01   +6.557241790227707e-01   +6.883172279180584e-01   +8.907491114077912e-01   +8.617177206444885e-01   +3.394646073299291e-01   +1.306145026035579e-01   +7.329186838400455e-01; +7.104321934010636e-01   +9.731746387302932e-01   +8.739410747309651e-02   +7.279316710510244e-01   +5.863098453049946e-01   +9.694189109824787e-01   +5.058507568924204e-01   +5.562225947009299e-01   +6.578045312340640e-01   +9.561341692717540e-01   +4.972228812595337e-01   +2.182312464981536e-01; +2.687724352012275e-01   +9.320195980979703e-01   +7.488699124739862e-01   +2.178810753855451e-01   +6.299575710063946e-01   +8.230360541954795e-01   +6.690239392962833e-01   +1.188000145049247e-01   +3.058838119937755e-01   +1.047347808862000e-01   +2.198417880652217e-01   +8.484367920106520e-01; +4.833033213891013e-01   +1.596496601017454e-01   +5.182649300820495e-01   +9.717555622236336e-01   +2.401767283567080e-02   +1.757730158505385e-01   +4.497160823081515e-01   +1.848778634933482e-01   +9.572091204755945e-01   +6.161968679757367e-01   +8.156722841486242e-01   +4.846751229607924e-01; +5.763736765579057e-01   +1.395030281690217e-01   +9.159070861623593e-01   +1.525824749389406e-01   +5.338292777834465e-01   +2.639918521147456e-01   +3.370638856546426e-02   +6.968251452623804e-01   +3.426897222303603e-01   +1.260365774278255e-01   +6.016814278910155e-01   +7.690778499683859e-02; +7.460572585471781e-02   +7.689512125005648e-01   +1.222652883809827e-02   +8.972634814437619e-02   +5.607391258295993e-01   +2.153827102675160e-01   +3.469548456451786e-01   +5.093794708155558e-01   +4.725313431024059e-01   +6.813453001235642e-01   +3.570816760698006e-01   +9.169964955373144e-01; +1.316935412484688e-01   +9.612146427949064e-01   +3.197028241919163e-01   +5.976439112532389e-01   +1.027070895057799e-01   +2.385677151188974e-01   +2.264202129429942e-01   +3.734805129098706e-02   +1.133233940544043e-02   +3.796483775800286e-01   +4.045205054651384e-01   +4.877882106454966e-01];
L2E_L3E_iAMPA_netcon = [+6.972707402232039e-01   +1.034163434166434e-01   +5.876699493729495e-01   +6.789173186928921e-01   +1.923978636287599e-01   +8.386416428338004e-01   +3.881152248270385e-01   +3.573340416595567e-01; +5.968672939076758e-02   +1.451857659157958e-01   +9.841708443643691e-01   +7.406658948555386e-01   +6.878509010911720e-01   +9.290580915442914e-02   +8.477401237691774e-01   +9.292028959807268e-01; +8.403344082851530e-01   +1.498053675427832e-01   +8.310222479053483e-01   +5.865618626664426e-02   +3.197114735667118e-01   +5.862190539329505e-01   +3.860982337914617e-01   +7.170034677055279e-01; +7.530088700413121e-01   +6.663314676994517e-01   +2.979299801407602e-01   +7.986041830923363e-01   +7.232451290565107e-01   +6.080860769711214e-01   +3.934731681075332e-01   +5.237488815376909e-01; +5.518972773642558e-01   +9.129846960352521e-01   +1.487983153560679e-01   +5.645417689685697e-01   +2.439868795493405e-03   +3.337859022134972e-01   +4.027425519163148e-01   +2.683831866533293e-02; +2.461314552030851e-01   +9.267496857758051e-02   +9.020995841804889e-01   +9.106352686718594e-01   +4.051333736260214e-01   +3.420303957844661e-01   +7.759328909154627e-01   +6.674042091976781e-01; +7.111770976796394e-01   +5.788423026360012e-01   +1.028021772175572e-01   +6.699122279033456e-01   +1.787425863884375e-01   +8.558003181991549e-01   +7.585123291036748e-01   +5.321308292798169e-01; +8.061286995014900e-01   +6.926114174458603e-01   +9.526893218578592e-01   +6.251548236298572e-01   +2.134327873655681e-01   +7.405570773091397e-01   +7.195123957407221e-01   +2.482521531274895e-02; +1.093200208803712e-01   +8.676629379445314e-01   +5.092312659028501e-01   +2.476875755521646e-01   +9.098827856025203e-01   +4.639140101906684e-01   +3.896999741517263e-01   +9.934615617557341e-01; +7.493530143730961e-01   +8.328363794722132e-01   +7.268081003485817e-01   +9.071700385522233e-01   +7.282039422803243e-01   +1.169614654321068e-01   +6.205469379674416e-01   +1.441562493405960e-01; +3.153322912661221e-01   +3.044738370939815e-01   +1.133444274523637e-01   +6.498175786146998e-01   +3.632794841360868e-01   +4.963137461066558e-01   +6.107218052539781e-01   +3.582677850406838e-01; +9.292867159904683e-02   +6.967486672322534e-01   +7.666283703243360e-02   +5.741664634128846e-01   +9.479185866577519e-01   +1.264458475714569e-01   +6.784248090124311e-01   +8.309658591993624e-01];
L2I_L3I_iGABA_netcon = [+4.874260295529987e-01   +7.209799268719116e-01   +4.199726974721799e-01   +5.492830421704938e-01   +6.019115244696738e-02   +9.076560788636554e-01   +5.662007985216129e-01   +6.181243830312995e-01; +1.227265044489035e-01   +9.160966840206575e-01   +7.508746636991425e-01   +8.964027367276174e-01   +1.783607074743596e-01   +3.624052080543277e-01   +5.651548722803601e-01   +9.315139712266537e-01; +7.335653215250066e-01   +6.431539215561629e-01   +4.245400254820059e-01   +2.756965377265657e-01   +1.126849270015873e-02   +7.470360390422429e-01   +1.082658294444708e-01   +1.245624904164963e-01; +8.095179684107471e-01   +5.813535724643039e-01   +7.482366599333610e-01   +4.466303606886768e-02   +7.162573873394537e-01   +4.753953974118083e-01   +3.848925181676288e-01   +3.691113624470160e-01; +4.944531988004707e-01   +6.596220135861230e-01   +6.671722819352446e-01   +8.785691958734121e-02   +9.854840306970092e-02   +4.771325818726357e-01   +2.287409831118121e-01   +9.731817609332982e-01; +9.445999061730499e-01   +7.595846138849356e-01   +7.650806262821219e-03   +1.644851453545493e-02   +5.068187332506983e-01   +3.132752207616880e-01   +2.498778870390080e-01   +2.129056831335234e-01; +8.384278638590623e-01   +1.519528717898295e-01   +6.708916665882855e-01   +9.592823529182595e-01   +3.169096160824271e-01   +6.666131619461061e-01   +5.794497428430536e-01   +9.683643815216143e-01; +9.376816010485683e-01   +5.387260362064059e-01   +6.550476653358207e-01   +4.504452860681277e-01   +6.692810932005876e-01   +5.469231619315355e-01   +6.449023662989306e-01   +9.671793289888375e-02; +1.576224906348028e-01   +8.803774712225174e-01   +2.040772684319235e-01   +7.855155319906026e-02   +2.031025330997849e-02   +2.915639273180379e-01   +5.925638532929476e-01   +7.160673081337081e-01; +8.053818848425587e-01   +8.741155668148922e-01   +2.901062735658730e-01   +3.355826253748412e-01   +5.629121779822983e-01   +4.639663998903540e-01   +9.929647865295333e-01   +3.945172279146640e-01; +2.142029765164561e-01   +4.964998008750087e-01   +8.198606604045531e-01   +5.619577223840325e-01   +5.052999859754370e-02   +6.917350386271637e-02   +9.163192674791896e-01   +9.964985675615068e-01; +4.375724962893949e-01   +1.714043738834156e-01   +3.126375744961590e-01   +7.841314828264296e-01   +7.315301261931145e-01   +1.582087079286921e-01   +3.860942346737761e-02   +4.861088406602811e-01];
L3I_L3E_iAMPA_netcon = [+2.707184127295181e-01   +7.231287945331111e-01   +4.252273048358060e-01   +7.813637468137654e-01   +9.410625657298755e-02   +2.031481722897848e-01   +9.636352721365891e-01   +7.117668229387922e-01   +6.235818805316976e-01   +1.763043240505082e-01   +6.661405219761540e-01   +4.509731556353246e-01; +5.491856300627090e-01   +9.989774830688731e-01   +3.447603261901183e-01   +6.266478166906997e-01   +9.964700997417519e-01   +5.412894111947542e-01   +3.401886085447268e-01   +3.211162900568005e-01   +2.523087287615966e-03   +7.241561270490132e-01   +9.593954189391249e-01   +7.836482577052056e-01; +4.332076822499900e-01   +4.239771631523901e-01   +5.385843453268211e-01   +3.915987806988218e-01   +1.573043862890811e-02   +2.462251131940636e-01   +2.849475951608429e-01   +3.755864146998292e-01   +2.337382609628502e-02   +6.367140538388771e-02   +8.199214517534570e-02   +3.407706613997084e-01; +6.201348540799807e-01   +3.644304391184021e-01   +9.104871175113460e-02   +9.384463005649587e-01   +7.338199526802507e-01   +4.663867117623836e-01   +1.314067887922976e-02   +1.525500286325694e-01   +6.405047885461210e-01   +6.504655575178163e-01   +5.395456255010478e-02   +6.292630324341485e-01; +7.592597232652509e-01   +4.531945960718846e-01   +8.070575563421031e-01   +4.162921041159472e-01   +6.099742216418941e-01   +5.280265677866556e-01   +6.762016226412353e-01   +2.080658365512358e-01   +3.293682936654819e-01   +6.949149775139588e-01   +9.347756460324588e-01   +6.567307550449719e-02; +3.385227578755906e-01   +3.509996590268282e-01   +4.803693503476222e-01   +4.611592674594031e-01   +1.297576839297528e-01   +6.910214021356408e-01   +6.654111694581460e-01   +3.957683699574845e-01   +8.104796390270852e-01   +5.298596161199302e-01   +9.309247980542952e-01   +2.209272606637148e-01; +3.831154167772146e-01   +2.308175063195341e-01   +7.117012822442149e-01   +7.065825704167898e-01   +5.459296358297677e-01   +3.872063108716067e-01   +3.561143926971388e-01   +3.247718043272174e-03   +1.015168224395070e-01   +5.579451137327458e-01   +4.810164475926549e-01   +7.118760840320409e-01; +8.880420915034138e-01   +9.328187108632513e-01   +1.680696316013555e-01   +8.106096337378937e-01   +2.514954438970413e-01   +4.619709217930651e-01   +5.576873724574092e-01   +4.801866712767681e-01   +5.297430965021148e-01   +1.751668667644363e-01   +4.595492593057851e-01   +2.638182377776889e-01; +3.042875200439238e-01   +1.812405034035230e-01   +4.266165321456514e-01   +3.589051494099459e-01   +5.272010519017887e-01   +6.815834500763255e-01   +1.353633117666898e-01   +7.420708045054787e-01   +9.217680631462177e-02   +6.362848664297183e-02   +1.862231440811324e-01   +1.726520084906658e-02; +3.909418415149157e-02   +9.349110606624020e-01   +3.309525823998786e-01   +9.167717806318472e-01   +8.491111539530659e-01   +7.663715770340207e-01   +8.883826247182118e-01   +5.567067690873155e-01   +6.621494626488612e-01   +9.965665795275667e-01   +1.225279728321498e-01   +1.496728499071587e-01; +9.567430821538262e-01   +5.344622438155302e-01   +4.253619601143130e-01   +8.467499193827959e-01   +1.776047469149543e-01   +1.316601382814923e-01   +3.468126916682401e-01   +3.242017229422558e-01   +5.996319793518503e-01   +3.005559932034996e-03   +7.750572431496415e-01   +4.965025433194391e-01; +5.127542557097131e-02   +9.629352919913635e-01   +3.269649731095066e-01   +9.886036362135752e-01   +8.433402939773188e-01   +8.873830195622012e-02   +8.034653170414058e-01   +1.619491571696198e-01   +8.590990744604073e-01   +4.049602118131641e-01   +7.651259293446339e-01   +4.430551410016389e-01];
L3E_L3I_iGABA_netcon = [+4.059694190232120e-01   +5.673725320348049e-01   +4.888752880392737e-01   +2.754363751753702e-01   +1.471547398555586e-01   +6.371828278836656e-01   +2.693769710186503e-01   +9.434932763256715e-01   +6.372158525094270e-01   +6.400518955593339e-01   +4.894350559489294e-01   +1.114943037042286e-01; +2.297107000311484e-01   +7.840175411082807e-01   +7.948637476646514e-01   +1.325131713868539e-01   +8.592395769874290e-01   +5.707861309561100e-01   +4.263342073200840e-01   +7.639191304911692e-01   +1.407055369531686e-01   +3.662290898245264e-01   +9.569393482909918e-01   +8.952676162659028e-01; +4.326561970060747e-01   +5.257599046095474e-02   +8.127383699495893e-01   +7.161262598142009e-01   +8.568723775048401e-01   +8.129475138138831e-02   +1.295961756252526e-01   +8.264455385221392e-01   +9.351948362515971e-01   +5.775057599909351e-01   +1.262312062600648e-01   +9.197712289799487e-03; +3.601603643832831e-01   +1.329680779353865e-01   +4.098728051902922e-03   +4.256262691762482e-01   +3.831005544525240e-01   +7.668091328906532e-01   +1.650354914946739e-01   +1.935987290717273e-01   +9.780907044414118e-01   +8.071446908397024e-01   +3.450941381364939e-01   +7.228686683812742e-01; +5.507386297653005e-01   +3.029717838421034e-01   +9.557576620727160e-02   +7.707703007465454e-01   +3.847368479636086e-01   +6.253421335376237e-01   +3.422417711164398e-01   +3.995492037623655e-01   +2.905859546715914e-01   +6.068415008442634e-01   +9.116713121548674e-01   +7.405114446569683e-02; +8.429418206517090e-01   +5.949811831829945e-01   +6.423843334705568e-01   +5.906506227555371e-01   +6.432882232739042e-01   +8.664433612698927e-01   +8.798434632876746e-01   +4.132696373063998e-01   +4.274356718057227e-01   +4.993556708748549e-01   +1.729417922995957e-01   +3.524527352084494e-01; +1.517934476698490e-02   +2.804975872186067e-01   +6.603831324229072e-01   +7.767854334970858e-02   +9.240549245777516e-01   +6.280908730511925e-02   +8.290101125872459e-01   +3.152988990566900e-01   +3.157265230762746e-01   +8.932138742807056e-01   +1.036711573530327e-01   +4.644347591943082e-01; +5.599468699196662e-01   +7.845656132454759e-01   +6.967293520122357e-01   +7.998460522242072e-01   +8.041102208828858e-01   +9.439081010949246e-02   +8.543514579713615e-01   +3.808758541384432e-01   +9.411966034474450e-02   +6.434371086428448e-01   +1.004273301616839e-01   +1.693822620937311e-01; +2.118255068437370e-01   +4.424915939149343e-01   +8.855754472228710e-01   +5.779520085863258e-01   +8.385068535368366e-01   +1.434794662507688e-02   +6.835010872162062e-01   +2.454453609142138e-01   +4.636288104152029e-01   +8.773824944044739e-01   +5.407746955975081e-01   +9.089248399263085e-01; +1.551489177278517e-01   +7.799085206563572e-02   +3.463705168100186e-01   +8.295720989929355e-01   +4.491716344773089e-02   +7.506752870744843e-01   +9.877099616935447e-01   +6.083067535657127e-01   +7.291663895730669e-01   +2.488135972006857e-01   +4.735652121226918e-01   +2.914325998363876e-01; +3.752476381560532e-02   +6.256075947372453e-01   +6.160339230877654e-02   +1.719400149685868e-01   +3.071265215375706e-01   +9.738311315919823e-02   +3.641834956450194e-01   +6.495778614731368e-01   +4.147277014434427e-01   +5.677482319852214e-01   +2.993367143089909e-02   +8.478213555075678e-01; +7.137818057456324e-01   +3.877482861693553e-01   +9.582459648461752e-01   +8.754445611959606e-01   +5.004538307407259e-01   +8.287571255133279e-01   +3.805846287695129e-01   +2.795486530277920e-01   +1.773260121350396e-01   +1.804582319077038e-01   +8.818143037030156e-01   +7.517550505898657e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last =  5.6 * ones(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  5.6 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
