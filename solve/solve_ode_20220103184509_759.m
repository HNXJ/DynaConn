function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.142123278731372e-01   +9.461025509972745e-01   +6.983199405972269e-01   +1.548711600904286e-01   +9.217591779221276e-01   +2.196382305731668e-01   +7.405316900155540e-01   +3.025727065840009e-01   +5.332429688281175e-01   +8.288881281021824e-01   +9.686343080823806e-01   +9.643914006701958e-01   +6.962165729816117e-01   +3.713750564318474e-01   +2.974056108816011e-01   +3.780934753642948e-01; +3.456573788579078e-01   +1.343612499943573e-02   +1.414700943349105e-01   +1.763391051382904e-01   +7.071788303975117e-02   +8.078016549356701e-01   +7.943527413246938e-01   +7.588861701687294e-01   +7.844109587133554e-01   +1.811761659453250e-01   +4.663824633539058e-01   +6.559196296049898e-01   +3.761457763354809e-01   +2.754661197759635e-01   +6.848616156600098e-01   +9.535264831257818e-01; +2.079733746134718e-01   +4.676781103051388e-01   +8.347535899571315e-02   +7.029862366162073e-01   +3.133184291885182e-01   +3.815229147315450e-01   +6.633276359040307e-01   +9.531853275980973e-01   +4.863030910423880e-02   +9.261679093134950e-01   +8.694185336740629e-01   +2.093961034408095e-01   +5.418414297644734e-01   +7.536423306866145e-02   +7.730919974055767e-01   +8.116612732564614e-01; +2.478720576427656e-02   +4.896358043633606e-01   +4.326615182551984e-01   +8.324651148714327e-01   +6.281808541309912e-01   +8.566342124195544e-01   +4.409971697861177e-01   +8.609579785305039e-03   +4.622664480640200e-01   +4.207866139345686e-01   +9.464475240936336e-01   +8.971118168377294e-01   +5.183140125543547e-01   +1.508279246417106e-01   +7.203777926780087e-01   +8.922225639736333e-01; +7.659789863309736e-01   +5.157676762510328e-01   +8.951109019665038e-01   +8.144641862335043e-02   +9.056285560325154e-01   +3.228628157424060e-01   +5.753898922161180e-01   +4.068542402713853e-01   +9.375826839375387e-01   +3.000974222083382e-01   +2.321980591060055e-01   +4.877718034604443e-01   +7.637096362640757e-01   +3.649736983003642e-01   +2.782204968482568e-01   +6.858156782378647e-02; +5.710341548343052e-01   +2.871589698514981e-01   +7.319059327079807e-01   +8.344885465060826e-01   +7.965213512893137e-01   +3.791694346835474e-01   +5.184393303483367e-01   +1.519743666688114e-01   +4.734202588077139e-01   +3.488285161324262e-01   +9.181893293041360e-01   +6.620054416516274e-01   +8.012136949790866e-02   +7.171433860921027e-01   +1.378138533127517e-02   +9.022373511032123e-01; +5.766896222585700e-01   +5.649543796667141e-01   +6.803897955396625e-01   +5.415209055270680e-01   +6.429333433063086e-01   +6.368712691318433e-01   +7.249629810839251e-01   +8.215279476623835e-01   +7.787848227322974e-01   +9.714287268827279e-01   +6.344718868338102e-01   +5.263184480507589e-01   +5.002894394167702e-03   +5.320773722751331e-01   +1.501204648301162e-02   +6.677503421940360e-01; +3.900457806326437e-01   +5.097375894282935e-01   +2.017657497138990e-01   +9.624286692712387e-01   +4.402377422264864e-01   +3.871603222242462e-01   +2.227303874953105e-01   +2.876612051467818e-01   +1.094984452099283e-01   +5.305069958995238e-01   +2.846263447083705e-01   +7.087449357664816e-01   +4.006790038059047e-01   +2.322547222758058e-01   +9.364507679552120e-01   +3.470911341936160e-01; +5.568109427222218e-01   +6.784681377536843e-01   +5.296610010278471e-01   +6.774522428005014e-01   +7.485381879795504e-01   +6.751990282153085e-02   +9.976926379951511e-01   +9.778591372578104e-01   +5.216410446531556e-01   +7.898542425635381e-01   +8.556490487788578e-01   +7.183376413433331e-01   +6.629567062931138e-01   +4.709571084845215e-01   +9.339451675511146e-01   +8.368948883267417e-01; +1.833027511348319e-01   +6.155943999202432e-01   +8.306056365599913e-01   +3.361645189345132e-01   +8.254204045034244e-01   +1.726786614867460e-02   +6.197647448510439e-01   +6.259168655340931e-01   +6.358881365474983e-01   +7.944338956390106e-01   +1.658878814029483e-01   +2.941763803784975e-01   +3.682147192908644e-01   +7.170262445721446e-01   +3.737595160915009e-01   +1.989755349830569e-01; +1.181655644562615e-01   +5.652720725793741e-01   +1.753535167646304e-01   +2.206671925741079e-01   +3.414307145206750e-01   +8.791786549601487e-01   +9.801259592762182e-01   +7.432961624025832e-01   +5.785676760893733e-01   +1.441951299137877e-01   +8.275814779764683e-01   +1.170908264133119e-01   +3.926864391875267e-01   +5.142452486238099e-01   +1.087794213345523e-01   +8.414821062893761e-01; +5.927795775882681e-02   +5.051580184635781e-01   +5.178508952564166e-01   +5.685672772776471e-01   +1.390302474384744e-01   +1.577570219132001e-01   +4.956462561173093e-01   +8.721880315716322e-01   +8.356124401797100e-01   +4.566151940600043e-01   +2.170379074121885e-01   +3.248363103581100e-01   +1.343814299448396e-01   +5.133920698011679e-01   +7.194318137541689e-01   +4.246134776967500e-01; +9.327608867147242e-01   +6.675963993230049e-01   +3.563864467362079e-01   +4.202146771024946e-04   +5.041419134867607e-01   +9.139256527856512e-01   +5.223716165106985e-01   +3.294298660881670e-01   +1.152607068648120e-01   +4.582140848946181e-01   +2.674904790145842e-01   +4.570379669611156e-01   +3.381075069083089e-01   +3.858024159461284e-01   +4.488799450138968e-01   +5.584707396882496e-01; +7.455964573149857e-01   +6.332995352795836e-01   +6.458200589752960e-01   +5.885956527229771e-01   +4.138320603168731e-01   +5.566571240423887e-01   +8.540325132392220e-01   +9.849542525114245e-02   +5.130281683029028e-02   +9.543586292441686e-01   +8.680119360863287e-02   +7.163329481356946e-01   +1.230768726056144e-01   +4.787041770545730e-01   +1.280950243279204e-02   +4.473501581104556e-01; +2.434170336947427e-01   +1.442305941124918e-01   +2.817513483962216e-01   +8.909176070091247e-01   +1.715751678816823e-01   +9.222566481540698e-01   +2.536052885725446e-01   +4.504307646415815e-01   +5.177555984531085e-01   +5.320151690562715e-02   +9.167134174493826e-01   +4.052984311761202e-01   +3.686189985882203e-01   +7.395945601826773e-01   +1.238715406509879e-01   +7.600550355120103e-01; +2.041655694442782e-01   +1.787712457537448e-01   +4.366684995586529e-01   +2.544276727703982e-01   +4.942654390640751e-01   +5.977230089159369e-01   +5.824429742660506e-01   +2.397888970330956e-01   +6.966634923203598e-01   +3.592655964797871e-02   +7.260164290772138e-01   +2.419853152301243e-01   +2.506465175615439e-01   +7.014762686354717e-01   +6.589612530324429e-01   +9.552014114110709e-02];
L1E_L1I_iGABA_netcon = [+8.433627389321398e-01   +7.522375250954900e-01   +8.743406497848631e-01   +4.357048319237054e-01   +9.181260413039835e-01   +7.791891010694133e-01   +3.217244797823607e-01   +6.412503054452724e-01   +9.432998917423391e-02   +2.617368719009749e-02   +1.290740403105450e-01   +5.196409870791699e-01   +8.695486837872765e-01   +5.757930912586052e-01   +1.659414701408338e-01   +6.277033335323798e-01; +6.208927703829934e-01   +9.953927232352093e-01   +3.094004985333220e-01   +1.474498136643845e-01   +8.832716065927499e-01   +2.729835645786819e-01   +9.631071406483269e-01   +4.295776889313607e-01   +2.930970689040968e-01   +5.139648425464899e-01   +4.245639636904011e-01   +2.040176726771328e-01   +8.026976989124969e-01   +2.885062704704826e-01   +5.459961417467960e-02   +3.365716173391931e-01; +6.711260268888931e-01   +3.709917520191547e-01   +4.331723996665390e-01   +6.541734050378550e-01   +5.857134589703946e-01   +5.267576700077947e-01   +3.523953413560472e-01   +4.784248796130645e-01   +3.268027174181764e-01   +8.624198524394101e-01   +4.809606744228618e-01   +7.751751092159440e-01   +6.462421438616511e-01   +1.318443425196687e-01   +2.116223324513201e-01   +1.567657761553056e-01; +7.820733753457126e-01   +5.029635376688506e-01   +3.816212749770723e-01   +7.213910465627105e-01   +8.355614624911389e-01   +4.028891566994066e-01   +3.201807844481805e-01   +9.999917666389901e-02   +4.830977585848873e-01   +5.818788028045475e-01   +6.737700592666452e-01   +3.912320584008319e-01   +7.346365671535867e-01   +5.048129941270010e-02   +2.043501555519633e-01   +4.019859039851374e-01; +3.090899143578238e-01   +7.581445141065809e-01   +6.568014110285849e-01   +1.617501774672225e-01   +7.760124923335360e-01   +7.793067182866991e-01   +9.089142505352009e-01   +8.065987146389477e-01   +2.412990836370926e-01   +4.219729390791599e-01   +3.570287752792471e-01   +6.667534526779190e-02   +6.669997722706658e-01   +6.236345966488639e-01   +2.178686780920185e-01   +9.128819526579953e-01; +3.294666130875330e-01   +1.267824596934799e-01   +2.376023053551009e-01   +3.430878461561266e-01   +7.856604282432683e-01   +2.552198837024297e-02   +8.853261872424008e-01   +6.487289025766164e-02   +4.540077044478703e-01   +7.136267332442437e-01   +4.949834947913120e-02   +7.562404234164078e-01   +8.810178840057414e-01   +6.050082582543227e-01   +5.784331560750585e-01   +1.490020866379544e-01; +6.339507544091737e-01   +5.183097864946261e-01   +6.862431064915381e-01   +1.061957494699780e-01   +7.013020474986131e-01   +4.113780200272361e-01   +3.530528845437165e-01   +9.545700531144496e-01   +7.583652857655820e-01   +2.338250956968402e-01   +2.907062116460265e-01   +4.534574994167488e-01   +8.528738593849412e-01   +3.714088657278727e-01   +3.350779746079197e-02   +4.639810166643468e-01; +9.021060785464893e-01   +9.060863641578782e-01   +3.266879621660196e-01   +4.121180592436803e-02   +1.798900126270872e-02   +8.261067141233360e-01   +7.502230299052345e-01   +7.737068208975129e-01   +7.178432920500188e-01   +5.943777631001847e-02   +7.943776769088010e-01   +3.197190950045976e-01   +4.035190416810815e-01   +8.316964969889665e-01   +7.953623828829994e-01   +7.782566342068416e-02; +3.715024884490143e-01   +9.916020325964307e-02   +8.804374816145465e-01   +4.786024542821824e-01   +3.305105943130748e-01   +5.927512610986568e-01   +1.268231606610817e-01   +4.405969095923583e-01   +2.384555782782022e-01   +9.767302714588662e-01   +6.513253632053430e-01   +2.773002363971319e-01   +1.049971917219445e-01   +5.201970691649094e-01   +1.349620657820889e-01   +3.425554306435121e-01; +8.817010123965093e-01   +1.789664449258676e-01   +9.989845782722346e-01   +4.773543649027259e-01   +9.471705979309173e-01   +2.127461705366100e-01   +5.995261351578125e-01   +1.654001561306479e-01   +6.990921082989705e-01   +9.695299318045979e-01   +7.096789171947494e-01   +5.841895070286494e-01   +4.038384950956476e-01   +8.008511994740242e-01   +5.827229282189647e-01   +4.957531960247594e-01; +1.244081647573187e-01   +1.729212333753193e-01   +6.812488120703392e-01   +5.457204386261675e-01   +3.988627872369044e-01   +2.968507505066217e-01   +4.368564727204231e-01   +8.095566216759005e-02   +3.061593684697393e-01   +1.369495421016892e-01   +7.647326400161172e-01   +9.117190001932302e-01   +3.405647273442486e-01   +5.700999861518202e-01   +8.589390720383674e-02   +4.896678251301965e-01; +8.804992818840771e-02   +5.343835088017741e-01   +3.450773120067371e-01   +6.523914537204704e-01   +6.317310325607794e-01   +2.684807496351417e-01   +9.586892107637859e-01   +7.418600873183417e-01   +4.694216021627707e-01   +1.785933277856920e-05   +3.846525463352067e-01   +4.511688609161683e-01   +1.146577998215842e-01   +7.145633808707341e-01   +2.284889618331579e-01   +1.274774893832213e-01; +5.461167740382480e-01   +9.793179639735461e-01   +5.609673426423560e-01   +3.489797705421060e-01   +8.594313296866425e-01   +9.285201374622777e-01   +9.645197116025838e-01   +5.440956617260529e-01   +4.443050889199587e-01   +9.361428644727957e-01   +3.615846963416202e-01   +9.804446137108468e-01   +8.521904911924661e-01   +7.331015762063526e-01   +4.524726622615375e-01   +8.535958488614397e-02; +6.106028362212591e-01   +8.434056477681536e-01   +8.907175440969545e-01   +2.565057838380015e-01   +3.768201175136647e-01   +5.532445112451559e-01   +2.424915186072674e-01   +4.855411561615661e-01   +7.339432585409975e-01   +7.406832549695678e-01   +8.106175845962716e-01   +1.108417827415330e-01   +8.918859565155169e-01   +4.546265637485615e-01   +1.794071154540337e-01   +6.736116888406927e-01; +7.276468942712780e-01   +6.726224308507592e-01   +6.465505534688801e-01   +1.761956557095999e-01   +2.044710359830089e-01   +4.331542866942243e-01   +7.705344054034912e-01   +8.953887779634946e-01   +8.753989343218811e-01   +4.334462405839931e-01   +3.851115428926654e-01   +4.160641212666017e-01   +6.856890603019092e-01   +2.828549078393334e-01   +4.152578646449429e-01   +1.218505768996145e-01; +9.913185544942261e-01   +8.529860666495527e-03   +3.771578098240211e-01   +4.780711549272613e-01   +9.117390855477823e-01   +3.282553427362614e-01   +7.125871629718802e-01   +5.832049653957477e-01   +9.129201091524275e-01   +9.437647197793477e-01   +8.712526431594040e-01   +3.830003897036425e-01   +7.424622489126562e-01   +1.518597246478845e-01   +9.652407088897975e-01   +9.894152615528582e-01];
L2I_L1I_iGABA_netcon = [+5.744937205144320e-01   +5.644965600222023e-01   +1.083790503834235e-01   +4.593139119113209e-01   +7.964246475984997e-01   +9.787045800290493e-01   +2.239748252924627e-01   +7.586282876190232e-01; +5.578657806782287e-01   +9.528254513071055e-01   +1.191877667320923e-01   +5.679278210838034e-01   +5.420414978684271e-01   +4.229662318664308e-01   +6.564311908129081e-02   +5.060757195547423e-01; +6.112571768094308e-01   +9.108210341479009e-03   +4.335736521890085e-01   +8.179092402549007e-01   +2.571476080668822e-01   +3.934170264488830e-01   +8.355391597953521e-01   +8.276618795786822e-01; +4.669371234115665e-01   +1.266587416989730e-01   +9.327186714645572e-01   +3.546907142759663e-01   +7.818373989421337e-01   +4.606931070387076e-01   +4.128810376559974e-02   +9.275091053363619e-01; +4.344633679101074e-01   +8.530525266822618e-01   +1.401668969642301e-01   +2.485205556559663e-01   +7.788172977528858e-01   +1.209946754533358e-01   +9.096225128405765e-01   +7.105125300013879e-01; +6.295821075234322e-02   +2.178609846045414e-01   +8.262917152958387e-01   +7.708656675684944e-01   +1.442337035837409e-01   +4.548818567355070e-01   +4.502172202966770e-01   +7.978017828924765e-01; +6.467013316425888e-01   +7.096734133033235e-01   +9.324914887246052e-01   +2.469550066982036e-03   +8.232299285594140e-01   +2.658103527304620e-01   +2.853547067318931e-01   +9.578657537615515e-01; +4.260434505455701e-01   +7.746371559029558e-01   +5.730288882699384e-01   +2.760524496361751e-01   +6.231485783712228e-01   +9.294677689313945e-02   +7.546317573334997e-01   +9.512051041575603e-01; +7.562427086057707e-01   +4.208685179544942e-01   +4.987070896113923e-01   +2.345224079232489e-02   +4.573542593300959e-01   +6.621749839132671e-01   +9.265067228021204e-01   +2.955512430005020e-01; +3.070839062474781e-01   +7.251661141349803e-01   +9.311252490525206e-01   +6.700742219131318e-01   +4.841343118957877e-01   +9.454943471534195e-01   +1.414666136369880e-01   +3.520840454556292e-01; +5.983707907582421e-01   +4.580932274848620e-01   +8.617600385604738e-01   +9.672028524644096e-01   +2.192245011836366e-01   +7.645995844362287e-01   +9.560213535666241e-01   +5.410264944723848e-01; +3.346892690831183e-01   +8.047846574467827e-01   +2.533573751606418e-01   +9.454080232192429e-01   +8.577975721863974e-01   +4.273676725545161e-02   +3.038046796965660e-01   +2.134682707097935e-01; +6.435425326086968e-01   +4.278654490396655e-01   +4.588099806063884e-01   +4.709885315648681e-02   +8.798120329350299e-01   +2.616512071872427e-01   +2.094285394549740e-01   +8.094005028708534e-02; +1.364606748643330e-03   +1.488282846548671e-01   +7.404938376316123e-01   +2.863834865472554e-01   +8.455669637254462e-01   +6.346709892584795e-01   +4.641957118588022e-01   +5.066044411697607e-01; +1.443650445023971e-01   +8.046797080547540e-01   +7.523564955513399e-01   +4.872462659761060e-01   +4.427457740665589e-01   +8.980390042402253e-02   +5.970724798654222e-01   +1.949326452910917e-01; +2.478965939186648e-01   +3.814755033086697e-01   +2.306373219720817e-01   +8.869518345869998e-01   +5.434605153961796e-01   +7.465593693088747e-02   +5.523968412490154e-01   +1.448052839271299e-01];
L1I_L2I_iGABA_netcon = [+6.984813101962642e-01   +8.672992053814367e-01   +6.136172726566469e-01   +5.496114442633741e-02   +1.428995619236285e-01   +2.350127096075620e-01   +8.385367672477150e-01   +3.707967624639404e-01   +7.061680058310221e-01   +3.844167741510393e-01   +2.392143450176241e-01   +6.664632038664401e-01   +1.675331788996200e-01   +5.702056519721456e-01   +4.405469464387394e-02   +4.944801287337974e-02; +5.972995948143637e-01   +7.980454182859740e-01   +6.106038848654750e-01   +5.730834530632843e-02   +7.446381933679487e-01   +5.562214822433055e-01   +1.977366035897790e-01   +5.590828117866578e-01   +1.869099276469347e-01   +7.198123384061575e-01   +5.130686983054913e-01   +3.298833237337348e-01   +1.159512624098409e-01   +8.094863833542937e-01   +4.422603651668501e-01   +9.213374475844414e-01; +1.626057205813171e-01   +6.274191578571430e-01   +3.136221442222715e-01   +5.970645669882081e-01   +9.509954121676983e-01   +1.136790865304547e-01   +6.170646101660666e-01   +8.300809552103287e-01   +2.309222703814158e-01   +6.411966690290841e-01   +7.322546731293529e-01   +5.514196992573831e-01   +7.365600617108088e-01   +6.734555678659060e-01   +9.168988004402416e-01   +1.738598712063442e-01; +4.826351036944735e-01   +4.719656211030228e-01   +1.421233201460130e-01   +6.573278654439528e-01   +2.660039996379904e-01   +8.184482246043236e-01   +1.545606365685869e-01   +7.075529343855005e-01   +9.985110923620732e-01   +1.008345561907993e-01   +7.714791650376288e-01   +5.321582873561521e-01   +2.107072521688352e-01   +4.438109932376486e-01   +8.842599843548137e-01   +7.437129974652226e-01; +2.858165131312594e-01   +1.975005766542065e-02   +6.049615003228258e-01   +4.797345845521235e-01   +9.542911102731068e-02   +6.506644582761414e-01   +5.835406970344184e-01   +1.155365755393557e-01   +9.052283272399702e-01   +4.920883066760704e-01   +6.767195160507939e-01   +9.015195934002317e-01   +4.838034083995552e-01   +8.938271978238737e-01   +9.263993563472049e-02   +4.757543538114399e-01; +4.032644243315561e-01   +1.176411876967692e-01   +8.902750165402168e-01   +9.789111545569513e-01   +2.309031308329714e-01   +2.375365029894646e-01   +5.452982459771396e-01   +7.401705386152935e-01   +1.149626457758644e-02   +5.623295220795101e-01   +8.127880341526206e-01   +2.841924383070114e-01   +5.076934418913629e-02   +7.836414169893268e-01   +6.754430554961374e-01   +2.462816599620974e-01; +4.905398655313355e-01   +7.191696494705144e-01   +5.623895424470092e-01   +8.635394289854028e-01   +8.958106173051457e-01   +3.015224098753811e-01   +6.819783818227851e-01   +9.243381307291719e-01   +8.343555568575336e-01   +5.610212106174704e-02   +4.183424269086434e-01   +1.393243343621478e-01   +5.714545971778220e-01   +5.818272860072589e-01   +9.312981714846355e-03   +6.628664708417976e-01; +8.622780693802677e-01   +6.823760271174071e-01   +6.329610598481766e-01   +9.540075588974801e-01   +1.992422122083477e-01   +3.304326727160263e-01   +6.986800234709176e-01   +9.233604303935798e-01   +2.524533445246182e-01   +8.965666455834335e-02   +4.975675314830919e-01   +9.570344816112403e-01   +4.913171669969118e-01   +6.160941862381292e-01   +1.209579340220848e-01   +6.087278543922824e-01];
L2E_L1E_iAMPA_netcon = [+3.678341345150017e-01   +5.624400376149737e-01   +2.006609676350261e-01   +5.148107196196847e-01   +2.897623390221847e-01   +7.465561812366214e-02   +2.781578117761034e-01   +2.665965247471062e-01; +4.376609054148142e-01   +1.929371522341763e-01   +1.372995597111271e-01   +6.851242333055388e-01   +6.200376420710952e-01   +5.942299279767244e-01   +9.284606886967698e-01   +9.044734111568640e-01; +7.180419342000134e-01   +6.135132630448229e-01   +8.185514170653010e-02   +2.072946730455893e-01   +8.627659751714573e-01   +7.692859410917452e-02   +7.638378485016583e-01   +1.594624459007176e-01; +1.914198209235349e-01   +7.403095528625463e-01   +9.121582044765567e-02   +9.720072902821740e-01   +8.206788350440506e-01   +3.972517037929045e-01   +2.627848882046825e-01   +5.540344477685678e-01; +4.054935574519036e-02   +8.321845900618809e-01   +5.516049227696557e-01   +3.507550621801728e-01   +2.060070826963560e-01   +5.970432829883942e-02   +2.424789532224041e-01   +4.230870354807870e-01; +3.148884932407009e-01   +2.778139563016895e-01   +7.316944800645117e-01   +1.842582204960165e-01   +7.509211140139985e-01   +1.286649865481360e-01   +1.658633603563573e-01   +5.477706534911774e-01; +7.898692431854843e-01   +6.081362863712801e-01   +5.441932064520514e-01   +2.381949799773951e-01   +1.988171449001742e-01   +2.439851390461755e-01   +2.875804607019917e-01   +7.543556104873401e-01; +4.758240309985532e-02   +5.473185886979776e-01   +5.481154507354381e-02   +2.543711821306099e-01   +5.776703319787152e-01   +9.437062741219350e-01   +5.643620083414299e-01   +1.325019608529014e-02; +2.158415537849696e-01   +2.746540063186677e-01   +6.327147620758935e-01   +2.223432511249662e-01   +8.767992805586174e-01   +2.034570114436381e-01   +4.046298929135174e-01   -9.883884873192685e-04; +2.740127370103335e-01   +3.402691729992482e-01   +9.944796838254840e-01   +3.556598321981693e-02   +7.139252988965131e-01   +3.269523723516614e-01   +9.861324026395064e-01   +2.115987681445084e-02; +7.893169062495276e-01   +5.667704906925898e-01   +9.148397276869875e-01   +3.564087300809516e-01   +7.006856853705778e-01   +8.666524117977810e-01   +5.445704803255014e-01   +3.591296427960690e-01; +9.904980953101892e-01   +7.436416517175172e-01   +7.683706633864559e-01   +8.990591541254800e-01   +4.678524222767778e-01   +9.226131730018517e-01   +9.285451277935314e-01   +4.263661870166815e-01; +9.481707464594154e-02   +7.715237399475713e-01   +1.919865060631678e-01   +1.396641405138939e-01   +5.046885231695173e-01   +2.332745309699223e-02   +9.919939534379557e-01   +5.453797661445323e-01; +1.957765953711948e-01   +3.982947597131100e-01   +3.238205389402388e-02   +9.553114828155495e-01   +7.966671143406004e-01   +3.641756840372097e-01   +8.357159612966992e-01   +4.924714242867101e-01; +1.165235058869730e-01   +1.490146784402792e-01   +3.737577827853260e-01   +9.019608131575759e-01   +9.396528546461053e-01   +5.280105529855862e-01   +1.804429140909828e-01   +9.205389822935874e-01; +6.473937860920421e-01   +2.080636986115087e-01   +5.752714661563970e-01   +4.099571687588418e-01   +7.821156345245948e-01   +4.064388716691664e-01   +3.136075651038107e-01   +4.162892583893913e-01];
L1E_L2E_iAMPA_netcon = [+4.968695297032380e-01   +4.500947645117475e-01   +6.163766868892125e-01   +4.905728989014435e-01   +2.301950684748262e-01   +7.216077062609546e-01   +6.945351028526033e-01   +6.325392268687106e-01   +5.225416688276507e-01   +2.406214943408951e-01   +8.771223911279096e-01   +1.740593800872480e-01   +1.370787489902025e-01   +2.434697908777209e-01   +1.837551348901411e-01   +2.317017617938924e-02; +8.382396179492655e-01   +3.695308391236705e-01   +1.031244589305703e-01   +6.615301521209362e-01   +8.359815620314704e-01   +3.808248141939634e-01   +9.802643565121635e-01   +6.265817965083568e-01   +6.729327897906392e-01   +7.291590899719951e-01   +6.583581544552369e-01   +3.029642507731373e-01   +2.828081177734225e-01   +7.484814283353725e-01   +1.462482151098091e-01   +2.513599019996884e-01; +1.851236838305981e-01   +3.001470353448638e-01   +7.521090398251076e-01   +1.782170885180067e-01   +7.345360788462187e-01   +3.842975791345699e-01   +7.502123769606266e-01   +4.074616275702816e-01   +7.769686011014543e-01   +1.360609201471235e-01   +5.375138740787478e-01   +1.091804683595050e-01   +6.920107982367492e-03   +9.368791082401999e-01   +1.324364064385516e-01   +9.891404763744926e-01; +3.365435207892227e-01   +2.332004389692826e-01   +5.369803493721813e-01   +4.786908148431226e-01   +4.893290891140194e-01   +7.155092015506229e-01   +5.530907344024032e-01   +4.250922856023273e-01   +4.636042413396114e-01   +4.075421178352018e-02   +2.519915648952867e-01   +4.512080651834908e-01   +3.059701274328713e-01   +2.981593453555280e-02   +1.720098426299389e-01   +6.294160713959265e-01; +6.929345348336332e-01   +1.369270676908368e-01   +4.438680705455167e-01   +4.990562130232885e-01   +8.486360353742916e-01   +8.386189385803248e-01   +2.940590993273287e-02   +5.102868850085949e-01   +9.077569856654465e-01   +6.500136926640477e-01   +1.053238907031302e-01   +5.844000930906500e-01   +9.049861379982151e-01   +4.352651898374402e-01   +9.224121963969450e-01   +3.580820041303112e-01; +6.924161489115117e-01   +9.985743587471392e-02   +7.436326730524210e-01   +6.004828713377047e-01   +7.146130081666537e-01   +6.681659686702945e-01   +1.953387731643777e-01   +2.594820762135607e-01   +2.529984911009352e-02   +2.000342524776317e-01   +9.714715893564704e-01   +2.245937277143184e-01   +2.939785516612449e-01   +8.316062079375484e-01   +2.592729679563701e-01   +9.401579121432997e-02; +3.680173583645692e-01   +2.267683017927314e-01   +3.873679002785538e-01   +2.404545851519179e-01   +5.222675140224223e-01   +6.504793687948730e-01   +9.415565107738998e-01   +4.231400729322140e-01   +4.805310124448547e-01   +9.731662402009318e-01   +5.973402977942003e-01   +1.107267653644327e-01   +8.333901126192251e-01   +9.991928312179725e-01   +2.056043861536465e-01   +4.092097897586518e-01; +3.432849421763229e-02   +3.465188460137933e-01   +5.263104714519684e-01   +5.171317602156840e-01   +9.378198681017594e-01   +5.640728985073292e-01   +3.971715356668344e-01   +5.231819411699378e-01   +2.710642125850012e-01   +8.206297101731463e-01   +8.192887797976239e-01   +5.612062570421610e-01   +7.453889166448301e-01   +9.204904556649969e-01   +6.135480713233292e-01   +9.312720228600611e-01];
L2I_L2E_iAMPA_netcon = [+6.775182456907172e-01   +6.143875580556457e-01   +4.184128466350543e-02   +7.927958840059937e-01   +5.235434993035385e-01   +8.261121516053517e-01   +6.442809256122974e-01   +3.863709681739856e-01; +2.314337561402273e-02   +9.450147775369554e-01   +5.462516764278588e-02   +9.301769391529678e-01   +5.338169054308142e-02   +1.082575037693175e-01   +3.969142862806425e-02   +1.671182244131601e-01; +7.343777278410826e-01   +9.643769284541016e-01   +4.014019458795522e-01   +9.366171027930511e-01   +2.872351269341044e-01   +2.306980817708601e-02   +5.681414650757061e-01   +4.440313314745255e-01; +2.138853885606549e-01   +3.696148855995591e-01   +9.840375690168017e-01   +1.462520786682687e-01   +7.094672458822281e-01   +1.229353883643003e-02   +3.048758673964990e-01   +8.734061013231296e-01; +8.609938592175187e-01   +7.952688952035120e-01   +7.122658712574567e-01   +3.197360420699779e-01   +8.782041608960578e-01   +3.365210358400120e-01   +2.607851789371022e-01   +4.114619210184197e-01; +1.569272365711158e-01   +7.288140784495323e-01   +9.889159401746946e-01   +4.285572294753008e-01   +3.655313949861275e-01   +6.637867543011988e-01   +7.217705940330963e-01   +1.627543772845912e-01; +6.685164864465613e-01   +9.539763577063169e-01   +6.456095775395254e-01   +7.020560894763106e-01   +5.606701919446930e-01   +5.952800357680740e-01   +3.055853832939724e-01   +6.621101774659874e-01; +9.352069767447221e-01   +1.100516936222617e-02   +5.019130961241562e-01   +6.147740531748077e-01   +8.840389657624119e-01   +7.985081132844379e-02   +8.957251805230503e-01   +9.251733695810410e-01];
L2E_L2I_iGABA_netcon = [+5.979382287542181e-02   +5.203004893756541e-01   +3.522800492332552e-01   +2.618843685866111e-01   +4.227608658739441e-02   +8.906390838566782e-01   +3.442182113051681e-01   +4.513671407336681e-01; +3.539001766148229e-01   +6.943963776888368e-02   +5.570808999844742e-01   +9.841082040245500e-01   +3.609349956895740e-01   +5.402623176094268e-01   +9.351651071095114e-01   +6.711154233727562e-01; +9.329326331927481e-01   +1.846197822258868e-01   +6.917744282730494e-01   +3.493587674646065e-01   +3.598919737850365e-02   +7.170068550907308e-01   +9.184739939639229e-01   +7.689623712267550e-01; +2.412255080267040e-01   +3.166395491838335e-01   -5.934807294063507e-03   +4.020995455389022e-01   +4.861892292545083e-01   +7.100790656734524e-01   +7.246941235436106e-01   +9.268309241770036e-01; +1.028360320754007e-01   +2.439399295209187e-01   +4.845482783698624e-02   +7.522831492813614e-01   +7.227687600305243e-01   +1.688547709578549e-01   +4.429113013287480e-01   +6.584365680065416e-01; +7.162869497595246e-01   +3.218227776201276e-01   +3.087250541212685e-01   +1.013535038150792e-01   +1.442464022482991e-02   +3.515218404962178e-01   +1.518898693843441e-01   +5.014161456569585e-01; +5.695491000097369e-03   +8.792972111517520e-01   +8.689746472110603e-01   +5.904103629188227e-01   +5.171849387510246e-01   +3.793444001890252e-01   +8.317951457675439e-01   +3.423176839578947e-01; +1.852742215995059e-01   +3.014124098133766e-01   +6.276849012554014e-01   +1.227369314379698e-01   +2.393477794754433e-01   +7.581648972027530e-01   +2.569095295040271e-01   +9.461515660144053e-01];
L3E_L2E_iAMPA_netcon = [+7.916250691246354e-02   +1.621751930615858e-02   +3.678067961688698e-01   +4.967719629907913e-01   +1.856208516047847e-02   +9.554733945969256e-01   +3.601614923012271e-01   +1.385836553093648e-02   +2.039727535463861e-01   +6.212399856561772e-02   +2.431237628060101e-01   +9.987936688395300e-01; +9.515968877568659e-01   +9.771468787685702e-01   +1.154714477161200e-01   +6.532914163144064e-02   +8.064130592183827e-01   +3.871598619113731e-01   +2.240665535529817e-01   +1.221662270031322e-01   +3.554724039187840e-01   +7.417399966038555e-01   +5.330710021116256e-01   +3.446574768850892e-01; +6.628484076568569e-01   +7.247743625056684e-01   +5.143367047065718e-01   +8.619400437878711e-01   +7.922142510739887e-01   +6.644754049029656e-01   +7.246103466293955e-01   +6.695054691578552e-01   +8.878951560026777e-01   +9.905480716774669e-01   +3.329300223935811e-01   +8.224173898315313e-01; +1.684977840030431e-01   +8.717962559453409e-01   +6.864062082057002e-03   +9.967110936457836e-01   +4.231614241134277e-01   +5.845046380592639e-01   +7.723618338423621e-01   +5.084984452939623e-01   +8.091143718629026e-01   +7.675737986802107e-01   +6.745427468268969e-01   +1.097898560269112e-01; +1.967533656755641e-01   +8.142785284454138e-01   +8.689918578187612e-01   +1.223660760341467e-01   +6.303437552196592e-01   +5.919808333999402e-02   +3.424023953666038e-01   +7.061232975831609e-02   +3.192404492951473e-01   +8.813953881459500e-01   +8.754014776287088e-01   +7.734631491537729e-01; +9.951191191428287e-01   +3.068774397988406e-02   +9.045790485127482e-01   +9.991412809164306e-02   +5.681923855565291e-01   +7.619101279453704e-02   +5.769092760365794e-01   +5.359315130201565e-01   +5.998435324886853e-01   +3.630719958113563e-02   +9.827997630550988e-01   +1.504661311623950e-01; +9.255145584906682e-01   +9.613649783521122e-02   +1.132496079300291e-01   +1.488719732795918e-01   +8.962055265958708e-01   +2.274023045496537e-01   +6.428630701095175e-01   +6.780731118447336e-01   +6.985588223431415e-01   +7.938068341537776e-01   +1.453766333313353e-01   +7.318549698034674e-01; +9.819092642803177e-01   +8.569145443661347e-02   +4.426566528759351e-02   +1.288715409592716e-01   +7.488834629101893e-01   +4.198971585104775e-01   +3.656948694763306e-01   +5.881071477405441e-01   +1.785908895273063e-01   +7.063203218401810e-01   +8.769657798067839e-01   +1.092239614452937e-01];
L3I_L2I_iGABA_netcon = [+7.675384050901153e-01   +5.357697760802784e-01   +5.973020845283834e-01   +3.049020154852621e-01   +9.667104980200345e-01   +1.151857886965994e-01   +2.984959251032432e-01   +7.958235108686221e-01   +9.140609708221203e-01   +9.947071611778909e-01   +3.095878067966701e-01   +9.963234724554775e-01; +6.373629452087779e-01   +4.529336255105474e-01   +5.625927248653041e-01   +7.625248090372311e-01   +5.446149929733251e-01   +6.996687240408654e-02   +1.685446173721439e-01   +5.263680838333598e-02   +3.859665453332023e-01   +2.870739352977268e-01   +4.428999972030125e-01   +9.148194371784355e-01; +7.965320937776754e-01   +1.145485628047874e-01   +6.834167660921159e-02   +6.472817126286668e-01   +9.818053944095764e-01   +5.123491158811581e-02   +7.240821141123550e-01   +1.818829985055517e-01   +7.500811208177852e-01   +5.159503997604574e-01   +2.084069626401535e-01   +6.916022295818738e-01; +9.602227820480054e-01   +7.202333382694858e-01   +7.682611623903718e-01   +3.315172573339042e-01   +1.244326176876616e-01   +1.299419635390917e-01   +2.984834320768906e-01   +2.466032244204908e-01   +8.789135660846351e-01   +3.591100171370630e-01   +9.412599149445261e-01   +2.215968489599435e-01; +7.166409320736431e-01   +1.861526755681535e-01   +8.679325604819554e-01   +9.708294164189543e-01   +1.683839296694095e-01   +4.917488120431830e-01   +6.777049304202558e-01   +2.618193896769297e-01   +3.922370649683501e-01   +5.170638952726417e-01   +2.898243761471849e-01   +3.150412042319690e-01; +6.435100170748801e-01   +3.249141776697582e-01   +7.084834071397698e-01   +5.319157330576064e-01   +3.343170953134209e-01   +4.675030819797633e-01   +7.459669448780720e-01   +6.472951799037741e-01   +1.681560678982078e-01   +5.009580148105316e-01   +1.228921684289485e-01   +2.370063133736332e-01; +5.122659135494427e-01   +9.670524381637533e-01   +1.078755742057114e-01   +7.517802611531380e-01   +5.311908561824193e-01   +1.584716442001516e-01   +7.460660059531421e-01   +9.819289427116090e-02   +4.365675537961454e-01   +1.879535805359842e-01   +6.938251917289981e-02   +7.078622709333534e-01; +9.520341687372302e-01   +7.010208222969077e-01   +6.660154841033792e-01   +2.694166153053196e-01   +6.922746448846833e-01   +1.379542407852521e-01   +7.846008794958432e-01   +4.688062559795294e-01   +8.575719041309599e-01   +4.774657539612311e-01   +7.293872064103218e-01   +3.756307575717849e-01];
L2E_L3E_iAMPA_netcon = [+6.570226403116173e-01   +3.863472890191990e-01   +2.347417725478292e-01   +4.643537197569593e-01   +9.045740039622621e-01   +9.500665340383044e-01   +7.619412477553200e-01   +3.547990562991853e-01; +3.837802458863343e-01   +2.306407364072343e-02   +9.052821486353237e-01   +2.834950533584578e-01   +6.789199256016596e-01   +2.553502420931568e-02   +9.035378337863956e-01   +6.636035934857373e-01; +3.078421655286154e-01   +3.294249901122445e-01   +4.872179277157627e-01   +2.763145914316080e-01   +8.428571476379749e-01   +5.017058676245929e-01   +7.965990465814613e-01   +5.921693955500739e-01; +1.576712430818534e-01   +4.849071746814541e-01   +5.956660681412009e-01   +1.426324335452313e-01   +9.504415310910504e-02   +3.394997864842719e-01   +9.563170047156418e-01   +5.372467414194024e-02; +7.774302953470021e-01   +2.627065180116712e-01   +9.553744080335370e-01   +1.399766302382192e-01   +7.352301207986929e-01   +6.725861457465827e-01   +5.348811557926277e-01   +2.163095354446458e-01; +7.092060495445984e-01   +5.257866447925613e-01   +8.484300570481790e-02   +2.645554657707105e-01   +5.438872026662104e-01   +1.673282503045773e-01   +1.634799546726755e-01   +6.013995830781413e-01; +1.729695067269844e-01   +4.162283430123241e-01   +2.215763583292243e-01   +6.113838012668884e-01   +2.566240843933930e-01   +2.261467402703476e-01   +1.344739884278625e-01   +2.695868523034989e-01; +4.482437593003900e-01   -4.405867284328823e-03   +1.525373371903880e-01   +1.061055441126329e-01   +7.149171634631033e-01   +1.180925238098781e-01   +3.351655322467396e-02   +1.097181405044105e-01; +8.382182568152050e-01   +8.938532104144725e-01   +3.899545374909202e-01   +4.844995728221813e-01   +3.603911101936791e-01   +9.936937042642675e-01   +6.811764596086151e-01   +2.110786860722179e-01; +6.979944839640998e-01   +2.400222874696566e-01   +1.851135903412546e-01   +8.937751020267337e-01   +8.535713647604328e-01   +1.399211759768541e-01   +5.866134835832253e-01   +8.734270262572469e-01; +7.661063109517786e-01   +7.917901278291426e-01   +7.633972307609055e-01   +1.886487592901800e-01   +8.194221789128979e-01   +7.694906255007190e-01   +2.986636129438976e-01   +4.588911376960154e-01; +9.807872355931004e-01   +5.781216976647058e-01   +2.280637736823616e-01   +5.229867640779684e-02   +6.104867783217394e-01   +6.344139599592125e-01   +7.387465536191323e-02   +7.267484034287962e-01];
L2I_L3I_iGABA_netcon = [+5.892994451713999e-01   +1.468937646737849e-01   +3.442220026196123e-01   +3.691787321765880e-01   +5.994093172670286e-01   +5.070423386213395e-01   +7.728071522180648e-01   +2.645971335710210e-01; +8.459416656407737e-01   +9.900358258950041e-01   +4.570447198050993e-02   +5.376453183156968e-01   +4.786591017434214e-01   +2.372523123424599e-01   +1.785019091162952e-01   +5.851651374031744e-01; +6.044345306545833e-01   +4.807236165393717e-01   +9.417901952119865e-01   +9.743309096796117e-01   +3.768480335657503e-01   +2.721143642079276e-01   +4.537669468159999e-01   +6.794126293018060e-01; +7.447532525733049e-01   +3.596881519915873e-02   +8.661465575357575e-01   +9.963386408332582e-01   +9.785236339243537e-01   +4.055262076826491e-01   +3.057628479193372e-01   +4.155221785360260e-01; +8.497697996678968e-01   +2.699386681762420e-01   +1.339807372693330e-01   +4.142434602809045e-01   +1.387373690085460e-01   +2.606394023793733e-01   +3.880776906707844e-01   +5.110569558887367e-01; +1.463113327481738e-01   +6.757541875632558e-01   +5.900559908702745e-01   +4.506364686193472e-01   +2.710598952647441e-01   +8.543325490020847e-01   +8.031764056929642e-01   +8.142631759955390e-01; +7.419177499787951e-01   +1.464065705948416e-01   +6.239061273349623e-02   +2.549618278270405e-01   +2.259106040394428e-01   +4.789209962214965e-01   +7.775736805272445e-01   +5.442790402056744e-01; +1.718542341076720e-02   +7.737625661933151e-01   +9.464491570290390e-01   +6.012257090251361e-01   +7.921463218557581e-01   +3.415185568002806e-01   +6.461681054983524e-01   +5.893421995666408e-01; +2.281062542288099e-01   +2.668721181090207e-01   +4.970791583085514e-01   +7.764681539400373e-02   +8.179276159695948e-01   +6.393410021337732e-01   +2.423534735370633e-01   +5.353056622960243e-01; +5.378729361102674e-01   +8.807491929265751e-01   +2.635540339590022e-02   +9.122769604820280e-01   +7.921930979321866e-01   +4.159952996007866e-01   +6.081913652279300e-01   +5.409835354015958e-01; +7.198656161918492e-01   +3.688256484099561e-01   +5.710692093081753e-02   +4.731161275737109e-01   +1.132411187146575e-01   +5.441199581253088e-01   +4.191332774822445e-01   +1.510019525071248e-01; +4.341030373277999e-01   +9.840608650867166e-03   +3.009960105772616e-01   +5.074838713013501e-01   +6.324727272368337e-01   +3.402803930311535e-01   +2.940642000633555e-01   +7.040556108358997e-01];
L3I_L3E_iAMPA_netcon = [+6.360845098292968e-02   +7.732659667722107e-01   +5.545835340998436e-01   +5.732631621628823e-01   +9.202630864803083e-01   +8.352041953008067e-01   +8.495998599564378e-01   +8.628952767163198e-01   +5.335884754475085e-01   +9.877807447931812e-01   +4.818801877326572e-01   +3.499575459810761e-01; +9.223015102768427e-01   +8.385467682484080e-01   +8.440097885336771e-01   +9.356944406860311e-01   +5.929321819427750e-01   +3.926161770403356e-01   +6.285032103619821e-01   +8.564287321828025e-01   +5.676549795389396e-01   +7.014559461175197e-01   +7.399763258784768e-01   +3.998999301798389e-01; +1.805298456206796e-01   +5.929452553684339e-01   +9.696727458753129e-01   +7.789708373840467e-01   +5.761499146954416e-01   +7.052921105538944e-02   +4.444080614211801e-01   +9.492789337100324e-01   +9.799391530755717e-01   +8.441239071101889e-01   +5.948123570969154e-01   +9.878014474684025e-01; +5.430902463044871e-01   +7.668193464038801e-01   +4.656578340066591e-01   +5.961966029736818e-01   +6.583214294329219e-01   +3.737464077823552e-01   +2.347075314620351e-01   +6.941688135885026e-01   +9.681770404156694e-01   +7.383244826828876e-01   +2.633145602755065e-01   +2.978014099224082e-01; +3.975883067666681e-01   +6.585377926125455e-01   +7.762943321695621e-01   +5.830468545432028e-02   +4.357010298439069e-01   +8.493611333552367e-01   +5.089682967664112e-02   +3.628916669183500e-01   +5.602922947269506e-01   +9.960167200204061e-01   +6.072879636993426e-01   +2.245536801922459e-01; +9.126852564277844e-03   +5.890550230506445e-01   +2.204312143862969e-02   +5.438985425251600e-01   +9.351573832594813e-01   +2.520181087053126e-02   +7.127087665608186e-01   +3.729978854209301e-01   +5.323382093388790e-01   +5.073742992385912e-01   +2.322172122307009e-01   +3.304520536011002e-01; +1.026279336915715e-01   +2.621460809290079e-02   +6.774976927854715e-01   +8.646504683224168e-01   +1.028480037497976e-01   +4.208464233596550e-01   +8.478756442921850e-01   +8.417078004147255e-01   +4.792776918571475e-01   +1.893231703160273e-01   +1.948975985341730e-01   +1.647819575965060e-01; +8.560435790186491e-01   +6.925191928814087e-01   +8.352784582996728e-01   +3.386497903820485e-01   +4.091378661211884e-01   +2.541579199160351e-01   +4.051506294591250e-01   +3.843633904959588e-01   +9.015478257137175e-01   +9.593571439521011e-01   +1.815922412081663e-03   +3.837697127336821e-01; +3.376192292028283e-01   +3.275857871719093e-01   +6.842371771910999e-01   +1.786202304865400e-01   +8.926169095219898e-01   +7.414035050315788e-02   +2.871923876232270e-01   +7.706446297931238e-01   +4.820176645191205e-01   +4.517384208195679e-01   +6.463275195123360e-01   +5.262306819092961e-01; +1.494751142821075e-01   +7.625259457643199e-02   +8.956859626346581e-01   +8.810307393054935e-01   +7.386713325066676e-01   +9.203792619231014e-01   +2.624784620821288e-01   +7.734470731576244e-01   +4.867334648237300e-01   +6.057516639473588e-01   +4.001004287829537e-01   +5.954693945946956e-01; +8.076332954194325e-01   +7.443645531881259e-01   +9.540032876739152e-02   +8.417521393950390e-01   +9.585347707560715e-01   +2.686130399431270e-01   +5.054269766578962e-01   +4.333745825227733e-01   +3.138955941264712e-01   +6.449722541878192e-01   +2.717828949570950e-01   +1.696422013547092e-01; +6.551165117722566e-01   +9.652826466261379e-01   +7.026335333036428e-02   +8.339870003854326e-01   +9.696244487926808e-01   +1.010836742328161e-01   +1.169153575358345e-01   +4.873082115309085e-01   +8.590325676369696e-01   +7.660121205211717e-01   +3.420742101633224e-03   +7.285560186775980e-02];
L3E_L3I_iGABA_netcon = [+4.371113185633466e-01   +7.146965473873181e-02   +6.050464604282324e-03   +4.952146860857679e-01   +5.436986777305887e-01   +2.521392775162110e-01   +7.184210826004920e-01   +7.613211216382993e-01   +3.786466656653385e-01   +4.488914138311759e-01   +2.003784342201423e-01   +6.495915288276216e-01; +5.761500043433950e-02   +8.075083447370588e-01   +1.322437982623462e-01   +1.929746225749133e-01   +2.114963669820632e-01   +3.339276511110493e-01   +2.224817609358036e-01   +8.891134561322795e-01   +6.105352572970884e-01   +3.942304670048712e-01   +8.282874733110590e-01   +8.993745890211573e-01; +6.263477806557884e-01   +9.090503729389688e-01   +3.084145633377208e-01   +6.423680168019809e-01   +2.699107418833980e-01   +5.913219822386725e-01   +4.980157533021024e-01   +7.314756709568792e-01   +1.676092942181020e-01   +6.684161721890942e-01   +4.469422864328546e-01   +8.387777676582613e-01; +7.989960663822936e-01   +4.260484811421488e-01   +2.386879807209484e-01   +2.553017805245795e-01   +1.323152464966136e-01   +4.818696662597596e-01   +4.757733478268535e-01   +6.976985152957768e-01   +1.055402439255782e-01   +3.333325568859610e-02   +4.159692046569654e-02   +1.702802331544798e-01; +4.007191309375439e-01   +1.838848742254788e-01   +6.489524063819749e-01   +9.488866416100333e-01   +1.599741148525512e-02   +8.979048696297096e-01   +4.309954877796703e-01   +6.459909379777716e-01   +6.255558762377990e-01   +7.868520616661332e-01   +7.688771198119057e-01   +1.609238453765175e-01; +8.835671791725859e-01   +1.831801032674784e-01   +8.076354191495174e-01   +2.873072581453688e-01   +1.503831813640552e-02   +2.949379283992836e-01   +5.563659580299595e-01   +6.198908726703055e-01   +9.518352087654554e-01   +3.785730615674467e-01   +9.773455083032950e-02   +1.354322864386890e-01; +7.227902631276308e-01   +6.725504473084067e-01   +7.411305931612369e-01   +1.493647802290699e-01   +9.789167145568650e-01   +7.904523334482183e-02   +2.068085338759321e-01   +7.838691492554371e-02   +6.651602696863772e-01   +6.516227397411238e-01   +6.522547772741308e-01   +1.590348578890951e-01; +1.972138655659763e-01   +5.245276529674591e-01   +1.223225130401189e-01   +8.703580076467922e-01   +6.475978497874016e-01   +3.918196024744149e-01   +2.767513230269447e-01   +5.488454465122825e-01   +4.722555737196553e-01   +4.975942494487485e-01   +2.707271482239969e-01   +3.946318161400288e-01; +3.747003363852374e-01   +7.766653695090031e-01   +1.721302957761518e-01   +8.869643602536613e-01   +8.161612081841197e-01   +1.990168440250069e-01   +8.125389471121087e-01   +8.842561229593408e-01   +3.400228579042784e-01   +2.124670378485928e-01   +4.370998209971902e-01   +6.668947552988232e-01; +2.126503231385642e-01   +2.996114447389492e-01   +2.736111587137673e-01   +6.685413436406223e-01   +2.762718935040758e-01   +7.225425757859560e-01   +9.545253169071419e-02   +9.873128677505579e-01   +5.907946192176357e-01   +2.161306789413164e-01   +8.489276021141167e-01   +2.228981035690740e-01; +2.591538428256743e-01   +4.737629351021519e-01   +8.147540658738218e-01   +9.975627046053869e-01   +1.478862612295303e-02   +4.215855216928110e-01   +3.336539254692304e-02   +7.142523043768459e-02   +5.466210320908520e-01   +4.515527233904825e-01   +9.026293296813941e-01   +6.433576820940209e-01; +9.922317338454193e-01   +7.072157481220552e-01   +5.915226027384205e-01   +2.673770282623428e-01   +1.016892533838841e-01   +2.683400516749789e-01   +6.432856009556676e-02   +3.294010513696551e-02   +3.858928980802343e-02   +6.294896776978519e-01   +2.854324329560254e-01   +6.121935838302948e-01];
L2E_Input1_iAMPA_netcon = [+9.923566776309325e-01   +9.894820681043150e-01   +9.995609316576860e-01   +9.874623323122009e-01   +9.850895645674627e-01   +9.997910154895298e-01   +9.837893931749873e-01   +9.977652687878926e-01];
L2I_Input2_iAMPA_netcon = [+9.916135566178682e-01   +9.992302749028518e-01   +9.847453154455443e-01   +9.955192321038240e-01   +9.886473877307725e-01   +9.895309313252545e-01   +9.960319606862806e-01   +9.968899339159234e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
