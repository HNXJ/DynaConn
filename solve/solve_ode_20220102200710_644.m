function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.697385205122525e-02   -4.580668009998289e-01   +4.220893956568907e-01   +5.392499585486538e-01   +2.039111032458049e-02   +3.615513472073565e-01   -3.615475410538063e-01   +2.624264118219383e-01   +3.655284523082455e-01   +8.106422163108991e-01   +1.795671126436358e-01   +5.363338137665279e-01   +1.514349356102575e-01   -1.346442774566143e-01   -3.408336616168710e-01   +5.607197026287461e-02; +2.929253684553683e-01   -1.721657496870651e-02   -1.477092902508108e-01   +3.781638152514513e-01   -1.089391613052561e-02   +4.220689993590698e-01   -4.179483339293886e-01   +3.673305274206933e-01   +7.411714658686469e-01   +9.739276730299813e-02   +7.569843187367640e-01   +5.366203920886938e-01   +3.362942761429367e-01   -5.252478858039764e-02   -8.170728370468749e-02   -1.195239202890742e-01; +7.587629249212480e-01   +3.170457408912445e-01   +2.475074794183942e-02   +2.645326271114687e-02   +9.296729897357768e-02   +3.198742423258367e-02   +2.416713307725049e-01   +3.774053185611345e-02   +4.840642750882891e-01   +1.423591447282085e-01   +3.932369611749184e-01   +1.379613180361768e-01   +1.728375155374297e-01   -3.359329819046979e-01   +1.180689566013635e-01   +7.500263321892871e-02; -6.364833747951988e-02   -2.184051449831038e-01   +5.910495581069670e-02   +5.068485343050878e-01   -6.302749231232541e-02   +1.159007313117963e-01   +3.747206809674023e-01   +7.868107072622668e-01   +5.842282832746860e-01   +1.223857645406157e-01   +3.373702357612732e-01   +6.181939985288274e-01   +3.120094886070894e-02   +5.197421579326823e-01   -2.133008376599995e-02   +8.819802532444004e-01; +5.405525826173015e-01   +1.730526104163859e-01   +3.399643990326016e-01   +8.582960574240155e-01   +1.198603420509386e-01   +4.514638355796131e-01   +1.816422262019555e-02   +2.668402774193907e-01   -1.127011464040916e-01   +3.108028374559031e-01   +5.334001342767576e-01   -2.652067988792154e-01   -1.092365071706417e-01   +3.230106956904426e-01   +6.224872127145007e-01   +5.862703120539275e-02; +2.314400214781313e-02   +4.435018634072890e-01   -7.355526665298215e-02   +9.449774129556986e-02   +9.003542481654074e-01   +2.996182945627954e-01   +6.873360440538326e-01   +2.716378370087004e-01   +1.859717639191753e-01   +3.778466281907639e-01   +1.776158494761236e-01   -1.671079603645816e-01   -3.193738885542213e-02   +1.126923527057726e-01   -1.160975593343941e-01   -1.139482187798849e-01; +4.888245142771954e-01   +5.656422643317629e-01   +2.535960614123852e-01   +1.182906778164211e-01   +4.333208240506627e-02   +4.070853792067526e-01   +3.842590428122563e-01   +3.081313871579099e-01   +2.484678191705158e-01   +2.151498033517933e-01   -2.157382829073177e-01   +4.546568141354282e-01   +4.260376660327912e-01   +8.577647133622911e-02   +3.724819854257559e-01   +2.876001902923683e-01; +1.669992609493022e-01   +2.359472446558659e-01   -1.680213916493435e-01   +4.571099777037320e-01   -7.586084087075831e-02   +7.568108245256377e-02   +1.968226206277927e-01   +5.342647939195764e-01   +5.266878227961668e-01   +5.283955833991796e-01   +1.711812137815261e-01   +4.631610012335775e-01   +9.168433656035653e-02   +2.255381556200688e-01   -1.332693847341579e-01   +4.428697717787107e-01; +1.187311232362858e-01   +5.456323536063855e-01   -1.901256339044864e-01   +4.053752043495148e-01   +2.922789039270184e-01   +4.503781302174265e-01   -1.447840402885018e-02   -2.924608321966535e-01   +2.817761516773293e-01   -7.461678283290417e-02   +7.053551357850603e-01   -1.295925822122354e-01   +4.452960743641153e-01   +4.068601528563953e-01   +1.739077516769988e-01   +9.372605869095976e-02; +6.467714497984485e-02   +3.651553999416433e-01   +3.112387398112570e-01   +2.980900921091133e-01   +3.056653244029494e-01   +1.443759059529248e-01   +6.082953708211786e-01   +6.613408383373702e-02   +3.485517433429722e-02   -5.589474197963516e-02   +1.493121584447315e-01   +3.334836449509241e-01   +8.171352192433833e-01   -2.786701621851684e-01   +2.569029472199805e-01   +3.693697287637357e-01; +5.313616307778874e-02   +5.473246566281249e-01   +3.648241328489429e-02   +1.703281923897990e-01   +5.963861296978339e-01   +2.736133181534803e-01   +6.650006940987321e-01   -3.366037769384149e-02   -1.200079610360531e-01   +5.270051652204112e-01   -7.158026951738218e-02   +4.359003556722281e-01   -4.522897152835244e-01   +4.663831263037557e-01   +5.478218784473160e-01   +1.832760529280943e-01; +4.807391440581841e-01   +1.057671358924291e-01   +9.961178670437774e-02   -2.862843015330456e-01   +4.053562913885815e-01   +3.915721089061813e-01   +1.952984091280941e-01   +4.718148708465633e-01   +6.779682347841398e-01   -1.058106404807040e-03   +1.564835313932839e-01   +3.810282323891395e-01   +5.225907021240916e-01   +2.624504036830004e-01   -1.929942136288506e-01   +2.889279536908132e-01; +1.224670216879507e-01   +3.676195742326935e-01   +6.832910991748212e-01   +2.677721830608633e-01   +4.672257160381963e-01   +3.777089673822571e-01   +2.205203191577343e-01   +7.482661954759384e-01   +7.391717168299543e-01   +9.973519183517524e-02   +1.957674828864562e-01   +2.829660906739920e-01   -3.131025718327264e-01   +2.842466544055633e-01   +2.192618350974607e-01   +8.308687062525540e-02; -1.048730453134912e-01   +2.916337957522375e-01   +2.512507705700707e-01   -6.348748358806359e-01   +1.488150607598870e-01   +7.826598011117916e-01   +3.484591432012930e-02   +3.272634382624325e-01   -2.644848100261783e-01   +9.268953543010272e-03   +5.956051219862201e-01   +3.068377735207234e-01   +4.908380070059059e-01   +4.014513318919898e-01   +1.045384152907991e-01   +1.363193216751786e-01; +2.589557143763943e-01   -1.016268491134428e-01   +4.248290781374943e-01   +6.498969759255321e-01   -4.042726376229235e-01   -1.983047677536077e-01   +7.138445811305448e-01   -2.256905218218732e-01   -1.234792385696065e-01   +2.813674971195295e-01   -8.982145095269746e-02   +1.200046923116935e-01   +1.461200453934944e-01   +4.626797821125658e-02   +1.599908424943618e-01   -1.939295105832491e-01; -3.390967975516003e-01   +5.645062828055658e-01   +6.457212848410897e-02   +4.718364656738654e-01   +8.120363328174095e-01   +8.326820739758339e-01   +2.634630194213853e-02   +7.125998580380862e-01   -1.015851819476949e-01   +4.950151814695870e-01   +4.117406381702323e-01   +4.685560585163278e-01   +1.870490485498435e-01   +3.994553556247539e-01   +7.727361444397143e-01   +3.267635170321032e-01];
L1E_L1I_iGABA_netcon = [+1.769623335736642e-01   +2.274338446269286e-01   +8.303105678164743e-02   -2.269332534414571e-01   +3.585730707382059e-01   -6.623353475924769e-02   +7.408449072117966e-02   +1.378741267905624e-01   +1.476743796690824e-01   +6.840609808364272e-04   +3.447155721277553e-01   +3.993695271048017e-01   +7.539459584560385e-01   -4.529480905491587e-01   -1.623232749859286e-01   +8.846165833081957e-01; -2.634833210604869e-01   -3.401909453228719e-02   +4.430913408113414e-01   -2.298362003295788e-01   +8.244387054118360e-02   -2.874331518302058e-01   +4.767339809795967e-01   +2.391409247067689e-01   +3.147697513465684e-01   +3.112622796754671e-01   +4.304529932744935e-01   +2.396771442110588e-01   +4.718704282938487e-01   +1.901249712903850e-01   +1.673694332430573e-02   +6.290793210691532e-02; +1.604905858072684e-01   -5.301654935558077e-02   +1.269558240073073e-02   +5.105335906178253e-01   +3.596320388752335e-01   -2.338672353739615e-01   +3.345977739551817e-01   +1.429069267485837e-01   +8.912650178651431e-02   +1.000000000000000e+00   +1.315013404919751e-02   +1.823929268404016e-01   -3.618952218135987e-02   +9.213402872973937e-03   +3.593418012855277e-01   +5.102606898076002e-01; +4.878015751792490e-01   -9.101671593223339e-02   +5.249824022361280e-02   +1.675694956347572e-01   +1.929063681998378e-01   +2.356070501033571e-01   -1.010024928012401e-01   -2.430895237421411e-01   +1.286587534216122e-01   +1.932347355410997e-01   +1.639248290464586e-01   +4.797227370045775e-01   +2.697141085120794e-01   +3.005304526852980e-01   +1.409358762299064e-01   -1.626033764501462e-01; +5.449648969173529e-02   -8.560111922935391e-02   -1.503702063259250e-01   +1.007949995394871e-01   +5.174618886952581e-01   -1.331879701406972e-01   +2.692362450131349e-01   -1.681301311110016e-01   +1.139040966662454e-01   -8.080390054151980e-03   -3.203280504553600e-01   +6.583566371096131e-01   +9.716888728110593e-02   -3.437629254073703e-03   -1.925707701760096e-02   +3.218909176933744e-01; +8.666873888930068e-02   +1.265898284299184e-01   +4.502724537697073e-02   -1.071502314372928e-01   +1.051728053585467e-01   +5.148230854898772e-01   +1.688466225279495e-01   -1.708131176422241e-01   -7.946522878436808e-02   +1.733187463439370e-01   -4.796297285534635e-02   +2.589369558486558e-01   +1.749133948707841e-01   -2.561018418682294e-01   +5.276192558933834e-01   +2.332153397949640e-01; +6.401950036493531e-02   +8.559740944262724e-02   -1.133581000757639e-01   -2.151852358098766e-01   +2.327825519503247e-01   +1.968442718402971e-01   +7.396177054094244e-02   -2.293149753197901e-01   +2.092798141816347e-01   +1.628984640650837e-01   +5.547708424439763e-01   +2.211397115915499e-01   +1.665980575762152e-01   -7.339494635431218e-02   +8.485055397366066e-01   -1.241025943714685e-01; +2.132036628941614e-01   +1.943867805141686e-01   +1.239102246135643e-01   +2.033320873367071e-01   +3.242856887888469e-02   -2.215167354554069e-01   +5.876833726856321e-01   -9.017626127124031e-03   +4.047388122009689e-01   +2.089705054382701e-01   +3.936462302104690e-01   -3.107614544848042e-01   +3.006792615241011e-01   +4.401805058541167e-01   +2.502912673149996e-01   +1.400273424754201e-01; +4.508542415919259e-01   +5.930574387651005e-01   +4.150578730136179e-01   -1.082996207971228e-01   -1.109079868692891e-01   +1.773289226915100e-01   +3.213997925846361e-01   -3.506714744610189e-01   +2.467643929221295e-01   -1.559444630296696e-01   +2.123223619653062e-01   +9.913191646608545e-03   +1.292823899109590e-01   -3.304158706674728e-02   +7.759762130166860e-01   +8.377224598959979e-02; +1.726414760794944e-01   +4.472132544427952e-01   -1.046500844355563e-02   +2.511716759525578e-01   -7.694119892864051e-02   +2.253173493881512e-01   +1.101979054455338e-01   +2.491407431278481e-03   +4.201770621763625e-01   +2.865804131276392e-01   -4.141628161807411e-01   +1.756953734359655e-02   +3.008694475944667e-01   +4.539928558183596e-01   +2.308148258361820e-01   +6.765820785310374e-02; +1.978024896399267e-01   +4.099245490784388e-01   +5.117979296281894e-01   +2.830006532725922e-01   +3.469350583221580e-01   +1.626082780962484e-01   +7.373767443799426e-02   -8.067612850937123e-02   +3.186127154752649e-01   +5.419929211741571e-02   +1.884909248597874e-01   +7.188900026224565e-01   +4.892399573841283e-01   +1.897920501394483e-02   +1.155017763383793e-01   -3.967735286205917e-02; +1.939281097784313e-01   +1.211990761602594e-01   -9.988235507252214e-03   -3.619848938969198e-01   +1.218049574243792e-01   +4.205664559663551e-01   -9.589197393357211e-02   +1.990115943813524e-01   -2.805028743121633e-01   +8.229464074066885e-02   +3.595895174599602e-01   +4.472896342075968e-01   -3.225519039149662e-02   -1.100748514632155e-01   +2.413713082250323e-01   +2.798987577276785e-01; +2.944194932914763e-01   +1.601932889381986e-01   +1.871435766500026e-01   +7.261724034624728e-01   -3.504195382149766e-02   +1.996713924887132e-01   +9.916578336736823e-02   +2.803413987044370e-01   +3.243771663903467e-01   -3.076444440122070e-01   +3.373997096156892e-01   +3.463128188781905e-01   +2.370972069905509e-01   +3.403455544104331e-01   +3.772409822485545e-01   +2.527558773285983e-01; +4.387907389480468e-01   +1.975370663060473e-01   +1.183511372229756e-01   +2.300366406342831e-01   -4.610533423503361e-03   -2.609001161537948e-01   +8.606132279943209e-02   +1.077211020421480e-01   +1.880124217393322e-01   +6.565524934622578e-02   +2.556140237875114e-01   -3.027614281602253e-01   +1.412106509992180e-01   -2.640742266721499e-03   +2.416309540286135e-01   -1.978800024608937e-01; +4.225931358209721e-01   +1.295089378766708e-01   +1.260239040020131e-01   -2.048636602211708e-02   +2.758733778891519e-01   +2.236703080532718e-01   +2.343247276706654e-01   -6.581833958075096e-02   +3.169625553228008e-01   +1.066660694390289e-01   +3.489017400622247e-01   +2.867960659562648e-01   +1.297564978694121e-01   -6.506141703726968e-02   +3.722633768279084e-01   +3.326888865928687e-01; -1.760473381785662e-01   +2.210901998209861e-01   +1.727771764669384e-01   +1.456360261138841e-03   +1.518501468887893e-01   +5.245105828154767e-01   -1.873966007964777e-01   +2.923895285874153e-01   -2.540948474892823e-01   +2.811848494729828e-01   +1.076886652371793e-01   +3.172606915561450e-01   +2.128243676413973e-01   +2.313232774819599e-01   +1.011293418461101e-02   +3.432810685970955e-01];
L2I_L1I_iGABA_netcon = [+2.467357273616102e-01   -9.852322786432403e-02   +2.390954755723096e-01   +6.497476565302410e-01   -3.521223554363993e-01   -1.528309667763288e-01   +1.860243605495579e-01   -1.783024469442983e-01; +5.121471319714603e-01   +7.728065244945858e-01   -4.893824323586618e-02   +2.354828775141508e-01   +3.503876674615149e-01   +4.061596323396350e-01   +4.422990546005269e-01   -1.844300577451466e-01; +5.533821067492707e-01   +2.157006987884332e-01   +2.518778737006310e-01   +7.311862118581895e-02   +4.408823167842537e-01   +1.368641884527534e-01   +1.253675907549508e-01   -2.597885908819859e-01; +6.692211334963238e-01   +8.358805910166686e-02   +3.152547920010558e-01   +1.827641003320115e-01   +7.038796942392649e-01   +4.141105425342678e-01   +5.538708077527800e-01   +1.520280980218346e-01; +2.726462497363322e-01   +1.313665250568267e-01   +3.076414631020456e-01   +3.463468892630618e-01   +4.909700808585508e-01   +1.898398684568397e-01   +1.918605391271061e-01   -1.181763021518204e-01; -2.037609272542775e-02   -2.225569777256489e-02   +2.496154119166767e-01   +4.741228229211267e-01   -7.055154329540367e-02   +4.781486880529821e-01   -1.043222237110934e-02   +6.314964650567078e-01; +5.867397216244615e-01   +1.527593038223055e-01   +2.359696281126155e-01   -1.405309198944630e-01   +2.251108874203865e-01   +3.065777015282278e-01   +6.125475524120656e-01   +2.403341807665336e-01; +1.465363850782130e-01   +3.848996969878901e-01   +4.484148736937132e-01   +7.751657687901083e-02   +2.450471396104215e-01   +2.390361457677339e-01   -1.603809553839138e-01   +2.712495841223009e-01; +4.421539552386684e-01   +1.000000000000000e+00   -4.093663957146064e-01   +2.536209268810777e-01   -1.902871982677892e-01   +2.757541798437505e-01   +1.842141843491234e-01   +4.769837989721837e-01; +8.146973504230781e-02   -2.022782161168971e-01   +3.809507473942012e-01   +3.206371548663666e-01   +4.968317458548692e-01   -1.418557793097274e-02   -2.231600661244781e-02   +3.661948367857395e-01; +2.492197187015363e-02   +9.271892854225255e-02   +5.264712020480222e-01   +1.172389364202953e-01   -2.043442110201144e-01   -1.541105310932471e-01   +1.492104372507275e-01   +2.807534335829533e-01; -5.269212588003878e-02   +4.241796279810557e-01   +5.490658626982148e-01   +3.371623275060925e-01   +1.227014266567062e-01   +5.755244340269660e-02   +4.257091684376436e-01   +3.482088626253058e-01; +3.390747240876186e-01   +6.125622541755419e-01   +5.978867750298158e-01   -2.642543511773187e-01   +1.178072036158618e-01   +2.411531259211519e-01   -2.792879964808677e-01   +2.525855815278086e-01; +3.525232072592011e-01   -1.696667253405947e-01   +1.494193202728201e-01   -8.415613382303068e-02   +5.955243265514690e-01   +6.820221099569002e-02   +3.071855241916595e-01   -1.296555116515177e-01; +2.920317715267611e-01   +1.507735536848475e-01   +3.386323427304399e-01   +4.094071670726709e-01   +1.115554165011735e-01   +8.803689581444041e-01   +2.704616833153984e-01   +3.933899127139385e-01; -1.746689795649475e-02   -1.520828297327358e-01   +1.235717757395031e-01   +1.930398047331654e-01   +5.161617862708281e-01   +4.073313083533460e-02   +5.708749633256115e-02   +2.199997640963081e-01];
L1I_L2I_iGABA_netcon = [+4.353689741820427e-01   +1.683674466077043e-01   -2.892148593709056e-03   +3.683234531057651e-01   -2.484281987331134e-01   -7.001444851647084e-04   +1.123560231707313e-01   +2.865163123423943e-01   -3.727378998848349e-01   +5.794905117996453e-01   -1.474545801486642e-01   +6.517916026663362e-02   +5.094208468876988e-01   +3.779818039019391e-01   +2.458354875866030e-01   +5.822229467708195e-01; +4.165745854305202e-01   +3.842671779963261e-01   -3.103984928857339e-01   -3.407234232546688e-03   -2.198978412653766e-01   +8.029772887450831e-02   +6.733514749256594e-01   +3.235389713822395e-01   +4.707418125502510e-01   +1.000000000000000e+00   +3.342731127459033e-01   -2.820295770413244e-01   +8.629298503581771e-03   -4.346977151140193e-01   +4.267345228811324e-01   +3.968517086768054e-01; -4.239893606858813e-02   -1.543439992792393e-01   +4.324093062839234e-01   +1.561895177891359e-01   +3.445228392613980e-02   -2.400775335541237e-01   +6.580111129142509e-01   +5.812873024800683e-01   -2.825810504343080e-01   +4.235765268835058e-01   -2.145458043533628e-01   +3.260428120757989e-01   +7.217935563399206e-01   +5.477134312659472e-01   +7.549126464638716e-01   -2.454274684235659e-01; +5.650780682483049e-01   +4.425111720127428e-01   +3.389945865916351e-01   +2.141931292837803e-01   +8.073950573976332e-01   +3.107117781796395e-01   +9.417410227594805e-01   +6.827997553896606e-01   -3.707194468090260e-01   +8.471390548282138e-01   +7.614285479430937e-01   +2.882913788530966e-01   +4.929412838892934e-01   +2.470924971490474e-01   +2.140231504091585e-01   +1.483646420857884e-01; -6.042035531449750e-02   -7.777241322899514e-02   -4.337075659325567e-02   +2.777302435752484e-01   -1.148811708458341e-01   +9.128524532562386e-01   +6.837179125134019e-01   +2.461908085405472e-01   +5.530110139977823e-01   +6.015514431864456e-01   -3.069649213880752e-01   +2.198462491073382e-01   -4.241112449367896e-01   +5.646690586043505e-01   +3.902081542584381e-02   +8.640782591570257e-01; +1.628053958127886e-01   +2.407701439689478e-01   +7.520460538611055e-02   +5.734824409800527e-01   -2.991145594759030e-01   +4.429751529332823e-01   +4.288885660476748e-01   +1.927915236855515e-01   +3.213208299617727e-02   -2.213399077495321e-01   +4.645229485451688e-01   -3.126279660944771e-01   +6.919991858766662e-01   +9.747224601160835e-01   +5.552696719566818e-01   +6.043998064483631e-01; +4.308550174628403e-01   +5.005254708404805e-01   -1.229602001805793e-02   +2.765916044159467e-01   +4.173650676504829e-01   -2.421845999903013e-01   +4.703105889525317e-01   -9.389802678127263e-02   -1.859681373916788e-01   +6.272544755218187e-01   +5.736532436847755e-01   +3.368149933385213e-01   +2.213546216296360e-01   -2.402932557665799e-01   +1.744014372605771e-01   +6.730627401296313e-01; +3.880127832798352e-01   +2.733314452074120e-01   +1.483108448226214e-01   +2.984068108933235e-01   +1.477577756639519e-01   +7.289794983425063e-01   +3.755881829533183e-01   +1.942250919364326e-01   -2.235690441596338e-01   +2.903399939344234e-01   +8.547334665322179e-01   +5.040423144305018e-01   +5.498293258591250e-01   -8.198943348261670e-02   +3.730063490034365e-01   +2.617054349280921e-01];
L2E_L1E_iAMPA_netcon = [+4.733650747659208e-01   -6.362522289978687e-02   -1.051191565619423e-02   +4.620820778390419e-01   +9.970400395199779e-01   +4.814127909603786e-01   +4.329456820098372e-01   +1.659345584917745e-01; -2.900688182015078e-01   +4.896315229693783e-01   -2.359869667614239e-01   -3.478937537005988e-02   +5.684319621260772e-01   +7.465562669726403e-02   +5.591079741746361e-01   +4.203259656628192e-01; -1.096644907504242e-01   +5.668815789406345e-01   +5.801712096630018e-01   +2.666187133945766e-01   +3.414155300923231e-02   -2.523005089998825e-01   +5.174876982600857e-01   +3.354662244112573e-01; +4.759406350698164e-01   +3.032833705121039e-01   -7.735254856874010e-02   +5.275983630806375e-01   +2.678903131210217e-01   +1.223715654006853e-01   +2.780792700593664e-01   -3.129470777410033e-01; -3.163315268005982e-01   +4.519074974967017e-01   +5.538592508964918e-01   -2.607553715304313e-01   +2.475128579779967e-01   +1.366358974026599e-01   +3.873747733022064e-01   +6.451131754787203e-01; +4.776409181920475e-01   -1.914963648152609e-01   +3.474616424365053e-01   -1.593172927497351e-01   +5.602152503704095e-01   +9.294667671338055e-01   +2.912004024882266e-01   +3.105508902756878e-01; +2.248964692924370e-01   +3.228223370482105e-01   +2.696600236001436e-01   +2.486026524849214e-01   -2.102519517297503e-01   +4.077850951090574e-01   +9.856421950662508e-01   -1.473360929174111e-01; +1.187846895584857e-01   +4.101818882534937e-01   +7.605862897497939e-01   -1.309665236711086e-01   +2.417960301542583e-01   +1.633302434320064e-02   +3.035015825248588e-01   +3.740293102273510e-01; +6.146175055582662e-01   +1.645783913899027e-01   +3.630099154392763e-01   +7.991983049970026e-01   -8.566267137546010e-02   +3.463366003989475e-01   +3.722134146830286e-01   -1.235187983697066e-01; +1.982789370021352e-01   +1.910332851592971e-01   +2.591605494041797e-01   +5.091321402635088e-01   +7.354800485770574e-02   -5.333399635945114e-02   -1.495412751657278e-01   +3.095914792483872e-01; -1.927481036739068e-01   +4.978633460116886e-01   +2.960290713680937e-01   -1.539954309199049e-01   +5.274609435932854e-02   -2.859297187641871e-03   +3.290583999209077e-01   +2.763722362131367e-02; +3.767417624416302e-01   +4.496688268520648e-01   +7.479291681849718e-01   +3.344369257085061e-01   +2.341483413104391e-01   +2.977536193642513e-01   -2.668434447217312e-01   +1.989236517417603e-01; -1.679447539211986e-01   +3.837898039461803e-01   +3.045144821609653e-01   -2.560351109528939e-02   +2.160372301108910e-01   +7.466507998336591e-02   +2.946830724702458e-01   -1.015068306514427e-01; +1.894722269372121e-01   +5.533078732434841e-01   -3.602213496284898e-01   +6.108613458868235e-02   +4.038324710950716e-01   +2.342566983523879e-01   -5.523847072595740e-02   +2.856481166376632e-01; +1.924704298873991e-02   +1.326283569706860e-01   +9.952318882569222e-02   +5.711144112426085e-01   -4.137770229005748e-02   +5.489311503153659e-02   -2.222245298209144e-03   -1.260947486656261e-01; +1.675363851300019e-01   +1.878292069062489e-01   +8.158536870976875e-02   -5.314942683522789e-02   +3.354331145568569e-01   +3.614992569712950e-01   +5.506224909247559e-01   +7.178484167751688e-01];
L1E_L2E_iAMPA_netcon = [+2.355002219014315e-01   +3.964474844831973e-01   +1.027677801034096e-01   +2.500759633980238e-01   +3.316828394091750e-01   +3.812104494716329e-01   +7.689291860814358e-02   +2.852594399792020e-01   +1.670478950186597e-01   +1.845419177605370e-01   +4.340207845082487e-01   +2.999102360804147e-01   +4.376950444175082e-01   -1.992370198571797e-01   -2.761673019530700e-01   -5.000855401071480e-02; +2.266994600706783e-01   -2.882106844952459e-01   +7.620900990833733e-01   +3.631241138244755e-01   +1.070986879607020e-01   +2.185691602178669e-01   +5.345226772981598e-01   +2.476981113743810e-01   -2.405428168215397e-02   +3.879161275408144e-01   +2.968284615873414e-01   +2.258784494868835e-01   +5.427298061044687e-01   +4.075339536138394e-01   +4.098484756096584e-01   -4.764349357805286e-03; +5.057499812783832e-01   +2.451842941031177e-01   +1.448903571783317e-01   +2.270110454624064e-01   +1.838710846084944e-01   +4.316691647887094e-01   +2.492521571779714e-01   +4.031489381306720e-01   -7.425538492076274e-02   +4.721132156749541e-02   +3.992101410372073e-01   +6.670560550701764e-01   -2.903859380244620e-02   +5.638035070717407e-01   -9.260092099597278e-02   -2.847059189572255e-01; +2.148439732371703e-01   +7.597943516950799e-02   +3.058831413542580e-01   -5.344404681416258e-02   +1.919623652732746e-01   +6.114545242296924e-01   +9.298983036956364e-01   -4.704400452768352e-02   -1.267648554931846e-02   +1.822801240640986e-01   +3.635994845246213e-01   -2.171172137327101e-01   +1.800669135083169e-02   +6.972938481361243e-01   +3.910527621552993e-01   +1.400128059868598e-01; +6.927146622203055e-02   -4.697219425987184e-01   +5.493560832835321e-01   +2.097344260564759e-02   +6.652384149922743e-01   -3.834455767685512e-02   +3.503309311248137e-01   +1.819647809255640e-01   +2.376391876267204e-01   +1.662959582303154e-01   +7.099151886329758e-04   -3.515800195203532e-01   +4.657325711559910e-01   -9.785230333569381e-02   +9.131512886508156e-01   +8.533465341222357e-02; -6.392716524708600e-02   +5.896366940904171e-01   +1.908400014206207e-01   +6.266731864571470e-01   +3.374204340137775e-01   +2.440579711842305e-01   +7.652199255569405e-01   +3.271518493755782e-01   +6.046657267050746e-01   +7.779892218733519e-03   +5.519737088004032e-01   +2.830405156472334e-02   -1.732715693368931e-01   -3.733021955951717e-01   -4.146711075228652e-01   +2.813646427559688e-01; +1.100830905141873e-01   -1.675857492224228e-02   +1.308664087107979e-01   +5.193280624292410e-01   +1.635306341191342e-01   +2.270761678863273e-01   +5.888239432144851e-01   -8.034530358613289e-02   -1.696320021997313e-02   -2.318943121122118e-02   -1.009286122759196e-01   -9.407360846633855e-02   -2.634179898224627e-01   -1.065385066537582e-02   +5.566471129560663e-01   +1.850421849584791e-01; +3.753588875766544e-01   +3.488238890819303e-01   +1.905077143185873e-01   +4.766022089878346e-01   +4.975192055679247e-01   +8.724348470872992e-01   +4.914531913363376e-01   +2.853100188481439e-01   +4.114919189557406e-01   +3.433754915027410e-01   +9.142687048003546e-02   +2.926355998392429e-01   -2.058708924512135e-01   -2.850222831089047e-01   +5.127905925994561e-01   -6.848457763042715e-02];
L2I_L2E_iAMPA_netcon = [+3.894018290921856e-01   +7.487608273812634e-01   +7.116959790009068e-01   +1.465456511325646e-01   +1.971228690352399e-02   +6.776072523577622e-01   +2.546663168679349e-01   +5.139390778867354e-01; +5.813827883214411e-01   +1.574279250219865e-01   +8.987677837403010e-01   +5.631481369592340e-01   +5.526942371377634e-01   -8.693544633473610e-02   -1.484168376322634e-02   -1.156586800601979e-01; +1.994025162821999e-01   +3.193036933952293e-01   +2.282847611346583e-01   -6.899357674772237e-02   -2.507058486255873e-01   -3.731036338294529e-02   +4.402444833422282e-01   +2.127596755878762e-01; +9.167306005254797e-02   +1.424925196730727e-01   -2.511349516426122e-01   +6.388054186851901e-01   +1.620260217391950e-01   -3.274587498688233e-01   +2.723752941218880e-01   +1.317235415462486e-01; +4.437768083715002e-01   +5.334506852486944e-02   +1.903997817969716e-01   +4.187766273073717e-01   +2.418561362317034e-01   +1.157704685316477e-01   +6.394322017208168e-01   -4.810085959388227e-02; +2.769744376734808e-01   +4.447737376702798e-01   +1.829711354096264e-01   +4.869511620278475e-01   -1.345663546576646e-01   +4.182454214978000e-01   +8.761303566089808e-02   -2.284504956918981e-03; +4.903020887289153e-01   -6.811537256859498e-02   +3.850564563985726e-01   +7.164000100375236e-01   +3.371975891132666e-01   -1.242069940339781e-01   +8.519768553702171e-01   +2.380948779169452e-01; +3.275457311162004e-01   -6.324243296035592e-02   -2.799080153114177e-01   +1.735855039126337e-01   -5.622050074938587e-02   -2.049753241634896e-02   +4.715640836598379e-03   +5.914724772505012e-01];
L2E_L2I_iGABA_netcon = [-1.896982332534975e-01   +2.874394510215780e-01   +5.638843421147482e-01   -2.497266080812906e-01   -2.535686886863271e-01   -2.114772096412443e-02   -2.223269766001913e-01   +4.931367807784249e-01; +1.892049330069930e-01   +3.283930894854567e-01   +2.130135541190206e-01   +4.915890876819269e-01   +6.696435438459675e-01   +2.201156507162371e-01   -5.730961296584899e-01   +3.095660913061426e-01; +1.027976174514128e-01   +5.634162252687990e-01   -1.905790330527126e-01   -3.020873298876279e-01   +3.352144078788185e-01   +4.819424911186830e-01   +1.888993761451694e-01   +5.845168773412965e-01; -3.676470604635802e-02   +4.462614763354908e-01   -1.821836803916566e-01   +7.212083226664865e-01   +5.820738518350261e-01   -2.481929408896951e-01   -3.166594024519310e-01   -9.309681962417017e-02; -2.147692349518476e-02   -2.693651850828629e-01   -2.235020174569474e-02   +2.875097134152225e-01   +7.773405049657183e-01   +3.943620065144368e-01   +1.306463271511759e-01   +1.114617864362071e-01; +5.750194320089819e-01   +1.397857231775285e-01   +3.642540261174214e-01   +4.722667393077127e-01   +1.883110901293008e-01   -4.109084264617889e-01   +3.619370507506743e-01   -4.266789173072124e-01; +1.930427483249258e-01   +3.724106432401114e-01   -2.751097190240113e-01   +1.804467073840466e-02   -1.803030901965967e-01   -5.364948206539830e-02   +1.328276440114855e-01   +8.010180342302885e-01; -1.838019164174195e-01   +3.607390312617995e-01   +4.622414844068480e-01   -1.287356187942291e-01   +3.864151551897252e-01   +4.254424538254511e-01   +3.805967298720324e-01   +4.747894261962000e-01];
L3E_L2E_iAMPA_netcon = [+4.962273009651213e-01   -4.929266202195106e-01   +2.118655349613004e-01   +5.841077372521282e-02   +4.570191697543637e-01   +1.563123721115222e-01   +9.274094170491463e-02   +6.027546866316866e-01   +1.294848035471945e-01   -2.944394015309884e-01   +2.336452116924481e-01   +7.387806559787020e-02; +2.694820184387190e-01   +7.608894248499973e-01   +1.957256189096831e-02   +3.843785370584363e-01   -7.086589030648183e-02   -5.336212382790324e-01   +1.108484828057210e-01   +1.965692587154633e-01   -1.879720381083685e-01   +1.453133351700039e-01   -1.471449397627269e-01   +3.611245179103079e-01; -3.569900488956781e-01   -2.669939340949754e-01   +3.350152957761466e-01   +3.721397647986733e-01   +9.598600571531609e-01   +3.364507771498694e-01   +3.395203933155748e-01   +3.741309269107767e-01   +6.685893924703142e-01   -2.920416740837285e-01   +6.011688336623024e-01   +6.568502515402196e-01; +2.389924018384672e-01   +2.772402057429556e-01   +3.874659503464569e-01   +1.627586714255227e-01   +5.758640395941378e-01   +9.275823442250504e-02   +1.081291529513659e-01   +1.879850154199056e-01   -7.912421705030231e-02   +2.870047134637266e-01   -1.118517069726298e-01   +5.150954175551594e-01; +3.176804686892822e-01   +1.255902896749335e-01   +2.267857888827713e-01   +4.705544161068976e-01   +5.677795005636698e-01   +9.209208991449198e-02   -9.933932342883711e-02   -2.250036514701877e-01   +2.333544585530207e-01   +5.974038095985682e-01   +7.300251573828210e-01   +6.035767304087277e-01; +5.476150445729253e-01   +4.244852790822873e-01   +1.467308992917086e-01   -3.479332816711691e-01   +1.655454036602416e-01   +3.848951471973831e-01   +1.884029702333497e-01   -1.133259865626556e-01   +2.037371516194502e-01   +3.977881190970430e-01   -2.089656185411866e-01   +1.477497289701157e-01; +2.928785047040386e-01   +1.732906144337477e-01   +7.357730345289959e-01   -1.182346950851714e-01   +3.450359097002288e-01   +4.044396279030503e-01   -3.861002972150466e-03   +1.029469301834038e-01   +3.911224675250607e-01   +3.707705747784726e-01   +1.638438760661016e-01   +2.456702161342362e-01; -1.696208174025563e-01   +8.895472748669851e-01   +6.512057194100939e-01   -3.744204536717371e-01   +6.873333542208760e-01   +2.535186719188738e-01   -5.535569940177759e-03   +2.457151087765846e-01   +4.578992252803866e-01   +5.330214549075973e-01   +5.346541428084260e-02   -2.987815161483446e-01];
L3I_L2I_iGABA_netcon = [+7.182078536073809e-01   +5.243580104204675e-01   +6.223893558211141e-02   +2.247606285405559e-01   -2.593490868025431e-01   +1.199092330288710e-01   +8.430852178131433e-01   +5.406660609787159e-01   +7.509913265575733e-01   +2.197600796006185e-01   +2.318098794082779e-01   +4.717579058946583e-01; +3.962570259623727e-01   +2.017889324973481e-01   +4.790532326019523e-02   -1.848050320367811e-02   +4.600194213065746e-01   +3.601369803649738e-01   +6.693758638247733e-01   +6.675700829078229e-02   +3.628879470062934e-01   +4.795989668413319e-02   +3.411018773014923e-01   -2.466887447490552e-01; -7.324782819545979e-02   +5.225872264864430e-01   +3.351313384926542e-01   -9.892411105039914e-02   +2.686444321642498e-02   +3.073605393954071e-01   +3.622454012817163e-01   +2.857685553905241e-01   +2.653261307612234e-01   -2.093250641720385e-02   -1.323825395503964e-01   +7.330556640632363e-01; +3.454701653125919e-01   +2.763298046958265e-01   +5.604115105797846e-01   -4.473482609968338e-02   +1.545808467824331e-01   +8.631221649914934e-02   +4.864609897551360e-01   -1.120294341144246e-01   +5.140569564512950e-01   +3.453893064732177e-01   +7.975939399939475e-01   +6.899656081075413e-02; +2.522586012932073e-01   +4.295916727071674e-01   -9.063693618000818e-02   +2.680785660756042e-01   +5.678960584802464e-01   +5.449101514530076e-01   -1.190529364758496e-01   +1.000000000000000e+00   +5.955760509419518e-01   +4.041712570772856e-02   +3.508995426313548e-01   +2.913341853187565e-01; -5.148427468699589e-02   +4.128620175366757e-01   +3.394708224261720e-01   +2.253754774245011e-01   +7.643054899586559e-01   +4.240723810371919e-01   +7.553330536670620e-02   -2.029175380616314e-01   +3.122243742206946e-01   +3.447316052195910e-01   +4.723056700630354e-02   +3.208174983325834e-01; +5.700991178223916e-01   -3.426159983458943e-02   +3.616818695493305e-01   +2.440791954505284e-01   +3.414141598959624e-01   +5.046458305327135e-01   +3.819961904289524e-01   -8.742860370569305e-02   -5.832465844093722e-01   +7.614862465872899e-01   +3.968435577662288e-01   -9.569256084760408e-02; -1.615909226751168e-01   +2.126714951555290e-01   +3.418188341207718e-01   +3.571530452764908e-01   -6.725306655590025e-03   +5.372217128380082e-01   +6.649206529591238e-01   +4.846152795243194e-01   +3.988443460123919e-01   +2.958516748296679e-01   +3.774432610424883e-01   +3.162165043802500e-01];
L2E_L3E_iAMPA_netcon = [+4.550600973661278e-01   +1.136015066554565e-01   +5.073038558225914e-01   -3.123207474394903e-01   +3.905542353746813e-02   +1.810548885601505e-01   +5.478007430978150e-01   +3.850229518975339e-01; +9.071847904428812e-02   +1.566498340927275e-01   +1.939330587143621e-01   +2.613715341693021e-01   +4.271494304662517e-01   -1.287266471450922e-01   -2.005473192220333e-01   -2.031579139090794e-01; +2.786116379049465e-01   -7.319969135539561e-02   +1.850620223386186e-01   +3.336936064096027e-01   +1.970670097455268e-01   +2.092437345341498e-02   +1.982250430879589e-01   +1.602383524785220e-01; +2.647974302010487e-01   +2.500743288471003e-01   +6.513219186362958e-01   +7.787742079786111e-01   +3.319983753402103e-01   +5.646571199426298e-01   +1.822436485441082e-01   -1.797359390561062e-01; +3.412677047736515e-01   -6.520957386747142e-03   +2.400018171969923e-01   +6.719939120405435e-01   +5.793032359585947e-01   -5.318204297014885e-02   -5.837751134940533e-03   +1.130814744610125e-01; +3.849566010972985e-01   +6.821882642397563e-01   +5.307491178478421e-01   +6.028941763431932e-01   +5.281108822125981e-01   +1.530523003189574e-01   +4.098331024427263e-01   +6.540915619845986e-02; +1.340560292099031e-01   +4.358016416562090e-01   +5.372718850756594e-01   -1.518501604525665e-01   -4.720297168908190e-02   +7.767059152771824e-02   +7.163838999681615e-02   +3.476716898938819e-01; +2.062075503507680e-01   +3.260096040832134e-01   +2.722700216451050e-01   +1.974930497419364e-01   +2.787289517475101e-01   +3.506522963885505e-01   +2.723235253433290e-01   +7.148549988785656e-01; +4.401261557888134e-01   +5.805821004350081e-01   +3.812773557555074e-01   +6.735191996488238e-02   +8.711507348521522e-02   -1.555884204393705e-02   +7.474721112923944e-01   -2.262429090022199e-01; +1.016053231634826e-01   +2.843071635533755e-01   +3.279612695466962e-01   +6.755341036707647e-02   +3.191127309344794e-02   -1.184701329564608e-01   +4.074735670190298e-01   -1.412189761138313e-02; +4.555496130365222e-01   -4.178000976341450e-04   -1.517165039016259e-01   +9.106289462217945e-01   +1.070735488432137e-01   +3.078585462015292e-01   +1.823802931721490e-01   +2.698214824366907e-01; +1.673928756313997e-01   +8.066091782429878e-01   +5.537231444539119e-01   +6.752544070356244e-01   +1.015603461557251e-01   -8.497422372943038e-02   +1.568293396599029e-01   +3.448571750321483e-01];
L2I_L3I_iGABA_netcon = [-2.635948370556820e-01   +8.547864054367103e-02   +1.897882609255312e-01   +3.074478517449794e-01   +6.331605669024032e-02   +6.933876565367392e-01   +2.884367979959117e-01   -1.309899340045798e-01; +3.187352734593493e-01   +1.782755988470697e-01   -6.558106227077622e-02   -5.641614290253692e-02   +3.380014855602523e-01   -1.803391812250831e-02   +4.510120162976586e-01   +3.457910987810304e-01; +7.609543818257918e-01   +8.398365553719983e-01   +3.293146008892616e-03   +6.111844916319593e-01   -1.027054586918183e-01   +7.708642660291383e-01   +3.090170469985731e-01   -1.628067586164946e-02; -9.632426697232156e-02   +2.067105331764985e-01   +8.366511366086100e-01   -3.771230462977347e-01   -8.457909854609204e-02   +4.940299750903891e-01   +4.033036780814912e-02   +2.758989144548289e-01; +5.679975763242749e-01   +1.844814607574574e-01   +4.290658715108547e-02   +2.645789418800842e-01   -2.348537880804631e-01   +2.125350902462636e-01   +8.668253927327421e-02   +1.600117106721298e-02; -2.910439745961181e-01   +2.246731784396984e-01   +8.103701252689421e-01   -1.978124403208971e-01   +3.300974045815171e-01   +9.187618098412392e-01   -4.336081573873964e-01   +4.974509089043291e-02; +4.875515537961225e-01   +7.320132606671512e-02   +3.497918638653665e-01   +2.589793168634340e-01   +3.424897582370403e-01   +4.245171052040980e-01   +9.582910996002942e-01   +4.160994774056746e-01; -2.269975305855213e-01   +5.876273477665747e-01   +2.978328988404201e-01   -1.166332061655696e-02   +6.968753864793693e-02   +3.743463849200048e-01   -1.483978050603878e-01   +7.052377501240785e-01; -1.000000000000000e+00   +7.923742983838885e-01   +5.775099178189799e-01   -1.206685410869461e-01   +2.314717862114181e-01   +3.668535225408620e-01   +5.219571380898954e-01   +2.728013647248029e-01; +2.034122118530165e-01   -2.145814910682410e-01   +2.887168186784732e-01   +1.350584000185050e-01   +3.932573684641872e-01   +4.489522280513207e-01   +1.135960504703374e-01   +5.235802252135555e-01; +8.641778476353671e-01   +5.180637935198952e-01   -5.401433189163966e-01   +2.104729208062971e-01   +2.234125713414903e-01   +1.853000134501596e-01   +5.800322706542353e-01   +7.302955926566029e-01; -5.167960823267185e-01   +8.895427683539785e-01   -3.750453626316020e-01   +7.215363935518084e-01   +5.677492606241655e-01   +2.630660752543802e-01   -4.456012971988885e-02   +1.122655066934672e-01];
L3I_L3E_iAMPA_netcon = [+2.831071017633799e-01   -1.554023199531941e-01   +2.541003933720941e-01   +3.207783423871119e-01   -2.059598229092058e-02   +9.392589639154214e-02   +2.232075901988951e-01   +1.639332666956696e-01   -1.873178879653091e-01   +4.071581064699165e-01   -1.036523858184830e-01   +3.789977281328703e-01; +1.080803012712900e-01   -3.008867982848299e-02   +9.985568670539466e-02   +5.271774057666488e-01   +1.929362679226628e-01   -2.136427375574598e-01   +2.946492941242641e-01   +2.906533981147529e-01   +5.224323986653868e-01   +1.145699687148208e-01   -1.879855450157810e-02   +7.586680446242526e-02; +2.068285423018236e-01   +4.224885098144061e-01   +5.241707165103927e-01   +9.085077841750257e-02   +6.287366617965863e-01   +2.019369144671521e-01   +6.269787783161964e-01   -4.179945601999838e-02   +3.556676578140428e-01   +4.768414708436527e-01   +1.898613152448311e-01   +2.580548814388078e-01; +3.500801435343301e-01   +2.205641943744576e-01   +5.534383711507262e-01   +7.027626282467564e-02   +2.304581143490519e-02   +5.673215005232591e-01   -5.072938118678207e-02   +3.376617012080133e-01   +1.644874563033011e-01   +3.533591577974801e-01   -2.421596028911550e-02   +1.050076433719863e-01; -1.490782342516414e-01   -1.549460365983034e-01   +8.713824288181373e-01   +2.345409613988296e-01   +3.435991794738591e-01   +2.737071278117206e-01   -1.496405427888428e-01   +3.301251805569165e-01   +2.988598592325977e-01   +6.149919371620736e-01   +3.360732486763361e-01   +2.906846741697886e-01; -9.481558591432283e-02   -2.346735345124142e-01   +1.615137365488483e-01   -5.987219187141283e-02   -3.153531344069684e-01   +8.384810446671796e-02   +2.366654308432694e-01   +1.995954335787896e-01   +3.093779243905742e-01   +1.854320077799095e-02   +2.609810873011650e-01   +5.230470893317722e-01; -1.248146466569781e-01   +1.915051767160025e-01   -2.519309506780291e-01   +1.119358649094236e-02   +3.476542251540796e-01   -3.789314422392204e-02   +7.376780054804856e-01   +4.568268362154660e-01   +8.592392792667519e-02   +3.172443819172839e-01   +3.829959287254975e-01   +1.524418776195887e-01; +4.977253947306909e-02   +2.369192515175266e-01   +2.474137757807194e-01   -1.733397535882882e-02   +1.373549524142686e-01   +1.029300100663341e-01   -2.256658384673667e-02   +4.085857010973882e-01   +2.518738148571336e-01   -2.957707836827657e-01   +1.505475627637833e-01   +2.713517440943991e-01; -1.493996497646939e-02   +5.059883009601284e-01   +2.433972409302244e-01   -1.627358062106392e-03   +1.336538036186677e-01   +6.208723439721258e-01   +2.125999081702835e-01   +4.745534372162197e-01   +6.304260855882910e-03   +3.546804470021570e-02   +4.909638768381174e-01   +9.462552573113614e-01; +5.830864357491941e-01   -5.641292551272854e-01   +5.837312953694215e-01   +1.707622231918549e-01   +2.390996791258929e-01   -4.630806511679775e-01   +5.684519833376791e-01   +2.835342935916452e-01   +1.438995400679276e-02   -1.730881193795549e-01   +9.512492567403360e-01   -1.996788390218264e-01; -4.644374763568138e-01   +3.375871144383312e-01   +6.935626015689547e-01   +4.569300736976782e-01   +1.152844426117141e-01   +1.288404307928016e-01   +3.170490029612603e-01   +1.581809954956120e-01   +5.342040320551353e-01   -1.822966822127041e-01   +2.292125181314387e-02   +2.736698782850415e-01; -1.452306529736212e-01   +1.695176955983215e-01   +2.973687244910766e-01   +2.887636719022020e-01   -2.467632639937509e-01   -2.457124688148749e-01   -3.664811838704388e-01   +2.524047124482141e-01   +6.630579945112588e-01   -6.148973984664535e-02   +3.232437382490608e-01   +2.750991337415853e-01];
L3E_L3I_iGABA_netcon = [+2.316634247712713e-01   +1.118638107129924e-01   -1.005039635133521e-01   +4.230734062863015e-01   +2.511202403122821e-01   +3.511200621573251e-02   -2.315440702528460e-02   +2.062004129735991e-01   +4.252381836580293e-02   +3.663449152840902e-01   +3.240845879366475e-01   -9.540393815279437e-02; +4.794762182065216e-01   +3.909912490688497e-01   +1.714964830001936e-01   -4.625747718291485e-03   +3.640209457245683e-01   +2.287083752269495e-01   +2.148264634859338e-01   +3.225565685495022e-01   -4.073117713638995e-01   +1.226457071663595e-01   -2.684576555110736e-01   +2.013239346344642e-01; +1.670671062709012e-01   -4.472228963717517e-02   -3.216250596343379e-01   +1.760646221004321e-01   +1.822904451716957e-01   +9.076499912791022e-02   +1.143218850036210e-01   +2.981012392721242e-01   -1.877412379999301e-01   +2.990948754800393e-01   -1.613973984198705e-01   -1.212198461946934e-01; +7.159078387673963e-02   +2.929027990843416e-01   -4.584141104213534e-01   +4.244140305294191e-01   +7.289715121390863e-01   +3.192211639112291e-02   +8.351824848854414e-02   +2.704870561793059e-02   +5.647663829808420e-01   +2.914119771765090e-01   +1.691979162807171e-01   +4.181517629747958e-02; +3.351503877888747e-01   +5.066715378814064e-02   -6.777852517634435e-02   +3.479252389992583e-01   +8.462925149331540e-02   +1.648947771830102e-01   -7.584120703948911e-02   +5.389869417556308e-01   -1.497815897191157e-01   +4.794535723185912e-01   +3.806917272586422e-01   +2.358385715704233e-01; +4.699993573708615e-01   -6.920866983729040e-02   -7.485573108048429e-02   -1.191262888747959e-01   -2.769148739001542e-02   +2.669185188494104e-01   +1.447213053896893e-01   +1.968987997179085e-01   +4.237041519907797e-01   +3.101535898510059e-01   +1.722328463038885e-01   -3.005866952221332e-01; +5.476112738592628e-02   +1.156743573825372e-01   +3.019106827751325e-01   +9.983684028289743e-01   +2.292828184545942e-01   +4.884143922635794e-01   +5.301984146475677e-01   +2.507368114603273e-01   -8.479868157996881e-02   +2.488708125672709e-01   +6.301265806694547e-01   +1.110073695846370e-01; +1.769891230307717e-01   +8.233595492629467e-02   +5.683484234488811e-01   -2.002340016420209e-02   +2.641621648325923e-01   -1.389725774639753e-01   +7.128232386317798e-02   +6.530730581397701e-01   -5.647870068506947e-02   -4.076951555965528e-02   +9.709149138883540e-02   +3.863881852190276e-01; +2.590808128900303e-01   +5.786934190979150e-03   +3.925010400755757e-01   -7.723885819086451e-02   +1.995908965318892e-01   +7.144877119940239e-02   -3.959336986289950e-01   -1.310965074775187e-01   +4.599090069273284e-01   +4.607784146053347e-01   +3.306982511795117e-01   +5.956542946332153e-01; +2.177857762709418e-01   -1.334688990305252e-01   +4.168802398013446e-01   +1.974034695724705e-01   -2.883029618372239e-01   +3.943708833909950e-01   +1.750767868817305e-01   -7.514352561765310e-03   +1.365695794733085e-01   +1.265121549336527e-01   +2.677932775766668e-01   +2.638650206032773e-01; +2.981074282450740e-01   +1.652548459528097e-01   +3.612544625076716e-01   -1.958669296466159e-01   +1.553954570045249e-01   -2.493009717945089e-01   +3.089183975185867e-01   +8.556473555688648e-02   -1.873510536444709e-01   +5.946401005481838e-02   +3.576690406380930e-01   +4.698132690724797e-01; +6.901837566276094e-02   +5.107699067701972e-01   -5.069978295912977e-02   +4.202210679245594e-02   +7.843709174403660e-01   +3.597998284667194e-01   +4.564206081440791e-01   +1.531711560440000e-01   +1.028135145548124e-01   -1.367912263492323e-01   +2.433608466906320e-01   -2.835092078197146e-01];
L2E_Input1_iAMPA_netcon = [+6.912202968659408e-01   +5.656089645716397e-01   +7.009695623848792e-01   +8.210572995720899e-01   +1.000000000000000e+00   +6.443496412656267e-01   +4.710754266547835e-01   +7.385273413419392e-01];
L2I_Input2_iAMPA_netcon = [+6.362316722133980e-01   +7.408347075369816e-01   +7.128338160672273e-01   +8.177121638576867e-01   +1.518978545382699e-01   +9.115373233875060e-01   +1.624438718802111e-01   +1.766543012259250e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
