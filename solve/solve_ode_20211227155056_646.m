function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.954666660688092e-02   +6.883790330425470e-02   +7.718011811668921e-02   -3.488428130609608e-02   +3.671070310747508e-02   +7.786397687893479e-03   +2.448138552351248e-02   +1.569232596523992e-02   +3.292759746224674e-02   +4.118424996265464e-02   +9.489499408150436e-02   +9.194729503109964e-02   -1.033481140979839e-02   +5.141625213733879e-02   +1.257106070134240e-01   -3.514279808618357e-02; -5.349823988731458e-03   -3.707098018924350e-02   +1.636395440729234e-02   +1.824204438812857e-01   +9.333964450285001e-02   +6.747229116733729e-02   +3.811742211836575e-02   -5.774831040988245e-03   +8.194458990686700e-02   +1.834815477808514e-02   +5.674161785671730e-02   +4.876219562170035e-02   +1.022132191773297e-01   +6.493897271020949e-02   +1.670832833450755e-02   +6.022830630494532e-02; +5.106390030975906e-02   +5.376890835539676e-02   +6.067030062189242e-02   -4.511937041490623e-02   -4.420338580527420e-02   +3.771489628978057e-02   +1.440202351968613e-02   -3.400968954745136e-03   +7.947779919516253e-02   +9.653379612874345e-02   -6.239532563625980e-02   +7.544951723213389e-02   -1.195572478927949e-02   +5.014353314324978e-02   +4.108791797063285e-02   +6.311044832325519e-02; +1.442867680220013e-02   +1.235376005682654e-01   +9.263563277036574e-02   +9.641384299108624e-02   +4.881232325240892e-02   +3.249590793294117e-02   +2.834066481638048e-02   +9.337549466765400e-02   +4.459965565898916e-02   +6.457867501976017e-02   -4.460409537373135e-02   -3.522859260306790e-02   +7.959434422215543e-02   -7.179004510003952e-02   +8.320532224503743e-02   +6.541910562873024e-02; +6.378135031813789e-02   +6.847510929038259e-02   +1.439652453664834e-01   +6.052675008717004e-02   +2.613002757202443e-02   +2.864249662432129e-02   +1.984224435824548e-02   +1.176946039354232e-01   -2.065331631559198e-02   +3.221752188507973e-02   -1.362824440429538e-02   +1.717215461055737e-03   +6.214186409763796e-02   +7.903106646548967e-03   +6.682748140047337e-02   +1.047141071737836e-01; +6.502104938536982e-02   +4.706029819719743e-02   -3.930511336751347e-02   +5.993947503160423e-02   +4.746220825973710e-02   -1.059341022494790e-02   +9.872803275908833e-02   -6.388528192181626e-05   +5.063503685568560e-02   +2.934424844879831e-02   +1.427700225736056e-01   +1.285939618737301e-01   -7.065324113938282e-02   -5.443469248822379e-04   -1.277586054665898e-03   +2.794898751645160e-02; -5.572153649070858e-02   -1.119824965810578e-02   +5.616589494469334e-02   +1.185614202237363e-01   +6.265511563502489e-02   -3.687751042562860e-02   +6.317982490222483e-02   -3.360903768850355e-02   +1.477991609721796e-01   +4.624196417670977e-02   -2.729543337279768e-02   +4.687711689613772e-02   +4.228212914553564e-02   +8.272798626610296e-02   +3.939830391400363e-02   +7.862052151091826e-02; +3.533562880697012e-03   +5.456868037011299e-02   +3.771636310329408e-02   +5.002328255974098e-02   +1.012665875583196e-02   +1.232628570344132e-01   +5.770771375565156e-02   -5.894407385928597e-03   -4.752732572223219e-02   +7.309525381944629e-03   +1.299606756752071e-01   +2.523785007189813e-02   +4.673951688764318e-02   -7.034315362982325e-03   +1.506296430756031e-02   -3.509158441013711e-02; +4.870604292036414e-02   -2.256099423857675e-02   +6.356752477580470e-02   +4.609472526927851e-02   +8.627962414871375e-02   -5.144611382177995e-03   +9.248605839644264e-03   +2.778636569110340e-03   +2.708505902365774e-02   -3.837670679590427e-02   +1.008338550796818e-01   +2.481237770323110e-02   +4.264856077380081e-02   +2.173379438172988e-02   -9.687651172769559e-03   +7.233149860884588e-02; +5.654763054661988e-02   +8.372910972083021e-02   +3.171871107201957e-02   +8.294856186725834e-02   +7.428600361635858e-02   +1.417416066790222e-01   -1.383138614597015e-02   +4.663648322970696e-02   -1.381326772232902e-02   +9.825278141635276e-02   +6.968396989008312e-02   +5.745859785549717e-02   +1.489369178307235e-01   +6.444941267893876e-02   +5.705181483574934e-02   +2.023867545295398e-02; +3.146247794973239e-02   +3.835354531292952e-02   +5.666231929576561e-02   +1.672066012912519e-02   +3.385603248408813e-02   +1.562393344628004e-01   -2.760904298455328e-03   +2.987979197366257e-02   +6.380193938725304e-02   +4.341234616273397e-02   -4.061505215417004e-02   +4.888717794160694e-02   +1.135934588438460e-01   +2.592678563493355e-03   +2.652575446439779e-02   +4.586488789835943e-02; +3.323673564068087e-02   +5.468987851504389e-02   +3.086112414466516e-02   +7.935218294867159e-02   -1.304254388903032e-02   -3.789755043793930e-02   +6.844816828100363e-02   +1.170660856464220e-01   +1.085733393425568e-01   -1.646008289082380e-02   +6.811117658386787e-02   +2.274167791775931e-02   +4.335251861790018e-02   +9.082986848733748e-02   +9.487151694157407e-02   +9.581018727289022e-02; +1.469857045948491e-01   +6.992563737828345e-02   +4.749344820126031e-02   +2.576597351568034e-02   +3.118216976571066e-02   +5.563311516754081e-04   +5.873934461113602e-02   -1.083431703322177e-02   +3.198259056219459e-02   +8.376204992155262e-02   +1.294133386572202e-01   -7.142055764459133e-03   +3.983584052635773e-02   +2.257650409703196e-02   +8.057774481905117e-02   -9.131652524524796e-03; +9.924239930036863e-02   -2.573933986485481e-03   +3.230215582260679e-02   +1.363932649198688e-01   +9.660764076791439e-02   +3.770457916308867e-02   +1.089201235912476e-01   -4.958684163741591e-03   +5.207362511028577e-02   +6.811625705196322e-02   +6.715148032195620e-02   +1.255610041840278e-01   +1.070855336316560e-01   +8.544933950832809e-02   +9.721574507186424e-02   +1.101975764932855e-01; +5.328930896070838e-02   +6.977683777715132e-02   +9.329112893216797e-02   +7.690146400758049e-02   +1.197882874318557e-01   -3.575373233657263e-02   +7.477392886502482e-02   +7.689848053373945e-02   +9.238210921790831e-02   +6.953363693499678e-02   +6.895080010715661e-02   -7.209331972824165e-02   +1.061697177628531e-01   +4.610411323175196e-02   -6.664133418263529e-03   +6.099644168901810e-02; +8.487691772425116e-02   +1.143343374407694e-03   +5.768464172360876e-02   +7.548166703053548e-04   +1.004631976245086e-01   +9.650594057973075e-02   +5.930816082561896e-02   +4.200981594762632e-02   +7.445632956187688e-02   +3.835733228519948e-02   +8.619553941546951e-02   -5.965992951960044e-03   +7.617641350097532e-02   +2.767877036679232e-02   +4.847500678164357e-02   +1.230211944549492e-01];
L1E_L1I_iGABA_netcon = [+4.620074434862012e-02   +1.310570539528539e-01   +6.350259734268129e-02   +1.057530924189789e-01   +2.478668787056127e-02   +7.675530240982503e-02   +4.732281879445518e-02   +4.459992898641962e-02   +1.148281804834818e-01   -1.003461669438928e-02   +5.998120199799288e-02   +5.350172627888530e-02   +2.562072409842261e-02   +7.017970230599722e-02   +6.568987069956558e-02   +1.080012547346631e-01; +4.194583921204165e-02   -6.692973858682838e-03   +8.406969087995905e-02   +1.056472861526760e-02   -4.676775619650918e-02   +4.954299371021530e-02   +4.203663765905587e-02   +4.664324366456233e-02   +6.137639823284209e-03   -6.454893865037589e-02   +9.337636864707623e-02   +3.670520838251932e-02   +6.509884222426725e-02   +4.410773221467715e-02   +3.730903992877514e-02   +8.805136571304173e-02; -1.245850707853898e-02   +1.038282477161484e-01   -2.136988799052986e-02   -1.583857443697296e-02   -4.002237131160098e-02   -1.729334375384229e-02   +9.642756478907916e-02   +4.850835266140984e-02   -3.829152344131937e-02   +2.146186676750137e-02   +6.532488944000947e-02   +7.657027199385744e-02   +5.139779637678620e-02   +3.753975925398571e-02   +5.780827360651990e-02   +3.535052842738168e-02; +5.420131665110833e-02   +1.042899874489424e-01   +8.929211952612857e-02   -2.116131532668614e-02   +4.066072130731450e-02   +1.447265360764713e-01   -2.865385421050849e-03   +4.652068505413522e-02   +2.669727430508409e-02   +1.118639058999930e-01   +1.061456826968209e-01   +8.829068313086455e-02   +6.058163389566152e-02   +4.080550869500273e-02   +4.663151583244038e-02   +6.373936912011217e-02; +4.448709995891897e-02   +7.831567803790609e-02   +9.644310624718468e-02   +1.233366302751205e-01   +7.071256446129770e-02   +6.939507107377962e-02   +5.897386500368107e-02   +3.881702478327991e-02   +7.918836668035323e-02   +4.114209299400400e-02   +1.010751377521125e-01   +2.193829347893713e-02   +6.117525471048171e-03   -1.981781543929480e-02   +8.246045503284039e-02   +6.027878748939452e-02; +1.197741701575083e-01   +2.303235972165997e-02   +2.355965804557280e-02   +1.030737099494172e-01   +2.682825790323728e-02   +6.564552209269799e-03   -5.971375235356218e-03   -9.842710113023151e-03   +1.687741669629343e-01   +6.677292107589772e-02   +6.865349062391454e-02   -2.748944286679978e-02   +1.065656654306596e-01   -5.073671451983514e-02   +2.910240129209041e-02   +2.399951083191502e-02; +2.376348685947090e-02   +6.732823688865101e-02   +1.012148021719320e-01   +4.929859465109656e-02   +3.314688310414744e-02   +2.204337740783350e-02   +9.159919552040660e-02   +3.147397838346648e-02   +3.699404476284066e-02   +7.575260432596444e-02   +2.046890847515265e-03   +1.089459008276921e-01   +6.219333800944222e-02   +1.085819129277459e-02   +4.491744770239971e-02   +2.656934542071146e-02; +4.368202910852374e-03   +9.216084249905789e-02   +3.521762533306411e-02   +6.321068921602552e-02   +3.889886938011004e-02   +3.277261559007556e-03   +2.166221274574917e-02   -6.818932065157246e-02   +9.188208270729864e-02   +5.299430065080387e-02   -1.406480698588767e-02   -9.138053140679881e-03   +2.352049977933210e-02   +6.238574544856844e-02   -2.203336576909748e-02   +1.688319916457670e-01; +6.482013440334234e-04   +1.028203301513155e-01   +9.676343114734129e-02   +2.854438273824745e-03   +3.322854163420546e-02   -1.037945999295621e-02   -2.106541510190069e-02   +1.699910353499325e-02   +2.586331159520519e-02   -5.336025716208676e-03   +4.683032716658626e-02   +1.963871241324284e-02   +3.364650021018720e-02   +1.063985689824471e-01   +7.208174924126148e-02   +8.788249895532231e-02; +5.173761827152767e-02   +1.075085515789388e-01   -2.630655094727022e-02   +1.896617674156996e-02   +3.182079782539109e-02   +5.387305640216628e-02   +1.052492408083019e-01   +2.865347780165960e-02   +7.741238981655506e-02   -8.459797463067254e-03   +7.892506168252091e-02   +6.721419662124693e-02   +3.537091629343762e-02   +1.085096690384587e-01   +9.751042504676799e-02   +6.971342445147502e-02; +3.471378837715348e-02   +7.539305277893124e-02   +1.936429461855305e-02   +6.215270345795676e-02   +6.501143573631787e-02   +1.283199411179381e-01   +3.622217118793802e-02   +2.590413399220362e-02   +5.177577066482641e-02   +6.205757888757226e-02   +4.221316266528111e-02   +8.064691598071883e-02   +8.880639014168787e-03   +2.568912280434682e-02   -3.480633517602492e-02   +8.892286727128743e-02; +3.698049509942570e-02   +2.835276894263461e-02   +2.422859934961757e-02   +7.165234339995058e-02   +3.221136967887053e-02   +4.924905820439782e-02   +5.282632796348195e-02   +5.172199076213520e-02   -4.845083326368482e-02   +8.279480917338627e-02   +6.062983511577323e-02   -3.898549204228362e-02   +2.708325330855050e-02   +6.680858021365774e-02   +7.717144034963631e-02   +9.530544551419259e-02; +4.119771652621725e-02   +4.364727600043136e-02   +1.146419509325053e-01   +2.299411145941263e-02   +3.632559512407142e-02   -3.086402018253048e-02   +7.636828108986137e-03   +8.019896567449511e-02   +8.702403198629309e-02   +7.150490850108727e-02   +4.129159909021555e-02   -4.892938093404322e-03   +4.402296861292544e-02   +6.969530009304570e-02   +8.842728417733690e-02   +3.918789052624381e-03; +2.748013813460976e-02   +6.284404330335513e-02   +3.061313615083490e-02   +1.627549745168221e-02   +7.081465153326720e-02   -2.923611960399996e-02   +5.011598283785706e-02   +2.352741335045614e-02   +4.058019102712190e-02   +1.062957071292313e-01   -3.776541468196195e-02   +7.448350874471137e-02   +9.612617082126573e-02   +1.081909311096767e-01   -4.717497752455353e-02   -8.618364662331211e-04; +8.501099753572763e-02   +1.744222711875958e-03   +1.149514094817868e-02   +3.621769241962965e-02   +2.283048790922795e-02   +3.068813986607716e-02   +6.420432949757596e-02   +2.874729371153027e-02   +9.062732198446093e-02   +9.378673102191074e-02   +6.515462421064983e-02   +8.902251265167305e-02   -4.528568169194642e-02   +5.731671566960830e-03   +6.240063029015094e-02   +1.090460770803980e-01; +2.935332547640708e-02   +2.360571498512757e-02   +2.739607681074354e-02   -3.348115799111290e-02   +4.099431642531010e-02   +1.335853699689298e-01   -3.696666288068989e-02   +2.773468242074893e-02   +1.011261213210434e-01   +4.110266879458800e-02   +9.764495752848670e-02   +2.094502657078286e-03   +2.392138753100783e-02   +1.570025652299708e-01   -6.688606549164533e-03   -1.524928613717713e-02];
L2I_L1I_iGABA_netcon = [+7.734907653882913e-03   +3.893860331787898e-02   +1.119321003113130e-02   +6.081874772298281e-02   +5.119393035014858e-02   +4.441517272021855e-03   +5.655221677110167e-02   +6.336347897293290e-02; +2.372116094963933e-02   +4.623610646565887e-02   +5.194843147969636e-02   +7.128444679489571e-02   -3.907707978933686e-02   +4.965541999094688e-02   +6.663057554376453e-02   +4.382620493376423e-02; -7.709893162611123e-03   -1.698680893431570e-02   +1.220194173655448e-01   +4.582251892504032e-02   +7.085827781836590e-02   +2.495557889925169e-02   +7.979977700683601e-02   +5.101206974636512e-02; +8.763821237657167e-02   +1.042987954347021e-01   +7.106901514249926e-02   +2.710218707398902e-02   +7.104019339848207e-02   +2.185684771839700e-02   +4.600394121943000e-02   +1.342992354764665e-01; +6.202538502469935e-02   +6.002065547797861e-02   -2.421279908868942e-02   -2.451160664169276e-02   +5.388517381301591e-02   +5.458022212944692e-02   -1.799618164718215e-02   +3.567557818883846e-02; +8.344639705910470e-03   +1.060450398932820e-01   +1.177023637550030e-01   +2.260949233329266e-02   +8.679747538534663e-02   +6.088374892556701e-02   +6.235935112910863e-02   +1.630573576846193e-02; +7.046012172862121e-02   +6.609729981376918e-02   -5.039033612709626e-02   +6.769178514289675e-02   +2.755487139100182e-02   -3.338245686047460e-02   +6.430422968567334e-03   +4.757761533756193e-02; +1.537365635746835e-02   +6.579184852028053e-02   -1.114757486484259e-02   +1.505063509950384e-01   +3.729505449740085e-02   +1.227399161960415e-02   +6.422821045128438e-02   +3.005693623180487e-02; +3.241566121069898e-02   +8.674562315745937e-02   +2.396865504032761e-02   +1.136280100582521e-01   +8.726195289702193e-02   +6.801000028662796e-02   +1.111112048981147e-01   -1.540611886054711e-04; +3.097743675041961e-02   +5.820506789312084e-02   -8.811096959342537e-03   +6.605115543056046e-02   +7.885332851687323e-02   -4.317204840146903e-02   -1.726170072910716e-02   -1.787999364639433e-03; +5.560585783556291e-02   +8.821158532050909e-02   +8.415013483237554e-02   +6.647216338249892e-02   +5.887015715583856e-02   -1.524829241962997e-02   +7.313941783866322e-02   +3.859414208667544e-02; +6.509453679024307e-02   +3.868874377302259e-02   -1.805905707214800e-02   +6.113201391946868e-02   +1.158019370063824e-01   +9.523626835751095e-02   +2.321179719793116e-02   +5.192941418671917e-02; +3.349677173622256e-02   -3.197568019520806e-02   -1.751790646964363e-02   +1.067520521671544e-01   +8.248226462894549e-02   +1.202460627252420e-01   -1.410579266867484e-02   -5.287760992526334e-03; -4.710347159895496e-02   +3.530839099898783e-02   +5.953881851666538e-02   -5.362149757950255e-02   +6.866412441069344e-02   +7.045270039129126e-02   +6.469391503246162e-02   +1.031236220684600e-01; -2.296484713368748e-02   +3.820701629817522e-02   +6.487518935719183e-02   +9.898045141383360e-02   +4.897754446051961e-02   +8.585767235850175e-02   +9.075823286388930e-02   +6.651363408727543e-02; +2.822831476837119e-02   +8.760894160214916e-02   -1.030097923474916e-02   +5.637569848744815e-02   +6.525469327036065e-02   +5.214408066691326e-02   +4.124614373764914e-02   +1.027502976601226e-02];
L1I_L2I_iGABA_netcon = [-2.617359844858493e-02   +1.674400664996932e-02   -3.510467885875641e-02   -3.799768429717164e-02   +1.387485938138802e-01   +5.061049797121644e-02   +5.310665756061703e-02   +1.059463827457699e-01   +5.886516172054933e-02   +7.083266211041807e-02   +4.735089987108815e-02   +2.739513514456589e-02   +1.038039050383489e-02   +5.197330820638126e-02   +5.058590903652144e-03   -4.264776783398531e-02; +1.001232405118184e-01   +5.312071307995145e-02   +5.834827037591209e-02   +2.561245226648464e-03   +2.233385547306026e-02   +4.982468203287720e-02   +1.100388584539554e-01   +1.104918360350412e-01   +8.730766257549444e-02   +9.070204270253857e-02   +4.635063270929125e-02   -4.030047475316895e-03   +9.567911289221306e-02   +8.006683106626250e-03   -1.402221304366109e-03   +4.034175006548019e-02; +8.277955565954916e-02   +6.313621516164146e-02   +9.532694778285075e-02   -9.600493564117962e-03   +8.921246450285143e-02   -1.837171084436521e-02   +4.620558530258431e-02   +2.991681744533942e-02   -1.223726451145557e-02   +1.345450588914975e-01   +6.152236485434195e-02   +5.831042207627556e-02   +1.228507927373730e-01   -3.283567207952769e-02   +1.906849620593812e-02   +2.224602882297316e-02; +4.318728887941129e-02   +7.258320140904764e-02   +5.629702655796529e-02   -4.032367122126079e-02   +2.775589676333776e-02   +8.092203535174410e-02   +6.571759323600450e-02   +4.922246766077267e-02   +3.812021376999004e-03   +8.391378928630554e-02   +1.021642844547844e-01   -3.443584308563016e-02   +8.223308665383071e-02   +2.133112858853486e-02   +4.870724145987090e-02   +1.234132940520682e-01; +4.509161851567936e-02   +6.617895600900524e-02   +1.132666924290463e-01   +3.344985332158311e-02   +1.294596407674139e-01   +1.072949334590338e-01   +9.693662031328423e-03   +3.693926130200646e-02   +6.678506903066470e-02   +3.352766357274236e-02   +5.229377899226460e-02   +4.528087608007200e-03   +4.164450724103533e-02   +1.504158666552046e-02   +1.012114835704266e-01   +7.368948604385372e-02; +2.065495781727882e-02   +6.300622401982843e-02   -2.896412094107675e-02   +1.048354323646900e-01   +9.145562509967622e-02   +5.231747494925582e-02   -3.398648280660770e-03   +4.314780543476306e-02   +2.992115861544649e-02   +3.847968042296290e-02   +6.303926441992737e-02   +2.697171065902320e-02   -2.154235879097642e-02   +4.156838054056015e-02   +3.980880355523490e-02   +1.418568182806745e-01; +1.679421935120495e-02   +3.766832113223520e-02   +1.325825191108436e-01   +5.381031112375591e-02   +2.120206058264525e-02   +1.157794443324150e-01   +4.694286067803510e-02   +4.476299094551021e-02   +1.807619874247152e-02   +1.028745403486631e-01   +5.833096614336519e-02   +3.865661483888716e-02   +3.802838479647000e-02   +1.725808509879063e-02   +5.435722972046772e-02   +2.671075567122710e-02; +4.670649071189442e-02   +4.639364584255563e-02   +7.329654774519383e-02   +6.862050982263881e-02   +2.750838398443135e-02   +9.473557736502941e-02   +7.775819680301577e-02   -4.243736381661826e-02   +1.440883323952884e-01   +4.336804508237316e-02   +1.340823021861964e-01   +1.680931221589926e-02   +1.717036421812339e-02   +3.266862319967206e-02   +4.597107153920099e-02   -2.484533661984051e-02];
L2E_L1E_iAMPA_netcon = [+7.821053032652146e-03   +7.300058792119538e-02   +1.104248865919427e-01   +1.225632536628318e-01   +3.891933909180183e-02   -4.990189712970699e-03   +5.450756265599623e-02   +1.495870361350203e-03; -7.193930879509439e-03   +5.267763687597805e-02   +8.256684149948339e-02   -2.349172878130356e-02   +7.634094768222960e-02   -3.663774098478385e-02   +3.328733437850167e-02   -2.615403531948716e-02; -2.039176248094211e-02   +2.934742315109809e-02   +7.817541782690383e-02   +9.535483542749223e-02   +2.593512865996584e-02   +8.618967058674221e-02   +1.173696961068142e-01   -1.350222978653500e-02; +1.119285696388743e-01   +3.095489630270991e-03   +8.057593007253685e-04   +7.346124436730335e-02   +3.761650770644710e-03   +7.076872921471028e-02   +4.188331547302582e-02   -1.283371438268597e-02; +1.174340002977718e-01   +1.038340902325523e-01   +2.824666855749871e-02   +4.091325702901356e-02   +6.061382191190842e-02   +9.147314429163933e-02   +4.274946254241677e-02   -3.311088698015515e-02; +8.285833129390099e-02   +4.996729549896554e-02   +1.472662506151458e-02   +7.156533250839407e-02   +9.005151609960099e-03   +1.132946230044288e-01   +8.230353638742451e-02   +5.855170849630388e-02; -5.028349824499338e-03   +1.028289859109114e-01   +2.760267509014300e-02   +8.255603745683185e-02   -4.667550098156358e-03   +1.125374626676124e-01   +5.602969686364037e-02   +1.080232278095108e-01; +5.102024793995837e-02   +1.352381983399231e-01   +1.011864147462611e-01   +9.072633471998003e-02   +8.787111253187242e-02   +2.424366952515651e-02   +6.978688865062313e-02   +7.356074538415999e-02; +1.018248876250446e-01   +1.013124118275401e-02   -2.708227204645620e-03   +7.572057277643569e-02   +1.289921645613303e-01   +3.070676421068042e-02   +7.292358155085686e-02   +6.723948990534834e-02; -4.434051171474655e-02   +1.063492748657550e-01   +9.572131642764686e-02   +4.730336586608014e-02   +1.014549410805407e-01   +3.433996365398082e-02   -1.444690212079267e-02   +2.237194636513807e-02; +4.442810772342953e-02   +9.876855905271982e-02   -3.151516598978629e-02   +1.423690148839005e-02   +2.159045940460113e-02   +7.327146283869501e-02   +1.003955163068185e-01   -4.182350613279943e-02; +5.759392937266861e-02   +7.910084290733611e-02   +4.148612966190319e-02   +3.155718166257215e-02   +8.621692858539148e-02   +1.323314017024583e-01   +2.723776754573050e-02   +1.085490556086092e-01; +2.313939040447252e-02   +9.365892602297494e-02   +1.138306420458570e-01   +1.152340795841930e-02   +9.786248532990179e-02   -2.649848247934461e-02   +1.052149973493258e-01   +8.770566045992788e-02; +7.882622994663951e-02   +3.771053449350549e-02   +4.390157268305742e-02   +6.147539652764220e-02   +4.213671725873770e-02   +3.411165852890639e-02   +7.903160893203023e-02   +7.376426245994752e-02; +6.007988618448191e-02   +1.103849416425576e-01   -3.016971552171848e-02   -8.460946099734128e-03   +4.742454272400885e-02   +4.465292324846928e-02   +7.961884148730190e-02   +6.173091881100819e-02; +6.563510624494454e-02   +6.209097677962341e-02   +9.287663924044910e-02   +2.193255356206641e-02   +4.739469910010181e-02   -1.842434940990075e-02   +1.070113421245201e-01   +2.015420549758953e-02];
L1E_L2E_iAMPA_netcon = [-1.838202180184188e-02   +5.702190821921706e-02   +1.002148424929941e-01   +4.662029452958989e-02   +5.981794156662183e-02   +7.387265232153534e-02   +5.803064148215763e-02   +9.066987709332562e-02   +9.785582335915655e-02   -5.828323965781829e-03   +9.760085047663375e-02   -3.342070601013159e-02   +5.075227512940751e-02   +7.533956751684542e-03   +7.920024517602633e-02   +1.153806275481535e-01; +7.295133958349470e-02   +5.537386064850421e-02   +3.616518267460223e-02   +4.762029309532045e-02   +2.396313670332198e-02   +5.726968519659074e-02   +5.138378464783933e-03   -2.117875132704989e-02   +3.925150548977007e-03   -8.084613033832384e-02   -4.443594661843474e-02   +1.124498558723283e-02   +4.026092029073983e-02   -1.956371848882975e-02   -5.652304651546550e-03   +4.603407085072186e-02; +4.372450438802752e-02   +4.593054314812157e-02   +9.545221765909570e-02   +6.002846262245877e-02   +3.020397186840888e-02   +4.300770338197368e-02   -7.063533108329552e-02   +6.701810234775731e-02   +2.741955369926139e-02   -9.202948610148533e-03   -1.495064654523292e-02   +4.634333892290475e-02   -2.584227834037755e-02   +4.089824513143186e-03   +6.456017764038205e-02   +6.536613446669934e-02; +7.489389211240989e-02   +4.696097472028614e-02   -3.120934372437641e-02   +1.191575842790810e-01   -2.818464680461712e-02   +1.531577893725459e-02   -2.502143159403052e-02   +6.483479463937256e-02   +1.173347574941240e-01   +1.471564059337132e-01   +1.353178075434095e-02   +2.585453160011699e-02   +6.420887175168906e-02   +2.243819654876233e-02   +7.299515811262518e-02   +1.376118938704027e-01; +6.406002006184441e-02   +3.383286403682708e-02   -1.247849038012577e-02   +1.937373012015839e-05   +1.167399174040358e-01   +1.349717205552865e-01   +1.414035796776530e-01   +7.799044206710594e-02   +6.048811484120365e-03   +2.285238089469089e-02   +1.930362937613541e-01   +5.127340213473923e-02   +2.269311116165154e-02   +1.052695534198795e-01   +5.423667537771659e-02   +3.066440671579570e-02; +4.391988702673490e-02   +3.441008137848126e-02   +6.392168062109781e-03   +3.712361981049658e-02   +3.559610202087150e-02   -2.757060633748827e-03   +3.909413370376655e-02   +7.689432950624911e-02   +9.788506410056386e-02   +6.311088218154033e-02   +2.537561127345314e-02   -3.542953265095158e-02   +9.084680524282647e-02   +6.617311955511371e-02   +5.574419774515275e-02   +6.477157924732453e-02; +4.647276093319780e-02   -1.787939321500851e-02   +1.361149226360041e-02   +3.450328012637940e-02   +5.236079472591339e-02   -5.856517309613182e-02   +5.642019759336354e-02   +3.145640243299500e-02   +3.230305822486820e-02   +4.266769350090242e-02   +4.440191606845201e-02   +2.219159485588543e-02   +4.536554392157492e-02   +5.685092304210550e-02   +1.096726043680973e-01   +5.201069067117308e-02; +1.341037938059600e-02   -2.592747945338480e-02   +9.799261781448398e-02   +7.554722166916146e-02   +5.446857008371097e-02   +4.836331387027740e-02   +5.989665432532042e-02   -3.450773420727461e-02   -1.633383709104481e-02   +9.356083436527861e-02   +1.169578501275650e-01   +1.911465420748454e-02   +5.206384490696847e-02   +3.500742048071152e-03   +9.705466117276726e-02   +6.774774984315900e-02];
L2I_L2E_iAMPA_netcon = [+2.907554027162781e-02   +3.902202791302178e-02   -3.036717047523454e-02   -1.793566243797859e-02   +1.027440739102580e-01   +7.191377446225947e-02   -7.005895656808132e-03   +5.138054378150556e-02; +4.170211274373794e-03   +8.806889397201374e-02   +1.061282710195585e-01   -3.193388440718151e-02   +2.305464328756943e-02   +5.998586065692423e-02   +3.346731668208371e-02   +6.647942116885987e-04; +1.829180836725159e-02   +6.789921813008201e-02   -4.336397197425027e-02   +1.687877308575277e-02   +8.958076982602209e-02   +8.918109165566560e-02   +5.937098754251385e-02   +1.968055683944773e-03; +1.300355534632688e-03   +9.445531731297212e-02   +8.306609561915046e-02   +4.952510743187079e-02   +7.925244608650217e-02   +7.476451584465622e-02   +4.440361128337006e-02   +4.177478908246320e-02; +7.866674696700658e-02   +1.029804668171414e-01   +5.663874064474338e-02   -4.121233411649614e-03   +1.588380721986845e-02   +8.489960002575930e-02   +4.761240160283568e-02   +1.167649490346499e-01; +7.983741422058427e-03   +3.812583795655614e-02   +1.252036316426577e-01   +9.696130555333405e-03   +9.330262835474890e-02   +4.067558984662963e-02   +1.539443070094265e-02   -1.806957458877153e-02; +2.475732058918433e-03   +1.666040312183838e-02   +9.939512957760249e-02   +6.945314584830893e-02   -3.551117851760081e-02   +5.536995740584272e-02   -9.521817389224890e-03   +1.203564709330444e-01; +2.074919315916644e-02   +3.841780729335133e-02   +1.264905765866102e-01   +6.684088344469148e-02   +8.810126561595853e-02   +7.036449377533839e-02   +6.249823837456249e-02   +4.328729608328865e-02];
L2E_L2I_iGABA_netcon = [+6.740649961147731e-02   +5.090384820985937e-02   +3.650043836177259e-02   -1.152704706712374e-02   +5.224933971572761e-02   +1.147092592747555e-01   +6.525570267764756e-02   -1.437314972025446e-02; +1.293635017742764e-01   +1.380275051186165e-02   +2.734228552265712e-03   +1.011905122353650e-01   +1.240185288382271e-02   +2.302655184928602e-02   +9.315916741253786e-03   +8.927183252442868e-02; +1.614628863402562e-02   +8.865590403386113e-02   +9.085570893668951e-02   +2.716158554984646e-02   -1.993567129609238e-03   +1.149494813511442e-01   +5.426893414173471e-03   +4.046129733049379e-02; +4.196887058256948e-02   +5.545463677188263e-02   +1.961133550568122e-02   +2.033975107858082e-02   +5.385246080555280e-02   +1.348408242598432e-01   +1.398723746199937e-02   +5.159969719813477e-02; +6.051424341231026e-02   +7.030347706511061e-02   +8.657053162580076e-02   -9.489743624178374e-03   +1.931131424402496e-02   +1.272805350170254e-02   +1.146460172839415e-01   +1.133500406645364e-02; +7.119898412373885e-02   +2.305965136625686e-02   +2.524397875700445e-02   +3.553942394627782e-02   +4.765938613332354e-02   +9.689605857619930e-02   +9.031510222089176e-02   -4.722349604048590e-02; +6.380514430129500e-02   +1.492569308732867e-02   +1.068254604349351e-02   +7.502303710307104e-02   +7.946621777050614e-02   +1.172516255443520e-02   +5.083669279133897e-02   -4.092728594934024e-02; +1.104504562641654e-02   +3.386139162158133e-02   +1.747801864996286e-02   +2.281869619445435e-03   +4.965235238530483e-02   +6.676170568582353e-02   +2.653678148882015e-02   +2.667315829560087e-02];
L3E_L2E_iAMPA_netcon = [-2.139764786280208e-02   +1.842541395833034e-02   -3.368980669678808e-03   +3.544845529274800e-02   +5.212521424073877e-02   +4.820124471029554e-02   +1.238228009918950e-01   +4.838816626041086e-02   +2.628236791862670e-02   +8.730198330559015e-02   +6.804142650331543e-02   +3.536811263711941e-02; +1.522292617419191e-02   +9.766298991611191e-02   +8.213232296551379e-02   +2.494021144077830e-03   +5.105621231815227e-02   +1.092931125133815e-01   +5.224436128924112e-02   -3.332056763352135e-02   +5.124856028306855e-02   -1.928903774956855e-02   +9.632064101951898e-02   +7.067573910051633e-02; +7.299271332321496e-02   +1.015810973105308e-01   +4.584298612838680e-02   +3.589343234073737e-02   +2.690415106952883e-02   +2.847866649849667e-02   +9.382742409230903e-02   +8.441366180909009e-03   +2.454736422314238e-02   +8.403168011321914e-02   +6.353638034310874e-02   +1.685735457410479e-02; -2.941141403531252e-02   +7.333737655638216e-02   +7.220890091159066e-02   +7.458658377258997e-03   +6.395617944776347e-02   +4.482335722351125e-02   +2.586824651633939e-03   +4.292641011271202e-02   -5.950777990160248e-02   +6.830722441251724e-02   +6.884643641384440e-02   -4.393342998675312e-02; +8.716740369894251e-03   +6.175936629453296e-02   +1.310198108701369e-01   +8.645513999163106e-02   +6.284963836789099e-02   +1.041761034905361e-01   +4.269488109175561e-02   +6.562723148663034e-02   -1.120091206212404e-04   +1.328993931710536e-02   +7.154088160140960e-02   +2.091185880322364e-02; +4.259977225179819e-02   +2.076309498795396e-02   +4.883055856268397e-03   +7.942157445065537e-02   +1.012157871634391e-01   +7.303340824558822e-03   +8.826560428613797e-02   +8.936841298452890e-02   +8.783962059460071e-02   +5.420338503629317e-02   +5.462434976363290e-02   -3.130122475513882e-02; +7.339139164848266e-02   +5.065988159558157e-02   +5.891348430923171e-02   +7.050106293775050e-03   -1.908475855928625e-02   +6.705799867404086e-02   +2.040034034564569e-02   +3.567781647735987e-02   +2.333036479574491e-02   +4.533887894559699e-02   +1.014928355278958e-01   +9.405774869181110e-02; +2.783410005482888e-02   +8.346208596519403e-02   +6.977973950701206e-02   +6.641130424252795e-02   +5.026937781677829e-02   +5.223447368090450e-02   -3.299340358673430e-02   -1.883224144812050e-02   +1.741130530892801e-02   -3.805400806019218e-02   +1.273553261036625e-02   +1.432668641749255e-02];
L3I_L2I_iGABA_netcon = [+1.105542592349255e-01   +8.151464280830299e-02   -1.240630215245006e-02   +8.075859087913477e-02   +2.018312447824239e-02   +5.212384090423818e-02   +8.906772538760860e-02   +3.099240542090654e-02   +8.274455032897783e-03   +2.018218868963118e-02   +1.164312610683778e-01   +2.475157654828421e-03; +1.406656676437956e-02   +7.353970021941847e-02   +5.888866525383336e-02   +4.661752160327833e-02   +2.358227167851712e-02   +6.553862425170033e-02   +7.327715363365964e-02   +2.183215867684923e-02   -4.506901477350629e-02   +9.504973982086171e-02   +8.952149144651100e-02   -7.486949112594549e-02; +9.506408878972630e-02   +1.048954737267042e-01   +9.631133651893553e-02   +6.389430601034260e-02   +1.327752763933628e-01   +8.123696411501016e-02   +5.173001521895097e-02   +8.179027434601614e-03   +1.440394166440374e-01   +1.213657334641472e-02   +8.941598205215354e-02   +6.493972575687165e-02; +2.422182250486037e-02   +9.387720496388838e-02   +9.425869285066621e-02   +2.404514145191303e-03   +1.053748297799980e-01   +3.099426528850606e-02   -1.933100625618999e-02   +2.930426898913039e-02   +9.160163377996292e-02   +5.144858067641921e-02   -4.763578070658599e-02   +1.044323640991288e-01; +4.897920578218062e-02   +5.135065460439216e-02   +1.101887568538295e-01   +6.847883013395348e-02   +1.081193160192622e-01   +6.988545214375636e-03   +2.628048519920229e-02   +1.215538492928299e-01   +1.523668503067010e-02   -3.458159570196379e-02   -2.012489113948323e-02   +7.657102410595874e-02; +8.370810933898024e-02   +8.378839816449618e-02   +7.911031748186449e-02   +4.634245047715107e-02   +3.869700842951150e-02   +8.796990897093862e-02   +5.384503770686381e-02   +8.438952326118129e-02   -3.142922532703920e-02   +4.565092633608141e-02   +8.938737738626960e-02   +2.105178224967616e-02; +3.273450786680372e-02   +3.653677254207557e-02   +5.473818322954684e-02   +7.583714944108325e-02   +4.075042721717302e-02   +5.636853107266557e-02   -1.109431819308225e-02   +1.837903206489304e-02   +2.156070250140928e-02   +2.504814920869478e-02   +1.167974796119428e-01   +1.079181910973056e-01; +3.571832631917730e-02   -4.403386597784949e-03   +8.316427942187329e-02   -7.066287316675965e-02   +1.028955003315885e-01   +8.827054716084320e-02   +9.997978074056663e-02   +8.723137528809673e-02   +3.561909887434304e-02   +1.045793161234828e-01   -1.948977604088344e-02   +5.349532399148713e-02];
L2E_L3E_iAMPA_netcon = [+1.215870188897410e-01   +5.515650721914347e-02   +1.251351876543907e-01   +1.617151483746811e-02   -2.005870856767571e-02   +9.402485095822642e-02   +2.666544299879142e-02   -1.721121922405866e-02; +4.721769653870842e-02   +1.197598489521146e-01   +8.545509712440938e-02   +5.608867753523327e-03   +1.174552201700974e-01   +6.117518918365107e-02   +2.742355754636228e-02   +6.272437218419424e-02; +1.742341038752605e-02   +3.817274975566144e-02   +3.333579016710989e-02   +3.905800792772297e-02   +4.935230574597156e-02   +1.043156349161180e-01   +8.302349315512572e-02   +5.270277771790219e-02; +2.099379535908509e-02   -7.219887951561747e-03   +1.676457178728170e-02   +1.224025004292232e-01   +5.969188329876201e-02   +1.325005490131875e-01   +5.875911540857325e-02   +4.726779943533829e-02; +7.171862339619321e-02   +1.064560492864192e-01   +1.027598186752244e-01   +1.090607897236876e-02   +1.294577162935653e-01   -1.397829934770992e-02   +4.797323386520477e-02   -4.287436717140784e-02; +8.365689797346835e-03   +1.465795083415546e-01   +4.084352950220427e-02   +1.250269833822425e-02   +1.427842519799932e-01   +1.205694158604619e-02   +6.597122341066816e-02   +4.096818804557442e-02; +5.450208860130967e-02   -1.850222038819904e-03   -8.841547154837599e-03   -2.245570171109397e-02   +6.837745012132335e-02   +3.473776149320526e-02   +1.313944869180131e-02   +8.558158099585685e-02; +1.564891190307926e-02   -3.272561508214857e-02   -3.146660335016125e-02   +2.552402249735240e-02   +9.875346622145337e-02   -1.769312601761167e-02   -1.596872759020550e-03   +5.556066498355374e-02; +1.015368796346783e-01   +8.806974056538608e-02   +1.294215376447465e-02   +6.529551315891062e-02   +5.238344120074942e-03   +3.820288975797174e-03   +7.909941740055879e-02   +9.714727474573431e-02; +1.054264159451773e-02   +1.397933554430581e-02   +4.238114254264709e-02   +5.986038892354228e-02   -4.445574033362244e-02   +2.184887833463610e-02   +1.117172250356869e-02   +3.291820452368794e-02; +4.709302592974628e-02   +3.507358859945846e-02   +6.437647854857101e-02   +8.995823098331682e-02   +2.408685040109791e-03   +8.482008180755637e-03   -4.115913223290898e-03   +5.545274748981886e-02; +3.521137414594357e-02   +4.649426973560805e-02   +9.194478008202661e-02   +6.914265592056729e-02   +4.545868575587806e-02   +5.347471150522250e-03   +3.619876845264837e-02   +8.243310857351012e-02];
L2I_L3I_iGABA_netcon = [+2.893272924447840e-03   +7.435340930318772e-03   +7.425148362359640e-02   +6.853886755076766e-02   +7.493846950200572e-02   +4.470329348601929e-02   -1.499407421258502e-02   +5.650965279124102e-02; +3.287086332524002e-02   +1.042343330026111e-01   -4.155444207909989e-03   +9.835481059680545e-02   -5.764316752764871e-02   +7.168470056813273e-02   +4.220743458601971e-02   +3.841172998325752e-02; -4.356449625508990e-03   +1.120794586679374e-01   +7.818292984039929e-02   +7.396554361905201e-02   +1.008616093902105e-02   +4.662137046154649e-02   +5.616298202968546e-02   +9.855489595537888e-02; +5.574702815206857e-02   +8.181352974399252e-03   +6.927494135275249e-02   +8.090026099267286e-02   +4.243708137161126e-02   +1.228481963829983e-02   +4.728282543684860e-02   +8.001667039006989e-02; +7.820397351627108e-02   +1.287665114506197e-01   +1.089701451783658e-01   +3.958441568048464e-02   +1.751038785197181e-02   +3.185967653353462e-02   +7.594701869000030e-02   +1.768706131047445e-02; +7.267932928819680e-02   +5.432493838362777e-02   +1.403651478177048e-02   +1.055192866660699e-01   +1.818382806685093e-02   +8.507032907455050e-03   +6.125847263716070e-02   +4.230548109290001e-02; +4.847430014194810e-02   +6.881909266018291e-02   +7.929438815640323e-03   +4.998688633397631e-02   +3.781409562444665e-02   +5.554791366994334e-03   +2.057480087084750e-03   +6.209883795600167e-02; +4.371783847121048e-03   +1.311977748003663e-03   +7.738453052618782e-02   +6.691397033463539e-02   +1.002337928146590e-01   +1.485588449012130e-02   +1.502687888388070e-02   +5.234970744010334e-02; +5.873003037530375e-02   +3.385533829092471e-03   +6.573486882549162e-02   +9.359520635946035e-02   +5.452892404286114e-02   +3.554967357584697e-02   +5.504197398299487e-02   +8.749344878011886e-02; -2.237464986419840e-02   +4.325571448447860e-03   -1.413139582928441e-02   +7.765928099083381e-02   +8.391439239467902e-02   -2.036057739188751e-02   +6.321222344190880e-02   +1.083357116998602e-02; -5.938068639697443e-02   +9.085410567150362e-02   +5.075264013441026e-03   +6.362774992532438e-02   -4.809840753914199e-02   +7.722915087192209e-02   +2.623041074052710e-02   +2.477885423277063e-02; -6.986289685788390e-02   +3.588671973032521e-02   +3.468746903583916e-02   -1.216142199869408e-02   +6.348531012127152e-02   +9.463449166666062e-02   +2.855824208663881e-02   -2.132804089030544e-04];
L3I_L3E_iAMPA_netcon = [-3.588256342272193e-03   -1.887172990115201e-04   +2.491301077078682e-02   +1.013780629454333e-01   -3.401088924404858e-02   +8.195506837339638e-02   +6.817482640621413e-02   -2.935698792619484e-02   +2.976643560064868e-02   +2.413712559702044e-03   +9.338487255788566e-02   -1.085965248879732e-02; +5.341654912070563e-02   -2.125887318677357e-02   -1.414148497712485e-04   +5.455583553795524e-02   +8.043434551724082e-02   +4.134662826653114e-02   +8.646088877456191e-02   +7.850379887882063e-02   +2.227981175896167e-02   -1.769402275450580e-02   +4.019880880970200e-02   +1.164437204902581e-01; -3.470244894729325e-02   +1.080818141857399e-01   -2.317225396370298e-02   +1.696842778481217e-02   +7.053049266808054e-02   +1.073386153869142e-01   +1.514756924460471e-02   +2.252284470933888e-02   -2.217187664909523e-02   +9.295232503915632e-02   +2.680583890714739e-02   +9.807976838226862e-02; +5.787468541761510e-02   +3.376231664324196e-02   +1.526250730822048e-02   +8.759723088084639e-02   +1.339484687084848e-02   +1.282447238915296e-02   +6.431866286241560e-02   +7.416049392953443e-02   +6.474341534838909e-02   +6.146605602563467e-02   +3.999595196540869e-02   +5.919333378160582e-02; +2.334392417183637e-02   +9.106623065254120e-02   -1.084842138388403e-02   -2.808988177370913e-02   +2.559696726662909e-02   -2.740757967265296e-02   -8.333884781825163e-02   +3.583670092012384e-02   +2.630736066022380e-02   -7.871485955179836e-05   +5.473678256045582e-02   +1.251810656195732e-01; +2.497790147085540e-02   +5.071902085857058e-02   +5.204514465333325e-02   +1.199561912190913e-01   +1.476005997650161e-02   +6.844745276144117e-02   +4.290322227223989e-02   +1.726430235746092e-02   +7.819879401360250e-02   +5.366262023555077e-02   +9.002846982453486e-02   +3.897171403662474e-02; +9.265169622772787e-03   +6.602192946229463e-02   +8.008757940593049e-02   +3.835170076741592e-02   +5.726869709596738e-02   +6.590153679647058e-02   +4.801506191162797e-02   +1.522806813380004e-01   +2.247385031144745e-02   -2.085426937328505e-02   -1.050368179106495e-02   +3.599152770194829e-02; +9.127288936737281e-02   +1.064417830897916e-01   +5.130673806780849e-03   +1.144899702812490e-01   +5.985614667795984e-02   +6.819132801286181e-04   -6.312285769133424e-03   +1.107369047439096e-01   +2.324957325687348e-02   +3.947818249838760e-02   +2.575938261808879e-02   -3.792876876746752e-02; -2.092888153242076e-02   +4.048583566031869e-03   -2.504045420372920e-02   +3.753576235498277e-02   +6.774371803028023e-02   +1.030898546734459e-02   +4.874428058821156e-02   +6.196937558726998e-02   +2.365559036076557e-02   +6.665085040255803e-02   +6.490296723051689e-02   +2.392567407345314e-02; +6.310696721274693e-02   +4.732917475952318e-02   +2.418185123150007e-02   -3.865348439649858e-03   +3.259848376280243e-02   -7.385936636180314e-03   +1.726989584435692e-02   +1.053955493524149e-01   +4.902364348979106e-02   -1.106034518241848e-02   -2.921599373063403e-02   +6.686926952128757e-03; +7.045497321228607e-02   +4.462111118036394e-02   +1.560675689650887e-02   -9.196184547187528e-04   +1.846072510150960e-02   +4.081460799609959e-02   +3.249141294233829e-02   +6.804134163844272e-02   +1.553079336893597e-02   -3.056086504205046e-02   +4.521370674901416e-03   +5.005698474991808e-02; +5.487548325479853e-02   -3.384985249930120e-02   +5.892720500555451e-02   +1.269780249517476e-01   -2.414574670854012e-02   +2.247472815059768e-02   +9.807264040993226e-02   -6.082151694195187e-03   +1.574958385218759e-02   +5.046724025202570e-02   +1.851741409758493e-02   +1.238958668427795e-01];
L3E_L3I_iGABA_netcon = [-1.482648404676237e-02   +3.404961112557146e-02   -1.795028819654148e-02   +1.384939349397936e-01   +7.978241868226517e-02   +8.552037998557027e-02   -1.193709213184464e-02   -2.141825751818610e-02   +7.345661378517307e-02   +1.195995761710147e-01   +7.410746650501933e-02   +5.332949725744093e-02; -7.662835362272670e-03   +8.910597556207770e-03   +1.279521775760023e-01   +2.958746835328899e-02   +2.785650030237891e-02   +4.519084460054691e-02   +1.111120790739463e-01   +5.891429131643110e-02   -9.939268501941083e-04   +8.655632928005134e-02   +4.167613836824394e-02   +2.857690381480206e-02; +4.403604217698361e-02   +4.240550821952427e-02   +7.740501804229866e-02   +1.341427383425071e-01   +1.989916678252529e-02   +5.037445698989493e-02   +4.541608034420477e-02   +4.665392150505643e-02   -5.757766819766495e-02   +1.091819406970267e-01   +2.486398443525233e-02   -8.228950937837093e-03; +4.087016461064295e-02   +4.978958380510407e-02   -2.460605145551592e-02   +2.627512752190029e-02   +1.592920081615927e-02   +1.193040495077202e-01   +3.565626920486899e-02   +5.794664301411967e-02   +3.392593560019551e-02   -6.578233232159775e-04   +8.105526979759922e-02   -4.519583494402528e-02; +1.153494142291729e-01   +7.149976657209250e-02   +1.080622366976896e-01   +4.144012241325057e-02   +6.939010097413007e-03   -4.248980192559241e-03   +5.667462388267441e-02   +5.037349246343211e-02   +2.962911307284546e-02   +1.307797221298189e-01   +1.495349018103106e-02   +7.127265768276400e-02; +2.561481541007072e-02   +3.179296738099806e-02   +2.322884389320886e-02   +3.433317243889030e-02   +4.867397541355643e-02   +1.007937464226817e-01   +3.345176347596346e-02   +6.492232835897284e-02   +3.598713725787554e-02   +3.614947465465579e-02   +2.108737513270347e-02   -1.363002986084049e-02; +2.493890419208517e-02   +2.895591015077191e-02   -1.707733323360246e-02   -3.548369434684433e-02   +3.278065557831179e-02   +9.965848827596377e-02   +2.024209265627896e-02   +7.047406194558720e-02   +1.967531655730002e-02   +2.380886762508053e-02   +5.800290727184039e-02   +2.308494021626137e-02; +7.507999370201028e-02   +3.583418487033944e-02   +6.490857911616997e-02   +1.481110905466687e-01   +6.464611550224118e-02   -1.996005439252817e-02   +2.077275756952886e-03   +4.122457617629631e-02   +5.519011572298051e-02   +4.427631353279179e-02   +5.569563507314980e-02   +1.736831522844282e-02; +1.998338339309072e-02   +5.261672443386598e-02   +3.261120363981074e-02   +3.409713134465210e-02   +1.059851685793850e-01   +7.923012086093170e-02   +3.089456772867338e-02   +2.264419578803980e-02   -4.300699655099861e-04   +9.273226101590001e-02   +5.798558999139758e-02   +6.583940023057921e-02; +1.353409173427389e-02   +3.911658973173381e-02   +1.943031501988576e-02   +1.133468461698780e-02   +2.608586905112169e-03   -4.019789954358057e-04   +3.176140451781793e-02   +5.436598721969464e-02   +6.806609151190531e-03   +6.097193681464202e-02   +4.135751668886568e-02   +5.545967614647256e-02; +2.630390074256899e-02   +5.041994448988906e-02   +4.239295246550544e-02   +8.331051316750229e-02   +5.022348070874961e-02   -2.832001906471222e-02   +9.340212356220321e-03   +8.420337458363500e-03   +3.653684527558038e-02   -1.524489596278500e-02   +1.376224719860716e-01   +6.466742961463126e-02; +3.532717037246118e-02   +5.349595373184975e-02   +2.130045037374646e-02   +6.524892190782561e-03   +7.195424591702107e-02   +6.220000702496295e-03   +1.172803223546445e-01   +3.361090426055576e-02   -6.880628814462377e-03   +5.187312403176429e-02   +2.704391127158201e-02   +6.782907156147328e-02];
L2E_Input1_iAMPA_netcon = [+2.791175002517626e-02   +5.281207636108141e-02   +8.928309044299158e-02   +6.016863119696804e-03   +3.378483424550866e-02   +2.072942948928983e-02   +5.819913480871844e-02   +9.235630882660258e-02];
L2I_Input2_iAMPA_netcon = [+5.741313303673572e-02   +5.341785291242225e-03   +7.596186914162034e-02   -1.187536868139649e-02   +1.770522686214480e-02   -2.197020061109748e-02   +1.313534298343787e-01   +5.842446174510330e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
