function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.123869172639461e-02   +1.036810791268605e-01   +1.082695610958257e-02   +4.018085833375257e-02   +1.013309433197843e-01   +9.706921277060686e-02   +1.018883600016815e-01   +9.290548227108351e-02   +4.459861791544062e-02   +6.342822969088464e-02   +1.873052690924419e-02   +2.941621345396192e-02   +6.195439285956728e-04   +1.000460775686285e-01   +8.278909570177448e-02   +6.635226057277954e-02; +7.509379228421448e-02   +4.737712730227495e-02   +1.173102225041152e-01   +1.430285602534025e-02   +2.275534166858906e-02   +1.151301151118938e-01   +1.394683314352288e-01   +2.537851765056905e-02   +8.199338282063348e-02   +3.228739184859188e-02   +1.867078097053014e-01   +8.054968831294546e-02   -3.877686494446933e-03   +4.010296034964492e-02   -2.477756833483470e-02   +1.905258330344086e-02; -5.075595404886451e-02   +6.439702503841162e-02   +7.157709588869800e-02   +3.584108946311558e-02   +1.668295307348797e-02   +1.437829490333204e-01   +4.753792492290074e-02   +2.752588364469844e-02   +2.140361427279094e-01   -1.762197159229074e-02   +1.622346715976313e-01   +1.692923548629622e-01   +2.923637924909287e-02   +1.616147887365038e-01   +1.140512934617413e-01   +2.267137551888988e-02; +1.740970633200384e-01   -5.763568222235203e-03   +9.514296398067507e-02   +7.674686010522788e-02   +1.810789391068727e-01   +3.076637660998020e-02   -1.978017243066691e-02   -3.230932931882009e-02   +7.256841373919780e-02   +1.085535859978875e-01   +5.255535704387186e-02   +1.316291136857665e-02   -4.593005530956457e-02   +6.669755565718208e-02   +1.759401908780121e-01   +1.341284632007136e-01; +7.324031272144625e-02   +7.714405354191922e-02   +2.063694531356480e-01   -4.586413148703516e-02   +8.902116329170362e-02   -1.068025364485492e-02   +2.416466119882316e-02   +1.493032239645246e-01   +5.329279708225067e-02   +6.441500536204736e-02   +1.558286982710299e-01   +2.305371464313526e-03   +5.079495349552456e-02   +5.479817791091736e-02   +1.311794577656971e-01   -3.494930801569630e-02; -4.998053780857259e-02   +6.410647558434658e-03   +1.320555336904191e-01   -6.828084996457476e-02   -3.258620299548131e-02   +9.434045247996102e-02   +1.332111058216035e-01   +4.274253499097466e-02   +9.824138778999966e-02   +3.878195162241210e-02   -7.220063274592227e-02   +2.814431280718926e-03   +1.712239650435447e-01   +8.923304025457118e-02   +1.695268555072431e-01   +1.141344364319898e-01; +8.815013828392190e-02   +7.586212011147217e-02   +1.884397955800255e-02   +8.294727887456019e-02   +7.793820272835494e-02   -4.339756144677178e-02   +1.268095971131338e-01   -3.110351420920276e-02   +1.814891581344765e-01   +9.916358014336923e-02   -6.141846437365164e-03   +1.425273100311135e-02   +6.444267036039349e-03   +1.452175450347844e-01   +1.062238297109193e-01   +7.192544554340471e-02; +1.014140275373299e-01   -6.353740289453499e-02   +4.156863533988756e-02   +9.637403815469708e-02   +1.943903016511180e-01   -3.372389465901680e-02   +3.981557000438640e-02   +1.963272901673350e-02   +1.823692276424013e-02   +1.449250726584788e-01   -2.554294389099059e-02   +2.504831889032208e-03   +7.420032265260411e-02   -1.349934236030879e-02   +2.594242214521918e-02   -4.330021936211828e-02; +1.393790098359823e-01   +4.110475663808380e-02   +1.195275582464406e-01   +6.075653334873915e-02   -3.986220141617419e-02   -1.475867124653786e-02   +2.515549927258959e-02   -2.255568912495733e-02   +1.425545394381560e-01   +6.260916860606824e-02   -1.332595489172717e-02   +1.331684181231916e-02   +5.103091247874365e-02   -6.534763571082119e-02   +1.825702773482167e-01   +4.519724892379431e-02; +1.495797904481773e-01   +1.681075319849981e-01   +8.227165055058931e-02   +3.907576969841577e-02   +7.121934644244117e-02   +8.086923593021881e-03   +2.621331887113248e-02   +7.065456311811286e-02   +7.622010844764354e-02   +5.445135184615126e-02   +8.280848097552612e-02   +1.812924790747050e-02   +6.768240861000481e-02   +9.874843287262088e-02   +1.038714770184775e-01   +4.615534295221015e-02; +4.065621179815289e-02   -8.054935352854090e-02   -3.477671389354562e-02   +2.424219259401433e-02   +1.351465011827963e-01   -3.360605306689787e-02   +1.758032558571673e-02   +1.549719419169311e-01   +4.716867441576626e-02   +1.061143460240720e-01   +2.365908041471988e-02   +7.915789377443347e-03   +8.207628350527585e-02   +2.421762024083157e-02   +2.341742203683082e-02   +1.188707116083828e-01; -1.631948462576841e-02   +1.407627134348465e-01   -6.959258719982506e-02   +2.180454790510415e-02   -7.461358096377214e-02   +1.491922489454743e-01   +1.968865614945775e-02   +3.697640830327681e-02   +5.192345773060879e-02   -2.279877640553573e-02   -4.123524868682055e-02   +1.094661437057758e-03   +1.583077230370113e-02   +1.940784588562910e-01   +1.931824527679574e-02   +1.461517169481038e-01; +1.045257438382616e-02   +8.800620509143402e-02   +8.342146978816564e-02   +8.015777594111298e-02   +1.756919997516405e-03   +8.301231523328145e-02   +1.671263244996862e-02   -5.834833689823511e-02   +2.855262701145626e-02   +4.551109474448232e-03   +5.408257750046395e-02   +2.020255889296640e-02   +1.440484023656917e-01   +1.558026869399583e-02   +9.802506519227124e-02   -1.535718221264726e-02; +8.534873410154779e-02   +8.920781824609728e-02   +9.949720522391942e-02   +8.736273845985518e-02   +1.164077980089609e-01   +2.107365468578686e-02   -1.012452800449961e-02   +1.573155097437766e-01   +7.991439867143757e-02   +1.375095959693446e-01   +1.062172099064241e-01   +1.072277253657211e-02   -1.486619308135095e-02   -1.152405396622891e-02   +1.178950966503050e-01   +3.673079658987542e-02; +6.247868316074428e-02   -4.672243990906547e-02   -4.155479878371497e-03   -1.796458102282848e-02   +1.084605644584806e-01   +6.138351892810003e-02   -5.792751222249063e-03   +1.337762176733246e-01   +1.369448210135068e-01   +1.717489874457234e-01   -7.266114270690893e-02   -9.143281870416260e-02   -1.829958735832762e-03   +3.116775632784262e-02   +1.033462776240210e-01   +1.763907726215644e-02; +7.107838733641597e-02   +1.730388730169617e-01   -5.362530901257311e-02   +9.950716367982713e-02   +1.497541971700652e-01   +9.980509611199442e-02   +4.828616903338266e-03   -1.172308477609897e-01   +3.385239568083803e-02   +1.347060572434967e-01   -1.311363307835955e-02   +1.531904993034625e-02   +7.031596661169921e-02   +1.132395754465864e-01   +1.438185310033120e-01   +1.075333885533372e-01];
L1E_L1I_iGABA_netcon = [-8.888770036822746e-02   +6.380792236763788e-02   +3.011634969400151e-02   +8.466683134553896e-02   +7.766943769489359e-02   +6.039788697420982e-02   +3.691042239607641e-02   +3.736647772686265e-02   +2.873602481412035e-02   +9.518285378591253e-02   -3.484526666533264e-02   +3.685983536091280e-02   -4.925181298884038e-02   -6.315893748446982e-02   -4.427426644872066e-02   +6.624729108216312e-02; +1.392866197321001e-01   +1.020858209254668e-01   +9.433984907126217e-02   +1.060791137036536e-01   +5.144886877648661e-02   -6.596593924595301e-02   -7.353542696458289e-02   +1.094823401024319e-01   -1.740155622900560e-02   +1.135846477796470e-01   +3.848425746850072e-02   +5.343071239186371e-02   +2.224125480174355e-02   +6.688781981177050e-02   +2.031602866407823e-02   +1.232932237114389e-01; +5.248660290116530e-02   +5.748243374843836e-02   +1.192576770857380e-01   +2.764348972609235e-02   +2.006249148198228e-01   +6.354202639042188e-02   +6.660229819228275e-02   +5.832646585959639e-03   +1.400658961303215e-02   +1.898293477854259e-01   +1.165615132448821e-01   +1.533682379621688e-01   +2.582687591815305e-02   +1.496795948307478e-01   +1.215946280928016e-01   -4.894097517823445e-02; +2.088380092896945e-02   -2.841244368877125e-02   -1.717909301125527e-02   -2.924981764498784e-02   -1.688949704095761e-02   +5.992081217409100e-02   +7.533630646314946e-02   +9.961083443028262e-03   -6.918106961777090e-02   +4.018241895612678e-02   +5.974848357268154e-02   +1.565900771049379e-03   +6.190062207936858e-03   -1.606361492805835e-02   +1.488898776930715e-01   +1.209347930879706e-01; +9.073981110756391e-02   +7.487767910188182e-02   +1.756404620187660e-02   +6.881766070885245e-02   +5.972816676539654e-02   +1.724263826009003e-01   -6.704462915052944e-02   -5.867799345285538e-02   +1.596314946835341e-01   +4.560519092373252e-02   -4.090473426530037e-02   +2.053770234870655e-02   +3.623984775069075e-03   +6.187529794295901e-02   +3.682956402351754e-02   +1.134865836979246e-01; +7.032919694222421e-02   +5.565410019333736e-03   +6.258995649813510e-02   -1.390402330780645e-01   +4.441199496287406e-02   +8.121310904576107e-02   +1.236709081289758e-01   +4.339220446146026e-02   +1.323227089281523e-01   +8.234773355420158e-02   -1.480939540135480e-02   +2.995371156010253e-02   -7.280381154238977e-02   +1.067244263377073e-01   +2.317388100787284e-01   -3.053678810784958e-02; +4.719539136215915e-02   +2.050071996477799e-01   +1.198850275798989e-01   +1.906539910498418e-01   +1.000947691325013e-01   +1.506422533228874e-01   +1.009795406087972e-01   +6.631539669914310e-02   +9.091313664371213e-02   -3.648650173081163e-02   +8.103401487664758e-02   +9.173921787981335e-02   +5.147138387613463e-02   +2.802209433051562e-02   -8.264923227377020e-03   +1.498986385849952e-01; +1.153693287213817e-01   +5.115470892092717e-02   +4.693027383519543e-02   +1.134657126931477e-01   +2.599325403660899e-02   +5.504394031523764e-02   +1.380728548999186e-02   +7.378718244291885e-02   +2.495497267593962e-02   +2.560390681438443e-04   +7.102190695344218e-02   +8.837786112506286e-02   -8.377336557408972e-02   +1.515811054388459e-01   +3.122807661335320e-02   +5.727608093585583e-02; -7.879336756922567e-04   +1.768873694310449e-01   +1.879947973474612e-01   +9.465790701944829e-02   +1.367691856018153e-01   +4.547635313995668e-03   -3.392571792122125e-02   +5.817820139133724e-02   +7.525194301086247e-02   +4.398460602080542e-02   +2.919027899353010e-02   +1.222981139613540e-01   +1.046754315302524e-01   +1.103596391908944e-01   +3.395813254587715e-02   +8.360504100414007e-02; +6.586543486613627e-02   +7.578565257161836e-03   +2.691765342554347e-02   +1.453179774643972e-01   +1.008490164001864e-01   +4.518777939865656e-02   +4.014071607421365e-02   -4.609733409542461e-03   -6.507317419469984e-02   -1.516049947633410e-02   +1.195501584115035e-02   +6.705800199541015e-02   +5.028650196117251e-02   +6.354659828401478e-03   +1.770791877876167e-02   +8.476155095458564e-03; +6.889613237639471e-02   +1.853828934941696e-01   +4.436069661115757e-02   +4.231841201898506e-02   +1.270484198201929e-01   +8.048538100379710e-02   +2.645055283758559e-02   -4.071699085369673e-02   +1.101050088052944e-01   +5.458574270576973e-02   +9.932111372840298e-02   +1.472615689769657e-01   +1.377440652439866e-01   +4.423908184194724e-02   +4.179213714069231e-02   +2.772527370303729e-03; +4.421782023518201e-02   +5.305027685775363e-02   +1.104492954455486e-01   +6.060128869039096e-02   +1.124888842578825e-01   +1.422537975345401e-01   +1.091811337765912e-01   -2.193104075817981e-02   +9.837619433606382e-02   -3.118394438723195e-02   +1.266196187323024e-01   +1.454270758701413e-01   +1.544603701173839e-01   +1.500803422622228e-02   -2.592724316307975e-02   +1.072316506444746e-01; -4.755999229457660e-03   +3.319781987617312e-02   +1.330971071119958e-02   +1.096302097678064e-01   +5.382706469198833e-02   +5.552855664946013e-02   +1.321038736720238e-01   +1.318308897261596e-01   -2.803445674932559e-02   +1.149113740188745e-01   +7.312138664507764e-02   +1.865594888458058e-02   -1.130465095857541e-03   +3.370852009144473e-02   -5.306388548128813e-02   +5.019739383145296e-02; +8.762400270151556e-02   +2.483115365880041e-02   +6.622623491249981e-02   +7.517629904785411e-02   +1.633804506814934e-01   +3.679927475175338e-02   +7.428355086586075e-02   -4.801408504330604e-02   +9.147647185165245e-02   +8.340992066708271e-02   +2.033801476554783e-03   +1.204273015181646e-01   +4.159268756466311e-02   +4.512756224403441e-02   -2.674452029808299e-02   -2.232545652812512e-02; +3.056882019106247e-02   +1.634368827091581e-01   +4.739494815965196e-02   +2.329876771558289e-02   +5.486289819287114e-02   +4.742584321868905e-02   -2.694668133563231e-02   +6.730480967039751e-03   +6.028793139294792e-02   +3.070423537436883e-02   +1.918841266934471e-02   +9.120500157877678e-02   +7.247259587497068e-02   +2.176233841061214e-02   -1.423452541820077e-02   +9.394143415020303e-02; +1.137683520484268e-01   +1.172199511852415e-01   +1.045459443599065e-01   -5.081964426394539e-03   -4.289560798334155e-02   +6.427717699224740e-03   +2.022857351103572e-02   +3.992085473262162e-02   -3.352819448028135e-02   +1.169862057585997e-01   -2.953462072408564e-02   +6.529927451491367e-02   -4.307258713068618e-03   +1.356746557555838e-01   +1.302761371088788e-01   -2.461169103530440e-05];
L2I_L1I_iGABA_netcon = [+1.836153992318733e-01   -3.777771109106017e-02   +8.060079532050660e-02   +1.543199490917223e-01   +1.770808930212781e-02   +1.520018835386413e-01   -2.387293313558844e-02   +6.143799196375188e-02; +8.276499543102472e-03   +8.857388844049907e-03   +1.137886006550713e-02   -1.996840951433957e-02   +1.216976815139490e-01   -4.160847155831282e-03   +9.887478644818512e-02   +9.804471575540902e-02; -4.867636929573825e-02   +6.702961333885130e-02   +9.377902227793337e-03   -7.697127633841952e-02   +1.310276029507876e-01   +1.659442042804343e-01   +1.796423236173242e-01   -1.085026755010237e-02; -1.404581376544325e-04   +1.353371920109510e-01   +4.443796059131001e-02   +1.419164705485529e-01   -5.803551088979517e-02   +1.390889290385477e-02   +1.350846741573054e-01   -1.226751163980605e-02; -5.457338735795826e-02   +5.863033699043344e-02   +6.554632766849405e-02   -4.214616028415836e-02   +1.043093575836877e-01   +1.474443620885873e-01   +9.718264625864996e-02   +3.449750520563880e-02; +7.742597788005821e-02   +7.627687687607054e-02   +9.712198751656329e-02   -4.871101617811546e-02   +1.274346316125779e-01   -4.019203437150216e-02   +8.277482596162117e-02   +4.434058954744322e-02; +5.353506809556842e-02   -7.668983261830396e-02   +5.223203433254116e-02   -8.590697508632553e-02   +1.062060835159854e-02   +1.533957279966768e-01   -3.255796272814915e-02   +6.582210161813343e-02; +7.745394905288394e-02   +7.215057949203016e-02   +1.237252327980164e-01   +1.430973323505770e-01   +5.389803514247922e-02   -5.832888592473087e-02   +6.964401498231985e-02   +7.194243851941301e-02; +2.390791586700973e-02   -2.908357303576363e-02   +3.004169047541637e-02   +1.375989044562294e-02   +2.592191066521058e-02   +1.317911857259057e-01   +6.631976612359035e-02   -2.826073224899868e-02; -7.824216030447249e-02   +1.782887677781546e-01   +4.808520416970855e-02   -3.381826964361292e-02   +4.803589371112151e-02   +2.141546810359318e-02   +7.673751409830894e-02   +8.571337740360266e-02; -6.863847289214520e-02   +1.631430905559669e-01   +6.991289905698378e-02   -5.261700854466991e-02   +3.462252062531723e-02   -7.223187856339108e-02   +5.666351087186305e-02   +1.205026078864690e-01; +1.407610895727665e-01   +8.804731044567238e-02   +7.875796810394500e-02   -6.087441364045418e-03   +1.006248120834028e-01   +2.671027848936437e-02   +6.025268543100697e-02   +8.455209911007436e-02; +1.212704475712152e-01   +1.073244852535824e-01   +5.027240292987731e-02   +2.769290473079056e-02   +1.245273761206241e-01   +7.902253986747619e-03   -2.391728009392447e-02   +4.587311835834329e-02; +1.048502166494547e-01   +1.057357028336919e-01   +6.390609910209462e-02   +9.402096210117980e-02   -4.437049981548371e-02   -1.086177608015680e-02   +1.987872693661121e-01   +6.393321186568379e-02; +6.743898850532008e-02   +7.488041797152059e-02   +1.547633215762249e-01   +1.661086892382599e-01   +1.844873974461245e-01   +3.634462157628651e-02   -5.945410981713729e-02   +2.145740432678713e-02; -1.542583226414707e-02   +1.796518985377081e-01   +1.188902057766476e-01   +4.999977847747621e-02   +9.248914341576073e-02   +5.469206532044782e-02   +6.611934659926644e-02   -1.575332508149906e-02];
L1I_L2I_iGABA_netcon = [+3.787876267556772e-02   +6.312686545065935e-02   +7.806078719843590e-02   -2.262825034951387e-02   +1.063394819868234e-01   -4.449125821822943e-02   +1.508507835376908e-02   +1.057147593283572e-02   +3.393572723896681e-02   -4.781350631857507e-02   -1.812097588074199e-02   +2.865866510181816e-02   -3.620147582222247e-03   +1.256711812065948e-01   +1.521721935896479e-01   +1.036427672829482e-01; -2.088583180542260e-02   +7.111051999403564e-02   -2.671826925275786e-02   -6.659318146506635e-02   +2.363492239565082e-02   -3.775011867840985e-02   +6.627036344798423e-02   -1.871501974172338e-03   +1.621426424587938e-02   -4.305343290410465e-02   +7.011753862213475e-02   +9.180605959256849e-03   +1.685584171426839e-01   +1.027802205408517e-01   -7.087288298212928e-02   +1.521388093393589e-02; +8.736394151661028e-02   +4.633836602156056e-02   -6.564002818241371e-02   +1.870354838624586e-01   +3.454003441897840e-02   +4.603201914185992e-02   +1.607727547282286e-01   +9.941942848466263e-02   +8.912342263954717e-02   +1.009737383707569e-03   +1.574716776125774e-02   -3.175317671967829e-02   +6.589795472508041e-02   +9.724832562629215e-02   -8.384093233862418e-03   +5.421536109271129e-02; +1.810202548611560e-02   +4.362683809354594e-02   +5.371498533458747e-02   -3.288607098874692e-03   -1.691812464293983e-02   +1.102401301404125e-01   +9.554000950969546e-03   +1.100158732957688e-01   +1.015108363722180e-01   +6.610335186063196e-02   +1.974131379029037e-01   -8.400146858359062e-03   +1.328175394717186e-02   +1.069800701168830e-01   +4.679322801897670e-02   +4.775609548046067e-02; +1.388369428200740e-02   +6.118104787267284e-02   -2.753833796660068e-03   -6.369287785520511e-04   +9.061009345703200e-02   +3.618636572833258e-02   -2.268536431436464e-03   -2.649419843135964e-02   +1.024008639093796e-01   +1.466601747315414e-01   +4.178554117867735e-02   -5.905988595230845e-02   +1.872843713314521e-01   -5.584647818418587e-02   +1.043131372409260e-01   -9.661614523893361e-02; +1.192715363865480e-01   -1.064152687362963e-02   -3.503589257302513e-02   +1.009988904632240e-01   -2.615831218374506e-02   +2.342908434029486e-02   -1.556045203124563e-02   +9.202952822237512e-02   +1.234520053813780e-01   +7.691944304935730e-02   -1.388589382823799e-02   +1.520686511311585e-01   +7.417914654049518e-02   +9.697414663095089e-02   +5.473444765279541e-02   +1.353723412700162e-01; +8.659783225681297e-03   +1.296796362421647e-01   +1.361750990827335e-01   +1.442699100037710e-01   +1.385143421704571e-01   +1.557970944817886e-01   +5.289205884817554e-02   +1.864950486632384e-03   +7.326035888022620e-02   +1.351398106257485e-01   +5.614446549501547e-02   +6.632043358632804e-02   -8.347547703537034e-02   +8.548596399445883e-02   +1.364234347104245e-01   +6.867603862610126e-02; +6.654912194654122e-02   +4.951104517268982e-02   +8.906343617290050e-02   -1.143847698702121e-01   +8.270029487897443e-02   +5.222585734744785e-02   +5.406050187016441e-02   +3.148525158683964e-02   -1.562430796445274e-02   +6.410785474081468e-02   +8.715583461258024e-02   -1.356462473745769e-02   +3.053775265940449e-02   +2.078923103168082e-04   +4.299959112449743e-03   +4.572612850215604e-02];
L2E_L1E_iAMPA_netcon = [-4.012741085290530e-03   +7.972208300847246e-03   +1.844264136785090e-01   +2.449910314997119e-02   +9.059461632164588e-02   +1.009212670092400e-01   +4.703431860118067e-02   +1.499888567145206e-01; +9.161788362985594e-02   -2.057671400879067e-02   +4.322748592986209e-02   +7.993807898473224e-02   +8.005805034473749e-02   +1.085426011280904e-02   -3.242972352505334e-03   -5.178293565071070e-02; +9.999117143194017e-02   +2.523034537772668e-02   -1.029791036872085e-02   +1.120144079600935e-01   +1.087441725964303e-01   +1.318583534276996e-01   -3.481692190632355e-02   +7.631872076647515e-02; -4.404796627363536e-02   -6.316270945661936e-03   +8.015608773418786e-03   +8.281368378952200e-03   -4.295515651384442e-02   +4.460506816797014e-02   -3.743496274341982e-02   +1.250430169268612e-01; -5.944717666520855e-03   +8.511542259864724e-06   +3.425245719822164e-03   +1.364929904041491e-01   -2.818497742599654e-03   +5.098363927586078e-02   +9.067147310360331e-02   -3.482560764640641e-03; +3.421095590215397e-02   +7.322069917059282e-02   +6.153693267712471e-02   +5.079910305183775e-02   +2.252190948925354e-01   +7.463213163174293e-02   +3.513642839040374e-02   +6.279367937722703e-02; +7.162333362543404e-02   +7.302978643057773e-02   -9.455083311171279e-03   +4.781234735704213e-02   +8.035958576652803e-02   +9.655851973240308e-02   +1.606266501111376e-02   +3.010983640798038e-02; +9.713372271398971e-02   +4.279865746708560e-02   +5.605446966086992e-05   +1.610708660118466e-01   +5.722086703556811e-02   +3.104723026755078e-02   -3.133037884425133e-02   +1.171202109808087e-01; +1.312961229016396e-02   +5.753615252842677e-02   +1.275221048290524e-02   +2.256549974747002e-01   +1.420896286822643e-01   +6.784764666198738e-02   +6.285782572323304e-02   -7.070914616441049e-04; +3.694184187139519e-03   +8.757248812861207e-02   +6.144510359371566e-03   +4.524278682272572e-02   -6.279775977667849e-02   -5.995701584261969e-02   +1.733854943843936e-02   +1.346311569639196e-01; +5.062880725809288e-02   -1.370136980721709e-02   +1.885185741499721e-02   -2.254954846696555e-02   +1.134627208865435e-01   -9.673965927955280e-02   +2.787022992809114e-02   +5.559125296585753e-02; +8.622879331820574e-03   -9.495270843196586e-03   +8.655250375758985e-02   +1.216432279423412e-01   +2.871611991819136e-02   +7.796316801189729e-02   +8.720548453701787e-02   +3.738179585155810e-02; -7.499904509638985e-02   +5.065763243490703e-02   +1.603777028321686e-01   +1.535368985324041e-01   +6.780244867301152e-02   +8.565436058924211e-02   -8.529241789003647e-03   +1.420948417542637e-01; +1.062500393139585e-01   +4.345951363397905e-02   +1.636973385557527e-01   +1.292080962258454e-02   +9.264673388319505e-02   +7.837682898131952e-02   -3.255761701542331e-02   +1.671369285056154e-02; -2.213728194702752e-03   +3.899732420969487e-02   +9.979435069317694e-02   +1.354961312667416e-01   -4.101583406518974e-03   +6.971622672729441e-02   +1.013705302165142e-01   +1.246902985402960e-01; +1.624855040021055e-01   +1.952369472163847e-01   +1.016270297201204e-01   +1.588200524236470e-02   +1.308212142007064e-01   +1.214663404966146e-01   +3.714572208859547e-02   +1.756089459818976e-02];
L1E_L2E_iAMPA_netcon = [+5.412740463016684e-02   +5.531965493849816e-02   +3.665956565768901e-02   +2.229596355019533e-02   +2.619774314232132e-04   -4.661066427874012e-03   +9.021620826891858e-03   +1.159464339962593e-01   +1.632118589546742e-01   -3.080329491677997e-03   +1.837321906632862e-01   +5.257090253886183e-02   -3.843673698062057e-02   +8.438171335013536e-02   +2.531433589483215e-02   -2.061929991331149e-02; +1.321670443821519e-01   +8.106346669500697e-02   +5.540961666728880e-02   +3.518216763857843e-02   -5.990634750215126e-02   +5.702156215686407e-02   +7.589395894538453e-02   +1.641203598814539e-02   +7.238112690321472e-02   +9.464286814308387e-02   -1.071270447894755e-01   +4.063690481849726e-02   +4.052515467443965e-03   +7.172247381989483e-02   -2.672491367427505e-02   +6.904887795960921e-04; +1.212173620227088e-01   +1.045500592101102e-01   +1.288802581306069e-01   -1.094389275552238e-02   -2.455357592039426e-02   -6.960871806562963e-02   +3.327558832209132e-02   +5.466516120418783e-02   -2.051039054221435e-02   +3.171177456694110e-02   +4.503299866637443e-02   +1.791889173488273e-02   -2.240356482563395e-02   +5.156222690191514e-02   +5.548453190770718e-02   +2.123625062130629e-01; -5.186065164122407e-02   +1.254608901772689e-01   +6.437956880410677e-02   +2.695178068628303e-02   +1.074895676384237e-01   +8.627091217895393e-02   +1.202716384302980e-01   +5.162391051439230e-04   +1.610032691904974e-01   +5.439942730090314e-02   +1.382841352282236e-01   +2.560575109502266e-02   +4.028461460745543e-02   +5.481710793910031e-02   +2.768647731214378e-02   -2.304525342393815e-02; -4.416087741138383e-02   +1.335643956331731e-02   +5.547572802029554e-02   +2.255473324186497e-02   -2.188968353434332e-02   +1.138301866799424e-01   -1.065143689605424e-02   +7.297356447351912e-02   +8.589523420870251e-02   +1.895192183892389e-02   +4.324814832043098e-02   +1.322260911117576e-01   +7.046416756173279e-02   +1.878885279586529e-01   -3.723274836606083e-02   +5.967529690077226e-02; -4.089898314936932e-03   +9.733686164297861e-02   -3.049669207613354e-02   +5.667777476190498e-02   +1.108625500934258e-01   +1.478659260667601e-02   +1.209328879339796e-01   -5.403309994778838e-02   +7.484543870174654e-02   +5.650090485211584e-02   +5.503310052002600e-02   +4.383139500417266e-02   -2.523348489681632e-02   +7.808366910883864e-02   +1.795633388496067e-03   +2.498424556605386e-02; +1.069735525583817e-01   +1.246477218321180e-01   +2.594777888952743e-02   +1.459191209031163e-02   +1.586352551811060e-01   +1.306517918425787e-01   +9.063960395122980e-02   +8.855967678636917e-04   -3.561998469504266e-02   +1.265223966198172e-01   -6.191557769282357e-03   +3.044836035114683e-02   +4.205716667926089e-02   +4.326222750280487e-02   +6.480397503039013e-02   +1.186936187767392e-01; +4.543762442721175e-02   -5.534390110067906e-02   +4.076861797196593e-02   +1.188364128309205e-01   +2.075216283509341e-02   -5.761564002438326e-02   -5.346956359601070e-02   +6.066463275483153e-02   +1.170918227543379e-01   +1.666063537826177e-01   +6.701106295701859e-03   -4.050698175565401e-03   +1.550970560129188e-02   +1.724350729800044e-01   -5.519183722744359e-02   +1.883686520503406e-02];
L2I_L2E_iAMPA_netcon = [+2.692064252291053e-02   +1.235790060614114e-01   +1.215812905642624e-02   +2.428630302714324e-02   -8.401767962396636e-03   -1.082646691807175e-02   -8.865729482958304e-02   -3.235823601093464e-02; +6.740586900780533e-03   +1.528678796924299e-01   +5.654980164538112e-02   +1.518425832962871e-01   +5.711668845454761e-02   +1.410772327301483e-02   +5.079767395619674e-02   +1.170832735951430e-01; +6.919264377974811e-02   -6.489999394399443e-02   +1.480679279273476e-01   -1.423293464388709e-02   +4.954992347817544e-03   +5.635482347583199e-02   -1.440476300619012e-02   +1.503918125129271e-01; +6.288794847860837e-02   -6.151244453568245e-02   +1.025653500980005e-01   -1.548789999266790e-02   -4.330968174854720e-02   +1.270248708758780e-02   -1.372295208473524e-02   +9.741742649053314e-02; +1.824118021241390e-01   +6.758777678898428e-02   +3.387763376480893e-02   +1.308215324488217e-01   +4.421520869866145e-02   +1.365505489624586e-01   -3.914403879147273e-02   +3.037752948215329e-02; +1.346929748485314e-01   +1.855725147614908e-02   -1.294518330850655e-02   +5.131154209239031e-02   -3.730928471832034e-02   -8.562024423661449e-03   -3.207364186805897e-02   +6.894687003303883e-02; +3.099276613012990e-02   +5.837317395583679e-02   +6.448887440671490e-02   +6.275689144275805e-03   +1.722031761786737e-01   +1.140287694279022e-02   +1.444385428367122e-01   +1.580949271997034e-01; +2.711852576466554e-02   +4.181898555185774e-02   -6.519901939594470e-02   +4.994719366084607e-02   +1.095575328952141e-01   +7.347417264685771e-02   +8.003763222120572e-02   +1.576515356060049e-02];
L2E_L2I_iGABA_netcon = [+1.092136829331748e-01   -3.532768590538710e-02   +3.571662964803729e-02   +2.060956428074501e-01   +1.761734407277024e-02   +4.296587022812325e-02   +1.035842663025693e-01   +3.942238304930012e-03; +9.553675456819337e-03   +3.658503864890297e-02   +1.501747543600303e-01   -4.015627038287896e-03   +1.025990020523218e-01   +5.872125469651682e-02   +9.427099880339072e-02   +8.115117136686975e-02; +1.002620170580510e-01   +2.440927630593416e-02   +1.858594754511375e-02   -3.208194304955105e-02   +6.950515463797917e-02   +6.637014341382629e-02   +3.704683606959466e-02   -5.608751359366600e-02; +7.793693089717650e-02   +1.321143395680799e-01   -4.307284872142520e-02   -8.112830700609150e-02   +5.551995945410701e-02   +6.904841187873696e-02   +1.578293950277194e-01   -6.847767130236569e-03; +1.011619025015230e-01   +4.134410396506479e-04   +1.126641974093751e-01   -7.622708375618814e-02   +2.910283815560083e-02   +4.584592537639279e-02   +6.215760150483945e-02   +2.727631251171322e-02; +5.657785464627709e-02   +5.211051083948627e-02   -1.365528647920872e-02   +8.151107622798699e-03   +6.782778327064551e-02   +1.253673587260859e-02   +9.347770645520719e-02   +1.428527476305749e-01; +6.655665435343798e-02   +6.122413660938145e-02   +4.251714181092675e-02   +2.640358840783091e-02   +1.464117843130184e-01   +1.410266358427537e-02   -2.401339994522745e-02   -6.220290582232550e-02; -1.738845802884319e-02   +1.047584484255724e-01   +1.476060292801614e-01   +2.910256700936675e-02   +5.354951113655548e-02   +5.506630075607068e-02   +9.114384440226532e-02   +8.213015021812484e-02];
L3E_L2E_iAMPA_netcon = [+1.110130808376808e-01   -6.911516977500702e-02   +8.536125412351402e-02   +1.034243446696440e-02   +1.192257704543528e-01   +1.174593125850240e-01   +1.070463716144485e-02   +1.425863517382442e-01   +3.047133442712276e-02   +1.144333719603014e-01   +1.593368008958893e-01   +1.660650016760501e-01; +1.119737290805238e-02   +8.228229806910856e-02   +2.014682884741038e-02   +1.224905753708882e-01   +5.220834926008050e-02   -2.752459695337962e-02   +1.423204184720073e-01   +8.609377413606005e-03   +2.267185002656508e-03   +6.351683740681467e-02   -5.021083434912124e-03   +5.940294359877969e-02; +1.629345170949978e-01   +7.075335969940930e-02   +1.086625392022335e-01   +1.565538834261495e-01   +1.443783911196135e-01   +1.913142193612932e-02   +9.800494896418552e-02   +1.250890505547465e-02   +1.394744586094922e-01   +1.312419560339524e-01   +1.020558928957938e-01   +1.459891810024608e-03; +3.130503328805765e-02   +1.321165779887867e-02   -6.494392762193746e-02   +9.331356837257393e-02   +3.048892320906695e-02   +2.128877608284979e-03   +4.946923263197442e-02   +1.023136795880817e-01   +5.559027765277713e-02   -6.222196395075211e-03   -2.766302351227759e-02   +8.733947558859936e-02; +1.005715238009369e-01   -1.372712458240957e-03   +1.034097552163129e-01   -2.395307828299630e-02   -1.905107997662936e-02   -1.577349088067965e-02   +1.093725769589800e-01   -4.525314528881750e-02   -3.484223503938837e-02   -2.084370173032577e-02   +1.625781992947247e-01   +6.245935953594188e-02; -1.676864354492246e-02   +3.339365747948267e-02   +1.278164870221193e-01   -8.932194967027289e-03   -8.662007927138357e-02   +9.176534746230354e-02   +5.728173356251153e-02   +3.737125142316086e-02   +1.208537276293555e-01   -1.505493557574157e-02   +6.818349677137497e-02   +1.038602992882271e-01; +1.674657887932445e-01   +9.762445284598778e-02   +7.151222217181626e-02   +1.518136552800178e-01   -3.960150391142916e-03   +4.671002082131046e-02   +1.786246000374067e-01   -1.444263111693728e-02   +1.580446914318128e-02   +6.771494445894949e-02   +9.886602389113691e-02   +5.783378601892186e-03; +1.010711552416091e-01   +1.387268210204255e-01   +1.274918554129408e-01   +2.879274163156430e-02   +1.043111771191002e-01   +2.069475996644349e-02   +1.712416314534306e-01   -2.041058487146017e-02   -1.519782712152718e-02   +5.680267292754290e-02   +5.311123948569841e-02   +4.820058062211977e-02];
L3I_L2I_iGABA_netcon = [+2.121794009435449e-03   +8.428004334946487e-02   +5.238541682274624e-02   +4.891255918865871e-02   +8.407041949325390e-02   +9.110455520872010e-02   +1.339602005530467e-01   +1.246401849122486e-01   -1.314395936609672e-02   +1.116914932800954e-01   +9.710492752170639e-02   +1.059006646981612e-01; +3.971391113045632e-02   +1.199093531424583e-01   +1.523584606946133e-01   +1.450401536488032e-01   +2.370189034486603e-03   +1.866391278375478e-01   +1.023459580128136e-01   +1.778306307833259e-01   +6.993902388150069e-02   +1.074665612228796e-01   +5.642751094009119e-02   +1.083884921243893e-01; +6.614999907562230e-03   +2.395093782598350e-02   +1.058702890862432e-01   +2.840287011886605e-02   +1.073166849402854e-01   -3.187462117754267e-02   +1.021167986060112e-01   -7.974218501845956e-02   +2.352506905691016e-01   -2.681688666748826e-02   +2.658972534944537e-02   +4.873577446958982e-02; +2.722129923958712e-04   +5.750988541315865e-02   +6.507347869194573e-02   -3.522030081418631e-03   +1.470293558601410e-01   -6.961746308240151e-02   -7.178381921921480e-02   -3.248310511737315e-02   +1.758332734464186e-01   +1.545995638311640e-01   +5.926167865627999e-02   +6.757907753263140e-03; +9.155183932702135e-02   -3.454121697366283e-02   +1.222217139806508e-01   -4.541763523116762e-02   -4.189088458495976e-02   +7.184674461061022e-02   -5.175691687777157e-02   +2.745677256686805e-02   +1.170924544162948e-03   +1.313260059230320e-02   +1.571848009907544e-01   -1.977260848120149e-02; +2.437157523946000e-02   +1.099339274632722e-02   +3.994198509121604e-02   -3.031527254120028e-02   -1.672262068965186e-02   +2.494430317440519e-02   +1.786934309828811e-01   +6.681236713719343e-02   +4.664409590083440e-02   -4.736539028388954e-02   +3.481459505074961e-02   +7.571464341443082e-03; +7.274103571836124e-02   +4.514003460043355e-02   +6.784444640245005e-02   +7.189269812848992e-02   +6.801328486313435e-02   +1.666504135551227e-01   +1.525336648817079e-02   +2.805108555103408e-04   +1.266065366700279e-01   +1.099338543121464e-01   +7.155360808810682e-02   +7.086329878225328e-04; +7.112304676379762e-02   +1.001866658925205e-01   +1.763500805386570e-02   +2.076433309649598e-02   -1.857854868826746e-02   +6.430274760283938e-02   +1.895329728116230e-02   +7.995810904621176e-02   +4.999356322485492e-02   +1.005191454395216e-01   +5.924177031537718e-02   +6.099416013269740e-02];
L2E_L3E_iAMPA_netcon = [+1.045911127516612e-01   +1.447546863040068e-01   +1.513685394369475e-01   +1.983648748127814e-02   +2.266639805359320e-02   +1.275521684836934e-01   +1.127146579688648e-01   +1.839420573824093e-01; +1.001459841603830e-01   +7.738488341697107e-02   +8.471456782646714e-02   -1.395000986935493e-02   +7.423254295032052e-03   +1.510952643260019e-01   +1.187936638111825e-01   +4.317137490568617e-02; -4.188780808675751e-02   -1.863955500748413e-02   -5.716887850655879e-02   +1.078835768338078e-01   +1.035562559787084e-01   +1.759082854859258e-02   +1.315412285496231e-01   +1.533894424471446e-01; +5.256904127730059e-02   -5.367129004086661e-02   +2.445909753994015e-02   +6.136819924230548e-03   +6.578963731261832e-02   +4.847643631221940e-02   +4.528775681129460e-02   +2.930348441402494e-02; +9.423699184848536e-02   +4.200102430057102e-02   +6.107505369639989e-02   +1.231989359581581e-01   +3.192405582520552e-02   +3.561657729938845e-03   -4.007025421774350e-02   +4.551485182642350e-02; +1.471516897012784e-02   -8.961871388957090e-03   +1.128864834219829e-01   -7.687943835729620e-03   -9.516336894689600e-03   +3.642027586337884e-02   +7.894262422419060e-02   +1.057067376085014e-01; +2.548558890890348e-02   +2.415571990212835e-02   +1.087883959606348e-01   +1.497701250123484e-01   +1.786415226616255e-02   -2.134781815281218e-02   +8.730401211478026e-02   +8.804877286962137e-02; +1.457489715751350e-01   +1.600516055991763e-03   +6.611170333137370e-02   +1.381979667234768e-01   -9.300736597073540e-03   +1.061616971879406e-01   +5.205114408019564e-02   -3.797212325994340e-02; +2.975536300273426e-02   +2.307550555725200e-02   -9.565072716138559e-03   +9.224030747261701e-02   +5.984564095662367e-02   -8.795567473697218e-03   -1.302766878186624e-02   +1.006188414995253e-01; +3.024552373391463e-02   +1.112781559672007e-01   -3.047203901238280e-02   +4.062296399742961e-02   +1.785131246180095e-02   +8.644794884179233e-02   +1.708931199612227e-01   +2.731852990692629e-02; +8.395141857674419e-02   -3.809846476291907e-03   +3.560655644670784e-02   +9.805680350988114e-02   +1.202946807284297e-01   +7.031235211759708e-02   +1.164694997666483e-01   +1.432651784339804e-01; +2.973131720195190e-02   +7.373542701496863e-02   -2.009783466094404e-02   +1.445478868439532e-01   +6.793902623159367e-02   +8.826258805621247e-04   +1.408813850422146e-02   +8.957331840656363e-02];
L2I_L3I_iGABA_netcon = [+9.420160496819759e-02   +1.127889444871945e-01   +1.579908120521868e-02   +4.516570800746401e-02   +1.614114289173179e-01   +1.478007253298488e-01   +1.068492299879848e-01   +2.134492156784466e-02; +5.167688728598799e-02   +1.070299489832876e-01   +1.368475488126086e-01   +6.434787897048502e-02   +3.035420359661055e-02   +1.554188756568348e-02   +6.684792079897604e-02   +1.480764906750514e-01; +8.448430544534970e-02   +1.595487536316272e-02   +2.362410192623245e-02   +1.025347502595085e-02   -5.391262057261770e-02   +1.472332627158513e-02   +4.685376439982442e-02   +1.706760923102700e-01; +1.292299205442636e-01   -2.880312787516793e-02   -4.612765303594164e-02   -3.887627148823871e-02   -9.641986449836434e-03   +2.539708685771463e-02   -4.919899809067516e-02   +2.004190667991286e-02; -1.581855799613142e-02   +9.035392545623706e-02   +4.202924323933202e-02   -3.961189681696562e-02   -4.440160626508350e-02   -1.743876309081710e-04   +2.115149662596903e-02   +1.366750570730487e-01; -3.097893039662711e-02   +3.623180758775608e-02   +1.030822091299849e-01   +1.802479791149127e-01   +6.072101889873255e-02   +9.125915885349747e-02   +3.033767878032821e-02   -1.219796728888384e-01; +5.817654617786724e-02   +8.843118988990462e-02   +1.323105806041674e-01   +8.046877287504349e-02   +1.080404468725041e-01   +6.428039467533019e-02   +5.290394201598780e-02   -2.838593268264951e-02; +8.072405966872555e-02   +4.550015774901638e-02   +1.170409815780429e-01   +1.696978079648704e-01   -3.813209995879584e-02   +6.231046943030460e-02   -4.597745143721327e-03   +1.029223176648172e-01; +5.977050621358633e-02   -3.876600963781000e-02   +5.142683113863854e-03   +1.821552001367102e-01   +2.069837942864180e-02   +7.371770114633781e-02   +7.340420874630124e-02   +3.812084915318174e-02; +3.578936718787191e-02   +1.037916967817331e-01   -3.741745223956818e-03   +1.258348165122245e-01   +9.036431242923727e-02   +2.114409855777392e-02   +6.227590255303492e-02   +3.274726343694102e-02; +5.776283194752467e-02   +5.628968875758086e-02   +7.369855836263109e-02   +2.184194650134505e-02   -2.689843282903361e-02   +1.672077419506108e-01   +2.248235369041028e-02   +1.388861091489716e-01; +5.586137452693778e-02   -1.267675697974095e-02   +6.761393709649864e-03   +1.208971730920845e-01   +6.631067885740728e-02   +9.448850777987503e-02   +3.069934092844800e-02   +7.556648275291984e-02];
L3I_L3E_iAMPA_netcon = [+5.041654310096888e-02   +1.434513474922657e-02   +3.391356425935071e-02   +1.491237912414151e-01   +5.853753557239765e-02   -4.715468390527722e-02   +8.294387849640758e-02   -6.465923989172827e-02   +6.021067756764755e-02   +3.099834619637838e-02   -1.429230559630980e-02   +3.286380744795739e-02; +1.670429550605172e-01   +3.962697412068028e-02   +2.386732653070602e-02   +1.379619551142672e-02   +2.502268511500417e-03   +1.476096218471327e-01   +8.269117882360483e-02   +1.659885789929427e-01   +1.170920131356757e-01   +1.062470327278713e-01   +2.028547502414541e-01   +1.759979804392029e-01; -1.884285535713905e-02   +1.119614225331494e-01   +7.674116733411400e-02   +9.817830299606448e-02   +2.860893015572170e-02   +7.080144858769628e-02   +2.380828901786341e-02   +1.066236520892194e-01   +6.230474498939471e-02   +6.242514823697333e-02   +1.076624823200354e-01   +3.771915094307009e-02; +7.495730716303237e-02   +7.537544408804517e-02   +9.807654628517902e-02   +9.947205679088450e-02   -9.492108377975548e-03   +5.995660809198502e-02   +4.400965088541680e-02   +1.179733409801309e-01   +6.020258375255565e-02   +2.726590039248778e-02   +6.272687167047718e-02   -2.959559107709737e-02; +9.012673476116059e-02   +1.420317682684983e-02   -2.489040118678892e-02   +1.256294667333890e-01   -1.598399780090921e-02   +2.980936219453286e-02   +1.134218463980985e-01   -3.009454834322425e-02   -6.951396712056077e-02   +1.301093763557114e-01   +3.710846766732234e-02   +9.960862218867199e-02; +8.963769414144307e-02   +1.045263796784153e-01   +1.512287809043973e-02   +2.114061444856963e-02   +1.667485849187751e-01   +8.738734495346502e-02   +4.334394603201801e-02   +3.493935984665412e-02   +5.755175857543616e-02   +9.355149298498629e-02   +8.576570313176743e-02   +1.420942294292484e-01; +4.259065733295253e-02   +8.322752111530443e-02   +8.743293019688578e-02   +1.198998412815130e-01   +3.795618225561760e-02   +5.674794687541728e-02   +1.003582862334362e-01   +1.035888827761040e-01   +1.462454704755027e-01   +1.671902231075370e-01   -5.851237674914833e-02   +1.084842811681749e-01; +1.026696030366770e-01   +9.345998999241155e-02   +1.028578798356137e-01   +2.521140948073358e-02   +9.631139732640036e-02   -3.256130165287652e-02   +7.996093233037016e-02   +6.652368841283900e-02   +6.374514891054843e-02   +2.251749869030399e-02   +7.364813830038931e-02   +8.046608452400326e-02; +6.652268885733506e-02   +1.466649173925229e-01   -4.173283893351882e-02   +1.597041580790713e-01   +3.498332085267369e-02   +3.370227560497924e-02   +6.549594022729835e-02   +2.533698799457584e-02   +5.679005662768934e-02   +1.079714561493885e-01   +3.108691499151287e-02   -3.878947032269808e-02; +2.860157031790401e-02   -1.237564854073532e-02   +3.103766837808241e-02   -3.791669835729770e-02   +3.647749526178255e-02   +2.027506905556060e-01   +1.295859113570119e-01   -5.123701122744967e-02   +1.358626455189815e-01   +9.255955623477413e-02   +2.751902218455286e-02   +4.959982638372694e-02; +5.339947630068578e-02   +1.749111689290949e-02   +2.017233759557518e-01   -5.983291510237661e-02   +9.885075655271926e-02   +2.780498345112046e-02   +1.163920849593764e-01   -4.400465848658583e-02   +1.701574497587069e-02   -3.023657130052894e-02   +8.744217067783980e-02   -7.891310748762544e-03; +1.764762678236890e-02   -8.343217670974393e-02   +6.779734165224299e-02   +1.653960664430446e-01   +8.180038731040838e-02   +7.076369339612607e-02   -6.887200012841282e-02   +1.970580463665106e-01   -6.454364284359922e-02   +6.951157137984108e-02   -4.697024888802923e-02   -3.806652812991180e-02];
L3E_L3I_iGABA_netcon = [+4.637806352425460e-02   +4.947710089037723e-03   +1.612530661200327e-02   +1.186986193451834e-01   +1.208437615943281e-01   +1.348131399034296e-01   -2.855311350503334e-02   +7.954206852058239e-02   +1.446893383499841e-01   +6.846757868322983e-02   +6.162687503180243e-02   +3.187743441333935e-03; +1.375976223340785e-01   +1.000985830569120e-01   +1.154374862797823e-01   +5.385981904470565e-02   +4.149554669258990e-02   +2.217722878227474e-01   -7.958347418564363e-02   +1.245881992763890e-01   +1.247370963063492e-01   +9.461699449314311e-02   +6.059561575958490e-02   +1.773098251812835e-01; +3.552068469235899e-02   +8.835795655519040e-02   +1.160770039631663e-01   -2.738296158823112e-02   +9.199406882448727e-02   -3.641675549521948e-02   +1.057871531227486e-02   -4.854130294008174e-03   +5.551136688897101e-02   +4.297482284345116e-02   +8.037388837711010e-02   +5.955448663748288e-02; -2.546769662443838e-03   +2.573112286270274e-03   +7.585418977933606e-02   +1.312897747428484e-01   +1.955726430410357e-01   -7.486197641979691e-03   -2.053562744503328e-02   +7.760804682492961e-02   +7.906617119141546e-02   +1.891154097789124e-01   +5.432858954083006e-03   +5.798061612609015e-02; +8.871261797370542e-02   +1.519141971247678e-01   +1.273348616508809e-01   +3.700734323249610e-02   +1.304702000827649e-01   +5.266961510162138e-02   +1.201943515820853e-01   +1.412419054441630e-02   +1.007161626283322e-01   +1.518447556486301e-02   -2.567079923550790e-02   +5.125432681774040e-02; +7.095739125747802e-02   +1.733253618035704e-01   +6.159172993689187e-02   +5.185308659646216e-02   +1.167526824931904e-01   +1.077749307185808e-02   +7.912517027701058e-03   -5.651902012900677e-03   +5.518428024341369e-02   +7.250908632336468e-02   +4.912592078820915e-02   +1.185669003833880e-01; +7.639789604507485e-02   -3.307230373517076e-02   +8.128642981209287e-02   -2.786875400210478e-02   +5.785601575308896e-02   +1.553845471055878e-01   +4.289565940978164e-02   +1.388263572905633e-01   +1.089052024911346e-01   +1.478840419867463e-02   +1.322214384934371e-03   -6.484792227317081e-02; -9.145702939706235e-02   +8.794638610691546e-02   +1.339270597481834e-01   +1.486473219843060e-01   -3.706337817548443e-02   +7.118625492002734e-03   +4.905603379789435e-02   +1.026942705490643e-01   +7.038038274507250e-02   -1.937816903400748e-02   +4.074289055097628e-02   +1.292594039295554e-02; -3.515817218104959e-02   +8.133071170937456e-02   +1.018107540214505e-01   -6.668465775865415e-02   -2.209261543959698e-02   +4.457494007804307e-02   +8.199194305615010e-02   +1.361281165787441e-02   -2.865537853393513e-02   +1.087631428186487e-01   +6.552794432198733e-02   +7.830819078499185e-02; +9.427875138548553e-02   +6.831947738456302e-02   +4.760266756821020e-02   +1.595548846985835e-01   +1.195490644648925e-01   +4.080587673654069e-02   +7.597664308580644e-02   +3.607355452577213e-02   +4.342637830598516e-02   -4.416032560676573e-02   +1.222232291654769e-01   +9.644755415488947e-03; +5.555922713962624e-02   -3.260142219074722e-02   -1.707413120023918e-02   +6.038504501754222e-02   +8.195653803908781e-02   +3.042895756029025e-02   +2.229836286877081e-02   +1.062818960766214e-01   +8.163178930458975e-02   +1.696059039630011e-02   +6.790546979951453e-03   -1.209263605482027e-02; -2.802372993096082e-03   -1.021380763014646e-02   +5.122690229613124e-02   +1.446638312370453e-01   +3.614754913525584e-02   +3.792440745733205e-02   +8.958594687613447e-02   +3.482740482297546e-02   +1.385480125467081e-01   +9.094223165041043e-02   +1.411526707335116e-01   -2.934815282233783e-02];
L2E_Input1_iAMPA_netcon = [+9.815982574962399e-02   -1.477541499772084e-02   +6.502925181142656e-03   +1.475768546622845e-01   +2.486352184336513e-02   +1.947423199609100e-02   +4.104796856211065e-02   +3.992805001644175e-02];
L2I_Input2_iAMPA_netcon = [+5.387428936079873e-02   +5.734352769997028e-02   -1.507455397769947e-03   -4.099657738263089e-02   +1.313252039227150e-03   +6.663279807979765e-02   +1.290813083521724e-01   +1.649666570497170e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
