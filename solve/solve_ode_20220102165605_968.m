function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.540214822895714e-03   +5.243282864225064e-02   +9.682277307425334e-02   +7.236764005762730e-02   +6.684504913284682e-02   +1.142176523389193e-01   +5.221893841304864e-02   +1.650794203893650e-02   +2.615227467131847e-02   +4.918327948461961e-02   +6.773856021821201e-02   +2.805036420506395e-02   +4.465606401346237e-02   +7.384884519947586e-02   +4.961601807398442e-02   +8.182856722542051e-03; +4.228884886264855e-02   +4.047838989215504e-03   +5.655260773207287e-02   +6.649810030104866e-02   +2.790675659992662e-02   +3.492372404049334e-02   +1.056345213003089e-01   +1.078273154344712e-01   +7.248196012528453e-02   +2.639963290438544e-02   +1.094103830813882e-01   +2.419845056242413e-02   +2.085356035572797e-02   -3.572657703739911e-03   +6.469816983199787e-02   +4.445177454421492e-03; +7.589851964052148e-02   +7.749277134035196e-02   +9.845389665576491e-02   +5.390855694348128e-02   +1.125754938446380e-02   +9.908378240907496e-02   +9.660480617253131e-02   +5.099233391445916e-02   +4.916572585170792e-02   +4.309683397691443e-02   +5.344909180524757e-02   +2.131408514138603e-02   +2.056512132865379e-03   +2.129702628348223e-02   +9.604673734180505e-02   +6.345362690456831e-02; -1.957635895421666e-03   +5.009084885425589e-03   +5.304564609133530e-02   +7.037269398382434e-02   +2.371082277187561e-02   +8.268437074085493e-02   +5.137696607238033e-02   +1.043161038889229e-01   +4.431843811524391e-02   +3.019764448606567e-02   +9.604300331376224e-02   +1.019177949046571e-01   +1.833632757794987e-02   +1.021241474598521e-01   +2.625697895607746e-02   +3.407604117051254e-02; +5.485653426065303e-02   +7.260760665904478e-02   +6.933618692778128e-02   +8.261026328745383e-02   +4.241494401405162e-02   +9.787636340579080e-02   +5.410040199310711e-02   +2.670732480242193e-02   +5.804817486018950e-02   +9.208977027241688e-02   +4.009953075639701e-02   +7.383931179353206e-02   +2.682646416289035e-02   +2.915512257642860e-02   +1.074332710986268e-01   +1.692243146482802e-02; +5.536347271176297e-02   +1.394515878611423e-02   +9.578825716126692e-02   +1.981213295973088e-02   +6.529866829452759e-02   +3.499095050209614e-02   +4.542772793666542e-02   +2.339532600052214e-02   +4.989359669282620e-02   +5.021415165493054e-02   +7.633724170106719e-02   +2.352499664361509e-02   +5.044109075234986e-02   +6.001126617803285e-02   +5.614243313952232e-02   +7.743307031470786e-02; +3.583795823797466e-02   +7.525025994000163e-02   +1.018730846752477e-01   +7.251960160680652e-02   +4.606496914788983e-02   +6.786550542326582e-02   +4.403955990991298e-02   +9.532198520340983e-02   +1.061422074833597e-01   +4.172293191458744e-02   +1.657426051499133e-02   +2.082707560535453e-02   +4.864436142451294e-02   +1.031431210939718e-01   +6.591270515470507e-03   +2.619131449349151e-02; +6.302642280356682e-02   +3.910287262767344e-02   +7.821472245613638e-02   +6.992792092778362e-02   +6.518285713718193e-02   +1.946062252968319e-02   +4.103212627008839e-03   +5.242790700307354e-02   +8.349435379258287e-02   +7.209989491051215e-02   +2.734685313504404e-02   +8.649466835426720e-02   +2.682323729357741e-02   +1.308780594628954e-02   +7.171232835994480e-02   +6.666493887673626e-02; +3.216114417136319e-03   +7.039093622393212e-02   +7.176993574347201e-02   +7.170865011901294e-02   +6.382235959500145e-03   +1.005714033013668e-01   +4.636605025546599e-02   +5.100920468617565e-02   +5.599212395673697e-02   +5.202196552470219e-02   +2.242431885798748e-02   +9.983002605672406e-02   -3.662785196779854e-03   +8.307287681554225e-02   +3.689722690759811e-02   +5.007470792592777e-02; +7.321742115869602e-02   +1.560723996335198e-02   +9.984118663047714e-02   +9.017633227297216e-02   +6.622449032826103e-02   +1.995700629778129e-02   +1.397888796987162e-02   +4.641299870861703e-03   +8.105597258525438e-02   +4.651212366740710e-02   +1.026769817615787e-02   +6.022177285046857e-02   +9.625783388647638e-02   +2.048675356630777e-02   +9.253285415581432e-02   +6.936920945765940e-02; +4.593814397481457e-02   +5.722574567744123e-02   +5.724624056132203e-02   +8.366751740675574e-02   +9.817990283169445e-02   +2.199600148100895e-02   +6.799609908877824e-02   +6.555934765424100e-02   +2.675804692032605e-02   +2.595688707347365e-02   +7.716968308843437e-02   +1.038813987691900e-01   +1.780117827788958e-02   +7.542992223889552e-02   +8.664444671978790e-02   +2.367664410786061e-02; +5.613046505768924e-02   +2.948591292527495e-02   +8.236390477826500e-03   +1.271081410781246e-03   +1.015019865997421e-01   +1.025762061045232e-01   +5.639302958838379e-03   +7.862402889810594e-02   +7.456761850928965e-02   +3.371053641240325e-02   +1.531384237780842e-02   +7.198936991249514e-04   +9.857395783929646e-02   +9.753186881886013e-03   +5.709289640836943e-02   +4.809319578888508e-02; +7.153424969101135e-02   +8.288268810682921e-02   +9.270586886164156e-02   +1.760055055181760e-02   +7.217584564909701e-02   +7.429407811935142e-02   +8.104441882222869e-02   +7.423478492415451e-02   +9.232156953968169e-02   +5.090395844085076e-02   +4.238566856241058e-02   +1.043092716073486e-01   +9.239973721823230e-02   +7.528248645678373e-02   +5.390200302429995e-02   +1.006600871189358e-01; +9.086701907732674e-02   +7.120400810330162e-02   +3.553589090978585e-02   +6.375736049173905e-02   +1.773531697732523e-02   +2.811451577110328e-02   +1.331461057651886e-02   +2.292036159409905e-02   +3.520461458591240e-02   +7.987173571291274e-02   +2.113081875222994e-02   +9.453262191386153e-02   +6.449025268624300e-02   +7.251265105224562e-02   +4.536147916148417e-02   +3.796493550642685e-02; +7.140248724337287e-04   +6.089319683594770e-02   +9.627242118197409e-02   +6.002672678726959e-02   +3.433418789363437e-02   +1.880304132584729e-02   +3.114544470111424e-02   +4.481015279619715e-02   +2.606137920076777e-02   +1.049636034198197e-01   +3.214954794026541e-02   +1.045226205254289e-02   +1.376383931289796e-02   +8.056474758440524e-02   +4.912477695193910e-03   +7.141607429012717e-02; +8.763993905399542e-02   +3.790370450669257e-02   +2.324735451088741e-02   +1.035623805986582e-01   +9.546598051645424e-03   +1.593578924122063e-02   +9.525497058909262e-02   +1.380935033099807e-02   +6.077488035769103e-02   +8.703229726687017e-02   +7.843659574057742e-02   +1.600911748402075e-02   +8.415418327411869e-02   +8.560593077758182e-02   +1.046813132720924e-01   +9.771897947641640e-02];
L1E_L1I_iGABA_netcon = [+5.088921504983608e-02   +6.492394921833790e-02   +4.608151760014588e-03   +2.959645576757383e-02   +9.080066275764152e-02   +4.490332354502004e-02   +4.030630583233718e-02   +2.273514649096964e-02   +9.925921809099826e-03   +3.459952731128234e-02   +3.716474517409673e-02   +6.386451778338235e-02   +3.289687961863507e-02   +9.669844086079331e-02   +2.406535180807143e-02   +5.144647165974601e-02; +6.254417783904851e-03   +1.003648020222496e-01   +5.791708725140016e-02   +9.106350590549857e-02   +4.697939371328162e-02   +5.157680180596115e-02   +1.785676726243466e-02   +5.660163438199015e-02   +5.457658536848805e-02   +1.336974412290011e-02   +1.986630467468701e-02   +7.658205986197711e-02   +4.532956998113496e-02   +7.768506579344539e-02   +5.529363648720256e-02   +7.550204228609915e-02; +6.915602616012052e-02   +1.055811745307871e-01   +9.210056692673328e-02   +7.468716529013532e-02   +1.408638975835928e-02   +5.875332090758278e-02   +7.185095452699024e-02   +1.000641007790983e-01   +9.824902422521584e-02   +1.093361192727568e-01   +7.505108776839706e-02   +5.867951661811611e-02   +1.058703891972470e-01   +9.061037338663123e-02   +4.657683699369665e-02   +6.189375587832974e-02; +3.528985919165926e-03   +2.006872724844196e-02   +1.003859517034967e-01   +1.158240984206288e-02   +1.828535507453519e-02   +7.998757153825510e-02   +8.431995453140093e-02   +5.443257911198517e-02   +5.874041624413296e-02   +1.090542027802942e-01   +7.342737270592882e-02   +1.122835409207367e-02   +3.822343905777118e-02   +2.230312121582779e-02   +1.078033732977098e-02   +1.098162254797082e-01; +3.999017869472913e-03   +9.925991303322459e-02   +5.347617216301339e-02   +1.567416522634190e-02   +4.473693686413507e-02   +9.502157008094987e-02   +7.868164588929524e-02   +4.552231947481335e-02   +3.428857461824112e-03   +2.036869669609612e-02   +7.341218839182764e-02   +1.389288786367390e-02   +8.987407186980965e-02   +4.583279443961109e-02   +6.801666896079027e-02   +5.369346397612140e-02; +8.881980447495469e-02   +9.902191881653122e-02   +1.124635593613501e-02   +7.479443242330359e-02   +3.646311376912118e-02   -6.667303433822252e-03   +7.444302660326614e-02   +3.002680482498618e-02   +9.409824107787584e-02   +1.986550513874088e-02   +1.002668227021778e-01   +1.867040229426789e-02   +4.175940794571992e-02   +8.928581895932774e-03   +6.660709465445248e-02   +1.516108276516929e-02; +5.544994627278033e-02   +2.669107551737026e-02   +1.827297114666578e-02   +2.934392843827994e-02   +1.365870937172683e-02   +4.225209236675296e-02   +3.763583675810750e-02   +5.594972903289802e-02   +9.827206055196971e-02   +2.046643778545867e-02   +8.403939072189809e-02   +1.074370938667926e-01   +1.122922331026111e-01   +5.281025148769103e-02   +5.602572638670791e-02   +3.370938715473661e-02; +3.162780852123299e-02   +2.066636395063333e-02   +3.658737918876538e-03   +1.898264004268814e-02   +7.354356456576265e-02   +5.796432479925136e-02   +5.575339425929109e-02   +6.305873309870427e-02   +2.370042541708312e-02   +4.512619537743007e-02   +9.381776563944032e-02   +1.094791149549331e-01   +5.903112321292935e-02   +5.288392441711050e-02   +1.802901211963508e-02   +7.508758602567182e-02; +3.846562467837199e-02   +6.584890108021557e-02   +3.432956910677919e-02   +1.475818777041400e-03   +1.698593343612625e-02   +7.106235439733288e-02   +8.812359325254060e-02   +9.638167886544186e-02   +4.072681232118947e-02   +1.111965317310201e-02   +7.838670353815094e-02   +4.515710647916169e-02   +1.001348013349801e-01   +1.088079832612052e-01   +6.368427899409825e-02   +1.348744635479127e-02; +6.681380088466337e-03   +4.304957401677997e-02   +2.385116611834594e-02   +6.401147710733285e-02   +3.835723000130745e-02   +8.582018655286458e-02   +3.142260277725455e-02   +2.822969963598508e-02   +1.014444549098907e-01   +8.655635088496305e-02   +2.862418462546160e-02   +6.351759176930288e-02   +8.269230596114316e-02   +1.773591530037288e-02   +7.500935413701160e-02   +2.512318553955635e-02; +9.278983721413181e-02   +9.373701351851789e-03   +3.804077920008071e-02   +4.716527716671942e-02   +6.165732327316496e-02   +7.622257928118512e-02   +4.944674863479403e-02   +1.099180094992020e-01   +3.910207429313742e-02   +4.277901972413391e-02   +6.646670462775227e-02   +5.555783262077874e-02   +2.435898491566849e-02   +1.065126668056697e-01   +9.174521544207281e-02   +3.490878999580777e-02; +1.946902797333379e-02   +1.040486564755364e-01   +5.880260121853655e-02   +1.012818572650837e-01   +1.075764681475857e-01   +7.601832788784593e-02   +5.257179010345922e-02   +1.531049344759402e-02   +7.851682523996863e-02   +5.577080137784220e-02   +3.171015448161611e-02   +8.921073406373137e-02   +7.854546491085694e-02   +5.487336343755195e-02   +8.940219753434760e-02   +2.243494343783061e-02; +7.827887587700781e-02   +8.563009189983881e-03   +6.031141018856632e-02   +1.316467455673045e-02   +5.876750399264488e-02   +5.961970081208732e-02   +6.538168004191769e-02   +2.582176739186430e-02   +7.935978837451520e-02   +9.659646012858863e-02   +2.712594227515789e-02   +8.948207846680188e-02   +1.068221114718173e-01   +6.625371889931782e-02   +3.821235418627326e-02   +1.028550401268368e-02; +2.849123857595574e-02   +3.325454242288162e-02   +2.942221061503194e-02   +1.189632176757243e-02   +2.303336730493352e-02   +9.511347356178310e-02   +1.025389001993398e-01   +7.977641633324990e-02   +5.120696396659488e-02   +6.875204776173090e-02   +1.076307438949502e-01   +8.221785315186265e-02   +7.172754782776335e-02   +9.037825170685354e-02   +6.905109825640535e-02   +7.638333026663589e-02; +4.944368772275604e-02   +2.567251558253724e-02   +4.827049465419464e-02   +9.112335862938768e-02   +6.408592917416985e-02   +5.769621296886113e-02   +1.438173887144380e-02   +3.588253438442811e-02   +1.494389598700100e-02   +6.047437875993172e-02   +3.235872795430594e-02   +4.789331161565518e-02   +3.406482917278577e-02   +2.846918136708067e-02   +1.076107419003453e-02   +2.638295995158997e-02; +4.400471746297771e-02   +3.004639166093964e-03   +2.087282817047499e-02   +1.045771330875613e-01   +1.051679520920254e-01   +1.165406766646781e-02   +2.566796817588154e-02   +9.446437477646089e-02   +9.090658592361067e-02   +1.179618323848390e-02   +3.847421936216394e-03   +6.887762557235784e-02   +7.394499013626124e-02   +5.518180549726510e-02   +4.616003291935117e-02   +5.273973776079300e-02];
L2I_L1I_iGABA_netcon = [+1.097912039887815e-01   +4.909478445749436e-02   +3.839837559613944e-02   +9.584066844445416e-02   +1.048354690697574e-01   +1.033259587630558e-01   +4.163090763824962e-02   +8.124770837201573e-02; +8.905710555134029e-02   +8.692676498417976e-02   +7.652794665746881e-02   +2.953827808077622e-02   +4.442096015698568e-02   +6.761534221035484e-02   +9.575130897249437e-02   +2.895218128874052e-02; +1.739322110606914e-02   +2.445084013825671e-02   +2.548391047221191e-02   +5.268962977600454e-03   +8.516404421632401e-02   +1.044150648967443e-01   +1.148668305589876e-02   +6.578293207897845e-02; +4.413268949272410e-02   +8.798257031992872e-02   +7.827592591828267e-02   +6.782681648188847e-02   +6.617370274881752e-02   +6.426178832470854e-02   +5.508707499594299e-02   +8.440415367250931e-02; +3.849641106752145e-02   +1.395205823223960e-02   +7.217740952918175e-02   +6.545771277920701e-02   +4.690535812525190e-02   +7.860622020570499e-02   +5.126699637723686e-02   +6.008565882734972e-02; +8.611603540570324e-02   +7.614387417109350e-02   +1.040070792782155e-01   +5.243122345000947e-02   +2.587994558442133e-02   +7.367482686439512e-02   +4.854341365927876e-03   +7.704100404357370e-02; +1.302680972898507e-02   +5.008068311222146e-02   +4.664739321029522e-02   +2.853324351358275e-02   +8.175379648136157e-02   +2.945751153033874e-02   +2.461693502150764e-02   +7.764097112267569e-02; +6.755506789822689e-02   +3.685925007481021e-02   +8.583811408601241e-02   +4.868857224273906e-02   +3.060321081776020e-02   +7.936053221554680e-02   +4.808276396500145e-02   +3.841780275024113e-02; +5.155128526024651e-02   +7.364902460190133e-02   +2.429096247293097e-02   +2.418334416022096e-02   +3.505738323964067e-02   +1.837562983359870e-02   +4.682755795113577e-02   +1.114876215308080e-01; +6.553084388123449e-02   +7.242528742089242e-02   +2.404374265631618e-02   +5.186090017137748e-02   +5.840525637829366e-03   +7.671477961145932e-02   +9.893478424514236e-02   +7.230364725391676e-02; +5.796918016553522e-02   +8.482380109171946e-02   +8.856849244665177e-02   +3.759894130054719e-02   +7.767327752553374e-02   +1.016146468426984e-01   +2.025156434658439e-02   +2.611390572196375e-02; +9.116944041869568e-02   +5.542549047879575e-02   +7.140676259112097e-02   +4.802096839126559e-02   +9.795104932030033e-02   +2.507722658408839e-02   +6.859392942320541e-02   +3.752762338498355e-02; +3.556732903998513e-02   +1.081673124336884e-01   +9.748735870203155e-02   +1.478631804814980e-02   +5.902710628510805e-02   +4.021941521651790e-02   +3.264308453892108e-02   +6.050412384033272e-02; +8.123194223955534e-02   +2.478176635593345e-02   +1.081705601111044e-01   +5.794562302643790e-02   +9.098846552903841e-02   +2.124084773083783e-02   +1.018015488833449e-01   +2.674625106968059e-02; +1.111005685014538e-01   +2.521338428050659e-02   +3.114475933134352e-02   +1.012227507428144e-01   +7.221154155614239e-02   +1.695304643334335e-02   +4.376668122466811e-02   +7.515912234548300e-02; +2.219005693750362e-02   +7.572175944086536e-02   +7.327241922924760e-02   +7.055210308650403e-02   +9.447285132606069e-02   +1.528406184450858e-02   +1.085998307641194e-01   +3.323365819038585e-02];
L1I_L2I_iGABA_netcon = [+6.313109097558064e-02   +7.626437200612388e-02   +2.371511522979641e-02   +5.890900583815813e-03   +6.079862194277764e-02   +3.494340788098549e-02   +1.058929732136194e-01   +7.116555754843827e-02   +4.513863361971608e-02   +8.348916867798492e-02   +2.044218027188341e-02   +3.336030150183615e-02   +1.081163658902779e-02   +9.949638397307311e-04   +2.256490720393329e-02   +9.025989037924713e-02; +8.509484427111677e-02   +7.076466506098519e-02   +4.445236875909611e-02   +5.785532142458576e-02   +1.068175849386168e-01   +5.110477212186032e-02   +6.742726990379318e-02   +1.026148241302379e-01   +5.407029516043614e-02   +1.041935121147019e-01   +7.187560974014200e-02   +3.950341732692954e-02   +5.836202992487488e-02   +6.466431173612241e-03   -4.032085834950797e-04   +9.976214179457386e-02; +9.760302661702398e-02   +6.256784288518494e-02   +2.259402637599476e-02   +8.281318713842663e-02   +3.683053646084928e-02   +9.518354174163521e-02   +7.667069206143902e-02   +7.160354529695337e-02   +3.804725902436754e-02   +4.523918161773074e-02   +6.763804198470216e-02   +4.843332297073078e-02   +3.644903905068775e-02   +1.731120604619489e-02   +6.568093756856316e-02   +1.822203381153122e-02; +4.562347422541741e-02   +3.852297834279574e-03   +6.452104864478898e-02   +8.871506628822654e-02   +1.712602271772262e-02   +6.820901495753462e-03   +3.788920601868068e-02   +3.257281856571102e-02   +4.616942008017269e-03   +6.899123668835938e-02   +5.914484220063480e-02   +5.009976518710560e-02   +2.507369418012863e-02   +4.945630644736470e-03   +8.871266951264960e-02   +5.936586103420084e-02; +8.432253672679692e-03   +9.189562336190357e-02   +7.999526266331600e-02   +7.274708963601410e-02   +6.776607704943553e-02   +5.443546159089335e-02   +6.360142232306769e-02   +9.320108132736944e-02   +6.495786581477561e-02   +4.959799833568665e-03   +3.429024026224781e-02   -2.239445803527855e-03   +3.114161333892946e-02   +9.486575234270397e-02   +2.248468650823056e-02   +5.836760021758475e-02; +6.666342229892330e-02   +7.610425121126933e-02   +8.720376077080184e-03   +1.001827540406968e-01   +6.429346053981515e-02   +1.026616569932030e-01   +7.616591327152078e-02   +8.604713720640068e-02   +6.025506901231593e-02   +6.409580931217990e-02   +1.085587525085648e-01   +8.471851814638984e-02   +1.506822830905867e-02   +1.006095971374118e-01   +7.481124805468767e-02   +1.034895941552226e-01; +8.581310435608522e-02   +1.523077814614466e-02   +9.922042837069904e-02   +1.066689088420362e-01   +4.272494293769479e-02   +1.080715667853809e-01   +5.657740920082562e-02   +4.974988943783922e-02   +3.136672655519123e-03   +6.122264428944408e-02   +4.031536366730453e-02   +3.693319585388444e-02   +8.030454707918323e-02   +4.330806826702636e-02   +8.964952861166887e-02   +6.577572676702868e-02; +7.165317489739466e-02   +5.957977954884730e-03   +9.301773507834732e-02   +7.860023765504680e-02   +5.440846189322754e-03   +8.408539455471575e-02   +6.707080046079501e-02   +8.775603945766985e-02   +4.092542878091848e-02   +9.551486105377531e-02   +2.771805928739824e-02   +5.483431675087894e-02   +5.259418862639673e-02   +5.644849127301554e-03   +9.515478478038177e-02   -1.353848605711325e-03];
L2E_L1E_iAMPA_netcon = [+9.061154111058703e-02   +3.125774791443030e-02   +1.254091850734100e-02   +1.086385159938111e-01   -1.319421095864718e-03   +5.208066190739419e-02   +6.788062957625278e-02   +7.822374660421275e-03; +1.049584641795009e-01   +9.534833050496366e-02   +6.254711303291451e-02   +4.349361850848812e-02   +5.212804362603117e-02   +2.152590461032997e-02   +1.018162769183320e-01   +4.390683946298350e-02; +1.158058549061703e-02   +1.834249003627458e-02   +2.953070178068897e-02   +1.865415815459863e-02   +6.693512346263275e-02   +8.817725959697817e-02   +3.729114772548528e-02   +3.598196151869099e-02; +2.678005424849229e-02   +8.098279697004143e-02   +1.952676926406961e-02   +7.545444422683481e-02   +8.877979093244898e-02   +3.430240728685060e-02   +9.842139145729591e-02   +9.871038488983766e-02; +2.013993906260486e-02   +1.092134490277610e-01   +1.485831352544228e-02   +2.125028926743187e-03   +9.925964729386029e-02   +1.043036477411769e-01   +7.663341655512211e-02   +4.326351936073575e-02; +7.933241187956339e-02   +6.007994611344272e-02   +1.007972908992522e-01   +8.676515509062230e-02   +7.058835240420611e-02   +2.532344559789650e-02   +8.364789790417775e-02   +7.056222427297121e-02; +1.040690247212518e-02   +3.278264341675221e-02   +2.677214310034999e-02   +4.555785061471036e-02   +9.624450302915191e-02   +5.071578411326391e-02   +2.031387117164995e-02   +3.527298978848523e-02; +9.458978063747613e-03   +1.828257190119163e-02   +5.951171413396757e-02   +7.025601250264850e-02   +3.966677563324964e-02   +1.015381515375943e-01   +1.041205658293518e-01   +9.938536857439567e-02; +4.206717354317478e-02   +1.000881706149576e-01   -1.555056544301363e-03   +3.369301106013531e-02   +2.072989926459792e-02   +1.101192298807785e-01   +6.350107061042677e-02   +1.018873302186327e-02; +3.051726797220708e-02   +2.637346960217653e-02   +9.551014873700127e-02   +4.274160815154781e-02   +9.209226187097590e-02   +9.602512241091918e-03   +1.901391347469426e-02   +1.044171394376994e-01; +5.892927061815934e-02   +4.971870248218725e-02   +1.602192215372090e-02   +6.527429224364373e-02   +4.314063521946346e-02   +4.052555254496632e-02   +6.307729246046626e-02   +9.629309532565945e-02; +2.427238653198796e-02   +5.518741108898667e-02   +8.815928733765897e-02   +7.905448699367494e-02   +7.204974094745706e-02   +2.324437752863662e-02   +1.067795491610376e-01   +2.875222867389032e-02; +6.083717295248862e-02   +9.001127880325635e-02   +2.546168260098625e-02   +4.565494138065708e-03   +1.071838332675257e-01   +7.679665243874852e-02   +4.470759466680553e-02   +9.145132124529951e-02; +4.491421083186607e-02   +5.429541276471355e-03   +8.570441632654774e-03   +8.123585208418925e-02   +5.431529584716246e-03   +3.043409396201960e-02   +8.625348147422201e-03   +8.533870802302931e-02; +3.287685450019440e-02   +1.795279448833970e-02   +6.335001396380869e-03   +8.932337476941046e-02   +1.221393873291017e-02   +9.538215306329430e-03   +4.985957557800110e-02   +2.202693247691472e-02; +1.321845374083598e-02   +5.285943360864550e-02   +7.141746200552124e-03   +6.215143615537055e-02   +2.662534047548740e-02   +6.404766072628294e-02   +7.891262114226489e-03   +9.231496858470072e-02];
L1E_L2E_iAMPA_netcon = [+4.144088033151212e-02   +2.307631342437735e-02   +1.046389569700526e-01   +1.029034084361755e-01   +3.371482785817385e-02   +1.006456439860469e-01   +5.310620081616974e-02   +1.046449154038777e-01   +2.017813534728909e-02   +7.015351308818765e-02   +6.499945801904579e-02   +8.101799965229756e-02   +4.097483337442600e-02   +7.123718935908586e-02   +5.600094488893482e-02   +5.135215868270664e-02; +4.366837102255373e-02   +6.360886557742639e-02   +2.118173749568998e-02   +8.442945770543570e-03   +1.209362942440711e-02   +7.175412875865296e-02   +4.275672046902234e-03   +3.450635315973147e-02   +3.122688137776981e-02   +3.300151487807295e-02   +2.577845404795385e-02   +1.066323286399349e-01   +1.511461368736718e-02   +2.324623746284176e-02   +6.463088441216139e-02   +3.150274055161910e-02; +4.095223430105067e-02   +6.504081265838843e-02   +9.378631311765809e-02   +9.923983692955927e-02   +1.003849212104567e-01   +1.048717966663279e-02   +3.304121756280534e-02   +4.553497983698090e-03   +4.581582844519842e-02   +6.812198183408628e-02   +3.822627581671344e-02   +5.892879839176003e-03   +7.484667510485289e-02   +6.370043452167293e-02   +9.497410056103318e-02   +9.105277902207594e-03; +7.715256703558922e-02   +6.793445434773083e-03   +2.352415392634545e-02   +1.816208593302059e-02   +7.664412874403256e-02   +3.421486633597090e-02   +1.059033183572006e-01   +9.603068609960193e-02   +8.402082143906968e-02   +8.525244207368696e-02   +4.876958322758809e-02   +6.091420047350726e-02   +1.041127788410797e-01   +3.567122941056093e-02   +1.000184222168859e-01   +1.012279041356760e-01; +2.029737268026833e-02   +1.043323403841893e-01   +9.111165218183993e-02   +6.484533380254245e-03   +2.380134573880813e-02   +8.388295596116001e-02   +9.405415755546265e-02   +1.829342689984246e-02   +6.070654753757659e-02   +4.560076374445307e-02   +6.418033942748622e-02   +8.457293919436240e-02   +2.893037645216412e-02   +6.465912260020297e-02   +1.084022334692514e-01   +2.447776876130053e-03; +5.683617125873251e-03   +1.007111652521090e-01   +3.711951807182184e-02   +9.213633182589973e-02   +1.068158531206346e-01   +9.673094265431323e-02   +5.138991131592875e-02   +9.683613674211088e-02   +3.732237669171393e-02   +4.485346509825197e-02   +9.588883743392146e-02   +1.018596615101359e-01   +8.839771256772992e-02   +6.669538601701956e-02   +1.714954207852847e-02   +6.388415451600174e-02; +3.516382322668649e-02   +2.028766871352963e-02   +6.742321641278998e-02   +2.380469344248794e-03   +4.467521303617912e-02   +5.647543608754416e-02   +8.212384435138451e-02   +6.310597418311033e-02   +6.067616366664419e-02   +8.643623390688554e-02   +7.167126388904164e-02   +1.219106054338322e-02   +4.590148459369535e-02   +6.505169618380259e-02   +2.086359411304790e-02   +3.356039172348761e-02; +6.479250976349065e-03   +5.925152087135364e-02   +5.039024059056564e-02   +4.395749265201562e-02   +7.767668075477126e-02   +1.083907147572018e-01   +1.056036892991410e-01   +6.737480822345931e-02   +9.523644937555038e-02   +4.693028546388948e-02   +4.020553031341398e-02   +1.072931191518067e-01   +7.635125511462791e-02   +9.469610048800217e-02   +3.034787055652979e-02   +1.418364788869172e-02];
L2I_L2E_iAMPA_netcon = [+7.348713353861606e-02   +3.372058160541078e-02   +9.480173275986775e-02   +4.637726727333731e-02   +8.646677619884807e-02   +4.049432824400499e-03   -4.257743237405087e-05   +9.810361136253383e-02; +1.783892003580688e-02   +1.965519440842664e-02   +1.952246728504055e-02   +8.493559809892062e-02   +8.655781012057019e-02   +3.847496364340529e-02   +7.744432521625502e-02   +5.107113661535568e-02; +9.127503013146401e-02   +8.418355760883028e-02   +9.115200293701890e-02   +7.566207426196810e-02   +5.665743527540065e-02   +6.340290326833607e-02   +5.098880238311944e-02   +7.964379517252296e-02; +4.104265275552617e-02   +2.213304948751728e-02   +9.708053964818551e-02   +4.917415984654043e-02   +1.090877411435323e-01   +1.826188580936437e-02   +4.916410170267379e-02   +9.541360948393386e-02; +7.072226088131067e-02   +9.558596800135580e-02   +6.490829159810009e-02   +6.511824778954475e-02   +9.975929095950985e-02   +8.489857794945471e-02   +4.472919755932658e-02   +8.340191195592704e-02; +6.273966040963098e-02   +4.074787938078955e-03   +9.586463040185279e-02   +8.262460904918517e-02   +6.346297033905303e-02   +2.485248527314116e-02   +1.336971659756005e-02   +7.642519839024828e-02; +1.096273638194239e-01   +5.423692779213558e-02   +1.384362915059580e-02   -2.155685505472065e-04   +1.763190918093990e-02   +2.804534832953346e-02   +2.123202750822125e-02   +2.502200539925104e-02; +1.052796109820544e-01   +2.898500867077114e-02   +6.000629177582989e-02   +5.480516431213727e-02   +9.467721413243445e-02   +2.845222606962244e-02   +9.218653289281424e-03   +1.017442566166032e-02];
L2E_L2I_iGABA_netcon = [+9.931665622450803e-02   +1.866400005626267e-02   +2.153125330328448e-02   +1.745374375103203e-02   +7.077930706797576e-02   +4.279146430985904e-02   +8.601100570646292e-02   +1.012828367893062e-01; +2.546123878541597e-02   +4.280499907322387e-02   +1.450064518860872e-02   +4.770332869838426e-03   +1.099048256718208e-01   +7.545175499012378e-02   +8.368255163720710e-02   +7.171089130237843e-03; +7.433172396765016e-02   +3.936214869567299e-02   +5.923786841307411e-02   +1.124454150558918e-02   +3.795745004677989e-02   +5.700586387504565e-03   +9.904879414968636e-02   +8.983654470785712e-02; +9.061207453370677e-02   +4.618662933099277e-03   +2.917717864185112e-02   +7.985523403563165e-02   +9.823022762793714e-02   +7.143063227947402e-02   +4.955693308973897e-02   +6.936424496419320e-02; +1.500557234600204e-02   +9.590817480691706e-02   +6.651552116250887e-03   +8.927785804666276e-02   +3.482451292760587e-02   +3.942572710348691e-02   +8.595218557482095e-05   +2.729532119324022e-02; +8.107353088522642e-02   +1.674494539931484e-03   +5.643254420807087e-02   +8.781940597672683e-02   +1.000772392047185e-01   +3.160728776823340e-02   +9.972836125603907e-02   +8.364969086732379e-02; +1.731316779972485e-02   +1.082111731772311e-01   +3.178646355523662e-02   +6.617123910014236e-04   +8.425445241772980e-02   +5.294563601189653e-02   +6.599108595309787e-02   +6.257010466259830e-02; +9.139145710190368e-02   +3.497924742676796e-02   +5.824371750727662e-02   +2.268976467068620e-02   +4.760932802567638e-02   +8.769053908459647e-02   +1.038706687139490e-01   +7.067820281716951e-02];
L3E_L2E_iAMPA_netcon = [+3.665434409715716e-02   +7.504341978368899e-02   +9.417453973657777e-03   +7.772584803272491e-03   -1.691507012076834e-03   +1.035245107565328e-01   +4.078531883244685e-02   +9.618167824925217e-02   +1.459925307690310e-02   +2.703658480531103e-02   +2.785408131547969e-02   +1.221699215004725e-02; +3.138314096655714e-02   +9.759903002380028e-02   +3.111604565722772e-02   +4.091135421167948e-02   +5.119832501016072e-02   +5.958172647575154e-02   +9.551898785513631e-02   +1.081512257411137e-01   +6.727140227131354e-02   +1.029693038061088e-01   +3.532133547219987e-02   +2.940649569200168e-02; +1.138079072076102e-02   +8.835531360450281e-02   +1.602338460388667e-02   +8.059378901588791e-02   -1.769522998306516e-04   +9.287910399992465e-04   +6.237004732586823e-02   +1.090120991551508e-01   +6.619416317765164e-02   +6.291805198767471e-02   +2.903916997722760e-02   +7.521954091735523e-02; +6.493153845048790e-03   +2.171804664740491e-02   +8.578199189949581e-02   +3.202411767390505e-02   +2.959766756638172e-02   +9.016819785515767e-04   +3.741301286513334e-02   +5.687623159597647e-03   +2.352834370701204e-02   +3.650761814889029e-02   +2.093158609147210e-02   +3.447422016541932e-02; +9.796865213076582e-02   +4.204494388343036e-02   +4.042806503652449e-02   +1.033170736829760e-01   +7.609179028158657e-02   +4.095982737304231e-02   +1.050197558178071e-01   +1.947822719010877e-02   +9.219703590781969e-02   +5.220286061727599e-02   +7.945270167806413e-02   +3.731604687462300e-02; +9.640505156953215e-02   +6.947522516144637e-02   +1.208826787160094e-02   +4.827809136076820e-02   +6.753079609852479e-02   +1.127812705996895e-01   +1.023962047180480e-01   +3.545264337295058e-02   +5.192350151373227e-02   -4.084802753213261e-03   +6.876504326347435e-02   +2.583732693954521e-02; +6.736933112546672e-02   +5.236448174607075e-02   +7.204898503165652e-02   +3.233780274704528e-02   +2.124599401345749e-03   +4.090054564682778e-02   +1.847821777063718e-05   +3.859363430167145e-02   +3.749911978560466e-02   +9.028058654377252e-03   +3.264381779706634e-03   +4.518426021326258e-02; +9.288571632434252e-02   +1.706951376548094e-02   +4.986446986771443e-04   +3.159231863340153e-02   +5.884706902299469e-02   +1.026106499870155e-02   +7.103711189425191e-03   +4.961628990321346e-02   +5.767058149163912e-02   +9.257550188897903e-02   +7.334508575492778e-03   +6.589605366037293e-02];
L3I_L2I_iGABA_netcon = [+1.058950866621048e-01   +6.050381634737530e-02   +6.368631250668109e-02   +3.546431478817119e-02   +1.013986211824949e-01   +4.534455471837709e-02   +7.068274414725724e-03   +4.941958038728818e-03   +9.759358680098065e-02   +4.894863987706987e-02   +7.516369738285994e-03   +8.664369684775376e-02; +9.717116453086690e-02   +1.048491815449148e-01   +9.077985869425918e-02   +1.589327619708483e-02   +5.259476703917727e-02   +8.848473601005787e-02   +8.506559090950327e-03   +1.688398121444031e-02   +5.042899600678515e-02   +7.455037056054675e-02   +1.276726452368585e-02   +6.867285998212698e-02; +8.255082833451969e-03   +9.480921917623565e-02   +1.066287835402638e-01   +6.140813041508133e-04   +7.376937362313496e-02   -8.965050095869785e-04   +7.132537847227073e-02   +1.000581890010363e-01   +7.708749316701452e-02   +2.552129501039946e-03   +7.242852663328543e-02   +1.404468765305046e-02; +1.057928400705178e-01   -7.522403630404017e-04   +6.265396882640446e-03   +6.994337221391238e-02   +9.629852978389414e-02   +6.395778909991423e-02   -3.361584295076001e-03   +6.595725268752583e-03   +9.977489799819481e-02   +8.608848614615720e-02   +1.067039987029662e-01   +5.887100066560420e-02; +2.123405909821157e-02   +1.070099936869085e-01   +4.328482312520213e-02   +4.450572341435982e-02   +6.337254055594076e-02   +1.032180343803365e-01   +4.065902435864213e-02   +1.582772726786642e-02   +1.067030607001920e-01   +5.550796082064646e-02   +2.880181921890433e-02   +1.792803566723971e-02; +2.575983194966393e-03   +7.716501228844824e-02   +2.340485475061475e-02   +3.076200060655567e-03   +1.493780834049973e-02   +6.929476029714866e-02   +8.114422062723800e-02   +2.102458123759780e-02   +6.045527448821579e-03   +8.369739157010793e-02   +9.190207159728495e-02   +4.782364713450196e-03; +6.909634290079684e-02   +1.014901539895183e-01   +5.881657836839754e-02   +7.199662137592565e-02   +4.812519783418198e-02   +2.575717999914049e-02   +7.130956985755646e-02   +5.937966496264374e-03   +9.945746885027938e-02   +3.814545855420703e-02   +5.089869007365835e-02   +8.090877690916772e-02; +5.339042205174128e-02   +2.432505492123979e-02   +3.601222126613256e-02   +6.579367519324143e-02   +4.073870167419731e-02   +1.391331178723278e-02   +2.676368791358796e-02   +3.105502772884139e-02   +6.345261461447260e-02   +1.060213245946816e-01   +2.826972744718098e-02   +3.002475165138785e-02];
L2E_L3E_iAMPA_netcon = [+6.802550158864931e-02   +7.510354226639078e-02   +2.698433718217208e-02   +9.034353224409515e-02   +8.943958569276045e-03   +5.907211217100146e-02   +7.675339038516199e-02   +1.073621420215239e-01; +5.594601717009794e-02   +7.494064241382364e-02   +8.199253772487977e-02   +8.868332717884031e-02   +2.591774574899044e-03   +5.951201003437198e-02   +9.013433505257994e-02   +7.158691495657256e-02; +8.620128404228504e-02   +9.560989363127106e-02   +9.364260023448026e-02   +1.038223020674036e-01   +6.313450176097481e-02   +7.163739035374719e-02   +9.833077963756846e-02   +6.516056838433845e-02; +4.108243413024168e-02   +1.047364127553672e-01   +9.064436896477843e-02   +6.888716251417501e-02   +5.289078107004864e-02   +6.009873290879611e-02   +2.879932770531454e-02   +1.711371594192438e-02; +1.066089449303264e-02   +6.174135875316393e-02   +2.958334322006642e-02   +4.836401951682644e-03   +1.807007487369817e-02   +5.802783236761538e-02   +9.775322004308887e-02   +8.609897863252476e-02; +5.249940019043142e-02   +1.140128158329137e-01   +9.603013268755199e-02   +5.959260895760998e-02   +5.874515531731544e-02   +1.035250176777453e-01   +7.799022464785534e-02   +1.063938209877073e-01; +5.465166955996957e-02   +8.552516490695064e-03   +5.571731031028882e-02   +4.707418304140658e-03   +3.854828923660483e-02   +9.071419721261016e-02   +3.775970593164603e-02   +8.630255754120537e-02; +9.740977909588498e-02   +7.297233414512104e-02   +5.371162104523258e-02   +8.675238537131574e-02   +4.024035111761209e-02   +8.550369139082580e-02   +5.300866737990478e-02   +3.816631437612363e-02; +5.093030728576768e-02   +5.659792823984426e-02   +1.035722263970123e-01   +6.376059838992200e-02   +6.573737139750101e-02   +3.740493141533000e-02   +6.033980040532398e-02   +7.176058559168716e-02; +2.432531643400493e-02   +1.877668032673968e-02   +8.609882227645434e-02   +9.250886373265953e-02   +1.022875661300412e-01   -3.656743852885629e-05   +1.204847443938500e-02   +6.987184288255473e-02; +6.622149015403324e-02   +2.998473464856766e-02   +8.189624462125447e-02   +8.822840465500295e-02   +1.002341575019548e-01   +1.119631051545451e-01   +2.603143579282448e-02   +3.607714964844631e-02; +1.276072608505314e-02   +6.175685577813865e-02   +4.685231233753973e-02   +9.732353764151157e-02   +5.286153910623829e-02   +2.322754838668110e-02   +6.766954039243653e-02   +9.607900444532208e-02];
L2I_L3I_iGABA_netcon = [+1.026929488655003e-01   +4.730622756577422e-02   +2.647906895097163e-02   +7.597332499846100e-02   +8.251387889808366e-02   +9.593931267537875e-02   -7.322210252752315e-04   +5.565929698900994e-02; +5.858484383794854e-02   +4.690478743246101e-02   +8.037269291274933e-02   +1.779073103630380e-02   +9.634882527159871e-02   +9.037608848902724e-02   +5.275875409856036e-02   +2.960684324902784e-02; +8.507095549707794e-02   +7.891649103796970e-02   +1.035879939100573e-01   +6.309068674559999e-02   +3.786838542728997e-02   +6.736655321939805e-02   +5.126734729662169e-02   +1.543240585223899e-02; +2.351682819389019e-02   +8.900823289321291e-02   +2.510233522328547e-02   +5.035734945761530e-02   +7.842559132061600e-03   +3.459967097119858e-02   +4.549958991654014e-02   +1.141014178478742e-01; +3.437308336051306e-02   +3.876392356602214e-02   +5.600206014171883e-02   +4.915640067558542e-02   +4.411956768772803e-02   +7.279387175666140e-02   +1.268980617293343e-02   +1.834103297199930e-02; +1.637461800570196e-03   +3.060020324021511e-02   +3.966166686113674e-02   +1.706933624659833e-02   +3.902759050437249e-02   +4.551171415503717e-02   +5.732806720885260e-02   +7.964633809002533e-02; +3.927481340748501e-02   +5.309939082604337e-02   +1.033486123941776e-01   +6.921374393135961e-02   +8.515895912291681e-02   +3.082822527091838e-02   +3.852313017988501e-02   +3.720859843657531e-02; +8.545920049294184e-04   +1.117276728102567e-01   +3.205807445957259e-02   +9.305191656402642e-02   -1.180277442789043e-03   +8.094280002402385e-02   +5.983608311563231e-02   +8.398274671626603e-02; +9.727500128409924e-02   +3.736861608343829e-02   +9.038665384789134e-02   +8.912807694076652e-03   +5.523916481092797e-02   +3.290008899346662e-02   +4.346283737979412e-02   +4.664290646846043e-02; +8.193338014184863e-02   +5.726883477917508e-02   +2.390325206506874e-02   +5.753517720673020e-02   +6.876199333903810e-02   +3.628866358481211e-02   +2.010503986062398e-02   +3.754495536265533e-02; +8.169956077959459e-02   +1.046582914484931e-01   +6.360919342587437e-02   +7.165645397112895e-02   +3.709316608600404e-02   +4.402523460429446e-02   +9.573068860578383e-02   +1.642738768919372e-02; +7.786298025651538e-02   -2.128817339382956e-03   +4.140995646580971e-02   +1.986166560048394e-02   +1.445519971200812e-02   +1.071557068058667e-01   +5.484126540133052e-02   +6.130387959978608e-02];
L3I_L3E_iAMPA_netcon = [+5.309076296910142e-02   +1.070075943204221e-01   +2.999085807949970e-02   +6.352313416696083e-02   +8.381116549984249e-02   +3.898151705370567e-02   +3.450001503722311e-02   +2.424042560597598e-02   +3.451242439421403e-02   +2.949995123677551e-02   +2.667802088338593e-02   +5.341267828722560e-03; +4.333914515294075e-02   +8.745891445551579e-02   +3.001780948907762e-02   +1.019511222837356e-02   +7.360124045131808e-03   +6.016276114703096e-02   +6.081131241146535e-02   +5.579500009191288e-02   +2.084557139017907e-02   +5.264306665576864e-02   +7.786575739758396e-02   +5.827458438554723e-02; +3.911786028509712e-03   +6.602782401694335e-02   +5.713923176025591e-02   +6.379979339588029e-02   +5.710010018281133e-02   +5.033912806052716e-02   +5.325376453971338e-02   +5.083221734106216e-02   +4.625577549626654e-02   +6.054690651570283e-02   +4.616124913005876e-02   +6.071210737282902e-02; +4.605115361647822e-02   +8.554560975340320e-02   +7.329505953582008e-02   +5.370638388466865e-02   +4.867514327127787e-02   +9.762717944923197e-02   +8.383248691376399e-02   +1.719469376147932e-02   +9.969487614956617e-02   +1.005505094359435e-01   +2.535138969848105e-02   +7.997567580180459e-02; +1.374125520345522e-02   +4.308263629415097e-02   +8.445171808760170e-03   +9.030578098094051e-02   +8.607317210375989e-02   +6.481575854302844e-02   +1.067169174161036e-01   +5.636430434084747e-03   +1.083188931783003e-01   +6.763684097086414e-02   +3.654736663208637e-02   +1.373287781443995e-02; +4.093363973341504e-02   +6.163466163385738e-02   +9.066902129692314e-02   +4.814459003791883e-02   +1.064535849231640e-01   +3.409378451116329e-03   +9.614153848605948e-02   +3.548640825416617e-02   +7.520715060245696e-02   +6.693711434754375e-03   +3.949904860583466e-02   +1.672056400686626e-02; +8.634810389482551e-02   +4.536663758501493e-02   +4.005152781004963e-02   +3.082548102834981e-02   +7.260986822239598e-02   +1.726381031211804e-02   +6.087827163318592e-02   +9.959091693751834e-02   +8.889160431446090e-02   +1.059764129881735e-01   +6.180185606745307e-02   +7.798003916682358e-02; +7.748134187606993e-02   +2.199995338106940e-02   +7.670759442344752e-02   +6.974695577817620e-02   +1.092173237092905e-01   +6.130559755242462e-02   +6.859178835247393e-03   +5.331608771145080e-02   +5.069101984173457e-02   +3.379089182123358e-02   +2.416683410043620e-02   +1.007492912790374e-01; +1.419182660470970e-02   +9.550661713961128e-02   +7.450265256141986e-02   +8.571313985988908e-02   +4.282914072233813e-02   +8.700048597863720e-02   +1.813187480950786e-02   +8.692249964550805e-02   +8.714430170858631e-02   +5.193617751249995e-02   +2.682778728940437e-02   +2.028223377081393e-02; +9.600950258041142e-02   +9.256736533912356e-02   +4.614978063690372e-02   +2.419180083768093e-02   +5.880217459550825e-02   +9.036715817234595e-02   +6.091316820203060e-02   +9.746417961514611e-02   +7.888999315144005e-02   +4.240487261035242e-02   +9.386616320348075e-02   +2.505782926283454e-02; +4.823929120809904e-02   +3.701995075938610e-02   +1.060254960335935e-01   +1.010184760482921e-01   +3.786035782263981e-03   +6.247777001293361e-02   +4.771272521779545e-03   +2.631493660214117e-02   +7.495233081920401e-03   +9.990290606446486e-02   +8.412081246904257e-02   +4.490663624754817e-02; +3.655625802791761e-03   +1.880002810540251e-02   +6.706273644514454e-03   +5.176874866857849e-02   +5.161040078540365e-02   +2.736824785270550e-02   +8.588295809774685e-02   +2.305148005723870e-02   +3.722934218338771e-02   +2.653655349054202e-02   +8.481817605744531e-02   +3.424491032251074e-02];
L3E_L3I_iGABA_netcon = [+1.527862081657838e-02   +4.544585820386669e-02   +3.422112334409592e-02   +1.033592690738170e-01   +8.592714064250591e-02   +6.098044132052875e-02   +3.739580541803086e-02   +8.514016002930486e-02   +6.468910245683847e-02   +7.640842474210796e-02   +6.259708432361563e-02   +2.938996820117434e-02; +8.443110697696905e-02   +7.241943446717834e-02   +3.892011274484310e-02   -6.558458525157810e-04   +3.681170902865135e-02   +8.273867354868511e-02   +7.002847458626588e-02   +1.055275086853328e-01   +8.856366334855914e-02   +4.307246181792416e-02   +1.488452901648200e-02   -9.517108370816842e-04; +6.046223058207314e-02   +1.071625872754493e-01   +1.074900507071466e-01   +9.236229745064208e-02   +1.454999556736960e-03   +8.412273281628591e-02   +6.763210857402387e-02   +7.498909367580919e-02   +4.752772880408646e-02   +4.513536399618832e-02   +2.960262371149528e-02   +1.474484559694980e-02; +4.635434213430051e-02   -1.256561303137189e-03   +2.318913813000166e-02   +8.078096906943948e-02   +8.179457250486780e-02   +3.248990351834782e-02   +4.821444128579294e-02   +4.356474253670835e-02   +1.059703382725167e-01   +4.847333753251584e-02   +8.626452253523095e-03   +7.452928692697010e-02; +4.717733370814491e-02   +4.862674520193661e-02   +1.163590459258488e-01   +2.165195596948269e-02   +5.886457885989540e-02   +8.905540973368314e-02   +1.109812139390343e-01   +1.025871240954800e-01   +2.751279157531134e-02   +6.394429898785806e-02   +9.640087427934567e-02   +5.036841222774621e-03; +7.413028107728574e-02   +5.174520235982904e-02   +8.841457918693268e-02   +1.867875912316296e-03   +6.755819986209779e-03   +1.103507803728111e-01   +7.888255412694839e-03   +1.515307258947148e-03   +8.451604137947517e-02   +6.677335740282642e-02   +2.308024672319828e-02   +2.536090642576961e-02; +5.926312637164927e-02   +3.881912122756950e-02   +5.722522784934359e-02   +6.379501479226946e-02   +7.337296443794855e-02   +5.849155068933789e-02   +3.891687264758668e-02   +5.220519201312722e-03   +4.137712798228075e-02   +1.609190541914710e-02   +3.545029562996336e-02   +7.473388004962646e-02; +2.952861536070058e-02   +1.135137039680424e-02   +1.554568988396822e-02   +1.032984649027082e-01   +4.785927151280363e-02   +8.588482583530190e-02   +5.532977834799713e-02   +8.618818812771192e-02   +8.502856153795969e-02   +9.707304501737844e-02   +1.793740036830922e-02   +6.910613037961000e-02; +2.852472401958014e-02   +1.951852298878421e-02   +9.050790479607515e-02   +2.298068247720152e-03   +1.084078740530607e-01   +9.840635339432599e-02   +1.817430096474665e-02   +8.082069237206359e-02   +2.255098431922729e-02   +3.595459209963095e-02   +5.126008125289898e-02   +6.631626336805997e-02; +8.909087803102511e-02   +4.036680348524238e-02   +9.412591697448618e-02   +3.503419259541108e-02   +4.654904833641028e-02   +1.043187827683923e-01   +7.669166897320662e-02   +6.179152197964068e-02   +9.793974278368818e-02   +1.036319162031742e-01   +2.072293505081918e-02   -1.428504924371187e-03; +6.085266400489010e-02   +1.625423989620010e-02   +2.467136103342345e-02   +2.654476402930177e-02   +7.992306660865951e-02   +5.508858037028375e-02   +1.012254708807252e-01   +7.084387585469526e-02   +5.960950147952433e-02   +1.890794599252986e-02   +9.539983248670567e-03   +8.492408645621605e-02; +7.097903924784667e-02   +5.963344419332361e-02   +1.045461378894461e-01   +7.592288562515410e-02   +7.052432483281852e-03   +5.248521221750620e-02   +1.051178007897107e-01   +8.007451773136071e-03   +8.060486753936374e-02   +4.620280916739793e-02   +5.411479340932154e-02   +4.314889525262391e-02];
L2E_Input1_iAMPA_netcon = [+1.099716638806618e-01   +1.068718408884652e-01   +1.079064693273969e-01   +1.080551878233265e-01   +1.127651019176563e-01   +1.203009797349932e-01   +1.106351587611793e-01   +1.070658218768764e-01];
L2I_Input2_iAMPA_netcon = [+1.077499724106735e-01   +1.158712113511964e-01   +1.124975005431660e-01   +1.097458956123711e-01   +1.050947223915885e-01   +1.093575875784702e-01   +1.141200943265244e-01   +1.031001544361023e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
