function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.089698479175505e-01   +1.228522578929887e-01   +1.061848069287378e-01   +6.422342832998744e-02   +2.115631849208061e-01   +6.462925408884171e-02   +1.273323885961875e-01   +1.071821065725968e-01   +4.258956288354648e-02   +9.676333845926237e-02   +3.180011274039452e-01   +2.724971675442533e-01   +9.347411470070618e-02   +1.351322068538603e-01   +2.308550376716132e-01   -2.392119941056503e-02; +8.661293006138263e-02   +3.741748899636885e-02   +9.253103563622295e-02   +2.159386797534537e-01   +6.756385331899303e-02   +2.441601753309217e-01   +1.218705297614141e-01   +9.406054008718549e-02   +1.133810491140625e-01   +1.015750390027469e-01   +9.599759870370045e-02   +4.596519898969685e-03   +2.219022566307733e-01   +1.137172079752442e-01   +1.610702059417723e-01   +1.672623264166145e-01; +2.097728205970683e-01   +7.777823242146067e-02   +9.691899671420795e-02   +4.238076862481573e-02   +7.556579657510765e-02   +7.125890854702306e-02   +1.420609346178514e-01   +8.272171217396668e-02   +6.155700890740535e-02   +2.590054412617214e-01   +1.779328281577941e-02   +1.671421581079434e-01   +3.262294482328456e-02   +1.520317523308228e-01   +1.018423794131975e-01   +1.822886535674032e-01; +1.830477883387666e-01   +2.343569134378337e-01   +2.260762918694475e-01   +2.479891901196378e-01   +1.909048834087678e-01   +1.022951261467196e-01   +1.111414765673401e-01   +2.419210934009095e-01   +6.663966193540113e-02   +1.511488340111626e-01   +1.409995818564531e-02   -6.364354529046254e-02   +1.471400617717961e-01   +1.668375620460805e-02   +2.380095003580635e-01   +6.622217267204411e-03; +5.739294116190675e-02   +1.367987762463805e-01   +2.634114558620694e-01   +1.364894162230093e-01   -2.608270948526164e-02   +4.588609633030857e-03   +2.167965706169382e-01   +1.277886242605828e-01   +9.670889103970007e-02   +1.560841429592638e-02   +6.582670922239220e-02   +5.217871759812427e-02   +1.724211003429564e-01   +1.475255687140050e-01   +2.156344925018800e-01   +2.520128998918534e-01; +1.168091710894891e-01   +1.625612501336597e-01   +8.322079696595153e-02   +2.318153649488761e-01   +1.625819640986739e-02   -2.036121598352442e-02   +1.050763001181938e-01   +1.410017141678554e-01   +1.769745273792533e-01   +1.126189507441645e-01   +2.428880323042160e-01   +2.478294716372415e-01   +4.628823303855781e-02   +1.785531926299156e-01   +9.010928790649163e-02   +1.033134824632380e-01; +5.426182277552545e-03   +5.910498145167105e-02   +1.369935105911319e-01   +2.491753701961962e-01   +1.111808071187830e-01   +3.515297269551948e-02   +1.486160474421783e-01   +2.108245162045326e-02   +2.306545875120643e-01   +6.749299199588538e-02   +2.474774525804437e-02   +1.861599489137504e-01   +4.300049164729593e-02   +1.448892463711317e-01   +1.484766806213113e-01   +1.351131917298838e-01; +1.989824939561583e-01   +3.442346299820961e-02   +5.025266769506730e-02   +2.948551586180368e-02   +4.705577014786684e-02   +2.853554726017852e-01   +6.609638979676855e-02   +7.961971743638319e-02   +2.974867114774283e-02   +6.620299957447009e-02   +1.191598014226626e-01   +1.179910067822733e-01   +1.029296397501051e-01   +2.175460639359409e-01   +2.722015850844865e-02   +1.570388943326022e-02; +1.557630877146863e-01   +2.173931295204131e-02   +1.046591258333573e-01   +1.774199644646508e-01   +1.703222311033768e-01   +2.041531549570035e-02   +3.392930998398833e-02   +5.514808245080060e-02   +1.620146446634758e-01   +1.805907573945722e-02   +1.952258972521151e-01   +3.750558147614516e-02   +9.020249295578055e-02   +9.777837530263207e-02   +1.290361080784856e-01   +7.435384344303497e-02; +1.363141512171751e-01   +1.549431877269477e-01   +1.575600404761767e-01   +1.365954986091831e-01   +2.142029950502965e-01   +2.386750639806671e-01   +7.220036789109283e-02   -1.370486791647150e-02   +7.049863903777452e-02   +2.311719616468778e-01   +1.397508836661047e-01   +1.085698703390927e-01   +2.807176738314022e-01   +1.875987161708843e-01   +1.607745906510348e-01   +2.703542624203157e-02; +6.573853024418255e-02   -6.669803061542618e-03   +2.255680365280064e-01   +1.038983483129514e-01   +1.178483948762547e-01   +3.060412248494238e-01   +1.513295966770770e-01   +5.375812705306466e-02   +5.896643667080234e-02   +9.515081535240763e-02   -4.172517444218409e-02   +1.224777309306445e-01   +7.434091935716207e-02   +7.903885674332325e-02   +2.243938907857731e-01   +7.060983657804219e-02; +5.235457445199447e-02   +8.301607840327863e-02   +1.061614533051708e-02   +1.442006564767988e-01   +1.359575499758066e-01   -1.665502747008366e-02   +2.890350853640636e-01   +2.233601196033998e-01   +1.565610504847743e-01   +1.259034550489077e-01   +1.128540431243087e-01   +1.932984015834606e-01   +1.395305501022783e-01   +1.553872920946975e-01   +2.132725990825258e-01   +2.489375049177807e-01; +2.585875753550647e-01   +2.198232026585738e-01   +1.174155195698600e-01   +6.346630012348548e-04   +1.346860228453196e-01   +1.115945958449119e-01   +1.645101537474007e-01   -3.205524865550593e-03   +2.025597417208725e-01   +2.368722669973270e-01   +2.124861739512633e-01   +2.515614264589490e-02   +9.803431663918348e-02   +1.255431477131482e-01   +1.933221929858063e-01   +9.521973089370316e-02; +1.987903512766763e-01   +7.196436546063920e-02   +1.432185269799242e-01   +2.129548354590693e-01   +2.170896309807287e-01   +8.699492600564071e-02   +1.054928008084143e-01   +8.053911543280573e-02   +1.782647268421864e-01   +1.319653482939379e-01   +2.254934108070514e-01   +2.495780596620369e-01   +1.623801964209009e-01   +2.359886359969501e-01   +2.673748429137668e-01   +7.858222483819456e-02; +1.992035469789487e-01   +8.464215185657428e-02   +1.875754724575884e-01   +2.171946823877103e-01   +1.616332587159073e-01   -1.039722864603546e-02   +1.984914705811405e-01   +7.814748870756993e-02   +1.555745541590114e-01   +1.348897110343345e-01   +6.395646404985297e-02   -3.034554142207786e-02   +2.261616335195962e-01   -2.424254672507644e-03   +1.288261271584415e-01   +2.387384437060615e-01; +2.734429483209050e-01   +1.647687592800915e-01   +2.334142370772790e-01   +1.203257629670631e-02   +1.780964368932456e-01   +1.501754883518954e-01   +1.490146846955283e-01   +1.687848892493964e-01   +1.676589615212629e-01   +5.936320478764199e-02   +5.824054178426784e-02   +3.458414185253904e-02   +4.783483504139022e-02   +2.206041820424297e-02   +1.889498367795979e-01   +1.919339725375976e-01];
L1E_L1I_iGABA_netcon = [+4.808343061892999e-02   +2.963753128499366e-01   +2.693153453424444e-01   +1.927895041799788e-01   +2.200739335682662e-01   +1.400943932746840e-01   +2.238441536828880e-01   +2.377027139045397e-02   +2.683937814447601e-01   +1.335602140694222e-02   +2.359059887832333e-01   +8.071942980615328e-02   +6.766888943899738e-02   +2.451645041613791e-01   +1.480025435995059e-01   +2.358528531314793e-01; +1.995955337405082e-01   +1.258234770382072e-01   +1.427022979390725e-01   +3.989744979443845e-02   -3.809438259951860e-02   +1.197663581285585e-01   +1.108363869866944e-01   +1.779578518936496e-01   -5.341526529052419e-02   +2.764616299162545e-03   +2.602714351880320e-01   +7.805903407116821e-02   +1.313923879742801e-01   +1.304092577021520e-01   +6.448536351856236e-02   +1.295914723230358e-01; +1.494009712554658e-02   +1.739451615867910e-01   +9.488227745729304e-02   +9.743354949314163e-02   +3.373721495843141e-02   +3.493241164937286e-02   +1.173780668632147e-01   +1.607665607370716e-01   +1.067986008282927e-02   +4.258898940561819e-02   +1.757682724181197e-01   +1.220895570831703e-01   +1.220077803356336e-01   -2.978891304301806e-02   +1.353127716841465e-01   +1.895438931631552e-01; +6.992482815958025e-02   +1.150697066405017e-01   +1.999554870090455e-01   +1.301867338293396e-01   +1.449985692860167e-01   +2.526634105270865e-01   +1.753822631699469e-01   -1.486807083371973e-02   +1.249969861734110e-01   +2.223554456346301e-01   +1.484969500937859e-01   +2.293521759347821e-01   +6.561951226633687e-02   +1.610418709603806e-01   +1.766166646373495e-02   +9.422981115036252e-02; +1.284331941292940e-01   +2.097000057424995e-01   +2.530475517898433e-01   +2.387440623294603e-01   +8.064240549574946e-02   +9.631842847299986e-02   +1.487834791057717e-01   +2.104720197650456e-01   +2.249021328897842e-01   +1.848368197470871e-01   +2.507105751994970e-01   +1.469691485059343e-01   +5.711122185470122e-02   -7.782600310580416e-03   +6.327242332265670e-02   +2.626402470305459e-01; +2.205177532392907e-01   +1.386850462998565e-01   +1.421056317477868e-01   +1.741766118566252e-01   +1.556265426390074e-01   +2.200885180250366e-02   +4.243123030780858e-02   +3.901087842418918e-02   +2.645904785936927e-01   +1.297876265522159e-01   +2.170589861270725e-01   -5.094020146359385e-02   +1.241794720626837e-01   +2.641949811351719e-02   +9.750457693669468e-02   +1.109681406982956e-01; +2.735729386077010e-02   +2.203883971203668e-01   +2.658111060092083e-01   +7.643593888020501e-02   +1.144554027622640e-01   +2.431930696024623e-02   +2.357700423392506e-01   +2.358972256292257e-01   -7.829543595347518e-02   +1.806077650487421e-01   +3.426657457184350e-02   +1.406071236935481e-01   +1.522252521705891e-01   +1.606004163670044e-01   +6.741724626929230e-02   -4.491495730111070e-03; +1.318705023863968e-02   +1.477319039214870e-01   +1.145751178541396e-01   +8.796396446606385e-02   +1.041723259364715e-01   +3.842176545251064e-02   +7.136804158282639e-02   +1.059827466909055e-02   +1.784377430850496e-01   +1.369283191935508e-01   +3.123772844272378e-02   +9.377611989603100e-02   +7.112286827036415e-02   +9.634316193729203e-02   -2.816583466444814e-03   +2.887073958529766e-01; +1.370474034214559e-01   +2.399990195074387e-01   +2.564540198339654e-01   +1.205811759825200e-01   +8.704778723133082e-02   +1.154648144523643e-02   +2.302399469995786e-02   +3.493165288742726e-02   +1.752284552893583e-01   -4.348299213781423e-03   +4.509776473951944e-02   +1.812406110810785e-01   +1.499561748018410e-01   +1.460573944534521e-01   +2.559533106704425e-01   +1.842219159756718e-01; +9.809424886682216e-02   +2.145313908678816e-01   +1.873109324312747e-02   +6.089752208084089e-02   +3.647041228123620e-02   +1.382399032857476e-01   +1.444067423121271e-01   +9.286746844880411e-02   +2.047524957498348e-01   +5.704978858739507e-02   +1.138039417370173e-01   +7.544097620748935e-02   +1.901174341058573e-01   +2.198685871789176e-01   +1.641192773813497e-01   +1.493188832977853e-01; +1.644630542595083e-01   +1.059804575811288e-01   +7.876957414158194e-02   +7.565861820380314e-02   +2.158385667787998e-01   +2.558924267200932e-01   +2.011846471475233e-01   +2.080188729326503e-01   +1.091522846530900e-01   +9.594215660251577e-02   +4.808320679644859e-02   +2.089008414644258e-01   +9.514354989687293e-02   +8.350392297959608e-02   +1.028827740426798e-01   +1.287928126917176e-01; +2.113199790484290e-01   +4.233226119580519e-02   +6.344005202623738e-02   +1.516510059366840e-01   +2.078409136946289e-01   +1.420200824964610e-02   +1.734131990990986e-01   +1.399214713377117e-01   +1.351705476420332e-02   +9.939935295077837e-02   +1.775577837834212e-01   +4.106528592438334e-02   +1.640138988266925e-02   +1.344582010946226e-01   +2.395380540951859e-01   +1.668305167632186e-01; +6.200992093836844e-02   +8.941890099356695e-02   +1.772826731180469e-01   +1.847030133279128e-01   +8.972787760355080e-02   +5.851397141047130e-02   +1.752115755499948e-01   +1.613002889088556e-01   +2.011818851742902e-01   +2.340316524112193e-01   +2.069060181839963e-02   +1.206755606270693e-01   +3.488753343347987e-02   +1.401665252638634e-01   +8.680829478074699e-02   +1.440829124794199e-01; +3.364803689095944e-02   +5.100753353517030e-02   +8.232006201065761e-02   +1.435163598542208e-01   +2.125111313647051e-01   +2.299657426372195e-02   +1.735223703900149e-01   +8.770818269160534e-02   +1.524051431836086e-01   +1.498843479822903e-01   +1.416429062739056e-01   +1.009604752866394e-01   +2.493567096880558e-01   +2.540248528594483e-01   +5.524948882918052e-02   +1.021076338458775e-02; +7.610336635318567e-02   +7.050467588598194e-02   +3.396974205885972e-02   +1.720126827775038e-01   +1.249196359824742e-01   +1.063146670800801e-01   +1.326902633100852e-01   +1.246040474205395e-01   +1.719166381692638e-01   +1.621487701664359e-01   +9.881340267589764e-02   +1.109619950843063e-01   +2.142670861214552e-02   +1.225283302701155e-01   +1.736462383399946e-01   +2.185667618362601e-01; +1.201068985861183e-01   +1.200036710594826e-01   +1.226241929208809e-01   +7.668640358262818e-02   +1.268207619980043e-01   +2.321700546126156e-01   -1.515874150990835e-02   +2.018009715973544e-01   +1.154596520506517e-01   +2.270904356608320e-01   +1.418699895869142e-01   +1.352047913839702e-01   +1.574721639836905e-01   +2.751262401141716e-01   +4.067566892367552e-02   +1.334524990181867e-01];
L2I_L1I_iGABA_netcon = [+1.874854735359789e-01   +2.245995912645795e-01   +1.132690763290005e-01   +1.355979242074841e-01   +7.352013332500967e-02   +1.934305881609857e-01   +1.156002985197797e-01   +1.973104526082355e-01; +5.918240382306759e-02   +1.734933229536308e-01   +9.364512653762777e-02   +1.433844217348181e-01   +1.500098271498124e-01   +1.770227891145222e-01   +1.951894201669334e-01   +6.478030541767685e-02; +7.335613287190479e-02   +1.060802636195153e-01   +2.186830063552576e-01   +1.011264319637121e-01   +1.515624625722752e-01   -2.687082151584724e-03   +2.198617542175859e-01   +2.161189479874705e-01; +1.016109068093184e-01   +2.057600997450434e-01   +8.295154221265889e-02   +1.312840663001222e-01   +6.866063836470761e-02   +2.146750381932510e-01   +1.452603566274319e-01   +2.333136579328813e-01; +2.044987665549215e-01   +1.327933225110687e-01   +1.209954347611948e-01   +7.318930626373694e-02   +2.788258951836758e-01   +2.527633052754673e-01   +8.353039510881496e-02   +1.495752545950974e-01; +1.573538645008139e-01   +2.005420271090951e-01   +2.286859114266519e-01   +1.507033053362778e-01   +1.648634015309288e-01   +1.570871446455133e-01   +1.277158711590012e-01   +1.512764594439862e-01; +2.161470556127701e-01   +1.784358534151079e-02   -2.280935381402086e-02   +1.856373991111014e-01   +1.752180284410455e-02   +9.038525180846109e-02   +1.101704968929796e-01   +9.604665727325165e-02; +1.456859771116491e-01   +9.626190541844881e-02   +1.011818887820590e-01   +3.002347368692358e-01   +6.412545338054806e-02   +1.764949916118989e-01   +6.382973269802239e-02   +6.579810867385612e-02; +2.072799030211131e-01   +1.142300766938549e-01   +2.725443047083205e-02   +1.681373440958283e-01   +1.635467767356499e-01   +2.283261390136187e-01   +3.014392253740698e-01   +5.771091192597538e-02; +1.015981447278440e-01   +1.893313359342037e-01   +1.290784737193224e-01   +2.397504411355352e-01   +2.171129709522596e-01   +9.052904970222420e-03   -9.181002832449495e-03   -2.078209368438940e-02; +2.044584391024150e-01   +5.811624007182981e-02   +2.162812423909402e-01   +1.157131497087825e-01   +1.135389428388404e-01   +7.108333511404226e-03   +2.164425680402912e-01   -8.106869912141043e-02; +6.647862914987079e-02   +2.105356582001210e-01   +7.094810725212250e-02   +1.513582421501342e-01   +2.604340888353142e-01   +1.105542960476670e-01   +9.417756001522584e-02   +4.330506738300230e-02; +1.349572309255054e-01   +2.839499787295470e-02   +1.938197846426967e-02   +2.444285761209823e-01   +4.968761898531662e-02   +1.789267889395054e-01   +1.299288225910685e-01   +9.460143415913667e-02; -4.769055442058918e-02   +2.065036636058598e-01   +4.967101072134250e-02   +3.490930547384759e-02   +1.199836045197758e-01   +1.387872083812338e-01   +2.262379411333872e-01   +1.320430682746720e-01; +7.366160494483749e-02   -5.393402372702881e-03   +1.592081702446873e-01   +1.493065093583767e-01   +1.110142024551613e-01   +1.538223464933544e-01   +1.832223803858672e-01   +1.092436784674005e-01; +2.638079830444965e-02   +2.272055826041656e-01   +5.116418150139369e-02   +1.700342777801321e-01   +8.488128674313436e-02   +1.107183582655651e-01   +9.840347473858387e-02   +7.570699716773802e-02];
L1I_L2I_iGABA_netcon = [+2.637200806751991e-03   +1.169149391007373e-01   +7.572712022344472e-02   -2.637731010890765e-03   +2.289887330460829e-01   +7.004442703922778e-02   +5.386476885305394e-02   +1.549610958312514e-01   +1.386032026810568e-01   +8.281042507848335e-02   +6.603620332788337e-02   +1.565636895294985e-01   +5.137639651702051e-02   +3.004711471466567e-01   +3.730089100978488e-02   +1.181388826464020e-01; +2.075109277207019e-01   +2.282709159613706e-02   +8.392093249318663e-02   +1.939789801344964e-01   +1.006529988545775e-01   +1.975089705689001e-01   +2.022360994750033e-01   +1.164491935906275e-01   +2.390240369551355e-01   +2.368029794799509e-01   -1.695507823434589e-02   +5.270128342714825e-02   +1.899523973066047e-01   +8.031584350232553e-02   +6.478380383095841e-02   +1.224573045469774e-01; +1.594837174766817e-01   +2.041224635619123e-01   +1.806744369220471e-01   +1.642271189804950e-02   +1.478953336146543e-01   +1.396493667970024e-02   +7.841246205320564e-02   +1.232699817482714e-01   +8.981440780869299e-02   +2.627068515680707e-01   +2.099220880256697e-01   +1.106148284761768e-01   +1.649327339509485e-01   +6.854028187201734e-02   +6.948472195587219e-02   +8.095448713505679e-02; +1.333956639386167e-01   +1.067192937804771e-01   +1.968334499288522e-01   +1.658191995976051e-02   +1.414110320737091e-01   +8.774525532386292e-02   +1.345043783628113e-01   +1.285993177512164e-01   +1.848632819739505e-01   +2.150325886779374e-01   +2.543337474390449e-01   +1.577385837319509e-01   +2.261100403099953e-01   -1.543853431543067e-02   +3.668934199655327e-02   +2.301974338988947e-01; +1.270233504867112e-01   +1.613972649813984e-01   +1.896357441471365e-01   +1.181551773051458e-01   +2.037704935711475e-01   +3.128675079926754e-01   +1.075059549247072e-01   +1.327213973138780e-01   +1.041354266218801e-01   +1.398270071144916e-01   +1.559590785207491e-01   +1.715843111477678e-01   +2.008143837057147e-01   +5.119511410121177e-02   +1.899087088746487e-01   +2.527253273812582e-01; +5.550441881487538e-02   +1.406666733963070e-01   +8.483119613051809e-02   +1.768933740044580e-01   +2.623395275049937e-01   +4.398777081291915e-03   -5.211025862342447e-02   +1.667961492595115e-01   +1.486284495219400e-01   +2.365162766867875e-01   +1.896207816815515e-01   +1.143166562454720e-01   +1.566188941512917e-01   +1.163511786722975e-01   +1.372957434836491e-01   +2.421417162035409e-01; +1.957366695373255e-01   +7.343876563341424e-02   +2.312570059529587e-01   +2.123493513479568e-01   -1.114474943711970e-02   +2.051577483630269e-01   +1.719307286486485e-01   -8.770499045147082e-03   +1.577207314403825e-02   +2.801396011982302e-01   +1.997544541959261e-01   +2.078382216136747e-01   +1.176476953562906e-01   +2.029826889919571e-02   +1.257731551784507e-01   +1.577502897578045e-01; +6.607714185880954e-02   +6.195872059561944e-02   +1.741943833115289e-01   +1.070196112825237e-01   +6.415071173473355e-02   +1.899459082420185e-01   +1.601310219325539e-01   +1.917775090759271e-02   +2.137631717813349e-01   +1.429796839958029e-01   +2.209332352733755e-01   +2.527220268828733e-01   +1.912398086920550e-01   +1.332649107008739e-01   +1.395134945677028e-01   +9.044744983615093e-03];
L2E_L1E_iAMPA_netcon = [+1.084045263670655e-01   +2.226824179575995e-01   +2.724802510307408e-01   +9.422525611792021e-02   +2.854390347229684e-02   +1.102813778497725e-01   +6.766175127676896e-02   +1.048313231380181e-01; +9.776593192376432e-02   -8.219266745282672e-04   +2.118146937091420e-01   +1.568430945643315e-01   +1.295863248006959e-01   -1.210233841187937e-02   +1.284879949692086e-01   -2.404321160078431e-02; +1.015734737086784e-01   +7.231719124506503e-02   +6.670975953822207e-02   +2.028950896271187e-01   +1.896769214197425e-01   +2.950460319456808e-01   +2.468154964048407e-01   -2.613344157239267e-02; +1.718351405054210e-01   +1.059218902447836e-01   +4.345898294736512e-05   +2.766028791198193e-02   +4.207375543625386e-02   +2.534384816121865e-01   +1.461105949903336e-01   +1.719473826021440e-02; +1.674288898925158e-01   +2.080900297004200e-01   +2.282233012433464e-01   +1.526553105325282e-01   +6.610228589728634e-02   +1.251766861678064e-01   +5.133716959307648e-02   +4.551785938758626e-02; +2.442873612233957e-01   +2.492258200740377e-01   -3.399436991573898e-02   +1.921403476648894e-01   -3.321584278042397e-02   +1.974046403911921e-01   +8.902973385843782e-02   +1.399450659084254e-01; -1.006872672968999e-02   +1.860250526992930e-01   +8.519730223228927e-02   +3.099283629518045e-02   +7.138090006025821e-02   +2.248453654819425e-01   +1.234306358632611e-01   +2.407447624958292e-01; +1.457825223350523e-01   +2.697751935044480e-01   +1.751452063416102e-01   +1.819361404843628e-01   +2.154797771077063e-01   +1.325827941645129e-01   +1.767275558740386e-01   +1.522869516604915e-01; +6.708924838362110e-02   +2.128322588936697e-02   +9.911650780686827e-02   +1.157425930263315e-01   +2.899752348788813e-01   +1.753997509300353e-01   +4.591707972373051e-02   +1.681783957558585e-01; +5.417274382884636e-02   +2.455580789192489e-01   +1.601204525354399e-01   +2.079777015026309e-01   +2.609449127468844e-01   +1.006282372889965e-01   +1.651848031987202e-01   +4.073669608045470e-02; +1.717584886872475e-01   +1.765035797427827e-01   +2.088214808443174e-02   +3.698182949830471e-02   +1.156754550674214e-01   +2.242800594229345e-01   +1.765954146497346e-01   -2.313190168342408e-02; +2.864939424207139e-01   +1.254446251005761e-01   +4.555703676603559e-02   +1.639010700274758e-01   +2.276582566962528e-01   +3.165762526030471e-01   +1.222449640605046e-01   +2.226482607367930e-01; +1.179014981973001e-01   +2.172711590443036e-01   +3.060002416447917e-01   +6.157104411796233e-02   +1.600684222071482e-01   -5.539285852518248e-02   +1.690066805504343e-01   +2.366547207461709e-01; +1.803726062951724e-01   +4.526912775756530e-02   +1.364120527253312e-01   +1.048104359452983e-01   +3.531270141818649e-02   +1.837571973878552e-01   +1.906178717445864e-01   +1.245276898822869e-01; +1.777139519119006e-01   +1.919746023346831e-01   -1.449837659454659e-02   +3.932557040668355e-02   +1.569790378610945e-01   +1.757909371758006e-01   +1.154526837471702e-01   +1.520001857907795e-02; +1.624506497397007e-01   +1.116758481138015e-01   +1.742714148387595e-01   +4.765509475641177e-02   +1.381874715089724e-01   +4.009400038153783e-02   +1.977990191147334e-01   +2.725671993545959e-02];
L1E_L2E_iAMPA_netcon = [+1.281634555780085e-01   +8.896327605746081e-02   +1.953593917883267e-01   +1.263635842061236e-01   +2.107573977504078e-01   +6.760043404274871e-02   +1.790849432330368e-01   +2.395348234140824e-01   +1.177242218386599e-01   +1.524613455902666e-01   +2.114191506080101e-01   +1.520309815214620e-02   +1.189094297906758e-01   +1.222862344325752e-01   +1.961106534213864e-01   +2.462696739181778e-01; +2.100169728102310e-01   +2.678221324721766e-01   +1.676329430714643e-01   +3.097478340300710e-02   +1.451891068595297e-01   +1.698602994923137e-01   +1.920623627517208e-01   +4.782895921739175e-02   +2.720012182531024e-02   -2.648323836925143e-02   +3.003644028634220e-03   +7.087362172313938e-02   +5.869124825982712e-02   -3.761069626302157e-02   +2.096727387089820e-02   +9.245581162518483e-02; +3.433481154719305e-02   +2.281398366268138e-01   +2.703571608661859e-01   +1.995678080717577e-01   +1.646909998297273e-02   +1.646309187393765e-01   -8.996447275969044e-03   +2.193385772386202e-01   +1.346207017065432e-01   +1.289877673927713e-01   +3.413214327282002e-02   +1.594182236142017e-01   +1.953265834108777e-02   +2.948611997912885e-02   +1.072931693672769e-01   +1.665158797463313e-01; +1.314065723808571e-01   +1.179795339690386e-01   +7.729730348667951e-02   +2.598643108711718e-01   +1.783706221127581e-02   -4.336304234013622e-02   +7.574617674103314e-02   +2.007579567930753e-01   +2.480454907593509e-01   +2.395161925874552e-01   +1.510816571604656e-01   +5.214591307508363e-03   +1.138062106261069e-01   +3.742604483082453e-02   +4.540678844095620e-02   +1.701350039992637e-01; +1.821692509150082e-01   +9.154896373982743e-02   +1.287315275191479e-02   -6.541958971157122e-03   +2.245661117192322e-01   +2.354895904621599e-01   +2.714989329442972e-01   +1.001931600385569e-01   +8.414952607491925e-02   +1.022703198287958e-01   +2.433538543118297e-01   +3.050489787694751e-02   +1.465372949779106e-01   +2.143490668906433e-01   +9.504851410907601e-02   +4.254749252840523e-02; +1.783906882072447e-02   +1.023093344742419e-01   +4.586245840335267e-02   -6.643805593140163e-03   +1.584559759419142e-01   +8.688700740765347e-02   +1.669617987334832e-01   +2.125854141939648e-01   +2.619571198423922e-01   +2.336187821907163e-01   +4.330279821598955e-03   +1.392535999667766e-01   +2.269097755504822e-01   +1.197001570502898e-01   +2.935044032263880e-02   +1.309368547588037e-01; +7.485520769553444e-02   +8.547596117169416e-02   +3.969012547418518e-02   +1.033313997422498e-01   +8.927548476591805e-02   +4.507215692108654e-02   -3.608425458073947e-02   +1.855105789440365e-02   +7.217159013867371e-02   +1.675130329643685e-01   +9.506428209014646e-02   +5.003869154333894e-02   +2.727319834433301e-01   +2.057235213181483e-01   +2.519016658125133e-01   +1.274254903779561e-01; +3.467880426835330e-02   +1.571555921432379e-02   +2.145956015118625e-01   +2.542829551891244e-01   +1.796520486251751e-01   +1.301262517410361e-01   +2.335995059609303e-01   +5.209715195810954e-02   +1.280586922025583e-01   +2.412055739268437e-01   +2.688485309161556e-01   +2.678388539428678e-02   +1.464752593628307e-01   +9.909977897617210e-02   +2.092954655046368e-01   +1.587305739653238e-01];
L2I_L2E_iAMPA_netcon = [+1.113866160998215e-01   +4.928949773231216e-02   +6.151525393407870e-02   +1.045911128001229e-01   +2.270036412013874e-01   +1.221295798771404e-01   +4.651910568199068e-02   +1.283409289764563e-01; +3.827284035846573e-02   +4.634053394228720e-02   +2.341846161211227e-01   +1.535703000790353e-02   +1.899607942721495e-01   +9.888706062163488e-02   +4.203955720300524e-02   +1.489217022217557e-01; -2.788182973821593e-02   +2.094291614958211e-01   +7.600609358534197e-02   +1.192146209993428e-01   +2.353117353402320e-01   +2.803211236138832e-01   +1.686518468028926e-01   +9.912709088873108e-02; +1.922098359115236e-01   +2.510176487677749e-01   +2.505565723891388e-01   +1.427660692626729e-01   +1.464877350640932e-01   +1.344638075812127e-01   +1.072591041561131e-03   +1.640729333019723e-01; +2.118000728359076e-01   +2.081558576868003e-01   +7.758942045664144e-02   -3.322965926533999e-02   +7.403084548130348e-02   +2.028298471149583e-01   +3.433946948149687e-02   +2.704982950433309e-01; +8.066299914936918e-02   +1.158972846862193e-01   +2.470114354708397e-01   +1.118513370974815e-01   +2.608263734270361e-02   +2.508265506941556e-02   +3.094842186486942e-02   +1.182764181669632e-01; +1.058486881997045e-01   +1.278701317217767e-01   +2.472321777298798e-01   +2.919127563337529e-02   -6.319467059433490e-02   +6.504709729206773e-02   +6.920330861220667e-02   +2.761034571793337e-01; +3.754144878687677e-02   +9.131995849981348e-02   +1.604875237241598e-01   +3.284032890596197e-01   +2.644671078042823e-01   +2.202154777404077e-01   +2.526289740331107e-01   +1.250814449594905e-01];
L2E_L2I_iGABA_netcon = [+2.223608590852864e-01   +1.057818881054172e-01   +1.763645719652409e-01   +5.909119320079798e-02   +9.605926330700738e-03   +2.214284520794549e-01   +2.131607462821739e-01   +1.992151625402293e-01; +3.166831047876156e-01   +5.527228354134760e-02   +1.258451073496476e-01   +2.720766290419800e-01   +1.452967738073214e-01   +4.538792412420792e-02   -1.289781362272935e-02   +1.801502196947097e-01; +8.797476786988921e-02   +1.453531925217413e-01   +1.755584991997121e-01   +1.085270152213690e-01   +9.628793915147554e-02   +2.481765222779686e-01   -1.177029534108977e-02   +9.940207076614968e-02; +2.420050408369664e-01   +3.759216750380349e-02   +7.130974838869088e-02   +5.128231969682085e-03   +1.846804088930648e-01   +2.018718193720666e-01   +1.583603820501492e-01   +1.023271603525344e-01; +1.317241560704886e-01   +1.853853565426519e-01   +2.325746667509251e-01   +3.065574336607489e-02   -4.434642554194356e-03   +4.831064618617312e-02   +1.982012343619162e-01   +6.642473983287436e-02; +1.698720166703593e-01   +9.207235632613196e-02   +3.862223593834291e-02   +1.150908912474177e-01   +9.537611280224700e-02   +2.221272894934165e-01   +1.664508580271373e-01   -6.166910685209701e-03; +1.978516684228905e-01   +1.341487581886298e-01   +1.689154821316441e-01   -4.283851860826883e-02   +9.921220595579511e-02   -2.104995662448047e-02   +2.255170564697602e-01   +6.010913611688987e-02; +4.832064608274565e-02   +1.126746047288137e-01   +1.187176188162931e-01   +1.022844844663005e-01   +2.222276484734036e-01   +1.788444645990336e-01   +3.986550857797639e-02   +5.328324685010812e-02];
L3E_L2E_iAMPA_netcon = [+9.561096094568472e-02   +1.378637877244187e-01   +6.395199129597123e-02   +2.622881492329927e-03   +1.310992144523662e-01   +7.718780921587773e-04   +2.057358475989138e-01   +1.747649574001304e-01   +2.111301661056345e-01   +1.452247144217532e-01   +1.004290529393009e-01   +2.038398592783043e-01; +8.538418650937551e-02   +2.351657944863375e-01   +2.347689325006094e-01   -8.959553819620179e-04   +2.111992495505872e-01   +2.071830615502356e-01   +1.555105503690450e-01   +1.538321337330752e-02   +2.093454861958403e-01   +3.308193050792181e-02   +1.733033317484255e-01   +2.208027460502980e-01; +1.697585401116079e-01   +1.043970156316597e-01   +2.279921876975009e-01   +1.999985841555663e-01   +2.543696481007947e-03   +6.979692792423373e-02   +1.828328857603596e-01   -3.739796752363634e-02   +9.150029113719899e-02   +2.412481262210535e-01   +1.267786597388130e-01   +1.777857985135223e-02; +1.582885147835008e-01   +1.414062651566335e-01   +3.558387583935757e-02   +7.893301312489766e-02   +2.092815512986688e-01   +7.709212716429378e-02   +4.851602224720186e-02   +9.920987602812083e-02   +2.211660936688611e-02   +1.259805538076145e-01   +1.767656577741851e-01   -1.387706168698351e-02; +1.705335472486379e-01   +2.955546997733866e-01   +2.525499873188715e-01   +2.587251537831628e-01   +2.410947143693024e-01   +2.805504430582018e-01   +1.478319781570916e-01   +5.883296599121059e-02   -2.784165063496502e-02   +7.630047301052867e-02   +1.413829026220576e-01   +1.425865668476882e-01; +9.539720495427456e-02   +1.329605709680413e-01   +2.464261963421067e-02   +8.663623448519335e-02   +1.497821806615787e-01   +1.412824909095969e-01   +2.839358696505663e-01   +2.406363134257630e-01   +2.599320531661870e-01   +7.334866025752972e-02   +2.384408697341717e-01   +2.157916341644577e-03; +2.306999806155645e-01   +7.080082185699375e-02   +8.203334301030663e-02   +5.748972576078569e-02   +6.119954112278933e-02   +1.011385731493043e-01   +1.135182817338563e-01   +8.076411758785559e-02   +4.067523304573437e-02   +5.568290844639738e-02   +2.267307937365434e-01   +2.183877532765555e-01; +2.694949112013235e-01   +2.217267922471532e-01   +1.103530964700989e-01   +2.080497314907241e-01   +2.085233272858602e-01   +1.094780334027582e-01   -3.634482103415698e-02   +6.759378291797284e-02   +6.668904746793194e-02   +2.670510441287087e-02   +1.027231851810886e-01   +7.004158325455762e-02];
L3I_L2I_iGABA_netcon = [+1.578975027481464e-01   +2.765802701405295e-01   -3.410995963628871e-03   +1.734577675580429e-01   +1.102912915029803e-01   +1.990843305575233e-01   +1.762111879148212e-01   +4.038381424185899e-02   +3.286751577310582e-02   +3.716797581712811e-02   +1.509525952274362e-01   +3.476537734798311e-02; +1.510006551825082e-01   +1.739408971055090e-01   +1.374806625597834e-01   +1.659200004445687e-01   +2.125863734732815e-01   +9.557684054900627e-02   +2.420420697160051e-01   +8.655195430335477e-02   +3.295735983710053e-02   +1.045310692829113e-01   +1.376780718933845e-01   +5.196720894566193e-02; +1.107459314320774e-01   +1.827082019356040e-01   +1.794788716632808e-01   +1.430044474401559e-01   +1.579045339785889e-01   +1.086928651439602e-01   +1.045910761133954e-01   +1.533355452361918e-01   +1.600269689194412e-01   -4.524364282807638e-03   +2.396261279534040e-01   +1.656142909562193e-01; +2.184562327160060e-01   +2.515231027870703e-01   +2.021102904392447e-01   +6.606282665855928e-02   +1.235288138863314e-01   +2.274798640924734e-01   +9.331233395299201e-03   -3.148382403764538e-02   +1.854995874226957e-01   +2.424046424766275e-01   +4.037384296346389e-02   +1.912500056930349e-01; +7.714098880589060e-02   +2.322217384522712e-01   +2.768771633551144e-01   +1.763790582421109e-01   +2.579867370831024e-01   +8.564480902522353e-02   +7.065007460915014e-02   +1.941551951239695e-01   +8.842262617783853e-02   +6.494253425409227e-03   +3.692365752180706e-02   +5.631417363577819e-02; +1.005425052324697e-01   +8.127997845548426e-02   +1.704582478890594e-01   +1.227579006027182e-01   +1.933232719672683e-01   +2.141416352074381e-01   +1.109390852928341e-01   +1.049339103735426e-01   +6.515134396742479e-02   +7.020959646143439e-02   +1.374079164508967e-01   +1.382608242670823e-01; +1.303313715962367e-01   +5.375859987243725e-02   +2.785450437973862e-01   +2.254881669286470e-01   +8.487886727547450e-02   +2.504406288839145e-01   +4.915327967019545e-02   +3.061264260686319e-02   -3.214024344895185e-02   +1.783087645313469e-01   +2.760959799295181e-01   +1.275117453819445e-01; +1.139478303698947e-01   +6.173922001647210e-02   +1.810710839148531e-01   +6.610908955642456e-02   +1.917545484882412e-01   +2.224375050946910e-01   +2.280500919740317e-01   +1.879174575409346e-01   +8.410710685515255e-02   +1.847158938195460e-01   -1.921208106389135e-02   +2.129291272048927e-01];
L2E_L3E_iAMPA_netcon = [+2.172834869945546e-01   +1.154420976565124e-01   +1.765572934699026e-01   +1.236398537794346e-01   +1.600774411480673e-01   +1.491836321601644e-01   +1.002457032444533e-01   +2.664046715030994e-02; +1.750538012476862e-01   +1.264315152720576e-01   +1.580379725191822e-01   +1.548450541842664e-01   +2.506954240802755e-01   +1.022510100544524e-01   +1.084352686401314e-01   +2.256651820067985e-01; +5.815589276571490e-02   +6.731900131193430e-02   +1.922752554013725e-01   +1.662502829978457e-01   +1.614100588441826e-01   +2.298216552924382e-01   +1.753236991983535e-01   -1.206551354929190e-03; +1.187215863777070e-01   +6.556570651077839e-02   +1.436942624309191e-01   +1.971936585160419e-01   +6.108562556433050e-02   +2.217044182693876e-01   +1.537675035752331e-01   +7.876651326563831e-02; +1.021696422230807e-01   +1.846490809319181e-01   +2.522768434537792e-01   +3.624704942967732e-02   +1.880547206970500e-01   +1.695720207278527e-01   +1.775720043684575e-01   -4.174514931114573e-03; +3.478945283247059e-02   +2.552719718371351e-01   +2.170874102022342e-01   +5.859166029307952e-02   +2.846953241276766e-01   +1.001230179966957e-01   +8.893023216063080e-02   +1.568684188464057e-01; +1.251019429778212e-01   +6.459919488579192e-02   +1.317844510407603e-01   +4.282028040721332e-02   +1.163725294955305e-01   +1.538072478993857e-01   +1.816595828392552e-01   +1.410445227482203e-01; +1.068724506916323e-01   -1.958517863915124e-02   +1.519598142349639e-03   +9.671503315504744e-03   +1.979876668959819e-01   +8.140038470041781e-02   +6.109744095223853e-02   +1.992494003585209e-01; +2.620626100903138e-01   +2.257904116991283e-01   +8.467308895320760e-02   +1.830949893300042e-01   -4.401941211505039e-02   +1.303365311219244e-01   +2.213171828972130e-01   +1.209306087784328e-01; +6.565091242322840e-02   +5.888110628940212e-02   +2.231156090846386e-01   -9.311184620349640e-04   +4.563043248893238e-02   +7.368406140844512e-02   +2.660605052150792e-01   +2.035415636001763e-01; +1.475072917301066e-01   +1.169307584101630e-01   +9.551745641661351e-02   +1.723939705996670e-01   +9.906782458607906e-02   +2.398099634608917e-03   +1.856430577715368e-02   +2.279044173913395e-01; +1.895624844745226e-01   +6.563515461633196e-02   +2.727068730115386e-01   +1.642033575445870e-01   +1.769977661735513e-01   +4.794879458573484e-02   +1.533697523964410e-01   +5.591476025903197e-02];
L2I_L3I_iGABA_netcon = [+1.293175243428709e-01   +8.644366565710661e-02   +5.073270414853701e-02   +1.826357638061091e-01   +1.474527614070021e-01   +1.445093669303642e-01   +6.154402866317006e-02   +1.092768730790628e-01; +1.054160812715767e-01   +2.233609830633403e-01   +7.129345529758925e-02   +2.401471936678931e-01   -1.365937306962619e-02   +1.606504555941156e-01   +5.937742997602584e-02   +1.190184442812845e-01; +1.220484203659397e-02   +1.876572228348053e-01   +2.078571075753695e-01   +1.931648280795452e-01   +1.278113898333638e-01   +1.315339862147107e-01   +1.929994256436233e-01   +2.398090920532516e-01; +2.134459865939662e-01   +1.876676329690796e-03   +1.935141371409783e-01   +1.147427659674095e-01   +1.271126977511460e-01   +1.919058349333936e-01   +2.490386964096832e-01   +2.407936199563028e-02; +1.136171054138825e-01   +3.045351734342311e-01   +1.939295176078953e-01   +1.790685448680431e-01   +8.499188036035892e-02   +1.677544198498281e-01   +2.333619492538113e-01   -1.501022732827591e-02; +1.688421889811615e-01   +1.525963837628442e-01   +2.165754739964482e-02   +2.798312790731562e-01   +6.687232756973457e-02   +4.651662538414565e-02   +1.329487273478116e-01   +1.699511492842601e-01; +1.712334024186464e-02   +2.163665666701384e-01   +8.984142571209269e-02   +2.590944558160571e-01   +3.750162648466739e-02   -2.725978013648166e-02   +1.793862451073038e-01   +1.787838948112263e-01; +2.390468418843129e-02   +8.802160732916137e-02   +9.708080299613921e-02   +1.259059926301781e-01   +1.950876408744922e-01   +1.676965284850369e-01   -1.540615964000430e-02   +6.350654128091249e-02; +1.038505135541165e-01   -4.395424079054967e-02   +2.589923158729416e-01   +3.025616828887540e-01   +1.660335439277710e-01   +3.711603750709574e-02   +6.223772472276738e-02   +2.150411899154976e-01; +5.618293069114223e-02   +3.720009622665125e-02   +2.960311397908429e-02   +1.666570501899247e-01   +2.115072049279369e-01   +8.769391342135029e-02   +2.201227846443233e-01   +1.093452524045806e-01; +2.638480984159940e-02   +2.023733593512041e-01   +2.990525369035242e-02   +1.094873763414009e-01   -4.998979824497434e-03   +1.687283659295888e-01   +2.829851437984938e-02   +6.791009042652106e-02; -1.958104910213349e-02   +4.802093150810090e-02   +5.902650302401272e-02   +2.608288265904562e-02   +1.588340575464282e-01   +2.133289876781124e-01   +8.863052897037868e-02   +9.555244307487562e-02];
L3I_L3E_iAMPA_netcon = [+1.150341646417248e-01   +1.630903818353542e-01   +1.354450414598122e-01   +1.905981115667829e-01   +4.156917151125517e-02   +2.099512266520057e-01   +7.329681747746558e-02   +1.982787330287949e-02   -5.044846554847665e-02   -1.383478754048559e-02   +1.997733942599844e-01   +1.239260956157566e-01; +2.413396014863791e-01   +7.999465289136778e-02   +9.095459934031977e-02   +2.209828612568765e-01   +1.735130909207956e-01   +1.558323086982313e-01   +2.273839643332925e-01   +2.701599413288784e-01   +1.052117829802451e-01   +6.547076421008158e-02   +1.320965440267408e-01   +2.628346455471823e-01; +9.101833820257055e-02   +2.016928067047860e-01   +7.522050309724337e-02   +9.237537855779188e-02   +2.257831891731984e-01   +2.093307252810984e-01   +1.466536475550707e-01   +1.606510016977203e-01   +5.643842234023208e-02   +2.105030217233604e-01   +4.299201867891492e-02   +2.290146857705337e-01; +2.503555983521745e-01   +6.766248897183080e-02   +1.452216905782027e-01   +2.259446771342313e-01   +9.648960824270969e-02   +7.208341741406224e-02   +1.272225121392811e-01   +2.410154740182486e-01   +1.380354872016944e-01   +1.934792996518836e-01   +9.532558903830485e-02   +1.681391712239638e-01; +5.456318963992973e-02   +2.453870731413261e-01   +9.492164748696846e-02   +1.595697169191067e-02   +7.652145372019310e-02   +3.908115369147039e-02   -5.335965210408137e-03   +9.485084073606083e-02   +1.062386932955549e-01   +7.469877094600724e-02   +2.370350354520679e-01   +1.973427399602042e-01; +1.108947989691866e-01   +2.171150650676363e-01   +1.252869045479338e-01   +2.521744166271563e-01   +5.071290519133652e-02   +1.533429714814932e-04   +5.276723533143053e-02   +5.635527874147971e-02   +6.607520841483795e-02   +2.544268333773997e-01   +2.015027023610000e-01   +7.317862630204450e-02; +1.496367915797807e-01   +1.295450670818674e-01   +1.660648882097292e-01   +1.996135563852383e-01   +1.620289623645551e-01   +8.023418513271595e-02   +7.613930952835488e-02   +2.737543432522860e-01   +2.003155767514206e-01   +4.233715814410975e-03   -4.756483916422528e-02   -4.095863483685887e-02; +2.849230365555664e-01   +1.954103096988564e-01   +1.229186046581920e-01   +1.708394512548318e-01   +3.913314243208096e-02   +3.008377390511065e-02   +1.366901375698468e-01   +2.385946860613413e-01   +1.520854580633350e-01   +1.847433396150071e-01   -2.221446443077268e-02   +3.548701685358363e-02; +5.636641711971752e-02   +6.551932369991005e-02   +1.321704271467462e-01   +3.945222542540981e-02   +8.207281240417774e-02   +2.624605202430708e-02   +1.676105863368235e-01   +8.235014829776055e-02   +1.330646841902178e-01   +2.186056210026841e-01   +1.483925577936660e-01   +2.532897426239073e-01; +1.929085994713455e-01   +7.859041479157194e-02   +1.903489821649704e-01   +6.758688603628285e-02   +7.851767078604702e-02   +1.118464418323170e-01   +9.746697289712378e-02   +3.040800559009663e-01   +1.675589821636020e-01   +1.167573375188820e-01   +6.355709775634399e-02   +5.031487146288456e-02; +2.251815840538185e-01   +1.442988469143357e-01   +1.646299280895630e-02   +6.257785536879137e-02   +1.363159623294232e-02   +1.656289676149635e-01   +1.471803051435592e-01   +1.780639123516589e-01   +2.907632592216071e-02   +9.344232048442631e-02   +1.406898703898617e-01   +2.135240647324400e-01; +1.004074466780196e-01   +4.749859531614763e-02   +6.502538616683687e-02   +2.648572403542233e-01   -2.361388308314193e-02   +6.466854734384390e-02   +1.784559449833403e-01   +1.504893926018610e-01   +5.007168070948866e-02   +2.413849143902291e-02   +9.657446123783579e-02   +2.553820030915968e-01];
L3E_L3I_iGABA_netcon = [-2.393435829149266e-02   +2.220865790981101e-01   +1.007647220002784e-01   +2.171224817594032e-01   +2.176668599290389e-01   +1.928565875437736e-01   +5.677829907185719e-03   +1.080335270204528e-01   +1.686200873744473e-01   +2.439023292066785e-01   +2.607632999995830e-01   +1.061829601281676e-01; +2.235593449231996e-02   +1.332819611067260e-02   +2.720816876611406e-01   +1.457289942508162e-01   +1.181600219072973e-01   +2.066104604216717e-01   +2.413380123979091e-01   +9.639214389969859e-02   -6.313966427547644e-03   +2.659907251551477e-01   +1.223628068201481e-01   +1.300521215642612e-01; +1.778973656013965e-01   +1.742864038784106e-01   +2.210421451925232e-01   +2.225906807347611e-01   +5.996846621517887e-02   +2.281282412172866e-01   +1.284034523794516e-01   +7.286617640731036e-02   +8.758462368536460e-02   +1.971176690278562e-01   +3.098084255780478e-03   +1.157655526348591e-02; +1.786315921126231e-01   +1.790492715023735e-01   +3.071403182539897e-02   -2.594599216601717e-02   +1.300088942013123e-01   +2.408495856584949e-01   +1.197296059965105e-01   +2.124768238588661e-01   -1.063308290208553e-02   +1.893630828830216e-02   +1.734141971649400e-01   +2.413524005552388e-02; +1.709479961827119e-01   +1.805581818627814e-01   +2.873713133612358e-01   +8.212734678569698e-02   +2.455269613793729e-01   +1.700550643229597e-03   +1.449381846134880e-01   +9.937679683222393e-02   +9.176287321585860e-03   +2.273805431101102e-01   +8.020841271695806e-02   +1.477226383706612e-01; +7.618700992259642e-02   -1.553686681726525e-02   +4.481518947756803e-02   +3.383733178457252e-03   +1.516648424751482e-02   +2.449460393535127e-01   +8.217345601813168e-02   +1.436404754369056e-01   +2.060740918931607e-01   +2.251122718307002e-01   +2.201736064923110e-01   +5.524477407541316e-02; +2.176964665876309e-01   +2.033341690360481e-01   +1.415252745780388e-01   +2.663705615619504e-02   +1.950918021731119e-01   +2.207279812757602e-01   +2.101575210051072e-01   +2.107666341326709e-01   +1.575094038483857e-01   +2.040370709716461e-01   +2.213230871297544e-01   +8.000962728499289e-02; +7.692403371954809e-02   +1.237820057267745e-01   +1.821238602131460e-01   +2.550780332159596e-01   +1.669868197962875e-01   +2.284770176489821e-02   +1.228498878331385e-01   +1.341187609722246e-01   +1.254987292920635e-01   +8.836538108246762e-02   +1.229558936691676e-01   +2.101782599051836e-01; +2.455262444568412e-01   +8.691917488310674e-02   +2.155733542441130e-01   +1.248896163155443e-01   +2.215999288386931e-01   +9.468074580424460e-02   +1.467623588717642e-01   +1.544792770215559e-01   +1.317966178596721e-01   +2.591368094628343e-01   +1.837275884555407e-01   +1.864527475653287e-01; +1.808206751492644e-01   +1.152113309223347e-01   +1.464161593059475e-01   -5.834402383748150e-03   -4.110577326938989e-02   +1.310672015058530e-01   +9.860368764173280e-02   +7.071127208608341e-02   +1.476688916181526e-01   +1.552570125677948e-01   +1.012043907186326e-01   +5.167525711857272e-02; +9.525838167061858e-02   +2.123837274568038e-01   +1.157480030687759e-01   +2.598445782380480e-01   +6.563688486063962e-02   +3.303105873298066e-02   +2.348777158940267e-02   +4.079765807627717e-02   -2.727193532529306e-02   -4.404037818941120e-02   +2.684833054689704e-01   +1.898341368641487e-01; +1.189824719507516e-01   +1.212893681474718e-01   +4.976668545169394e-02   +1.210939989704057e-01   +1.198500183715039e-01   +8.173747118791723e-02   +1.524730013627265e-01   +1.213822764903330e-01   +7.766315146943864e-02   +3.356595553344390e-02   -3.691975359821562e-02   +6.785831863195954e-02];
L2E_Input1_iAMPA_netcon = [+1.443813696302985e-01   +5.676829047879098e-02   +1.714826829634994e-01   +9.267839573258070e-02   +1.505501620168975e-01   +1.515555688524913e-01   +6.582707606641811e-02   +1.651638759190605e-01];
L2I_Input2_iAMPA_netcon = [+1.146404062142024e-01   +6.448181964503918e-02   +2.727647383395194e-01   +2.401880919727345e-01   +1.198858855343314e-01   +1.287821503016039e-01   +1.655568929915742e-01   +2.233776487756644e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
