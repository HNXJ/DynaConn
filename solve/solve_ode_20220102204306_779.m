function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.004094647839290e-01   -2.930345536522618e-01   +4.551949092749407e-01   +2.528796706209838e-01   +4.498005475651168e-02   +1.912897177559822e-02   -7.373357299072312e-01   +2.524217179305174e-01   +5.887442820349370e-01   +6.376296741119335e-01   +2.560264112666443e-01   +3.367228163714738e-01   +1.341364988145262e-01   -2.034492650320495e-01   -4.258214551016837e-01   +4.612456743930080e-02; +5.872595784566146e-01   +2.301684473531072e-01   -1.823214421521398e-02   +1.672934985926389e-01   -2.584059680440902e-01   +5.892876633191255e-01   -7.097260818650821e-01   +1.988570239569159e-02   +6.002815229652957e-01   -5.146173527077695e-02   +8.364978266601562e-01   +4.675370407213080e-01   +3.803450867272521e-01   -6.515314047799316e-02   +8.765923479695628e-02   -1.446105974679747e-03; +3.564841471404739e-01   +2.165699388717258e-01   -1.151049980764133e-01   +2.666168168160665e-01   +1.156624415225023e-01   +1.548024177110590e-01   +4.835672271115465e-01   -9.773385531336847e-03   +3.205684225944875e-01   +3.038710126237440e-01   +3.073353465173437e-01   +4.342195148571004e-01   +1.183596682467337e-01   -4.965562438353314e-01   -1.984557989400914e-01   -7.370347292370411e-02; +7.539322190964723e-02   -3.030147915315320e-01   -1.458582483258528e-02   +6.014208254536705e-01   +6.640526615988472e-02   +3.973830850229410e-01   +7.217059958468509e-01   +7.233285554521349e-01   +5.235639575245280e-01   +5.080164384255658e-02   +5.679827587671332e-01   +2.854747319766263e-01   +5.849153013300365e-02   +4.920844337300878e-01   +1.339186689770798e-01   +8.652185952960900e-01; +1.425397438770824e-01   +3.424653641707415e-01   +5.233226304435531e-01   +6.109715974854281e-01   -1.091931917296896e-01   +2.778589748578033e-01   +3.675746508774728e-02   +1.021007373515691e-01   +2.104325397329701e-02   +2.880716205397770e-01   +6.366842191076330e-01   -1.674418886639824e-01   +5.079925357567885e-01   +4.361704160851840e-03   +3.616476295391984e-01   +8.497515807351556e-02; +1.330859630409507e-01   +7.404501132001278e-01   +2.007904546786143e-01   -1.284484949840483e-01   +4.542984838721923e-01   +2.660441878357785e-01   +5.417135810060825e-01   +1.701153751932563e-02   +4.174503794086850e-01   +3.897788742418569e-01   +2.652152585630109e-01   -3.163076248157334e-01   +2.408923080180419e-01   +4.276506090257919e-01   -1.843247118200370e-01   -5.367478950653406e-01; +4.346043208864254e-01   +3.225822558500787e-01   +4.645740870723126e-01   +2.149130996957845e-01   -2.863083265021200e-02   +5.675494113707278e-01   +2.961815020498771e-01   +2.778501702072995e-01   -5.010291847382279e-01   -5.587323046447373e-02   -9.889162532574183e-02   +2.309232044056885e-01   +4.007079317427281e-01   -9.229656804220911e-02   +3.923242950161614e-01   +5.928770021827731e-01; +5.679484502820425e-01   +1.292223963724529e-01   -1.709691847681890e-01   +1.725176517092191e-01   +5.069947000545970e-02   +1.976924300230110e-03   +1.421680166955581e-01   +5.901019724977281e-01   +3.711551852348964e-01   +1.934510256074797e-01   +4.131156852096535e-01   +2.315213143475413e-01   +4.726727698527129e-02   +1.865072638028532e-01   -2.174399495328546e-01   +3.826437296037602e-01; -5.799924452260848e-02   +6.472703398274897e-01   -3.072401878632666e-01   +2.446386806106458e-01   +3.007852141846338e-01   +4.068322575454950e-01   -1.548038472926958e-01   -2.225980806866439e-01   +2.571388002234176e-01   -4.282949080158780e-03   +6.181474449588877e-01   -2.135421022327394e-01   +2.643004751535804e-01   +3.919416273271695e-01   -2.410516268223170e-02   -4.964581242796000e-02; +2.168744280911431e-01   +5.293578661129918e-01   +4.367293856878545e-01   +2.856095142091456e-01   +1.018893789628500e-01   +1.864691000568742e-01   +4.988655169677609e-01   -6.267710755029535e-02   +2.636061478974587e-01   +2.490288581156823e-01   +6.013315955165724e-01   +1.284494316810763e-01   +6.056607734015783e-01   -6.812441853590967e-02   +3.859599197558465e-02   +1.309525201063969e-01; +2.457985566794808e-01   +5.472654719882943e-01   -2.282717604516752e-01   +2.617955196229530e-01   +6.476363386867686e-01   +1.394385053481837e-01   +2.501612396375096e-01   +2.903584873965939e-02   +1.438358613931850e-02   +4.951365095025194e-01   -4.655572911596141e-01   +3.407521747487241e-02   -5.602453688258883e-01   +2.761423458568294e-01   +2.562056059518482e-01   +2.639355954157892e-01; +3.403303291183445e-01   +2.917883322624448e-01   +9.969570550683486e-02   -1.262181121007827e-01   +8.450512145554531e-02   +1.509792439945530e-01   +4.832500046361701e-01   +2.337669217340644e-01   +6.648556524587192e-01   +1.879729317968832e-02   +2.930952383739523e-01   +6.591314168189965e-01   +7.410927903211403e-01   +7.016613122930081e-02   -1.833208498638918e-01   +9.889867142753904e-02; +3.287251852378769e-01   +1.294290466357705e-01   +5.031964271337687e-01   +1.619559678605792e-01   +8.239991231597262e-01   +4.533545814009523e-01   +1.087956022827913e-01   +1.422636729729894e-01   +6.315827222838789e-01   +1.250285883614225e-01   +3.808350809421250e-01   +5.307380266973261e-01   -3.863077114892904e-01   +7.751961842531627e-02   +1.498909001465679e-01   -1.569582275566353e-01; -2.538552849531704e-03   +2.532293381829132e-01   +1.481130878673205e-01   -6.156486715257822e-01   +2.012527409187357e-01   +5.995148290381003e-01   +1.022341442555185e-01   +4.458726474944917e-01   -3.031800637321259e-01   -4.592772683783563e-02   +5.615675833109557e-01   -1.775721728772759e-01   +1.503195388381103e-01   +6.342031659817799e-01   -9.316792523264214e-02   -1.751559917361009e-01; +4.456696609296725e-01   -3.329816721022754e-01   +7.070323909476505e-01   +3.300884429869768e-01   -2.233852173823969e-01   -2.689184370618326e-02   +4.385130427308682e-01   +8.237225422653233e-02   +7.076685337297396e-02   -1.523581491208399e-01   -2.411606113657488e-01   +3.898424027719477e-01   +5.742200585301053e-01   +1.660366578785404e-01   +9.046898505219861e-02   -3.323631291146342e-01; -6.376414542372020e-01   +5.696691036265944e-01   -9.889870090016531e-03   +5.447745242883061e-01   +7.243789181513925e-01   +6.363124796414265e-01   +1.853605380467470e-02   +9.834384906360226e-01   -5.318056787223645e-02   +3.927462506269540e-01   +4.387524575249965e-01   +3.826304596997739e-01   +2.434426537162674e-01   +4.058354534963590e-01   +5.794242345438865e-01   +2.195364368829239e-01];
L1E_L1I_iGABA_netcon = [+3.318396043579298e-02   +4.044292980040394e-01   -3.380810112301831e-01   +7.103682794336819e-03   +6.725939285036229e-01   -2.454021846071438e-01   +3.240899687884479e-01   +2.867169503063469e-01   -2.789222422723883e-02   -3.401250843227634e-02   +1.804960802410967e-01   +1.946840240314152e-01   +9.414547703953835e-01   -4.962188041589963e-01   +1.678740053114834e-01   +7.558704256946133e-01; -5.276444098277870e-01   -6.049125809001365e-02   +6.787202097801276e-01   -2.165799202578639e-01   +2.894412667182673e-01   -2.349796626272196e-01   +3.764188074326413e-01   +4.498868939279307e-01   +4.246424756418193e-01   +4.408062955572547e-02   +4.494814811327447e-01   +2.905564058051056e-04   +5.864881672526913e-01   +1.824407724007898e-01   +3.879244566604989e-01   -1.907808212738616e-01; +4.870764254286580e-02   +2.072346537918652e-01   -1.672406175866499e-01   +4.105346949059933e-01   -1.191671297531036e-01   -1.761888713037456e-01   +8.696838460479991e-02   +8.321904877433162e-02   -2.813503244671460e-02   +4.408520239274850e-01   -4.511634896585611e-02   +2.202135558664302e-01   +7.728536911327005e-02   -6.852019198339462e-02   +6.585357008599276e-01   +2.726470793848356e-01; +5.177288768309493e-01   -2.195549046623212e-01   -7.950488145917979e-02   +2.186229768227442e-01   +9.467105866347413e-02   +4.460114378143680e-01   +3.739101759053262e-02   -8.920650918044903e-02   +5.326600094777516e-02   +2.687133160121598e-01   +3.153123456760277e-01   +4.969069696637640e-01   -1.423126807417634e-01   +3.541412479866643e-01   +1.556492369774064e-02   -3.124473793499570e-01; +1.193506648986715e-02   -9.595336363377499e-03   +5.048068337972605e-02   +4.630967140693704e-01   +3.695606784811685e-01   -1.437186398080384e-01   +2.270858556744239e-01   -3.907518855521782e-01   +9.551144033486020e-02   +1.509410182339873e-01   -3.185949017431351e-01   +5.655419471486344e-01   +3.165420068474508e-01   +3.100126740630050e-01   +5.746381888812767e-02   +6.440824130294615e-02; +2.130045685304436e-01   +2.278384909296608e-01   +2.446089926768439e-01   -1.882476615491349e-01   -2.595089201589157e-01   +7.556896958480709e-01   +6.419005403947883e-02   -3.274723441600557e-01   -1.648760510958388e-01   +1.563193377736106e-01   -5.026594299817400e-01   +4.339864530283954e-01   -9.762724981841797e-02   -5.062860342263863e-01   +5.107660079794730e-01   +2.745070046279039e-02; -9.271883654965478e-02   -4.662452223477910e-02   -2.275413395089626e-01   -2.143140782885605e-01   +5.044022740062404e-01   +6.351846704499770e-02   +2.866808911607179e-01   -2.131629136521837e-01   -3.086093548107611e-02   +2.377101582888155e-01   +5.313393414992270e-01   +3.052453861258123e-01   -3.997319329758109e-02   +2.958678399304892e-02   +9.965140946755078e-01   -2.558843272127643e-01; +1.649924658269596e-01   +1.235666162830816e-01   +1.148904427721067e-02   +1.516145878435187e-01   +9.712962831455915e-02   -5.461435106909387e-02   +5.734451192803928e-01   +9.300296188351037e-02   +5.747853445986930e-01   +2.639351732470900e-01   +9.960621384536585e-02   -8.290232114649623e-02   +4.917480950224267e-01   +3.475525869428157e-01   +3.411449175283814e-01   +5.238391156360757e-01; +5.760853874987116e-01   +6.292513786652739e-01   +6.763664378913148e-02   -1.228994741257162e-01   -4.897852854115692e-01   +3.220609219292575e-01   +8.642498966674932e-02   -2.303496622320650e-01   +1.197279829650483e-01   +6.071723132218991e-03   +2.103914872823929e-01   -2.701453791078843e-01   -1.981224272991184e-01   -5.011782227610952e-02   +5.397035919833810e-01   -1.270839325006068e-01; +2.335643187552019e-01   +5.581270479498280e-01   -2.006085325270571e-02   -9.470501020033743e-02   -1.998699148283418e-01   +5.390039903918070e-02   +9.908619776510290e-02   +4.384296976235619e-02   +3.631019592267225e-01   +1.221554713909174e-01   -4.537610006184420e-01   -7.918080342744251e-02   +4.060352226824579e-01   +4.606165404913365e-01   +2.711878373946638e-01   +4.243381679991343e-01; +2.754911760954829e-01   +3.312729099397677e-02   +1.050459392370091e-01   +6.194666003065860e-01   +2.812788364017522e-01   +1.095423184235207e-02   +2.397382357394609e-01   -1.831099349225764e-01   +4.122823429221990e-01   +3.337761564884535e-01   +1.997551371643986e-01   +5.935241163412825e-01   +7.023173772205232e-01   +3.279250154871945e-01   +1.793051237549061e-01   -2.636884217914651e-01; +1.991983864852034e-01   +2.935010944191832e-01   +2.380243813031003e-02   -5.902704789484069e-01   -3.227049485354420e-01   +2.866709547367043e-01   -3.023273472622586e-02   +3.601211211444335e-01   -1.339931513037022e-01   -2.498349962432546e-01   +2.310039339742342e-01   +2.783132156860049e-01   -1.258454198041604e-01   -8.935165336526504e-02   +3.126280653471612e-01   +2.796049273522236e-01; +3.462383966562864e-01   +4.945493700404278e-01   +1.920225462836023e-01   +4.657135688439430e-01   -1.755934718656028e-01   +2.437222272829783e-01   -1.112497587196554e-01   +2.548172926640491e-01   +4.953515109487489e-01   -1.363941639656667e-01   +1.330918670859875e-01   +3.930168037796549e-01   +2.791019731076833e-01   +4.719247393289993e-02   +4.495282706724905e-01   +4.242604693357163e-01; +5.340512966160654e-01   +7.982536042963605e-02   -1.431486573724731e-01   -1.841439315953004e-02   -4.477775980328072e-02   -1.398808980368046e-01   +1.759755698121627e-01   +3.801678083915705e-01   +5.621254774291339e-01   -2.507913144028347e-01   +4.121756243555372e-01   -7.751118574250496e-03   +6.497792582122774e-02   -1.784286346977427e-01   +3.439274152529912e-02   -3.216285929522336e-01; +4.267601012017194e-01   +1.366472454843774e-01   +3.221022744007000e-02   +4.028779010895354e-03   +8.671822192931221e-02   +1.305877018771422e-01   +2.875118836433179e-01   +5.347399460155592e-02   +4.475881940064439e-01   -4.774071225157452e-02   +2.434109619605888e-01   +7.701581528733445e-02   +2.944369903429963e-03   -3.695543716439761e-01   +6.838890862958905e-01   +4.723782158238485e-01; -1.905449026467234e-01   +1.305572079235614e-01   +2.208906998138182e-02   -7.113465242881405e-02   -5.889440192359269e-02   +2.749486607603554e-01   -7.081088000431485e-02   -9.363323463775722e-04   +5.730095827817178e-02   +1.742585155013634e-01   -4.094896441602703e-02   +1.423046450986236e-01   +1.107375099515832e-01   +2.517294324298500e-01   +3.087821694249605e-02   +6.966391576106720e-01];
L2I_L1I_iGABA_netcon = [-1.410083605009264e-01   -2.054814374429583e-01   +6.564376965382476e-02   +2.778925101928038e-01   -1.121987198778856e-01   +1.302941500469984e-01   +4.306006204540405e-01   -2.793294123577286e-01; +4.209564341011670e-01   +6.958652829237501e-01   -1.696120967174644e-01   +9.437399173669411e-02   +6.173255198679559e-01   +5.242131310061263e-01   +2.651148372054574e-01   +8.653412808158350e-03; +7.527530959716714e-01   +3.408966070137628e-01   +8.496301037213282e-02   +3.766386976518689e-01   +4.323540925309102e-01   +1.676352997494231e-02   +1.035201232390900e-01   -6.485368297418209e-02; +5.557681871055050e-01   +2.258857148245630e-01   +7.191968520853154e-01   +1.047865176546215e-01   +4.440800307603204e-01   +3.816941224440018e-01   +5.217172812481127e-01   +8.235411782868431e-02; +3.033896739503386e-03   +2.660272428013257e-02   +4.281585399268624e-01   +3.857497100924588e-01   +2.970253702153896e-01   +1.054467947212883e-01   +1.366003376530849e-01   -1.142357746023293e-01; +9.353290154055685e-02   -2.671064588176499e-01   +1.896388895218540e-01   +1.884227365262558e-01   -1.973245932980910e-01   +2.112814992816277e-01   +4.477687648685935e-01   +5.252013909492265e-01; +7.258829725645417e-01   -1.206481385177104e-02   +2.416363018663035e-01   -5.631259821133456e-02   +2.797346277903784e-01   +7.357626664913771e-01   +4.092622318182460e-01   +2.498889991603291e-01; +2.509060284533688e-02   +5.073269921872420e-01   +2.241001277058361e-01   +6.584722093259741e-02   +2.037829249512496e-01   -2.612487716494686e-02   +4.013704912242009e-03   -2.459235316527669e-02; +3.027969863409608e-01   +1.000000000000000e+00   -7.126338372681260e-01   +2.664430237717612e-01   -7.887987167698431e-02   +1.614583672807512e-01   +3.548407581935319e-01   -4.626742851524622e-02; +7.716735244577283e-02   -1.168461691948851e-01   +1.300579520094911e-01   +2.445218253249574e-01   +6.416504107967881e-01   -1.543049324476682e-01   -6.898468077171561e-02   +4.201314905971998e-01; +2.471914459329269e-01   +1.144330070807242e-01   +3.363283265477555e-01   +2.804441515499688e-01   -2.635774760477786e-02   -1.285070610146023e-01   +1.504134832346649e-01   +2.755022821739703e-01; +3.593336080681093e-01   +2.837581447997000e-01   +5.102481887436707e-01   +2.192289669604061e-01   +4.279382106353973e-02   +2.346808409419631e-01   +5.021145109115505e-01   +4.818471895550580e-01; +4.216359791297793e-01   +3.104428135951596e-01   +3.667792681646207e-01   -6.536423737111323e-02   +3.614237824954158e-01   +1.307106780441245e-01   -3.472437256962230e-02   +2.197270881593809e-01; +2.510290929608565e-01   -1.498945700157020e-01   +1.311346969066491e-01   -3.716015162088877e-01   +3.669525885206181e-01   -1.514345702652719e-01   +3.971680139494869e-01   +1.242735301886532e-01; +3.514190145954479e-01   +8.058838257006928e-03   +3.034686920070339e-01   +2.968364728942482e-02   -1.214719977961467e-02   +7.846514515184735e-01   +2.547997264191958e-01   +5.572798461653455e-01; +5.112800606274835e-02   -9.347516807789802e-02   +1.846994958796231e-01   +3.612110080127064e-01   +2.667097664777104e-01   +1.366602238799283e-01   +3.383508064875477e-01   -9.638028267895653e-02];
L1I_L2I_iGABA_netcon = [+4.920400191190922e-01   -1.127272202625629e-01   -1.423499510952833e-01   +4.829104428498311e-01   +5.542879999108855e-02   -1.474405499798093e-01   +5.067511892369393e-02   +3.351722450375321e-01   -9.780185586923171e-02   +3.638558283868635e-01   -1.862574242100210e-02   +2.847558889170014e-01   +1.647314718718710e-01   +1.363475269040026e-01   -1.038346320589340e-01   +2.542764095921177e-01; +4.124630246605111e-01   -1.195270951048221e-01   +1.412856792925090e-01   -3.296299479762189e-01   -8.715673577342914e-02   +1.160792431502545e-01   +5.302913414641595e-01   +3.264797229435609e-01   +2.947141835887483e-01   +8.231996769280120e-01   +2.692194560797108e-01   -8.899236226164541e-02   -2.131107176070916e-01   -4.372709622346228e-01   +4.418626753147621e-01   +4.888486991086205e-01; +1.230032271321520e-01   -2.919181671439863e-01   +3.617982923485260e-01   -2.229203641371578e-02   +1.687995940149903e-01   -2.767438772705581e-01   +6.775630534465149e-01   +3.772189910439204e-01   -2.792062717017784e-01   -1.146421475653418e-01   -1.262340255967150e-01   +2.753360931673096e-01   +4.741502073835671e-01   +5.338632983598909e-01   +9.363313777224838e-01   +7.705429736835172e-02; +3.646723342985635e-01   +5.804790987695113e-01   +4.535773724353564e-01   +4.272789011868296e-01   +4.665807450866151e-01   +5.543841268568738e-01   +5.377184950183515e-01   +4.567673862600680e-01   -1.886955899595761e-01   +7.129137167136246e-01   +5.424635731648400e-01   +3.128057805002965e-01   +2.336291359261090e-01   +1.301781719176920e-01   +4.566008075238295e-01   +3.808322246043338e-02; -3.072499408791781e-01   +2.201785580605666e-02   -2.113871898139552e-01   +3.679213996774862e-01   -9.490688436243985e-02   +7.396677330535666e-01   +7.368484054052725e-01   +3.721082855838139e-01   +5.627416348729201e-01   +3.906686682571177e-01   -2.575008949105866e-01   +1.994746220173086e-01   -3.970865771585091e-01   +2.013979849873586e-01   +3.449789377151229e-01   +4.228518916875414e-01; +1.685342214159539e-01   +3.968624908522528e-01   -2.276603411095549e-01   +5.193780889422747e-01   -3.559180578743115e-02   +4.187241744609241e-02   +3.052545023501372e-01   +8.442275571141770e-02   +1.053231484546128e-01   -3.097850591901086e-03   +7.275810820816045e-02   -1.820637404623081e-01   +5.618890820200809e-01   +9.877091399612553e-01   +2.548202928469140e-01   +3.351150436999137e-01; +4.448527258727610e-01   +5.398075451923086e-01   -4.240320314113487e-01   +2.189440697123633e-01   +4.218039011137743e-01   -4.231781718000027e-01   +3.707273893620390e-01   -2.503974125871940e-01   -1.692924949763411e-01   +1.414098435943520e-01   +3.614603833762477e-01   +3.133938069949053e-01   +2.114872300211612e-01   -1.497993264093681e-01   +1.326622716697953e-01   +3.436460809773156e-01; +4.486466355300884e-01   +1.633012725232533e-02   -1.313683834409593e-01   -1.727524646484438e-02   +1.039183432987407e-01   +3.647161757904981e-01   +2.516391575183456e-01   +8.986616443984784e-02   -1.068714665583864e-01   +2.897402238842325e-01   +3.576063294087671e-01   +5.060920090613201e-01   +1.515378149015413e-01   -2.560075197376482e-01   +4.346659538196693e-01   +4.483866616817522e-01];
L2E_L1E_iAMPA_netcon = [+3.086274556638921e-01   -9.004336504208977e-03   +1.464302994011532e-01   +3.675050826015014e-01   +1.000000000000000e+00   +5.455485407963095e-01   +3.402550597473513e-01   +1.996281576963307e-01; -2.031868318807132e-01   +3.006529275831817e-01   -1.080627621534874e-01   +2.409163031505189e-02   +6.585318171537714e-01   +1.998050065767781e-01   +5.714396185988676e-01   +1.575813701287073e-01; +1.865088908828727e-01   +4.846657671195422e-01   +2.819177617959254e-01   +6.659858923461331e-02   +4.414912425803669e-02   -2.918386331060407e-01   +1.407401981646301e-01   +4.653663111225511e-01; +4.797017341291567e-01   +1.060691299303792e-01   -1.594802751331895e-01   +4.660764041819688e-01   +1.455807333796126e-01   +9.743909435190040e-02   -1.274043725879793e-01   -9.228004260800073e-02; +9.019977037396354e-02   +1.037905144653775e-01   +6.506783918856703e-01   -1.186666102977991e-01   -1.425225183567300e-01   -4.712618013503207e-03   +9.152059332625853e-02   +2.650190619239809e-01; +3.979962257403926e-01   -2.445027091395046e-01   +4.365777459861474e-02   -1.672945165211773e-02   +2.170452902662983e-01   +4.751156567374964e-01   +4.001830144524487e-01   +4.588156618384700e-01; +1.124580521758220e-02   +5.345805424470351e-01   +1.705160688855484e-01   -1.291046147512946e-01   -2.468963767505918e-01   +4.620328464496936e-01   +7.218886164738731e-01   -2.076343471742711e-01; +3.321620878539188e-01   +5.098341705487213e-01   +8.639878008841706e-01   +1.812922225438659e-01   +3.962976482538644e-02   +4.954778578658737e-01   +4.001640067616183e-01   +1.361698827622229e-01; +4.658859389935519e-01   +5.994710916884554e-02   +1.879223772264630e-01   +6.241782845768112e-01   -1.701707584318211e-01   +4.904047858085447e-01   +5.892462259037936e-01   -1.196634293476129e-01; +6.448026430365121e-03   +1.054156416923500e-01   +2.100506334119527e-01   +1.994100290677042e-01   +1.470323656056347e-01   -1.583209415503435e-01   -2.504586469303898e-01   +4.377735071491968e-01; -1.897587511215952e-01   +5.239583755595651e-01   +6.731300048365130e-01   -2.176745140345338e-01   +1.825893964982201e-01   -8.952287737846298e-02   +1.998182730997153e-01   +2.439373402128679e-01; +7.590645261192051e-02   +2.224685534008271e-01   +5.030948035767623e-01   +1.353646305076208e-01   -9.555378419884739e-02   +3.435206762734161e-01   -2.489084168961567e-01   +1.154332821649669e-01; -8.672464453489752e-02   +2.802557225535859e-01   +1.015869669590600e-01   -3.075422006332993e-01   +7.000571550911493e-01   -1.792952182227449e-01   +4.089011721246727e-01   -2.484113226871545e-02; +1.342249014196993e-01   +7.238948852127965e-01   -4.118225253921965e-01   +4.854076351452899e-02   +2.425242699377941e-01   +2.617945661776876e-01   -3.197752989589498e-01   +1.109309499816955e-01; +4.519033439627364e-02   +1.458824620455812e-01   -6.942130735043950e-02   +2.950532060532746e-01   +5.147944998938592e-02   -1.894734944833402e-01   -1.395230697647633e-01   +1.676966726933990e-01; +2.477001591943003e-02   -9.962220481191282e-02   -2.914789729200730e-01   +7.512724345347495e-02   +2.624160048832014e-01   +4.063802649845425e-01   +4.838104150671488e-01   +3.774555054481351e-01];
L1E_L2E_iAMPA_netcon = [+2.920035305636741e-01   +3.848321930217287e-01   +3.038732414576818e-02   +3.342881705668699e-02   +4.030218362431404e-01   +2.121207616687885e-01   +1.810326799963353e-01   +2.338642643433628e-02   +3.761892309684679e-02   -1.198137565628483e-01   +2.359260482383289e-01   +1.375044085448311e-01   +1.805888515827594e-01   -5.947265948391725e-02   -2.756941952715819e-01   +1.267302497687438e-01; +2.396455279758508e-01   -2.397227416694402e-01   +5.601918391392855e-01   +1.713676244530851e-01   +2.236772991086606e-01   +2.973633466171757e-01   +5.059528533408527e-01   +1.307814319250776e-01   -2.137613737213511e-01   -2.807476408069174e-02   +2.434853123107683e-01   +5.554473865659838e-01   +5.740254591335698e-01   +1.510531347214430e-01   +3.458765148339894e-02   -1.969432030026446e-01; +6.406310245862118e-01   +1.484180313106806e-01   +1.559952292700703e-01   +1.063864099160617e-01   +7.588808573845185e-02   +4.230424434770519e-01   +1.110071967244690e-01   +2.943736228028929e-01   +1.297661286962140e-01   -3.122169169303703e-01   +1.811852336566949e-01   +6.436248166561108e-01   -4.768119426020428e-03   +4.322888680876810e-01   -6.659297925237870e-02   -2.756783165241021e-02; +1.406805342043614e-01   -3.035671864521980e-02   +1.090574585939199e-01   +3.120395407088629e-03   +9.143612252599279e-02   +5.545384616436059e-01   +1.000000000000000e+00   -2.032244211930853e-01   -3.167844644817655e-02   +4.374349745732982e-01   +4.087065169866698e-01   -3.192293368050943e-01   -1.602646759716215e-01   +7.420345203140757e-01   +1.670670735097524e-01   -2.934255747335130e-01; -2.874423282261775e-01   -3.700388586828508e-01   +3.856328955790185e-01   +9.184012629907856e-02   +2.808949701812172e-01   +1.798227585201827e-01   +3.290533508752689e-01   +4.130590703110943e-01   +3.078606586467139e-01   -3.876951785262766e-02   +8.235056469948429e-02   -3.151851415542984e-01   +4.611486089421151e-01   +1.439481369274466e-01   +3.082739306491136e-01   -2.599111618999450e-02; +9.018145738788562e-02   +5.101633490684047e-01   +3.088441384512202e-01   +5.547230610158014e-01   +2.215126385580132e-01   +6.701368102406172e-02   +7.039100581611401e-01   -1.154669419842976e-01   +3.268989420146754e-01   -9.181614373728220e-02   +5.595370702828815e-01   +3.349858061422138e-02   -2.470821391933873e-01   -2.620528278507872e-01   -1.545439420794913e-01   +4.238791569090403e-01; +1.665524473129235e-01   +3.086021840172845e-01   +2.766166700769590e-02   +3.871041539260840e-01   +3.356324923777197e-01   +3.234833531781354e-01   +3.591791443983822e-01   -1.705548990743630e-01   -2.918986222764489e-01   +2.031967014231743e-01   -3.670651599992400e-02   -1.773453606816910e-01   -2.195477075627374e-01   +4.650117300500534e-01   +6.351986947018590e-01   +1.961588167856576e-01; +3.882966725184610e-01   +2.952890079372540e-01   +3.979061906658946e-01   +4.351969616548844e-01   +2.562178348791730e-01   +4.925890730167575e-01   +5.525465184156365e-01   +2.011339252312879e-01   +4.410071866938960e-01   -1.155255592058313e-01   -1.058175686641269e-02   -7.897275880669247e-02   -5.722367868811263e-01   +2.246321282837351e-01   +3.021168256484507e-01   +1.740617951315065e-01];
L2I_L2E_iAMPA_netcon = [+2.771187317006351e-02   +7.133054537530615e-01   +4.753541420776117e-01   +5.290710606713405e-02   +2.282911360778610e-02   +5.022618621802128e-01   +1.442922894175884e-01   +5.167933949499754e-01; +5.988346766874932e-01   +3.484016661135429e-02   +7.984683305125436e-01   +5.544765273605867e-01   +2.670413263538451e-01   +1.482623479963164e-01   +8.277295156335147e-02   +4.666236929523359e-02; +8.744098162274947e-03   +3.289688759640635e-01   -7.220625358766869e-02   +8.754665694781315e-02   +1.254101968314516e-04   -8.107566591945524e-03   +2.723587653510971e-01   +7.386325050911918e-02; +2.469140488336191e-01   +5.040865376361897e-02   -2.597970526333299e-01   +3.933784634839039e-01   +4.871469650476355e-01   -2.394258123695396e-01   +4.477626566996638e-01   +2.212057751177496e-01; +3.574706956752935e-01   +2.558471443278231e-02   +6.673649739588240e-02   +4.820935079182113e-01   +6.671888215232366e-01   +4.891755462440892e-02   +4.989153434284355e-01   +1.187335919059200e-01; +4.085267121586432e-01   +3.458042796306638e-01   -4.298972599356989e-02   +7.452146727021519e-01   -3.225116835662485e-02   +2.384013790183085e-01   +3.666748522393036e-01   +1.157451913166595e-01; +3.933573895897682e-01   -4.093906293569917e-01   +4.666702224505418e-01   +6.380656749262776e-01   +1.089981083200854e-01   -2.049656132829122e-01   +6.989181605222708e-01   -1.682059239814135e-01; +3.295747087880747e-01   +6.359800659175022e-02   -3.777380599414168e-01   +1.377504172317856e-01   -2.690634541280153e-03   -9.465474263590982e-02   +3.586784040265527e-02   +5.787672793960099e-01];
L2E_L2I_iGABA_netcon = [+1.475810689883645e-01   +5.882183627590404e-01   +3.395107134169705e-01   -3.812435021930641e-01   -3.076479975067661e-01   -1.303700085774442e-01   -2.383973395378218e-01   +5.888765383028746e-01; +2.171267423630102e-01   +2.925276922101109e-01   +7.251417864649429e-02   +7.754523272347305e-01   +6.693353146725010e-01   +3.055935216584170e-02   -3.741714335813849e-01   +2.193295523011438e-01; +2.949114556724315e-01   +8.382228607273232e-01   -2.860197768969722e-01   -4.527627441679688e-01   +2.497088942228955e-01   +6.015372554888678e-01   +3.632127248336158e-01   +2.547918870517810e-01; +1.405039619307681e-01   +5.368880685557883e-01   -3.899096031877098e-02   +7.460495139926434e-01   +8.140493488933616e-01   -3.183706939693527e-01   -3.682344714069112e-01   -1.274116970865170e-01; -2.347924246563529e-01   -3.868282236472088e-01   -1.643373553716195e-01   +2.698090445988329e-01   +8.780453741058176e-01   +3.380584080047653e-01   -1.922535006392340e-02   +1.734813736467107e-01; +8.584579808214330e-01   +5.400486365501846e-01   +3.784003383553211e-01   +5.362023944362067e-01   +5.065454844820658e-01   -4.026031734948284e-01   +4.175585525137410e-01   -2.071477639551030e-01; +2.542380155321718e-01   +2.680556988711140e-01   -3.849842367716255e-01   -5.026146718781183e-02   +1.049195980055508e-01   -4.271437809216320e-01   +3.417854958050588e-02   +8.043923686761827e-01; +2.178800493992874e-03   +4.858795720675080e-01   +5.478805353399782e-01   -2.269643405698068e-02   +1.655407957849599e-01   +3.744293422309746e-01   +4.077811006153621e-01   +7.211080881171958e-01];
L3E_L2E_iAMPA_netcon = [+4.344733926125529e-01   -3.754022588939533e-01   -3.144598153611380e-02   +3.354117451854317e-01   +4.247290504964923e-01   +3.858032119573193e-01   -1.748272302135268e-02   +7.993876851914419e-01   +2.964741574099152e-01   +8.824439939068132e-02   +7.716768864381114e-02   -5.003958426374051e-01; +2.519751524575435e-01   +5.016188754918861e-01   +2.400439621884835e-01   +1.610011534293165e-02   +5.461438042116502e-02   -2.194715256440050e-01   -1.623774161615635e-01   +2.208876251944244e-01   +1.211656049825740e-01   +2.651851682694132e-01   -1.327962650320000e-01   +5.470948137791669e-01; -4.810004829954064e-01   -3.969412117724587e-01   +4.938672783877547e-01   +3.985197837986998e-01   +3.483612403584858e-01   +7.418798494431857e-02   +1.998621222784583e-01   +2.724112778243551e-01   +7.925275699797062e-01   -4.816462417807185e-01   +7.489709362826381e-01   +3.173452856530126e-01; +4.096993071553121e-01   +2.936261163880362e-01   +2.795963719709385e-01   -1.903916915926882e-02   +4.864069858120904e-01   +1.427471689724583e-01   +9.286868793158347e-02   +4.753840279458975e-01   +4.621663803508014e-02   -1.451318118548319e-01   -1.757520264443091e-01   +5.576936234339156e-01; +1.707177400491171e-01   +2.506701356767911e-01   +5.968672964341453e-02   +6.681642747956209e-01   +5.086367872423906e-01   +5.614564381191183e-01   +1.540937332013447e-01   +1.363001696630990e-01   -1.123676263139300e-01   +5.126502162894289e-01   +5.159806120344822e-01   +6.332431424225130e-01; +4.190660279914274e-01   -1.449462775376876e-01   +1.616981560434936e-01   -2.761622002397977e-02   +3.876536267849641e-01   +5.495113583582442e-01   -3.744617081983737e-01   -1.750323032341218e-01   +1.885458087392878e-01   +2.560224114091168e-01   -1.141185836388976e-02   -2.713201742183255e-01; +1.515740418524535e-01   +1.804570293079376e-01   +4.630527732938655e-01   -9.513370458705098e-02   +4.388891534312119e-01   +2.196962923278093e-01   +3.322852148824885e-03   +1.503317786126312e-01   +9.190076847210864e-02   +4.323380806212457e-01   -1.953118499292009e-01   +4.412313939995458e-01; -1.420767064245433e-01   +8.306453911167659e-01   +2.667135442737312e-01   -7.652404109073213e-01   +5.413614135030443e-01   -3.361669523191779e-02   -3.914995257907117e-01   -1.064142264284685e-01   +1.855848346863688e-01   +2.656716224619320e-01   -8.922103846542220e-02   +2.612718294706350e-02];
L3I_L2I_iGABA_netcon = [+7.907867324096669e-01   +6.945554635369268e-01   +9.100696856137183e-02   +3.041594691582759e-01   -5.576154628641449e-01   -4.547213920547593e-03   +1.000000000000000e+00   +6.043121007448964e-01   +6.431970504707735e-01   +9.927811706626705e-02   +2.133110083493541e-01   +1.088144194332085e-01; +2.022158767821674e-01   -4.185440835784705e-02   +1.979941186886561e-01   -4.849530557048889e-01   +4.376802994872162e-01   +1.307492121061063e-01   +2.347537359294271e-01   +1.043064681477308e-01   -4.167896144068449e-02   -3.535673347560028e-01   +2.424894636320405e-01   +2.101144624432290e-02; -6.611275703298038e-02   +2.723238177442167e-01   +1.916807909303606e-01   -1.671434751170663e-01   +1.231766481987282e-01   +2.923761324671349e-01   +3.805914681621781e-01   +2.707733409803307e-01   +1.567414307696366e-01   -3.259046604487100e-02   +1.440967122061915e-01   +8.118989280351477e-01; +5.442252811605266e-01   +2.391425569601242e-01   +8.237711075119721e-01   -4.004981101651527e-02   +1.760536121800684e-01   -1.759864296375139e-01   +2.526217107047648e-01   -1.185960996864136e-01   +3.408432289873007e-01   +5.839881594782680e-01   +5.540442623351743e-01   -6.606699687819657e-02; +4.865901030558010e-01   +3.324206499568331e-01   -7.952804001850850e-03   -3.335116761009474e-03   +6.150060955869713e-01   +5.311775737600933e-01   -1.774246011842145e-01   +8.167213661254017e-01   +5.972206920652360e-01   -6.136878296297318e-02   +3.438234739027664e-01   +8.220971010063848e-02; +9.808246887065443e-02   +3.590584994296305e-01   +6.960287732540432e-01   -6.839795816280543e-02   +4.072607261505994e-01   +2.341523259071733e-01   -5.714826412821472e-02   -1.604828032301252e-01   +5.917988616471800e-01   +3.816477371234172e-01   -3.875714022071543e-01   +1.591474693301682e-01; +5.841316455486404e-01   -1.407451956233340e-02   +5.532566297888172e-01   +5.188666628973255e-02   +6.311877864748399e-01   +6.681105981913317e-01   +3.884923951306613e-01   +2.904990125291754e-01   -5.721033405433930e-01   +7.279214544629887e-01   +5.796730086135893e-02   -3.400048532773365e-01; -8.317882537378394e-03   +1.927276982610351e-01   +4.897496876694875e-01   +3.135394728329772e-01   -3.656570878733097e-02   +3.362705698031821e-01   +7.009052065342000e-01   +6.857460274300445e-01   +4.437751209329100e-01   +2.749112469915624e-01   +1.734154449854803e-01   +2.625440078707919e-01];
L2E_L3E_iAMPA_netcon = [+4.796408892528553e-01   +3.431073291011059e-01   +7.564678511043769e-01   -5.880120961793576e-01   +1.379707190674683e-01   +4.852468212837160e-01   +6.623690564638657e-01   +6.695959279335335e-01; +2.302197935000095e-02   -6.671624945368418e-02   +1.417015785513236e-01   +4.099345112335478e-01   +5.795585383490531e-01   -3.581348023774731e-01   -2.994187828217236e-01   -6.219201006787177e-01; -3.748134618574626e-02   -1.129129428248737e-01   +1.579426995729267e-01   +2.410610393222014e-01   +4.714406506265739e-01   +9.923705037684866e-02   +2.186415965583390e-01   +6.978782059075779e-02; +1.646324796687281e-01   +1.699526318633389e-01   +7.778734901833926e-01   +7.701787132565847e-01   +1.961895608514250e-01   +7.396652123586047e-01   -2.139848645418662e-01   -4.160838567838326e-01; +1.255914651319964e-01   +2.216567553088586e-01   +8.145000698505367e-02   +4.532697091064745e-01   +2.447585316009840e-01   +2.074114849261001e-01   -6.422575118813445e-02   -2.465920451436812e-01; +1.535433167139876e-01   +5.294168358649534e-01   +4.405137989887722e-01   +6.716110825443047e-01   +1.559574879160101e-01   -8.743607178022418e-02   +1.180282460118795e-01   +1.131386832113731e-01; +3.109724776003045e-01   +8.099220760602797e-01   +5.675808430046343e-01   -3.554248516038491e-01   +1.076465365874115e-01   +8.589769535470008e-02   +3.484239740150288e-02   +1.090846041878777e-01; +3.879839968901592e-01   +3.922512990866002e-01   +1.491291405040341e-01   +2.302208718230957e-01   -2.513989338768082e-01   +8.398513511160161e-02   +1.205919294530326e-01   +6.543746807319436e-01; +2.333961284066134e-02   +5.088400399677530e-01   +5.864837522052126e-01   +4.272741471235072e-01   +1.514466526178053e-01   +8.200099412392459e-02   +6.082318351534615e-01   -1.751380347355601e-01; -1.410727457818324e-01   +1.318904343284218e-01   +3.948355923532331e-01   -3.872230045966334e-02   +5.100790329568650e-02   -4.138622821198976e-01   +4.053216516133393e-01   -1.941145120029157e-02; +4.407702543058483e-01   +3.467327052113759e-01   -1.876978778954206e-01   +9.942462081315925e-01   +1.636673781631415e-01   +5.817184800251817e-01   -2.286264660434680e-01   +2.879735316407984e-01; -1.418268274687292e-01   +6.438651518121966e-01   +3.169890045956672e-01   +3.775281354271188e-01   +4.451265652898451e-02   +7.442882396021148e-02   +7.922783639577312e-02   +1.658212126974587e-01];
L2I_L3I_iGABA_netcon = [-5.425708742413330e-04   +9.110957996663299e-02   +6.736709207597780e-02   +2.077820547547260e-01   +1.838161707566465e-01   +8.070337630237987e-01   +3.741718821099008e-01   -1.039272208401294e-02; -3.590163094407510e-01   +1.429232406910776e-01   -1.212243841738410e-01   +2.833874846997158e-02   -3.380730903017889e-03   -3.679642763178968e-01   +4.635387336081829e-01   +2.036206136346168e-01; +5.426477429227964e-01   +9.937048486426547e-01   +8.941591128018182e-02   +5.457363954570019e-01   +2.541795374133867e-02   +5.760629712695452e-01   -1.331927256783940e-02   +8.925046619685562e-02; -2.089134253672154e-01   +7.692397668061635e-02   +8.878054377524920e-01   -3.256318381007688e-01   +9.388038489852965e-02   +6.573844390720130e-01   +4.970526859844833e-01   +1.742099608454732e-01; +4.044894372599111e-01   +2.461752863609370e-01   +4.329560193910365e-01   +2.706918584148192e-01   +9.203290437681891e-02   +3.586622037957673e-01   +3.152161279849618e-01   -2.867184278380566e-03; +1.103754425231719e-01   +3.724835545637102e-01   +4.932296725885577e-01   -3.140420486103918e-02   +3.894193021002929e-01   +7.244090310449112e-01   -3.179443073668397e-01   +4.109293328449586e-02; +7.004033064649963e-02   +5.054828054591849e-01   +2.665222664831531e-01   +3.537368361977652e-01   +1.155757243920980e-01   +2.879236888746780e-01   +9.271188283312787e-01   +5.829706933998547e-01; -4.712167838360098e-01   +2.965599878193805e-01   +4.600690196186035e-01   -8.210896292967201e-02   +9.738393422916286e-02   +4.407788352640784e-01   +1.662978771642648e-01   +6.215295586651438e-01; -4.775818425595363e-01   +5.309526656418485e-01   +7.255128722431480e-01   -1.373612490670206e-01   +3.378750281272879e-01   +1.483443364251274e-01   +2.762929375420164e-01   +2.349883631626087e-01; -3.520491388336072e-03   -3.502266605285664e-02   +4.454234940943581e-02   -9.354417946981365e-02   +6.656776151820372e-02   +6.824605968752117e-01   +9.117840336779472e-02   +1.494266809655673e-01; +4.639896490676069e-01   +2.220067816146303e-01   -3.237065506451527e-01   +2.181769753993253e-01   +1.845456384598076e-02   -3.152913991261935e-01   +4.404682613372877e-01   +4.987761979482358e-01; -3.075731024335482e-01   +7.266018063539760e-01   -9.944175257087268e-02   +6.001691873767513e-01   +3.247696617150569e-01   +2.106823861709450e-01   +1.084990316486819e-01   -2.588744431515992e-01];
L3I_L3E_iAMPA_netcon = [+1.199467048415231e-01   -2.431266688518204e-01   +4.729664245252782e-01   +3.138282637633665e-01   -2.114316369339733e-01   +1.834249113566736e-02   +1.227420772428862e-01   +4.226796212901560e-01   +2.831341666273298e-01   +6.415546973190837e-01   +1.225275366176439e-01   +5.907288916085102e-01; +1.948796856709812e-01   +5.043861822559376e-02   +3.454198354094260e-01   +9.104237058951431e-01   +2.436295425586216e-01   -1.197594476491636e-01   +3.027026231859096e-01   +5.655669183984939e-01   +4.952718039786158e-01   +4.573535898845205e-01   -2.611060114082792e-01   -3.067863700684352e-01; +6.699175247498161e-02   +5.647865590029298e-01   +2.692800709755540e-01   -1.962604920700196e-01   +9.924162067552013e-01   +4.613019776672286e-01   +5.290390519630440e-01   -8.848499965931243e-02   +2.706347089423797e-01   +3.301395601580680e-01   -9.482928311232946e-03   +3.101237539993271e-01; +3.125755379316501e-01   +1.959443415214895e-01   +3.618969163875837e-01   -7.380037695936738e-02   -1.393299261867376e-01   +1.755607546242050e-01   +1.046558074576767e-01   +1.879557755566985e-01   +1.322334733048460e-01   +1.126931629363747e-01   -1.764146060354525e-01   +9.640779669643035e-02; +1.332072351304461e-01   +1.543272774764294e-01   +9.520197353199266e-01   +4.651080984104941e-01   -3.439088912482663e-02   +7.291154737528364e-02   -1.962891454750238e-01   +4.512108510403551e-01   +1.847238159564980e-01   +3.755494304866889e-01   +1.997521661338646e-01   -4.669099938197859e-03; +3.618664404681689e-01   -7.733751889782123e-02   +4.759574631407238e-02   +1.892220184429752e-01   +6.472440229669919e-02   -2.516582346768685e-01   +3.893332370070030e-01   +1.000184128754722e-01   +3.991210060653138e-01   +2.479338023232713e-01   +9.784146991109988e-02   +8.449053943247729e-01; +6.391537811170259e-02   +1.279142986916628e-02   -3.676850566181413e-01   -2.060213745672236e-01   +3.108107372533805e-01   -7.343424407091524e-02   +5.364515625352050e-01   +9.312600052157996e-02   +3.107835809718277e-01   -4.042703039770552e-02   +2.811485397478723e-01   +6.251120126900814e-02; -3.836417851012822e-02   +1.397647015952251e-01   -1.648915378416363e-01   -5.677075465008238e-02   +4.816272707891140e-01   +3.122679464629983e-01   -2.611628930849677e-01   +6.131138598328181e-02   -2.820333222756331e-01   -5.498378942484615e-01   -2.519264041542528e-01   +3.822301762264330e-01; -2.750303291760379e-01   +6.577541494752785e-01   +9.215933155600299e-03   +3.692287147737988e-01   +1.158529814139025e-01   +4.553198624858457e-01   +2.765054276941580e-01   +5.218130617122789e-01   -1.179469832076639e-02   -4.229654881149491e-02   +2.321650875184882e-01   +7.178523288326253e-01; +8.764999488578828e-01   -4.669614745393801e-01   +6.439703976501796e-01   +2.532472407087608e-01   -2.960128953311429e-02   -3.188466884259926e-01   +3.612031290568061e-01   +3.917832556678238e-01   -1.449658416161005e-01   -1.868754463831473e-01   +7.246637977817346e-01   -9.774672801906900e-02; -2.478288714981822e-01   +5.257203185965962e-01   +7.806403650925998e-01   +1.224946514766283e-01   +7.644120828175717e-02   +3.000996004581067e-03   +4.046138936572696e-01   +7.862247961136945e-02   +4.922489013628691e-01   +1.936084628587587e-01   -1.146092981243858e-01   +5.014188702883648e-01; +8.787219067948561e-02   +2.896798601261087e-01   +2.198352225538994e-01   +6.695012483645207e-01   -2.996645042014049e-01   -2.451436753344666e-01   -4.174259284818849e-01   +3.031221220892750e-01   +1.238715605950588e-01   -2.718266121152853e-02   +3.512416439963251e-01   -8.860464200374704e-02];
L3E_L3I_iGABA_netcon = [+1.520803392623103e-01   +1.616867674517302e-01   +2.649487946971001e-02   +1.672037798048198e-01   +1.609451876805633e-01   +6.738410464446135e-03   -1.686061900932156e-01   +1.508844590771166e-01   -1.986270491253109e-01   +6.105801845711769e-01   +1.903549529826533e-01   -1.485964766719920e-01; +1.220314066427120e-01   +3.613656298787550e-01   +3.981894896845201e-01   +1.143371175869452e-01   +4.709256210143483e-01   +1.055222777409953e-01   -2.059112361989377e-02   +1.166152022648386e-01   -6.185193828553371e-01   +1.663306396914470e-01   -6.477543905326464e-01   -2.061994296734259e-02; -6.298385856310630e-03   +9.427505839297594e-02   -3.474717100765417e-01   +1.491273667177816e-01   +1.017506223644678e-01   +5.621192411631309e-03   +4.951734159039293e-01   +6.983730587037013e-02   -2.273537106250207e-01   +2.173540229245551e-01   -2.113278940015333e-02   +1.469981126998164e-01; +7.754945244655916e-02   +1.783263894735592e-01   -5.138814932623537e-01   +4.869218687583727e-01   +8.339195996448645e-01   -8.141789809420624e-02   -1.286497967590011e-01   -3.337311151660347e-02   +7.347124587876270e-01   +5.163700577106433e-01   +6.920043791417392e-02   -1.603476513959565e-01; +3.162468801001094e-01   +1.842210876897425e-01   -6.161919098832804e-02   +2.120817960062779e-01   -1.539400350862148e-01   +4.942661845790382e-02   +8.529807958192076e-02   +5.241007582568163e-01   -3.371371019482128e-01   +4.233597036343161e-01   +3.332434166690119e-01   +1.264175292939892e-02; +1.791705528313136e-01   -3.829503663741668e-01   -6.748551779618289e-02   -1.722845659598712e-01   -1.930158619378568e-02   +2.125260471729154e-01   +2.244333793044956e-01   +1.068314180322271e-02   +4.363156208712584e-01   +2.674164411610686e-01   -2.154008616339915e-01   -1.034400092224928e-01; -2.000508366396035e-02   +3.286514507621260e-02   +2.231411614543719e-01   +7.075364357039299e-01   +4.258471842092521e-02   +2.579276392452659e-01   +2.786792975551923e-01   +5.232685272849580e-01   -1.390775201995073e-02   +3.622251049218155e-01   +4.529293054338587e-01   +3.341443927430192e-01; +1.847213945834323e-01   +1.818304283424123e-01   +3.424690274014781e-01   +2.039972263110132e-01   +1.343912670249977e-01   -3.292489392945178e-01   -2.342558571033633e-01   +4.890945307591124e-01   -5.920393403174723e-02   -8.872143190075014e-02   +2.471358126401156e-01   +3.361259917704364e-01; +3.862291636914688e-01   -6.266375167054068e-02   +4.160617780648182e-01   -6.299884083022178e-02   +4.178899890538251e-01   +9.695414695425651e-02   -5.645699692273297e-01   -1.656846383656854e-01   +4.638414402241854e-01   +4.914603217063112e-01   +6.779880250300742e-02   +4.957615853675134e-01; +1.636950621862832e-01   -2.323921939335382e-02   +3.049147100256696e-01   -1.250845957620342e-01   -6.135228560909217e-01   +6.155721811690685e-02   -5.461341357102664e-02   +1.650348401572653e-01   -1.869931294305064e-01   +1.737377437487225e-01   +2.292548689805512e-01   +1.633046750116503e-01; +1.704957092246707e-01   -1.474550833140709e-01   +2.603262267435542e-01   -1.842976521501088e-01   -6.050198501804840e-03   +1.502078863149378e-02   +2.900847246026133e-01   -1.441645060356651e-01   -7.479707166450353e-02   -5.342412443573492e-02   +1.787404246138716e-01   +1.576010645381477e-01; -9.707802869270489e-03   -1.605878075091020e-02   -2.907250535453340e-01   +5.094641744926948e-04   +1.000000000000000e+00   +3.079489027525021e-01   +5.097985242426410e-01   +3.144292692272193e-01   +1.022250388396963e-01   -3.074593845115217e-01   +3.011834343068360e-01   -3.597299441608506e-01];
L2E_Input1_iAMPA_netcon = [+9.209896735180619e-01   +9.945001329409425e-01   +5.704076891478613e-01   +7.243294996098959e-01   +7.894085664544307e-01   +2.346232718951519e-01   +7.302237714221292e-01   +7.085495912331425e-01];
L2I_Input2_iAMPA_netcon = [+5.496956076851832e-01   +5.326117357268125e-01   +7.437951734845716e-01   +4.295376765605070e-01   +1.047788905127904e-01   +1.000000000000000e+00   -8.914861684461151e-02   +2.273224895317465e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
