function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.075125225376281e-01   +2.898573145814206e-01   +1.343538547350412e-01   +4.871790538456230e-01   +1.534116847052821e-01   +7.699590274512179e-01   +4.880106426042925e-01   +7.769386045600651e-01   +2.512756161501288e-03   +7.149777717535629e-01   +1.904212519329244e-01   +5.325498674557710e-01   +1.187677225558492e-01   +5.601686669257745e-01   +2.024813059923675e-01   +4.009973583745880e-01; +7.475397313170975e-01   +7.645937630809964e-01   +6.458842212639576e-01   +3.580611518495428e-01   +3.070157008170076e-01   +6.110469910306291e-01   +6.687956029506484e-01   +6.286685145918675e-01   +4.820183990522801e-01   +6.111779161779926e-01   +5.913171381203784e-01   +1.619551957323223e-01   +5.507834414518763e-01   +3.090591238619894e-01   +1.311304358715421e-01   +6.910163886623126e-01; +5.338854393913899e-01   +4.316584030626174e-01   +7.322756814204170e-01   +7.322410330685628e-01   +9.963171890248880e-02   +4.014519327142558e-01   +3.644877844224320e-01   +2.245638804500262e-01   +5.416963197635171e-01   +4.897315541574487e-01   +4.574115286977175e-01   +6.609088969401860e-01   +1.639144913659758e-01   +4.491834058622846e-01   +3.052139376384847e-02   +4.313910265552277e-01; +2.761210673272508e-01   +7.016795888833638e-01   +5.491763738856055e-01   +1.839666508676088e-01   +6.410854379563059e-01   +7.647437052679223e-01   +1.465690117744734e-02   +6.549312004610780e-01   +7.888099320324311e-01   +8.125666414821847e-02   +4.631920292416194e-01   +1.025734404061705e-01   +2.866220818737052e-01   +1.511268136111689e-01   +1.926840517623836e-01   +4.896261840344343e-01; +2.815811441498035e-01   +1.298655491028492e-01   +7.714387908724151e-01   +2.409532527013870e-01   +2.969423637907226e-02   +2.106047197266406e-01   +3.969361748914549e-01   +2.111459579406280e-01   +4.326013995051842e-01   +4.955687972794317e-01   +2.284551151608313e-01   +5.255852646592819e-01   +1.558380920861568e-01   +3.729529746064891e-01   +1.142284279184755e-01   +1.408343736906798e-01; +4.727633154089081e-01   +7.977562467981564e-01   +5.513602010080316e-01   +7.704553783128343e-01   +7.633005594676829e-01   +5.747490011558585e-01   +5.555463053264906e-01   +3.407496898312558e-01   +1.862512499585490e-01   +4.372220166244681e-01   +2.356033316073855e-03   +7.704509762549525e-01   +2.201809446691000e-01   +6.516038628905498e-01   +3.604478109974060e-01   +2.751773260997342e-01; +7.131598070656182e-01   +5.666572989897678e-01   +1.184990479725524e-01   +6.985081993214697e-01   +6.278481526791085e-01   +6.538613766852705e-02   +7.504644948424286e-01   +5.057596432717398e-01   +1.040566133840315e-01   +7.928889350034672e-01   +6.337025022700377e-01   +3.578359950899402e-01   +5.807436987321682e-01   +3.828361406789798e-01   +4.516964207226096e-02   +1.361466162487196e-01; +1.900546885871541e-01   +2.443092651118197e-01   +6.040584573137036e-01   +2.469839516738370e-01   +3.232043786815086e-01   +6.951401063639772e-01   +2.164494070223286e-01   +1.942641958785510e-01   +6.245158904422229e-01   +4.925822269183071e-01   +7.071502441917539e-01   +7.265901701222954e-01   +4.511203728589154e-01   +1.034363247268527e-01   +1.351927907628503e-01   +6.740139235345919e-01; +2.241293992315622e-01   +2.107172565194274e-01   +5.972247576350401e-01   +7.947311007509874e-01   +3.293019387947645e-01   +7.194683528598087e-01   +5.997704171389071e-01   +5.944132869529432e-01   +4.668538124119085e-01   +3.567577870407119e-01   +6.837796920041358e-01   +3.653882935638698e-01   +6.888713222748301e-01   +7.114548096605219e-01   +2.742234232685546e-01   +7.498629347970874e-01; +2.476559323735309e-01   +5.646834245513044e-02   +3.635088543323283e-01   +1.034188352994579e-01   +2.629354161740370e-01   +4.964693363244456e-01   +2.725768791939165e-01   +2.481711627457703e-01   +1.599564311212335e-01   +2.689743823279080e-01   +5.357038819851652e-01   +2.815900590787383e-01   +2.079415423393420e-01   +1.456619688063616e-03   +5.398164546627612e-01   +6.589309118985195e-01; +7.268638975818582e-01   +6.224732120621298e-01   +3.332538552756729e-01   +4.311999545886764e-01   +3.130501952775979e-01   +1.719687100712980e-02   +2.376880938312277e-01   +6.867561157166739e-01   +1.152964781962479e-01   +6.396650665160498e-01   +5.386840112623644e-01   +3.694795791936099e-02   +5.625790929616898e-01   +2.299012811371192e-01   +3.577392212697008e-01   +6.058288016465262e-01; +4.241980174309786e-01   +7.100585717564347e-01   +1.168122270580384e-01   +1.160722180566028e-01   +6.791214492487005e-02   +2.367849499319079e-01   +3.988728062011391e-01   +6.731618997788430e-01   +2.323389729916040e-01   +4.411551811939695e-01   +4.010811702487896e-01   +2.767526233456852e-01   +5.546021911430210e-01   +3.396616538295867e-01   +4.037549287987765e-02   +9.598509346654636e-02; +7.217411811096597e-01   +6.113158703883508e-01   +7.438402961722556e-01   +3.145101392840275e-01   +5.899400421992588e-01   +2.907419239653636e-01   +6.001235727376514e-01   +8.305814593815118e-02   +6.604566297480813e-01   +3.570250740249528e-01   +4.034639832466875e-01   +3.926974755079207e-01   +8.078220531958563e-01   +1.134709570612014e-01   +7.561841144430712e-01   +7.912648889085896e-01; +4.194021520359206e-01   +2.715393209944206e-01   +6.842111809411529e-01   +4.961900370982312e-01   +1.357006981582978e-02   +2.555119835840608e-01   +1.603323466502910e-01   +3.072810080442385e-01   +5.182396054915847e-01   +6.280873039417292e-02   +3.196356162617224e-01   +3.476194625472777e-01   +7.564993455601338e-01   +7.187532529133608e-01   +6.825831028657452e-02   +4.662528801418337e-01; +1.464228234445334e-01   +4.706559401597646e-01   +6.235029771061485e-01   +5.907164212943283e-01   +3.360311012341529e-03   +2.242982363951665e-01   +4.720712717090187e-01   +5.043287525952949e-01   +5.850527025707235e-02   +5.153768128407648e-01   +7.149330970324936e-01   +5.111604486480651e-01   +1.394295061386910e-02   +7.197000418965196e-01   +3.324540759347205e-01   +3.553942527026944e-02; +4.697308897144245e-01   +7.375155250376118e-01   +7.369986328064844e-01   +1.983377222073744e-01   +2.320147892751822e-01   +2.623234008471838e-01   +5.036892153349206e-01   +4.628045171284038e-01   +3.744570116850235e-01   +3.095049287173441e-01   +1.385479104340821e-01   +5.786559077114029e-02   +1.728823716163013e-02   +7.810492612376286e-01   +1.700634002201534e-01   +7.216920233382883e-01];
L1E_L1I_iGABA_netcon = [+3.246998117453139e-01   +2.751611363393116e-02   +3.185070695048061e-01   +1.787761630565158e-01   +6.981007039357287e-01   +2.239294926725875e-01   +6.437532251326863e-01   +7.509700412438387e-01   +4.400593414603272e-01   +5.427768307921040e-01   +6.394458376383981e-01   +3.094046223777589e-01   +4.246545356629620e-01   +5.321043610900479e-01   +1.263986269837048e-01   +7.113118791445289e-01; +5.505838137095780e-01   +5.911504405337287e-01   +1.882775874014128e-01   +1.876957442663042e-01   +5.498180107979836e-01   +1.958316881188830e-01   +1.877253412437748e-01   +2.718642282498772e-01   +3.935263795687325e-01   +7.909901724649913e-01   +1.462980010498034e-02   +4.506873782360980e-01   +5.758122981489986e-02   +2.088520934085370e-01   +4.758654260253112e-01   +1.494023821341049e-01; +5.623519236849226e-02   +2.772923289885065e-01   +6.960216761059042e-01   +3.396674435846613e-01   +2.784050215485615e-01   +7.247228656289435e-01   +2.381573163815043e-01   +2.559717659570491e-01   +6.441255503777719e-01   +7.405711595173684e-01   +1.445790405252689e-01   +2.167098502615851e-03   +7.662195065751749e-01   +2.779716764488208e-01   +2.969037277096065e-01   +6.228451288538024e-01; +7.381909832230688e-02   +6.867171031805575e-01   +1.769244445253616e-01   +2.123675048001038e-01   +1.327388214051934e-02   +1.231667076184774e-01   +5.977516387077509e-01   +4.531746942740269e-01   +3.722330142337342e-01   +2.605596038412327e-01   +1.548660809899001e-01   +1.108243228810965e-02   +1.218533996468821e-01   +1.905728340501593e-01   +1.472787797007687e-01   +8.005288542318489e-01; +1.121535129704109e-01   +2.327191699358691e-01   +4.988976889204774e-01   +4.913246110839636e-01   +5.447513748213865e-01   +5.616203503906863e-01   +7.087457523837015e-01   +5.910076150815748e-01   +6.236083318025656e-01   +2.491524934427494e-01   +7.697310484376976e-02   +2.226851669635793e-01   +8.020161326659055e-01   +6.148727675039113e-01   +3.737663999353287e-01   +4.571906223986701e-01; +7.341201898989507e-01   +6.562319738087895e-01   +1.441776716445275e-01   +8.070175248669657e-02   +5.946448131900860e-01   +5.929821382849485e-01   +5.325875698711804e-01   +1.523629067649467e-01   +1.760071582219020e-01   +7.984519642278971e-01   +7.791532886971898e-01   +3.986438966772681e-01   +3.102932193904890e-01   +7.053109371335634e-01   +2.531527272269732e-01   +5.385867697939679e-01; +4.330019052617601e-01   +5.369314808882250e-02   +7.945542890264157e-01   +6.812928569248908e-01   +6.493682072616492e-01   +2.958001845315557e-01   +4.464930563601633e-01   +7.600560095159997e-02   +6.948355278167083e-01   +2.504019439498542e-01   +7.689727944112863e-01   +4.919948435474554e-01   +4.904386561687530e-01   +6.612570217713624e-01   +2.022554379682388e-01   +4.530781423731252e-01; +4.960228961550595e-01   +6.713058629678350e-01   +2.667930902411578e-01   +2.273777828138032e-01   +4.900452397054957e-02   +7.853855127080145e-01   +2.181855837515496e-01   +5.596918711461761e-01   +4.876345045237452e-01   +1.355621580882718e-01   +7.266225008798903e-01   +7.617401210377794e-01   +5.066238436270800e-01   +4.756728921947537e-01   +5.036917712734697e-02   +3.458618032277449e-01; +4.099269504819548e-02   +4.456596506006207e-01   +1.665336640812381e-01   +3.980106402647072e-01   +8.028390500410469e-02   +3.473224596952405e-02   +8.448872835383692e-02   +1.921342335441604e-01   +5.036630835032568e-01   +3.828932097016307e-01   +2.195608121607448e-02   +7.871132204821113e-01   +6.002285757191036e-01   +1.863456765827277e-01   +5.118082130635524e-01   +2.975732108973452e-01; +7.741283103906485e-02   +7.117253396731372e-01   +6.014006492172406e-01   +8.066266700230262e-01   +1.402718801157949e-01   +2.897975695847033e-01   +7.523630440006054e-01   +6.083099104818008e-01   +6.628629118270590e-01   +8.074110867890210e-01   +7.919418761130885e-01   +1.105071289191755e-01   +1.368579879217094e-01   +7.000148451626995e-01   +1.682356527305877e-01   +5.542707311773889e-01; +5.743992577949463e-02   +1.835715551520192e-01   +4.115878612554265e-01   +6.535397252712056e-01   +6.239649387331014e-01   +4.869012070655888e-01   +4.775285460706942e-01   +3.784061273523681e-01   +5.305500247901812e-01   +7.501386624996878e-02   +3.284867731013694e-02   +2.837481259652138e-01   +6.772008536222830e-01   +6.749056442249035e-01   +7.035351231694248e-01   +6.829023881072069e-01; +1.608137789529589e-01   +4.377227511763330e-01   +3.457582163074466e-01   +3.693023169395657e-01   +1.299984698004541e-01   +7.964261629005284e-01   +3.848321695297742e-01   +4.187354425604284e-01   +2.514102566712000e-01   +2.220369053703314e-01   +3.595854182761968e-01   +4.677902912593586e-02   +6.545865560305112e-01   +4.884334741417773e-01   +3.195878181623287e-01   +9.342957030822911e-02; +4.346865663550024e-01   +2.996049816429161e-01   +1.241879066340313e-01   +1.548691574473329e-01   +6.259567978945503e-01   +5.810078261522454e-01   +2.695957680408048e-01   +5.123510285051905e-01   +6.866683546426607e-01   +3.600353971059650e-01   +2.563025684414921e-01   +5.007793184450382e-01   +4.800544767623882e-01   +5.701238387058581e-01   +3.817668572400529e-01   +8.033562810882589e-01; +5.058181508565581e-01   +8.052238603818088e-02   +4.604289271270180e-01   +6.438566307873893e-01   +7.797777833532699e-01   +1.411830039558394e-01   +5.289275417324386e-01   +4.022707673546255e-02   +2.598239098526780e-01   +2.247978211981279e-01   +5.818028366034759e-01   +7.503374938444728e-01   +1.924514506779019e-01   +1.725900767057816e-01   +4.812114316465213e-01   +1.489443865834592e-01; +3.828219586154671e-01   +6.794857809347925e-01   +4.924637345644053e-01   +7.180441279134652e-01   +2.209930607685851e-01   +4.792367924810062e-02   +4.839704438154412e-01   +3.737797786466494e-01   +7.511084143599167e-02   +3.613416469797627e-02   +3.364488580481225e-01   +6.121532412360170e-01   +6.375791200313571e-01   +3.892587354597438e-01   +8.519359738242293e-03   +3.005675528042872e-01; +8.505947551116061e-02   +1.671268983166900e-01   +6.853289815412935e-01   +5.371729375507537e-01   +4.140990038295956e-01   +1.973387734577084e-01   +7.767860378737501e-01   +6.080930319130203e-01   +6.292389289141722e-01   +4.149267872515270e-01   +6.867133517728877e-01   +7.111007277163013e-02   +5.955539156428818e-01   +3.655237316398471e-01   +6.862504091201690e-01   +3.376112412469843e-01];
L2I_L1I_iGABA_netcon = [+1.138692105525747e-01   +7.680000370893724e-01   +6.742502251606282e-01   +2.695039096785442e-01   +7.536469535749049e-01   +1.810123950444577e-01   +5.891618637685487e-01   +7.136138042968149e-01; +1.933493279330367e-01   +5.626569794667582e-01   +7.326973019075788e-01   +3.439330462883889e-01   +5.999323804586356e-01   +7.868391795019601e-01   +7.678829450064848e-01   +2.585215255148318e-01; +4.350723580152101e-02   +7.407109283758605e-02   +7.532953123687386e-01   +5.782898623200348e-01   +5.734366565880769e-01   +1.376901021264337e-01   +6.691143894719724e-01   +2.508073613644507e-01; +2.016756178396562e-01   +4.000029069189078e-01   +4.897853742128935e-01   +6.096890243586807e-01   +5.048719678551242e-01   +4.721043043199755e-01   +2.892953815418182e-01   +2.389396374091405e-01; +6.722802274097348e-01   +5.711545698366238e-01   +3.866426988640335e-02   +3.000204741459568e-01   +7.726459094068119e-01   +2.068020320303752e-02   +8.082359454851755e-01   +4.461439807605503e-01; +4.326302507873172e-02   +3.760652207069883e-01   +3.751368240731246e-01   +3.341200708133759e-02   +7.668598180320781e-01   +6.374855743539591e-01   +2.221526132109852e-01   +7.608258155354286e-01; +5.827308480212103e-02   +6.294623231370197e-01   +6.029875984996588e-01   +2.292054000484166e-01   +3.460566636426656e-01   +5.475815875193216e-01   +5.814245880641339e-02   +6.293195921836751e-01; +7.935339709008131e-02   +1.668266521674474e-01   +7.329509051809353e-01   +3.168311335560215e-01   +7.846612288693692e-01   +5.824684522427962e-01   +8.085666012133642e-01   +3.165462795572710e-01; +5.707432659547507e-01   +2.556838914262162e-01   +4.086086949681689e-01   +2.661895917251003e-01   +7.113222356482857e-01   +3.818758749528590e-02   +4.881531347075886e-01   +3.715780856847600e-01; +1.192600275162101e-01   +1.473790260536484e-01   +5.225813249640296e-01   +6.923773486874545e-02   +4.270249263110458e-01   +8.144900612056641e-02   +4.642169796824838e-01   +5.390715940264184e-01; +6.055835633527729e-01   +1.733282778427269e-01   +7.981536277294744e-01   +3.768096866078473e-01   +1.524224901193872e-01   +3.421235814927113e-01   +5.390003201153988e-02   +3.076500073472208e-01; +5.926674478825561e-01   +5.827448172544606e-01   +3.278921467943502e-01   +6.526943971736623e-01   +7.247371728175143e-02   +1.249508774137171e-01   +1.855825922958860e-01   +4.605360834882935e-01; +2.501590637582770e-01   +2.508226861909710e-01   +7.528864531111968e-01   +7.254353073327586e-01   +6.187252216405816e-01   +7.267514897195110e-01   +6.398569535559026e-01   +6.543566179338581e-01; +7.603681901723865e-01   +7.157320422739025e-01   +6.407715684349141e-02   +2.917188393977382e-01   +4.965760914630777e-01   +7.846743721960102e-01   +1.231776161435466e-01   +3.451351069806143e-01; +5.691149967988453e-01   +8.079360989409151e-01   -8.504259370731636e-05   +3.603742940375175e-01   +4.000494575904413e-01   +2.820233877348676e-01   +5.682671637612227e-01   +4.660505473276150e-01; +7.469612836861077e-01   +6.891929538354239e-01   +2.997720408513143e-02   +1.591938781076778e-01   +5.101687005707862e-01   +3.987028271840554e-01   +3.849472015856169e-02   +1.433287903350006e-01];
L1I_L2I_iGABA_netcon = [+6.971524593041616e-01   +2.467515367612650e-01   +2.974066140245659e-01   +2.228507294013994e-02   +1.493774178343819e-02   +3.151513477902863e-01   +4.117433277849531e-01   +6.896524128239684e-02   +1.790264366651692e-01   +6.625907291620480e-01   +1.223528274972255e-01   +5.431310230011486e-01   +4.768187214974339e-01   +3.921264225160758e-01   +6.567520768685666e-01   +2.004362755490111e-01; +3.473120436646115e-01   +8.650728917331844e-02   +3.730768438691900e-01   +7.758827282497895e-02   +7.984929344330378e-01   +5.692920577045530e-01   +3.526780464479408e-01   +3.822143519661685e-01   +8.275168335818929e-02   +7.444916802116761e-02   +7.917526784234030e-01   +1.400207247395485e-01   +7.685287499034220e-01   +5.024971028734090e-01   +7.977897006882322e-03   +5.925032083098858e-01; +2.719570267885549e-01   +3.591728860887165e-01   +1.997901034606320e-01   +2.537526658765399e-01   +1.172326521312875e-01   +7.348743105000989e-01   +6.885417367875524e-01   +6.634568141111185e-01   +5.185822172578107e-01   +2.644741780782819e-01   +5.533204905101883e-01   +5.193982935359109e-01   +3.259023570759698e-01   +4.277268773752035e-01   +6.620614164638684e-02   +2.471783663573430e-01; +4.728750497050685e-01   +7.805829460196544e-01   +3.156370230462905e-01   +7.019337625428339e-02   +6.021793252222253e-01   +2.812772469454690e-01   +2.448983083843075e-01   +3.531303231633859e-01   +2.527224529411781e-01   +3.904968181296064e-01   +5.888703281980038e-01   +2.310910334811888e-01   +6.433906525982092e-01   +6.549907027898394e-01   +1.125394362141444e-01   +4.706298813253154e-01; +6.010514654170016e-01   +3.812488846817391e-01   +3.200844681639163e-01   +5.489163417886154e-01   +1.786809767549991e-01   +5.632811116777297e-01   +8.694454251883006e-02   +1.994908798491304e-01   +7.301351123197175e-01   +7.222767850123221e-02   +6.126960993764541e-01   +6.521196907984007e-01   +2.459126051117295e-01   +2.707231580115322e-01   +3.474333604753778e-01   +7.025131179522300e-02; +6.256046411967653e-01   +7.302064171155180e-03   +1.073562390611338e-01   +1.428561827639997e-01   +2.271879427852095e-01   +5.507095407701635e-01   +3.968260828114854e-01   +6.980399792504476e-01   +6.465079058942469e-02   +5.419472918677807e-01   +5.165171351350155e-01   +3.690172867031926e-01   +2.945291795915426e-01   +7.824212657539100e-01   +3.650834970439727e-01   +2.897134159607054e-01; +5.313524601882265e-01   +3.543085065646980e-01   +6.312650814288339e-01   +1.494981898672287e-01   +2.087176897164989e-01   +1.511444589490064e-01   +6.688915677542510e-01   +3.333164334918634e-01   +2.675390410608946e-01   +6.325351454581107e-01   +5.978022022028535e-01   +1.233188797854440e-01   +7.784791913333547e-01   +3.723370567921895e-01   +4.588177769779648e-01   +7.198449744220443e-01; +6.994455100505971e-01   +4.525398044643246e-01   +4.267771056735613e-01   +4.819067105323958e-01   +8.956145814377521e-02   +4.414754468404294e-01   +7.043238853581236e-01   +6.159931811817704e-01   +6.905204294018631e-01   +3.801974137310994e-01   +5.874258415482912e-01   +1.028865470039772e-01   +3.872472988846445e-01   +5.912799060414251e-01   +1.048472193592590e-01   +4.058911715143881e-01];
L2E_L1E_iAMPA_netcon = [+1.573550161524772e-01   +6.681131521680433e-01   +4.021186052418556e-01   +6.926601696754614e-01   +4.101120481186495e-01   +3.372295736533785e-01   +3.159988626645240e-01   +1.843732442147941e-01; +3.385630829248762e-01   +1.042541883812784e-01   +6.283359428282177e-01   +2.479483463456768e-01   +1.057677174226174e-01   +6.576149327093265e-01   +2.109031534951993e-01   +2.129396517836305e-01; +6.439370034970051e-01   +1.955280735225567e-02   +7.449037600078525e-01   +7.861047994802339e-01   +2.542846972780272e-01   +2.667803474648274e-01   +6.665936323393584e-01   +2.665369228893213e-01; +3.676607667068502e-02   +3.003514446337506e-01   +2.565986859320706e-01   +7.548177374940593e-01   +7.456232982988679e-01   +7.662238150071697e-01   +5.614881403947537e-01   +3.447047579016952e-01; +6.568774520928850e-01   +6.120903262703331e-01   +4.528818008758363e-01   +8.022763445274209e-01   +6.397636978319402e-01   +6.032983578158519e-01   +3.635685513890146e-01   +2.401990182045060e-01; +1.601470642819872e-01   +1.538528330576990e-01   +3.743701523037379e-01   +3.799137981679870e-01   +2.364494302271485e-01   +3.388744354318032e-01   +4.812823334757905e-01   +7.941328303253311e-01; +8.037135047233802e-01   +1.199456503252078e-01   +5.529866729738412e-01   +3.397441830420266e-02   +5.850309135626566e-01   +7.306322264938431e-01   +6.513707307257868e-01   +9.782898657049129e-03; +4.538932702077152e-01   +2.876728567772264e-01   +3.881910653743303e-01   +6.237613015051078e-01   +9.009533913013572e-02   +7.232212248887371e-01   +1.298874545459235e-01   +4.395556526945119e-01; +7.134002267082573e-01   +5.410410942246101e-01   +4.704176088324342e-01   +5.404021340423448e-02   +5.604882339474841e-02   +6.828162555528301e-01   +7.584651008378160e-01   +6.579046005203758e-01; +1.537355993116466e-01   +3.094231577427901e-01   +2.750613813419718e-01   +4.887256490854111e-01   +6.255590196970802e-01   +2.337544661341201e-01   +6.787240235503234e-01   +4.518429171744918e-01; +6.229847739624205e-01   +1.120342553799673e-01   +6.241714200332978e-01   +7.135462872454886e-01   +1.905975744203689e-01   +1.351762208313556e-01   +6.445834459383978e-01   +3.186932786741701e-01; +6.499481001569539e-01   +7.285895401421106e-01   +9.249848156586586e-02   +2.640444685327898e-01   +2.731308530499439e-01   +3.130980658985557e-01   +2.863094571036707e-01   +1.171171885707377e-01; +4.889689293069366e-01   +5.205923813694778e-01   +7.483891931207244e-01   +1.348837687176987e-01   +4.576112945353296e-01   +2.849529699037736e-01   +5.802093649282661e-01   +6.098057301256717e-01; +6.694197035606529e-01   +4.374271749068194e-01   +3.812423553621720e-01   +5.787503577210554e-01   +2.988553379550868e-01   +3.523548491723446e-02   +1.153149625141926e-01   +3.292790844707830e-01; +4.109088175592976e-01   +2.921247533349862e-01   +6.878493215689532e-02   +1.161587077428159e-01   +1.169207469535343e-01   +7.851200739848490e-01   +7.659664502717888e-01   +5.240569419834208e-01; +6.806635917620962e-01   +3.315016413495910e-01   +1.006882120658910e-02   +7.822199207252567e-01   +1.185693654057139e-01   +5.643524450281561e-01   +2.616235816992267e-02   +1.844484228751301e-01];
L1E_L2E_iAMPA_netcon = [+3.174662574274553e-01   +7.332297984687781e-01   +3.204522818233468e-01   +7.541118736212370e-01   +5.097740162752762e-01   +7.187542858871716e-01   +1.640769731227616e-01   +2.838548929353849e-01   +6.992171026573241e-02   +7.490255854727889e-01   +3.768407282306371e-01   +5.051889218453107e-01   +7.307724671298370e-01   +6.045136337690362e-01   +7.432360331502866e-01   +3.806160916286832e-01; +1.314051183906276e-01   +2.331086949494456e-01   +4.064413085600054e-01   +3.954400442028018e-01   +1.699475405340499e-01   +7.734503197858797e-01   +3.683209468670048e-02   +1.559920199445781e-01   +6.483963897120428e-01   +7.062939304271000e-01   +6.294441363067867e-02   +4.269374642541869e-02   +6.700794710957566e-01   +6.814010423069060e-01   +5.086233469935671e-01   +2.243514642340959e-01; +2.560594555122841e-01   +2.462563419743215e-01   +8.809055771912441e-02   +3.321179753681178e-02   +3.762267911606850e-02   +6.206812780748460e-01   +6.951663792756729e-01   +3.179725655951790e-01   +1.777134479891859e-02   +7.996523743659096e-01   +3.621249567102128e-01   +4.812036884166055e-01   +4.858007898801934e-01   +7.952156401099365e-01   +2.735319447509450e-01   +4.394953938841489e-01; +4.080812043159263e-01   +2.626550787462276e-01   +6.264709897050490e-01   +6.127627829406073e-01   +1.796213796686624e-01   +1.818431748644996e-01   +5.491197003803329e-01   +3.850384303437013e-01   +5.467708630210805e-03   +4.402386890429929e-01   +6.061927398547881e-01   +6.771715866413224e-01   +1.431383263325495e-01   +6.953110357636265e-01   +5.277335248500513e-01   +4.438981771554428e-03; +2.714829977108247e-01   +1.048130991267208e-02   +2.685151271290022e-01   +6.624776657272964e-02   +2.812724091762600e-01   +2.484791094598207e-02   +6.145503457260861e-02   +3.255632369145903e-01   +3.196046983353935e-01   +7.546450526944833e-01   +1.626455836871967e-01   +3.544843868158878e-01   +6.655941525750215e-01   +2.191892807234408e-01   +4.855895266351830e-01   +5.390158728964298e-01; +2.365319929388274e-01   +5.874345368642084e-01   +4.489391159767778e-01   +2.723102576418623e-01   +3.945668969256214e-01   +1.093367010657933e-01   +6.234192351164578e-01   +2.346796000890219e-01   +3.961395467778096e-02   +5.688958212257132e-02   +3.141116126831683e-02   +7.774848557515969e-01   +4.090638064830972e-01   +1.343877817265092e-01   +3.185632679925842e-01   +6.573208149537646e-01; +1.973716609990017e-01   +2.962358844741624e-01   +5.475032626085702e-01   +4.568902058615860e-01   +5.260476896504147e-01   +6.078208269933102e-01   +3.002805893145487e-01   +2.970484161950838e-02   +2.392720322573012e-02   +7.961230707460278e-02   +3.976635083009535e-01   +6.593974153215550e-01   +7.367147499182881e-02   +7.893439141515445e-01   +3.647328044192111e-01   +2.497539909147121e-01; +2.301578497452008e-01   +1.227260863779267e-01   +2.963490719879897e-01   +2.680535899507712e-01   +4.480684268254317e-01   +1.840804542220443e-01   +3.309811172164737e-01   +5.867835036440182e-02   +3.423204102713774e-01   +1.312599984407258e-01   +6.947295148313374e-01   +7.461628727880478e-01   +2.354703939182752e-01   +3.900533286822150e-02   +1.098237324654917e-01   +3.843810343390075e-01];
L2I_L2E_iAMPA_netcon = [+1.079052079778432e-01   +1.401764914994979e-03   +4.009325160628880e-01   +4.235908574108614e-01   +4.262542873310099e-01   +4.016889577255024e-01   +9.100849137218381e-02   +4.912066771197857e-01; +4.857632085102740e-01   +1.264949075137320e-01   +8.079536211955417e-01   +1.927004944572662e-01   +6.197732411916931e-01   +3.119035003743957e-01   +7.035095407029063e-01   +1.170162599101759e-01; +6.199242205934457e-01   +1.409086879146365e-01   +7.115199635952912e-01   +7.753841646925362e-02   +6.463160691865337e-01   +6.917569633117198e-01   +7.735167661461954e-01   +7.666566689230847e-01; +2.046763840085104e-02   +4.660235345552061e-01   +1.081615705881075e-01   +4.462192351581338e-01   +9.142091035538520e-02   +6.976850252698141e-02   +5.362877110279920e-01   +1.778404240346592e-01; +8.005356566288574e-01   +4.573322294558713e-01   +1.683959420632466e-01   +4.714751156534998e-01   +1.264217089399974e-01   +3.847779016047888e-02   +3.015269407610554e-01   +3.504422127176140e-01; +3.582275008396388e-01   +8.075962571197773e-01   +2.682506192172321e-02   +7.226948694566364e-01   +4.259467937932278e-01   +1.412342332939877e-01   +5.936621050470348e-01   +1.957306265657829e-01; +3.716870327481698e-01   +4.198519661422612e-01   +1.723062351054670e-02   +3.045712116239471e-01   +3.966996116473686e-01   +7.307873968749634e-02   +1.483447412521302e-01   +4.254369479097676e-01; +7.252761412855558e-01   +4.296708475229521e-01   +7.329788917427279e-01   +6.434506089762383e-01   +4.109638200336779e-01   +7.032418957000759e-01   +2.885450210863961e-01   +7.758303856650862e-01];
L2E_L2I_iGABA_netcon = [+4.210542778780160e-01   +1.173440339535115e-01   +7.169459666968201e-01   +6.876629558761416e-01   +1.423271835170619e-01   +6.632506610042099e-01   +4.309137978461243e-01   +6.539767685300383e-01; +4.489770744837475e-02   +5.461380736865251e-01   +3.315065468657556e-01   +7.055288762961879e-01   +7.957549210259980e-01   +5.675323012548417e-01   +1.114623311703028e-01   +3.950610028516383e-01; +7.895067057422723e-01   +2.114045034656810e-01   +2.792134175038359e-01   +7.606061471931684e-02   +2.520918312650597e-01   +6.989179687098274e-01   +4.973068463798583e-01   +2.761006190849326e-01; +2.146826630511622e-01   +3.935882881567909e-02   +5.633116061279420e-01   +5.108783558241512e-01   +4.167069941833179e-01   +3.063066486511342e-01   +5.489892918757948e-01   +2.309638576862538e-01; +7.555022012800805e-01   +1.096869595781175e-01   +2.332862982340726e-01   +3.819977178924693e-01   +7.914508957232234e-01   +9.282886813295600e-02   +2.676624416062306e-01   +2.603898827913024e-01; +4.791578094076136e-01   +7.145836410521681e-01   +6.432906228429645e-01   +9.124558221439870e-02   +6.795489335957366e-01   +6.379435318362513e-01   +6.740554081865464e-01   +5.336175989511195e-01; +4.147874535507111e-01   +1.849874121472035e-01   +6.452275273965528e-01   +7.182748211810729e-01   +6.870589487550779e-01   +1.533435766370227e-01   +5.191794678605122e-01   +3.871688038547773e-01; +6.727360488675993e-01   +4.465327835045431e-01   +6.356878064950632e-01   +6.750333719233487e-01   +6.882164395623653e-01   +4.196438018344877e-01   +3.574210394957794e-01   +6.948979869508909e-02];
L3E_L2E_iAMPA_netcon = [+6.815884915741054e-01   +5.433743332580675e-01   +6.604151731253718e-02   +1.312872101869307e-02   +3.860865563762685e-01   +4.723232851144447e-01   +2.819819307600248e-02   +2.128389238684372e-01   +6.807387079866621e-02   +3.358552793484657e-01   +7.403976027876967e-02   +1.399848929886949e-01; +1.165671691179832e-01   +2.658343018195691e-01   +3.983097513693478e-02   +3.361911034700863e-01   +5.262906434244350e-01   +5.920217859783081e-01   +3.354020958677133e-01   +2.534380963027716e-01   +7.377579828817517e-01   +4.759681600247918e-01   +5.976489956563515e-02   +4.206158439107058e-01; +1.761522484911979e-01   +7.019064721267709e-01   +4.714283598804123e-02   +3.475567938591695e-01   +7.850936264377403e-01   +4.385375439357184e-01   +1.721315602154741e-01   +5.028574689910527e-01   +7.566145441668966e-01   +4.664488807090227e-01   +2.413425959823427e-01   +7.542060440675350e-01; +2.706632816150514e-01   +1.688175748184481e-01   +5.778405502051986e-01   +5.101857431174858e-01   +6.892755689587545e-01   +3.239164453129135e-03   +7.162843022767696e-01   +1.042409816446612e-01   +1.709109812633348e-01   +4.198075790272468e-01   +4.034100060267238e-01   +2.649392092038791e-01; +8.632849673114870e-02   +6.671862226639036e-01   +5.948646944195249e-01   +7.671160377179284e-01   +6.219627252438457e-01   +1.191754499394985e-01   +3.125813436851224e-01   +6.406279192836166e-02   +2.301907451831733e-01   +3.384786801552375e-01   +1.854819037379506e-01   +2.866282600998377e-01; +2.976127987713572e-01   +1.115781189751946e-01   +2.093952277547306e-02   +6.133466465324117e-01   +7.762714626879986e-01   +7.115189761826514e-01   +6.417559662866753e-01   +7.945845928642046e-01   +2.196930946545140e-01   +7.900014291849004e-01   +6.282699666632241e-01   +7.315907756561307e-01; +5.246188486599861e-01   +5.322246241833654e-01   +9.522939503984323e-02   +6.502424672029343e-01   +3.056268378861907e-01   +3.538146544888529e-01   +8.091947413049405e-01   +2.091720807290004e-01   +3.429317588806829e-01   +6.010332153949831e-01   +1.675680954662301e-01   +3.659883530937321e-02; +1.253848622433583e-01   +6.543512217800941e-01   +9.881401938799864e-02   +1.155513608269512e-01   +5.859052728298102e-01   +6.537324154360082e-01   +2.953977168372354e-01   +4.038883495100851e-01   +5.979534080116218e-01   +4.689085038313641e-01   +7.453297078487205e-01   +6.939408709289729e-01];
L3I_L2I_iGABA_netcon = [+7.262784788000747e-01   +4.900738736753327e-01   +5.256067761337744e-01   +2.595201542871683e-02   +6.730151278290465e-01   +2.719085592622485e-01   +2.797711532887988e-01   +5.311014896278751e-01   +1.896604336465442e-01   +7.173066446606702e-01   +6.466230458350384e-01   +5.387386045189443e-01; +7.370094887905093e-01   +5.786410492101023e-01   +6.402085433159321e-01   +8.338229354926176e-03   +1.979663114081105e-01   +1.329794225767882e-01   +2.654258234008010e-01   +2.864479438076580e-01   +4.204327682926042e-01   +6.706597192993715e-01   +5.633235012518859e-01   +8.059810185157685e-01; +5.967032339357700e-01   +1.652250628125545e-01   +4.797845588187929e-01   +5.371319868952946e-02   +6.700168704748767e-01   +5.930317869789886e-01   +1.689943815467346e-02   +2.788538213206223e-02   +5.505400500289075e-01   +6.582500005515008e-01   +2.179018422452081e-01   +7.978590612419326e-01; +6.016302525692629e-01   +2.228760197719427e-01   +7.590329702036005e-01   +6.690308258180923e-01   +2.641219384567596e-01   +7.407100026278923e-01   +2.071496464777348e-01   +9.775178899912590e-02   +2.971664456148091e-01   +7.836195081752558e-01   +5.647670271983082e-01   +4.805175150244299e-01; +6.473734274284325e-02   +1.274874029937205e-02   +2.069426683787079e-01   +4.121379377305515e-01   +7.939742148078278e-01   +7.740803239103426e-01   +6.961833130461033e-01   +6.821172496735359e-01   +5.272531914885696e-01   +1.093597728487783e-01   +1.027743685491914e-03   +2.229124558911003e-01; +1.693117471404656e-01   +6.016293469422889e-01   +6.449519667862148e-01   +1.297121721807278e-02   +4.469518206610902e-01   +6.023387291879833e-01   +5.187520891343463e-01   +5.922662783476484e-01   +7.620160682676893e-01   +1.588218070000408e-01   +4.450592226437016e-01   +2.756849897595559e-01; +7.720357165510086e-01   +4.628498530814378e-01   +7.131723411637967e-01   +4.740323590225403e-01   +3.773692087489549e-03   +3.786544581166572e-01   +2.435202458428933e-01   +4.390507921165934e-01   +3.263434332048534e-01   +3.188022880571227e-01   +2.636965725866173e-01   +4.404309997582020e-01; +5.259256031013978e-01   +2.677602589501482e-01   +6.050377263264732e-01   +7.533709445007438e-01   +4.126870801020973e-01   +5.668417147997395e-01   +4.382633033417700e-01   +5.674988972662686e-01   +5.902262979132323e-01   +1.033495301199172e-01   +1.875679748289225e-01   +6.720944904169923e-01];
L2E_L3E_iAMPA_netcon = [+3.712911874378943e-01   +7.440659951708961e-01   +1.956011453684990e-01   +7.839433964998223e-01   +6.314157681641013e-01   +3.391939588931116e-01   +2.197300503507982e-01   +8.106170728002361e-03; +1.810352867276690e-02   +4.408244371474779e-01   +6.322507191868570e-01   +6.584735503693844e-01   +1.511634113178620e-01   +9.434692016225675e-03   +6.141903942563558e-01   +1.046751942342038e-01; +6.159535908940484e-02   +3.082974387476668e-01   +7.888954979150460e-01   +6.347258834045932e-02   +7.732072797364615e-01   +4.280111103875298e-01   +1.331786753176491e-01   +6.727515959268755e-01; +2.575090498832154e-01   +4.594692494050500e-01   +6.116614175474735e-01   +3.090407163858970e-01   +3.098440372320017e-01   +1.540572890474773e-02   +1.862726030003538e-01   +5.960481832176407e-01; +4.778008192202432e-01   +6.441980239251205e-01   +7.755318942464098e-01   +3.595677122340757e-01   +7.181156358839660e-01   +7.648708433507613e-01   +2.920996713249686e-01   +4.968175782069657e-02; +7.577555840378704e-01   +7.503270251798696e-01   +3.381028954917665e-01   +6.001070088738775e-01   +1.921105054419326e-01   +2.507067500474036e-01   +4.859192034751261e-01   +2.384700474654816e-01; +1.875622030914731e-01   +2.844430658615595e-01   +1.177074917158959e-01   +4.765745094955804e-01   +5.596409248005946e-01   +6.212114087965227e-01   +6.099686478404068e-02   +6.048677094723797e-01; +2.863825198609461e-01   +7.344788038480511e-01   +1.204504657588795e-02   +7.500627269067590e-02   +2.550791807719948e-01   +1.315738485441902e-02   +1.818180891638805e-01   +3.811590356384078e-01; +6.859966056945564e-01   +6.755057901738155e-01   +4.271791997901080e-01   +6.169707907663059e-01   +2.872170218835648e-01   +3.853112229032527e-01   +6.083287981057223e-01   +3.019059476728213e-01; +5.447738719473263e-01   +3.715634939733450e-01   +4.126360294879668e-01   +5.765704789129430e-01   +5.284561622221143e-01   +6.991805992525848e-01   +6.329049979672219e-01   +4.772372013440618e-01; +3.708331943145508e-01   +1.282313716664075e-01   +4.637507534429052e-01   +3.324364204174937e-01   +7.241520922112958e-02   +3.475126299896861e-01   +8.065772840576163e-01   +6.179659065244609e-01; +3.223026553939039e-01   +3.916010594491512e-01   +1.334001556897739e-01   +3.313691302026856e-01   +5.873797106742941e-01   +2.491976012563832e-01   +4.859948255478639e-01   +1.090431966972315e-01];
L2I_L3I_iGABA_netcon = [+3.933188535817287e-01   +6.374383186712511e-01   +7.473137461273939e-01   +7.747238422768068e-01   +5.772900502635115e-01   +2.847543489347114e-01   +6.879392564837898e-01   +1.278161145793202e-01; +7.530165192798768e-01   +2.570690056588494e-01   +3.889138989239758e-02   +4.749466963021889e-01   +7.103877350090101e-01   +1.031364231917071e-01   +4.822661353280310e-02   +2.259569350420614e-01; +1.208243948921807e-01   +6.051679756591823e-01   +2.156995833413564e-01   +6.479803729220154e-01   +5.401128403932919e-01   +1.206727913096251e-03   +2.015165656299059e-01   +6.377682842529843e-01; +5.320287236099430e-01   +1.606415509076653e-01   +2.979721544108357e-01   +5.377843084455105e-01   +3.450085196549557e-01   +5.856355464850235e-01   +6.732162532929834e-01   +1.636271929275520e-01; +6.338828621609300e-01   +7.167862303579035e-01   +2.435314941753448e-01   +3.898274468303309e-01   +1.373935260629250e-01   +3.889312466314306e-02   +1.881967320578865e-01   +7.497812924418283e-01; +7.084629149297156e-01   +7.560234088629517e-01   +4.283967851260138e-01   +5.262648388523202e-01   +2.449640501253678e-01   +1.600443732697925e-01   +9.532957681869350e-02   +3.359034861160414e-01; +5.955267134748098e-01   +3.206688871768817e-02   +5.641908605698727e-01   +4.321867298414183e-01   +1.925501732106661e-01   +6.311740162266251e-01   +6.623796902013253e-01   +5.718471695594771e-01; +3.191549843619737e-01   +5.426004535048478e-01   +6.767500811542847e-01   +6.667086001198068e-01   +8.416610810707748e-02   +2.038132292087233e-01   +4.670314731570782e-01   +2.873943551290419e-01; +7.451646247763121e-01   +1.319772598909288e-01   +6.637585300470262e-01   +3.911805112205383e-01   +7.808409437499956e-01   +4.959804290344187e-01   +8.758865932271789e-02   +5.906072123350620e-01; +2.205355656243288e-01   +7.165688160361527e-02   +4.316915202046804e-01   +6.918516010325478e-01   +2.362915842479643e-01   +2.006413847439855e-01   +5.036371876408969e-01   +6.963755872289834e-01; +5.330250152622446e-01   +7.586962109177364e-01   +7.358181867034437e-01   +4.420606485498237e-01   +4.884745197348829e-01   +5.846071981094565e-01   +8.257958068615291e-02   +5.118028004090167e-01; +4.573665838752207e-01   +2.596463574764285e-01   +2.888012548315405e-01   +6.687413194607904e-01   +7.422959423543564e-01   +4.497740530296472e-01   +7.814106692426523e-01   +6.714055451294486e-01];
L3I_L3E_iAMPA_netcon = [+6.891022443424678e-02   +1.262417577470894e-01   +4.848554829095569e-01   +6.227621396521117e-01   +7.759599343571738e-02   +1.744061812654261e-01   +7.262871703628027e-01   +1.185284654727682e-01   +6.703948824355769e-01   +7.351411841023052e-01   +7.857830285689337e-01   +3.615048105166532e-01; +7.050677006792447e-01   +6.574102299720297e-01   +4.300049959827855e-01   +6.240870719337096e-01   +6.994927757889049e-01   +7.523319334563024e-01   +5.767852736475227e-01   +4.818627154435188e-01   +2.635988823834673e-01   +2.502339346857118e-01   +3.966591590733317e-01   +4.246041546797180e-01; +2.860639230893336e-01   +1.515084480427147e-01   +2.595136854695307e-01   +5.868370490741666e-01   +4.255365690118363e-01   +6.144427461081244e-01   +5.437958971878281e-01   +6.710633780693237e-01   +4.857171408712804e-01   +5.978954186303507e-01   +5.506481705632666e-01   +4.063829572027486e-01; +6.052882755405328e-01   +6.015534143882694e-01   +6.904268222316157e-01   +6.708445794276934e-01   +3.169044447632518e-02   +9.986181931652260e-02   +4.725550212753014e-01   +5.872456643100659e-01   +1.611597753675434e-01   +7.210387775327538e-01   +7.209211828788998e-01   +9.687340869969638e-02; +2.158497309959541e-01   +2.895785300879440e-01   +6.182739705966514e-02   +3.065336984826990e-01   +1.450254982593769e-01   +7.417346143949373e-01   +6.725991743853362e-01   +1.014810224558954e-01   +4.230722398895502e-01   +8.024246816636755e-01   +7.531282996018931e-01   +7.750448905638986e-01; +7.149774416934076e-01   +7.063248083928352e-01   +1.877883616979900e-01   +3.739776442753899e-01   +7.324045331376963e-01   +5.225400696946895e-01   +6.572388907169625e-01   +5.572174452982201e-01   +3.740346755232946e-01   +5.114979090564863e-01   +2.000867930220774e-01   +1.252154920787407e-01; +1.718351504007607e-02   +2.223192797709215e-01   +5.722063614881325e-01   +1.006576200475031e-01   +5.367800457964482e-01   +3.895503408054645e-01   +1.171595142528781e-01   +2.735232985866636e-01   +6.122013223395087e-01   +1.319587730376912e-01   +1.064631251603142e-01   +7.722855723896185e-01; +7.903149285563896e-01   +5.493088071466773e-01   +3.309321126295408e-01   +5.821545605439790e-01   +3.080103700517770e-01   +3.029824729215378e-01   +4.234211839271434e-01   +2.103481548742784e-01   +5.933121693923714e-01   +5.690137204030053e-02   +7.419122790091832e-01   +4.202717118504666e-01; +2.290254453095573e-01   +6.919159736677813e-01   +2.936487307932483e-01   +6.378329790676308e-01   +5.695334092685206e-01   +2.887008673595671e-01   +2.684802632519558e-01   +7.802753361508352e-01   +6.558220229389463e-01   +4.758826528040616e-01   +6.517204141465056e-01   +5.100858894606832e-01; +3.736708029448467e-01   +2.041994404539756e-03   +5.042435901481377e-01   +3.972947680106097e-02   +2.299045308359332e-01   +6.962564172072357e-01   +1.283861188842940e-01   +4.238794968876251e-01   +6.990532353993109e-01   +8.022470555103820e-01   +2.006230648586618e-01   +7.257156472267144e-01; +8.780610350882467e-02   +6.697220358753290e-01   +1.821660025504576e-01   +3.854413173374844e-01   +3.185699895079259e-01   +5.725284898428916e-01   +7.680029498881691e-01   +6.559964917979817e-01   +4.045630479198613e-01   +2.502556459880629e-01   +2.749811521208315e-01   +4.668918277836934e-01; +2.638099718593309e-01   +4.572183788035835e-01   +2.148292152410184e-01   +1.271217661554866e-01   +4.506360863946724e-01   +2.456899064837026e-01   +4.349726435817338e-01   +5.415466489083081e-02   +3.168289966297826e-02   +5.230376101503866e-01   +3.213213377440147e-01   +4.327056867163381e-01];
L3E_L3I_iGABA_netcon = [+5.498409756825644e-01   +5.721830046563496e-01   +6.184387040727767e-01   +1.939479987308810e-02   +2.265815575519260e-01   -4.936322127770192e-04   +3.235690487652755e-01   +2.990889998755631e-01   +6.241698266080170e-01   +1.287647748911174e-01   +3.267501354203279e-01   +6.911798792141043e-02; +1.432210705856204e-01   +7.984569055289560e-01   +3.020228452481292e-01   +4.580052108101333e-01   +2.216098924661039e-01   +4.645148608697811e-01   +7.578128784346539e-01   +8.429117064094215e-02   +5.133044543892611e-01   +1.023476227435012e-01   +9.490181523168754e-02   +4.138423322162175e-01; +2.839258423811411e-01   +6.929280495441876e-01   +3.685916315087617e-01   +7.586360242036029e-02   +8.243583897805747e-02   +6.046207993323943e-01   +3.632503541664437e-01   +2.144735284068443e-01   +5.491303418274533e-01   +1.227415180825667e-01   +7.392717364947250e-01   +5.824114988145511e-01; +3.018780946822677e-01   +6.975534481588201e-01   +5.284382609374058e-01   +7.175765763838327e-01   +3.680525105638501e-01   +5.332632658508782e-01   +7.276666845374025e-01   +8.346735450574250e-02   +6.068995989955855e-01   +4.460308810127145e-01   +6.533100354435234e-01   +1.986612821321838e-02; +6.600497986329492e-01   +6.457556728943524e-01   +2.988461623392115e-01   +3.059916777175389e-01   +1.486179873638727e-01   +4.171136082653325e-01   +6.706677563419685e-01   +3.706877937813370e-01   +4.700876908754050e-01   +3.645196168423863e-01   +5.671452347308389e-01   +6.378670304704097e-03; +4.485485005336085e-01   +4.822210171705935e-01   +9.668018071703702e-02   +5.626768350199741e-02   +3.590698482916756e-01   +1.009373743323374e-01   +6.112160078296287e-01   +1.775036986754600e-01   +7.813996342635670e-01   +9.532954829449057e-02   +5.538877501634011e-01   +9.837845370675850e-02; +4.264595908100863e-01   +4.365103485097812e-01   +1.147119894239108e-01   +4.854833376817410e-01   +4.734570169141151e-01   +7.364396394294720e-01   +7.222280421773466e-01   +5.927714573923395e-01   +3.856669648222298e-01   +5.423052685720031e-01   +7.463478303320987e-01   +1.203448882288826e-01; +7.519431043169140e-01   +3.017314677902599e-01   +3.902036707271224e-01   +5.784693526213649e-01   +1.251590169343887e-01   +2.576096636092322e-01   +2.798506810050174e-01   +2.826116065268215e-01   +2.988252168177833e-01   +3.211735485552861e-01   +2.971834425896298e-01   +7.735447007244125e-01; +5.749992450902366e-02   +3.651835922165897e-01   +7.434280192218515e-01   +2.767661173890811e-01   +3.489391275406281e-01   +6.968320766285325e-01   +7.033017333020339e-01   +8.968567479282048e-02   +7.383622080892631e-01   +4.381002256482978e-01   +4.067836098534611e-01   +5.660489995293083e-01; +1.840138699680200e-01   +4.500868649788417e-01   +9.401000533254605e-02   +7.756092713478770e-01   +5.827259915543480e-01   +3.115716495032687e-01   +3.389541334734813e-01   +4.707770529797572e-01   +6.239702105130893e-01   +7.352490439059998e-01   +6.398075987342703e-01   +2.448251291708796e-02; +1.916548355620650e-01   +7.310072552274518e-01   +4.852304020239327e-02   +4.507837321826456e-01   +7.508224827316278e-01   +3.012152328827518e-01   +2.942880066348411e-01   +1.350026744285217e-01   +6.790109424094591e-01   +5.563372793067908e-01   +2.271931661385799e-02   +6.388493099458966e-01; +3.705573102794159e-01   +1.242682246779688e-01   +6.991890476835116e-01   +2.410303704464784e-04   +6.054100283164209e-01   +7.251778351743878e-01   +1.650187472890011e-01   +3.299183562918356e-01   +6.231578343903182e-01   +3.114255320591430e-01   +2.590015076758698e-02   +2.165335127504504e-01];
L2E_Input1_iAMPA_netcon = [+5.553681219191726e-02   +1.068836186464193e-01   +7.287789766396667e-01   +2.769893711559969e-01   +9.483279710050312e-02   +3.510156451577106e-01   +2.681020898744160e-01   +1.354241285290622e-01];
L2I_Input2_iAMPA_netcon = [+1.909229795230485e-01   +3.481737819406402e-01   +2.379386997608277e-01   +3.280709784636484e-01   +4.295692771320292e-01   +4.414764169339320e-01   +1.691687381078359e-01   +7.269867753951130e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  5.6 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
