function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-5.929627833755170e-01   -8.075820684567462e-01   +7.492968503436233e-01   -3.915782655155940e-01   -4.821008085414835e-01   +1.695508255428714e-02   -3.031009156338077e-01   -6.239372896307173e-01   -2.366338981312260e-01   +2.503817466501873e-01   -4.731605441235744e-02   -6.239553218601693e-01   +4.138307213912317e-01   +2.640007556568708e-01   -6.055478650303374e-02   +4.884881268364779e-01; +6.269366075079831e-01   +5.235320388176207e-01   -3.756926827399752e-01   +5.856523003291315e-01   -4.288009970285453e-01   -4.073966318014768e-02   +3.616275755372856e-01   -1.120509057660138e-01   +6.630671077524076e-01   +6.967619081641051e-01   +3.409815097418001e-01   +3.368433711443095e-01   +7.845331013108998e-01   +6.994453447730341e-01   +6.861114508061968e-01   +3.866251058977921e-01; -2.331025692106844e-01   -3.713705488162340e-01   -2.707029255479586e-01   +7.052180143945432e-01   -3.927998857786458e-01   +5.198557919133762e-01   +2.731172818359275e-01   -1.267559549515876e-01   -8.756745387954026e-02   +6.616649653061263e-01   +9.121536166204164e-02   +6.706241117746100e-01   -2.908893090677361e-01   +2.427025301157426e-01   -5.923104923304846e-01   -5.204256971864039e-01; -3.175792896017890e-02   -3.715286076313438e-01   +3.714288058983214e-01   -5.508113329014868e-01   +6.364777378855407e-01   +1.397987571212795e-01   -2.666040574244071e-01   +4.722881065455944e-01   +4.215347900877874e-01   -2.410847290000167e-01   +7.642945912086687e-01   -2.062000173731645e-01   +5.946866136056445e-01   -2.674146131724233e-01   +2.608312422988633e-01   +2.365999892911188e-01; +4.622377907602324e-01   +2.028759518262571e-01   -7.459942626034924e-01   -6.769403894518418e-02   -6.525009918443144e-01   -3.149783823881352e-01   -2.466726797617287e-01   +7.564201121798462e-01   +2.681175202423188e-01   -4.986703213139032e-01   +3.581564404026790e-02   +3.251080919779830e-01   +3.527004629165797e-02   +7.231679940689316e-01   -2.479919621400220e-02   +3.437827075173849e-02; +3.859492239824131e-01   +7.745846861597968e-01   -1.815621704263407e-01   -2.357965542740991e-01   +5.671972139553063e-01   +3.198728730038123e-01   -4.936009612969627e-01   -6.404977253367099e-01   -6.068763308142449e-01   -1.635843867719957e-02   -3.316063987142334e-01   -1.006976266227294e-01   -2.665081263833989e-01   -3.021927113550012e-01   -9.103456327388205e-02   +4.511706278563472e-01; +3.635409073366175e-01   -2.525481950927018e-01   +8.577126540583728e-02   +4.784221432776086e-01   +8.063103013440401e-02   +6.468528614585799e-02   +2.627944408738919e-01   -5.077421121906177e-01   +2.033498640234864e-01   -5.283203319806000e-01   +4.824884855711656e-01   +3.026983924313886e-01   -1.629905892324513e-01   -5.680337159110269e-01   -3.723760228738661e-01   +4.078321494677867e-01; -1.815864842771912e-01   -5.925654377787330e-02   +6.329454470956490e-02   +7.217361887605043e-01   -2.838692254556548e-01   -9.335984100359246e-01   -7.780470449528197e-01   -5.395768362234517e-01   -2.014569604374523e-01   -1.603177635873005e-01   +6.740670430877826e-01   +2.078085537093598e-01   +5.093042503374122e-01   -6.154855893057735e-01   +9.717316151467130e-02   -2.051321114052881e-01; +7.199130957979339e-01   -6.163327494760960e-01   -1.374112368043401e-01   -2.486326717937213e-01   -2.060661410913397e-01   -1.320361492123545e-01   +5.965638630965096e-01   +2.137898356884189e-01   -4.094863214103624e-02   +4.264181008201386e-01   -1.207864845455706e-01   -1.670846403179611e-01   +1.129668247424995e-01   +5.017288296431519e-01   -3.749626718552219e-03   -5.547567421787803e-01; +4.472052800102972e-01   -6.519687554257688e-01   -5.386451341309937e-01   +5.736266912620119e-01   -1.314208590680136e-01   +4.352798018583808e-01   -3.011619400432545e-01   +1.444685643712571e-01   +5.430517425460841e-01   +2.148535931823177e-01   -6.170598340363156e-01   -4.358604233527346e-01   +6.351113600229681e-01   +7.345464834624170e-01   +2.998279621570570e-02   +7.492787294246469e-01; +6.676084271139519e-01   +7.603819357189176e-02   -4.797529583748948e-01   +7.796205897130726e-02   -2.786405357022933e-01   -3.649140449315613e-02   +6.003940925114911e-01   +6.364628480107587e-01   +1.636215209722092e-01   -1.664919860242934e-01   +1.870829600396979e-02   -3.072318082421139e-02   +4.167313649407698e-01   +8.817035059415834e-01   +1.618593925834115e-01   -1.344417927014459e-01; -2.252052549243445e-01   -5.630916182767551e-01   -1.339050965770494e-01   +5.771912233665139e-03   -8.347997774842864e-02   +3.086508336122442e-01   -1.943408647729544e-01   -5.868042436435544e-01   +4.127018730013912e-01   -6.024517173255610e-01   -6.839000608796317e-01   +5.672960298541920e-01   -1.000000000000000e+00   +5.278578975124651e-01   -4.086152899600027e-01   -6.762489465541133e-02; -1.908681087389263e-01   +2.714168545535727e-01   +2.833995517705909e-01   +4.913209072954304e-01   +1.616058584487989e-02   +4.222781523590050e-01   +4.716879835038720e-01   +7.192653122964132e-01   +3.041997211413208e-01   -3.775259623691859e-01   -4.063466455934555e-01   -6.093735159166088e-01   +8.759826360829578e-02   -7.295462770411810e-01   -1.402889149405545e-01   +6.212945017831232e-01; -4.083019329335981e-01   -3.258369638508691e-01   -6.324563639302965e-01   +5.814310632076061e-01   -2.029127854547184e-01   +2.201926469796348e-01   -2.204840524171296e-01   +4.972165589279364e-01   -3.020697591294154e-01   -4.786418305836526e-01   -5.063790115263930e-01   +8.538547810871553e-01   +4.165994386394942e-01   +7.148234047149874e-01   -3.887634294021755e-01   -5.754516122222981e-01; -1.950128822483128e-01   -7.023592729971214e-01   -2.117637579809901e-01   +4.372672675216574e-01   -6.377307559982607e-01   -6.500726104600262e-01   -7.367070239028963e-01   -8.817191984341017e-01   +1.193654381300120e-01   +3.221959451969315e-01   +2.702113180648512e-01   -2.918988028996073e-01   -5.575347184696127e-01   +2.886338142987315e-01   -4.770194232937932e-01   -1.982545159842467e-01; +1.477799355167524e-01   -6.505816429275041e-01   -1.458891630436586e-01   -5.317006439681103e-01   +3.962077724615630e-01   +3.046211614547984e-01   +5.699463732372290e-01   -6.135411946909622e-01   +5.288772904723520e-01   -5.492991467481302e-01   -1.378181013667380e-02   +1.175708412381797e-01   +6.245227604925145e-01   -2.956003720993640e-01   +4.142444483337655e-01   -6.269331871549337e-01];
L1E_L1I_iGABA_netcon = [-3.396819054106123e-01   -2.466675513704039e-01   +1.633633095806690e-02   +1.050438331732031e-01   -1.463955950206581e-01   -4.020193815827888e-02   +5.299195567819110e-01   -7.200384228037481e-02   +5.730765384988667e-01   -2.096936600446077e-01   -2.366453168445851e-01   +1.594974546998060e-01   +2.583060542635929e-01   -1.051707940623865e-01   +5.020803620242565e-01   +2.538710413617852e-01; -2.414135580740434e-01   +7.549957858056798e-01   -2.240929161350109e-02   +3.286953367514434e-01   +2.628318914530733e-01   -3.841794371343802e-01   -2.341914853246167e-01   -5.240881979808300e-02   +6.390848184801787e-01   +4.190167858273415e-01   +9.035274868988462e-01   +9.148072443801050e-02   +1.427949660736517e-01   +1.726871122269233e-01   -2.464800498696345e-02   +5.382875224400038e-01; +4.366788923263317e-01   -3.675313921033631e-01   -1.599721477595944e-01   +3.718259028553014e-01   +4.357810206644941e-01   -3.816996723428234e-01   -4.777644506344492e-02   +3.266508504221645e-01   +7.292890090445825e-01   -1.324129551079168e-01   -5.946867146702418e-02   +1.384219085281907e-01   +1.174452427676962e-01   +3.125658113253194e-02   -6.554954558282711e-01   +2.617316458400507e-01; +1.017673021602758e-01   -6.225608561322825e-01   +1.913633312237464e-01   +5.250939454444201e-01   -4.778555057580626e-01   -1.093932857254451e-03   -8.464379558885126e-01   +3.586777252831236e-01   +3.138426022738562e-01   +5.587436077843824e-01   +4.911809900103298e-01   +4.414642291072223e-02   +6.713777265435953e-01   +7.720174727776090e-03   -3.808962428823615e-01   -3.007985103419966e-01; -3.082086167659377e-01   +3.562795110669588e-01   -9.521710570691907e-01   -2.369541882323252e-01   +2.943962421488924e-01   +5.866525046139046e-01   +7.355943666592694e-01   +3.610166983701705e-01   -3.451889843498677e-01   -3.032852220111574e-01   +4.896146759659641e-01   -2.377081683189413e-01   -3.463033111086188e-01   -3.165631651785116e-01   +4.129247021668563e-01   +2.342407041721295e-01; +4.812498771120960e-01   +4.196546418444265e-01   -5.206320705400799e-01   -2.818469270075878e-01   +3.924747648736115e-01   -4.851483356703936e-02   +3.745265224169128e-01   +3.785329015905420e-01   -6.206073709892879e-01   +4.371194867998053e-01   -2.375655864154867e-01   -3.547627727329415e-01   +6.391187207241551e-01   +1.000000000000000e+00   -4.998946836643633e-01   +1.796405153773923e-02; +7.400066531004253e-01   -8.193178383208770e-02   -1.051395877087375e-01   -2.394459582991676e-01   -1.690124576846162e-01   -3.453772615245459e-01   +5.622288788702681e-01   -3.894791002476243e-01   -2.888687021497208e-01   +2.900246597631775e-02   -4.647071530262420e-01   +8.283165354267072e-01   -2.576599071210926e-01   +3.039649428789031e-01   -2.997348407448508e-03   +5.408803817252159e-01; -1.517576928448972e-01   +4.944420920972251e-01   +3.602080815011131e-02   -7.975910771074385e-01   +4.892055014914130e-01   +9.844879290478349e-02   -3.268208348485018e-01   -4.975929667840239e-01   +5.295318695236358e-01   +1.114436816180776e-01   -9.187700580196979e-01   +3.112833530195349e-01   +6.753133130440254e-01   -8.006155042734362e-01   -1.375801341715010e-02   -5.733461445903179e-01; +4.468341752870549e-01   -5.864509783519840e-01   +1.638748487807461e-01   -3.141280636147561e-01   -9.514214956191050e-02   +2.572167645846269e-01   +5.576916841386491e-01   +6.588838454175462e-01   +4.495322330640209e-01   +4.958490964536868e-02   +2.500471173862730e-01   -2.242406779543719e-01   +3.947241430696961e-01   -1.078356802693993e-01   -5.227863845556578e-01   +3.202874859382651e-01; -6.485640709417596e-01   +5.821772010269362e-01   +8.333913358811206e-01   -4.233378867985515e-01   -5.245728565209327e-02   +3.668035509725277e-01   -1.812890969120170e-01   -4.100563478819208e-01   -4.194512003615767e-01   -4.841447114864292e-01   +3.996516856055915e-01   +5.486184494027507e-01   +6.877994881823405e-01   +2.813820611328247e-01   -3.794332883435035e-01   +4.732532564707211e-01; -7.850335065424167e-02   -1.324505514420800e-01   -7.506650599576806e-02   -1.076782876213559e-01   +4.727817024810177e-01   +5.222650299321876e-01   -7.463231116898132e-02   -4.078929066063521e-01   +6.407446594553541e-01   -1.107783916620840e-03   -6.567850924017263e-01   +6.885862472536280e-01   +5.967388124201169e-02   +3.685608346377297e-01   -6.360510029419713e-01   -4.022744741652792e-02; -1.827279008558056e-01   -6.801268447213454e-01   -2.314704128653275e-01   +3.473036126184340e-03   -1.107202440714240e-01   -3.371136602422200e-01   +2.844722183128808e-02   -3.509771969770323e-01   +2.342352883789287e-01   +2.323299235258194e-02   +4.841200622194082e-01   -6.320958329189114e-01   -8.579770734613114e-01   +1.439496131807589e-01   -6.471650507991737e-01   -3.705305825888323e-01; -1.249106558862526e-01   -9.646822715684642e-01   -2.754743689126484e-01   +7.461351908901112e-01   +2.516091452382557e-01   +3.899302645916107e-01   +3.880429666733664e-01   +2.456088711890592e-01   +4.330403852720929e-02   +1.824540445645468e-01   +6.089620279805520e-01   +2.731191589912411e-02   +1.246328864666023e-01   -9.890862081723930e-01   +2.743832436195905e-01   +5.564960921720126e-02; +4.372070102530515e-02   -6.973541000239952e-01   -3.172219315485982e-01   -5.288532915713262e-01   -4.903695481963327e-01   +1.709573417456988e-01   -8.317047177267929e-02   -6.262819853572733e-01   +5.311253655767970e-01   +2.364354503160185e-01   -6.144891795786445e-01   +2.593730369090219e-01   +1.740587439922422e-01   -4.841150442945175e-01   +7.108477968688418e-01   -4.613355163488588e-01; +1.933949099577872e-01   +4.085302851356639e-01   -2.802078303026679e-01   +4.816840083068553e-01   -2.453445691073393e-01   -4.784566140507801e-01   -1.917051396973892e-01   -1.163561778436884e-01   -3.621111848248600e-01   +2.968604300663911e-01   -3.220184577560637e-01   +4.989053720333451e-01   -2.680489947225925e-01   -2.847472889474862e-01   +4.493709336196199e-01   -5.797683194697806e-01; +7.879995044434687e-01   -7.311733261210689e-01   -4.773855708450219e-01   +4.273251591012378e-02   -2.609114857843592e-01   -1.739544212753444e-01   +3.997422278204497e-01   -3.798951255171907e-01   +3.975447862581323e-01   -4.330812161102006e-01   +5.459400693026009e-01   +3.775244262802866e-01   +7.281279058966244e-01   -9.622615953389134e-02   +4.408845345657984e-02   +2.962744238726469e-01];
L2I_L1I_iGABA_netcon = [-3.084079121847843e-01   +4.039469351269478e-01   +4.627519366975301e-01   +1.260374248675489e-01   -2.087573647553245e-01   +5.787844487930704e-01   +3.791147486683578e-01   -7.496405328659279e-01; +5.811358300833854e-01   +5.758078108556260e-01   +5.689822086930797e-01   -5.862102837298024e-02   +1.617918580914632e-01   -4.752668426625772e-01   -1.610176596251866e-01   +7.027985177228994e-02; -6.974452911715644e-01   +3.928543350641384e-01   +5.599289072212986e-01   +3.362197510504462e-01   -1.582924756069135e-01   -4.351304080328038e-01   -7.690257689132532e-01   -3.736153989953909e-01; +9.014712445863423e-01   +1.619480927697133e-01   -2.502438226309786e-01   -2.272551322671102e-01   +3.147387506102520e-01   +8.506439918341230e-02   +8.856199938641274e-01   +6.503830962196577e-01; -3.538549414599201e-01   -3.288321822265374e-01   +3.233702991566395e-01   -3.372172687056619e-01   -1.814375741461782e-01   -6.759809974766867e-01   -4.308660478951520e-01   -2.232331298978783e-01; +1.854918111573016e-01   +2.399319701380596e-01   -3.405151349970614e-01   -1.741999086405464e-01   -5.205577662996688e-01   +2.170467606137066e-01   +5.851730834498480e-01   +1.980465359056172e-01; -7.322850157193675e-01   +9.575893918872581e-02   +6.369179104698779e-01   +4.937838481661181e-01   +3.814973595972833e-01   +3.242629752944390e-01   -1.944620831160066e-01   -3.946432735166486e-01; +7.439929663314647e-01   -2.863301099617031e-01   -4.893542178787829e-01   -4.071055552239352e-01   -3.624854133582737e-01   -3.790182025013437e-01   -2.141127077837671e-01   +7.075571836107539e-02; +1.028207900841731e-01   -9.198790407626083e-01   -3.703481947278228e-01   +5.139735892922292e-01   -8.388331958915332e-01   -5.733476846152704e-01   +3.445662359927539e-02   -6.233950516697775e-03; +2.987330599151445e-01   -6.145850334822856e-02   -2.578760237708315e-01   -3.338666456618909e-01   -2.071309734191731e-01   +4.634511014683527e-01   -4.206184749823279e-02   -5.444081952789889e-01; -3.059976109573209e-01   -4.047915688219106e-01   +2.879808850778862e-01   -3.528196151320183e-01   +6.429559413909844e-01   -5.496009158984398e-01   +6.647934672844557e-01   -8.181664923930929e-02; -3.519025403394653e-01   -3.409581513027421e-01   +4.560910926433081e-01   -2.289376407148277e-01   +8.858868047035665e-02   +4.432429960400776e-02   -5.375523962381387e-01   +8.106701388933544e-03; -5.519443317728204e-01   -1.588458106539709e-01   +3.083479134192682e-01   -6.180609461647271e-01   +7.759250868912340e-01   +2.959841717779058e-01   +8.248050350133634e-01   -3.163950331910954e-01; -4.330408142847856e-01   +4.220748085757598e-01   +5.321326757576388e-01   +3.956375537533685e-01   +6.159427948620504e-01   -4.062869657702985e-01   -1.000000000000000e+00   +5.419862186774698e-01; -2.576369792644272e-01   -1.798715990019862e-01   +2.034060736672257e-01   -1.889329180329270e-01   -3.947198326653337e-01   +4.273098789560451e-01   +4.998174034714543e-01   -6.566172766744141e-02; -3.390667968214196e-02   +1.437611557823906e-01   -2.328355765269646e-02   -1.716115406370004e-01   -4.921966768530402e-02   +2.154758948925031e-01   -5.287031592217718e-01   +2.763078104097133e-01];
L1I_L2I_iGABA_netcon = [+9.283534299962501e-02   +4.054067556465557e-01   +1.492576738745298e-03   -2.873402919641647e-01   +3.866877425552244e-01   +6.095143263460069e-01   -6.262400129946410e-01   +4.145422167873002e-01   +2.341985868766870e-01   +4.487527141961101e-01   -3.927732165790712e-01   -2.667807277973371e-01   -1.787440524580223e-02   +1.000000000000000e+00   +1.456582856941284e-01   -6.318742390213283e-03; -2.620879362290801e-01   +4.343617192303817e-01   +5.915661082685740e-01   +3.280561218650260e-01   -3.645524641567433e-01   +3.826234173504895e-01   +3.047829262507789e-01   -4.803530110201644e-02   +1.111666669672367e-01   +5.395658658877665e-02   -7.352622751284341e-01   -2.828593386834611e-01   -6.212454796475529e-01   +3.292542458703277e-01   +5.023014240940551e-02   -5.055732577614461e-01; +1.387635132760880e-01   +5.935085569630616e-01   -2.342688001668663e-01   -2.554314114010385e-02   -5.929309124421002e-01   +3.008746551342853e-01   -7.185496145475208e-01   +2.441786821186746e-01   -4.379138192842530e-01   +2.627440972182127e-01   +1.965524332068696e-01   -1.073576505543827e-01   +6.391177232664444e-01   +3.152248943545475e-01   +1.777420177920357e-01   -4.465418647882587e-01; -1.401528021833994e-01   -3.216285400283256e-01   +6.216183867651268e-01   +1.401917201160063e-01   -1.126483987112559e-01   -6.164077296814459e-02   -3.856550921231627e-01   +9.328190758162326e-02   +8.016781047625380e-01   -3.387283233881985e-01   -1.144263087763052e-01   -3.079098491494396e-01   +4.090238761277774e-01   -3.054084015759884e-01   -6.802934888496411e-01   -3.665200443527199e-01; -1.383700483068332e-01   -6.487709672645228e-01   -2.593117470984248e-01   -4.422168249287803e-01   +4.189112551047064e-01   -4.120955046509371e-01   +1.984237227762631e-01   +4.345109924100278e-01   -3.955065024737249e-01   -3.449909120529457e-01   +3.631402794796759e-01   +4.506418892341416e-01   -5.875650842067996e-01   +3.539903618953216e-01   +3.310573821873278e-01   +1.516723735303190e-01; -3.188284236434054e-01   +2.325290111544231e-01   -2.135796641365918e-01   -4.244005807033752e-01   +1.472104772323639e-01   -2.466714048698690e-01   +1.660843360194293e-01   +2.397119773471809e-01   -5.348079135742040e-01   -2.607501609902935e-01   -2.252457567519731e-01   -1.058831900429043e-01   -6.760957016782555e-01   +2.822120371440689e-01   -3.609996132733482e-01   -3.109957388691771e-02; +1.422075079126614e-01   +4.746831651341700e-01   +4.473411528264824e-01   -1.415712832115808e-01   +3.246563603940793e-01   -3.403658755357433e-01   -3.819565507780427e-01   +7.016618223526120e-01   +5.431031038940355e-01   +6.495411665860644e-01   -1.453365233002905e-01   -3.656962035464295e-02   +4.938597049658758e-01   -3.244117059700626e-01   -6.242710441935825e-01   -3.844481914980231e-01; +5.386878988369607e-01   +3.664908605293994e-01   +2.143195133743456e-01   +5.771806538600776e-01   +5.536930244927400e-02   -1.881947925559307e-01   -9.988321507125997e-02   +5.794905726469574e-01   -2.123731442130729e-02   +1.078642561115323e-02   -2.601694710504213e-01   -6.014426410254607e-01   +5.249110631781027e-01   -4.114069423782079e-01   +4.393662495859518e-01   -4.482143211672836e-01];
L2E_L1E_iAMPA_netcon = [-5.491530556426034e-01   +1.776670553843872e-01   -5.364905157127231e-01   -6.549746589810261e-01   -6.497222919584377e-01   -5.954017797370723e-02   +1.246256886110422e-01   +1.100537941645236e-01; -2.468628455623470e-02   +1.087104538603782e-01   -3.341529507229374e-01   +4.195124564518500e-01   +4.515264075549784e-01   -2.971460282739672e-01   +2.352293041780817e-01   -1.663084769399429e-02; +7.036517945780879e-02   +4.852962914499146e-01   -4.964454065244301e-01   -4.324264644311196e-01   -3.241824770609097e-01   -5.716125991214384e-01   -2.145188230724646e-01   -4.482733563199288e-01; -4.680569730496510e-01   -1.872931802337026e-01   -7.212062067211643e-01   -2.042029819026046e-01   -6.606771276128082e-01   -3.173025070065676e-01   -2.256266087570673e-01   -3.621307740115804e-01; +5.417528828033475e-01   +4.636504441548561e-01   -5.101953898004287e-01   +4.610074476238368e-02   +1.108455340844345e-01   +3.282693678575371e-01   +7.083652353500929e-01   +5.305528219324482e-01; -2.134146916676350e-01   -7.787345928220221e-01   -5.820137784072268e-01   +2.211408825110128e-02   -1.465920690402998e-01   +1.685817975817505e-01   +2.420845396112846e-01   -7.325042426004464e-01; -7.743580836750419e-01   +5.540271449255326e-01   +2.656950321585071e-01   -4.281505233021793e-01   +4.152190790587376e-01   +3.268674017257985e-01   -7.122725255946691e-01   +4.149091453652182e-01; +1.363266392896432e-01   +2.384387598275260e-01   +4.939522875984053e-01   -5.369935197209980e-01   -8.066579252598337e-03   -5.198085806194360e-01   -3.095198193085126e-01   -4.948661428223254e-01; -3.484153431905947e-01   -2.064964217307205e-01   +1.193598365131814e-01   +5.352484641987505e-01   -1.515564487814024e-01   +2.548128836205864e-01   -5.275302680019898e-02   +4.304952850248169e-01; +2.738161883845740e-02   +4.947836193796873e-01   +1.002592843810479e-01   -1.013269290248669e-01   -2.555053296171990e-01   -3.547305249596047e-01   +1.000000000000000e+00   +5.095297618390956e-01; -4.443808522517534e-01   +5.711059239505321e-01   -3.565041148772688e-01   +1.954784271712059e-01   -3.024189846370267e-01   -9.551796009416811e-01   +3.577102226053717e-01   -5.592895559382230e-01; -5.416048408293441e-01   -2.335182763331281e-01   +3.825175576028590e-01   -1.406027605871142e-01   +1.507480184905823e-01   +3.899954302981582e-01   +4.405553613242580e-01   -1.956354064437867e-01; +2.411207059233248e-01   +1.283457448802397e-01   +6.444918602791727e-01   -1.827920670786840e-01   -2.424013673215309e-01   -3.230263900860196e-01   -2.552143950256919e-01   +4.863004217779979e-01; +1.354432119424178e-01   -1.534617496639664e-01   +4.976814214234311e-01   -6.876288210682777e-01   -9.929195386325103e-02   -8.395225156496954e-01   -5.659195474559765e-01   +1.557418598970247e-01; -2.414326392104449e-01   -9.272222854245291e-02   +4.050100644252379e-01   -1.207858488134312e-01   -7.157412814191126e-01   -1.482080831106861e-01   -5.081096632292563e-01   -1.737220151807610e-02; +6.441304053374276e-03   -3.675724932467860e-01   -6.629450955163114e-01   +5.037944618802137e-01   +1.291029806396386e-01   -5.553024514921046e-01   -2.976705669810160e-02   -7.520794438575634e-02];
L1E_L2E_iAMPA_netcon = [-4.658857082000397e-01   -2.674738795609529e-02   -1.944089791879301e-01   +4.164066366330630e-01   +3.104821762710947e-01   +7.628766197299431e-01   +7.530707622670350e-02   +3.926250725905965e-01   -3.927115536289801e-01   -6.629078613283806e-01   -1.740815108499806e-01   +8.508977665914139e-01   -6.369799208401756e-01   -4.391456983130338e-01   -4.397426019649049e-01   +1.527796190340969e-01; -4.525559034929977e-01   -3.198960762518411e-01   +4.022084314225323e-01   +3.471823519875519e-01   -5.711338760338952e-01   +3.326364152843007e-01   +5.512393535344738e-01   +7.859359966708068e-01   +3.687356829036612e-01   +2.416891595719292e-01   -1.560470686842939e-01   +6.853507284092756e-01   +3.622555938324146e-01   +6.303477996730028e-01   -4.561815436950614e-01   -2.133962742777283e-01; -3.626474443963693e-01   +7.043015226532205e-01   +4.966861815005020e-01   -4.631123372261256e-01   +4.883205125986956e-01   -2.432093183036931e-01   -2.773261408129954e-01   +1.734763961305209e-01   +3.559684885532263e-01   +5.669000458926180e-01   +3.230995146680626e-01   -1.526452474289695e-01   -4.941150264114582e-01   +3.682485409684066e-01   +4.540049260096499e-01   +2.268100573170128e-01; -1.517770113439846e-01   -5.560421660831295e-01   -7.631782711763414e-02   -2.985714631146000e-01   +1.630014764932436e-01   +4.282546635927036e-01   +4.975711041983510e-01   +4.685916506291641e-01   +3.257183188118437e-01   -4.916798937043775e-02   -2.704926346711943e-01   +4.243686883076196e-01   -2.124738763640820e-01   -7.166484260851976e-01   -4.859193321567283e-01   -7.303394998446665e-01; +1.496648745533958e-01   -2.887429822647750e-01   -2.656817892157469e-01   +3.393540756075826e-01   -2.650310748308541e-01   -7.453904866668835e-02   -2.201725584706138e-01   +4.598685392483273e-01   -6.104831776866262e-01   -1.371570394354834e-01   -5.074272295305726e-01   +6.554065455576320e-01   +1.394164466004549e-01   +5.543293025822145e-01   +2.781574068785193e-01   +4.282759610550308e-01; +2.510019272580379e-01   +2.925288592876589e-01   +1.297444199954858e-01   +4.889930651361157e-01   +1.095454500330375e-01   -8.691222067756489e-01   -3.276339758590471e-02   +4.540303401340549e-01   +5.312404028853746e-01   +1.000000000000000e+00   +4.364971466802841e-01   -1.644959451739120e-01   +4.280941359522977e-01   -3.075395512164565e-01   -1.975772148017201e-01   +8.340689278121673e-01; -6.580875909939483e-01   +2.903731401667995e-01   +3.137033720293658e-01   -7.569690909197942e-02   +9.255598407807780e-02   -3.165608772426886e-01   +4.179684751677832e-01   +5.740092738818239e-01   +3.152183117977966e-02   +4.542722206376762e-01   -6.214625197398725e-01   +3.945353737792219e-01   +1.206083885422679e-01   -1.242643969719369e-02   -2.862000082459052e-01   +5.173931561115963e-01; -9.502330501140190e-02   +2.893829543429675e-01   +2.975768391027253e-02   +5.470535965156809e-01   +6.902976854095526e-01   -3.923344355137426e-01   -4.872828545749135e-01   -5.038790554780592e-01   +5.117708260501934e-01   -3.785776987545107e-02   -7.106782552561967e-02   -4.696188591687064e-01   +5.970251209083631e-01   +4.816864777423432e-01   +2.967725841481731e-01   +3.085094477335795e-02];
L2I_L2E_iAMPA_netcon = [+1.479748850587120e-02   -1.593444082696740e-01   -8.101489048628259e-01   +5.284497472730181e-01   -3.889295560121279e-01   +1.836650130456427e-02   +2.011858351600351e-01   +2.751448818433469e-04; -1.550583662292026e-01   -5.107684845379818e-02   +6.431068067179371e-01   -3.518290440093532e-02   -2.095306269350307e-01   -3.648776257883264e-01   -1.027910893780917e-01   -2.628564027909279e-01; -6.070904551530335e-01   +7.519684022648809e-02   +2.184407952882192e-01   -7.538951258646504e-01   -5.034620246107681e-01   -6.238555472471152e-02   +3.139729757845231e-01   -5.620404393871981e-01; +8.441517189541327e-02   +6.263403569171733e-01   -8.731974792612489e-01   +5.108422165759249e-01   +4.180052934523498e-01   +1.767568167264564e-01   -5.372522123982012e-01   -3.492322441147415e-01; +2.086743353151561e-01   +4.204208399139829e-01   -5.141931500229146e-02   +1.290972702425363e-02   -5.010835513180411e-01   -2.501538676277898e-01   +1.918039838077077e-01   +4.291966768646805e-01; +2.417349743002545e-01   -1.227770249706670e-01   +5.417318909710767e-01   -4.940263957243177e-01   -2.717242478713290e-01   -6.775100136648080e-01   -1.601848741777729e-01   -7.305044683085782e-01; +4.886573271829821e-02   -3.250188312432082e-01   -4.368109384285301e-02   +1.410908734650228e-02   +4.232474881241863e-01   +4.639123761726371e-01   +3.109471430318387e-01   -7.545381664019829e-01; -6.239322551917941e-01   -4.249745775444156e-01   -2.679155012183463e-02   -7.895651704744400e-01   +8.586422218001970e-01   -8.671373512260863e-01   +1.526214738566531e-01   -1.000000000000000e+00];
L2E_L2I_iGABA_netcon = [+5.197284126445623e-01   -4.466728984816838e-01   -4.418128321149656e-01   -2.369330734590112e-01   +7.520630896131683e-01   +4.922108528978577e-02   -2.477675105355440e-01   -1.722196889664979e-01; +9.191261864117703e-02   -2.090964285897135e-01   +2.518586814448784e-01   +4.772102036815316e-01   -1.425524147687093e-01   -2.943896171068722e-01   -4.166684487358120e-01   +2.435182849521587e-01; -5.433180058873072e-02   +4.570661671029332e-01   +5.353845083743648e-01   -3.854029282465701e-01   +3.334272930858795e-01   -5.893365518947722e-01   -6.218953416894020e-01   +5.861730400372076e-01; +3.274331765007728e-01   +6.112734589987475e-01   -2.060376818676742e-01   +3.829685570596344e-01   -9.286424718209034e-02   -6.561181971249175e-01   -5.161722753069138e-01   +4.817986868773246e-01; -2.742241337995103e-01   -3.440974724537150e-01   -6.431603066013325e-01   -2.451713607974851e-01   -1.568676162256032e-01   -3.138363707484979e-02   +2.479356127000449e-01   -4.644855888879319e-01; -3.512915073730147e-01   -5.772658896353315e-01   +3.970694692214295e-01   -5.757454853499806e-01   +6.986712543548738e-01   +3.563937039205743e-01   +2.178953745718181e-01   -5.804805075446626e-01; -2.686327978022936e-01   -1.915961975545261e-01   +6.149367336794173e-01   -5.060556371845559e-01   -1.361296304470027e-01   +6.154666090236147e-01   -5.232794750889873e-01   -5.820726153189398e-01; -2.876508837492769e-01   -1.000000000000000e+00   -5.856979472320808e-01   -6.784240153354112e-02   -3.540383317539951e-01   +1.284520659542409e-01   -5.947530982698976e-01   -1.122510156778803e-01];
L3E_L2E_iAMPA_netcon = [-3.938565238302696e-02   +1.132784007915487e-01   -1.527753331907088e-01   +1.800262645493110e-01   +6.605820361688638e-01   +6.546658942062787e-02   +2.150645922997652e-01   +1.634626090570743e-01   +5.514613123702680e-01   -4.308826354891320e-03   +3.306864462505544e-01   +3.127749399095291e-01; +6.389608999896935e-01   +2.090223396784349e-01   +1.365978928943811e-02   +5.697086976264292e-01   -2.738944430450261e-02   +7.377340838559464e-01   -4.024160902356440e-01   +6.333296225389719e-03   +4.048055844246268e-01   +2.057132455744330e-02   +2.285169063768669e-01   +2.588295422982083e-01; +6.444768744888420e-02   +6.708796924384287e-01   -2.580144079532310e-01   -9.209274450742974e-02   -8.747402625507233e-01   -5.409632028545460e-01   -4.714271262384908e-01   -3.007109113365568e-02   -2.792255875748231e-01   -6.422083571602600e-01   -6.190187120956800e-02   +4.675132941776272e-01; -6.467029185612031e-01   -5.166630354278643e-01   +1.083067443752918e-01   -2.143356745660399e-01   -2.800975043411461e-01   -5.871538579566742e-01   -1.679358164977315e-02   -4.061633510479615e-01   -7.587827012547688e-02   -4.036361884008383e-01   -6.408047853680182e-01   +1.690350877658809e-02; -3.369775095179657e-01   -1.000000000000000e+00   -3.141074703524838e-01   +1.301421533254997e-01   -6.432800241114972e-02   +5.172854046837350e-01   +2.750090425526953e-01   -9.812362012696785e-01   -2.836877772940407e-01   +4.443220899503020e-01   -3.652833391597317e-01   +7.269816702022591e-01; +1.319101357259281e-01   -3.887237492983204e-01   -2.950015200911799e-01   +3.224268884729018e-01   +6.906583036959912e-02   +4.287844930439395e-01   +6.813141831564843e-01   +6.237673508813125e-01   +2.308228919571199e-01   +7.035105411891180e-01   +1.906024502855614e-01   -3.556894784681307e-01; +2.945453852454090e-01   -8.081793574110329e-04   -8.022211714223515e-01   +1.126003901748925e-01   -5.911951240461675e-01   -5.790018790848497e-01   -8.001794483080928e-01   +5.299890791170924e-01   -3.406578757856836e-01   -3.028266658905853e-01   -4.074096312189867e-01   -4.193376740682526e-01; -5.242288772218595e-02   -1.686189817726380e-01   -2.996378290240622e-01   +8.521246724347250e-01   +4.044502823764468e-01   -4.019131139569302e-01   +9.028177975827796e-02   +3.480828591247883e-01   -2.901887071460828e-01   -4.089648473082370e-01   +7.319022942723377e-01   -5.368367798014777e-01];
L3I_L2I_iGABA_netcon = [+8.939061952014287e-01   -5.030286988685917e-01   -5.774006742635031e-03   +5.404294587908109e-01   -3.576183508645588e-02   -5.286700731651411e-01   +4.968515444202733e-01   +1.473593554461946e-01   -7.935306104643983e-01   -6.068743804343616e-01   -5.564117825461463e-01   -5.736624039859903e-01; +1.995278914257956e-01   -2.593707831127621e-01   -2.400207612375490e-01   -9.368720981619777e-02   -4.959100989986511e-01   +2.242118066592887e-01   +8.019683508698833e-01   +3.466845108523310e-01   +4.363149119272014e-02   +2.868406506495750e-01   -7.326128146899649e-01   +3.512162568364534e-01; -4.440322614997655e-01   -4.407718044807115e-01   +3.096135309413094e-01   +3.170374044996112e-01   +4.330761159291738e-01   -3.843761560132389e-02   -2.924367961577897e-01   +3.477313243487732e-01   -9.453783065366113e-01   -3.286675801265461e-01   +3.930264390278584e-01   +3.397081158524556e-02; -1.995776170269293e-01   +8.296390379565435e-01   +3.790493151109850e-01   +6.569331623608994e-02   -2.824396848984211e-02   -8.924867702969429e-01   +6.148656870507743e-01   -6.301911094603273e-01   -2.664484869427662e-01   -1.826781814151251e-01   +6.562157975922914e-01   -1.371729691214512e-01; -7.364519474862133e-01   -1.595659674971986e-01   -4.311519919404866e-01   -6.961660621123732e-01   +3.343241570779787e-01   +1.000000000000000e+00   +7.614971152351612e-01   -7.295725598466883e-01   -1.345000799924127e-01   -3.157017233780838e-01   -6.656156169978316e-01   -1.948399557861120e-01; -5.614233681786852e-01   -7.917934573768604e-01   +3.234603070118420e-01   -9.312101740106289e-01   +2.101650234837863e-01   +2.747547623752014e-01   -3.080114193485903e-01   +8.369475190716176e-01   +8.697030889935778e-01   -3.277756283402756e-01   -3.483687725346891e-01   +6.790242733021693e-01; +4.195255114234058e-01   +2.414895125611942e-01   +9.029459180329823e-02   +4.142719656669639e-01   +3.476474840465891e-01   -3.688691713012240e-01   -5.245036128158117e-01   +7.719263425452689e-01   +5.740210311905729e-01   -4.692534201031379e-01   -4.725865747597802e-01   +6.165852174817160e-01; +5.627975684067044e-01   -1.854225391735257e-01   -4.482069091797962e-01   -4.691457097932780e-02   -4.736436734250136e-01   -1.361909066112837e-01   +2.487201913554402e-01   +9.727037490788503e-01   -8.278335531505043e-01   -3.659268529963309e-01   +9.825412176399549e-01   -9.765297919970838e-01];
L2E_L3E_iAMPA_netcon = [+3.842735491834373e-01   +4.929870492272357e-01   -7.411677315675392e-01   +1.944055038679489e-01   +4.279421393163505e-01   +3.486114021900210e-01   +4.472145071172055e-01   -1.924572567360961e-01; +3.176450006245694e-01   +1.777715099249247e-01   +5.176582728254011e-01   +1.298611076582583e-01   -1.118451047105612e-01   -7.708066763561917e-01   +3.558126889071071e-02   -1.090697532790472e-01; -5.799497966958382e-01   -2.655094721663073e-01   -2.248207892301337e-01   +4.453426567676158e-01   -2.885928626439876e-01   -3.080886483862923e-01   -6.708085389152121e-01   -4.218140312688834e-01; +5.039705490177593e-01   -5.393924881260163e-01   +5.846155130896031e-01   +3.108108827905158e-01   -1.202130454765226e-01   +6.580901506227554e-01   -1.986304401550738e-01   +6.506130820984981e-01; -3.531203882452845e-01   +3.522835951750252e-01   -6.777491373581346e-01   +1.824286285706140e-01   -2.017845433413798e-01   +4.050968925597286e-01   -1.125017209904385e-01   +2.944264137264814e-01; +2.701836896203568e-01   +3.965376289080026e-01   +2.982617850567220e-01   +5.762747037612895e-01   -6.349505186846721e-01   -4.878089436803666e-01   +1.027303216377003e-01   -6.283340960852802e-01; -1.717317902814000e-01   -4.597397746194690e-02   +4.146002465691572e-01   +3.491484060163146e-01   -4.916984663751390e-01   -5.287218293105651e-01   -5.645844229288610e-01   +4.394404215665160e-01; +6.673597836456289e-01   +5.464098351145140e-01   -3.211006693825010e-01   -5.336367894761809e-01   +3.067286941843585e-01   -6.861770704167826e-02   +7.422291153839010e-02   -8.679583748875608e-02; -1.177736263888606e-01   -6.813368399393427e-01   +3.646108193220710e-01   +8.433700371484150e-02   -1.376333788758880e-01   +6.086454646259101e-01   -5.201711097230036e-01   -1.149198827471045e-01; +1.828128995630656e-01   +4.668572491945627e-01   -7.017520667691532e-01   -1.144757735818423e-01   -1.000000000000000e+00   -4.612341811022379e-01   -4.031425898921872e-01   -5.589717357034841e-01; -7.969024522137044e-01   -7.653272411147849e-02   -2.906721277311093e-01   -1.154833581008759e-01   -2.022099503140615e-01   +2.855680543639248e-01   -2.526140150445788e-02   +8.257314218009971e-01; +4.149772465294831e-02   -6.325107411140920e-01   -7.418846934064909e-03   +7.050899968928539e-01   +3.949664511585724e-01   +2.627311948726195e-01   -2.809115024588285e-02   +2.015630194148343e-01];
L2I_L3I_iGABA_netcon = [+4.754587502808261e-01   +5.935403017163913e-01   -6.689796131928816e-01   +5.716597419076959e-01   +2.852463535309067e-01   +2.973188026081552e-01   -1.527333261371013e-01   +1.651803146864628e-01; +3.831353798851238e-02   +3.473460577095472e-01   -1.911568842276160e-01   -6.309875361609907e-01   +7.764032542395023e-02   +6.014208755696272e-01   -5.536172707359861e-01   +1.252882579154366e-01; -2.712354950146330e-01   -1.441544350163995e-01   -3.296574628503647e-01   +4.821999634905034e-02   +3.787439931955917e-02   -1.321515130210797e-01   -2.579083554597911e-01   -1.368148326344410e-01; +1.727170334419037e-01   -7.563369174540973e-01   -3.818968615224146e-01   -7.118993148861584e-01   -4.593725727027251e-01   +6.189376174870603e-01   +9.299872649398432e-01   -3.606438085632612e-01; -4.739014674235617e-01   -4.994486169104873e-01   -3.110224139899645e-01   -3.209806729576650e-01   -1.633970236609746e-01   +1.814360688972959e-01   +1.164571864058327e-01   -6.208894709778587e-01; -2.959431108434263e-01   -8.614008426331329e-02   -7.958317070046915e-01   +4.185617499676081e-01   +1.000000000000000e+00   +6.197343831074837e-01   +7.310447770270929e-01   +6.531130964947347e-02; -5.219747254904080e-01   -3.747797809350987e-01   +1.124546965604773e-01   -5.200283208091431e-01   +2.776715051355314e-01   -5.218876927165796e-01   +5.725819798913460e-01   +3.213802855979440e-01; -2.503283615615459e-01   +2.269703054088458e-01   -5.211326893615043e-01   +3.466319235260928e-01   +3.862376332187388e-01   -6.204634400807492e-01   -1.220871914355438e-01   +7.209328563635474e-01; +3.318148763185772e-02   +2.157201049539519e-02   +7.178082912556222e-01   -1.816069146859580e-01   +1.878865718611795e-02   +5.088346859206723e-01   +4.891745225508026e-01   -4.920884396107205e-01; +6.925979116161014e-01   -8.320598601104655e-01   +5.371206426256440e-01   -5.465206187987611e-01   -5.441532808329340e-01   -2.901438543539553e-01   -4.713338736049420e-01   -6.755937130331912e-01; -5.194712772115769e-01   +3.145969672391635e-01   -3.427672955674128e-01   -3.550215190672253e-01   +1.453176423273644e-01   -5.275505505396305e-01   -3.128185688047208e-01   -1.882300563830633e-01; -2.777581303154311e-01   +7.470988961209143e-01   +2.214691380954451e-01   -9.286328625111420e-02   -2.723666826351015e-01   +2.281642310130238e-01   -4.649385610534539e-01   -3.750658577829301e-01];
L3I_L3E_iAMPA_netcon = [-1.000000000000000e+00   +5.687825567330357e-01   -1.724325252579610e-01   -2.318351018351487e-01   +2.856626730241533e-01   +4.412557163595231e-02   -6.918450074256975e-01   -6.224539134763369e-01   -2.199711752272720e-01   -1.738615911367592e-01   +4.836872631466850e-02   -1.182240864771689e-01; -6.697874208057841e-01   +6.095832462540772e-01   +1.025243961060496e-01   +5.412591545027612e-01   +1.134439496307823e-01   -2.537300411210947e-01   +5.427476356956865e-01   +1.349594353943934e-01   -3.688610180730411e-02   +4.475374703466839e-01   -3.873462870718260e-01   -4.524763911468086e-02; +7.110096000729479e-01   +1.952860359227490e-01   -2.506834391490463e-02   +7.227369093550721e-01   +3.533523274697858e-01   +2.203956892850119e-01   +6.915034723460980e-01   +3.971840577602120e-01   -7.958040339830726e-02   +2.785655217310920e-02   -2.136079358265845e-01   +2.360325950471266e-01; +5.728970807311538e-02   +5.473479687725391e-01   +3.813573279712713e-01   -2.866010454213860e-02   +1.474785678673635e-01   -2.930380746364264e-01   -6.201656496167878e-01   +5.338003600785386e-01   +3.705949167792598e-01   -2.539153939995666e-01   +2.078554722762851e-01   +1.149548987071889e-01; +2.607692113042003e-01   -7.494537019436936e-03   -1.221334128535529e-02   +6.942917665913065e-01   -5.652633727273912e-01   -7.799995747261258e-01   -2.121931545485079e-01   +3.491758648848829e-01   +5.574500429189407e-01   -5.027278672216070e-01   -4.854453088353973e-01   +4.952626480567647e-01; +9.750512002774354e-01   -9.278106087472704e-01   -3.146331517044495e-01   +4.364870642470343e-01   +2.870265123320402e-01   -2.916363953866158e-01   -6.437053831862670e-01   -7.661256659781794e-02   -5.765206364946741e-02   -2.206906013235606e-01   +2.777171124322272e-01   +2.509718165230926e-01; -4.629328779949495e-01   +5.340034537656808e-01   +3.188985772769267e-01   +8.758481715476627e-01   +3.097047607911363e-01   -5.950035475312874e-01   -2.433015702859875e-01   -2.489438909531763e-01   -9.949877469092072e-02   +6.532073217377479e-01   -7.666401020935663e-01   +4.400108460781825e-04; +5.222310679811306e-01   -4.219938844178910e-02   +7.808846563374637e-01   +3.083014833762341e-01   -2.680220783474458e-01   -3.831883539619613e-01   +3.604986226337000e-01   -7.710623149365511e-01   +7.496570571200839e-02   -2.425586548456495e-01   -3.251653514678796e-01   +1.293937741297024e-01; +2.211834758849258e-01   +2.589984764329223e-01   +8.141208020017519e-02   -6.872386447857661e-01   -5.636588106693970e-01   +5.143265749180911e-01   -5.539756894959791e-01   -1.189648876812547e-01   -4.996095888850808e-01   +3.252779946167202e-01   -1.673664595290104e-01   +2.366253285969949e-01; -7.125537975804561e-01   +7.250388525233252e-02   +1.574560844723415e-01   -1.123431134357820e-01   +3.711634132491599e-02   -2.847935959452113e-02   +5.699171381328896e-01   -4.507544373687278e-02   +5.391886364713520e-02   -9.019714386553322e-02   -5.639089837070613e-01   -3.590582982468249e-01; +5.431355720706234e-01   -1.115524633818835e-03   -6.460402347680289e-01   -1.336126696846826e-01   -2.159100607103714e-02   -3.780042246472577e-01   -6.234097065143800e-02   +8.423912091599471e-01   +1.550716360587043e-01   -6.541002166096260e-03   +2.398219535069182e-01   +3.320128057486363e-01; -2.348141348310780e-01   +5.104319976725875e-02   -4.430966485573447e-01   +3.458327100807172e-01   +3.182212266959242e-01   +3.045657840743248e-01   -6.106471988274152e-01   +4.609355588883690e-01   -3.680847758496348e-01   +8.753222018959882e-02   +4.024502392107421e-01   -2.936300614785118e-02];
L3E_L3I_iGABA_netcon = [+7.772348999805088e-01   +3.472510328207638e-01   +1.677141283636548e-01   -1.500110057108056e-01   +7.439932956096632e-01   -2.499074425448777e-01   -2.159182005479927e-03   -6.583145483390903e-01   +2.987829655248387e-01   -4.862118253840172e-01   -8.554792794289685e-02   +2.301837243284598e-01; +4.684468881829853e-01   -6.394309155310228e-01   -6.248779373734665e-01   -3.874084963235650e-02   +1.654916899113565e-01   -1.872330265159825e-01   -3.824835744718333e-01   +2.054351199850142e-01   +6.728673578151817e-01   -1.342751005637756e-01   +4.615072239299690e-01   +4.346078390670284e-01; -5.778277996333326e-01   -5.307273471873419e-02   -1.459439329500362e-01   +5.462501005055561e-01   -4.352649318702816e-01   -1.846375670370373e-01   -1.739778728060798e-01   +2.616373915882200e-01   -3.917570146704122e-01   +9.242768392146845e-01   -7.371528395122930e-01   +2.230275680696160e-02; +1.087902356958842e-01   -3.997446289400223e-01   -3.397775201126554e-01   +6.656696562372565e-02   -6.204352835658842e-02   -6.957644020435833e-01   -4.827105628758063e-01   -5.434513650865289e-02   -1.366189731395145e-01   +1.602238909680434e-01   -3.974894626250250e-01   +6.838445353285290e-01; +2.156933845812252e-01   -5.459414968636529e-01   +1.698888602417814e-01   +7.565600693798095e-01   -8.592622504436516e-02   -1.265146454505122e-01   +3.073236844016185e-01   +4.901941246582582e-01   +2.492670290831772e-01   +5.104564109048900e-01   -6.018299316145287e-01   -2.531884175313172e-01; +4.554830151833607e-01   +4.572805567612855e-01   -1.251569070326819e-01   -4.211879908681599e-01   +5.812485728824698e-01   -2.419768163108507e-02   -9.565089211803678e-01   +7.358748629963024e-01   +8.746172754177673e-01   -4.663612631042971e-01   +1.121773980204127e-01   +6.884156646535423e-01; -7.368663051240863e-02   -1.171044035556219e-01   +1.824946199946239e-01   -2.429966656169731e-01   +1.457069566103217e-01   +1.420001487334678e-01   -9.880566985274747e-01   +9.276515567167380e-03   -7.304534308383206e-01   -3.883326560957507e-01   -6.291604585045428e-01   +1.946085638429054e-01; +7.722295395531376e-01   +7.891030511401000e-01   -3.153200784311241e-01   -5.678881595332815e-01   +2.659655210850879e-01   -8.859557485559616e-01   -1.938321043203463e-01   -3.080865332465581e-01   +3.063065438770403e-01   -8.292829785467026e-01   +2.927914724485168e-01   +3.137112191980123e-01; +6.003550332512424e-01   +5.547063580180684e-01   +4.952464811451260e-01   -4.702678887223243e-01   +3.272981894229723e-01   +1.816187970663399e-01   -2.739355619365063e-01   +6.521527111203675e-01   -3.821004478555582e-01   +8.640773355535417e-01   +3.044560999927480e-01   -3.428835543685307e-01; -2.802884303939353e-01   +2.862944399176303e-01   +5.516796772171154e-01   -6.258491766442505e-01   +9.574892992600389e-01   +1.749687977075503e-01   -6.655744468438281e-02   +2.783707104987596e-01   +7.085596652901819e-01   +9.656464686041171e-01   +2.136608218842208e-01   +5.646571495470150e-01; +6.314979777706983e-01   +1.396948906471284e-01   -6.858577595471536e-01   -9.835434176285705e-02   +4.693459083377213e-01   +1.403085800364760e-02   -3.365511644638544e-01   +2.374888029061758e-01   -3.397452678105294e-02   -1.947828087464799e-01   +1.000000000000000e+00   -4.915777927785275e-01; +8.934414167870355e-02   -2.205616773490625e-01   -1.466564099236165e-01   +8.524552062943254e-01   +1.819809861973622e-03   -3.981340756247140e-01   -4.554271414310124e-01   +1.771922808339163e-01   -1.999215927980713e-02   -5.513457724224738e-01   +3.290155521942292e-01   -2.404459049486527e-01];
L2E_Input1_iAMPA_netcon = [+9.977293523621801e-01   -3.792423728604709e-01   -4.554391381078059e-01   +2.421421637767318e-03   -5.448535335066953e-01   +3.068138691509270e-02   -1.875597835964249e-02   -7.828420475814474e-03];
L2I_Input2_iAMPA_netcon = [-6.786084671868379e-01   +7.530966453627936e-01   +4.848044476369486e-01   +5.657993710590367e-01   -3.234953437297062e-01   +1.000000000000000e+00   +1.284360719359560e-01   -5.078770608618086e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
