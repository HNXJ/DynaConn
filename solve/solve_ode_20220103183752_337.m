function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.161838346723780e-01   +9.454674204261870e-01   +6.982883602223681e-01   +1.565946820259581e-01   +9.221309006073163e-01   +2.193892724111708e-01   +7.421939071201710e-01   +3.040970263260646e-01   +5.311914610904421e-01   +8.291984695451331e-01   +9.700784141063566e-01   +9.642172479526024e-01   +6.988157960196291e-01   +3.719636872240067e-01   +2.979828294022128e-01   +3.761857873371069e-01; +3.475603020595013e-01   +1.212607992978405e-02   +1.420087072477911e-01   +1.733170384394580e-01   +7.356943042410451e-02   +8.097085213870691e-01   +7.939459560915217e-01   +7.566887796049571e-01   +7.846039728009931e-01   +1.833953152917435e-01   +4.673630279316822e-01   +6.559865603656729e-01   +3.746355075346442e-01   +2.767455742932030e-01   +6.876576946499411e-01   +9.510672198119587e-01; +2.057872527837784e-01   +4.699305561070731e-01   +8.343469805618910e-02   +7.040817944699483e-01   +3.121730469730722e-01   +3.809592597714988e-01   +6.640901104977837e-01   +9.535544382467002e-01   +5.010996926109899e-02   +9.248649937132066e-01   +8.721461628618024e-01   +2.076361676033292e-01   +5.398110690993063e-01   +7.495439406093089e-02   +7.723555467096754e-01   +8.120710772802311e-01; +2.448113760519834e-02   +4.893920415932244e-01   +4.330480184489783e-01   +8.320890147496658e-01   +6.296298902371952e-01   +8.580685735841802e-01   +4.388859243470404e-01   +7.699380412579370e-03   +4.632486738815534e-01   +4.211719831343777e-01   +9.461564511689613e-01   +8.975898065108894e-01   +5.164414798983790e-01   +1.499179011099374e-01   +7.217374044535717e-01   +8.917307163836140e-01; +7.661348143429160e-01   +5.169974067128332e-01   +8.943718880283646e-01   +8.266130095028904e-02   +9.074045166677207e-01   +3.239353218646479e-01   +5.752461845054421e-01   +4.070756345709316e-01   +9.400658251841634e-01   +2.988329883701610e-01   +2.313991587842718e-01   +4.888861923946259e-01   +7.633716183072171e-01   +3.653386696308369e-01   +2.773153984265433e-01   +6.890587075410333e-02; +5.728760555619522e-01   +2.895116718547180e-01   +7.302695855956396e-01   +8.355765154534629e-01   +7.968625328840381e-01   +3.807855736269389e-01   +5.172996507441705e-01   +1.541482308840836e-01   +4.735892331538603e-01   +3.476400377181331e-01   +9.186993960729303e-01   +6.645853360295753e-01   +8.240556226829120e-02   +7.161202230888636e-01   +1.284061997168432e-02   +9.040214988270877e-01; +5.783273693231727e-01   +5.666357812520531e-01   +6.818127740056308e-01   +5.406777672531848e-01   +6.402838943842358e-01   +6.386065889787638e-01   +7.237198220415285e-01   +8.207569408813621e-01   +7.780972258677630e-01   +9.726945686526893e-01   +6.324280105012650e-01   +5.254394729423626e-01   +2.954163894084501e-03   +5.326688196417146e-01   +1.401576728683999e-02   +6.652712699344103e-01; +3.887397526775624e-01   +5.105357392385155e-01   +2.039425518753248e-01   +9.639026855469903e-01   +4.403391954892671e-01   +3.861653406286190e-01   +2.210480730179753e-01   +2.874516097829049e-01   +1.099067571039680e-01   +5.324614571805684e-01   +2.853444125560992e-01   +7.090289236168079e-01   +4.039250927526512e-01   +2.340828564068680e-01   +9.342734982481475e-01   +3.464169706778993e-01; +5.542205569618154e-01   +6.769871816102604e-01   +5.290604224665055e-01   +6.788518749363117e-01   +7.503333335443571e-01   +6.969047677344208e-02   +1.000000000000000e+00   +9.772650945331081e-01   +5.214300357550211e-01   +7.904523728508113e-01   +8.532925045073332e-01   +7.190352728743320e-01   +6.613042794872942e-01   +4.698465190149453e-01   +9.315242238779742e-01   +8.392639803003622e-01; +1.834647962710998e-01   +6.164065003326339e-01   +8.307785713823638e-01   +3.359628439654063e-01   +8.247523433296378e-01   +1.820612780448459e-02   +6.195396879171788e-01   +6.244166544028762e-01   +6.353109084069340e-01   +7.940223296614732e-01   +1.655999168173367e-01   +2.938118928127694e-01   +3.681969208134494e-01   +7.144821384882294e-01   +3.737044273903539e-01   +1.963233641165261e-01; +1.179420685106615e-01   +5.647402299675206e-01   +1.737979144458339e-01   +2.194546649000657e-01   +3.411856339612287e-01   +8.777894440625749e-01   +9.821143820435505e-01   +7.447630585508410e-01   +5.777908078217999e-01   +1.421017032293187e-01   +8.251468166797609e-01   +1.159935499325323e-01   +3.930546542207433e-01   +5.150736372512132e-01   +1.096034356390785e-01   +8.407477334805226e-01; +5.954641644938092e-02   +5.039716568930154e-01   +5.165807124899887e-01   +5.666684172956161e-01   +1.391534059767957e-01   +1.560089996320890e-01   +4.959934516824643e-01   +8.742516809827102e-01   +8.351747600386806e-01   +4.549573660444854e-01   +2.143763144522508e-01   +3.236853973031909e-01   +1.333349534967916e-01   +5.141816734555887e-01   +7.205817967182386e-01   +4.260877021914799e-01; +9.331415833947706e-01   +6.651062868838834e-01   +3.564489877313575e-01   +2.031856566628233e-03   +5.045363062157511e-01   +9.156034511660593e-01   +5.214989984421178e-01   +3.278289108156490e-01   +1.175248233685427e-01   +4.586679365793058e-01   +2.692773760512878e-01   +4.573325357969026e-01   +3.385073353205628e-01   +3.843654164089782e-01   +4.497217464085722e-01   +5.609860992969417e-01; +7.456132187579925e-01   +6.333150539855880e-01   +6.485865685525027e-01   +5.896722425438486e-01   +4.128280683845740e-01   +5.589961698072504e-01   +8.543539961772147e-01   +9.952795582307496e-02   +5.237746252873324e-02   +9.557169676026825e-01   +9.085257092792799e-02   +7.155832645084167e-01   +1.201251858509098e-01   +4.801773326620101e-01   +1.073667917803968e-02   +4.481864340095959e-01; +2.431153510872487e-01   +1.453549715785501e-01   +2.804206355931226e-01   +8.916689151058603e-01   +1.707878018753219e-01   +9.214667903908339e-01   +2.542306172850305e-01   +4.515329897128545e-01   +5.179073384714825e-01   +5.209162368639842e-02   +9.188784740597298e-01   +4.039495079525236e-01   +3.683419723769945e-01   +7.396675349637243e-01   +1.217200105315330e-01   +7.602165522970560e-01; +2.050155275911595e-01   +1.778121604687639e-01   +4.349381961391008e-01   +2.555051249172084e-01   +4.936096016253067e-01   +5.979898519336121e-01   +5.803509341726735e-01   +2.409700401569496e-01   +6.951689278860312e-01   +3.696993464220910e-02   +7.248075707779045e-01   +2.417566631658994e-01   +2.513525024145289e-01   +7.012486298165614e-01   +6.593989571152433e-01   +9.847748764202205e-02];
L1E_L1I_iGABA_netcon = [+8.426334914397121e-01   +7.521325221639457e-01   +8.738736286163516e-01   +4.373093329928850e-01   +9.190941179478512e-01   +7.765703452536918e-01   +3.237094590975487e-01   +6.432578026655635e-01   +9.352937725487795e-02   +2.480985889869563e-02   +1.301735469688111e-01   +5.199307891789381e-01   +8.715091570074753e-01   +5.748270268243787e-01   +1.675901909640523e-01   +6.288253508110399e-01; +6.213426561984686e-01   +9.945808920767693e-01   +3.102374687033077e-01   +1.493146153356935e-01   +8.831054869024870e-01   +2.741239171011295e-01   +9.617462146338412e-01   +4.311055614738427e-01   +2.930719328483929e-01   +5.146985583021682e-01   +4.243744583230531e-01   +2.021243985195198e-01   +8.047298077820001e-01   +2.887359856001320e-01   +5.364329932873452e-02   +3.371055315673630e-01; +6.711911453163933e-01   +3.728504864727600e-01   +4.327129258846658e-01   +6.521390735918481e-01   +5.844787953147987e-01   +5.266914719070955e-01   +3.537910237060896e-01   +4.810014657786617e-01   +3.256469375123441e-01   +8.635365686396325e-01   +4.819265538784161e-01   +7.743037684066640e-01   +6.445863793791828e-01   +1.341136848422801e-01   +2.110845523271987e-01   +1.563037429117565e-01; +7.841742776431186e-01   +5.024643997210827e-01   +3.825882098966018e-01   +7.233142313149885e-01   +8.353531987769658e-01   +4.031770105888932e-01   +3.211493557868111e-01   +1.023201505897727e-01   +4.812464921115220e-01   +5.831490128714020e-01   +6.722465160364905e-01   +3.925062389339356e-01   +7.339599524212850e-01   +4.915204900775161e-02   +2.015700176151190e-01   +4.014741318096238e-01; +3.107646592988550e-01   +7.569582498776815e-01   +6.556460483695367e-01   +1.633978059889077e-01   +7.761744804238252e-01   +7.815018820912359e-01   +9.072199394420843e-01   +8.073582784685858e-01   +2.405152246126891e-01   +4.216025236093162e-01   +3.581404358195959e-01   +6.838130140215301e-02   +6.660700414260731e-01   +6.219273962536536e-01   +2.174902591222503e-01   +9.137438707738320e-01; +3.286241366980392e-01   +1.290382527631128e-01   +2.388501428593619e-01   +3.413475488046035e-01   +7.872599143372651e-01   +2.640402466647139e-02   +8.860241346896304e-01   +6.437293787889592e-02   +4.534991117638074e-01   +7.145909403801256e-01   +4.983798107736541e-02   +7.590359567826477e-01   +8.809269027777767e-01   +6.062414983916781e-01   +5.805054101916262e-01   +1.493656200759398e-01; +6.350172833194524e-01   +5.180447229764094e-01   +6.858419317654102e-01   +1.057963062368160e-01   +7.002533368610016e-01   +4.111106557572083e-01   +3.521632688244633e-01   +9.534439435943941e-01   +7.569512926647871e-01   +2.319542698787091e-01   +2.884560659986761e-01   +4.550006609055451e-01   +8.539387889681266e-01   +3.707696090822114e-01   +3.428150633968493e-02   +4.655507177618087e-01; +9.021647566454691e-01   +9.065682719137708e-01   +3.267744593244578e-01   +4.253454840509514e-02   +1.854667629605146e-02   +8.254942668264345e-01   +7.487379312522825e-01   +7.726149162489850e-01   +7.163660727423491e-01   +5.958463289942610e-02   +7.943813835653420e-01   +3.182150952166650e-01   +4.054192003330181e-01   +8.323647617902803e-01   +7.959606251829225e-01   +7.471109973951841e-02; +3.700327464402045e-01   +9.797262475331589e-02   +8.797974456774489e-01   +4.778314692194011e-01   +3.277328002102803e-01   +5.927392620853144e-01   +1.268328035080953e-01   +4.435629932708890e-01   +2.350508484590576e-01   +9.761392105746762e-01   +6.510289283086492e-01   +2.776108371954605e-01   +1.059696019277864e-01   +5.186554529499946e-01   +1.336167384576872e-01   +3.393915830747300e-01; +8.835024792437288e-01   +1.793520058636919e-01   +9.994631195457689e-01   +4.783138473666869e-01   +9.459915795460719e-01   +2.129193933506651e-01   +5.984347515236064e-01   +1.666068351848368e-01   +6.991543792336634e-01   +9.703020677480971e-01   +7.106054940511917e-01   +5.815133678725191e-01   +4.038101945968360e-01   +8.027121186978846e-01   +5.821550393738248e-01   +4.946593807751339e-01; +1.256127603357219e-01   +1.731013760367976e-01   +6.835131616724647e-01   +5.467063695720301e-01   +4.007973371785084e-01   +2.942300158794218e-01   +4.355663641238632e-01   +8.103622219229542e-02   +3.065361255304938e-01   +1.371770117375105e-01   +7.651647580007251e-01   +9.117652776207864e-01   +3.409323848715289e-01   +5.724147497393236e-01   +8.607359936313713e-02   +4.897949206859269e-01; +8.908059912409740e-02   +5.320825935575628e-01   +3.474224830855055e-01   +6.504331288676271e-01   +6.325446025774505e-01   +2.680791040799725e-01   +9.612367986726935e-01   +7.421061492003500e-01   +4.677563618043880e-01   -2.603069483024920e-03   +3.853606348729893e-01   +4.520652991041990e-01   +1.142126683358592e-01   +7.148939254366452e-01   +2.277335406758100e-01   +1.300857573429010e-01; +5.468294590079653e-01   +9.790320921937870e-01   +5.603792772774041e-01   +3.462808732332352e-01   +8.567037227970283e-01   +9.271294817876166e-01   +9.662173617804543e-01   +5.422652936768434e-01   +4.435921447673495e-01   +9.353494189192749e-01   +3.614987576059263e-01   +9.785634423346514e-01   +8.508071374211187e-01   +7.317916023579073e-01   +4.513860233503387e-01   +8.250712296347984e-02; +6.104216861282220e-01   +8.434326356674845e-01   +8.923383265118419e-01   +2.548793775072149e-01   +3.745394835684159e-01   +5.523519220094600e-01   +2.412720769322262e-01   +4.840877642085207e-01   +7.355106617057781e-01   +7.389910600324978e-01   +8.131008100223880e-01   +1.083981321885230e-01   +8.912241781508941e-01   +4.531449850142148e-01   +1.812888704267145e-01   +6.729497502377464e-01; +7.275116152506979e-01   +6.724200807000441e-01   +6.480760535167907e-01   +1.781354481411526e-01   +2.035008383841501e-01   +4.314058375523468e-01   +7.689238238232592e-01   +8.928953637110202e-01   +8.762056051772669e-01   +4.323199849657136e-01   +3.867941252476524e-01   +4.163538469671804e-01   +6.881723801973063e-01   +2.813211448508808e-01   +4.161050125884607e-01   +1.215497284638233e-01; +9.922601079512486e-01   +9.696644040130474e-03   +3.770255924309643e-01   +4.787804728128975e-01   +9.108640470615206e-01   +3.290798947111460e-01   +7.125713705045528e-01   +5.838760598665240e-01   +9.130303737366685e-01   +9.428336768750425e-01   +8.734120213098842e-01   +3.865565557392371e-01   +7.433185003828220e-01   +1.539942119303996e-01   +9.647251596921247e-01   +9.888499273692721e-01];
L2I_L1I_iGABA_netcon = [+5.759017785105228e-01   +5.615916128964149e-01   +1.079656472073865e-01   +4.568574842688784e-01   +7.969790137232600e-01   +9.781183687020979e-01   +2.228051684509970e-01   +7.598472367008169e-01; +5.594895160714823e-01   +9.509051202473929e-01   +1.193923990056161e-01   +5.671955108917611e-01   +5.432952917872094e-01   +4.222434447943199e-01   +6.565716668773378e-02   +5.037857128260291e-01; +6.128212546003382e-01   +8.814985377639990e-03   +4.347671883781579e-01   +8.167180850258304e-01   +2.582312275903403e-01   +3.928948382572657e-01   +8.364290836166252e-01   +8.286555631815051e-01; +4.670322908157551e-01   +1.269468810152200e-01   +9.355543959098512e-01   +3.536645654280051e-01   +7.814305662735341e-01   +4.628848407367581e-01   +4.248614979681057e-02   +9.254049350294453e-01; +4.357350116598707e-01   +8.546230945859629e-01   +1.401571891936229e-01   +2.468377442815807e-01   +7.781910022800150e-01   +1.212213768469575e-01   +9.099505438073102e-01   +7.127555560011678e-01; +6.332200042567873e-02   +2.181761968432090e-01   +8.264654516253672e-01   +7.704376755198535e-01   +1.451936916963204e-01   +4.568846312368021e-01   +4.518414767627847e-01   +7.967573660213967e-01; +6.459947003322967e-01   +7.096484825188334e-01   +9.331290806689656e-01   +2.558935685168735e-03   +8.241791210810334e-01   +2.641924637929352e-01   +2.829201208397490e-01   +9.594611661828247e-01; +4.225520855758382e-01   +7.735083081642721e-01   +5.723370924488161e-01   +2.745824618574574e-01   +6.214964877210650e-01   +9.366481861900096e-02   +7.556903011300088e-01   +9.524761694744319e-01; +7.544440518593540e-01   +4.227957649970148e-01   +4.985932281569426e-01   +2.457971451413546e-02   +4.570586710774576e-01   +6.623360985152239e-01   +9.273896616594054e-01   +2.960895153288339e-01; +3.063982791656238e-01   +7.256970451433292e-01   +9.312328251097235e-01   +6.695603420845199e-01   +4.820287124664864e-01   +9.469914620284856e-01   +1.418050572048327e-01   +3.520785687418164e-01; +5.984453551936014e-01   +4.580281265904935e-01   +8.620627010739944e-01   +9.686482596320417e-01   +2.193400941562311e-01   +7.631145615786142e-01   +9.549565857932687e-01   +5.424389075364102e-01; +3.327275588388636e-01   +8.056616187645497e-01   +2.523439437739501e-01   +9.468328433699675e-01   +8.561435665730023e-01   +4.277192957694236e-02   +3.064624837867922e-01   +2.154408628468212e-01; +6.436161019669187e-01   +4.293856828796750e-01   +4.595445696173754e-01   +4.736357988648972e-02   +8.791806821133539e-01   +2.606532279240918e-01   +2.074953613316921e-01   +8.338655479155552e-02; +4.021359789993397e-03   +1.500411397132427e-01   +7.386452566963546e-01   +2.878563304047546e-01   +8.436915879557130e-01   +6.350847644338574e-01   +4.624757770685425e-01   +5.034691625328441e-01; +1.455908626825115e-01   +8.044579629029452e-01   +7.521289089265444e-01   +4.890970562227473e-01   +4.428329367581637e-01   +9.046280786024870e-02   +5.960628888021270e-01   +1.950856598401188e-01; +2.478496732771191e-01   +3.807044749746770e-01   +2.319623322147028e-01   +8.878922100816645e-01   +5.446954650715019e-01   +7.472031634394088e-02   +5.517226665582912e-01   +1.431863522680537e-01];
L1I_L2I_iGABA_netcon = [+6.996333740120663e-01   +8.690891729294374e-01   +6.138688560175841e-01   +5.434540079001200e-02   +1.450437636826837e-01   +2.365078045643661e-01   +8.392856033554597e-01   +3.705969383333014e-01   +7.085531436916189e-01   +3.820535232849994e-01   +2.382386707426244e-01   +6.684531890170909e-01   +1.672688223984125e-01   +5.706737559273176e-01   +4.355777514625113e-02   +4.830777269208918e-02; +5.987629394806275e-01   +7.967210752220135e-01   +6.105402714040631e-01   +5.638544659758257e-02   +7.459695491605890e-01   +5.532272537046565e-01   +1.972303425464056e-01   +5.573031716653034e-01   +1.859452199221545e-01   +7.209418987256719e-01   +5.108388596223731e-01   +3.300210670125256e-01   +1.132145395782349e-01   +8.119292631174890e-01   +4.400820970027596e-01   +9.201382797579217e-01; +1.631364041076732e-01   +6.252593847052330e-01   +3.127336885911270e-01   +5.982511345536153e-01   +9.499881928902635e-01   +1.145687951583963e-01   +6.152018754350872e-01   +8.314163720727867e-01   +2.317185609692486e-01   +6.399842054156281e-01   +7.319512367613351e-01   +5.512616087777673e-01   +7.379405664678699e-01   +6.756605439535114e-01   +9.173080875944084e-01   +1.739665372116491e-01; +4.843187101935134e-01   +4.732938963995379e-01   +1.414900697666522e-01   +6.593831961561055e-01   +2.635987811847603e-01   +8.189735016225632e-01   +1.543723036918306e-01   +7.105033976351399e-01   +9.989723247105770e-01   +9.979411810155259e-02   +7.706130305219464e-01   +5.343250768265984e-01   +2.113026377944821e-01   +4.415461960594180e-01   +8.836842151027535e-01   +7.419609197258186e-01; +2.861740722768212e-01   +1.898373094285381e-02   +6.020598770860285e-01   +4.803515583814897e-01   +9.437057151773358e-02   +6.523515723542778e-01   +5.813762033738695e-01   +1.142386221973920e-01   +9.023598220632336e-01   +4.926161550042978e-01   +6.763516534723233e-01   +9.003698915393379e-01   +4.829943549793757e-01   +8.949415914348415e-01   +9.226812371278771e-02   +4.758036125478960e-01; +4.028577360516742e-01   +1.174124882086938e-01   +8.905096876691335e-01   +9.783600031477627e-01   +2.299526959672228e-01   +2.352156015648164e-01   +5.431664531991602e-01   +7.400842210521522e-01   +8.960895791979707e-03   +5.604114258518178e-01   +8.151923553884530e-01   +2.849396390528270e-01   +5.235129498094229e-02   +7.823373913128162e-01   +6.746664500530417e-01   +2.472720094514036e-01; +4.921173512725492e-01   +7.197108287938486e-01   +5.610030974840254e-01   +8.640867541677258e-01   +8.938099609645906e-01   +3.021089775210863e-01   +6.829291770653593e-01   +9.239153964164420e-01   +8.335370296199210e-01   +5.639343911207146e-02   +4.178512433513799e-01   +1.381694626425546e-01   +5.736344970248918e-01   +5.811202071872201e-01   +7.005819621962450e-03   +6.648937716543412e-01; +8.640051560572191e-01   +6.797403333730362e-01   +6.316824576851371e-01   +9.548848962794332e-01   +1.976077400313804e-01   +3.293984152301884e-01   +6.983013278665426e-01   +9.221428327157348e-01   +2.514329397987028e-01   +8.751403023668655e-02   +4.969739937177807e-01   +9.555873198691198e-01   +4.931965906224849e-01   +6.169927446059937e-01   +1.193803271682492e-01   +6.084165214341197e-01];
L2E_L1E_iAMPA_netcon = [+3.662080266107142e-01   +5.631176226862962e-01   +2.007290063456753e-01   +5.145523742211972e-01   +2.914599310618156e-01   +7.494937376465237e-02   +2.784920636966206e-01   +2.640890488933442e-01; +4.355661279005389e-01   +1.928791325837126e-01   +1.377979425131457e-01   +6.844009699133202e-01   +6.197592446916357e-01   +5.936323211499079e-01   +9.298116283137284e-01   +9.037690131789161e-01; +7.194704999955830e-01   +6.116051960337358e-01   +8.008472392311462e-02   +2.080584774394765e-01   +8.667601224668069e-01   +7.770735893145146e-02   +7.627253228484513e-01   +1.584026417909952e-01; +1.911352381747762e-01   +7.388525508498311e-01   +9.048157534430251e-02   +9.725702565134277e-01   +8.220910195100856e-01   +3.956081934960459e-01   +2.625675079372827e-01   +5.531806137373020e-01; +3.869623316040450e-02   +8.325270371952634e-01   +5.524340727232342e-01   +3.500573897116623e-01   +2.076295827349773e-01   +5.854695229666140e-02   +2.425989291166523e-01   +4.205314388633726e-01; +3.168408762005225e-01   +2.800722094625098e-01   +7.320403187534134e-01   +1.853391530427969e-01   +7.500324633849343e-01   +1.273720661858402e-01   +1.673924642366790e-01   +5.459033047891477e-01; +7.891025810157156e-01   +6.078074637710376e-01   +5.447887098595062e-01   +2.395081087405679e-01   +1.989681531225986e-01   +2.425566977787426e-01   +2.877664116224279e-01   +7.516301339619857e-01; +4.675640165466642e-02   +5.486832261745324e-01   +5.446003325868144e-02   +2.552322744818702e-01   +5.800043995328173e-01   +9.462049304245576e-01   +5.652478559835800e-01   +1.449354213162538e-02; +2.161645325830194e-01   +2.766693728437999e-01   +6.342098225739020e-01   +2.213644641341011e-01   +8.778760789028687e-01   +2.008856270576428e-01   +4.032598591274765e-01   +8.810173464987667e-05; +2.738247800905057e-01   +3.377624975770974e-01   +9.949399448659960e-01   +3.401717692724333e-02   +7.123278119141728e-01   +3.276922096790091e-01   +9.874816195628718e-01   +2.023666253364717e-02; +7.887759114403287e-01   +5.680389503662333e-01   +9.135789272213576e-01   +3.572690869833004e-01   +7.018274430022375e-01   +8.654973105390321e-01   +5.435541630022060e-01   +3.578205144365768e-01; +9.898115375107025e-01   +7.423047165143272e-01   +7.688779675522108e-01   +8.990799138197004e-01   +4.656646999270855e-01   +9.247274568263582e-01   +9.285364277762165e-01   +4.261694359961768e-01; +9.586408428578751e-02   +7.697131855412664e-01   +1.922334124906026e-01   +1.412826406838406e-01   +5.048447607806090e-01   +2.307943738744788e-02   +9.918836601786215e-01   +5.458803429464182e-01; +1.970129997530965e-01   +3.988677151568239e-01   +3.269073003449680e-02   +9.567393088760323e-01   +7.988737933289252e-01   +3.635406091954186e-01   +8.355513400967359e-01   +4.908309463601883e-01; +1.156838237061187e-01   +1.475385175820697e-01   +3.744240145115745e-01   +9.039540898330012e-01   +9.388197612334862e-01   +5.283781792782773e-01   +1.791948874158014e-01   +9.218712943901289e-01; +6.463271833550543e-01   +2.069538522799216e-01   +5.769206239741701e-01   +4.103844684057205e-01   +7.836807354050986e-01   +4.074154266511100e-01   +3.120422422319304e-01   +4.148106621346192e-01];
L1E_L2E_iAMPA_netcon = [+4.968133129786049e-01   +4.481826127127016e-01   +6.147562819645280e-01   +4.899045088104797e-01   +2.299751413209396e-01   +7.212443572243187e-01   +6.923579227863167e-01   +6.346475733175257e-01   +5.222341196573960e-01   +2.413349821372610e-01   +8.797885855190275e-01   +1.726780132237651e-01   +1.379873510211409e-01   +2.441113584961313e-01   +1.851469923654685e-01   +2.266852462909259e-02; +8.392869274263938e-01   +3.675659706474758e-01   +1.040075547458465e-01   +6.609959006926701e-01   +8.391845771679650e-01   +3.827518435378217e-01   +9.778015183117517e-01   +6.247025987377542e-01   +6.734723398224590e-01   +7.297570668971989e-01   +6.575546242598955e-01   +3.024957704900088e-01   +2.855915609724897e-01   +7.490082169746992e-01   +1.483039188344516e-01   +2.487453958683998e-01; +1.859226418308847e-01   +3.005572223324957e-01   +7.530609934731822e-01   +1.795532922196319e-01   +7.337428203313632e-01   +3.830678425673758e-01   +7.515836003436646e-01   +4.086813203544333e-01   +7.765125291591997e-01   +1.357120744720085e-01   +5.373660492266509e-01   +1.081293218547657e-01   +8.079533793015944e-03   +9.364022653965995e-01   +1.321597792628214e-01   +9.878893351684236e-01; +3.349185276435011e-01   +2.328791793669906e-01   +5.377382727618220e-01   +4.782818910111150e-01   +4.902824927851234e-01   +7.122721784670344e-01   +5.530750269920021e-01   +4.255840383095481e-01   +4.622704158508325e-01   +4.203180823592336e-02   +2.504960453049117e-01   +4.511958343254168e-01   +3.077913737326937e-01   +3.051789452226638e-02   +1.725061820234385e-01   +6.293338529824803e-01; +6.953958899038535e-01   +1.364476453062178e-01   +4.445702753581168e-01   +4.988947421209741e-01   +8.516464550530626e-01   +8.375438136740573e-01   +2.950020553718811e-02   +5.097786864078087e-01   +9.070025162844836e-01   +6.500057842275653e-01   +1.046339835398963e-01   +5.855928997194270e-01   +9.053218106098335e-01   +4.368389186718375e-01   +9.215376867166302e-01   +3.567910609970628e-01; +6.941573556620761e-01   +1.012300620378096e-01   +7.435971126981327e-01   +5.985626144998357e-01   +7.160639523134184e-01   +6.672466946811264e-01   +1.954188439872915e-01   +2.579009397320882e-01   +2.487218330411701e-02   +2.007030864928613e-01   +9.735193947546925e-01   +2.239794274348965e-01   +2.947716250181425e-01   +8.324947541832524e-01   +2.618248155652710e-01   +9.439590042932362e-02; +3.681674350241610e-01   +2.273106190280768e-01   +3.869639100820341e-01   +2.418154665269131e-01   +5.228365935936178e-01   +6.474943822298534e-01   +9.411093728705296e-01   +4.226645874945903e-01   +4.789810456212222e-01   +9.726412891205202e-01   +5.972124636843962e-01   +1.109343174366597e-01   +8.310528507930122e-01   +9.973753675802320e-01   +2.065439329402244e-01   +4.087239674066494e-01; +3.101533229882655e-02   +3.468078399596164e-01   +5.254674649360989e-01   +5.178978955147151e-01   +9.403674274829787e-01   +5.637290244182603e-01   +3.950364356635080e-01   +5.226215921289221e-01   +2.721251776299214e-01   +8.191737672148709e-01   +8.170026086984875e-01   +5.591996909954428e-01   +7.430648217656243e-01   +9.194917308187964e-01   +6.115950248506500e-01   +9.310735298279913e-01];
L2I_L2E_iAMPA_netcon = [+6.760598643306056e-01   +6.154465389748099e-01   +4.048255630677230e-02   +7.954616506194911e-01   +5.229342522636116e-01   +8.235113764323275e-01   +6.470843914990894e-01   +3.836966470264399e-01; +2.311757989994332e-02   +9.443917689759802e-01   +5.318392876980781e-02   +9.296875690081506e-01   +5.604545245719272e-02   +1.083600337911614e-01   +4.186115267645811e-02   +1.684914747107143e-01; +7.370666375828969e-01   +9.638218797732876e-01   +4.027136962532371e-01   +9.375140358411511e-01   +2.863178774839529e-01   +2.450411636031140e-02   +5.681604940927735e-01   +4.451207703977477e-01; +2.118037023684127e-01   +3.717036016636467e-01   +9.830904976221382e-01   +1.446712488209104e-01   +7.102428333571297e-01   +1.243539180265160e-02   +3.039018550505393e-01   +8.743823928151304e-01; +8.616227295741292e-01   +7.970072728366171e-01   +7.140853784249959e-01   +3.198265276757401e-01   +8.805841074408705e-01   +3.359155338778797e-01   +2.622418089824515e-01   +4.097943995266093e-01; +1.593038268927918e-01   +7.296600634804478e-01   +9.891015963900645e-01   +4.305249290864392e-01   +3.667601123568495e-01   +6.644129204061376e-01   +7.206649591588812e-01   +1.630758179113080e-01; +6.681605441560379e-01   +9.532402509347446e-01   +6.441268775296375e-01   +7.037718516066798e-01   +5.614399317312455e-01   +5.956906312010217e-01   +3.066160926938610e-01   +6.628374962256076e-01; +9.365158062760057e-01   +1.283487599588315e-02   +5.008316413953048e-01   +6.170318702739145e-01   +8.834364665154698e-01   +7.979141835291258e-02   +8.956297950298988e-01   +9.262901201199810e-01];
L2E_L2I_iGABA_netcon = [+6.315597826097334e-02   +5.175473392440938e-01   +3.557041398055578e-01   +2.591477164390761e-01   +4.336680624541940e-02   +8.932981565616023e-01   +3.410059788651623e-01   +4.519788849043747e-01; +3.540282256942147e-01   +6.854466916424029e-02   +5.575982779419204e-01   +9.846708362300099e-01   +3.617217137902364e-01   +5.426827428406803e-01   +9.339855489166945e-01   +6.722202976730386e-01; +9.326363516746726e-01   +1.854867937114035e-01   +6.922532936118488e-01   +3.486901700057077e-01   +3.638150158397069e-02   +7.154067797803441e-01   +9.157663984095468e-01   +7.683852497973350e-01; +2.383742830990147e-01   +3.149434152432369e-01   -4.616014238802117e-03   +4.017306013933222e-01   +4.874149760119959e-01   +7.102434127999018e-01   +7.269659555861895e-01   +9.260030016150608e-01; +1.043879662926924e-01   +2.464807463424074e-01   +4.676693902940977e-02   +7.519134303702874e-01   +7.250571959173839e-01   +1.686337066368954e-01   +4.444913851185739e-01   +6.588596039146088e-01; +7.147080117481045e-01   +3.241450664629710e-01   +3.064877580147209e-01   +1.013293788546644e-01   +1.410925369564544e-02   +3.527730017634724e-01   +1.544083718046282e-01   +4.997929227398694e-01; +6.021933902625537e-03   +8.789867253636634e-01   +8.685779785853756e-01   +5.914078190643298e-01   +5.152180966813681e-01   +3.814315523892783e-01   +8.339712663731861e-01   +3.446656255794590e-01; +1.837349022866004e-01   +2.988487152094463e-01   +6.273523667080499e-01   +1.241260816938953e-01   +2.406650721265579e-01   +7.573471885051668e-01   +2.561253653228670e-01   +9.475435071095382e-01];
L3E_L2E_iAMPA_netcon = [+8.107692713272259e-02   +1.520268350724980e-02   +3.691655755469809e-01   +4.948455726686203e-01   +1.763754016614153e-02   +9.558099987455948e-01   +3.603322182700653e-01   +1.479174230135366e-02   +2.036579587529382e-01   +6.142563734517798e-02   +2.422670466290454e-01   +1.000000000000000e+00; +9.550138901938199e-01   +9.781422679031259e-01   +1.146245461223978e-01   +6.648746342450539e-02   +8.080575940497031e-01   +3.871563535895967e-01   +2.252933976705696e-01   +1.208778116087804e-01   +3.565891277349430e-01   +7.401406479635806e-01   +5.344976927547430e-01   +3.461062359189701e-01; +6.639334081760706e-01   +7.257524018427092e-01   +5.138746155956776e-01   +8.632359083168913e-01   +7.967608760613438e-01   +6.660831183522330e-01   +7.242060601265468e-01   +6.698869108043263e-01   +8.895776481862424e-01   +9.906148435970084e-01   +3.349813145020818e-01   +8.255549044377375e-01; +1.699097679441300e-01   +8.732327448337962e-01   +5.613334582737029e-03   +9.971236692537453e-01   +4.226970707795440e-01   +5.834946067170224e-01   +7.749879107940011e-01   +5.093715918984894e-01   +8.134609555450396e-01   +7.701197139588352e-01   +6.750883772382049e-01   +1.120264882604772e-01; +1.968683006683863e-01   +8.168211451867357e-01   +8.724867345067765e-01   +1.239806820742342e-01   +6.317765646562492e-01   +5.838915489607772e-02   +3.430905371322322e-01   +7.327989863200732e-02   +3.187203080762678e-01   +8.835209404622342e-01   +8.745468419503599e-01   +7.768722042524813e-01; +9.974257166503170e-01   +3.186404721339292e-02   +9.053903027621052e-01   +1.001174433071341e-01   +5.706065659005038e-01   +7.435089230234948e-02   +5.778099449901211e-01   +5.386904715324824e-01   +5.988076022597683e-01   +3.558576850810723e-02   +9.866290685824989e-01   +1.503547373555139e-01; +9.279781139982937e-01   +9.557609216207053e-02   +1.129852045280863e-01   +1.477573829190052e-01   +8.992919904517346e-01   +2.277559045336565e-01   +6.442381439675836e-01   +6.784421260365093e-01   +6.980965337841711e-01   +7.939279978788092e-01   +1.421395968405291e-01   +7.315547379900449e-01; +9.821041765430245e-01   +8.848204455211432e-02   +4.595479486242404e-02   +1.261879571176193e-01   +7.480179499954019e-01   +4.203654384322364e-01   +3.678876072310284e-01   +5.886832393755119e-01   +1.778638973255919e-01   +7.062395984272886e-01   +8.787595869668602e-01   +1.102392469727828e-01];
L3I_L2I_iGABA_netcon = [+7.672389844707078e-01   +5.372547016360505e-01   +5.989882912818048e-01   +3.064420611390833e-01   +9.658270759394958e-01   +1.158337975001857e-01   +2.983117782609129e-01   +7.943920882343565e-01   +9.154712548731476e-01   +9.942691276128535e-01   +3.100788967314063e-01   +9.964379295200887e-01; +6.392813861885392e-01   +4.514203428447435e-01   +5.632273364471326e-01   +7.617232614999221e-01   +5.441528605449967e-01   +6.841731555463632e-02   +1.686547894226737e-01   +5.303114850322629e-02   +3.885885865455722e-01   +2.878006631094702e-01   +4.441626800141820e-01   +9.136141141917317e-01; +7.967768839006090e-01   +1.135889259062443e-01   +6.959547741795916e-02   +6.484824450123301e-01   +9.793959720844714e-01   +5.106313290477234e-02   +7.242188800469084e-01   +1.800631562412078e-01   +7.502750782928188e-01   +5.180263291273625e-01   +2.105199893180961e-01   +6.901311783898830e-01; +9.632793106012805e-01   +7.211372975092548e-01   +7.685121309191258e-01   +3.338353733664403e-01   +1.242473237989791e-01   +1.290209018318921e-01   +3.009786348474338e-01   +2.447418184300315e-01   +8.819140424049410e-01   +3.585159037234815e-01   +9.407322406792674e-01   +2.204217359707822e-01; +7.168394858212390e-01   +1.864452045182861e-01   +8.652398542665907e-01   +9.730719632507771e-01   +1.654921383573397e-01   +4.903878557597802e-01   +6.758393434352238e-01   +2.599834285299921e-01   +3.933048049732281e-01   +5.190018561249371e-01   +2.897010206701996e-01   +3.134724432891263e-01; +6.413664889522078e-01   +3.234596524257144e-01   +7.089684471739287e-01   +5.340565912973236e-01   +3.348405402946258e-01   +4.670089368478108e-01   +7.453277493847130e-01   +6.496309856560475e-01   +1.672655867137010e-01   +5.017869234995977e-01   +1.235039377994920e-01   +2.357862548571092e-01; +5.115465103553853e-01   +9.665840275772273e-01   +1.067456897450990e-01   +7.525835306048511e-01   +5.318717830849566e-01   +1.586169631871502e-01   +7.456529799297393e-01   +9.577089078258988e-02   +4.380359563574445e-01   +1.869084972135684e-01   +6.969197719688887e-02   +7.071727774720614e-01; +9.505400252569306e-01   +6.992732188736411e-01   +6.656042997053900e-01   +2.678093984484657e-01   +6.924465435087914e-01   +1.361526982764215e-01   +7.816887182167928e-01   +4.680957614175369e-01   +8.578227589065833e-01   +4.808696291647358e-01   +7.300837658545057e-01   +3.750236918725541e-01];
L2E_L3E_iAMPA_netcon = [+6.574236809514112e-01   +3.879717353327476e-01   +2.358573435155345e-01   +4.661115633520763e-01   +9.019253007143065e-01   +9.516301569431636e-01   +7.637667537079337e-01   +3.533101383377590e-01; +3.824041885675366e-01   +2.164438506961570e-02   +9.038241950420342e-01   +2.868854675762549e-01   +6.808100760534131e-01   +2.470208311149175e-02   +9.023426708496632e-01   +6.626363652332421e-01; +3.070258584835174e-01   +3.288292269720219e-01   +4.858735819107399e-01   +2.773717332500460e-01   +8.424598125574888e-01   +4.999955126456805e-01   +7.934540347653691e-01   +5.932773525155877e-01; +1.570731832439612e-01   +4.874740178178547e-01   +5.957469795324158e-01   +1.424535013488179e-01   +9.745133386414066e-02   +3.399401973219740e-01   +9.542747124850700e-01   +5.622148914908853e-02; +7.776344212422397e-01   +2.633614749343730e-01   +9.557406160419999e-01   +1.417677032327764e-01   +7.354118838527032e-01   +6.730093353542663e-01   +5.331084587045902e-01   +2.160861372719431e-01; +7.103618179195600e-01   +5.263482233342228e-01   +8.443384188785735e-02   +2.632012937934807e-01   +5.423809954206543e-01   +1.680678382542813e-01   +1.621311286838703e-01   +6.016935722287671e-01; +1.736666484206449e-01   +4.134410024432717e-01   +2.221708773687129e-01   +6.090036218041829e-01   +2.552280798758423e-01   +2.271155050771581e-01   +1.338088822362673e-01   +2.691385309288197e-01; +4.487099551885774e-01   -2.060096517970685e-03   +1.546560014794864e-01   +1.049669896598626e-01   +7.130562034974472e-01   +1.169750551217641e-01   +3.189413940779606e-02   +1.105934966210879e-01; +8.392427085553890e-01   +8.932482670216410e-01   +3.914250011159820e-01   +4.832556306392745e-01   +3.590917085868190e-01   +9.925296007994636e-01   +6.838601981176559e-01   +2.123606030112644e-01; +7.009005477681608e-01   +2.378694166490790e-01   +1.861924169336558e-01   +8.939485188187068e-01   +8.525673407485034e-01   +1.382161108879989e-01   +5.886354755781097e-01   +8.752007621528344e-01; +7.632586974202605e-01   +7.943874176929110e-01   +7.651086195686400e-01   +1.887584509811495e-01   +8.197297473180544e-01   +7.692584999558808e-01   +2.964988121518704e-01   +4.607874505061471e-01; +9.812004573702908e-01   +5.765592635552365e-01   +2.294330764828352e-01   +5.193222233308362e-02   +6.125111390284251e-01   +6.315317528601190e-01   +7.552114761069735e-02   +7.291359634093542e-01];
L2I_L3I_iGABA_netcon = [+5.897760376120061e-01   +1.461791061647187e-01   +3.466460488946599e-01   +3.712977981189654e-01   +5.975724612501921e-01   +5.058993807859566e-01   +7.730483582260701e-01   +2.642407170728047e-01; +8.449219295385136e-01   +9.880039409606391e-01   +4.502589603573085e-02   +5.349479354307303e-01   +4.767275579645074e-01   +2.375258413972879e-01   +1.784902151739251e-01   +5.861073158862974e-01; +6.038086263061014e-01   +4.794530281729824e-01   +9.430725874092047e-01   +9.724705527405947e-01   +3.779728477304217e-01   +2.728947459192381e-01   +4.549070530631227e-01   +6.802130195911101e-01; +7.452178081658620e-01   +3.500257360822020e-02   +8.661163352784352e-01   +9.985784970123659e-01   +9.802824229527406e-01   +4.072281248661312e-01   +3.037406926470828e-01   +4.168811787548147e-01; +8.490399607631159e-01   +2.699667767020867e-01   +1.355396229288268e-01   +4.146355505810508e-01   +1.379783411101362e-01   +2.598607754124164e-01   +3.870158063645124e-01   +5.104867146142705e-01; +1.443120667268422e-01   +6.750792263251367e-01   +5.918943945046673e-01   +4.479124935378659e-01   +2.714999374797006e-01   +8.553577374232197e-01   +8.015783097581255e-01   +8.136394016823498e-01; +7.437153665098911e-01   +1.462471182404387e-01   +6.335180412252311e-02   +2.520769300154724e-01   +2.261518640070974e-01   +4.787592528698759e-01   +7.775013035694465e-01   +5.432406070930496e-01; +1.528845578284607e-02   +7.722397568577771e-01   +9.486177660498131e-01   +5.980095733868253e-01   +7.948435678603447e-01   +3.425725045411948e-01   +6.479623057509490e-01   +5.906841544995639e-01; +2.275978776069649e-01   +2.685427423892147e-01   +4.986529546010992e-01   +7.597070481377384e-02   +8.180660778042104e-01   +6.384669174575390e-01   +2.416482243656871e-01   +5.361883091901497e-01; +5.366908607791518e-01   +8.804488300383146e-01   +2.837814276054037e-02   +9.113113744154868e-01   +7.945531867852496e-01   +4.160043526815681e-01   +6.069156602958266e-01   +5.393056497252589e-01; +7.209738489696237e-01   +3.699642816919124e-01   +5.885072300427972e-02   +4.748202651448999e-01   +1.117488783224568e-01   +5.466039170181575e-01   +4.193960356740109e-01   +1.503983409861626e-01; +4.335122019539195e-01   +1.121364502736687e-02   +2.998102131119614e-01   +5.081468160878481e-01   +6.318918099250710e-01   +3.396074613814066e-01   +2.966658733492930e-01   +7.040668471751077e-01];
L3I_L3E_iAMPA_netcon = [+6.461536977912051e-02   +7.732348908497059e-01   +5.512121586803709e-01   +5.719434206235875e-01   +9.196923279901028e-01   +8.353378757538196e-01   +8.494512665533742e-01   +8.615786548955607e-01   +5.331525777991560e-01   +9.874855256486127e-01   +4.824151553461973e-01   +3.504765652560783e-01; +9.227834260129373e-01   +8.390902065344158e-01   +8.434868368125550e-01   +9.368171013296290e-01   +5.926539028022617e-01   +3.941952270449588e-01   +6.282382091078198e-01   +8.575513307499175e-01   +5.666841716736116e-01   +6.997166580972178e-01   +7.389770147885345e-01   +4.001051408543543e-01; +1.815188908117280e-01   +5.927318759025517e-01   +9.700904816587350e-01   +7.806524979634833e-01   +5.745015170401195e-01   +6.960527033778982e-02   +4.445001810653855e-01   +9.488827601018831e-01   +9.808732559302065e-01   +8.423849199826361e-01   +5.945298339390961e-01   +9.893363375166759e-01; +5.423363278327272e-01   +7.649024657668159e-01   +4.655528338151164e-01   +5.961575653840618e-01   +6.566353990481955e-01   +3.735106084724600e-01   +2.367713088126569e-01   +6.944698729642974e-01   +9.672327290740428e-01   +7.402610478026252e-01   +2.621827434642578e-01   +2.975434083697734e-01; +3.986379665901067e-01   +6.578762471612762e-01   +7.757182082303035e-01   +5.794707155733683e-02   +4.350492743697437e-01   +8.487147101688051e-01   +5.171587366403220e-02   +3.647648426847407e-01   +5.593875562121792e-01   +9.958220154361048e-01   +6.071240220892964e-01   +2.267048933096183e-01; +9.900386801536709e-03   +5.870001460241624e-01   +2.339285136269022e-02   +5.442724903080162e-01   +9.348211111042347e-01   +2.681437912294189e-02   +7.106408612332091e-01   +3.735573903071918e-01   +5.298496870174260e-01   +5.048582638007770e-01   +2.315044732560609e-01   +3.295042913672869e-01; +1.038812475883113e-01   +2.421167987599048e-02   +6.761142798732616e-01   +8.641940527897738e-01   +1.040062688705736e-01   +4.235652087754085e-01   +8.469297756851105e-01   +8.402220508087960e-01   +4.807505913151600e-01   +1.901487547164098e-01   +1.941489566437151e-01   +1.629857704192266e-01; +8.562579065198661e-01   +6.917250997176223e-01   +8.349352144320203e-01   +3.378648219291936e-01   +4.078534680380945e-01   +2.546284672597338e-01   +4.038150878976519e-01   +3.863083150480396e-01   +9.019699740274044e-01   +9.594292703023342e-01   +3.851831419733175e-03   +3.833190803140705e-01; +3.377133956495593e-01   +3.264199324103425e-01   +6.845046302915641e-01   +1.801863305972289e-01   +8.941162404225763e-01   +7.403357680058147e-02   +2.869858767291250e-01   +7.706651628049830e-01   +4.824969687036358e-01   +4.512779967682076e-01   +6.475883166865590e-01   +5.247840937454791e-01; +1.509721178058513e-01   +7.690743474403361e-02   +8.973533974499445e-01   +8.804444722586054e-01   +7.380843042902209e-01   +9.192693606033900e-01   +2.614823999588197e-01   +7.750776297844097e-01   +4.857135642357651e-01   +6.057591552024423e-01   +3.981866704794571e-01   +5.939524154060724e-01; +8.069036012527372e-01   +7.439674659686225e-01   +9.408218836567932e-02   +8.423404343275519e-01   +9.607165116113180e-01   +2.678378953688725e-01   +5.073417431446973e-01   +4.327544416219494e-01   +3.139582756248572e-01   +6.462259129670512e-01   +2.718536723989486e-01   +1.698098041762741e-01; +6.536888484480409e-01   +9.660355682560009e-01   +7.223909565415350e-02   +8.334810634871074e-01   +9.720434165049675e-01   +1.021199066975796e-01   +1.168040243819743e-01   +4.883827444802326e-01   +8.579455561884790e-01   +7.636921813598057e-01   +3.559363801402694e-03   +7.251652701104401e-02];
L3E_L3I_iGABA_netcon = [+4.398390034890620e-01   +6.987435827779835e-02   +5.424495406351509e-03   +4.936704811147126e-01   +5.442482308655858e-01   +2.533256118904202e-01   +7.174776657945895e-01   +7.631369710959994e-01   +3.776798711494788e-01   +4.470224206396005e-01   +2.024428133803161e-01   +6.495808209473396e-01; +5.888442086914917e-02   +8.084761171484310e-01   +1.305992888428843e-01   +1.943550056726982e-01   +2.120585221457079e-01   +3.343045348767447e-01   +2.217125191065243e-01   +8.876643029988868e-01   +6.094371636234440e-01   +3.947858438472844e-01   +8.283996006360492e-01   +8.973357483683578e-01; +6.252893031208927e-01   +9.091416267638874e-01   +3.104253426723425e-01   +6.423059773051503e-01   +2.721801939107460e-01   +5.925838768073353e-01   +4.984453548384383e-01   +7.310550328043626e-01   +1.691899883769030e-01   +6.704605403940096e-01   +4.459930261432932e-01   +8.364112378667725e-01; +7.982951060284759e-01   +4.266467702863279e-01   +2.380739497697042e-01   +2.545106662574284e-01   +1.332840049984685e-01   +4.835786840254339e-01   +4.731866343759205e-01   +6.954432617327769e-01   +1.046164376499679e-01   +3.242023732053744e-02   +4.281100310436533e-02   +1.691663667899307e-01; +4.010155802698543e-01   +1.863798416499875e-01   +6.495130832264796e-01   +9.491820908850518e-01   +1.688668353670044e-02   +8.980061411582252e-01   +4.312175201483444e-01   +6.454727412667211e-01   +6.241322763564736e-01   +7.875391501089395e-01   +7.669844826487631e-01   +1.613487108591831e-01; +8.822077710020915e-01   +1.817496120661180e-01   +8.052029866387201e-01   +2.896064786935486e-01   +1.466277620762773e-02   +2.945220461435551e-01   +5.552439888884723e-01   +6.177090356496492e-01   +9.533052127899525e-01   +3.768970745626365e-01   +9.913894860363213e-02   +1.349589510559051e-01; +7.231641973338072e-01   +6.705724769118031e-01   +7.394286625380168e-01   +1.479103050620889e-01   +9.803997988457968e-01   +7.850970962484281e-02   +2.064297960469852e-01   +7.937840942076982e-02   +6.657931707609498e-01   +6.485634096283733e-01   +6.511360361957313e-01   +1.577874872864709e-01; +1.979057192251188e-01   +5.250472855718462e-01   +1.226042932719448e-01   +8.692717783038240e-01   +6.450075082134387e-01   +3.914520019980861e-01   +2.753610362216263e-01   +5.467986478122689e-01   +4.730834082438208e-01   +4.953418134086792e-01   +2.720991496628976e-01   +3.956221438565801e-01; +3.737481941366844e-01   +7.761434603988706e-01   +1.711733888405862e-01   +8.856906237027848e-01   +8.149410696960484e-01   +1.971845649394013e-01   +8.130337615842536e-01   +8.831164082653422e-01   +3.415216872637932e-01   +2.155449326721308e-01   +4.385505550913174e-01   +6.656189506709215e-01; +2.116296827181466e-01   +3.005429285891819e-01   +2.717288692490692e-01   +6.669742488057181e-01   +2.764531842351203e-01   +7.230180689681340e-01   +9.565550792328974e-02   +9.849980057101743e-01   +5.924182206796426e-01   +2.149571344833994e-01   +8.466467230325037e-01   +2.229417481987062e-01; +2.609639966057876e-01   +4.746542553609315e-01   +8.132298332968889e-01   +1.000000000000000e+00   +1.158740235658629e-02   +4.201099022652299e-01   +3.093262126639293e-02   +7.249755685012740e-02   +5.451802027293714e-01   +4.506157913052558e-01   +9.017160513329820e-01   +6.429552841683913e-01; +9.911039792742615e-01   +7.087057368147178e-01   +5.895370730597250e-01   +2.668672274953958e-01   +1.014566987780880e-01   +2.660214879788097e-01   +6.547645287143057e-02   +3.239067246958644e-02   +4.134522356847315e-02   +6.301681059989898e-01   +2.829831949839617e-01   +6.111905401487920e-01];
L2E_Input1_iAMPA_netcon = [+9.955544789708654e-01   +9.908172932743898e-01   +9.968808473520636e-01   +9.859450885760235e-01   +9.883698327343355e-01   +9.969106760220873e-01   +9.828469148726744e-01   +9.967431705256193e-01];
L2I_Input2_iAMPA_netcon = [+9.926229916100133e-01   +9.977156316795310e-01   +9.864600962364056e-01   +9.921316365752791e-01   +9.901902295690149e-01   +9.890685435191507e-01   +9.982954486125477e-01   +9.953616649163364e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
