function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.402262771276648e-01   +7.792872397961139e-01   +9.579048483778954e-01   +1.947508845343449e-01   +2.380773191015692e-01   +7.592572454989979e-01   -1.729685958120002e-02   +4.659992429778639e-01   +3.620579745458707e-01   +2.241042203440881e-01   +3.721372393115134e-01   +1.601061069561495e-01   +5.191823711837601e-01   +2.745294564753545e-01   +2.787229274652263e-01   +5.313612514676945e-02; +1.029330338779513e-01   +9.835337336048471e-01   +8.689853979220109e-01   +7.525071206388272e-01   +3.399264219247413e-01   +7.491804899586251e-01   +7.227831777887487e-01   +1.424977028354495e-01   +7.899758098943482e-02   +7.468004535052022e-01   +5.934361298283772e-01   +6.870096317383316e-01   +5.422364104769831e-01   +2.840011036674047e-01   +7.161816178403990e-01   +2.910640158355584e-01; +2.981144464661815e-01   +3.661379937253994e-01   +3.683026198487382e-01   +5.965575535505445e-01   +5.197967246523600e-01   +4.411422848264283e-01   +3.436687090728338e-02   +7.243325982649493e-01   +3.451217694233267e-01   +5.136499804495045e-01   +9.071903443887989e-01   +2.471164937724076e-01   +5.084492745738892e-01   -1.921317804664290e-02   +3.961328017213268e-01   +9.418320659519609e-01; +2.521477872886981e-01   +6.174798403620930e-01   +9.794524311440952e-02   +2.328403120574976e-01   +9.427896447045406e-01   +8.400499269303889e-01   +2.492939555402927e-01   +6.160373727887033e-01   +7.537384063228694e-01   +4.837054500679202e-03   +2.300514441759791e-01   +8.826756512944267e-01   +5.946210252098189e-01   +1.650802322599154e-01   +6.786594203420550e-01   +4.553680947999185e-01; +7.998516731625790e-02   +7.456078862869383e-01   +8.861690208836031e-01   +8.308089108061919e-01   +5.247023922283576e-01   +3.398709920305380e-01   +4.876965007599060e-01   +2.243311007142167e-01   +2.902198547967220e-01   +5.537865798910795e-01   +2.528078587385438e-01   +6.311762248160188e-01   +4.025401458910358e-01   +8.634765879552285e-01   +2.079616696195922e-01   +9.053099927734478e-01; +1.289701461420646e-01   +2.118081574553090e-01   +7.932438275602830e-01   +8.045756523241331e-01   +6.655663589262290e-01   +9.196332129385305e-01   +3.605471964942443e-01   +4.202608579537526e-01   +8.585183586089368e-01   +9.134401802760662e-01   +8.691774913773378e-01   +2.268224912575475e-01   +4.036343518638013e-01   +1.261850723529679e-01   +9.193151718040623e-01   +3.641713472116677e-01; +2.925778809645649e-01   +8.170188893911350e-01   +4.276023877661116e-02   +3.945185794858514e-01   +8.960823916615961e-01   +5.517774183003354e-01   +4.626963270977270e-01   +6.195016731684889e-01   +8.899451505703703e-01   +9.633900526330152e-01   +7.139678373758088e-01   +3.347282996747532e-02   +3.957361403123082e-01   +3.875671257622006e-01   +7.008455447399126e-01   +9.132357961338513e-01; +6.814081184497487e-01   +7.526023487728697e-01   +8.026802225958508e-01   +3.700205244389420e-01   +6.308765550953804e-01   +4.507191113202113e-01   +6.585371854221497e-02   +3.873802820241875e-01   +9.964600382370524e-01   +9.037989755622466e-01   +5.822872004161659e-02   +7.690778088906028e-01   +8.851884953264891e-01   +6.199816322545233e-01   +3.001758001340590e-01   +8.886569933275629e-01; +5.525801697076751e-01   +5.613160590517328e-02   +3.163986231500855e-01   +6.040757711867363e-02   +5.133759305611686e-01   +9.808278132398612e-02   +2.179540781403488e-02   +6.148708155946927e-01   +5.259743896601575e-01   +8.485315071728921e-01   +7.566274843315250e-01   +5.782512713089364e-01   +3.860496502481755e-01   +2.253054127255124e-01   +9.705975555859681e-01   +7.664490125370788e-01; +7.536448687325599e-01   +4.828091761740692e-01   +5.670315589375126e-01   +2.713551521730490e-01   +4.298901793785729e-01   +3.596872592233650e-01   +1.255837503093422e-01   +2.757731656692116e-01   +7.191637106347827e-02   +8.822765633602325e-01   +7.017826803535621e-02   +9.955106517963785e-02   +2.841403548181096e-01   +7.575432887548512e-01   +2.856852937496079e-01   +8.721297493168754e-01; +4.572534844492771e-01   -1.074519889644890e-04   +3.248305000086998e-02   +1.226471803727167e-01   +9.595559832797783e-01   +5.529771811652276e-01   +2.437687743149546e-01   +2.297684173754870e-01   +2.411278721570865e-01   +8.993372777684697e-01   +9.363226927980108e-02   +8.184132820618869e-01   +5.873126216084483e-01   +8.917788454925071e-01   +3.017759891665188e-02   +1.350110007155421e-01; +1.271869700571845e-01   +3.312924114610304e-02   +9.581302989103608e-01   +4.847948962444169e-01   +6.315492981660400e-01   +5.821579050277813e-01   +7.366836064184049e-01   +4.068735119638218e-01   +5.972707328135197e-01   +1.458327196480122e-01   +3.687433540696685e-01   +8.685950680581169e-01   +1.026721762494972e-01   +4.793106847159833e-01   +3.970005559354286e-01   +9.410273109288841e-02; +4.894526007532912e-01   +3.181573522588825e-01   +6.782974876067801e-01   +3.156517740545621e-01   +3.361420185632878e-03   +5.221965848742574e-01   +4.701263702818996e-01   +7.722283371165830e-01   +2.293659028493321e-01   +9.380143420688432e-01   +1.264722074541407e-01   +4.568102714992437e-01   +2.313002723455219e-01   +1.980254982412825e-01   +3.402617953821569e-01   +1.873489438022381e-01; +8.978083945070825e-02   +9.047144230315084e-01   +8.085088832364383e-01   +7.795761817088630e-01   +7.933749405161280e-01   +5.518161501020610e-01   +3.545130711589787e-01   +8.376879852286658e-01   +3.734011999433560e-01   +3.812813399325963e-01   +9.136658591659331e-01   +6.364034839846769e-01   +6.271216305885059e-01   +5.260663229845707e-01   +1.190789418772010e-01   +3.507080930118956e-01; +1.646453944441185e-01   +2.776807965228156e-01   +8.870000640153482e-02   +3.986905865392142e-01   +4.264689734787058e-01   +1.051814982304876e-01   +6.691157246434503e-01   +2.613003867047459e-01   +8.747581889298336e-01   +5.534037323592271e-01   +9.817367248670474e-02   +8.903053260784035e-01   +6.523926565041410e-01   +2.253245747859610e-01   +7.010933079226599e-01   +1.283536113356736e-01; +5.976569713546802e-01   +2.994156735606163e-01   +3.025646578511332e-01   +6.644679645902755e-01   +5.697923447054858e-01   +6.642704488746600e-01   +2.257454295973902e-01   +8.630423687347472e-02   +5.775809827504514e-01   +4.529919361444303e-01   +1.385332984228678e-02   +4.424574200942664e-01   +2.043029295393319e-01   +9.433771172385962e-01   +9.076043509264814e-01   +1.656761305134908e-02];
L1E_L1I_iGABA_netcon = [-1.291017995613691e-02   +2.585156530346436e-01   +9.209843318315600e-01   +2.921532628487219e-01   +4.323841035235823e-01   +1.134945035035646e-01   +2.822532633455915e-01   +4.443596137875881e-02   +2.196113058948833e-01   +4.732754272222121e-02   +4.486667412176802e-01   +9.612945577701147e-01   +1.622330216361978e-01   +8.690226376997741e-01   +1.092829848175373e-01   +4.679433958353249e-01; +7.476045551721009e-01   +8.123142219062721e-01   +5.025974772620535e-01   +8.519960594586745e-01   +7.672412184127723e-01   +8.857564649233173e-01   +6.156443064760505e-01   +8.821721007040643e-01   +9.779585134056537e-01   +9.465334258719411e-01   +1.291097710169222e-01   +1.356102329363311e-01   +5.950790445862857e-01   +9.475449276827455e-01   +9.891626795042164e-01   +2.828184142616590e-01; +3.224156335211279e-01   +8.381200612506106e-01   +1.047236181606880e-01   +8.047128715863291e-02   +1.168323356154142e-01   +2.248343117760491e-01   +5.949078051236708e-01   -2.133094298557644e-02   +9.576162662760773e-02   +1.021254854567929e-01   +5.326958249199797e-01   +4.467193082649304e-01   +8.331043522298930e-01   +8.276839681183936e-01   +7.936679201677391e-01   +7.725334044518259e-01; +3.609731827154845e-01   +5.453868321438688e-01   +6.412434565663282e-01   +7.779035904081252e-01   +6.564409539767330e-01   +6.718269687524326e-01   +5.853400940867548e-01   +9.145747231435402e-01   +5.522168139053652e-02   +3.506066798756441e-01   +5.394594912256945e-01   +2.262858911069751e-01   +7.917161733580120e-01   +4.247247915417795e-01   +9.375001034286223e-01   +5.629735743967991e-01; +7.474099279006383e-01   +6.242507010444399e-01   +8.309177929412951e-01   +3.513609144160671e-01   +9.806390423367169e-01   +5.134547227903178e-01   +3.636937548159754e-01   +4.711608738699536e-01   +3.013158059410808e-01   +1.208342460583562e-01   +5.341370837120273e-02   +5.468051523912676e-01   +9.257304590306445e-01   +7.909419146680700e-01   +1.474565733856930e-02   +1.755524321008815e-01; +2.877508269573463e-01   -6.216252578824831e-03   +2.647610158206659e-01   +1.558785796270180e-01   -1.740907588410573e-02   +4.106118981206329e-01   +9.044965816145738e-01   +3.241537629327872e-01   +5.639580110296292e-01   +3.977865744962846e-01   +9.448121525444407e-01   +2.147179294329422e-01   +2.984127582895066e-01   +2.164670278678361e-01   +7.284686278049946e-01   +4.425997778141293e-01; +6.756682746470155e-01   +5.617750514101887e-01   +3.720147042567733e-01   +7.808159832174915e-01   +2.906882560706946e-01   +8.726784415361476e-01   +6.667732222050435e-01   +5.149788630567605e-01   +8.687609530624578e-01   +6.379366800418963e-01   +9.418015422198118e-01   +2.950998497070674e-01   +8.133121007351850e-01   +6.467446489433581e-01   +9.422723000509037e-01   +8.285401545195595e-01; +9.869898434187701e-01   +1.566945366564703e-01   +5.770346744252889e-01   +5.257550036950354e-01   +6.635045359987548e-01   +2.153176050898680e-01   +3.184275234457440e-01   +6.155648741908942e-01   +2.126070725159716e-01   +7.980525200680092e-01   +7.924951657947327e-01   +9.627516677169993e-01   +2.900177495016624e-01   +7.880553498347530e-01   +4.880731910228442e-01   +6.173405712730256e-01; +5.650317192679675e-01   +1.000000000000000e+00   +3.844845285033556e-01   +9.545612175332625e-01   +2.200777096398360e-01   +7.054327709189149e-01   +6.169739873684417e-01   +9.901623467755566e-01   +8.529351865930177e-01   +1.302410327706724e-01   +2.147641560232489e-01   +1.921172556760072e-01   +8.740157413088145e-01   +1.557822344152505e-02   +5.493853047970886e-02   +4.530100134801381e-01; +2.759752396605056e-01   +3.743261234302988e-01   +5.662928944212609e-01   +3.039336389640981e-01   +7.832516262474848e-01   +4.225662579973203e-01   +3.386211116697203e-01   +8.920400002481487e-01   +9.126512977878127e-01   +9.398371349283079e-01   +8.065095517553398e-01   +9.451941402270998e-01   +4.931405541028702e-01   +4.026036594832428e-01   +3.528427859318791e-01   +8.676508904843816e-01; +1.170442210012474e-01   +2.384520964346556e-01   +7.970946487341948e-01   +9.061671823847188e-01   +1.329402351078786e-01   +6.123309627994046e-01   +9.804918090419015e-02   +4.687939671323117e-01   +3.809786419760278e-01   +7.165905291880635e-01   +3.004906252963888e-01   +9.000839115166953e-01   +6.510983203258350e-02   +5.087618400421647e-01   +4.682340412641002e-01   +5.097412961200857e-01; +1.547727768109128e-01   +9.286673124887305e-01   +7.504688538302319e-01   +5.102297583530596e-01   +5.017576862009205e-01   +7.017489736383808e-02   +1.636230735242531e-01   +3.525139991914384e-01   +1.292125908873692e-01   +5.485745437760886e-01   +3.079429951077113e-01   +4.471981271037121e-01   +4.040131208137591e-01   +8.783345492241587e-01   +6.760086928447055e-02   +4.631836623743363e-01; +9.137162934374010e-01   +1.211505493555904e-01   +4.847126376064371e-01   +5.652822331757843e-01   +6.647529686246150e-01   +5.893500502170717e-01   +1.695937901787905e-01   +5.557025987337815e-01   +5.308369622757524e-01   +3.348765376579657e-01   +9.645112204977140e-01   +9.625475070542859e-01   +8.668650037236491e-01   +5.697117019714178e-01   +3.169321151098435e-01   +7.623183251522320e-01; +4.603594456477453e-01   +8.626392968089414e-01   +3.104744459017427e-01   +4.124195826088218e-01   +7.683572968962934e-01   +1.648025707854595e-01   +3.693886200062446e-01   +6.208961971687067e-01   +3.331119461594556e-01   +4.545921780826432e-01   +1.735790666595999e-01   +1.299624364877513e-01   +3.093068254789532e-01   +2.747692049345493e-01   +6.201771181590270e-01   +9.076807517072035e-01; +6.240885105862074e-01   +6.190218013861947e-01   +6.656424484266308e-01   +6.985571827698799e-01   +8.317370413355798e-01   +1.274076370850833e-02   +8.510067526054083e-01   +3.287256313060707e-01   +8.176482286897889e-01   +4.702678881300604e-01   +6.929763836960469e-01   +5.692553597495138e-01   +2.426570447839395e-01   +5.067445449606729e-01   +9.132762490755414e-01   +5.204821444987114e-01; +4.448411207675551e-01   +6.359050787030788e-01   +6.225406524331675e-01   +2.717026334308933e-01   +4.627946809497007e-01   +2.971483084384531e-01   +5.893017510249774e-01   +2.308260777261952e-01   +9.074748198706821e-01   +3.006387291346349e-01   +2.324321047322568e-01   +1.554507743555601e-01   +8.255095954716989e-02   +4.838549629605423e-01   +9.305913146411501e-01   +9.500538583748210e-01];
L2I_L1I_iGABA_netcon = [+7.201655980838843e-01   +5.056301461963187e-01   +7.413720806611201e-01   +5.709856735621609e-01   +9.956274323938150e-01   +7.558104248279063e-01   +9.514129144953322e-01   +1.665025318711814e-02; +5.520239528037356e-01   +1.046143823055709e-01   +2.140057583629712e-01   +9.099571201321193e-01   +1.942694981534613e-01   +4.060343945192749e-02   +9.192719264739095e-01   +7.804658306180905e-01; +9.959771408165672e-01   +5.328183651775814e-01   +7.078126879354935e-01   +6.947510890724836e-01   +8.797839897435481e-01   +7.768893315211155e-01   +2.712615798751797e-01   +1.954372906442002e-01; +4.086512896541784e-01   +1.741796554992714e-01   +9.476434453537081e-01   +4.648359191855267e-01   +8.172112833438024e-01   +4.014976486011855e-01   +9.116785816022615e-01   +2.085919910093066e-01; +7.981133194961203e-01   +5.431242897658886e-01   +6.983231922883969e-01   +2.945837295023354e-01   +9.712992382623010e-01   +4.302142191522151e-01   +6.215664983673848e-01   +2.179452892623909e-01; +5.675533063351811e-01   +6.058505685615881e-01   +7.913699875837268e-01   +2.465588455767702e-01   +1.937464613021419e-01   +8.318207434347133e-01   +9.731113415170252e-01   +6.002378066756652e-01; +9.468375102066011e-01   +4.902653413525519e-01   +2.414430649997330e-01   +2.886293066408130e-01   +8.019117937010569e-01   +1.986082013288771e-01   +6.780998305722911e-01   +3.513393303804687e-01; +9.937102272584756e-01   +3.902251351954759e-01   +7.152587932411061e-01   +9.448426389303757e-01   +1.141200938845719e-01   +4.821130027570797e-01   +4.376836482769417e-01   +2.940666831554811e-01; +8.271847067134147e-01   +1.579780672701507e-01   +4.953223997109751e-01   +6.065483503635951e-04   +8.503712590944954e-01   +3.681521885332744e-01   +8.108829845323554e-01   +7.750336961499907e-01; +4.345109524130756e-01   +9.606377250888071e-01   +7.347135499297581e-01   +8.592052505163056e-01   +4.164118126632833e-01   +8.372675705777524e-01   +9.823489978623406e-01   +3.101750085905049e-01; +5.206463091941805e-01   +6.439037678894750e-01   +5.509906569568743e-01   +4.293119573586916e-01   +2.410034598407973e-03   +9.634888983590674e-01   +7.308612097083658e-01   +4.633097605687363e-01; +2.049171553412409e-02   +4.044792867706548e-01   +3.906381733883405e-01   +4.162054462825538e-01   +3.765150062430770e-01   +6.051501982751514e-01   +2.805665323000407e-01   +5.847547342155518e-01; +4.547321972946303e-01   +1.970904377925141e-01   +7.003325634921582e-01   +7.833012080651398e-01   +2.205237870766507e-01   +6.691270154170617e-01   +3.993123264761748e-01   +8.201418542857152e-01; +4.475346023406117e-01   +4.597236700576078e-01   +7.448692545220484e-01   +4.043142749013077e-01   +9.986202473745533e-01   +4.423564833964532e-01   +3.834239625260114e-01   +3.493639966690772e-01; +6.705122939272635e-01   +1.514563208050269e-01   +3.218507895827993e-01   +2.817345317943724e-01   +6.215551362209684e-01   +6.401590683392498e-01   +3.443873737260947e-01   +7.675493675438056e-01; +8.323826767158439e-01   +4.795215972976855e-02   +7.621583856380184e-01   +3.051455277852657e-01   +4.467643076126393e-01   +6.826844335409977e-01   +1.379488387099850e-01   +3.334865707057954e-01];
L1I_L2I_iGABA_netcon = [+5.616411373437392e-01   +1.877803711874780e-01   +8.084048291177034e-01   +2.961791790380832e-01   +6.489511371688305e-01   +3.201645342892839e-01   +8.699892887664891e-01   +2.137068879966056e-01   +6.211513102832437e-01   +9.362345035605384e-01   +4.223757223694808e-01   +4.716219824886597e-01   +1.289672424084748e-03   +7.934511767454651e-01   +6.620360459751606e-01   +4.754666212050200e-01; +3.406082901365218e-02   +5.951195578166013e-02   +3.540119280642244e-01   +3.273655553178888e-01   +9.316450164509263e-01   +3.652093786797940e-01   +3.330993294871567e-01   +1.551826317682159e-01   +4.640380661271040e-01   +2.289892657099644e-01   +3.230232749088639e-01   +2.935392337233937e-01   +9.507093562575619e-01   +1.853338942453197e-01   +8.949275314409431e-01   +2.379930661676501e-01; +3.555793868181237e-01   +6.531118641713211e-01   +3.907914308824287e-01   +7.363142795832682e-01   +2.482256618243719e-01   +5.244907100960580e-01   +7.766085839247723e-01   +9.296405599330462e-02   +8.031095579997699e-01   +4.983170174992132e-01   +6.389425019219324e-01   +8.857455323280202e-01   +9.680935531788551e-01   +6.781688966823036e-01   +3.410560501192074e-01   +1.100345530400258e-01; +8.837799565174468e-01   +1.588816201220377e-01   +6.186131119406898e-01   +9.645722020471793e-01   +4.841191227326805e-01   +9.406206450248762e-01   +6.628528374704795e-01   +4.773038217746529e-02   +6.029527138950847e-02   +3.779089161382781e-01   +4.517685293157040e-01   +5.342016135014948e-01   +3.311210274421847e-01   +4.989010919115132e-01   +1.990040350288277e-01   +1.384433895017232e-01; +9.839405917210617e-01   +8.124263932793604e-01   +7.605326428914100e-01   +7.068964346257032e-01   +2.957624032304775e-01   +6.717498294186514e-01   +7.200815995113866e-01   +6.876865690951227e-01   +6.821945988896029e-02   +7.105893620293400e-01   +1.953892407100351e-01   +4.078042946719286e-01   +6.437398834428393e-02   +2.304168333628066e-01   +7.436600594532127e-01   +9.959817753963397e-01; +5.763743045159466e-01   +4.298656541666367e-01   +1.261820857300576e-01   +3.629010932056094e-01   +9.656595121661053e-01   +1.538306232469823e-01   +7.100382991277802e-01   +6.812410245598739e-01   +5.549768628606077e-01   +7.579614992002699e-01   +3.413170039339824e-01   +4.986717423119417e-01   +8.935270860907876e-01   +7.652967966139609e-02   +1.809867651325982e-01   +6.154888046764588e-02; +7.996089442170354e-01   +9.730312483950077e-02   +4.135768470386088e-01   +3.133740059737779e-01   +5.712339757223011e-01   +9.260141312150085e-01   +6.467586851489503e-02   +2.465186223595522e-01   +7.704790198113409e-01   +9.381743531738473e-01   +9.125705630231982e-01   +8.911945045036821e-01   +1.543053550551614e-01   +3.371655609511190e-01   -2.306517118043720e-02   +6.306331178802287e-01; +8.653327360234293e-01   +4.047396175326588e-01   -2.828909748031245e-02   +9.062536838784733e-01   +1.993445104264281e-01   +9.850936195936673e-01   +8.168866200906878e-01   +1.185538259528290e-02   +7.987893630560331e-01   +5.898962995969381e-02   +9.189012599166171e-01   -1.473746186730522e-02   +8.436385388009565e-01   +1.054478284732777e-01   +9.792486586186254e-01   +7.159979989590008e-01];
L2E_L1E_iAMPA_netcon = [+2.777690879304432e-01   +9.024215859178376e-01   +6.533558829424622e-01   +4.198963174075218e-02   +3.205188833167758e-01   +3.974622998972753e-01   +1.226906924001915e-01   +6.048506600247664e-01; +2.936422655876086e-01   +1.923104264047703e-01   +7.522087473246444e-01   +9.072432055239368e-01   +3.532369611176294e-01   +5.601868663509565e-01   +2.888277575699767e-01   +1.280606669049930e-01; +5.347720368599197e-01   +9.196154083433205e-01   +8.026807641593656e-01   +1.189721953225460e-02   +6.616571428646165e-01   +5.669163406290131e-03   +4.329831134751953e-01   +8.334579130377618e-01; +5.257054004945437e-01   +6.061994406831613e-01   +6.095470397087032e-02   +5.727704480944600e-01   +2.588326392834753e-01   +5.057753854357648e-01   +2.158545342433295e-01   +4.532441839881439e-01; +8.290602682165770e-01   +7.579842735969592e-01   +7.868405138279272e-01   +5.172672400203822e-01   +7.836776499531265e-01   +3.667018549276488e-01   +4.884436820425189e-01   +5.148043601670383e-01; +5.001818237900396e-01   +6.890531696263834e-01   +3.027788043427961e-02   +6.368241730073089e-01   +6.466188673703924e-01   +8.660760256332691e-01   +2.311901113276487e-01   +4.124913053629985e-02; +4.720145944128388e-01   +3.487907550560807e-01   +2.572809432841808e-01   +3.907779065114814e-01   +3.908149593173290e-01   +2.666490124295983e-01   +5.327692811219173e-01   +2.850557510699018e-01; +7.367156812277686e-01   +1.637738389570786e-01   +2.516378375087939e-02   +9.377937165498681e-01   +5.300981609933686e-01   +3.753110864391907e-01   +5.448520387941660e-01   +6.250874780877373e-01; +7.407280531661782e-01   +6.075766937196746e-01   +6.429913278427580e-01   +1.220961606772375e-01   +3.676631365063881e-01   +2.261086820773740e-01   +1.037791042110492e-01   +9.849945284658451e-01; +1.646905394843529e-03   +1.558091785215574e-01   +1.213752068110437e-01   +2.121658966459965e-01   +2.448836962214644e-01   +5.806569555872314e-01   +8.622780641560300e-01   +8.310209110801646e-01; +2.489622285334417e-02   +2.302549308953733e-01   +6.080188162599807e-01   +5.379617521158296e-01   +1.481551622792090e-01   +4.462448245737624e-01   +1.630259417213382e-01   +7.184175728884451e-01; +4.209462218558905e-01   +5.068877565596933e-01   +5.829871542662295e-01   +5.133307911100096e-01   +7.037658245500652e-01   +3.199259601853934e-01   +6.304562773296934e-01   +4.697446641658819e-01; +6.576528140614060e-01   +7.181337415820381e-01   +6.664532855970834e-01   +2.715013145130580e-01   +2.046596799339639e-01   +6.160515718028556e-02   +9.699699171445939e-02   +5.629347333786255e-01; +7.526630540703401e-01   +8.355721790854183e-01   +4.021500752321071e-02   +8.907760743790830e-01   +4.707424602769002e-01   +8.808678126920104e-01   +4.831575458836668e-02   +2.258150979583710e-01; +9.394009497159572e-01   +1.947645153679028e-01   +4.251198435293814e-01   +5.463655830629972e-01   +3.627811993624291e-01   +2.382135426536328e-01   +6.375531405693391e-01   +4.053068859479077e-01; +8.418672109007957e-01   +5.933637888232982e-01   +6.850577443632802e-01   +3.673739875649726e-01   +5.040537301593931e-01   +8.837588648506006e-01   +7.632400335637451e-01   +9.807032007041031e-02];
L1E_L2E_iAMPA_netcon = [+8.644483191013611e-01   +4.777652820532650e-01   +5.682559090467322e-01   +9.638527643375043e-02   +9.709446187848476e-01   +2.758620670398111e-01   +5.383018932376663e-01   +5.175373559513861e-01   +9.862764709387990e-01   +5.504352767127109e-01   +6.461794370292917e-01   +5.111426073354961e-01   +5.229247976554856e-01   +3.719155364389326e-01   +5.405776018127505e-01   +1.996741805901906e-01; +7.863521804109347e-01   +2.401977031021046e-01   +1.220244202736537e-01   +5.815810211566187e-01   +8.083284575325284e-01   +6.252257961003860e-01   +9.283430544428370e-01   +2.784269395490163e-01   +3.631699314469293e-01   +3.486895046706778e-01   +7.944908829836115e-01   +6.739156373697331e-01   +6.853519644589471e-01   +8.919103160834594e-01   +3.901520417214605e-01   +5.348571458593981e-01; +8.093287064388017e-01   +8.959460819122217e-02   +1.247403657744428e-01   +9.558088201830005e-01   +2.861917170257502e-01   +3.898568876041467e-01   +9.517291804423339e-01   +3.085126952476180e-01   +1.707191395304953e-01   +6.160400987006203e-01   +8.644595679626970e-01   +4.622719584954749e-01   +8.655735232595202e-01   +9.793937521583203e-01   +8.318322524687241e-01   +6.623226735776624e-01; +7.453842308226003e-01   +1.040697784540370e-01   +5.518243055651659e-01   +3.889683475785405e-01   +4.080430164546551e-01   +8.398043477248196e-01   +2.153402802248066e-01   +1.284515160687779e-01   +6.211015398846927e-01   +4.606147008067022e-01   +3.648462036632999e-01   +9.683359278676859e-01   +7.597750264843521e-01   +9.072299756515963e-02   +7.544979040269726e-01   +8.035803385285648e-01; +4.024032139948400e-02   +2.549727195266688e-01   +1.655282465248510e-01   +7.742279400288317e-01   +2.001485787307091e-01   +4.955010962022461e-01   +9.909591916486361e-01   +2.867698388106232e-01   +1.163867059743170e-01   +7.649962365978139e-01   +5.257433445147063e-02   +5.803738324228798e-01   +9.234726025520142e-02   +6.399018835795718e-01   +4.095021078622521e-01   +1.182454066207242e-01; +6.846521495853548e-01   +4.554265667028852e-01   +3.988609576319817e-01   -3.995345911508964e-02   +9.470999755561512e-01   +1.007943714586496e-01   +4.766744178139841e-01   +1.916974795051838e-01   +7.788890251195071e-01   -2.436557284885434e-02   +7.496381686090723e-01   +7.063904082619744e-02   +7.513939490051920e-01   +5.233497407960032e-01   +7.000865150851393e-01   +3.470471457364103e-01; +3.209214392477970e-01   +6.523341674013901e-01   +3.883972661482627e-01   +3.964446262788482e-01   +3.824080513917177e-01   +8.943684937840134e-01   +9.196014486031275e-01   +4.059666700154443e-01   +6.892923111628076e-01   +7.630516090388026e-01   +7.908991770589906e-02   +1.398667135536268e-01   +1.076484836497973e-01   +3.779850392461274e-01   +3.282411380307498e-01   +7.832860674037211e-01; +1.833014624324482e-01   +4.652807204884756e-01   +3.212706891488872e-01   +4.181016904036384e-01   +9.596853132306165e-01   +4.983801465358957e-01   +9.592304315430686e-01   +9.008481638576663e-01   +3.580892084958041e-01   +7.549246293810936e-02   +3.543222898095241e-01   +3.308205895216347e-01   +3.282397250982039e-01   +7.751718595283199e-01   +8.070981580188723e-02   +5.707560564971202e-01];
L2I_L2E_iAMPA_netcon = [+3.778034559304990e-01   +2.319589951607466e-01   +4.236593563405720e-01   +5.751605460813800e-01   +1.927578251354078e-01   +8.795385601228237e-01   +6.537838458855065e-01   +2.862045774323790e-01; +5.284185918307674e-01   +2.119501297562070e-01   +6.258392272189660e-01   +2.677617619199724e-01   +6.749647004754031e-01   +7.991960186186420e-01   +9.613482281352971e-02   +5.112968087104203e-01; +6.272502280890925e-01   +2.269926636394943e-02   +7.012695232979692e-01   +6.243825685165741e-01   +1.492857547371320e-01   +5.974282902195147e-01   +8.325423862523532e-01   +4.988456767694092e-02; +4.847880184583031e-01   +3.016621878431781e-01   +6.137173361444415e-02   +9.777401346961475e-01   +3.705665297947829e-01   +6.237854649913204e-01   +9.533007498789091e-01   +2.084519596402482e-01; +1.631404957310685e-01   +4.380251180704348e-01   +3.975564932037201e-01   +8.132041252602791e-01   +8.333211386306639e-01   +5.986299951025904e-01   +6.801157354561056e-01   +3.173868067010497e-01; +9.207789706360698e-01   +5.024018196757634e-01   +9.097738137139810e-01   +8.343728521955476e-01   +7.204544684919849e-01   +8.355644517346899e-01   +8.865703166640314e-01   +5.171918838434314e-01; +1.259935792530978e-01   +5.507647568800542e-01   +9.414686643318769e-01   +9.245114648194159e-01   +8.324503621106495e-02   +7.611057556780716e-01   +2.592374497087596e-01   +1.044298695151323e-01; +5.398251254115655e-01   +3.754932023457681e-01   +2.064556002625804e-01   +2.818229904960830e-01   +7.369515912156773e-01   +3.967799437774997e-01   +9.509359759148340e-01   +6.166076279112216e-01];
L2E_L2I_iGABA_netcon = [+4.891410768339209e-01   +6.495923072445364e-01   +6.533595972954735e-01   +7.021503894259626e-02   +4.931815352884840e-01   +5.178781498554705e-01   +3.062863532080533e-01   +7.676125091871362e-01; +4.698509365179612e-01   +3.794505483211618e-01   +1.437337688560433e-02   +4.924214467474579e-01   +4.890765874012930e-01   +6.177184683594397e-01   +4.618782960758495e-01   +4.857396826966215e-01; +6.253672212616446e-01   +5.097387235338688e-01   +4.124958860006989e-01   +5.689131188351318e-01   +3.301563272729763e-01   +2.595407385988544e-01   +2.055380919202629e-01   +1.000000000000000e+00; +7.546178612092542e-01   +5.533119724291233e-01   +3.999080321722782e-01   +8.818109751202254e-01   +2.227530340646542e-01   +7.002274006818932e-02   +1.544758993782570e-01   +4.416229683551337e-01; +5.036809349888089e-01   +8.061921898339066e-01   +5.415149729072251e-01   +8.195484308547225e-01   +3.994105645938479e-01   +7.564967634551736e-01   +7.100458664362931e-01   +3.089366158202724e-01; +4.108325312231494e-01   +2.670926601662656e-01   +4.724538502868982e-01   +3.598320014702424e-01   +7.978602356079053e-01   +8.500533176146390e-01   +1.120535782105434e-02   +4.552317682464417e-01; +4.045075579269843e-03   +4.846797919164463e-01   +8.703913088334332e-01   +5.607023342277921e-01   +5.117534459123338e-01   +3.911311722283067e-01   +9.522300929221983e-01   -1.856848590723878e-02; +9.409984261360800e-01   +5.366055904004978e-01   +9.279962147873834e-01   +4.874801496170127e-01   +9.248584867876137e-01   +5.599253788405540e-01   +3.688751361715684e-01   +3.635433460695269e-01];
L3E_L2E_iAMPA_netcon = [+2.378201187689558e-01   +9.601478086550779e-01   +4.548167360418844e-01   +7.651670791810188e-01   +1.593491783933277e-01   +4.347347438517394e-01   +4.345677170736794e-01   +1.034826029942748e-01   +1.276880738853666e-01   +5.493956350601806e-01   +1.359116980172889e-01   +4.621716999162971e-01; +2.598981558464895e-01   +4.925558477082406e-01   +1.830596017596028e-01   +2.477344814322228e-01   +6.327451404021855e-01   +9.280188005848160e-01   +7.536853633618673e-01   +6.375386312463880e-01   +2.773092235576263e-01   +3.794946202107380e-02   +3.555637297510915e-02   +8.919620743650267e-02; +8.002406173145898e-01   +3.683089191306396e-01   +5.632476805941030e-01   +9.751140771962091e-02   +8.963997602494073e-01   +8.580886228174888e-01   +5.148183695052432e-01   +7.192358277161600e-01   +6.670850634568742e-01   +3.724466669728063e-01   +4.219580721750677e-01   +9.215384736085490e-01; +1.845423422767115e-01   +4.368933556176993e-01   +1.977515773189307e-01   +8.042911951591315e-01   +5.361285325672333e-01   +5.917304633973789e-01   +8.733765354122106e-01   +2.836782681458674e-01   +8.274120270112617e-01   +8.155648729129763e-01   +4.854539448936091e-01   +2.386988568417221e-01; +2.082798066540403e-01   +8.272127626959236e-01   +4.170074082004823e-01   +6.403284373388601e-02   +1.957092295945715e-01   +9.731958638800589e-01   -1.615053281221428e-02   +7.020864228321039e-01   +5.678247776437518e-02   +8.192009107223754e-01   +2.939338302585749e-01   +2.355251643918234e-01; +4.128341811430171e-01   +3.514358663815282e-01   +8.662921406430538e-01   +9.787751529927229e-01   +4.076169927494439e-01   +9.893466970835749e-01   +1.111087420584658e-01   +3.993380959342313e-01   +4.822282303249506e-01   +8.024703565020075e-01   +6.625212295429675e-01   +8.712613136566538e-01; +1.477631523144921e-01   +5.112562083802565e-01   +6.055408527416183e-01   +1.135188408153234e-01   +6.555727316472014e-01   +5.088985280361710e-01   +7.946817784034365e-01   +1.468088795886568e-01   +4.734038325800409e-01   +4.025127712448925e-01   +9.808803242430277e-01   +7.770407807935360e-01; +5.995039360086386e-01   +6.578200733906990e-02   +3.941368254341996e-01   +1.873612840965771e-01   +5.119030888019609e-02   +9.145957684730336e-01   +3.958179827897886e-01   +4.649913582167711e-01   +8.871218469916380e-01   +9.759608393571580e-01   +9.424668822932165e-01   +3.396847045480978e-01];
L3I_L2I_iGABA_netcon = [+2.737890833559762e-02   +3.372554267610559e-02   +5.982112152329836e-02   +6.700768675306873e-01   +8.268847056358401e-02   +4.747205516383545e-01   +8.331733880557719e-01   +4.031571155038781e-01   +4.177540394835352e-01   +9.997945435026204e-01   +8.910926758118389e-01   +6.227276172238385e-01; +3.536320594347644e-01   +4.317057995697687e-01   +2.966964314059437e-01   +1.671719767071450e-02   +4.536014411785254e-01   +6.042424157573018e-01   +4.442811182519778e-01   +8.857885793628314e-01   +8.810314232782410e-02   +9.254658789395008e-01   +3.173256013837959e-01   +6.490387220937338e-01; +3.326753332214335e-01   +7.039744178485371e-01   +3.153831865155120e-01   +8.135784483445769e-01   +3.555874132448482e-01   +8.299609988203742e-01   +9.528298179925065e-01   +3.341882062069161e-02   +6.247460802779141e-01   +4.897607900947489e-01   +1.528935152407861e-01   +5.643302342946617e-01; +6.349410094451851e-01   +9.693149960210564e-01   +3.302285544097546e-01   +2.580395269573060e-01   +1.580137683121710e-01   +6.030232941072703e-01   +1.947990590249276e-01   +2.939051235176878e-01   +8.095989820969300e-02   +3.544489413050068e-01   +5.331137106425820e-01   +8.322499102811548e-01; +9.703664085467791e-01   +1.135747056406958e-01   +4.987215313639560e-01   +8.208384856676340e-01   +5.081104549670172e-01   +8.858118386827400e-01   +9.717500530557960e-02   +5.525685255989030e-01   +5.702774448661484e-01   +8.060297560505549e-01   +7.625342307334139e-01   +5.302218760988437e-01; +9.227807272637872e-01   +1.938431714212827e-01   +1.170893447973189e-01   +7.304793569642659e-01   +9.070592339752876e-01   +7.094111289122760e-01   +8.902046244530689e-01   +5.213732151095484e-01   +1.720261061616432e-01   +8.400157845005487e-01   +3.937272931275231e-01   +6.068491193671591e-01; +1.106260633506013e-01   +5.690174139649384e-01   +9.403983310378025e-01   +5.793048748249205e-01   +9.354576465040928e-01   +8.490368220577591e-01   +8.337181277096687e-01   +8.314493977113271e-01   +5.993926984389564e-01   +3.733181208356386e-01   +2.860042959467509e-01   +5.551836404058910e-01; +2.991918394179836e-01   +1.592926609857707e-02   +7.810436840980899e-01   +1.842055173391804e-01   +4.297801830169952e-01   +6.410527801718363e-02   -1.599447090262941e-02   +9.845112807005056e-01   +4.773637090121355e-01   +1.229593315281164e-01   +7.438468497489061e-01   +4.357248420160617e-02];
L2E_L3E_iAMPA_netcon = [+9.201969358210452e-01   +2.956975003323306e-01   +5.895680000082623e-01   +6.783565554175736e-01   +2.110831443415192e-02   +7.072872483478405e-01   +7.521617650516367e-01   +4.971091393369826e-02; +3.484645923465860e-01   +5.890295347829863e-01   +6.903328908722903e-01   +7.651422584766139e-01   +2.138858589660151e-01   +2.351778703497042e-01   +8.601397712315623e-01   +8.615159372879824e-02; +6.224296352533504e-01   +5.240961890963970e-01   +8.953609612073522e-01   +6.636388704102459e-01   +9.182279152470075e-01   +4.776272078854154e-01   +9.581186329354606e-01   +5.039081263736208e-01; +1.802303095742390e-01   +9.350649040375091e-01   +9.141231275099769e-01   +4.368330554432984e-01   +3.681045883263002e-01   +9.663275329313857e-01   +2.521516729907787e-01   +5.076235785039912e-01; +5.551923041416531e-02   +2.144403161566460e-01   +6.955485862085568e-01   +6.502246859428622e-04   +1.862515112709221e-01   +5.092823843236389e-01   +5.408734288218611e-01   +6.427933469361530e-01; +4.127515521447606e-01   +7.643602532956048e-01   +1.900751646307987e-01   +7.978421006861496e-01   +1.072152741699428e-02   +1.422777841701855e-02   +4.884356632566663e-01   +3.053927680007265e-01; +4.842062651466886e-01   +7.825182618410056e-01   +7.964430636393839e-01   +2.671970640203437e-01   +8.658088696642703e-01   +2.202711700899810e-01   +7.118948519694693e-01   +9.520484246835780e-01; +4.538642873823838e-02   +6.212516695573995e-01   +8.980289832286356e-01   +4.692236252448419e-01   +1.042789971340773e-01   +7.493308650953668e-01   +1.313797978824373e-01   +3.538503489776165e-01; +9.986191917353696e-01   +9.496332552835784e-01   +4.121828214018201e-02   +1.387622967390724e-01   +1.270782941697347e-01   +9.303181782060085e-01   +2.722543934382277e-01   +9.342386729204409e-01; +1.773566879549093e-01   +3.454634418230256e-01   +8.052302402522791e-01   +3.590808343090423e-01   +3.705018086841101e-01   +9.502768369897830e-01   +6.436032855263403e-02   +9.959132322892482e-01; +6.685632808803578e-01   +3.840790466818496e-01   +2.408423324287400e-01   +2.020526581006930e-01   +1.115905045232901e-01   +3.367526796877719e-01   +2.098043935814779e-01   +1.105173566316581e-01; +8.775344458962450e-02   +6.249476533994335e-01   +7.893248754789434e-01   +4.454716533791791e-01   +3.684708440176705e-02   +7.737061555206862e-01   +7.926018176929200e-01   +7.832977326319909e-01];
L2I_L3I_iGABA_netcon = [+3.880730025297426e-01   +6.306730425534429e-01   +2.461289096288151e-01   +6.977931460568217e-01   +5.569807438190228e-01   +4.514185913712445e-01   +4.191128504779279e-01   +4.781347845748867e-01; +3.611689587976963e-01   +1.176225163830888e-01   -1.061393137362620e-02   +8.589463765915004e-01   +7.433535216059024e-01   +6.621819230390082e-02   +9.019362355483912e-02   +6.231158731274155e-01; +3.721585607947621e-01   +6.421408218965799e-01   +3.890341342461288e-01   +9.636967636605330e-02   +8.090923468031268e-01   +6.100117253153148e-01   +1.788380737563152e-01   +8.267668647992818e-02; +6.107107021480036e-01   +8.882636287149387e-01   +6.146092360784594e-01   +5.051346567993285e-01   +5.660791591465069e-01   +7.009182626287258e-01   +4.386004143656866e-01   +7.034712506955729e-01; +1.298805228699540e-02   -9.278540071750892e-03   +1.127815020540254e-01   +6.446610860122888e-01   +2.169735596904289e-01   +6.964150776997451e-01   +4.472750875742647e-01   +3.299928612775877e-01; +5.137046659028653e-01   +4.528270454718881e-01   +4.441155901199435e-01   +6.933039714144269e-01   +2.810010260022924e-01   +8.826142504699800e-01   +3.734743117290734e-01   +1.531352656759226e-01; +3.032879177104435e-01   +2.824228480704185e-02   +4.691227440802647e-01   +9.876331168889316e-01   +6.403311179453322e-01   +9.338571158879432e-02   +3.070425937435842e-01   +8.213268862951106e-01; +2.013606555500655e-01   +9.568947793904538e-01   +9.564102068837091e-01   +9.485187751853161e-01   +4.986178041461926e-01   +9.122192156300957e-02   +7.638227361687328e-01   +1.455660738785826e-01; +3.412162810007449e-01   +5.300976088920986e-01   +2.909472652871992e-01   +2.142585498353496e-01   +3.471885863805968e-01   +2.522390419552893e-01   +6.181458663120960e-01   +4.999173204750207e-01; +4.306579797078635e-01   +2.196073654283578e-01   +1.869138747406437e-01   +3.755078514762732e-01   +9.483490189688715e-01   +5.145018002984224e-01   +4.953011149808883e-01   +9.555535334068748e-01; +6.487562059264889e-01   +1.187239343747613e-01   +3.268608363971420e-01   +6.042184282094748e-01   +5.082844160575961e-01   +7.760504989632062e-01   +9.263437574744473e-01   +6.716298963391738e-01; +3.712785798655001e-01   +2.278415795482057e-01   +6.420043287131838e-01   +2.502463188687292e-01   +1.157166350586791e-01   -2.762234572153556e-03   +3.045443377848985e-01   +7.006475081655875e-01];
L3I_L3E_iAMPA_netcon = [+8.681343017184749e-02   +7.209737899412382e-01   +1.250666622885789e-01   +1.928972201528953e-01   +3.010296823705157e-01   +6.624483378407248e-01   +6.287745288768395e-02   +3.543183141729991e-01   +5.501963107850313e-01   +3.041875604297705e-01   +6.172252275368548e-01   +8.772488233256482e-01; +3.548305961084872e-01   +8.385254667777093e-01   +2.414343381487369e-01   +3.650998665329618e-01   +8.077048429010966e-01   +3.715817684788056e-01   +3.721894509001583e-01   +4.112231663337431e-01   +6.415921877542370e-01   +2.831875016023255e-01   +7.149144715204869e-01   +2.328723216465793e-01; +4.954278216594152e-01   +3.927505411543176e-01   +7.632697834777949e-01   +8.826238527492973e-01   +6.230610418443442e-01   +5.825835462626163e-01   +9.877120843563383e-01   +4.294076279205490e-01   +2.205752822043233e-01   +3.180130565935183e-01   +9.303830791792064e-01   +8.463497841072634e-01; +5.220643824516221e-01   +7.345038595253524e-02   +5.582424908582544e-01   +7.650940041305331e-01   +4.526262363607405e-01   +6.003638659042490e-01   +5.903816355443730e-01   +6.741923712429150e-01   +5.775388939744539e-01   +1.701712746170643e-01   +4.233233562396513e-01   +4.842025021051055e-01; +9.770516965725986e-01   +8.402221428477411e-01   +5.883759126526978e-01   +4.670772496274532e-01   +2.851958425066523e-01   +3.689968686832508e-01   +8.413929976721309e-03   +2.170628182357808e-01   +2.775429257477703e-02   +2.477049560516640e-01   +6.302191668910131e-02   +5.141414977277554e-01; +3.968524513713369e-01   +2.092895643486974e-01   +6.613505871097030e-01   +4.446671460847404e-01   +9.497481414636771e-01   +6.220936431888260e-01   +3.062665157243166e-01   +1.118043372684004e-01   +1.740067840693696e-01   +5.428176092901961e-01   +3.484029025054509e-01   +5.585224041012925e-02; +4.778465500322258e-01   +2.182755869218259e-01   +8.420608273704462e-01   +8.818029969421615e-01   +1.530835386867190e-01   +2.869869894032477e-01   +3.813790217529570e-01   +1.161166669661857e-01   +9.040674689981057e-01   +7.017265229087023e-01   +2.707150271964802e-01   +2.443011504771317e-02; +3.746874128042484e-01   +4.314893424165088e-01   +2.426060839589300e-01   +5.999509328255405e-01   +8.667732584035801e-01   +2.593066521190835e-01   +3.880444313216275e-01   +2.894268857919351e-01   +3.511110354643996e-01   +2.661867320008052e-01   +6.923601662459342e-01   +5.696130581004457e-01; +3.003713339448920e-01   +5.149005492820766e-01   +3.653484253218726e-01   +5.955233548758629e-01   +5.753831355982096e-01   -2.955391365737458e-02   +1.042467238892874e-01   +4.683768017716197e-02   +3.306132896641003e-01   +2.061478559168669e-01   +8.863237315122140e-01   +8.900639053044792e-01; +7.489743463797471e-01   +6.162383652489748e-01   +5.732174759847399e-01   +3.787256783470627e-01   +4.339844871839139e-01   +3.854745970695946e-01   -3.905381615217362e-03   +6.402315295129616e-01   +2.814791292606211e-02   +9.520155481904233e-01   +4.668596271266201e-01   +1.768597861010985e-01; +1.182883794063652e-01   +2.660196885816504e-01   +6.610062526853195e-01   +2.302270362011433e-01   +6.305666700521194e-02   +4.996525318615823e-01   +9.814122202651952e-02   +7.559978706211548e-01   +7.664468131253100e-01   +1.396962024879847e-01   +6.804331290384108e-01   +2.568506028683871e-01; +6.129824839478524e-01   +6.090172562846580e-01   +3.909182485172953e-01   +6.064322289345223e-01   +6.585463562770951e-01   +4.475534925075468e-01   +3.424630768786163e-01   +8.119566024763315e-01   +6.324683314240277e-01   +4.259169271745171e-01   +5.129355143596289e-01   +4.160934127173800e-01];
L3E_L3I_iGABA_netcon = [+3.360773869800741e-01   +7.260679455442816e-01   +7.397391553346014e-01   +8.992633151394213e-01   +4.444609683032473e-01   +1.313587605858281e-01   +2.699450732975774e-01   +7.189504235992030e-01   +8.176870990040355e-01   +2.745816940598504e-01   +5.054648505578632e-01   +2.963768535198688e-01; +8.781713099589641e-01   +3.864952648523152e-01   +6.093445717401110e-01   +3.810957028735124e-02   +9.130446687222975e-01   +3.928240635941039e-01   +8.213320722295152e-01   +7.494392371622359e-01   +6.317721894203209e-01   +7.505671698620638e-01   +2.626385064819845e-01   +4.979818936165685e-01; +8.348193656314602e-01   +3.385203573034888e-01   +3.743910236483255e-01   +4.642573984197743e-01   +5.866135784068260e-01   +5.588637738114675e-01   +2.621841657580015e-01   +8.298583663393986e-01   +5.853005936486022e-01   +1.101167529049773e-01   +7.644721349462695e-01   +8.807542138458211e-01; +1.344199569346678e-01   +6.647988296862649e-01   +3.115194600682626e-01   +3.113376411367542e-01   +1.088026831997970e-01   +6.989099338196134e-01   +2.562147704830068e-01   +9.336117697901386e-02   +3.031944440264698e-01   +5.074372264761478e-01   +7.603233154568604e-01   +5.838294877169249e-01; +2.235620332762278e-01   +7.435699045192977e-01   +6.121764284755667e-01   +2.909557911212746e-01   +1.131698128549933e-01   +6.120696360954861e-01   +9.115350683882680e-01   +2.733763977032239e-01   +3.319383116958658e-01   +8.358126170059959e-01   +6.181378896316766e-01   +2.170596689662177e-01; +4.353552397980197e-01   +8.095463012380730e-01   +7.482360077895338e-01   +5.193012805032705e-01   +7.737617982916576e-01   +9.474760768380305e-02   +3.733508277759803e-01   +3.314242931188718e-01   +8.454220370929976e-01   +8.407598289297945e-01   +8.174663548146582e-01   +3.000736842631513e-01; +5.075663975614868e-01   +8.108982171296473e-01   +2.174480759534317e-01   +4.027656008407476e-02   +4.215176552276897e-01   +6.270201841465011e-01   +6.431059779435899e-01   +1.901745196319019e-01   +1.000000000000000e+00   +6.216388369163487e-01   +2.383709467187317e-02   +3.805481409718468e-01; +4.874884829591325e-01   +4.197506809945210e-01   +8.432920121207016e-01   +3.922123272380098e-01   +8.049966287773820e-02   +9.428573119922232e-02   +5.927506873840170e-01   +5.772632824085346e-02   +5.917706680123700e-01   +8.207078744564864e-01   +2.294880928035239e-01   +9.846246432352896e-01; +3.124063597037054e-01   +5.721548425461858e-01   +2.258976165989559e-01   +7.101855606312631e-01   +9.086584884408410e-01   +2.061218048774475e-02   +3.583052315057322e-01   +6.047406389287101e-01   +6.015855429975719e-01   +9.228567548305964e-01   +7.005816125113571e-01   +6.542313155255731e-01; +6.948870933533159e-02   +1.242583226392947e-02   +3.393862100811025e-01   +5.615241785597802e-01   +7.741328233889790e-01   +2.181756395820456e-01   +3.086505129635226e-02   +3.242023268027656e-01   +6.865503582571798e-01   +2.929238101654711e-01   +6.392255858217071e-01   +5.883333131716292e-02; +9.019884390316734e-01   +9.278077505875310e-02   +7.210387164541305e-01   +5.003969699829726e-01   +4.188683826421824e-01   +8.582928345503993e-01   +1.024146930306268e-01   +7.944139055378600e-01   +3.459331023470091e-01   +9.838295424871990e-01   +4.428175052002193e-01   +7.286581446000951e-01; +6.515234782938932e-01   +8.225330122945878e-01   +5.210665910656035e-01   +9.049832149539078e-01   +8.453933670435392e-01   +4.948537041591824e-01   +9.680251191894115e-01   +9.113880588325982e-01   +4.423445452614047e-01   +9.041046448418414e-01   +5.449576884835623e-01   +9.282834413096700e-01];
L2E_Input1_iAMPA_netcon = [+9.912408351214155e-01   +9.785929987146874e-01   +9.613874343983629e-01   +9.971768899263416e-01   +9.615818735736733e-01   +9.902698206381896e-01   +9.636638308682324e-01   +9.846734577065259e-01];
L2I_Input2_iAMPA_netcon = [+9.598201266661318e-01   +9.691067396949212e-01   +9.906730793833392e-01   +9.350100414010769e-01   +9.600842713199729e-01   +9.527805339390693e-01   +9.539010075088022e-01   +9.975927156312869e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
