function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.644880515896809e-02   -3.486171620227703e-02   +2.492750118444830e-02   -2.404942561433147e-02   -5.197604607660377e-02   -3.031379451784492e-03   -3.636318363937879e-02   -4.166947555408386e-02   +3.576552773251796e-02   -1.240219892291140e-02   +5.122147354554178e-02   +3.023931742995662e-02   +5.453670656488577e-02   -6.036698026417339e-02   -3.009248968652333e-03   -1.831824238532572e-02; -3.011562789485708e-02   +3.647886104614331e-02   +2.524519136617834e-02   +5.043173404578186e-02   +4.124987577418382e-02   +2.627663529353104e-02   +1.347088878401703e-02   +4.446274345227767e-02   -3.510139269517197e-04   -1.838359478726067e-02   +4.140281183618547e-02   +7.057033466940535e-02   +1.644775912324724e-02   -2.214143208749365e-03   -1.000398661555546e-03   -1.289773905308666e-02; +6.619785335945221e-03   -1.700597011756779e-02   +1.637992171611101e-02   +1.710815082908123e-02   +2.294717130464308e-02   +1.555670442903520e-02   -4.325722175766589e-02   -3.634681019467991e-02   -3.514318438749830e-02   +6.891794674686492e-02   +1.619618705682667e-02   -5.016342686988198e-02   +1.698597129765661e-02   -3.666241358185910e-02   +2.127297692568875e-02   +4.982168707741863e-03; +1.780143202705769e-02   -2.510184065870924e-02   -2.043268026403622e-02   +1.831792213456278e-02   +1.536899539411920e-02   -5.373246628968425e-02   -7.563947219704681e-03   +3.989438477128668e-02   +3.013622901025525e-03   -4.873727726016543e-02   +1.020906145986228e-02   +4.837826194433054e-02   +2.087167475178113e-02   +4.649698067288847e-02   -5.299276290531575e-03   +4.381568274607609e-02; +2.077380415983929e-02   +2.732266437633601e-02   +1.003259138401887e-02   -1.338674189255279e-02   -3.388561713976647e-02   +3.127489901784931e-02   +6.819738086012797e-03   +6.010281928350007e-02   -8.879716292017892e-05   +4.294867450621399e-02   +1.796283716449883e-03   -1.767111932878559e-02   +4.577501492033943e-03   +3.501776823465167e-03   -2.360039988598961e-02   +9.876049930546723e-03; -4.320455432891237e-02   +1.784051213326391e-02   +6.880597587094173e-02   -3.489730087857644e-02   +3.622053056434905e-02   +3.445777260734044e-02   +4.238390506768940e-02   -3.237626910071179e-02   -2.303590770340790e-02   -1.273981184677294e-02   +2.461620791987022e-02   -9.649528302007724e-03   +3.579114125595813e-02   +4.595998591142428e-02   -5.554316769507377e-02   +3.824903767210305e-03; +6.748823435242036e-03   +3.608106874151957e-02   -1.113678134114892e-03   -2.756801379368357e-02   -1.058584310309931e-02   -4.149428089524179e-02   -1.620245408900049e-04   -4.974376144557210e-02   -2.688481554663143e-03   -4.376594368569289e-02   +1.431506256857944e-02   +2.612930087690051e-02   +5.237182003758655e-02   -2.122788573968296e-02   +7.065235277423249e-03   +4.607996722575277e-02; +3.952684048294590e-02   +3.743227662771943e-02   +1.742761044453493e-02   -4.624086367030208e-02   -5.042906804121240e-02   +6.264105989414384e-03   +2.653137087716188e-02   +4.723242739180310e-02   -8.606928647230885e-02   -3.699892384439880e-02   +8.387771711715204e-02   -7.816219385811105e-03   +4.500656315575687e-02   -6.966738264928517e-03   +2.650417571732523e-02   -3.468171776884020e-02; -6.576174283181493e-02   -7.312623567994123e-03   +3.921468403479860e-03   +3.426159140529337e-03   -1.582465399835307e-02   +5.698055283674750e-02   +5.030931554290258e-03   -1.009867713423254e-02   -1.018392247487854e-01   -1.828939250083467e-02   +4.806537007302191e-02   -2.160155224351984e-02   +8.912476110460872e-02   +2.549725239167037e-02   +8.800347587045839e-03   +2.466861302525240e-03; +1.299038704159170e-02   -5.508203190002281e-02   +6.901820536318977e-03   +5.117029751989736e-02   +1.363173702595183e-02   +3.642404770928588e-02   +4.508308863461579e-02   -5.573796903006618e-02   +4.578627144453264e-02   -3.101798698777075e-03   -4.309782062444253e-02   +1.807281002775270e-02   +1.353521848246311e-02   +4.212154185360867e-02   -6.884615476411961e-02   -2.773927209894915e-02; +1.410409069679676e-02   +1.173852461967621e-02   -1.083740786981416e-02   +2.684210148723370e-02   -5.774955357720203e-03   +9.480692826161094e-02   -6.193372152484082e-03   +2.447945741069477e-02   +1.346482077162184e-02   +2.459877170267190e-02   +3.185322338439971e-02   +5.080740832994568e-02   +1.351500805892602e-02   -2.545732451188246e-02   -3.370432054376973e-02   -4.734570868722061e-02; -4.419291039931780e-02   -4.069962865074017e-02   -4.109114712750849e-02   +6.007174822710882e-02   -1.648473073480315e-02   -3.346112925751737e-02   +4.720009952010674e-02   +5.976513900747212e-03   -3.356358707790502e-02   +1.958444841512574e-02   +2.945281946460030e-02   -5.361636074287534e-03   -2.141316481275391e-03   +3.016911876735676e-02   +5.900221767704289e-02   -1.610567050379140e-02; +1.975693219818389e-02   -7.513923945234911e-02   -3.113541720608706e-02   -6.279658191752551e-03   +4.093544460628535e-03   -5.948348957543999e-02   -3.815367751261782e-03   -2.521937049410033e-03   +8.472029326169747e-02   -5.630629315776572e-02   -2.322467783581791e-02   +1.963248952738316e-02   +1.210428531058243e-02   +6.584288819667614e-02   +4.323126106454462e-02   +5.072147373364113e-03; +4.204937205532090e-02   +3.162262186093980e-03   +5.177021877452306e-03   -4.595611683769085e-02   +2.188223204605052e-02   -6.673704660614739e-02   -4.871727312031714e-03   +8.851355745167138e-03   -9.056257731298626e-03   +2.973051948092077e-02   -2.170703630962247e-02   -4.253072990942539e-02   -2.812423318684704e-02   -2.544211427194881e-02   +3.866952459871922e-03   -3.641239475117693e-03; -1.881357430345328e-02   -3.493613549898974e-03   -1.005158256368894e-04   +4.668848247378855e-03   +6.269995728053439e-02   +7.673097551754117e-04   +9.193838045968985e-03   -2.232614756174919e-02   -7.654297528493884e-03   -3.844063660048776e-03   +5.903263378373721e-02   +4.929359469571967e-02   -5.103692758919814e-02   -4.348344548456327e-02   -3.582494644640943e-03   -4.073921096710276e-02; -3.404228525803579e-02   +3.061765062183937e-03   +2.485053197672480e-02   +7.874193087243811e-03   -5.434091890350305e-02   -2.926213769514913e-02   -2.269533913369118e-02   -5.636663277808996e-02   +2.811420486910478e-02   +2.060303933958768e-02   -1.317023897279135e-02   +2.467336174313168e-02   -5.718298094536668e-02   -3.624932610567153e-02   +1.480388831623379e-03   +2.730510933112086e-03];
L1E_L1I_iGABA_netcon = [-3.605987186157239e-02   -1.931101089816447e-02   -7.514969354710047e-02   +4.160942714594675e-02   -1.259754317250261e-02   -3.640871337285595e-03   -8.103299265918974e-02   +6.882544215036246e-02   +2.128601900615183e-02   -1.383029723749233e-02   +2.101133538455673e-02   +8.594036949380518e-03   -4.681936650014533e-02   +6.211542425232012e-04   -4.679837488832837e-02   -2.316122533357150e-02; +3.886422440631873e-02   -8.188067435632900e-04   -1.053300287377740e-02   +3.852915597837571e-03   +8.074728093260775e-02   -1.941270127892012e-02   -2.674011107522974e-02   -1.856833673223566e-02   +4.484441286690751e-02   -1.650742082010988e-02   -1.544940531690122e-02   +4.421494291655709e-02   +4.286115036890910e-02   +1.532601654502540e-02   +1.418211202518895e-02   +1.084687619882764e-02; -9.823956627856630e-03   -1.202853712297240e-02   +4.777780204540337e-03   -4.189816511192454e-03   +3.108611071031784e-03   -1.166085329289218e-02   -8.806775955865430e-02   +7.186954657973808e-03   -2.189005847241691e-03   -9.169876618308498e-02   +1.893163710945869e-02   -7.308487680939518e-03   +4.156863076171932e-02   -3.794276659797782e-02   +7.925465410337747e-02   +6.209281744205358e-03; -2.845170142162537e-02   +9.064831858974751e-03   +2.246474890710240e-03   -1.169958382843059e-02   +1.978922701270184e-02   +1.153401006866705e-02   +2.754388368438842e-03   +3.223092404384798e-02   -1.921008713385563e-02   +5.482650625702357e-02   +3.764978537022363e-02   +3.322449068202784e-02   -7.482325345937603e-02   -2.060718758334087e-02   +4.285056264618921e-02   -2.262938849183824e-02; -3.887676373002125e-02   -2.634366289397442e-02   +1.011236781639492e-02   +3.289642768518420e-02   -1.999276668278557e-02   -3.383266524328130e-02   +6.827057346887799e-02   +5.584438228361972e-02   +3.050826248835307e-02   +2.183789345675084e-02   +1.208136921509905e-02   -3.684419969161017e-02   +1.062957818043396e-02   +1.219405158625086e-02   -2.066192715059527e-02   +3.335332618403093e-02; -4.896797309394805e-03   +1.420126376925891e-02   +3.874002839776206e-02   -3.480136268840010e-02   -1.274966895750774e-02   -6.240691045432330e-03   +2.372021553119576e-02   +9.510064780928383e-03   -1.817528724718773e-02   +9.126341800307938e-03   -2.443086162655311e-02   -1.448395232014588e-02   +2.888698809009552e-02   +4.326668840958016e-02   -2.243451013901137e-02   -3.910689236214733e-02; -2.390054845740889e-02   -1.662939343603301e-02   -5.350763988271077e-02   -2.277491803217564e-02   -7.283022957541320e-02   +1.193871890533822e-01   -2.827701774887850e-03   +7.713162208226050e-02   -1.347352696246812e-02   +6.748034726697774e-02   +7.071766881192137e-02   +2.759469398264085e-04   -3.237695114594165e-03   -8.071125706448883e-02   -2.276728831439846e-03   +6.941656750250300e-02; -7.536629130843595e-03   +3.589232483405608e-03   -4.988101378467748e-02   +7.184928944293172e-03   +6.647638765659826e-03   -3.651042258196301e-02   -2.490405931885490e-02   +7.293634430909542e-02   -2.941490297982521e-02   +2.523347835036502e-02   +1.132732229856661e-02   +6.160123193743301e-03   -1.635122248141463e-02   -1.153464682817743e-02   -4.481679346332078e-03   +5.777073718933121e-02; -5.603151537231446e-02   -5.455764466196136e-02   +3.974304587698572e-02   +5.088778297104859e-02   +2.339362243512066e-02   -4.431276096869761e-02   +1.944053689189488e-02   -2.194786744856746e-02   -8.375549624910114e-02   -4.616504214307120e-02   -1.544070984649562e-02   -8.735049952433210e-03   +1.102659032789886e-02   +1.820453609216661e-02   +1.731029624876599e-02   +1.559619583396794e-02; -2.090148763087409e-02   -2.194278585672687e-02   -3.361146748036972e-02   +9.701484748716960e-02   -5.159543796341007e-02   +1.129041643891825e-01   -5.943630792343883e-02   +2.149813139223421e-02   -1.199418808175681e-02   -4.599271321603435e-02   -8.478454249419544e-02   -3.062577405884859e-02   +3.571403226050795e-02   +1.164204304063638e-02   +2.942353392288630e-02   -5.496338009380718e-03; +3.403741380379225e-02   -3.271686194447163e-02   +2.388742589476467e-02   -6.995377296675798e-02   -2.530505972114748e-02   -5.440456359190027e-02   +1.518505043353822e-02   -3.731367497758434e-02   -1.911181907853153e-03   +2.991950886963845e-02   +9.803764598914544e-03   -4.867258187715894e-02   -1.812338397540841e-03   +9.314921622696794e-03   -2.052292756740998e-02   -1.564401002034190e-02; -4.069558178525523e-02   +3.652196959895711e-02   -4.153462505165550e-02   -4.044064583934199e-02   +8.608106699937754e-03   -4.705514294775776e-02   +6.345245149327985e-03   -9.217372133853747e-03   +2.126062680019728e-04   +1.759501934886802e-02   -4.202663652206094e-02   -2.072342757542449e-02   +2.647918904612399e-02   -3.193502504343527e-02   -5.888588318401278e-03   -2.703116145612860e-02; +7.797931498077487e-02   +1.873254094030866e-02   +5.066087469438499e-03   +3.050232334132664e-03   +1.537870803588105e-02   +1.121364225155674e-02   +1.372520072540169e-02   -2.912605208093827e-02   -1.519957686818969e-02   +1.590091580133645e-02   +1.381451753091484e-03   +3.225931622140411e-02   -1.233051379347937e-02   +8.894923092222368e-05   -5.135238033343476e-02   +2.408677537147312e-02; +7.545668877810762e-03   -4.269635563275694e-02   +9.496680789325581e-03   +1.578446896949905e-02   -4.594973758842457e-02   +1.476240803689608e-02   +1.969731765579791e-02   -4.864077142930078e-02   +8.516457695627368e-02   +4.254502166354081e-02   -6.063129785724632e-02   +1.193446906404062e-02   +3.255809325501458e-02   +2.006435280802438e-02   +5.845205403463513e-03   +3.666482769655733e-02; -5.268114779083687e-02   -1.429718028697380e-02   -3.520234309544855e-02   +3.114533840348835e-02   -8.761858742755934e-03   +2.964509650425400e-02   -3.752232270155361e-03   +8.552063782089055e-03   +9.703467839749692e-02   +7.508544185472403e-02   +4.477091161427878e-02   +6.071663068963990e-03   +8.451159181388827e-03   -1.852985140908340e-02   +3.812175019424772e-03   -8.319546638448863e-02; +4.867650553941591e-02   +6.966949290928547e-02   +3.942800225119873e-02   +2.383667118868582e-03   +3.786280022715383e-02   -6.845825737633743e-02   -2.564120947217151e-02   +2.648479496513959e-02   -5.606466721105500e-02   -3.308259771126022e-03   -4.949296182639500e-03   -3.347061772429057e-02   +1.649684648089275e-03   +4.821016221433331e-02   +2.456952896888133e-02   -1.156917481859371e-02];
L2I_L1I_iGABA_netcon = [-5.580543915718391e-02   +5.514686893287041e-03   +3.205592173009972e-02   -6.605067955571357e-03   -7.601891878864601e-02   +2.075942797531021e-02   +2.641687436336135e-02   -2.176142091857993e-02; -4.419116816772307e-02   +2.284143764379265e-02   -4.956560846058562e-02   +4.221594531784534e-02   +1.487522021658564e-02   -2.258547275074220e-02   -9.637059908922815e-03   +2.708055489011262e-02; -2.127264283176727e-03   -3.261691748586158e-02   -8.457932538947202e-02   -3.004726309603797e-02   +3.183062248892259e-02   -1.775521686682889e-02   -2.744593877769839e-02   -6.725657435915502e-02; -4.039075154621856e-02   +6.176080180266955e-02   -8.113717051140708e-02   +7.583734490547658e-02   +7.243177033322548e-02   +1.636915063238588e-02   +7.420731362548131e-03   -5.843659262482325e-03; -1.324487261550937e-02   +2.517717114931955e-02   -1.012119269703824e-02   -6.599834913345091e-03   -5.155420936114335e-03   -6.123754903080470e-02   +1.186272331982724e-02   +2.708736271001688e-02; +3.992672755254584e-03   +8.976172292223490e-02   +1.826367268963671e-02   -1.462616747390443e-02   +1.357992330672963e-02   +6.079255290773776e-03   -4.561196869938824e-02   +2.802918530261205e-02; -1.258094758183483e-02   +5.047397031345420e-02   +2.354111995718410e-02   +1.070375678735084e-03   +2.928765263358703e-02   +4.396248215674887e-02   +3.748273808703711e-02   +1.366927614274632e-02; -2.911652884734673e-02   -3.721353715813984e-02   -1.479382180560125e-02   -2.062132811331683e-02   +2.485647160161017e-02   +7.968809350317159e-03   -1.600326792329271e-02   +2.107358744702128e-02; -1.628856033670252e-02   -3.888418194216199e-02   +2.479611538135326e-02   +2.286269646053006e-03   -4.043321057610883e-02   +1.808474609353176e-02   +7.640661637337413e-02   +1.538914049156754e-02; -2.034292940708590e-02   +2.462658055766193e-02   +2.506701444286738e-03   -1.942510039952927e-02   +1.514628846908754e-02   +2.350786434725352e-03   -1.009728843511674e-03   -5.671054074426152e-02; -2.620264482735009e-02   +2.353367976140585e-02   +3.302675466985940e-02   +3.844784643868480e-02   -2.524639495544684e-02   -5.754117964992631e-02   +4.191539671198627e-02   +1.356155498682979e-02; -5.182727564764440e-02   -7.220932259018790e-03   -2.835443359104519e-02   +3.278695358684674e-02   -4.976794038322009e-02   +9.699937444538537e-03   -1.927172109750100e-02   +1.838431158266060e-02; +6.788004931660948e-03   +7.721863605009052e-02   +1.535366075824447e-02   -4.142240798393335e-02   +8.646110613600950e-03   +4.839279178499648e-02   +2.922498411375135e-02   +6.949074877832227e-03; +3.888711503014957e-02   -3.133309943318867e-02   -1.895518913949626e-02   +3.736932973059010e-02   +2.108783566827896e-02   +3.889942731261821e-03   -5.292912445112518e-03   -4.471763276590687e-03; -7.070515393947581e-03   -5.486578401260224e-03   -1.877429166500212e-02   -1.183732343992311e-02   +3.156994887373924e-02   +2.022599497407321e-02   -7.357611787614857e-02   +4.697778746308287e-03; -3.165448515408945e-02   -3.016265763704406e-02   +7.746319588867414e-03   -3.221399952943795e-02   -1.973098553199032e-02   -2.577797502991361e-02   +4.031534050733669e-03   +1.186912012287409e-02];
L1I_L2I_iGABA_netcon = [-5.826493168265705e-02   +4.104699952631102e-03   +2.021227538368126e-02   -3.917968338778475e-03   -8.734469316428234e-02   +3.214391763018195e-02   +2.903128268837388e-02   -1.262894313658042e-02   +5.301967832635362e-02   +5.367390310153795e-03   +5.688517566837170e-03   +3.325506905852973e-02   -8.312682666470365e-03   -5.512116363892777e-03   -4.514180019804293e-02   -1.122233362063262e-02; -3.110891269599398e-02   +3.123185079617186e-02   +4.768485979142823e-02   +3.631940639035231e-02   -5.131800516857358e-02   -3.064669236901539e-02   -6.245135198932124e-02   +3.637744689298345e-02   +7.705437537044675e-03   +3.711630453597062e-02   -3.644518171263933e-02   -9.235640921501644e-02   +5.914476095215779e-02   -5.019186665775905e-04   +9.923790647003352e-04   +2.128018227126954e-02; -2.178021607894252e-02   -2.737154985782481e-02   -6.964550721187901e-02   -2.108058890471132e-02   +4.811476828418686e-02   +4.293718013879019e-02   -3.027299664356133e-02   -3.043008693606856e-02   +3.561429655718128e-02   -2.994297591109487e-02   -1.059604768107245e-03   +4.215544033658705e-02   -9.049523497006256e-03   +8.109985082324982e-02   -4.474719665158080e-02   +5.631752579739560e-03; -4.005462500068177e-03   -3.626018718694923e-03   +4.675795457792326e-02   +3.762786106084595e-02   -3.338295396167384e-02   -5.957506064153696e-03   -4.795574280215093e-02   -1.574251407647932e-02   -5.272070954495882e-02   -5.312523835770739e-03   -2.574894101543219e-02   +5.980270950375665e-02   -3.225339240177211e-02   -4.083349610304714e-02   +2.658523590455833e-02   -4.120307421375220e-02; -1.246439371828074e-02   -6.443129754803345e-02   +4.197446223552674e-02   -4.564495669264594e-02   +3.870239530291128e-02   +5.810636334413510e-02   +6.049802876374461e-02   -3.608435233780802e-02   +6.083914999143059e-02   -9.447272900369114e-04   -1.323928188653989e-02   -2.626397501217134e-02   -3.997290747055778e-02   +6.451178883715687e-02   -1.902876647844672e-02   +1.198151186148012e-02; +5.113102654303102e-03   +2.442786778359950e-02   -2.959963299514691e-02   +1.112115953521186e-02   -5.021603228455001e-02   +2.264787556811724e-02   +1.478148937895037e-03   +4.435104845169330e-02   -5.266640881803160e-04   +5.291154555729411e-03   -3.305932313937106e-03   +8.818455832414362e-03   +4.187606519593823e-02   +1.324148202804160e-02   -5.133507340129434e-03   -5.522145207050291e-02; -1.368185493668847e-02   -1.082218068495382e-02   +8.276378054766047e-02   -1.201466100858788e-02   +6.484125317626863e-02   +6.320705126277229e-02   +4.691670279957760e-02   +4.672214702045222e-02   -2.049665336119919e-03   -1.480088310111228e-01   +5.830319111481778e-04   +1.670772813126897e-02   +4.123044788041397e-02   +6.333581849821111e-03   +2.110154607217009e-03   +3.333785391094849e-02; +6.705346296873858e-02   -7.562727153618874e-02   +1.437147173255883e-02   +5.495201450336889e-03   -4.724994842418195e-02   -6.366580939469819e-02   -5.874295848593530e-03   +1.533328535507709e-02   +5.258040533162534e-02   -6.714573919991895e-03   -9.556093082002736e-03   -1.635902257303719e-02   -4.135565124375463e-02   +3.220378979261582e-02   -2.785514579985410e-02   -8.887869649553622e-02];
L2E_L1E_iAMPA_netcon = [-5.466334779704351e-02   +3.372964435965743e-02   +8.568403045980708e-03   -7.427085117389771e-03   -2.790283783895891e-02   -7.906236165897262e-02   -5.244176744393083e-04   +1.579052593510134e-02; +1.964473122951917e-02   -7.521702751531802e-03   +1.778756244533315e-02   -2.360427340017481e-02   -8.592374394361772e-04   -7.060985875046726e-03   -1.062286626655839e-03   -2.602977006036506e-02; +1.080841070979037e-02   -6.815715977418135e-02   -5.818751440255400e-02   -2.923408904515785e-02   +3.970753701257858e-02   +1.224651746975716e-02   +4.945367996204506e-02   +1.530004707913196e-02; -3.785646958754366e-03   -9.922004262875369e-03   +3.420372359205573e-02   +2.999120255178281e-02   +1.799646191125194e-02   +7.057710064728284e-03   +5.659857155497322e-02   +3.357492567699355e-02; +2.167340303496323e-02   +2.238249566268455e-02   -3.184720639286195e-02   +7.131687219558096e-03   -5.736246081638467e-02   -4.435843460328068e-02   -3.458286354472271e-02   -1.417351510075292e-03; +8.880890609578904e-02   -5.739080106359998e-02   -1.300640418770425e-02   +4.180805941940205e-02   -6.764998052794499e-02   +1.507598366258046e-02   -4.484079904562824e-02   +6.932452907739868e-02; -9.861008982975428e-03   -2.197831390321960e-02   -3.188064818514989e-02   +1.312372130268364e-02   -3.307695488870482e-02   +2.267566892738769e-02   +1.038993061310105e-02   +2.659905475074330e-02; +3.341978735624544e-02   +1.359227857643208e-03   -1.756975687830778e-02   +3.043805720033931e-02   -4.671692424470476e-03   -2.083830817612388e-02   -4.381549993509307e-02   +6.085535921029165e-02; -5.886213733173586e-03   -2.166994279527964e-03   +6.758177950298159e-03   +2.814080535405544e-02   -1.967107973499645e-02   -3.053064500203772e-02   +4.348017122873769e-02   -4.701382023855598e-02; +3.564062686913197e-02   -1.688696814938797e-02   +6.864137208620644e-03   -6.571441735561307e-03   -2.418700911574435e-02   -2.540545074466577e-02   -2.178926784625227e-02   -2.917148687635670e-02; -1.782428335622209e-02   +3.782701402462415e-02   +1.222022235394126e-02   -5.917189994508765e-02   +4.356343793360871e-02   +2.130692697837635e-02   +1.940645567807492e-02   +1.264695437730746e-02; +1.426106764881464e-02   -2.926955958056447e-02   -1.842188191822189e-02   -7.329707229790969e-02   -2.697284547224097e-02   -2.705377379422396e-02   -8.701330235787606e-02   -2.114320120530156e-02; +2.951279932711703e-03   +1.426712381356529e-02   +3.763432591738332e-02   +1.487790008775965e-03   +4.485438155235376e-04   -2.927167190961392e-02   -3.542958127391737e-02   -1.389431552212117e-03; -3.024463121558408e-02   +1.690268598954250e-02   -6.212392199414236e-03   -1.747384147951650e-02   -3.637709918885276e-02   +1.705285946406638e-02   +2.062634614225117e-02   -1.972827120345957e-02; +2.784179938985084e-03   +2.166996290196178e-02   +8.910816749328530e-02   +2.633682090767292e-02   +9.063791603363052e-03   -4.451142897015174e-02   +3.404436931102150e-02   +2.064005908043091e-02; -6.462668591758443e-02   +3.685736771114179e-02   -2.134969914738168e-02   +4.567721636784884e-03   +2.295314482453090e-02   +5.589840273027458e-03   -1.397995976650084e-02   -3.067653338504134e-02];
L1E_L2E_iAMPA_netcon = [-9.981266339366536e-03   +1.116749666201111e-02   +2.044519509342367e-02   -2.603523484622583e-02   -6.656309803477371e-03   +2.453805795450362e-02   +1.404769385980069e-03   +5.946526863534558e-02   -4.905151762120000e-02   -3.654890478885933e-03   +5.139502659099990e-02   -3.456137629457345e-02   -1.784101166487521e-02   -4.770279894847810e-02   +3.798795127954953e-02   +2.107281691684921e-02; +4.382953843950903e-02   -4.297421003105530e-02   -1.816247216043726e-02   +7.894478700343306e-02   +2.781951070443591e-02   -1.860105433279630e-02   +1.579457257346581e-02   +1.607985468935979e-02   +4.630899652140548e-02   -1.600429825951986e-02   -1.295449571746067e-03   -2.737565911958241e-02   +1.020318492986434e-02   -7.063718231331041e-05   -3.560095820205556e-02   -4.152735424203887e-02; -6.276117839590516e-03   +5.315077674559350e-02   +3.990164635694497e-02   -8.916099746475389e-03   +2.123358998535244e-02   +1.779130026082160e-02   +1.384689021522812e-02   -1.713119100955381e-02   -3.326096791683404e-02   -3.567337610703058e-02   +2.079515441848074e-02   -7.145954292157392e-02   -3.656499619678738e-02   +4.321728091083989e-02   +7.110851981415860e-03   -4.779329495653878e-03; -1.159370476834325e-02   -3.837177526304763e-03   -5.907133735794124e-03   +3.875834341618773e-02   -1.056238437649648e-02   -3.267191928358399e-03   -5.146479101399876e-02   -1.137424348215104e-03   +2.222839879640837e-02   -4.115631463276730e-02   +2.215210405143399e-02   +1.167229298772925e-02   +5.089333564092463e-04   +4.416346118635812e-02   -1.168277973605614e-02   +1.922760333320095e-02; +2.560036589593346e-02   -3.014638525049051e-02   +1.222768582312779e-02   -3.470484796941220e-02   +3.093226309170014e-02   +1.206161275517943e-02   -7.403808163494448e-04   -2.015588255940841e-02   -5.909620075327759e-03   -3.015296119613146e-02   +2.159246002079028e-02   -2.425964591920872e-02   -2.967652448232119e-02   +7.074479130988575e-03   +4.868340319622108e-02   +5.029922785191714e-02; +2.751578378554087e-02   -2.838443703003939e-03   -1.022043285704372e-02   +4.103664310904723e-02   -9.009325871753999e-03   +3.428951794536687e-02   +7.559975925561394e-03   +2.109693956776515e-02   -9.378132093376938e-02   +4.527541646397407e-03   -1.751344516762573e-03   +9.138793759412192e-02   +2.212020388852590e-02   +4.655383722931279e-02   +6.816192240141633e-02   +2.254822363399244e-02; -3.712308111805956e-02   +8.854276296242462e-02   +1.756961990306167e-02   -1.708812698901649e-02   -3.254846782790612e-02   -3.549532965497576e-02   -1.869992670444325e-02   +4.917534691683642e-03   +1.207145352787304e-02   +4.761587812178265e-03   +2.833673633076185e-02   +2.301893575797882e-02   +1.836816128422941e-02   +4.929905077203917e-02   +1.641380005825263e-02   -6.196406382347148e-02; -9.897825833251302e-04   +3.598008157666681e-02   +2.021192664700359e-02   +2.769178563600934e-02   +5.364717448541698e-02   +4.685959692712216e-02   +2.310695024154638e-02   -5.969557556950543e-03   -1.406817668867836e-03   +1.715833739761947e-02   +1.591450718169239e-02   -1.959924769975211e-02   +4.349613995942984e-02   -9.634496346178870e-03   -2.094184268114141e-02   +4.890761072342881e-02];
L2I_L2E_iAMPA_netcon = [+2.166559281581671e-02   -7.616976261364218e-02   +1.137864306624458e-02   -1.742157214953860e-02   +6.338083495520437e-02   +4.542201786972236e-03   -8.067131809860878e-03   -1.652326786286061e-02; -5.752510386225797e-02   -4.111401145125800e-02   -8.801764504337234e-02   +1.053244408355943e-01   -9.766838993482505e-03   -1.310011670413772e-02   -3.414353296211656e-02   +5.525829821553371e-02; -8.532202232533887e-03   +9.796655359860953e-03   -1.714591719905945e-02   +3.314027449345302e-02   -2.653981335281964e-02   +4.525717271451209e-02   +4.339166097000133e-02   -6.545788162823979e-02; +3.613200578670654e-02   -2.052195624920817e-02   +1.971944040046637e-02   +3.841945756882899e-03   -8.986855503652029e-02   +6.971692705837501e-02   -4.147264150808442e-02   +1.777137606777368e-02; +2.571342047242431e-02   +3.050059687622477e-02   -1.425421727659616e-02   +3.631567019703989e-02   -5.432611790810494e-03   +4.268881681154469e-02   +5.868920637144459e-02   +4.184765310229754e-02; -3.189707949911164e-02   -9.990391053932903e-03   -4.119498080659964e-02   +1.774063472466474e-02   +1.462621956324574e-02   -7.080660413952711e-02   -7.434471018745825e-02   +1.921637839673711e-02; +8.227158518409397e-03   -3.442904487971719e-02   +2.141871170598494e-02   +3.243361746653371e-03   -5.128828699751255e-02   -7.957907180385162e-03   -1.427745964814082e-02   -1.788130763100870e-02; -6.234425096578491e-02   -4.292222873405234e-03   +4.798011338812389e-02   -1.521905984871689e-02   +5.712717533503357e-02   +2.614234426517978e-02   -2.848514137289283e-02   +2.253972946261468e-04];
L2E_L2I_iGABA_netcon = [+3.862976748453635e-02   +3.974062164192381e-03   +2.537150680002492e-02   +6.476363516349344e-03   +4.901943628661753e-02   -5.910908847026420e-02   +3.690862613631420e-02   +4.545434330353032e-02; -1.684805195669439e-02   -6.157706097963913e-03   +4.756922299761314e-02   +2.761570615871942e-02   -1.968063998587814e-02   -3.061668291309292e-02   -2.782795435093084e-02   -1.610961221646130e-02; -4.685457485423702e-02   +5.007715083129190e-02   -4.544337142889254e-02   +7.087212245425764e-02   +1.999969321549800e-02   -3.037018894984642e-02   +1.077202363989891e-03   -3.793904217854700e-02; +2.559885432834361e-02   -1.146053779032956e-02   +4.867095758485387e-02   -4.986868261864050e-02   +7.377979651110179e-03   -1.633995040958799e-02   +8.242595061701431e-02   -3.590589174443994e-03; -2.984395823266622e-02   -2.095125113946326e-02   -3.018871288338570e-02   -2.551202838955021e-02   +4.621905997032969e-04   -3.525595747018553e-02   -7.104912693063456e-03   -2.627751243870100e-02; -1.243078330507110e-02   -3.834435496953626e-02   +2.307427864615708e-02   +1.914908768001128e-02   -4.372796169717333e-02   +4.189400160302306e-02   +2.969849269376149e-02   +1.444001599767379e-02; -8.426642824847352e-04   -2.011875802411542e-02   +3.130591379169326e-02   +5.720075291059908e-02   +4.138771537584654e-02   -2.183357085269934e-03   +3.667339340087426e-02   +3.369392840353498e-02; -4.478967287348259e-02   +3.040972052529737e-02   -4.161800220431745e-02   -2.085287534394939e-03   +2.482775443245819e-03   +4.772170045260311e-02   -5.734429935021421e-04   -8.638715795988511e-04];
L3E_L2E_iAMPA_netcon = [-2.256411355888970e-02   +6.049850116459539e-03   -2.202784115115208e-02   -4.909808760060112e-02   -1.094795231594781e-02   -3.227895535501448e-02   -5.336824246978125e-02   +6.846594077428537e-03   -1.246954623828129e-02   +1.993672651258370e-02   +1.045353257836510e-02   -1.276317518844454e-02; -5.189609065218315e-02   -6.353345791256092e-03   -1.815948485668177e-02   -7.637870484815354e-03   +5.024512293445397e-02   -4.715684039186701e-02   -1.797485622486193e-02   -2.499466365150623e-02   +3.833010961551148e-02   -5.371771178043815e-03   -1.033563851124750e-02   -5.917818691552724e-03; -1.122391377493689e-02   -5.352198594295715e-02   -7.786521132756341e-02   -3.101639668428718e-02   +1.388736810391257e-02   +5.559251544462213e-02   +1.788466734772214e-02   -5.812598705660087e-02   -1.253217556588192e-02   +8.910837841666491e-03   -2.652228066682122e-02   +3.240870183027816e-02; -1.272362060847099e-02   -3.335656808028764e-02   +2.902797427897494e-02   +7.884314581002767e-03   -1.968051164931322e-02   +6.035102885093310e-03   +1.955456104437715e-02   +5.578995934999811e-02   +5.642750313663467e-02   +3.502233366134663e-02   -9.363016106485739e-03   -1.531063522457343e-02; +4.536779793943268e-02   +4.803648435692403e-02   -2.730965271251036e-02   +2.245237532769927e-02   -4.226278147478052e-02   -2.318942256799772e-02   +2.270051147244592e-02   -2.997147138026268e-02   +2.887349461874227e-03   +1.487587746577709e-02   -1.075727972544076e-02   -3.634057515504784e-02; -3.594198745910134e-02   +2.773886487068935e-02   +4.835469375660566e-03   +3.454383934089753e-02   -9.446628954330103e-03   +3.423222529364872e-02   -1.950722874842721e-02   +7.161105813615119e-03   +3.033305040729430e-02   +6.133926215790363e-02   +2.301856519963367e-02   -3.377145899229364e-03; -3.241949673505592e-02   -1.896399623963178e-02   -5.926361568089870e-02   -1.906959365713116e-02   -9.850463093305447e-03   -6.695983241285121e-03   -2.635866289903462e-02   +2.216133301920502e-02   +1.609562831050792e-02   +1.069632223347847e-02   -2.155941730183050e-02   +3.493484512924039e-02; -2.645599791710896e-02   +8.936274356322486e-03   -3.471070462922808e-02   +5.372409929719772e-02   +6.652308863375483e-03   -2.596171113185263e-02   -8.322643952684335e-03   +7.012142162909960e-02   +2.645924329993846e-02   -4.194770821653342e-02   +6.535496451684612e-03   -5.006267832688080e-02];
L3I_L2I_iGABA_netcon = [+1.512129315079755e-03   -4.039647619045389e-03   +8.890997807922876e-02   +1.131725829497530e-02   -5.702173820157210e-02   +1.569417649103084e-02   +5.596404307399587e-03   -1.150775286924040e-02   -5.059897550295706e-02   -3.090420464699472e-02   -4.712466184928470e-02   -2.990794199223959e-02; -5.765794767165226e-03   +3.717533718611728e-02   +3.888317310020670e-02   -1.241616822950957e-02   -3.385608094585600e-02   +1.428446663994082e-02   -1.215429094985553e-02   -2.242021715633349e-02   +7.922614441946443e-03   +8.648575671942927e-03   +8.934545422176777e-03   -1.540287496138802e-02; -7.423182664126555e-03   -9.401447229140812e-02   +4.903844120915941e-02   +5.452090074738183e-02   -3.134375645592741e-02   +2.702211795349650e-02   +1.153458172622795e-02   -4.186689067174317e-03   +9.464549852027992e-03   -2.515486825410591e-02   +1.252955221884513e-02   -3.695962639253463e-02; -3.396346406245508e-02   -5.255345242906374e-03   -1.017044687026570e-02   -3.299089576858893e-02   +4.446819308309193e-02   -1.030207223330190e-02   -8.097442108703130e-03   +2.741186457324397e-02   -1.362181928417269e-02   -2.224568269025547e-02   +1.501651298582151e-02   -2.479663882626158e-02; +8.226513709110338e-02   +2.884680335480341e-02   -1.169666218154833e-03   +5.195458080098272e-05   -1.627817781919471e-02   +6.375154408079066e-02   -1.221729208536899e-03   -3.861726513624919e-02   -2.196313982090458e-02   -3.089181171682866e-02   +2.822221936057452e-02   +2.668193316789649e-02; -7.163775845526936e-03   -2.664004856929431e-02   -3.234456905950661e-02   +2.883543671280055e-02   +1.949152122543749e-02   -3.555058959719046e-02   +1.658196889478872e-02   +5.404997671270759e-02   -7.207958446258630e-02   +7.581120344650571e-04   -2.854083598670646e-02   +5.309325544839118e-03; -1.770869803209254e-02   +7.900994407598555e-03   -1.142615984851867e-02   +4.110216023256916e-02   -2.354537266249846e-02   +7.563123208001140e-03   -1.185695638094964e-02   -2.206421108061015e-02   -5.192868440963052e-03   -4.128848109200051e-02   +1.171576059114990e-02   -1.096826529097998e-02; -3.894836475030020e-02   -6.083256745052977e-03   -7.617868843376490e-03   -2.410307716491674e-02   +4.294456185732383e-03   +2.827090207871425e-02   +3.861525438230868e-02   -1.586437754799647e-02   -5.070975904207559e-02   -6.406075533139165e-03   +6.198284580242166e-02   -4.030381502803404e-02];
L2E_L3E_iAMPA_netcon = [+1.459939192672021e-02   -2.623247228710378e-02   -3.901779992700523e-02   -4.558540615718862e-02   -2.407859483560844e-02   +3.049931981624426e-02   -2.663798532612901e-02   -8.931127929990092e-03; +6.121684918257494e-02   -3.050730301425376e-02   +3.242381793690190e-02   -5.716295278574010e-03   +4.554820006196374e-03   -1.904099767160610e-02   -2.200046483455052e-02   +7.706366359040444e-02; -3.599056860429076e-02   +3.876510508108647e-02   +4.496463430245248e-02   -8.094226453730802e-04   +4.967272551064598e-02   -1.350951082201588e-02   -1.643898677872139e-02   +3.663802441175203e-02; +6.483433716334619e-02   +3.619601081366580e-02   -1.401723419499843e-02   +3.598400367382154e-02   +5.171634774526509e-02   -4.147240947971551e-02   -8.500339668824998e-03   -1.170258155934459e-02; -5.267797798046679e-02   -8.551401449881760e-03   -3.161250629121969e-02   -3.501059748163585e-02   +8.982985219243190e-03   -6.007462469315472e-03   -7.867282999697411e-02   +3.445342989446189e-02; +4.693718837379519e-02   -5.464935703213807e-02   +8.993389971282264e-03   +3.718242144076232e-02   +3.213290882075794e-03   -2.690903626549579e-02   -2.880186620033290e-02   +2.552703156483085e-02; +5.072388579560536e-02   -1.128822724371099e-02   +4.987137229584628e-02   +3.319933823796964e-02   +6.042134414717960e-03   +1.321744559309396e-02   -2.284175579362734e-02   -2.250443168662604e-03; -1.220407095669148e-02   -8.227896804320999e-03   +3.537306618788079e-02   -4.745544727820480e-03   +6.737679520708900e-02   -8.423021025294160e-03   -3.193164392699951e-02   +6.752280460882018e-03; +1.015877126888647e-02   -4.535454590811781e-02   -3.221687694259336e-02   +4.851114781359665e-04   +2.667980726321198e-02   +3.831623252098614e-02   +1.145587270564543e-02   +1.167707295557355e-03; +7.456996787401218e-03   -4.367805864100895e-02   -3.666386435227023e-03   +2.202844273918595e-02   -5.365549479090480e-02   -1.680557989186906e-02   -3.431962486296504e-02   +7.039685603601317e-02; -2.944902345078760e-02   +2.515227306127894e-02   -1.858832666419875e-02   +3.016236925841599e-02   +2.823494474873885e-02   +1.796132007955574e-02   -3.890827580649042e-02   -4.619383968989547e-02; -2.520749874564935e-02   +6.982119239430232e-02   -1.653993124464659e-02   +4.446894741604317e-02   -2.077876380589527e-02   -4.284342833100389e-02   +3.583067846428005e-02   -5.270031740617186e-02];
L2I_L3I_iGABA_netcon = [-3.712971459953394e-02   +2.152426440843308e-02   +1.017016726978102e-02   -2.315252118704411e-02   -2.348208313572619e-02   +2.265715765668431e-02   +4.349194620325996e-02   +4.773017073986828e-02; -2.457949177602374e-03   -1.710922228453058e-02   +4.196149892279111e-03   -2.243823565292513e-02   -4.559359234944480e-02   +2.973618548978101e-02   +2.863474431979472e-02   -1.850365432191581e-02; +3.803777873378511e-02   +4.413643157706184e-03   -6.311694272782496e-02   -2.474249531128675e-02   -1.340272809335297e-02   +3.337022556902478e-02   +1.558804552341398e-02   +2.731375287810677e-02; -5.667181063270991e-03   -2.973302053437655e-02   +1.607772428033260e-02   -1.057298011025408e-02   -1.003753731583062e-02   +1.603201305186131e-02   +3.396183674195020e-02   -5.797002241101021e-02; +4.222238636511736e-02   +4.422202796653673e-02   -6.233094275918260e-02   +1.340297570596852e-02   +1.911581534169045e-02   +4.629871092363362e-02   +5.026542134475554e-03   -7.328718787065588e-03; +2.137579876699514e-02   +1.747491260463472e-02   -2.904090013641024e-02   +7.682062144709346e-03   +8.618418944035122e-03   +6.130007005746176e-02   +8.045655011902264e-02   -1.609589955951872e-03; -4.860285921675801e-04   +1.294376689444372e-02   -1.083148067760391e-02   -6.221964220915251e-03   -1.402269744202620e-02   -2.643288154784322e-02   -9.432269021855762e-03   +1.180796347355012e-02; -7.353724154203954e-03   +1.028351736563402e-02   -4.382748899911230e-02   +2.776532865516065e-02   +7.776722865063878e-03   +5.309487334266970e-02   -1.717174013126226e-02   -6.119428324099239e-02; +1.897492448695294e-02   +4.371179815097903e-02   -3.210028962652015e-03   +5.854131659509350e-02   +2.225499814241787e-02   -3.134461954923016e-02   +5.650028451516555e-02   -2.684119182542350e-02; +1.110408398088842e-02   +4.961924993643498e-02   +3.188349165248312e-03   +1.772051282250451e-02   -6.156425579846030e-03   -4.277257462693421e-02   -3.757126353261798e-02   +2.146875504006402e-02; -7.434752954031797e-02   +7.302441398495220e-02   -1.532045493226744e-03   -1.179892665250570e-02   +7.960159649753752e-02   +7.022916717476073e-02   -6.015255544727005e-02   +3.381912898373349e-02; -9.301324135362928e-02   +4.346786880622241e-02   -1.173794532724155e-02   +9.149294146230343e-02   +6.633850766092050e-02   +2.585006061576336e-03   -3.980478389244967e-02   -2.523944873068618e-02];
L3I_L3E_iAMPA_netcon = [+2.878340588830855e-02   +1.903317814671823e-02   +1.450734872664332e-01   +1.316185217261730e-02   +5.080216338640434e-02   +3.467722368224158e-02   -7.262670353141365e-02   +3.162944073238012e-02   -8.217868644914278e-04   -1.368153125986445e-02   +5.285951926056527e-03   +5.494345945962557e-03; +1.513344893204535e-02   -4.628558390260397e-02   -4.816527673371121e-03   +2.594583415385307e-05   +5.325433132399199e-03   -7.724995253083052e-02   +2.253404070203641e-02   -7.028329307809631e-03   -2.839957109475339e-04   +5.041597495081809e-02   -3.633826017727523e-02   +2.820224891653144e-02; +4.818891131970222e-02   -2.884103853314166e-03   +5.187033888177919e-04   +7.445477420213870e-04   -3.782030567243223e-02   -2.160732363091350e-02   +4.296476003416635e-02   +3.466800778246399e-02   -3.145255769245296e-03   -2.950710077420036e-02   -1.195306498422178e-02   +4.193277236673337e-02; +3.665945584262429e-02   +2.261224562772657e-02   -7.329283852664998e-03   -2.849892016679735e-02   +2.470873247431414e-02   -5.630100235083424e-03   +3.743352500431069e-02   -4.206980214241627e-02   +9.417513249330356e-03   +2.038263624015566e-02   -6.443662061103224e-02   +2.685644396619934e-02; +2.649600136177412e-02   -9.646961905022858e-02   -5.565371815773188e-02   -3.709481274446937e-02   -5.003409740176115e-03   -2.263321087423152e-02   -1.238054526285686e-02   +6.281458665329682e-03   -1.056975078189209e-01   -5.818854238104391e-02   -6.044515035531145e-02   +3.701107461323466e-02; -3.115014616681134e-02   +2.091107065178936e-02   +6.180912347252417e-02   +1.695425497507506e-03   -3.084361509212975e-02   +6.376437110240374e-02   -7.297923481633041e-03   +2.585146088020499e-02   -4.158484643677608e-02   +2.987388293295007e-02   +5.051406040984383e-02   -6.116128865369223e-03; +5.943542985619191e-02   -4.568709346546268e-02   -2.903388342973907e-02   +2.269775532534065e-02   +1.901924271468985e-02   -3.052232491944715e-02   -4.974948079737970e-03   +3.255330375664921e-02   +1.521260720008144e-02   -3.733964933298218e-02   -3.026455555635302e-02   +8.849461363386855e-03; -3.448344255963017e-02   +2.051997870325200e-02   +5.585402862500671e-02   -3.416812006860351e-03   -6.558345847268059e-03   +3.590876802435226e-02   +5.646403433362484e-04   +4.689900613668611e-02   -3.172343378013710e-02   -5.854329898504324e-02   +2.030897141189125e-02   -2.012845414299806e-02; +9.743913365750145e-03   -5.056688425138185e-02   +5.594501831215781e-02   -2.909901667902725e-02   -3.674404121251927e-02   -3.281042948217246e-02   -3.044755894030930e-02   -2.408903198920772e-03   -5.411584370862507e-02   +4.495394170193743e-02   -5.728809119732611e-02   -3.598954695589072e-02; +1.624594694559510e-02   +3.996947208616744e-03   -4.370198748249930e-02   +2.737206958979616e-02   -5.881319898812015e-02   -5.632285577111103e-03   -3.860860268458816e-02   -2.012728750661130e-02   +4.943825578916983e-03   +4.620887702604230e-02   +9.994458947918288e-03   +1.178898197682763e-02; +3.864182626154021e-02   +5.280599307711669e-02   -4.115860547581918e-02   -1.014427743235220e-01   +4.536122115019586e-02   -2.419769031782901e-02   +6.958961432694611e-04   +2.099511323806739e-02   -7.163757384795707e-03   -6.254684499186233e-02   +3.071040936697248e-02   +4.931082452240654e-02; -2.044362122991820e-02   +9.685521436210615e-02   -9.134436576905022e-04   +6.351467936092733e-02   +6.713077009263094e-02   -2.398727318899255e-02   +1.339550469039522e-02   -4.357766153827442e-02   -5.945620361639567e-02   +9.107535081971323e-02   +2.890612436983622e-02   -1.710105186151048e-02];
L3E_L3I_iGABA_netcon = [+3.076261877229473e-03   +3.720451808663158e-02   -9.645450164382674e-03   +1.599125730249238e-03   +1.718537780786017e-03   -4.556709030827448e-02   -6.282593404001881e-03   -5.432190654210713e-02   +3.405749962346807e-02   +2.428500780919478e-03   -1.285762363736657e-02   -3.269196072475817e-03; +1.703254958875564e-02   +1.165121652841304e-02   +4.490367676204200e-02   +3.218384521763720e-02   +3.772421159911532e-02   -1.372709357273527e-02   -2.516455891822277e-02   +1.620920200723725e-02   -4.334890160426932e-02   +1.276089806684323e-02   +5.451222524318480e-02   -3.322298687389300e-02; -4.739480360560982e-02   -5.796019924167077e-03   +1.408754019144911e-02   +4.369846783174204e-03   -1.045778838341792e-02   -1.292293702857822e-02   +3.010265017592843e-02   -2.755350118458096e-02   +3.897155813005829e-04   -3.183005351609127e-02   +4.328120068279516e-02   -3.675057543347125e-02; +1.289590459583629e-02   +7.125881237746923e-03   -2.418757863645380e-02   +1.662069036051929e-02   +5.373364830693035e-02   +2.383441189750771e-02   +3.986770476901913e-02   +5.379698620715158e-02   +6.105268011847028e-02   +3.126360123650841e-02   -5.707628543866324e-02   -3.374124568364429e-02; +3.345175102864936e-02   -7.947525245358550e-02   +1.361209012206128e-02   +3.242894459925524e-02   +1.082191683029586e-02   +6.384236885134550e-03   +3.450040062865620e-02   -5.163891918089475e-02   +2.514052922674004e-02   +3.751814218078031e-02   +4.793673142142216e-02   +1.011415488311145e-02; +2.299080184075648e-02   +3.266394934189011e-02   +1.144923339125000e-03   -2.637848970755575e-02   +6.572979074879577e-02   -1.756403464851894e-02   -3.934069120128375e-02   +4.430139243349405e-03   -2.741411837542986e-02   +2.801173038064620e-02   -2.918790929983209e-02   -1.852036476734406e-02; -4.942883638646636e-02   +3.323414306951146e-02   +6.080397187376709e-02   -9.308496280787972e-03   +3.362143216532751e-02   -3.967181592536024e-02   +2.369458220349726e-02   -2.615512842539294e-02   +3.614811117174329e-02   +1.239492955968992e-01   -4.742679739436464e-02   -8.771698759696567e-03; -7.560963280643249e-02   +5.235432991683935e-02   -4.246926714148826e-02   -6.052801307055287e-02   -3.033855094842252e-02   -1.497272836104415e-02   -8.750125651781753e-03   -2.380378884870403e-03   +1.483294558309954e-02   +2.614394454887485e-02   -5.472894161807319e-02   -1.558355318101622e-02; -1.112552822647544e-03   +2.879306791888062e-02   +2.879401434548041e-02   +5.267473837605415e-03   -4.416735956340461e-02   -8.010391214217988e-02   -2.898152834688257e-02   -2.628614295597589e-02   +3.386614434187045e-02   +3.828153646410821e-02   +3.200859309082287e-02   -2.263161227145505e-02; +2.538752037611611e-02   -7.587451382470045e-02   -7.606057317069946e-05   -3.303585395556619e-02   +1.742575278255483e-02   -3.246724677825539e-02   +1.487667352003176e-02   -2.887604951373218e-02   +8.016698486143566e-03   +2.512221693167838e-02   -3.795222731703810e-02   -1.005276666769110e-02; +2.922617870559220e-02   +5.580982764767851e-02   -2.889128179144438e-02   +1.835479213927869e-02   +1.246168967569035e-02   +2.611463122538062e-02   +5.000520357279371e-02   +5.064741189756653e-03   +1.827814253365391e-02   -2.302293426310800e-04   -2.448087434959567e-02   +3.159289640910610e-02; -3.279904958083666e-02   -1.577229690770884e-02   +4.437219754528192e-02   +2.397741376680912e-02   +5.389984721744996e-02   -6.167454292833496e-02   -1.797828917896445e-02   +1.810267074910023e-02   -1.166924423159527e-03   +7.861181349371243e-02   -4.513327699444437e-02   -4.528627521522141e-02];
L2E_Input1_iAMPA_netcon = [-1.116452006668293e-02   -9.546495658323190e-03   +2.556850625230606e-03   -8.350520765412182e-02   +1.030560169986129e-02   -2.256619688743284e-02   +6.307912047311188e-03   +2.839350464540368e-02];
L2I_Input2_iAMPA_netcon = [-5.342562256312126e-02   +1.862823877838534e-02   -3.967507968088103e-04   -7.246124946349772e-02   +5.760455402846099e-02   +3.945501977692922e-02   +1.352671539670620e-02   -2.459955186187445e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
