function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.106165343251565e-01   +2.585989920374415e-01   +4.148270866277147e-01   +4.334280234350907e-01   +4.305590247658929e-01   +3.359900376853030e-01   +6.671380709186103e-01   +4.952151448273705e-01   -1.928991584610632e-01   +5.452814456420335e-01   -1.164189710736992e-01   +4.163906802731010e-01   +2.924655421878485e-01   +1.549036511866345e-01   +7.056998996309020e-01   +7.914411456726493e-01; +1.660080431902777e-01   +8.101483001136026e-01   +4.450287708567953e-01   +1.232676092598244e-01   +2.861384878466567e-01   +4.226277977561119e-01   +2.834409839746943e-01   +2.545879357064437e-02   +3.416311872148076e-01   +2.077198625163743e-01   +3.576852938474328e-01   +6.451030058108077e-01   +6.334559334670360e-01   +3.533269485262883e-01   +3.109449642596293e-01   +1.119426103409076e-01; +1.334778985607670e-01   -9.601972814051725e-02   +4.357828704094791e-01   +4.654875046830140e-03   -3.414852311983074e-03   +3.731989024323052e-01   -9.098706820793939e-02   +1.897750832079393e-01   +2.212463122206125e-01   +8.725396217101042e-01   +1.765326260036320e-01   +5.711187496156744e-01   +1.289820333007152e-01   +8.712404339865255e-01   +5.066330909178985e-01   +3.970017120412719e-02; +8.337811707508975e-01   +2.618205445484253e-01   +2.707976876110195e-01   +1.582222740648760e-01   +4.348974359940343e-01   +5.514922682096799e-01   +5.778578098580461e-01   -3.099937422890041e-01   +6.317447602701732e-01   +7.754256954545640e-01   +4.533333268650354e-01   +1.889579981021352e-01   +1.845540938830493e-01   +4.294794482056017e-01   +7.292125712893928e-01   +2.081225994184835e-01; +6.456699762769404e-01   +3.429497206435359e-01   -5.727490391387993e-02   +3.157915046383028e-02   +3.128083874256339e-03   -2.218219502227778e-01   +2.584647086887710e-01   +5.054553276385293e-01   +4.405581816401147e-01   +1.433736629115123e-01   +3.523648769190539e-01   -1.331035159847143e-01   +2.293457339217980e-01   +5.213878867090239e-01   +7.147061863622857e-01   +5.859120906237667e-01; +4.450926412323923e-01   +2.943480161669300e-01   +5.708945916927963e-01   +1.482376254878469e-01   +1.964171125782268e-01   -2.212952315200942e-01   -9.449653938154520e-02   +4.204725410038684e-01   +5.361079650571059e-01   +5.593251342523391e-01   +1.710958289677434e-01   +5.933241958513457e-01   +4.127715587971439e-01   +2.439118127121490e-01   -9.149798517081770e-02   -8.805310217212228e-02; -3.599357773694722e-01   +4.377529323282395e-01   +5.170125497912149e-01   +4.319946152573521e-01   -1.688111628280599e-01   +1.849746735834554e-01   +1.355031394649025e-01   +5.909015439764064e-01   +7.214463337874396e-01   +1.566724794497452e-01   +9.273235398707808e-02   +1.536512072755380e-01   +5.853087414983559e-01   +2.344997489550236e-01   +3.571852360305307e-01   +1.258054427320128e-01; +3.539025958471416e-01   +3.653008541904875e-01   +8.708554944449594e-01   +4.873108109158613e-01   +5.246113191607601e-01   +6.446562877702388e-01   +1.550169801237375e-02   +2.184025656787471e-01   +7.418328521845041e-01   +4.999862831422035e-01   +3.735637763949513e-01   +2.521132886764701e-01   +4.804099650914041e-02   +6.914881869788455e-01   +3.946908954738818e-01   -2.506914459140989e-02; +3.418948635859701e-01   +3.432556497495087e-01   +3.696292848577721e-01   +1.112022773543370e-01   +6.200126466830747e-01   -1.377005506063249e-02   +4.692028769779104e-01   +1.573546971782084e-01   -2.749063569307828e-01   +8.086494350325785e-01   +6.333494011991095e-01   +6.017606947180804e-01   +3.906883285258942e-01   +3.692608711900865e-01   +3.418485567095180e-01   +5.000619763127585e-01; +7.014521939150503e-03   -1.418699584357761e-01   +5.602750996568001e-01   +7.045845313940521e-01   +9.245877679268141e-01   +3.925342170589555e-01   +2.703316575266714e-01   +5.408853906314901e-01   +3.436664827260775e-01   +4.634265595732812e-02   +1.935274052843072e-01   +5.007967168565364e-01   +4.068650608530720e-02   +3.279958378243816e-01   -2.612459084859158e-02   +5.001373650437058e-01; +9.448100500974980e-01   +5.881834506560041e-01   +7.400287137499310e-01   +3.856264427515589e-01   +4.329372821870488e-01   -1.761668442749865e-01   +2.534760340593391e-01   -1.023619442741802e-01   +1.473902186179344e-01   -1.202201788473249e-01   +7.329939444344801e-01   +2.869896841742049e-01   +3.394031639493045e-02   +1.606693069647046e-01   -1.015446330663410e-01   -5.017900925357033e-03; +1.875590416401563e-01   -1.042730023033495e-01   +2.733527827374954e-01   +4.808560860219202e-02   +6.578076625381372e-01   +6.661564021316091e-02   +1.013951118094232e-01   -2.901342060583731e-02   +1.393373259213905e-01   +2.004339630908737e-01   +4.720565253724914e-01   +2.811361402199217e-01   +1.177923425266662e-01   -2.170315498348207e-01   +1.389665296012226e-01   +1.431672113534656e-01; -1.390204725714003e-02   +5.999498730122831e-01   +2.655239194580099e-01   +4.148019069139735e-01   +3.016632715905796e-01   +1.703102086790926e-01   +8.884878882800961e-01   +4.316160123739571e-01   +3.988428928578813e-02   +7.420803528484121e-01   +6.472924087104127e-01   +2.075298186814316e-01   +4.533345240233320e-01   +3.641723079402985e-01   +2.517743750758607e-01   +6.494077955192491e-01; +4.720649044329101e-02   +4.168657310785105e-01   +1.052648479820311e-01   +2.538597458126300e-01   -4.998960636758512e-02   +7.473613317057332e-01   +1.506698856023438e-01   +3.372011950852609e-01   -6.753419868903310e-02   +1.060922390530500e-01   +2.534025553863241e-01   +1.956492691304227e-01   +8.512315731283415e-01   +3.810997770807854e-02   -3.012653824791020e-01   +5.777206377518530e-01; +6.002206014110301e-02   +4.429286742455044e-01   +8.870414884867689e-01   +1.951359262015476e-01   -2.466968123081043e-01   +2.411493372146087e-01   +8.707299663800194e-01   -5.813659596207399e-02   +6.167797619446602e-01   +8.753686792743451e-02   -6.402704179505281e-02   +4.298702185421786e-01   +8.806492466440917e-01   +6.860679616942673e-01   -4.862251867025702e-02   +5.405743778447022e-01; +7.234360224177202e-01   +4.587742506500811e-02   +6.399717494592796e-02   +1.250083639695654e-01   +5.085840653296757e-01   -8.086145949103585e-02   +1.337269090659961e-01   +6.825573732874252e-01   +3.303386066208829e-01   +5.077168497152229e-01   +2.382913777513092e-01   +4.797574883511703e-01   +1.817723130375451e-01   -5.885178752027351e-02   +3.584627097318325e-01   -3.555947019318670e-02];
L1E_L1I_iGABA_netcon = [+6.173788439269793e-01   +1.240905985937977e-01   +3.543660203901512e-01   +2.568286761740476e-01   +3.802813164690278e-01   +4.093189580090895e-01   +1.771832959822927e-01   +3.206396496303625e-01   +5.769051175717922e-01   +4.823260578857061e-02   -1.954113143480846e-02   +5.646588220758921e-01   +2.182290869793563e-01   +2.501688712724036e-01   +2.442168844906214e-01   +4.563156892340996e-01; +1.921343021371448e-01   +4.652542633210304e-01   +3.887426184036112e-01   +7.983813971596880e-02   -2.155523347703529e-01   +5.033047557302582e-01   +9.039385849987988e-02   +6.651788962410377e-01   +6.273314803855611e-01   +1.924627156813339e-01   +4.730266453200197e-01   +6.324915699589873e-01   +4.195407340530316e-01   +1.960987909351375e-01   +3.722425972269209e-01   -1.525028298251822e-01; +3.345565641326302e-01   +7.150565379477614e-02   +1.696811722308299e-01   +1.525616339768446e-01   +2.624667154332007e-01   +1.657455296416680e-01   +8.787611109575089e-02   +2.638326778878686e-01   +7.019877532577546e-01   +4.467891826446055e-01   +1.839512189977678e-01   +1.668376833783439e-01   +1.585911619593284e-01   +7.090811375475287e-01   +1.561974526703327e-01   +6.467942227631414e-02; +8.337172830577352e-02   +2.996482628288575e-01   +5.793903174020952e-01   +1.160589534559577e-01   +7.170301269874864e-01   -1.286736882273583e-01   +3.448892397416725e-01   +3.687921871118228e-01   +1.266137876293110e-01   +4.847520531544164e-04   +1.959807279115757e-01   -4.227288511118418e-02   +2.069904840071940e-01   -1.542632092553208e-01   +6.887142919347768e-01   +3.458623428244119e-01; +9.496768798937366e-02   +2.361908892714967e-01   +5.362507343976536e-01   +1.715601562881746e-01   +4.783447587830322e-02   +2.018695420201164e-02   -1.711070794355081e-01   +4.280981956289967e-02   +3.438551892629860e-02   +3.558533707267127e-01   +4.114124273393379e-01   +2.482644448251728e-01   +4.439322014234314e-01   +2.670042563953119e-01   +2.859775395494454e-01   +7.349406878846151e-01; +4.945989157236955e-01   +1.468864028057398e-01   +6.043159161126718e-01   -2.052567739689014e-01   +2.167085727789375e-02   +7.143362158054425e-02   +2.088268247598540e-01   -2.153582750424145e-02   +5.992155670591690e-01   +3.707069772871479e-01   +5.856779249145608e-01   +1.341582065064457e-01   +2.308412250580538e-01   +1.209651684335195e-01   +8.197255378184918e-01   +7.068934468959815e-01; +3.612450343787601e-01   +2.051638005910176e-01   +3.004772248908713e-01   +3.242206177766959e-01   +3.080103350845932e-01   -1.861803476578253e-01   +1.100295336537257e-01   +8.654611055600070e-02   +3.495590816320977e-01   +3.758462181051315e-01   -8.814678596353116e-02   +3.705523644750914e-01   +2.121558530733525e-01   +5.285052247168220e-01   -6.316703480448155e-02   +1.203180812139437e-01; +6.710897137140730e-01   -2.889736235592109e-01   +4.063309909300211e-01   +1.160673600219639e-01   +8.146073888543657e-01   +4.809510105324817e-01   +3.612113094754187e-01   +1.869577307166978e-01   +5.092943702836675e-01   +1.280166851483435e-01   +6.074983710458143e-01   +4.118869705043345e-01   +3.226981779490385e-01   +2.321424235420680e-01   +2.217737643590849e-01   -3.372625535023194e-01; +1.340963779457084e-01   +3.338929227367098e-01   +6.174468219644769e-02   +1.359713093732416e-01   +5.067306154329487e-01   +6.199154709646415e-01   +4.352276848652896e-01   +3.945830768283189e-01   +3.413199399180977e-01   +3.585420222368357e-01   +4.277051659690956e-01   -1.030068847669625e-01   +5.507674754921197e-01   +5.390763528379054e-01   +1.331486391122854e-01   +1.281538346022057e-01; +5.067607362535795e-01   -1.348654241085664e-01   +9.018552287909756e-01   +2.238855662421954e-01   +3.795973795369557e-01   -1.103237710322640e-01   +3.198087225308089e-01   +7.934907362432346e-01   +1.048439339232620e-01   +2.351333835828653e-02   +9.889101047186466e-01   +8.480524279960301e-01   +7.489257685657882e-02   -3.108570822900952e-01   +6.252421556398804e-01   +5.386927019576528e-01; +6.615214065487938e-02   +2.485316027889574e-01   +4.498672802883756e-01   +2.719616230252495e-01   +7.791554587358389e-01   +1.162565125958352e-01   +5.539736451241124e-01   +8.955558232694086e-01   +4.844007679588202e-01   +4.107440620303655e-01   +2.516546821566387e-01   +1.521808926101686e-01   +5.565454880268006e-02   +3.938229481549124e-01   +2.830803654161037e-01   +9.983364940529791e-01; +4.094059095587528e-01   +2.811620424578393e-01   +4.945162407133761e-01   +5.119241043417514e-01   +1.951677097169232e-01   +5.381028114180710e-01   +3.317752012513520e-01   +4.732789893314243e-01   +3.499100699338725e-01   +5.623025847292953e-01   +4.387460008734708e-01   +1.053457871964849e-01   +5.654393661410548e-02   +6.311016008778929e-01   +3.629723397974792e-01   +2.155734239871613e-01; +2.777441066514179e-01   +3.837638645466533e-01   +4.021944721019740e-01   +2.604956526650734e-01   +5.753081291575892e-01   +5.114521879298771e-01   +6.074013585613106e-01   +6.973953615612000e-01   +2.943200065724724e-01   +3.081393623388221e-01   -1.898728445889296e-01   +8.276910957911532e-01   -1.117529488811217e-01   +1.191225304918098e-01   +2.340326124809241e-01   -3.337980571252144e-02; +1.579811641624357e-02   +7.157483589774984e-01   +3.227733506148139e-01   +1.771050347134495e-01   +3.955325313709432e-01   -2.510702790978012e-02   +2.803682558318337e-01   +4.271494121762035e-01   -4.270312937806591e-01   +2.084694085913991e-01   +7.656255970381960e-01   +6.310031830195370e-01   +2.975156033397874e-01   +1.344815509501381e-01   +2.274299424054531e-01   +7.447719574535311e-02; +3.084135621695819e-01   +1.774548744031852e-01   -2.427293018684053e-01   +6.108710853167404e-01   +3.930072212454025e-01   +4.187296157618186e-01   +3.908067557704619e-01   +2.619679993199077e-01   +4.432039038538916e-01   +1.397258185203269e-01   -7.343317178949331e-02   +3.517377065152979e-01   +5.061625013916654e-01   +3.717282381155171e-01   +5.717955165799263e-01   -1.899815045666627e-01; +6.063188819382808e-01   +3.946709249679312e-02   +1.833951169377986e-01   +2.775131176517679e-01   +9.178673494989943e-01   +3.796310633126943e-01   +4.625271884255201e-01   -1.364435114290700e-01   +3.033956992295213e-01   +2.827771625025448e-01   +3.830254248676250e-01   +7.423350666424235e-01   +8.236025072577209e-01   +3.799831909403702e-01   +5.113565123126861e-01   +3.045657074980251e-02];
L2I_L1I_iGABA_netcon = [+8.532788260858473e-01   +7.025898159111925e-01   +4.809402810982812e-01   -3.460116171185744e-01   -1.081294963820271e-01   +2.317650723842644e-01   +2.434806488702536e-01   +3.080450231550547e-01; +2.609001081654866e-01   +6.199783274920371e-01   +3.440532132519472e-01   +2.142448717702885e-01   +6.070523517201665e-02   +8.130558114704780e-01   -3.777991702481087e-01   +1.172984616897523e-01; -6.626113853775917e-02   +5.803872587985761e-01   -4.159214869656003e-01   +5.781061388498091e-01   +3.084663064321293e-01   +4.505409410110469e-01   +3.859331182371507e-01   +5.512303269527287e-01; +8.063046961738678e-01   -1.869945320902618e-01   +1.489392817371044e-01   +1.609126982438968e-01   +4.329448269643915e-01   +1.206982323853307e-01   +4.434601835132285e-01   +9.044216523597601e-02; -8.318187027091195e-03   +2.925207626001429e-01   +3.531406835199572e-01   +2.876699092753582e-01   +7.946286809730780e-01   -1.041440527319148e-01   +4.446773593903580e-01   +6.051293738426769e-02; +1.328024736855272e-01   +3.805432899342838e-01   +2.995882345912383e-01   +3.860007402844965e-01   +5.338904817463100e-01   +5.090145763620263e-02   +1.220876011440258e-02   +7.431605973386505e-01; -5.382463148945094e-02   +5.285721802337903e-01   +2.448408612532086e-01   +3.507433277192787e-01   +4.441376741163457e-01   +2.482338242922221e-01   +2.116916715494093e-01   +4.730983403830743e-01; +4.703079005555110e-01   +8.088042014124457e-02   +3.631789671147697e-01   +7.340203438321371e-01   +7.994673130996659e-01   +3.899830884771039e-01   +4.610380722557556e-01   +3.659299966177739e-01; +8.751058141678240e-01   +2.213237085662305e-01   +6.846958528676276e-01   +4.561677704136520e-01   +6.621007573355782e-01   +4.444983823075813e-01   -2.721922433800862e-01   +3.984309634138743e-01; +5.872443295388140e-01   +5.010240000782480e-01   +9.392344028639762e-02   +7.057058747606644e-01   -8.401463540056596e-02   +5.440727769400800e-01   +5.791165315930126e-01   +9.152000116553271e-01; +2.995981852928648e-01   +2.793004899372024e-01   +5.537876895404571e-01   +2.118273577919553e-01   +5.787444579959445e-01   +6.907216542516897e-01   -9.783140101606515e-02   +3.207323490743648e-01; +3.803937659657473e-01   +3.766449659279308e-01   +7.560064669705195e-01   +7.950719777186499e-02   +6.017221734037944e-01   +3.142778847236642e-01   +2.851558927581320e-01   +3.344095772210248e-01; +3.235513970300123e-01   +9.073916681633624e-01   +6.886494401269555e-01   +2.372358350233873e-01   -9.163362247035839e-02   +2.421583652652574e-01   +8.434968591239077e-02   +5.061393144243785e-01; -2.017722894800364e-02   +4.120084580144269e-01   +9.169864177069699e-01   +2.821349963235985e-01   +2.777978908320773e-01   +2.525260029766832e-01   +1.507822507962740e-01   +4.313813921321155e-01; +3.179482801190054e-01   +6.106049718774544e-01   -1.201869426873608e-01   +1.387007005889872e-01   +2.369125596225160e-01   -2.883845156511036e-03   -2.477948935039825e-01   +3.155664544697767e-01; +2.963567015760230e-01   -5.941566117069248e-02   -2.889301808116945e-01   +2.456151311967296e-01   -2.575918481960715e-01   +2.533177174473220e-01   +4.283975427024143e-01   -1.869433029831286e-01];
L1I_L2I_iGABA_netcon = [+4.884118274883584e-01   +2.657668570529438e-01   -1.027685841102548e-01   -9.473751147102860e-03   +7.733016429040542e-01   +3.864539001225066e-01   +3.571518831985036e-01   +3.958757834134304e-01   +1.264305577550354e-01   -2.894034989287833e-02   +1.920112594313823e-01   +4.685190161133362e-01   +5.990320327346662e-01   +4.373334143582522e-01   +6.283157670328108e-01   +3.432227516368131e-01; +7.292539976314366e-01   +5.172442111452766e-01   +6.366473500994736e-01   +2.756728832386878e-01   +5.082980828226902e-01   +2.301480272293497e-01   -6.088446779631978e-02   +1.385628459661125e-01   +2.962813607627283e-01   +6.982389062289329e-01   +8.514046454848298e-02   +4.891426006741165e-01   +5.452071292154027e-01   +3.740252109769990e-01   +6.874661787439469e-01   -5.871263093289585e-02; +1.086805291758483e-01   +2.373702094677571e-01   +5.348318149441074e-01   +3.597185166550207e-01   +1.657341695113063e-01   +1.792974766797173e-01   +2.027697414124510e-01   +6.542032016021343e-01   +3.256352313171965e-01   +3.277940732076915e-01   +3.014285262148707e-01   +8.386575131759474e-01   +1.646270339653465e-01   +3.595713269806746e-01   -1.205275397203844e-01   +4.715823336261751e-01; +5.781227991678168e-01   +1.893972847817974e-01   -3.788702001657106e-01   +2.993950259977270e-01   +1.010294541840641e-01   +6.358724517693940e-01   +1.402310993709401e-01   +2.356169718611033e-01   +2.766399489361775e-01   +3.492530017005061e-01   +3.831882221218483e-01   +5.851472526292556e-01   +1.893783027365243e-01   +2.805576880411643e-01   -2.314837953483708e-01   +6.479078057742926e-01; +8.952425227568946e-01   +5.169811400511647e-01   +5.280593710104990e-01   +7.195480827561526e-01   +8.964015995478920e-03   -1.668748497721989e-01   +5.206665667710086e-01   -1.763294728793529e-01   +5.537472527559413e-01   -3.255242731133649e-02   +5.789240659759842e-01   +1.713457671771308e-01   +3.164055697201171e-01   +6.705869514628660e-01   +3.416878921370332e-01   +4.482449797275295e-01; +8.461887870903562e-01   +2.759064030853982e-01   +1.483246975135077e-01   -2.363568304733003e-01   +9.303502141421827e-02   +1.904711197166046e-01   +1.352161492407595e-01   +5.354010165070296e-01   +7.310914239833642e-01   +1.639721857259939e-01   +2.955477051650889e-01   +4.268431098908966e-01   +5.573093104522195e-01   +6.109984610289632e-01   +4.012709788009107e-01   +5.778160715785345e-01; -1.561692522720105e-01   +2.259800635413338e-01   +3.545185824759249e-01   +1.534794843910560e-01   +3.085406508680409e-01   +3.596355501036709e-01   +2.715432136166075e-01   -3.406091059178941e-01   +5.708978578753332e-01   +8.263297312890819e-02   +7.236542130103341e-01   +6.586876724784458e-01   +1.233508190961485e-01   +2.765122946865752e-01   +8.016295537355009e-01   +3.931631689697914e-01; +3.422459375367899e-01   +5.733864151401609e-01   +3.472214024309452e-01   +4.450461280480821e-01   -3.556776718723412e-02   -2.731725445539737e-01   +6.671527765381479e-01   +4.086320564420535e-01   +5.395042002807590e-01   +2.523018190210119e-01   +4.514341189177651e-01   -5.733555562064993e-02   +1.392427933432085e-01   +1.894801918920901e-01   +2.749529529657588e-02   +9.599392595697516e-01];
L2E_L1E_iAMPA_netcon = [+5.748999624943477e-01   +4.002762881316471e-01   +1.416942412980268e-01   +1.563078063709480e-01   +4.361253941622933e-01   +6.082919270801562e-01   +1.272192674382174e-01   +2.663717423465865e-01; +1.647909769244302e-01   +6.458403248526435e-01   -3.762235554642591e-01   -6.070946476927318e-02   +3.892199667739666e-01   +3.551432552422094e-01   -1.873558269258432e-02   +3.006284352895893e-01; +7.691777129186207e-02   +6.851984686421526e-01   +6.557498138971729e-01   +3.332941401491631e-01   +3.607027320904136e-01   +8.314398524811983e-01   +1.389336358995970e-01   +2.574910630024129e-01; +2.729654731159358e-01   -2.059047895151653e-01   +1.367020530685212e-01   +8.976839659758536e-01   -1.289346415693848e-01   -5.448450370844092e-03   +1.356821120401194e-01   +2.938789545228523e-01; +4.058418742622900e-01   +3.150191343578586e-01   +3.387640898870427e-01   -2.087617886697883e-01   +4.046834527228798e-01   +6.401160076128308e-01   +1.845951331396555e-02   +1.058241014858319e-01; +4.618211604075897e-01   +6.284995564851813e-02   +4.127225949842548e-01   +4.846543579739411e-01   +2.061980239045578e-01   -1.175261719498598e-01   +4.237910309311279e-02   -2.502895497366710e-02; +3.304124060080851e-01   +4.703177407951579e-01   +3.067480233094555e-01   +7.526087487269002e-01   -1.568072928640402e-01   +9.720701322758854e-02   +2.451324239260468e-01   +1.000000000000000e+00; +1.036957629731689e-01   +3.245078985082445e-01   +2.856802217792777e-01   +2.133479143258262e-01   +2.658107023440203e-01   +9.068329660563862e-01   +7.995454918940974e-01   +3.947032192064135e-01; +1.053365513095132e-01   +2.743703169085234e-01   +1.553519877109097e-01   -1.628960918965086e-02   -4.406352275784005e-01   +6.340562598888503e-01   +5.329052694329092e-01   +3.841449091550300e-01; -1.929736180116563e-02   +1.466124046649465e-01   -1.764532456273426e-02   +4.497775254077490e-01   +2.513098791775468e-01   -8.869587075820226e-02   +3.106920336663085e-01   +6.636911057691768e-01; +1.022424902749291e-01   +4.905957079707381e-01   +2.210710248986332e-01   +8.324120162202501e-01   +3.640583664652725e-01   +7.370327592437436e-01   +8.168876730657508e-02   +2.429899987245988e-01; +8.275717718823433e-02   +3.061214520413303e-01   +2.716283571894459e-01   +5.713486992914988e-01   +1.896298320419070e-01   +4.025364506450540e-01   +4.601957996794483e-01   +3.611228262636006e-01; +1.761353806303173e-01   +7.288039206759643e-01   +2.931355664296250e-01   +3.923657104699106e-01   +4.366538331117095e-01   +2.444951814794322e-01   +3.253576398678452e-01   +5.325798415924995e-01; +7.139419301491523e-02   -2.440068757194565e-01   +6.286322165193643e-02   +3.379318414253348e-01   +5.120406322873786e-01   +2.530874966638469e-01   -5.269926701357857e-02   +3.531546000791247e-01; +5.745542648342257e-01   +5.324488134851963e-01   +3.034762978219476e-01   +3.629669802180280e-01   +6.869821117853382e-01   +4.888868374344058e-01   +6.228364006998279e-01   +3.919702297694510e-01; -7.019918824072968e-02   +2.233122398959992e-01   +2.870613617760738e-01   +3.228553628171093e-01   +2.024676622415000e-01   +5.497161624065915e-01   +8.308818590395017e-02   +7.106214480869539e-01];
L1E_L2E_iAMPA_netcon = [+3.674072090835000e-01   +3.067433502975295e-01   +4.505223352179635e-01   +1.756371296899454e-01   +2.283838739673691e-01   +9.617390311169250e-01   +3.518164411109866e-01   -1.171308898251530e-01   +2.009589642979126e-01   +2.944682888709635e-02   +3.990213775347501e-01   -5.851721222849450e-02   +5.172363317511754e-01   +7.293484419831264e-02   -6.525983760535659e-02   +4.363040486339547e-01; -1.835535757595694e-01   +5.452747677680011e-01   +5.647654420667303e-01   +6.843634969959540e-01   +6.769744584690957e-01   +3.542938301438118e-01   +7.632704669532953e-02   +4.078964263119005e-01   +4.503389673027671e-01   +8.704442153844570e-01   +1.220548070516627e-01   +3.175990814520733e-01   +3.934366620816446e-01   +5.152312629366171e-01   +7.700235503129846e-02   +1.244188213730145e-01; -2.886351980783874e-01   +6.286074918259168e-01   +1.035637960595390e-01   -2.497998540338697e-01   +4.116219492822925e-01   +5.881329835929386e-01   +1.528785354689789e-01   +7.420931859959535e-01   +2.872834178491945e-01   +3.045879233790338e-01   -1.860169953263305e-02   +5.531717132242931e-01   +4.190295764554149e-01   +7.658838809580121e-02   -7.355886215034585e-02   +5.810294938386086e-01; +2.549487662503701e-01   +6.514062394806380e-01   +6.761945777299141e-01   -7.587749859665585e-02   +2.261088034544684e-01   -2.072346808440109e-02   -2.580486791074724e-01   +6.323193863195905e-01   +2.238159665351088e-01   +1.454217515990735e-01   +4.526226876493478e-01   -3.469678385545619e-01   +8.925806008326584e-02   +8.170786382842252e-01   +6.575318540986539e-01   +2.310139514449727e-01; +1.882071684055795e-01   -2.151671133627441e-01   +3.385564025917794e-01   +1.925797491339332e-01   +3.369593785940431e-01   +6.056606880369596e-02   +9.470361182903813e-01   +2.727092929244640e-02   -1.980901580507782e-01   +4.701717681880477e-01   +1.949997186276871e-01   +4.644671660325567e-01   -3.423860025631564e-02   +2.514429742778405e-01   +3.037781110755181e-01   +4.957557657133371e-01; -3.328907954842257e-02   +6.762492126885926e-01   -7.053939187358771e-02   +3.985055663275340e-01   +4.330311150874383e-02   +3.042785630867145e-01   +4.326145470920322e-01   +3.498682839806839e-01   +2.855544837077879e-01   +3.227493846523347e-01   -1.921456598792258e-02   +2.410528478691890e-01   +1.993910587005790e-01   +1.690247092552919e-02   +3.646534110586874e-01   +6.093286627133355e-01; -3.434214329228669e-02   +1.021035241168313e-01   +7.963243193412743e-01   +2.702306369810958e-01   -3.839328655069322e-01   +7.129254893543785e-01   -9.625373572250878e-02   +4.928784607235975e-01   +8.217315502297734e-01   +5.919267429440728e-01   +7.827370149544460e-03   +3.438104462833880e-01   +4.834775068393566e-01   +4.703608341462699e-01   +3.440832599638132e-01   +1.751231763514741e-01; +7.803028816334683e-01   +4.894963083526179e-01   +2.018746552783868e-01   +2.307714850183219e-01   +7.421704914869334e-01   +2.922497262625565e-01   +1.063300577947756e-01   +1.828994645462332e-01   -7.035005596373171e-02   +2.218160982944098e-01   -3.624491137507724e-02   +2.873801069995672e-01   +2.233852809002103e-01   +7.408462265938384e-02   +6.103932576974130e-01   +6.472815674820794e-01];
L2I_L2E_iAMPA_netcon = [+4.581454775859811e-01   +2.899419854925511e-01   +9.285918795187137e-02   -1.400196844840998e-01   +5.492335927933711e-02   +2.938897779103983e-01   +4.218273013806912e-01   -3.838931462240366e-02; +3.813214029110351e-01   +4.769890646241807e-01   +4.328963484564973e-01   +3.451365118395403e-01   +5.299211330110999e-01   +4.012764493776277e-01   +5.317564339420199e-01   +1.193912507212455e-01; +3.803760214872055e-01   +7.149189081042030e-01   +2.148576182510527e-01   +3.648796323848024e-01   +5.183525657552822e-01   -1.806801603204815e-01   +4.285616703831737e-01   +1.090120540284182e-01; +3.879731479353228e-02   +5.806167497456033e-01   +3.634205443607501e-01   +2.015531959072319e-01   -7.900672805593073e-02   +3.354530852673495e-01   +4.356446453546923e-01   +4.085496411834469e-01; +8.693928016495092e-02   -1.159870133307681e-01   +3.331226694893114e-01   +2.737864736201219e-01   +7.467694278552504e-01   +2.725962764245577e-01   +3.542196132250611e-02   +4.184687848328229e-01; +6.136619193077163e-01   +4.132935843720059e-01   +4.769256303654819e-01   +3.849522707059387e-01   -1.926525140467221e-01   +1.960492166491576e-01   +1.775201670064108e-03   +8.520596370765018e-01; -1.293105946339639e-01   +3.451334489438514e-01   +7.577408202029856e-01   +5.572079929503575e-01   +7.859807281064711e-01   +7.649808373812754e-01   +7.582030252238605e-01   +1.438599500616040e-01; +5.891178872467420e-01   +2.818672851075351e-01   +7.028309105727057e-01   +2.336011747648960e-01   +1.913385636653381e-01   +2.011393229805631e-01   +6.108821171543053e-01   +4.984169672634546e-01];
L2E_L2I_iGABA_netcon = [+1.986241932285960e-01   +3.185228687903548e-01   -7.001574736881291e-02   +1.546408885239538e-01   +7.309668754528753e-02   +6.990912569431920e-02   +1.571911987262660e-01   +3.392316305061216e-02; +6.996927625913434e-01   -6.068251493346147e-02   +2.153515186085650e-02   +1.584397487630325e-01   +5.632313719553791e-01   +3.197422663704077e-01   +5.397791827424262e-01   +9.255660104958750e-02; +1.499688683472557e-02   +6.034417502220180e-01   +7.344085681242212e-01   +3.289468688989536e-01   +4.465545723904288e-01   +4.019014171562036e-01   +3.693377702679129e-01   +4.065962010942782e-01; +3.795595012960881e-01   +2.230953964864976e-01   +1.008058811221142e-01   +1.475324333368136e-01   +5.856325336769418e-01   +7.758924281308833e-01   +7.290372271667379e-01   +3.358793146504983e-01; +2.366474197649943e-01   +6.572160799680712e-02   +2.215341535710904e-01   +5.085765866173942e-01   -4.944886920858485e-02   -1.070898062917230e-01   -1.065523062709686e-01   +5.690817859908184e-01; +3.419424061408782e-01   +2.104883088314051e-01   +1.600088554517569e-01   +4.998256407571053e-01   -1.102398235676188e-01   +4.467846898357191e-01   +4.774802114597472e-01   +7.192197085154964e-02; +2.501460893596903e-01   -4.426353920262316e-02   +4.280729554753987e-01   +3.276951712078627e-01   +3.650547437177370e-01   +6.439165070545331e-01   +3.020276139614019e-01   +3.387359161703171e-02; +1.397178477135763e-02   +3.055651136028293e-01   +6.805412453578555e-01   +1.228110288943638e-01   +5.433930292526593e-01   +3.178678815477699e-01   +5.440198675518991e-01   +5.520870245534475e-01];
L3E_L2E_iAMPA_netcon = [+3.025534229765320e-01   +2.247905409098110e-01   +5.737539236536147e-01   +2.304517006875774e-02   -3.321999149970190e-01   +2.276940231560967e-01   +2.663679960952806e-01   +6.137727872871036e-01   +3.118667106342918e-01   -3.449850610721897e-01   +3.184005146623718e-01   +6.731029312182312e-01; +4.832875881110784e-01   +5.549404830248623e-01   +3.704678235242537e-01   +3.404033348059017e-01   +4.219914897379410e-01   -1.087255568836640e-01   -4.680062552317844e-02   +9.624594974575675e-02   +7.266373469419309e-01   +5.713997846123742e-02   +5.223572531140521e-01   +3.684074224623685e-02; +5.851541459710907e-01   -1.398794521486843e-02   +1.943071325097545e-02   +5.519776044020409e-01   +6.369589096666520e-02   +4.443103428049173e-01   +4.049100416719384e-01   +2.484308585261764e-01   +3.786222695425731e-01   +5.616613502786333e-01   +1.802959748952935e-01   +2.616540789304433e-01; -2.773949711368047e-01   +1.160477352813872e-01   -3.590832085731924e-02   +9.592080330489819e-01   +6.351975435313125e-01   +4.446379549825920e-01   +2.946858014597049e-01   +7.171929293121655e-01   +3.187124042125412e-01   +3.894348227552665e-01   +4.961694804459254e-01   -5.174201298926170e-02; +5.805754143757128e-01   +5.903505422249923e-01   +1.350093726129991e-01   +7.930613776060009e-01   +8.205471552518093e-02   +3.833566842698991e-01   +2.549903371918785e-01   +1.137580836274898e-01   +2.019550852998113e-01   +6.503519226898799e-02   +1.151013600523104e-02   +6.042614570968539e-01; +7.894023497291870e-01   -1.783371620666719e-01   +4.935033443348791e-02   +5.997519688120379e-01   +5.037234791013643e-01   +6.921790595511342e-01   +2.089650025614218e-01   +1.359399895307755e-01   +5.803928429517561e-01   +5.446592726940057e-01   +7.866941928412056e-02   -4.150134249926565e-02; -2.627218539980658e-02   -1.233123933441633e-01   +2.400310517437237e-01   +4.974493867726743e-01   +4.446880734860845e-01   +1.983929707320969e-02   +6.183924687039605e-01   -9.820394207333165e-02   +6.408020807646080e-01   +3.315726244881360e-01   +1.949661067109601e-01   +2.874746341240469e-01; +3.434389228451314e-01   +8.801485078231323e-01   +7.233197724147835e-01   +4.202061821221391e-01   -8.016769906169285e-02   +3.972763175258393e-01   +5.776591940774375e-01   +4.684852962347174e-01   +8.060815182075662e-01   -3.628724894940371e-01   +9.338773089232814e-01   +1.263324531485092e-01];
L3I_L2I_iGABA_netcon = [-3.035906401212440e-01   +5.077096041756387e-01   -2.308250058029427e-01   +2.950377062790096e-01   +8.101133076756983e-02   +3.128672928167712e-01   +8.458388232906203e-01   +3.518182637300204e-01   +1.327659429085223e-01   +1.686920849614179e-01   +2.612642266603277e-01   +2.040914664633939e-01; +6.012275205752584e-01   -1.030545751273926e-01   +3.033332748683745e-01   +6.357205616132182e-01   +3.025794733274955e-01   +1.947792657360465e-01   +6.245818934296058e-01   +6.475498147832665e-01   +2.207574177816240e-01   +3.444616506425599e-02   +7.262802522011305e-01   +5.869219191658278e-01; +5.205867172630186e-01   +1.263195425744602e-01   -3.985763206664700e-02   +5.902733727518665e-01   +7.561578677690456e-01   +3.629367114866903e-01   +3.755076397200706e-01   +2.931700047815080e-01   -4.232091513683155e-02   +2.604308452733316e-01   +8.545941074481679e-01   +4.921382203412387e-01; +4.283595095242500e-01   +6.960585450257955e-03   +6.302033998754581e-01   +2.468973220215857e-02   +4.572967822105876e-01   -1.005246055037540e-01   -1.250896563882295e-02   -1.410580072156391e-01   +3.763851530995359e-01   +2.068211644302021e-01   +2.983577970901318e-01   +3.932234112115306e-01; +5.756299272943163e-01   +5.742431752762513e-01   +4.224067160197501e-01   -1.235741762972632e-01   +1.776097513736587e-01   -8.419536202351821e-02   -6.037365687741246e-02   +4.097456684756012e-02   +5.829655690381058e-01   +3.317709107244209e-01   +8.944675495636428e-01   +8.194233856105749e-03; +6.782470746396507e-01   +7.163593410920540e-01   -1.037038722147017e-01   +2.298170569687394e-01   +4.787050155286783e-01   +1.000000000000000e+00   +1.413804597313370e-01   +2.197329363992712e-01   +4.383613453133242e-01   +1.412805915931868e-02   +2.210294683685040e-01   +5.438038244697331e-01; +5.562445275845372e-01   -7.984428515369060e-02   -1.460519182041111e-01   +4.428553817426459e-01   +6.031533986683272e-01   +1.785929763817981e-01   +3.621513353445436e-01   +2.953142054740246e-01   -3.736386160848620e-02   +4.426582615753842e-01   +3.278378882361543e-01   +4.029898846430083e-01; +5.354718939002197e-01   +5.128930742944375e-01   +3.733749434330046e-01   +2.580648247692329e-01   +5.606680771671318e-02   +3.818321031411601e-01   -9.753956080061080e-02   -7.165204242559679e-02   +4.114340272847302e-02   +7.374604425037341e-01   +6.078693865344499e-01   +4.582492716998183e-01];
L2E_L3E_iAMPA_netcon = [+6.379852151392302e-01   -2.019572586254270e-01   +2.631761819689538e-01   -3.000208861159841e-01   -1.596719187204249e-01   +4.158914798095578e-01   +3.774847383109341e-01   +2.889347832650179e-01; -1.966876636430739e-01   +3.496673324585333e-01   -4.563089571590439e-02   +5.735737527847462e-01   +7.449489718908362e-01   +4.243069678074232e-01   +8.155430236167326e-01   +3.412766000517475e-01; +1.695689416757953e-02   +1.434618337676640e-01   +4.537030435491093e-01   -1.036413905346838e-01   +6.179899563982973e-01   +6.271732368286655e-01   +2.257239740720920e-01   +5.465820886854111e-01; +6.191225891743003e-01   +4.426322951008876e-01   +2.384360819734549e-01   +7.431404035477958e-01   +5.087955974810097e-01   +1.485823613055339e-01   +2.477260861979483e-01   -1.160868743557967e-01; +2.845935333927119e-01   +3.349212469299250e-01   +7.974171595486137e-01   +6.360543655003054e-01   -3.616073977227193e-01   +2.978481481581024e-02   +1.160332912198843e-01   +5.628790920484442e-01; +2.132691143898556e-01   +6.842771360393550e-01   +4.476302193000728e-01   +6.189356222845832e-01   +7.537274869670140e-01   +4.437444143895398e-01   +2.261144523239146e-01   -1.826221985481461e-01; -1.336011336794556e-01   +1.411830885090094e-01   +5.787291466335817e-01   +5.681796987921002e-01   +3.974949343343284e-01   -9.358775988320175e-02   +2.690719928752422e-01   +3.958644628108131e-01; +4.343912294981490e-01   +3.672779756375518e-01   +1.000000000000000e+00   -3.406515311276055e-01   +2.627286138022204e-01   +6.433399189662793e-02   -1.254502863378179e-01   +4.532299740214688e-01; +4.032594370082784e-01   -2.570629107574556e-01   +2.360049042948348e-01   +1.551458673687293e-01   +1.353155165857222e-01   +2.130882621594104e-01   +1.007972041218692e-02   +9.476434546723976e-03; +5.889621799149406e-01   +8.063179134048761e-01   +4.944388782971751e-01   +2.881527077228904e-01   +3.671848196584721e-01   +4.745129359353900e-01   +6.001331471284188e-01   +1.537345394693942e-01; +4.861717124108043e-01   +2.294199491558911e-01   +3.831539552292283e-01   +6.239515279693914e-01   -1.127693000628641e-01   +8.147300093206812e-01   +2.347294087921127e-01   +2.985595904051398e-01; +1.678087827109462e-01   +4.013178515117848e-02   +7.764412084485608e-01   +3.046476131874936e-01   +5.126199434894164e-01   +4.601376613548486e-02   -1.878437679920615e-01   +6.764056056368910e-01];
L2I_L3I_iGABA_netcon = [+4.592316610711497e-01   +4.083310428319866e-01   +5.407240904390181e-01   +4.272608868673970e-01   +2.805055681844765e-01   -1.662247372572865e-01   +2.818950994149669e-01   +6.148676227188252e-01; +8.075017447665564e-02   -1.890386509335986e-01   +6.615619511211943e-02   +3.469283669971067e-01   +4.158994273943827e-01   +6.388003800039539e-01   +5.846678322843646e-02   +5.198186948081381e-01; +4.407783611298379e-01   -1.387111039689299e-01   +1.264398001967166e-01   +5.547868379326952e-01   +6.228738405431462e-01   +3.773851958541191e-01   +9.517957906115484e-01   +2.684913339426319e-01; -1.174707484679580e-02   +1.757354654159227e-01   +1.631044196373531e-01   +2.606260488371643e-01   +1.497470482793090e-01   +3.360190427653308e-01   +8.079259719231926e-01   -1.644998787248236e-01; +5.448946306058582e-01   +1.411521373367128e-01   +5.636262606126399e-01   +2.317632050083976e-01   +7.095743458855810e-01   +3.441548093236165e-01   +6.689915740865140e-01   +7.171816496127023e-02; +1.389258763438151e-01   -1.043811851196695e-01   +6.016984218841859e-01   -1.419054240944126e-01   +5.875634482380127e-01   +2.566506462855176e-01   +5.274426610315951e-01   +5.720636449822830e-01; +4.025378549741447e-01   +6.058610907920564e-02   +3.608668930247411e-01   +1.522670363267401e-01   +9.847252023042896e-02   +3.322708486765237e-01   -8.761860604610913e-02   +2.352067085222763e-01; +3.173888320089080e-01   +7.693945259393531e-01   -1.632414786992478e-02   +5.350838812187457e-01   +3.793727723260077e-01   +3.271979805928922e-01   +5.128996057541590e-01   +6.529787240811313e-01; +1.284766936773129e-01   -5.306328339873195e-02   +2.397424078487403e-01   +5.218795882715525e-01   +6.870949577491159e-02   +1.186716608478216e-01   +5.985024531851489e-01   +2.484743078285845e-01; +5.310791096490454e-01   +5.197967086875793e-01   +9.746627665921187e-01   +6.327474874052772e-01   +4.944404135704131e-01   -3.069095041462180e-02   +5.253836184982236e-01   +5.968666234821861e-01; +4.327165756046711e-01   +4.693064122272279e-01   +1.637474474877768e-01   +5.379675846768938e-01   +6.202921679340089e-01   +1.662302413524956e-01   +3.270782372421501e-01   +5.699904228558145e-01; +2.568713659584744e-01   -6.176216987121373e-02   -1.364380046390271e-02   +3.694359823648776e-01   +1.547272493997629e-01   +5.421983171276783e-01   +5.315003849291746e-01   +5.341776451337423e-01];
L3I_L3E_iAMPA_netcon = [+2.832467957762495e-01   +1.934682235391378e-01   +9.540312003197633e-01   +2.984543013020117e-01   +1.050270214584607e-01   +4.999582155813966e-01   +2.580051486422180e-01   +3.408300626494257e-02   +3.418503933888979e-01   +3.630511256110607e-01   +7.088468212705294e-01   +2.457277938346709e-01; +9.835183644272483e-01   -2.794340624785244e-01   +4.018584931187650e-01   +9.833987725699304e-01   -2.310573839136665e-02   +4.241617091208546e-02   +7.325714451471572e-01   +9.685232493905446e-01   +3.681913604914530e-01   +1.013141964601575e-01   +2.228261483765681e-01   -5.184177177651061e-02; +9.611713576817830e-01   +4.939776847410013e-01   -1.955836090233238e-01   +2.657313006063428e-01   +2.849514754996583e-01   +7.126350491563826e-01   +7.849615286297607e-02   +3.113766965641420e-01   +3.128582623403584e-01   -3.192030835987163e-02   +5.149963944784108e-01   +4.488150396790637e-01; +4.126639011994598e-01   +1.373177405833340e-01   +3.617198699196011e-01   +3.805870008959361e-01   +4.020542009170060e-01   +4.418625156670332e-01   +7.899380859324523e-01   +3.150361031229163e-01   +5.648572295116828e-01   -2.671894756017625e-01   +1.808546879175510e-01   +2.400507832898552e-01; +5.684336831469038e-01   +1.570784169636603e-01   +6.772192449805378e-01   +2.543984787392759e-01   +1.654641643410313e-01   +7.681511709741780e-01   +1.656619985456654e-01   +4.052483481507516e-01   +6.393052961506963e-01   +7.664484689678434e-01   +3.253630224270351e-01   +8.318989980908527e-01; +5.474548515480108e-01   +1.338945846792944e-01   +4.156184597018412e-01   +1.694064022441288e-01   +6.974492480309182e-01   -9.705294999382315e-02   +4.534912874817608e-01   +1.747429950118809e-02   -4.492290886013953e-02   +2.296094483477305e-01   +2.797300853429072e-01   +2.485452554327617e-01; +2.659470278181461e-01   -1.877461728563120e-01   -5.839515386404014e-02   +4.925487313815755e-01   -1.095203611811808e-01   +1.322908307082819e-01   +4.733607148972910e-01   +5.647208718981671e-01   +2.422665934378962e-01   +3.152074140732111e-01   +7.309284256710120e-01   +4.585480118199874e-01; +1.912271465635828e-01   +4.238757205516739e-01   +4.379823796847783e-01   -1.275682493157987e-01   +2.646147987708232e-01   +8.694091008624596e-01   +2.976052736448441e-01   +3.659098393686154e-01   +4.260336245963495e-01   +1.521710593380660e-02   +6.742458550572805e-02   +5.229067798370194e-01; +3.509784272081718e-01   +3.787844177540537e-01   -2.535828411754273e-02   +1.443743027608142e-01   +6.767609638878136e-02   +4.022947253842430e-01   +7.264645947258860e-01   -5.972013136514556e-02   -1.802411160271824e-01   +6.785726135642967e-02   +5.297783372702036e-01   +1.680699966230184e-01; +4.919243144168581e-01   +3.705430682778071e-01   +3.547387888156950e-01   +3.158341156132753e-01   -2.453301207260455e-01   +9.638506187753366e-02   +6.051626282645169e-01   -2.131840428818215e-01   -3.530695276980886e-02   +7.172929121455867e-01   +3.474712356331718e-01   +5.656230303711439e-02; +5.504085698803112e-01   +4.069081702928149e-01   +6.967608103658865e-02   +4.429794216911169e-01   +2.157225560103714e-01   +4.071523467028226e-01   +6.849887968133919e-03   +7.059798243935046e-01   +3.958642137764697e-01   +3.707976004388228e-01   -1.165699509359717e-01   +3.592496860032152e-01; +5.727187940179662e-02   +2.036385163090459e-01   -1.295065436272582e-01   +2.676487791633663e-01   +3.738017245373578e-01   +8.568779463474243e-01   +3.397762718666796e-01   +5.234484521531970e-01   -2.662360544615222e-01   +3.947801557493911e-01   -6.838055388335522e-02   +6.289194852932705e-01];
L3E_L3I_iGABA_netcon = [+1.657574524524655e-01   +3.108052065049363e-01   -1.286599346278526e-01   -2.831114728867440e-01   +4.257920865669191e-01   -9.794663621460049e-02   +7.783694890842049e-01   +1.647091031031612e-01   +2.664247185941834e-01   +1.477977575812984e-01   +6.214265659744442e-01   +4.516015405333830e-01; +1.600343227297467e-01   +5.796603468055060e-01   +3.064154514654454e-01   +6.107834018174420e-01   -3.057591568567863e-02   +3.499405703864528e-02   +5.523558014920571e-01   +2.781445001342816e-01   -1.178513319900847e-01   +2.134171014955519e-01   +1.886470317023106e-01   +2.448680316196333e-01; +1.252152893420840e-01   +1.559099729944435e-01   +6.814575486771552e-01   +3.294303775754004e-01   +4.646259822306972e-01   +1.981844052918044e-01   +8.374660234719185e-01   +5.253914412670738e-01   +1.928271069500805e-01   +4.140451137499554e-02   +4.327966229888205e-01   +3.346813093340086e-01; -1.116799807303972e-01   +4.548212884577613e-02   +3.231274142930016e-02   +3.022902950242573e-01   -1.026507574722297e-01   +3.958244484470255e-03   +5.553936717432346e-01   +6.500855103735973e-01   +5.569958367390908e-01   +2.247276650199263e-01   +3.770172941821955e-01   +1.697909887948032e-01; +8.068294217868655e-01   +6.673593643528504e-01   +2.033126270773069e-01   -2.777427629477284e-01   +1.306680382153567e-01   +3.498569614053746e-01   +7.421313187769449e-01   +9.868752022385610e-02   +1.146608245952940e-01   +1.313898528167016e-01   -1.951125360738218e-02   -9.508572589911474e-02; +6.742791279983706e-01   -3.388111233317100e-01   +1.998513447128147e-01   +1.674449453233289e-01   +2.165164092100716e-01   +2.224886850522622e-01   -2.134171023963113e-01   +2.661873531147503e-01   +2.130246730704394e-01   +7.447373247934522e-01   -2.135420325605794e-01   +5.361371917285752e-01; +5.203363019590828e-01   +2.604716452658659e-02   +6.181820089196955e-01   +3.703065804930724e-01   +2.862407192118660e-02   +2.046797724134990e-01   +3.905749632824776e-01   +6.207540305380321e-01   +1.730773209308587e-01   +9.465924058127958e-01   +5.213946092046920e-02   -8.847116244450862e-02; -3.262349426974906e-01   +2.715394466179180e-01   +5.057786073964377e-01   +4.801301863381084e-01   +3.900909996754163e-01   +4.155430793715654e-01   +8.371746033080389e-01   +1.072912186906443e-01   -1.379572622317139e-01   +4.317925159176663e-02   +8.156592322657968e-02   +6.910089365457801e-01; +7.536589242183602e-01   +3.054880131264645e-02   +4.835751155511572e-01   +6.025389613999412e-01   +1.052895014636047e-01   +4.431856061818028e-01   +1.987385871631122e-01   +5.808286179723560e-01   -8.276560706934336e-02   +2.538678769371207e-01   +8.007836738860019e-02   +5.329127154569149e-01; -3.747904249485448e-02   +6.414961450144878e-02   +4.267412135596428e-01   +6.196252893781411e-01   +2.345287977632984e-01   -1.512743759881068e-01   -1.147082383595085e-01   +7.475377783056641e-01   -1.119439072727604e-01   +3.423328730005425e-01   +3.111680460975876e-01   +3.745452139135363e-01; +6.778477933082196e-01   +5.609607292085390e-01   +3.707691669779642e-01   +7.035376734782774e-01   +3.312436693256293e-01   +2.836479919806992e-01   +5.520188487305607e-01   +4.849293538431641e-01   +4.346881841347430e-01   -1.438811780729128e-01   +4.198177136392778e-01   +7.158780079660648e-01; +5.525637232569708e-01   +6.413924201325555e-01   +7.069377458959887e-01   -1.023816265092822e-01   -6.012302992121947e-02   +3.674378706595227e-01   +1.295608934632179e-01   +1.723673843367224e-01   +1.515932222596555e-01   +6.952517781586369e-01   +5.625894436875281e-01   -1.091124254085637e-01];
L2E_Input1_iAMPA_netcon = [+1.202379992522698e-01   +3.217532591815574e-01   +3.989309524059724e-01   -5.711678220149641e-02   +7.008553206578136e-01   +3.009000431686654e-01   +9.245037356597203e-01   +3.914121181607562e-01];
L2I_Input2_iAMPA_netcon = [+3.029091651121817e-01   +6.987481909622731e-01   +8.967562828651721e-01   +3.056455573807160e-01   +5.969091359126012e-01   -5.417619719377148e-02   +2.218688431885665e-01   +1.365867920192531e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  33.63 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -60*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
