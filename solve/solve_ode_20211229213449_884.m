function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.746148765657924e-01   +8.991370740316798e-02   +3.937760082231416e-01   +2.357850908774608e-01   +2.478244661734805e-01   +2.486750609043127e-01   +2.967238359334134e-02   +6.766541172058957e-01   +1.218133558964453e-01   +1.488321966561434e-01   +2.328758078257384e-01   -7.285013877374319e-04   +2.269253158940250e-01   +1.179900289584677e-01   +2.500989998471368e-01   +5.263808221452255e-01; +2.579938545308583e-01   +4.315029173556251e-01   +4.596000274918260e-01   +8.341880692913606e-02   +3.773688786274336e-01   +5.232435209918437e-01   +8.747652134455239e-01   +8.640410956634588e-01   +1.111408652450400e-01   +2.308816799400426e-01   +5.187832185556590e-01   +5.450179709934662e-01   +2.014359241972129e-01   +1.667240714882918e-01   +5.370033168323211e-01   +2.757571340371784e-01; +4.045066281999131e-01   +3.944910423879907e-01   +6.405233973958523e-01   +4.797591579946537e-01   +1.206649575519800e-01   +6.391441668009128e-01   +6.771016410359297e-01   +4.523029845324528e-01   +3.795936778919824e-01   +2.219700507299411e-01   +7.275468770436843e-01   -5.334582293990395e-03   +6.426514949490660e-01   +6.496323200651344e-01   +3.848076902304038e-01   +6.467099892661199e-01; +3.570816727387927e-01   +4.784895447039171e-01   +3.809686807779643e-01   +8.331668409781559e-01   +3.470834506381144e-03   +2.274673108797845e-02   +3.408346856419757e-01   +3.049571612267078e-01   +7.449603094666783e-01   +4.054841543004092e-01   -6.023495654549135e-03   +2.436786978531823e-01   +3.000833381675686e-01   +3.178872732796693e-02   +5.468352916539938e-01   +1.495924708667994e-01; -1.289732131388736e-01   +1.863260900855322e-01   +1.184098714598531e-01   +4.072621600556251e-01   +1.169916337155643e-01   +2.985509516001131e-01   -1.853742584839990e-02   +5.231464653511798e-01   -5.631300724303050e-03   +5.810371333442075e-01   +6.906321625921519e-01   +1.209694539933825e-01   +3.328742876370182e-01   +6.157245101483049e-01   +8.676183726274329e-01   +6.384305409177714e-01; +8.446838535389782e-01   +1.972647821908653e-01   +5.255960672470259e-01   +5.042159830352096e-01   +6.469860468712467e-01   +7.253572285280129e-01   +6.485599827076435e-01   +8.942837114748865e-02   +4.393507766362793e-01   +5.006954457038698e-01   +7.087763368388331e-01   +1.538685915081991e-02   +1.420039527862745e-01   +7.534970342736402e-01   +8.202827821202079e-01   +5.601889884171390e-01; +4.432529772135017e-01   +1.142823576642843e-01   +2.964884946439202e-01   +5.449157095038073e-01   +3.662767949818055e-01   +4.986858090996886e-01   +6.893646209386919e-01   +6.978623854915600e-01   +3.477264526677570e-01   -1.754413580228116e-02   +8.338182606847352e-02   +7.282038979860588e-01   +4.025908950092589e-01   +2.098387654848985e-02   +9.989547562967227e-02   +5.836173185123887e-01; +4.225083064934340e-01   +3.731698341529945e-01   -7.739041509933697e-02   +5.127029442060473e-01   +3.879092493702206e-01   +1.803789404973641e-01   +2.808459626949406e-02   +3.533371990052133e-01   -3.652851449731628e-02   +7.077908377745559e-01   +4.361373723121363e-01   +3.659422085520346e-01   +6.495756412440801e-01   +5.075867474675126e-01   +1.268326425808163e-01   +5.678484246593195e-01; +2.340628905965926e-01   +7.583758275349614e-01   +2.226718714177755e-01   +4.248408536828252e-01   +8.666314301777693e-01   +5.637805299283634e-01   +6.402864487850318e-01   +4.111056561014250e-01   +1.898862554622273e-01   +6.528927744706972e-01   +4.661291917352703e-01   +8.189758997488222e-01   +6.317967153996983e-01   +1.517160834935696e-01   +7.309532290002602e-01   +5.712464762665658e-01; +2.224977094089783e-01   +2.629823114065858e-01   -1.915115588301576e-02   -4.658964129904331e-02   +1.806720808877340e-01   +5.886127453047599e-01   +4.792622176777990e-02   +1.094448564312217e-01   +5.621760067263494e-01   +5.316994119977101e-01   +3.638182967476318e-01   +5.207947512118027e-01   +6.736272695240751e-01   +3.389960990514001e-01   +6.071273170828685e-02   +5.285144281144593e-01; +6.606343967472300e-01   +3.851296559712566e-01   +3.537492090236906e-03   +7.492186432714010e-01   +2.328478960404359e-01   +2.968632682148072e-01   +3.113815303815325e-02   +7.498377182150925e-01   +4.534931031802270e-01   +7.286020749144693e-02   +4.869379549690868e-01   +1.018045698564954e-01   +9.532375678507683e-02   +2.441801356490053e-01   +1.166903066046990e-01   +2.262462766743074e-01; +2.753463350038714e-01   +1.351195470097911e-01   +3.368342716931310e-01   +2.540345654263715e-01   +2.584887442712985e-01   +6.092030868878563e-02   +4.361985831270856e-02   +6.060518374851840e-01   +6.331516976816481e-01   +1.751538070228510e-01   +3.017135201893004e-01   +3.805975370242571e-01   +6.690045782557580e-01   +1.838542873679171e-01   +2.190619370962880e-01   +1.919095715170818e-01; +3.213197354075374e-01   +7.425243397526761e-02   +3.074175384341675e-01   +1.296247841873041e-02   -8.233922634907277e-02   +1.810095232517334e-01   -1.038848847116553e-01   +7.031921846345033e-01   +6.571325691750747e-01   -1.020734171359684e-01   +1.391847164265318e-01   +2.938073535324067e-01   +6.367640655374500e-01   +3.769377047137386e-01   +3.799231277286880e-02   +6.177133747049126e-01; +1.680492938379962e-01   +8.869325608007772e-01   +6.651115913852145e-01   +4.581371285468382e-01   +2.079475373845235e-01   +5.765792125509448e-01   +4.124651836582048e-01   +8.431940407675864e-01   +5.608842469469345e-01   +7.115663741730722e-01   +7.783682473610534e-01   +4.628249955011325e-01   +6.701803518605818e-01   +2.202139024596703e-01   +6.479369750218652e-01   +6.366776515399224e-02; +5.043644094505664e-01   +7.061592129833286e-01   +3.319934405714721e-01   +7.420336341199051e-01   +9.067043659289000e-01   +6.605331891504596e-02   +9.055426912061116e-01   +1.763317960303107e-01   -5.454865203587202e-02   +4.688079710537890e-01   +2.107175892184182e-01   +1.053516838685092e-01   +3.357272459710250e-01   +5.459499191244136e-01   +3.307697690465096e-01   +5.813225600990126e-01; +4.443615533641521e-02   +5.888676181744538e-01   +2.804521325216312e-01   +7.131676644658203e-02   +2.309279486934706e-01   +7.597577593825091e-01   +1.872443983177296e-01   +5.170457984067545e-01   +1.424703512205593e-01   +5.855980649818791e-01   +3.892421625727560e-01   +6.686857154076764e-01   +6.536838505670581e-01   +5.816571301781749e-01   +3.038952942563542e-02   +5.816145153956400e-01];
L1E_L1I_iGABA_netcon = [+6.352119564935461e-01   +1.590795249864274e-02   +2.586125912894987e-01   +4.369879426873237e-01   +1.579348312250166e-01   +2.534775818230512e-01   +3.838342746604658e-01   +9.222944491091264e-02   +3.293926271615799e-02   +5.580267540684732e-01   +3.661868125481098e-01   -8.830317406610996e-02   +6.398930974375195e-01   +5.480891619163137e-01   +7.168184638504221e-01   +3.493434616785188e-01; +3.036682617656060e-01   +6.620047945797566e-01   +1.873531944047411e-01   +3.573371279484208e-01   +9.514485597951533e-02   +2.667222765694578e-01   +6.891130601589288e-01   +3.804363676141652e-01   +5.132854670682041e-01   +1.888513978210191e-01   +1.777110847700558e-01   +2.466500155083145e-01   +3.657690962134358e-01   +7.754844095002239e-01   +2.264700779922957e-01   +6.627060917477852e-01; +4.652234202329251e-01   +6.970013723085698e-01   +5.627774779722818e-01   +1.454555999318211e-01   +7.778499576831792e-02   +2.463473665375621e-01   -6.287592467040479e-02   +1.515324134764844e-01   +4.886022036482663e-01   +9.321731249093893e-02   +3.144516514453082e-02   -1.086816567916809e-01   +5.682491818819784e-01   +8.375502961998488e-02   +3.731936184206983e-01   +1.073728899959846e-01; +6.658604987328227e-01   +3.968195246351597e-01   +5.222517172103085e-01   +3.976785270642526e-01   +5.405764717684374e-01   +1.576112431998742e-01   +6.339157087724713e-01   +4.545194166447367e-01   +6.746395465148890e-02   +4.500352667910208e-01   +9.286122512993908e-02   +1.958373725508469e-01   +5.843605127923795e-01   +1.936910360092228e-01   +3.670140305507683e-01   +4.010596528018333e-01; -9.630995078464574e-02   +7.858314154051074e-01   +5.431704418687683e-01   +2.497247623901211e-01   +9.372827126950101e-02   +8.242562438583829e-01   +8.105335098560043e-01   +3.237531077691327e-01   +1.453496074245972e-02   +4.215439771952938e-01   +6.768979567107498e-01   +3.191423339850354e-01   -1.138766171312381e-01   +6.232239979844614e-01   +1.548007105587005e-01   +1.004643754766543e-01; +3.371561497250717e-01   +5.474072702676167e-01   +5.428478199709436e-01   -1.178760884634892e-01   -2.973524493330854e-02   -5.467237115905137e-02   +4.450577453336765e-01   +3.044027588972633e-01   +6.696233337759300e-01   +6.326771003017559e-01   +2.462088160081342e-01   +5.822528372635634e-01   +6.769401858933983e-01   +5.174281269118199e-01   +2.518964107106124e-02   +3.453694276540009e-01; +4.798398405700493e-01   +3.277538436061687e-01   +7.524204291243498e-01   +1.120593483345808e-01   +7.047389307649111e-01   +1.511960402788690e-01   -2.614012373664354e-02   +2.366406603631879e-01   +3.165012697043635e-01   +2.572917277774816e-01   +3.015852261594351e-02   +3.285540768120729e-01   +8.098068270480286e-01   +7.122087854530440e-01   -6.826590007339747e-02   +6.907319151111495e-01; +6.316460965047042e-01   +4.537844027892280e-01   +2.904596120448532e-01   +3.054344766249387e-01   +8.712056190108404e-01   +6.656537887097655e-01   +5.634529395523417e-01   +8.489820586606073e-01   +4.493864042409131e-01   +6.905410651703267e-01   +4.183323702598792e-01   +2.811846991620621e-01   +3.738509079871722e-01   +5.222956508964777e-02   -7.602550369572889e-02   +7.638963214525215e-01; +5.473970898370593e-01   +6.846103023055321e-01   +6.460927809203629e-01   +5.963903959067116e-01   +1.501914291700621e-01   +3.135306309734849e-01   +5.092703558468867e-01   +3.335065134120065e-01   +6.297429013212898e-01   +6.309170795011465e-01   +2.904124855976624e-01   +4.499939749957458e-01   +6.013833108019635e-01   +8.816748533290081e-02   +6.812312614409213e-01   +4.546805780375612e-01; +2.579545142313625e-01   +5.613216083716941e-01   +3.477727284389630e-01   +1.253707651334757e-01   +4.279394079561716e-01   +5.775352875868441e-01   +7.648561798649181e-01   +2.988148767695897e-01   +3.650417400192080e-01   +2.016348718393610e-01   +6.051977408417043e-01   +2.345233848716379e-01   +5.567221087394583e-01   +1.105693002150552e-01   -9.092675652390109e-03   +7.078490419846675e-01; +4.888225684676989e-01   +5.345785687198400e-01   +5.039530860278014e-01   +1.504721882313807e-01   +2.089849092472321e-01   +6.308280463511815e-01   +2.073185012740732e-01   +4.090289519083835e-01   +3.053156056330638e-01   +6.157315991305657e-01   +7.564492347415734e-01   +2.586723838669128e-01   +4.933355003019299e-01   +9.570568058984492e-02   +6.686741729761633e-01   +4.630067648948939e-01; +1.825120727092104e-01   +2.949286717501143e-01   +4.284818215119761e-01   +2.050691682173884e-01   +5.885031515173219e-01   +3.037628777206842e-01   +2.346268735970951e-01   +1.489901525567605e-01   +4.457791494760638e-01   +3.678956059895060e-01   +8.800302826547072e-01   +4.731751741956912e-01   +3.061612213111726e-01   +3.209610785545357e-01   +3.432410948100769e-01   -6.890013837683087e-02; +1.829767557138373e-01   +3.639536093802576e-01   +3.850366308440628e-01   +1.768591630252973e-01   +1.322422553050828e-01   +1.574673452756381e-01   +3.844176542106005e-01   +8.034762116281003e-01   +2.366364483984432e-01   +4.268320861166551e-01   +6.746627721830516e-01   +5.220564722613454e-01   +1.708720618850244e-01   +5.628716646389206e-01   +5.554612421779024e-01   +1.764353571711016e-01; +7.000624089601844e-02   +2.626906118605838e-01   +2.771265613241031e-01   +5.701019721029843e-01   +3.970247474345774e-01   +6.051569955348238e-01   -8.076111545554258e-02   +3.906078054073818e-02   +1.127657277863431e-03   +3.199085949813304e-01   +4.804920793467023e-01   +3.458818508437346e-01   +1.175214603977610e-01   +3.887504454461702e-01   +9.267401943277647e-01   +6.413075237323496e-01; +9.674356633874916e-02   +6.556124431654550e-01   +1.546367261549115e-01   +5.181641950795537e-01   +6.713825182326861e-01   +7.315166464148286e-01   +5.426829584924479e-01   +4.219326915374309e-02   +6.802221152542072e-01   +1.001157984757452e-01   +3.475069030845108e-01   +3.498601798605416e-02   +3.430814473322780e-01   +4.402557612041716e-01   +5.151444790267852e-01   +3.026051603337251e-01; +5.040266705213616e-01   +4.351170548654542e-01   +3.232407798924471e-01   +4.138462437601025e-01   +4.975039867158363e-01   +2.924853897120245e-01   -5.499903662789511e-02   +5.659711877149133e-01   +7.569209491848278e-01   +1.171709976204380e-01   +2.354001098444326e-01   +1.774526165127193e-01   +3.208192060307175e-01   +3.589289153363968e-01   +3.691420614197673e-01   +5.753998534120982e-01];
L2I_L1I_iGABA_netcon = [+6.185283016259466e-01   +7.891740269650804e-01   +4.131384892240305e-01   +5.303062383046507e-01   +1.418067649893033e-01   +2.472631404598004e-01   +3.350216694060034e-01   +2.522684323880675e-01; +5.921994455594705e-01   +4.961853261446929e-01   +2.350637721746675e-01   +4.910395439369788e-01   +5.646728868836658e-01   +3.444309189348614e-01   +5.690322383117087e-01   +4.947550735338576e-01; +2.012975625166878e-01   +1.497929649748976e-01   +5.518164693692493e-01   +5.837225302212399e-01   +1.620530037850934e-01   +2.933190206327851e-01   +3.438053015106132e-01   +6.101878228938007e-01; +1.940082664085024e-01   +3.785714135833043e-01   +5.711702983895757e-01   +2.523854479577590e-01   +3.499388071000084e-01   +5.500445555239718e-01   +1.468544062874840e-01   -4.812600880690816e-02; +6.718068604011239e-01   +7.304850101485637e-01   -6.535754672694083e-02   -6.762089119500173e-02   +9.680600832997938e-02   +4.662874046466983e-01   +3.108584412439567e-01   +3.149957106752417e-01; +4.833610265120217e-01   +4.811458260964667e-01   +5.948216567854094e-01   +2.366866321350448e-01   +5.135981451678249e-01   +4.669620607343325e-01   +3.577216972934619e-01   +4.563536483822894e-01; +2.381672815693258e-01   +8.239014524424054e-02   +6.048727904347939e-01   +1.976768052098055e-01   +1.534055989139173e-01   +4.246491832467645e-01   +5.811974315316438e-01   -6.430699100558253e-02; +5.199895478633125e-01   -3.504341792483148e-02   +5.111333121112815e-01   +5.219771983187629e-01   +7.255517648605184e-01   +1.813241244474536e-01   +8.937683241142100e-02   +2.130513945349909e-01; +1.272985517268321e-02   +3.446819271473968e-01   +7.839849185254580e-01   -2.197033244226045e-02   +5.766293692728816e-01   +6.874857184252234e-01   -2.924709940028011e-02   +2.410768051734377e-02; +2.709118500705225e-01   +4.331574200521967e-01   +7.071379705462322e-01   +8.237400165288827e-01   +7.901648609394666e-01   +5.948160543171646e-01   +8.467035137325888e-01   +8.062798230779256e-01; +1.590060650061165e-01   +3.076958079232148e-02   +7.774642707041417e-01   +8.031307320185360e-01   +6.950520500021281e-01   +2.392366521068873e-01   +7.871972027583128e-01   +5.209481224233505e-01; +5.246383255313007e-01   +4.170214029261327e-01   +4.579464201982290e-01   +3.166158292839106e-01   +7.837931184379500e-01   +5.683145305384821e-01   +4.196670422054476e-01   +2.789403272390109e-01; +3.312018598473312e-01   -1.079944101186702e-01   +7.562110377287672e-01   +6.847829689665804e-01   +1.537235613720883e-01   -1.601378267250498e-02   +6.670584987308251e-02   +1.190241414596710e-02; +2.458318298919037e-01   +4.396962323968931e-01   +5.460742563757287e-01   +5.542498047074881e-02   +3.932830959253149e-01   +4.385653273854367e-01   +2.464773015490931e-01   +4.254299671572276e-01; +8.318999936091033e-01   +7.408034042912056e-01   +2.433026497117222e-01   +2.476372746078019e-01   +2.210698730002628e-01   +2.694598943235960e-01   +5.967438039973116e-01   +1.144358478014055e-01; +7.319866357693725e-01   +4.351171461671360e-01   +1.162875144248405e-01   +7.991079974240227e-02   +4.813789132583287e-01   +2.374825514236479e-02   +1.554623985014077e-01   +3.641910639669296e-01];
L1I_L2I_iGABA_netcon = [+4.107702578502954e-01   +3.741272359705566e-01   +2.199887634687458e-01   +7.923185902430585e-01   +7.639033799329831e-01   +7.925090788075430e-01   +6.366485118057150e-01   +3.298402049481794e-01   +6.867550570887131e-01   -8.336547962110165e-02   +6.238406537398586e-01   +3.499339467162069e-01   +8.465999016008126e-01   +6.134547031145718e-01   +1.813079457429840e-01   +5.949191373982055e-01; +4.288191525269852e-01   +6.683638908542957e-01   +3.512908769296665e-01   +8.254779730717549e-01   +5.657753472272978e-01   +3.928233216167543e-01   +9.955686597511695e-02   +3.640582989190022e-01   +7.347723414779100e-01   +3.072901561331695e-01   +5.465311097314887e-01   +1.803511369154425e-01   +3.217493409410569e-01   +4.936175946245404e-01   +3.057048059455721e-01   +6.308782735982648e-01; +4.962016139440537e-01   +2.902022925003224e-01   +2.714117269095309e-01   +5.109049443439126e-01   +7.949108026933066e-01   +8.456700101079520e-01   +7.755803547065896e-01   +6.712324836442366e-01   +4.388224010405629e-01   +7.100935860842552e-01   +3.703356127633317e-01   +4.874686803969419e-01   +6.760796791602358e-01   +3.548745003715006e-01   +6.913881599279601e-01   +7.434409071813630e-01; +5.083220012689244e-01   +1.252052146036600e-01   +3.552526754166175e-01   +5.773493063895543e-01   +1.593305241963909e-01   +3.682452928257504e-01   +2.001061674062075e-01   +4.905652367852825e-01   -8.223419714859224e-02   +4.690951543864489e-01   +7.308785825024724e-01   +1.424736149901602e-01   +4.457518354641173e-01   +1.323896890109888e-01   +6.132377896019318e-01   -5.502088680196443e-03; +6.878596127507318e-02   +7.141187047964684e-01   +2.826375698931695e-01   +5.032895052050456e-01   +2.201240589742424e-01   +6.099614611969035e-01   +6.489089372769168e-01   +3.941100077591649e-01   +3.852251636929926e-01   +7.056945091537534e-02   +3.693302028218932e-01   +3.177163836553930e-01   +1.349795405145857e-02   +1.000605208561249e-01   +7.974487901091447e-01   +1.928137167270814e-01; +4.334023111974688e-01   +5.421268079344704e-01   +3.329131283356117e-01   +2.320615836489190e-01   +7.140038569764025e-01   +4.001040866138588e-01   +1.268664080586026e-01   -5.690297568556223e-02   +5.974940861665816e-01   +4.400562774704107e-01   +2.472860808827928e-01   +1.183152728802593e-01   +2.496764968334678e-01   +6.869317871837542e-01   +9.491411547095337e-02   +1.735721168688030e-01; +3.308583853534082e-01   +6.907041297695558e-01   +8.571436002715137e-02   +7.864453251717543e-01   +4.791524912835021e-01   +4.198630896856864e-01   +5.799610835627751e-01   +5.036752524529607e-01   -1.025718629013989e-04   +2.120278263963053e-01   +2.602877951392338e-01   +4.359539710359330e-01   +3.025840248292958e-02   +5.476132835256787e-01   +2.306625210776045e-01   -1.474400274235732e-02; -3.591561045933736e-03   +1.003191115920140e-01   +3.405895939088873e-01   +3.682191617275496e-01   +5.613793527930270e-01   +2.934891060056723e-01   +9.970857015220706e-03   +1.024477688836241e-01   +3.651803183170176e-01   +1.528955464424887e-01   +8.708894552674231e-01   +2.686075549984982e-01   +4.433701455126645e-01   +2.436946372413599e-01   +6.901580452130815e-02   +2.196635730126934e-01];
L2E_L1E_iAMPA_netcon = [+4.861270742035240e-01   +5.840577125667410e-01   +3.233128715300269e-01   +2.338665590689161e-01   +3.635550481777968e-01   +1.050499154212536e-01   +4.232058300639288e-01   +2.318972213911772e-01; +6.747699310186512e-01   +8.521107926207531e-01   +9.307120393035687e-02   +5.926648773577748e-01   +4.077207538318092e-01   +7.213078594077168e-01   +7.077241201277695e-01   +6.728848816177584e-01; +6.590115440064628e-01   +6.227615743831647e-01   +4.774613999353838e-01   +2.550957568843362e-01   +1.142035148280855e-01   +3.005503584036106e-01   +4.526967819190378e-01   +8.389237088531375e-01; +2.107035315666171e-01   +8.021626033760388e-01   +6.481377632240992e-01   +3.702253186769582e-01   +6.446719704001991e-01   +5.122794110221554e-03   +2.370641431510855e-01   +3.888392765179546e-01; +4.937007945619118e-01   +2.209123938359823e-01   +4.377581262308998e-01   +5.331151459377153e-01   +8.708318566972407e-01   +4.342769750660078e-01   +1.995380223542630e-01   +4.508712254860091e-01; +4.379469258308001e-01   +1.153466724785598e-01   +4.764664286377962e-01   +3.017605721792503e-02   +8.021433910979183e-01   +3.939264820336922e-01   +8.605258957964981e-02   -1.206497716955021e-02; +2.284768973817386e-01   +7.730587480946539e-01   -5.722287830928745e-02   +7.672672884614254e-02   +4.121976864980469e-01   +3.722739859251526e-01   +5.887890301593097e-01   +3.745728849842646e-02; +3.628864223213937e-01   +7.657613544029170e-01   +7.161357526593064e-02   +5.011722751655276e-01   +2.199132704403977e-01   +4.530032712092370e-01   +7.754118926197751e-01   +3.140949527193896e-01; +3.736101698977801e-01   +8.646000525488736e-01   +1.921631988992574e-01   +5.761708239195713e-01   +1.301202924727591e-01   +4.903140472136963e-01   +6.778075770876930e-01   +4.700259717892311e-01; +6.098955259321189e-01   +7.122465309507963e-01   +3.724252589036394e-01   +3.844136283094983e-01   +3.794250532689193e-01   +5.340237967777368e-01   +2.103742941809726e-01   +1.314455814269717e-01; +5.705479580627468e-01   +3.942294153997046e-01   +5.688864354020711e-01   +4.649221714683643e-01   +1.874417702123809e-01   +1.368459316916733e-01   +4.707379464489253e-01   +3.091544936628206e-01; +6.442713484532339e-01   +5.876840414494591e-01   +6.438515295472895e-01   +6.114075579218062e-01   +2.620606446931136e-01   +2.047620443933169e-01   +5.397240583242151e-01   +7.821122814983963e-01; +1.185555363906628e-01   +5.310922041717199e-01   +2.919447332250154e-01   +1.172609980205498e-01   +5.692916497307491e-01   +3.827826777196350e-01   +7.457675181228396e-01   +3.969751923438029e-01; +2.123826641145323e-01   +1.768722976886421e-01   +4.104815444211118e-01   +5.597339269135688e-01   +1.283234420801975e-01   +7.019328215577005e-01   +5.147166897947675e-01   +6.113304791664210e-01; +4.383855396339320e-01   +2.106046795271113e-01   +1.162327787276918e-01   +1.523314306480604e-01   -6.823282735925290e-02   +1.054653643702100e-01   +3.632612594954951e-01   +2.734151282656871e-01; +3.271113141566753e-01   -7.383901362740651e-02   +8.119441014142650e-02   +5.009864948187085e-01   +3.432268075307576e-01   +1.019699446537202e-01   +9.207652229251699e-02   +3.358852457328313e-01];
L1E_L2E_iAMPA_netcon = [-6.182328830048885e-02   +2.047743927700479e-01   +2.639836375736413e-01   +2.890504979103073e-02   +3.518230949812191e-01   +4.826793662059646e-01   -4.901387246819176e-02   +5.813150515497713e-01   +1.133988350123435e-01   +5.792461314114874e-01   +4.949001852509076e-01   +6.085759068271315e-01   +6.417577606968221e-01   +1.727270652126994e-01   +6.121119468661537e-01   +3.638925167751783e-01; +7.465509223837914e-01   +4.855483274730736e-01   +3.548571450907540e-01   +7.138893249269518e-01   +6.125573528087888e-01   +6.869617460093991e-01   +6.707236796868388e-01   +3.941004170966561e-01   +3.678072828238382e-01   +4.500774602179073e-01   +2.098314048900705e-01   +7.005594956982105e-01   +7.574732215541995e-01   +7.342997779450656e-01   +8.234556292031252e-01   +5.854253906582295e-01; +7.512206023301191e-01   +4.379222425553440e-01   +5.178821093162411e-01   +8.582514457867085e-01   +7.754786123403044e-01   +1.407804928489274e-01   +3.905321027811948e-02   +1.508042383227629e-01   +5.869317873880557e-01   +7.109194175569507e-01   +1.638201529759326e-01   +6.889224185753912e-01   +1.955229053408049e-01   +2.892248643727690e-01   +1.402013020345473e-01   +5.470367847411728e-01; +5.641661990567818e-01   +3.949306545348118e-01   +3.513092268589629e-01   +4.899748975772281e-01   +5.463091235372530e-01   +5.207592020241927e-01   +6.888750916992211e-01   +6.093341520088676e-01   +1.304425943646665e-01   -3.560413044134726e-02   +4.605295360482703e-01   +2.614007731342464e-01   +7.479454890833054e-01   +3.596563187572951e-01   +7.506765969418516e-01   +6.364769332535262e-01; +4.364694107023120e-01   +8.746144280943108e-01   +1.627182541068669e-01   +6.945938991182136e-02   +4.080083832869025e-01   +1.656582520639097e-01   +1.148876473258891e-01   +5.744144596012335e-01   +7.390993344320619e-01   +4.034753733035926e-02   +5.756834858639710e-01   +4.294052898928452e-01   +6.578403275836356e-01   +2.603402988460884e-01   +8.572034203875402e-01   +4.132768194429058e-01; +2.591527060013833e-01   +5.365783107839692e-01   +5.014719299630260e-01   +2.593377635611148e-01   +1.366476663689725e-01   +5.816309740662945e-01   +8.207744893575576e-01   +8.612462939087304e-01   +8.041343596802002e-01   +5.591901283255246e-01   +2.380155909471027e-01   +4.802570079621554e-01   +5.556396567984712e-01   +2.557622852637604e-01   +3.437084759992275e-01   +2.195176036880818e-01; +6.902084006121260e-01   +6.528590412827407e-01   +4.174781733849597e-01   +6.699647582633933e-01   +8.367878251425511e-01   +6.384340311436075e-01   +9.500656184292838e-02   +3.568989275575486e-01   -4.590010835466147e-02   +5.383342072015432e-02   +6.655774267252562e-02   +1.779819435068213e-01   +8.744497160221762e-01   +1.937913312061318e-01   +3.852445681237955e-01   +7.508342832509893e-01; +3.713670900674303e-01   +7.222604254159861e-01   +2.699860899382217e-02   +1.583820119963813e-01   +1.373636003409262e-01   +4.876490921399899e-02   +3.430961399311460e-01   +9.844752046807306e-02   +6.156880471367521e-01   +3.442734338696928e-01   +6.555073083623376e-01   +5.718908241347620e-01   +2.903966942260222e-03   +3.363162748438868e-01   +6.424969629999490e-01   +5.918297149364218e-01];
L2I_L2E_iAMPA_netcon = [+8.634002850172365e-01   +3.432497305734381e-01   +1.374753713555906e-01   +8.173886906489242e-01   +2.373311846872255e-01   +6.139589283518742e-01   +8.777619610951016e-01   +4.921792643621629e-01; +1.134799261303982e-01   -8.694419340747342e-02   +3.713184959248888e-01   +7.522457240241033e-01   +2.295850104579316e-01   +2.228967590407643e-01   +7.141263280634749e-01   +3.345703090414195e-01; +3.218299995053813e-02   +2.871318617316506e-01   +4.109396110902352e-01   +5.734349433764150e-01   +3.037257619142462e-01   +5.187791519426296e-01   +5.831863791966120e-01   +7.620095095665580e-01; +8.059368009321083e-02   +4.588348445991159e-01   +1.262455550812152e-01   +4.291970217745389e-01   +4.964244826802881e-01   +1.745777346107893e-01   +1.146334930557939e-01   +4.829257840830142e-01; +4.073062948489382e-01   +5.467230603234786e-01   +6.993913735126651e-01   +4.390292844009973e-01   +3.353212112576333e-01   +4.598874556438629e-01   +6.687126569089261e-01   +3.482372421710362e-01; +4.643990576229896e-01   +2.192563159586343e-01   +6.332866287672254e-01   -1.786268245932916e-02   +3.394779434314689e-01   +1.481551810223177e-01   +1.383231170211150e-01   +5.948990442783229e-02; +7.391300136271715e-01   +5.045140968623771e-01   +2.721027912082042e-01   +4.567750124656582e-01   +5.327298150692269e-01   +2.521885565831411e-01   +6.008114014471627e-01   +6.577152321395406e-01; +6.351770067241919e-01   +2.212464848557489e-01   +5.531093061734442e-01   +6.826616187852084e-01   +7.926823420054950e-01   +6.191346291987717e-01   +2.227132347866679e-01   +6.149547979132081e-02];
L2E_L2I_iGABA_netcon = [+4.387878300693946e-01   +1.965651026093846e-01   +3.235074618563637e-01   -7.363711713665053e-03   +3.576729760893541e-01   +1.709459486959953e-01   +6.812079725692409e-01   +2.508627165642740e-01; +1.436367794177635e-01   +3.709650711378457e-01   +6.116175321938782e-01   +8.297645273977733e-01   +1.670630963455942e-01   +1.354085774889483e-01   +2.331772436740608e-01   +6.077364685842128e-01; +7.404410599574255e-01   +1.561982356034379e-03   +7.221673363406310e-01   +7.980436129516000e-01   +4.261874040250225e-01   +2.366900200154493e-01   +4.630559197859334e-01   +6.317728641820264e-01; +3.901729338447516e-01   +7.633516674799001e-01   +7.793269961458794e-01   +7.364740311635082e-01   +6.698989274048635e-01   +1.497797435973764e-01   -4.377999675752522e-02   +1.239784884620220e-01; +3.881473372378265e-01   +6.175580380086330e-01   +7.777062083846709e-01   +7.781954217410174e-01   +6.964206558373136e-01   +3.157283529213300e-01   +7.710708944395442e-01   +4.616516176890033e-01; +6.459183633326990e-01   +3.580423575573812e-01   +5.827447605656986e-01   +6.762248613405351e-01   +1.241406490919161e-01   +6.738232287209860e-01   +1.868834866877043e-01   +6.491596024671185e-01; +6.864037158801157e-01   +1.526439660277822e-01   +4.910605140432294e-01   -9.245267999739798e-02   +5.952067637542104e-01   +2.741147783288530e-01   +8.968713526010479e-01   +8.570528695489229e-01; +2.682709276094408e-01   +4.451516376739959e-01   +7.044976666881493e-01   +4.428862287218404e-01   +4.826146275875519e-01   +2.200300054031307e-01   +3.009335264587665e-01   +8.533564077994323e-01];
L3E_L2E_iAMPA_netcon = [+7.724872290816401e-01   +6.487962903355021e-01   +2.077918091163276e-01   +2.796593991785468e-02   +4.817963798594291e-01   +1.459066089714027e-01   +2.149369108167072e-01   +3.629033358670378e-01   -4.001743667435971e-02   +2.520606543659407e-01   +3.665166115800865e-02   -1.053574457081828e-01; +5.535512218706460e-01   +2.007189760178460e-01   +7.585881400769388e-01   +4.295517906360659e-01   +6.153935559573932e-02   +6.035636523377983e-01   +5.385575958098771e-01   +3.200238414171516e-01   +4.720828500314820e-01   +8.250484907957975e-02   +5.812875517656657e-02   +6.390352052075964e-01; +4.880506851707322e-01   +4.095317344166035e-01   +2.192094293603646e-01   +1.157622966593867e-01   +2.731917822957473e-01   +4.855843690846369e-01   +6.400615194406520e-01   +5.625424909788601e-01   +6.677544806142803e-01   +4.105472776987216e-01   +8.120751145025853e-01   +5.994293614164857e-01; +2.260590270402721e-01   +2.427217181002322e-01   +9.144303281818927e-02   +3.191194284572246e-01   +9.244027079341252e-02   +7.252548888930620e-01   +2.401015301910472e-01   +3.246144792039977e-01   +2.399547222202709e-01   +6.714123179860496e-01   +2.218431205022813e-01   +6.356843798142771e-01; +1.808545031948960e-01   +6.048932005037279e-01   +6.259266673131507e-01   +4.153693208495124e-01   +3.702814598442279e-01   +2.871499145453811e-01   +2.764604689189495e-01   +2.911843011357514e-01   +2.751639803176398e-01   +3.759360587181805e-01   +4.380448538759699e-01   +3.574073900903525e-01; +6.500467526964565e-01   +7.554643834122828e-01   +2.628821703302788e-01   +4.196054305546628e-01   +2.415020174988414e-01   +6.053123787525303e-01   +1.817656541005326e-01   +6.847784736758148e-01   +5.607971119206173e-01   +4.301208822001262e-01   +7.935878171545662e-03   +2.028039693841840e-01; +7.184660278603680e-01   +4.967475772810180e-01   +3.283673488170467e-01   +2.588609916115006e-01   +6.454216293363795e-01   +4.282714511826360e-01   +5.362589023853865e-01   +5.538221292719657e-01   +6.573419084081402e-01   +4.375413189431954e-01   +6.444868178878516e-01   +2.297430539715024e-01; +7.825932311939792e-01   +6.390326493332831e-01   +8.035496280339314e-01   +1.471680948221662e-01   +1.259379434409734e-01   +4.103769900730252e-01   -1.159262497931954e-01   +3.981448528616129e-01   +5.531582494193407e-01   +9.687598777562911e-02   +7.736418670727983e-01   +7.206180052694159e-01];
L3I_L2I_iGABA_netcon = [+4.159896496598288e-01   +3.699908092088279e-01   +4.321527771245284e-01   +3.310425105853558e-01   +5.565073426945010e-01   +7.254529715002211e-01   +3.112443567651682e-01   +4.679234333766080e-01   +6.459687725417278e-01   +1.828193342988439e-01   +2.566535752981122e-01   +3.687818421540121e-01; -4.378474598724998e-02   +6.665899905297614e-01   +5.187185397561437e-01   +2.590978830581070e-01   +7.265237136135739e-01   +7.755405284003187e-01   +4.306680452434388e-01   +6.497997802824192e-01   +5.709176380211886e-01   +2.681939594159075e-01   +4.923943281726527e-01   +2.547121960193714e-01; +6.894577696408354e-02   +4.245237371888275e-01   +7.456256490672498e-01   +7.867569294313350e-01   +3.767806731045432e-01   +3.200550024791836e-01   +8.305826495979119e-01   +5.525900530707408e-01   +2.466484186756587e-01   -6.534059602746610e-02   +2.689315146069027e-01   -3.723505989284522e-02; +8.512829444554056e-01   +2.335321961789006e-01   +4.562984243244064e-01   +1.600639534382890e-02   +3.275560852752928e-01   +5.003482438941981e-01   +5.409417817468134e-01   +8.144321976406310e-01   -1.171489223782651e-01   +5.533290660970497e-02   +4.969579420346716e-01   +3.707867544458303e-01; +4.629594782496403e-01   +2.807890317013304e-01   +1.439577581576927e-01   +2.713161432084545e-01   +2.808347901882627e-03   +2.265069181824187e-01   +6.264046146097093e-01   +1.133062122050068e-01   +5.378183088799728e-02   -2.381436166443583e-02   +2.443890798355201e-01   +2.187118721627054e-02; +4.754616911445606e-01   +2.393832891953581e-01   +4.282367077348676e-01   +5.450782424668351e-01   +3.391904918553871e-01   +6.636307795424397e-01   +4.615960880899574e-02   +6.619692992247033e-01   +1.324126589174151e-01   +8.396323969812676e-01   +5.834135007563466e-01   +4.922059867788919e-01; +3.386721577511400e-01   +4.939289104358186e-01   +3.269379050325835e-01   +8.975302201227245e-01   +5.411059228596130e-01   +4.711009733381843e-01   +2.805089979174790e-01   +2.446238251373851e-01   +5.054022697064445e-01   +4.133295001327719e-01   +1.512665411290357e-01   +6.276805127000186e-01; +3.006817995655981e-01   +4.468624357036954e-01   +2.695887233245809e-01   +1.062564908283976e-01   -5.440065329676616e-02   +3.678306031126405e-01   +6.043492349168120e-01   +5.158299953591597e-01   +2.243140855749989e-01   +6.963105947189470e-01   +8.860503223978622e-01   +5.200965198107330e-01];
L2E_L3E_iAMPA_netcon = [+7.557704705969449e-02   -9.821822364680881e-02   +5.461712103281282e-01   +5.583778440295479e-01   -1.032636453580164e-01   +3.701773103323087e-01   +4.509207858174237e-01   +5.059407348852959e-01; +9.070317342755682e-02   +3.693869442728257e-01   +4.658137530198526e-01   +4.398484608319800e-01   +6.680141422523934e-01   +4.738325694254192e-01   +6.474673218539776e-01   +4.555554202676759e-01; +3.381377191129759e-01   +2.769742939552782e-01   +7.597212754724646e-01   +3.009159878057082e-01   +5.696756035562415e-01   +9.724287087892115e-02   +4.993138344408359e-01   +2.549190122132577e-01; +3.107304264911304e-01   +4.186379635949770e-01   +1.536494239692572e-01   +1.408391263662845e-01   +7.225648107755280e-01   -7.244163179546825e-02   +6.559757663843698e-01   +6.986731099581160e-01; +5.497340426819899e-01   +4.703056545517167e-01   +2.931610749884183e-02   +6.353934824397163e-01   +6.801629389575198e-01   +2.828873102781267e-01   +6.282692105390670e-01   -6.540089496272924e-03; +4.372396172279859e-01   +5.544269196456808e-01   +3.833322232202002e-01   -6.206747625801469e-02   +2.860798462324607e-01   +4.898195512365038e-01   +3.944241262728990e-01   +3.261307644405140e-01; +2.655813524289119e-01   +5.129171834863691e-01   +4.317356638549080e-01   +3.271083998361963e-01   +1.300467971099132e-01   +5.459464282203972e-01   +3.308373823257920e-01   +7.479971298975528e-01; +5.418479012146975e-01   +1.298800164683149e-01   +3.262706661305793e-02   +2.489097809954538e-01   +3.735916381645337e-01   +6.285981656809150e-02   +2.361928323591641e-01   -1.898917427181901e-03; +3.182669601422012e-01   +2.569674813819763e-01   +8.906961933065536e-01   +6.558416942894665e-01   +1.890523832608034e-01   +1.480047762890898e-01   +6.473866080249793e-01   +5.225316959009649e-01; +4.936803653169747e-01   +6.186574284130070e-01   +1.066517256744493e-01   +7.287702831068620e-01   +3.964643436809354e-01   +5.087309962405535e-01   +8.043029552548671e-01   +5.401927863828594e-01; +1.283314611091023e-01   +4.100001344351085e-02   +1.084914470256994e-01   +1.913886668856336e-01   +9.870953693332767e-02   +1.072494941127080e-01   +2.256324335150461e-01   +1.607620140397138e-01; +7.827528247770457e-01   +6.134581427816683e-01   +2.538930106263253e-01   +1.881776599490240e-01   +5.001201095126362e-03   -1.175541715353797e-01   +4.105483847799632e-01   +3.216212918813467e-01];
L2I_L3I_iGABA_netcon = [+1.847911787778349e-01   +7.963639810674813e-01   +1.142890762936855e-01   +4.187631461759267e-01   +2.497247126468103e-01   +1.220418460214628e-01   +3.865691130830346e-01   +7.905110021640338e-01; +4.553082681199162e-01   +7.500000101768993e-01   +1.896620399177728e-01   +5.533554270853419e-01   +6.741535426233933e-01   +2.292672609514224e-01   +1.749131692862678e-01   +1.771590919250448e-01; +2.001321331231234e-01   +3.770967412460334e-01   +1.411520591564223e-01   +5.549587658014962e-01   +6.849019072377036e-01   +2.491496743438542e-01   +1.607882354495067e-01   -1.893563465825504e-03; +3.824521513896701e-01   +5.131200451388843e-01   -5.517339441244577e-02   +7.123541282436614e-01   +7.813875181190968e-01   +7.761865300271404e-01   +8.208265823366914e-01   +2.406367741014084e-01; +1.244416417141145e-01   +5.211403119205238e-01   +6.780595216259847e-01   +5.390148997226369e-01   +1.262166524715872e-01   +5.851159452595144e-01   +7.817916724981399e-01   +2.003041523698056e-01; +1.861523296033891e-01   +4.929074190212260e-01   -1.140672098096237e-01   +2.035219020849947e-01   +2.604483805856870e-01   +5.829051882026121e-01   +6.617554096474084e-01   +6.367421100326882e-01; +1.423534147588392e-01   +2.295688261064845e-01   +6.648189186398545e-01   +3.142460125393707e-01   +1.394588574695700e-01   +9.253894684619658e-02   +3.561590342456564e-01   +3.256650716494605e-01; +1.520771767231965e-01   +7.695880861500655e-01   +7.977524578976788e-01   +2.489854096870696e-01   +2.480832604522812e-01   +6.058537251219052e-01   +4.710696237534562e-04   +8.758708152337685e-01; +5.626160011959198e-01   +3.504418876199892e-01   +7.589803929716238e-02   +1.670849367722796e-01   +4.189398807992769e-01   +3.524297688720007e-01   +6.645185120253537e-02   +6.424128517623108e-01; +4.504678868403985e-01   +1.428085110860104e-01   +5.284931202261469e-01   +5.776557315885193e-01   +3.096236867114502e-01   +5.226124525410949e-01   -2.008170504246503e-02   +6.270694815732593e-01; +8.041752501167150e-01   -4.146379256547793e-02   +7.253265051963812e-01   +2.017955901887477e-01   +5.929885026664075e-01   +2.048104693709491e-01   +2.987962292643725e-01   +6.452117748069282e-01; +4.412641793634522e-01   +5.531011704350886e-01   +6.233964503884928e-01   +3.397157824647422e-01   +4.508199843651360e-01   +2.377251818021457e-01   +3.050442143419736e-01   +7.675524954185243e-01];
L3I_L3E_iAMPA_netcon = [+4.538704565986692e-01   +5.330565657808288e-01   +1.697629432168863e-01   +4.071793099803612e-01   +5.841611439259831e-01   +1.608069219621851e-01   +2.031074622970625e-01   +5.252100215558499e-01   +3.645310729414887e-01   +2.762611886830567e-01   +4.911747649854731e-01   +8.709644977571852e-02; +3.200394158259847e-01   +1.568281862213688e-01   +4.014769206740283e-01   +6.263562612270939e-01   +2.732985158476967e-01   +9.646790575778255e-02   +1.240752405791248e-01   +4.687365941678446e-01   +7.850996944630168e-01   +1.268364367767125e-01   +4.058781732154305e-01   +9.701089268043464e-02; +6.957012820105005e-01   +7.951459759411645e-01   +5.832782970837442e-01   +3.175728033817891e-01   +3.656331217517506e-01   +7.855520273401263e-01   +7.857250428944740e-01   +7.195770457385796e-01   +1.132134843818238e-01   +4.845705149203208e-01   +3.994893036523643e-01   +6.632253609585712e-01; +6.002830287514319e-01   +1.873676736755462e-01   +4.471232170660883e-01   +4.483790587540020e-01   +4.327033630307273e-01   +5.963085889804598e-01   +9.153741452398373e-02   +1.268660818003203e-01   +7.532315512327485e-01   +3.391530385111366e-01   +4.334301320354480e-01   +3.476792394338007e-01; +4.912781238088524e-01   -1.215699523511451e-02   +2.251231305446199e-01   +5.364242168690091e-01   +5.020134169847819e-01   +6.337683536282017e-01   +8.880330333288929e-01   +7.482896714758458e-01   +5.771561511907702e-02   +3.784393767506345e-01   +4.779649448764600e-01   +2.918412434676395e-01; -1.173661432498550e-01   +4.184397514746340e-01   +2.121146248668544e-01   +5.947167161999295e-01   +4.194052999337279e-01   +1.252981943275314e-01   +7.287527894015940e-01   +5.229670267962437e-01   +8.236368445305383e-01   -4.955552896762711e-03   -8.564992916461896e-03   +9.234837099361524e-02; +1.592872760260031e-01   +7.662490617753441e-01   +3.315510122541345e-01   +5.194523553680704e-02   +2.958531184700787e-01   +4.745766457779461e-01   +4.680413837528443e-01   +3.736824626826671e-01   +3.207196707036286e-01   +2.677233027393057e-01   +7.059675662255176e-01   +3.634077743103636e-01; +2.393042004467158e-01   +2.391735478021091e-01   +1.812362876901383e-01   +2.419451846669904e-01   +4.937074928452709e-01   +7.407843954888256e-01   +3.292124207705879e-01   +6.395879797794320e-01   +5.648415543116060e-01   +2.874909332217379e-01   +4.055173654282888e-02   +8.088397385821690e-01; +3.328425134865530e-01   +4.604655559214285e-01   +5.477419575015777e-01   +2.501618913482764e-01   +4.384967395435991e-01   +2.562361676691687e-01   +7.090224178188763e-01   +4.787078085682844e-01   +1.141016372874909e-01   +5.994211521672741e-01   +3.159712034797915e-01   +1.680049232418164e-01; +1.682253901728868e-01   +5.645821380112380e-01   +6.309810655965206e-01   +1.396594040509050e-01   +5.594415697419989e-01   +6.359367232961813e-01   +5.277390729334996e-01   +4.580279187766185e-01   +1.421476559718428e-01   +1.644809975802527e-01   +4.439712810937796e-01   -1.007320407277589e-01; +2.939505603636391e-01   +5.544659971659972e-01   +5.108213538711615e-01   -1.723650128205117e-02   +2.716094422650314e-01   -4.489641740855067e-02   +1.800162612581029e-01   +7.252189817067891e-01   +3.602316593446310e-01   +3.112651905960824e-01   +4.905025284965168e-01   +7.644418622269259e-01; +8.653246606614590e-01   +4.558114135696474e-01   +3.918762077567036e-01   +2.260391900422782e-01   +7.412293233608007e-01   +2.272457041128791e-01   -2.827082972805323e-02   +1.304135553698479e-01   +4.256522563969115e-01   +6.631087335156460e-01   +1.404227477171701e-01   +5.093941590184130e-02];
L3E_L3I_iGABA_netcon = [+4.287001742413791e-01   +1.817270922792720e-01   +5.337371190032088e-02   +6.152517203915582e-01   +1.575006419905031e-03   +5.910788891404153e-01   +6.351644029784657e-01   +5.282839279482988e-01   +4.429596203992296e-01   +5.567445997724454e-01   +2.275404524572681e-01   -7.946831573748997e-02; +4.280997261526840e-01   +7.605581459047966e-01   +1.321186523922534e-01   +2.265639802861780e-01   +5.467543195366171e-01   +4.283789562803906e-01   +1.484680527565774e-01   +7.552307110579361e-02   +5.716975900981358e-01   +4.393676081103767e-01   +1.026770814169601e-01   +1.821815071519016e-01; +4.151467062902934e-01   +4.365944184742246e-01   +8.367242402815617e-02   +1.466593603927469e-02   +3.039609181107142e-01   +5.908669528734928e-01   +4.767068900854321e-01   +5.765457569107728e-01   +4.590516623222495e-01   +5.046400312609488e-01   +5.351160252953604e-01   -9.325732203684163e-02; +4.904815630418076e-01   +4.636898537409302e-01   +3.729925967299436e-01   +3.029040233101737e-02   +3.984350216109083e-01   +3.527801787879386e-01   +4.902377769657486e-01   +8.081369576355546e-02   +5.940340649078911e-01   +2.314271340653315e-01   +1.333478526290648e-02   +4.348315716118328e-01; +2.858676442044827e-01   +7.034315150521396e-01   +3.467953682888728e-02   +4.491849372646907e-01   +2.528844389023405e-01   +4.731426265201159e-01   +5.871077239266231e-02   +1.056220796073534e-01   +5.749707570772564e-01   +5.614762026833012e-01   +6.440601771455755e-01   +3.502166242007275e-01; +5.179407638815205e-01   +2.669828420338125e-01   -2.656719119869916e-02   +6.269535599355531e-01   +3.820896714365248e-02   +5.615842769492861e-01   +7.094348901732582e-01   +4.894923408695837e-01   +8.639824449921770e-01   +5.617856253730470e-01   +9.149221711238232e-01   +7.193915354539172e-01; +4.649297436090828e-01   -1.276500359882045e-01   +4.490405966039975e-01   +8.866412503508103e-02   +2.741575730405793e-01   +4.953864970220843e-01   +9.354908639091796e-01   +3.696542447731617e-01   +1.740509829060709e-01   +4.615257651170271e-01   +6.932143402721025e-01   +5.237715595029655e-01; +4.148249965982472e-01   +6.558209135970535e-01   +6.419137963026192e-01   +5.685704480778080e-01   +3.841321763964460e-01   +5.977832033790035e-01   +3.021135074439006e-01   +8.451448928226760e-01   +4.100416347148905e-01   -5.838148523140633e-02   +2.861001061744325e-01   +2.975915498243503e-01; +2.531852662017553e-01   +5.025643537940007e-01   +6.251043611383097e-01   +6.190359674452697e-01   +3.628396909715482e-01   +6.360210495873595e-01   -3.808080183919772e-02   +1.953480539511935e-01   +2.298742202832186e-02   +5.551887541928942e-01   -3.407486436377063e-02   -3.011593860327218e-02; +5.183085610140807e-01   +1.460584002139792e-02   +7.128551771142415e-01   +5.381015348510573e-01   +1.877573992951438e-01   +1.146147751808906e-02   +5.520000220265152e-02   +8.814589383877215e-02   -3.263851432424787e-02   +6.223300165705733e-01   +4.534322878364887e-01   +8.849541164215763e-02; +8.211067072699344e-01   +4.957388803323723e-02   +5.090136119633980e-01   +6.886782511678623e-01   +1.048361839220739e-01   +1.796186054119825e-01   +5.521898916694392e-01   +4.639817440374634e-01   +1.387417564280129e-01   +3.760898898114303e-01   -3.108745593854048e-02   +3.605238238814206e-01; +7.789844470001764e-01   +7.506885549476385e-01   +5.222995299130745e-01   +4.183201304766440e-01   +9.234957168228562e-02   -6.337433546054397e-02   +6.008947916130236e-01   +2.602930851372842e-01   +7.770876177467922e-01   +3.686384534197807e-01   +2.189054411953445e-01   +6.959164257290169e-01];
L2E_Input1_iAMPA_netcon = [+7.521067145314416e-01   +3.967903373328211e-01   +2.120318204824398e-01   +1.073198387188981e-01   -1.888567372401327e-02   +6.502208382140765e-01   +3.311281780515210e-01   +5.638261681738475e-01];
L2I_Input2_iAMPA_netcon = [+2.140183271302445e-01   +3.389202900766250e-01   +4.627224444685936e-01   +2.384392908676007e-01   +3.538813432271796e-01   +5.682393457593133e-01   +4.169164315882643e-01   +1.020206790225227e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
