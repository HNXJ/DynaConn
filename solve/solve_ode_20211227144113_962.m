function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.655397357857260e-02   -4.359819588610914e-02   +3.259323052976121e-02   -3.795613093832049e-02   -7.491861684632324e-02   -1.494313731504276e-02   -3.297163330620769e-02   -5.769476041901241e-02   +2.879700370745773e-02   -2.336042130282451e-02   +4.260151505122423e-02   +1.714850774059327e-02   +3.002930024233682e-02   -3.616317082852168e-02   +1.170910759073294e-02   -1.760448049518605e-02; -4.911720187438419e-02   +5.376443767583634e-02   +1.625754740692048e-02   +2.705609437289169e-02   +3.377620084461495e-02   +5.083418870622224e-02   +1.572765692569988e-02   +4.923173337713378e-02   +8.790918246413582e-03   -2.161427681180674e-02   +6.213342753984608e-02   +7.732032015728293e-02   +5.199810167168563e-04   +1.305780192769708e-02   -1.244528247855659e-02   +1.148530953555841e-02; +1.028563286798768e-03   -4.061796099301089e-02   +1.418270908365177e-02   +9.403218673871550e-03   -7.120989681921930e-03   +1.348665464413284e-02   -6.207880260884772e-02   -6.637706643075676e-03   -5.935061257866464e-02   +7.718586965598906e-02   +3.726117836608048e-04   -5.793126663503086e-02   +8.555052823226862e-03   -4.166920587290925e-02   +3.001139589581652e-02   +3.390405026962806e-03; +3.536211613803152e-02   -4.769715537581483e-02   -1.897600171111157e-02   +2.440926780907497e-02   +2.689951382476425e-02   -6.581764779332036e-02   -3.595902018272915e-02   +3.938537280561281e-02   -4.226526176723054e-03   -9.345794066579075e-02   +1.032550934894462e-02   +5.291910993201239e-02   +2.973976370219777e-02   +2.239566841500330e-02   +1.345895441845100e-02   +2.430660623497000e-02; +8.698478451630756e-03   +1.396135789596360e-03   -1.499318085063022e-03   -1.336530542806122e-03   -2.891665517268745e-02   +8.576294070575505e-03   +2.809087385512810e-02   +6.466459891696724e-02   +5.304297516258188e-03   +3.174694252073957e-02   +8.319203080977194e-03   -4.646429615668513e-03   +3.383437845504889e-02   +9.340403507655411e-03   -4.534310998400634e-02   +1.485921920242016e-04; -6.698944790747434e-02   +2.437857928130688e-02   +6.977970871621682e-02   -7.527751204499401e-02   +3.884847847216717e-02   +3.120685426898208e-02   +2.062594390074478e-02   -9.910521893433812e-03   -3.732572457088253e-02   -1.950648878363659e-02   +3.137837559772663e-02   -2.667338537268677e-02   +5.678463409798352e-02   +5.618189402812905e-02   -6.924069781196858e-02   +6.698866742818946e-03; +1.567584080330879e-02   +2.709267113440827e-02   -2.798657350892915e-02   -4.073274033549028e-02   -9.708488490426196e-03   -2.825661996566118e-02   -6.508635764115520e-03   -4.969011465291138e-02   -8.101927017488995e-03   -2.892842962876200e-02   +3.655018925108950e-02   +3.070751044031767e-03   +9.261870745709713e-02   -1.628096892801891e-02   +1.062191198878636e-02   +6.951432529195174e-02; +3.052247898605565e-02   +4.424398275726741e-02   +3.105089287242218e-02   -6.418614353091116e-02   -8.746165509991544e-02   +2.134708541113005e-03   +2.762781123264887e-02   +7.333476165591754e-02   -6.803320362998351e-02   -4.717424795776441e-02   +8.398727089659472e-02   -1.649741526075987e-02   +4.459264453088911e-02   -1.667028961515883e-03   +1.633613801542807e-02   -2.519448739424401e-02; -5.865394834478013e-02   -1.506845717781383e-02   +3.198032373288895e-02   +1.135107084007369e-02   -4.242187878189487e-02   +3.559303704489652e-02   +4.111829215661338e-02   +5.457838267921421e-03   -8.620026970866333e-02   +1.866736099313118e-03   +5.779598510887021e-02   -2.444849276352894e-02   +1.026163254817872e-01   +5.359340874557941e-02   +3.729731700476197e-02   +4.028788734937781e-03; +2.686054997354359e-02   -6.755554238481579e-02   -8.459656269662530e-03   +5.819150328879306e-02   +4.767529017249181e-03   +5.202369498092446e-02   +2.361642642819789e-02   -6.889173472038303e-02   +4.843986782287223e-02   +5.233930736259534e-03   -5.361982471938860e-02   +3.935790540778844e-02   +4.526548196194313e-03   +5.774808753700925e-02   -7.958753347480742e-02   -3.577811378539562e-02; +3.004784949297622e-02   +1.556659542006416e-02   -3.300376411448389e-02   +1.573129627525532e-02   +5.942421967092631e-03   +7.914254180104160e-02   -6.393113992781349e-03   +2.121904048346810e-02   +3.247344322459301e-02   +2.456945530181160e-02   +3.423812549902491e-02   +4.328955788228485e-02   -8.251143349829536e-03   -9.773752707714144e-03   -4.126721139375752e-02   -4.289065590660630e-02; -1.352159330005024e-02   -7.270384839170164e-02   -3.324218314604385e-02   +4.257955361995275e-02   -1.533354022659795e-02   -5.519281815547811e-02   +4.516337715965810e-02   +2.730515743063596e-02   -2.857823483636037e-02   +2.213369321658167e-02   +2.933091782379598e-02   -2.137246548371875e-02   -1.896925412031943e-02   +2.404894704614126e-02   +6.928648257441185e-02   -2.508762414103695e-02; +2.524411163348535e-02   -7.902220502212294e-02   -7.296065965967982e-03   +2.114828198670728e-02   +8.376922290164703e-03   -4.113683789647649e-02   +1.558793145164137e-02   -1.172607103788409e-02   +6.723938918842863e-02   -7.544905778384142e-02   +5.801467048691826e-03   +4.557152752776381e-02   +4.851229892595388e-02   +6.165098305882240e-02   +3.544944238752006e-02   +1.791132082453864e-03; +5.236999887369682e-02   +4.904400277368499e-03   +8.114635547314109e-03   -3.686328333558325e-02   +3.889560013233716e-02   -5.941491810103449e-02   +1.515447496781094e-02   -1.946733028041327e-02   +2.358469540041348e-02   +5.415036087520976e-02   -2.623663652560842e-02   -5.025591218938060e-02   -4.502557034636204e-02   -5.409982285595687e-02   +9.755410866975905e-03   +2.309939820457847e-02; -2.000616104995611e-02   +9.996251292679628e-03   +1.968753938502103e-03   -4.150883722945142e-03   +6.877534666276527e-02   -9.224293540241738e-03   -2.437800197559320e-02   -9.286513998551713e-03   -3.038120868923419e-02   -5.689725930700518e-03   +7.342744768706552e-02   +4.968740026649867e-02   -2.603881042324253e-02   -2.974987825827313e-02   -1.384809341973271e-02   -4.895267802482560e-02; -2.785677116829515e-02   +1.701807255975574e-02   +3.968176607693796e-02   +2.207322855700156e-02   -6.735475697317302e-02   -1.149929386211926e-02   -2.577023488600805e-02   -7.483887687902031e-02   +1.870494979363457e-02   +2.092575449612065e-02   +7.512969932425176e-03   +2.830095306187827e-02   -7.566293670574704e-02   -1.748210505568383e-02   -3.256487394208701e-02   -1.093950904835821e-03];
L1E_L1I_iGABA_netcon = [-3.353690194353154e-02   -1.372698536170935e-02   -8.101294989705722e-02   +5.805358814128050e-02   -4.506401279842024e-03   -2.587311444821393e-02   -9.302927929757879e-02   +7.536399834382740e-02   +5.681779490818441e-02   -1.335880399432447e-02   +1.000654930897961e-02   +2.166123874634767e-02   -2.647138596438898e-02   +5.818544051241895e-03   -8.285534326087181e-02   -2.782905769233262e-02; +3.777317060016214e-02   -3.037832378893631e-02   -2.666662902077851e-02   +2.506813733630595e-02   +9.960000231099159e-02   -1.392171836034089e-02   -3.941550561449252e-02   -5.466426009055943e-02   +3.134382256550797e-02   -1.345411876438441e-02   -7.493499860802529e-03   +5.978033013196465e-02   +2.950337133332922e-02   +3.026672056921483e-02   -8.248707280671529e-03   -1.336132150668140e-02; +1.894183316991870e-02   +3.899730707101010e-04   +7.123394403444970e-03   -1.907801582779536e-02   +6.683963050301653e-03   -5.843986829039308e-03   -1.005222424693583e-01   -1.507747158731025e-02   -4.279902687372909e-02   -8.179092636738812e-02   +4.093150047863298e-02   -2.566175221303772e-02   +4.146756409719500e-02   -1.581337186212547e-02   +9.393380473675340e-02   -1.648145720214351e-02; -5.718120078461796e-02   +3.391775281910983e-02   -1.592291758465095e-04   -2.118254195753575e-02   +4.429880165571458e-02   +1.342042221302616e-02   -3.565087455561770e-03   +2.562736234975867e-02   -3.670921611910622e-02   +4.598115049194423e-02   +2.822834075112444e-02   +6.246700567266254e-02   -7.577593462856093e-02   -4.311765496551731e-02   +6.290600106604101e-02   -5.361870172194763e-02; -3.929552825334752e-02   -7.608035386755593e-03   +6.659944332977440e-03   +8.241801771471408e-03   -2.967671411486839e-02   -3.604447041870946e-02   +1.101717074831550e-01   +4.653032120854077e-02   +4.701671810392075e-02   +3.489544170847445e-02   -1.199187889892055e-03   -5.646779387594325e-02   +5.093664018160528e-02   +2.441487375711585e-02   +9.880186444452399e-03   +3.855107949539703e-02; -8.905155875910051e-04   +7.636356528927673e-03   +2.267184431947359e-02   -1.899893058915642e-02   +1.255260581747908e-03   +1.705905050852803e-03   +4.061604785752679e-02   +5.607536979149622e-03   -1.557606790061936e-02   -9.075835053267894e-03   -3.857063355389991e-02   -1.261048255249281e-02   +4.555391241845433e-02   +3.829100726416255e-02   -2.504526104571458e-02   -5.038798118705613e-02; -2.464579783983464e-02   +4.697627144727233e-03   -8.903432246800227e-02   -2.977376542994412e-02   -6.655439946644452e-02   +1.268472109614871e-01   +3.619446899485103e-03   +8.731884117771431e-02   -2.433430740370887e-02   +6.056730741607348e-02   +7.957004315306043e-02   -2.448425348341421e-02   +2.283011670134117e-02   -1.091128052792802e-01   -3.487967298064663e-02   +7.653632175816208e-02; +5.534907083084319e-03   -2.003113772126090e-02   -3.402844940115225e-02   -1.382297538292641e-02   +4.070987797372970e-03   -2.701347987926784e-02   -1.664723562432962e-02   +9.136033036938356e-02   -5.688816125907613e-02   +2.004714469732167e-02   +2.866107324620414e-02   +1.420514795401575e-02   -3.681968251353317e-02   -4.183430728048566e-02   +1.631322468413152e-02   +5.271910936438292e-02; -6.780766049524646e-02   -6.627461492609463e-02   +2.906010667754772e-02   +5.710258112387939e-02   +5.511336584642938e-02   -4.258678242650386e-02   +2.434980978773537e-02   -1.753912313378583e-02   -6.584480496084921e-02   -3.257532262761159e-02   -2.726854659520869e-02   +1.975571726363833e-02   +3.806354919557252e-03   +4.189229870389692e-02   +2.852175486290721e-02   +2.224800038444390e-02; -1.724275897046080e-02   -2.629952341995746e-03   -3.283425121668238e-02   +1.077865972025438e-01   -6.887205381245846e-02   +1.122743697795728e-01   -7.196647858219379e-02   +2.470870443837563e-02   -3.273906684370201e-02   -4.422815080350484e-02   -8.479676139386086e-02   -2.984981779751313e-02   +8.066856332068058e-03   +1.635364287012112e-02   +4.538522922628990e-02   -2.613250778143517e-02; +8.984471545481074e-03   -4.690819554911838e-02   +3.551301962433219e-02   -6.277329336996385e-02   -2.700109472789184e-02   -4.779281086136230e-02   -1.460129995669560e-02   -4.989215927150255e-02   +2.181375665092653e-02   +1.821073197810986e-02   +1.122399128024171e-02   -5.018879930882247e-02   +9.207281547482911e-03   +3.989494146343708e-03   -5.375396384465055e-02   +1.671571239308378e-02; -4.209253409589440e-02   +7.321716822049137e-02   -4.614825822573303e-02   -3.583916131925846e-02   +1.286503633646054e-02   -4.903481884815050e-02   -1.873365958838327e-02   -2.678614084875917e-02   +3.333857583850842e-02   +1.007010941058649e-02   -3.507500150296156e-02   -3.428470727144482e-02   +6.939550412774560e-02   -4.109918869395934e-02   -1.124520251144143e-02   -3.103097595284730e-02; +7.643931389842555e-02   +4.868327018577664e-02   +2.782552756129607e-03   +1.873195721612408e-02   +6.111873415099167e-03   +5.263479048000920e-02   -2.748433139591517e-03   -1.819115627869846e-02   -4.330359862604857e-02   +1.021573738774887e-02   +8.203659166244718e-03   +5.202986954502598e-02   -6.896877387316844e-03   -8.573439326218638e-03   -3.727971366168614e-02   +7.004043817190110e-03; +1.383024599190426e-02   -3.492847276548544e-02   +2.012458974559689e-02   +2.743770825229178e-03   -4.002884061646475e-02   +4.996090305483863e-03   +1.484464225183972e-02   -5.515266458018628e-02   +1.066023649403281e-01   +6.108601967791839e-02   -6.056960592500892e-02   +4.445449747255612e-02   +2.098812926258079e-02   -9.644508030286353e-03   +1.137942274366993e-02   +4.594359502381721e-02; -8.955312813660113e-02   -2.112659503799708e-02   -3.451197571016702e-02   +3.648076767163961e-02   -6.924774787151906e-03   +2.325309727517723e-02   +3.302792756733020e-03   -2.595493838891197e-02   +1.012304080588607e-01   +5.539194797875890e-02   +6.486698499014018e-02   +3.596321866560890e-03   +4.662149991406784e-02   -2.543843958126486e-02   -3.999460042646286e-03   -1.220560448919674e-01; +2.753088498998114e-02   +6.504182337957298e-02   +3.526061860950054e-02   -1.261773222355096e-02   +2.414847532917058e-02   -1.045098230572478e-01   -2.752989778376170e-02   +1.334233428224917e-02   -3.521950954939087e-02   -8.611346487772526e-03   -3.377016804442418e-02   -5.119347649988291e-02   +2.767733222552699e-02   +7.654026670613599e-02   +2.601448934217361e-02   -1.945750688292031e-02];
L2I_L1I_iGABA_netcon = [-4.928181002950241e-02   +1.736759754274779e-02   +3.884583959363151e-02   -1.110020822499041e-02   -9.092139051473505e-02   +4.445796263439419e-02   +4.214148837342905e-02   -3.549637885922184e-02; -5.073375202622663e-02   +1.777957471822650e-02   -6.500268684214786e-02   +4.444030211282502e-02   +1.011098774825183e-02   -4.695318513778362e-02   -1.103659191152275e-02   +1.932151705313535e-02; -2.470211700824945e-02   -8.099698299954933e-03   -9.761176478139039e-02   -2.396699033394693e-03   +6.224547556036081e-02   -1.585472018547886e-02   -9.139648544958554e-03   -1.026963106412544e-01; -5.165069750813403e-02   +6.737725786928946e-02   -1.258852503949629e-01   +6.556142363844532e-02   +6.529256840227825e-02   +2.949710344729715e-03   -2.017145208678787e-04   +6.979943956256737e-03; -7.947363846803153e-03   +2.604112921630592e-02   -2.890457635265991e-02   +2.127865836983998e-02   +1.984932762676377e-02   -5.227187808327764e-02   +1.977250160077872e-02   +3.004220643596300e-02; +1.352586202054849e-02   +9.119756249919922e-02   +5.146863469445397e-02   -3.412058010441736e-02   +4.931761478306880e-03   -1.542140377189378e-02   -6.962812100533776e-02   +1.760992698266665e-02; -1.770151960398540e-02   +3.528245889346273e-02   +4.705017362153410e-03   +1.998986777238648e-02   +2.195324228499011e-02   +4.809894586556478e-02   +1.644662564178530e-02   +4.132986845222182e-02; -2.521977868932286e-02   -4.262148883579558e-02   -1.175401539321612e-02   -3.797739959250801e-03   +1.494705654915159e-02   +2.944464497437294e-02   -6.315973210008700e-03   +3.721468754540189e-02; -2.841872193728926e-02   -1.920007301202842e-02   +5.268477789130336e-02   +1.372790652177663e-02   -5.888414001696393e-02   +3.773173755815408e-02   +6.823394747116868e-02   +3.143123921937785e-02; -1.032657904966540e-02   +1.458803259192560e-02   +3.441708825514105e-02   -2.506207181687241e-02   -6.512855503328096e-03   +8.079975974832336e-03   -8.942118225186910e-04   -4.018025674131941e-02; +1.681739359632271e-03   +1.040896084350621e-02   +1.969721138743604e-02   +5.254653267913290e-02   -3.823364212844223e-02   -6.589902636677991e-02   +2.793434120953287e-02   +5.028251230592248e-02; -3.335519782348580e-02   -1.420596545904325e-02   -4.260917905937957e-02   +3.544900043819334e-02   -6.003940758209218e-02   +3.415669401231852e-02   -2.770348285522876e-02   +2.905188114545736e-02; +1.845203835456122e-03   +8.317212064834473e-02   +2.831404346213074e-02   -4.774635437530195e-02   +2.628555279030169e-02   +7.116552505925786e-02   +4.648973537133058e-02   -3.800165678868656e-03; +3.427666869138533e-02   -2.330681026482577e-02   -5.730292266723985e-03   +6.422220762993386e-02   +4.177938840424934e-03   +2.967992677878979e-02   -2.713950841989537e-02   +1.410592789703836e-03; +8.622638781060635e-03   -1.149950582427330e-02   +3.867097476187624e-03   -2.656208949868436e-02   +8.075993435373314e-03   -1.530249884249893e-04   -9.483133233536495e-02   -1.610448954189301e-02; -3.967436932189365e-02   -1.071015597926309e-02   -1.658991035286671e-03   -4.121083763885949e-02   -3.341001806125984e-04   -2.853958347630185e-03   -9.570826685095958e-03   -8.061638050344107e-03];
L1I_L2I_iGABA_netcon = [-4.561167451188156e-02   +1.878819294489360e-03   +3.175978272715091e-02   +2.290443138874294e-04   -1.103879214839819e-01   +4.240184973362347e-02   +5.652755093426818e-02   -1.016416450195911e-03   +4.592535310544420e-02   +6.536567510053992e-04   +3.088601955329129e-03   +3.953991290446298e-02   -2.124178996246406e-02   -2.585759264114734e-03   -2.823595737512168e-02   +1.055467800336434e-02; -5.522384515074617e-02   +3.794464569007817e-02   +5.326977608746265e-02   +1.975227749213338e-02   -5.972142069305236e-02   -2.216141415334098e-02   -6.313687057625217e-02   +5.532230632534893e-02   -1.260709503772187e-02   +5.820133976247169e-02   -3.794045681078859e-02   -1.171131928217676e-01   +8.746214569724084e-02   -1.041141124437796e-02   -1.764739758362266e-02   +4.454011022760868e-02; -4.207971242888618e-02   -2.308566583953684e-02   -6.881258049765920e-02   -4.846038474125253e-02   +3.540327818063951e-02   +8.842123844901080e-02   -2.014671166801565e-02   -3.911154994473112e-02   +3.242249298227488e-02   -4.304906868157961e-03   -5.313596294321012e-03   +4.200271776764462e-02   -1.828971665892947e-02   +7.644507915886306e-02   -3.648437089460796e-02   +6.787750205375306e-03; +6.357474171996211e-03   -2.051399757654920e-03   +3.838449874926249e-02   +5.410002428200338e-02   -5.227951939522938e-02   -1.072656605376959e-02   -4.914770671478037e-02   -1.978936180715819e-02   -5.272244753319957e-02   -2.230379448252650e-02   -3.184818941720016e-02   +5.715096557612147e-02   -3.139068015227617e-02   -1.603782877533847e-02   +4.443738352916000e-02   -5.555964941435467e-02; -6.063629760178735e-03   -5.021213581546848e-02   +4.136028744929994e-02   -5.009214226673807e-02   +3.961808801076334e-02   +7.197813699909492e-02   +8.217207744594685e-02   -3.955007069216018e-02   +8.261917168163438e-02   +1.896689062024998e-02   +5.817918333771840e-03   -5.741761748537723e-02   -6.631793074100027e-02   +6.823450237574566e-02   -1.764352044822272e-02   +4.476446553853165e-02; -1.670317885242381e-02   +2.281561382725661e-02   -1.472980512616366e-02   +4.358887184569833e-02   -4.133105338694591e-02   +5.657944582421862e-02   -6.770019247569922e-03   +6.040337475646394e-02   +3.470097038744704e-02   -6.296057126452495e-03   -1.952473004212592e-02   +1.261699989609858e-02   +3.835179785798298e-02   +1.106760132481108e-02   -2.005233221029349e-02   -6.350735243378022e-02; +6.262143496352885e-03   +6.064149338163270e-03   +6.413375461722302e-02   -2.664221918575103e-02   +5.846921129250494e-02   +6.475292964921439e-02   +3.286495818486757e-02   +3.988438708247422e-02   +2.566334333954106e-02   -1.572992831892803e-01   -1.344835298897039e-02   +3.847344528801963e-02   +5.865863100549834e-02   +1.799139187153564e-02   -1.734462551237078e-02   +2.935181365805074e-02; +7.929875658555652e-02   -8.538403102447714e-02   +1.998544708039254e-02   +1.181865486683992e-02   -3.148847286480810e-02   -8.345933496634346e-02   -2.976310868436394e-02   +3.556914667486032e-02   +6.832262120764765e-02   -9.448250666712208e-03   +1.381676395615385e-02   +2.661822379020389e-03   -3.107565595855483e-02   +1.006698273545929e-02   -1.521465489486007e-02   -9.819374195400841e-02];
L2E_L1E_iAMPA_netcon = [-8.907621232786832e-02   +2.259414239939370e-02   +4.167563105754741e-03   -1.993088464644738e-03   -2.159616161695851e-02   -7.430845542558240e-02   +1.583047388643425e-02   -1.018583592933141e-02; +3.247250070808642e-02   +2.516741817976599e-02   +8.975457800964995e-03   -4.998088756472888e-02   -7.769312390757576e-03   -2.104992426814205e-02   +6.866034697622855e-04   -3.729779879229910e-03; +2.385958298548299e-02   -7.629405348114110e-02   -3.969053448529274e-02   -1.895363416155308e-02   +4.097748485059059e-02   +1.984803308419297e-03   +6.340028924056175e-02   +3.307688743843082e-02; -1.504904787162567e-02   +1.203018187850525e-02   +3.759792371556571e-02   +2.861979331159256e-02   +2.128813322365065e-02   +4.137587133745966e-02   +3.654519635565479e-02   +4.667482513533213e-03; +4.721582214581992e-02   +5.201142852958647e-02   -9.331285968555612e-03   -7.438508250988581e-05   -5.831797318491465e-02   -3.260436395152069e-02   -5.820787009549047e-02   +1.487447697744984e-02; +8.651406904206028e-02   -3.473974521059998e-02   +8.521745537087292e-03   +2.042110637413332e-02   -6.800268049499239e-02   +2.669787375992308e-03   -3.690301019501135e-02   +8.666755079162670e-02; -2.480519568105799e-03   -2.184508072201187e-02   -2.965168260054538e-03   +3.087066399061220e-02   -2.756509592732686e-02   +3.641124450793740e-02   -6.863497085670868e-03   +5.259995235052495e-02; +3.074038736962089e-02   +2.523196286943436e-02   -4.286275228935003e-02   +4.465488077213826e-02   +4.203688762059368e-03   -1.144100688404405e-02   -3.184218035100123e-02   +5.086303874954520e-02; +1.404678879319079e-02   -2.971770820480331e-02   +2.379165487245192e-02   +3.766800853499713e-02   +1.643333922604268e-03   -4.682741429920161e-02   +5.910883111093770e-02   -8.686842152044041e-02; +5.894217792196522e-02   -3.370214190228769e-02   +3.137147210740253e-03   -1.242946012183741e-02   -2.975956164563870e-02   -9.834713149537534e-03   -2.367883716642671e-02   -4.970879427123401e-02; -2.730146073853412e-02   +3.589255070608780e-02   +1.774436136242130e-02   -8.001881831116421e-02   +4.462320007934582e-02   -2.141439428280434e-03   +2.060401156820470e-02   +1.179510030544357e-03; +8.584405080393195e-03   -1.822630524648037e-02   -2.163507107249030e-02   -1.018386163657553e-01   -2.987941794484472e-02   -3.953407668142433e-02   -7.794790443260713e-02   -2.101539598823439e-02; +1.284682094974054e-02   +1.552418454917171e-02   +4.220672644649144e-02   -1.955596947334666e-02   -2.288463118460222e-03   +7.269189093441625e-05   -2.900043501069438e-02   +1.030874857134671e-02; -3.234823364494715e-02   +4.283762889729549e-03   +1.207956421415454e-02   -1.065640643867767e-02   -5.487527339853079e-02   +3.301630592273751e-02   +2.257990680096603e-02   -2.162234167189874e-02; +3.881745034494854e-03   +3.045202556433284e-02   +8.339523113637802e-02   +3.947744364668183e-02   -8.501096002912423e-03   -4.250264337750356e-02   +5.219411153901395e-02   +2.184291460566306e-02; -5.967950434413015e-02   +6.648190092570704e-02   -4.992677033904940e-02   +1.391539146208555e-02   +2.647145749029546e-02   +2.246805963833212e-03   +1.225348763080875e-02   -6.804857973956212e-02];
L1E_L2E_iAMPA_netcon = [+1.087890520454078e-02   +1.942558730643007e-02   +3.983532837906954e-02   -2.251682348943765e-02   -2.098680533243913e-02   +2.012498651225893e-02   +6.566621655115222e-03   +6.575635154260487e-02   -3.316384733030211e-02   -4.055203175274094e-03   +4.073530440778400e-02   -6.544053255648460e-02   -2.752980860024137e-03   -5.609484475058141e-02   +6.918734375627095e-02   +1.754789157221142e-02; +2.155515122956720e-02   -5.872888573059832e-02   -2.271053933904547e-02   +1.156485096104836e-01   +5.921880405492658e-02   -2.886993528047722e-02   +5.089171284901871e-03   -8.955827843222767e-03   +2.796442968487346e-02   -4.245058522335734e-02   +3.470731460064738e-03   -2.285140537141039e-02   +6.544914274619611e-03   +9.444952333415944e-03   -4.400147377070234e-02   -5.706088557517607e-02; -2.144540113833228e-02   +5.813696781901677e-02   +4.963089805675103e-02   +1.642575469586403e-02   +1.988383498206120e-02   +2.073521505969998e-02   -7.156335644621098e-03   +1.493315111513612e-02   -2.326187117145229e-02   -7.213410154226958e-02   +4.637108598592484e-02   -5.068110319706012e-02   -2.464555527674472e-02   +6.650468182076949e-02   +1.115894117645739e-02   +1.243489495666916e-02; -2.261861936029116e-02   -2.584526902738810e-02   -3.228045000745886e-02   +2.983331880896802e-02   -1.291400701970545e-02   +2.607534219011172e-03   -8.042902262879367e-02   +3.112354304758690e-02   +2.392382960226953e-02   -2.612506286706429e-02   +5.515572391526451e-02   -1.365561412772202e-03   +1.122837039212477e-02   +6.858511167928945e-02   -1.443836370759321e-02   +3.883764999567449e-02; +4.147984729396401e-02   -1.861581152990932e-02   +3.063985559373252e-02   -5.804751576705040e-02   +3.205315497359571e-02   -4.485396722724059e-03   +4.542356981610064e-03   -8.782327477691639e-03   -6.565772658200035e-03   -2.784868707630350e-03   +3.319386654124852e-02   -1.400836516243071e-02   -5.182772704477777e-02   +1.065060258314575e-02   +4.263544382913455e-02   +4.673368249546000e-02; +3.465834041724938e-02   -2.544059179074832e-02   +6.933776099023670e-03   +4.378693320565755e-02   -3.237615106437072e-02   +6.460120539880450e-02   +2.749448677363148e-02   +1.368874372488156e-02   -1.019999548216015e-01   +5.080818320003426e-03   -2.593165253232746e-02   +9.579910202225535e-02   +3.658564648466188e-02   +4.246828384665440e-02   +1.004024809408568e-01   +3.509499029787398e-02; -4.414771641837947e-02   +7.643443491922385e-02   +2.663067592475135e-02   -5.240262075036542e-03   -4.839358194682935e-02   -1.472601372111892e-02   -1.054728280429861e-03   +1.113442382735885e-02   +1.679235698005519e-02   +1.529075786427646e-02   +3.375151484977196e-02   -1.139312158844231e-02   +4.238529243468114e-02   +6.199617010320405e-02   -1.805450783460453e-02   -5.269235886909580e-02; -2.077602505142561e-02   +2.427343567794905e-02   +2.116675524203241e-02   +3.125315402206018e-02   +5.076456707252849e-02   +3.111459127142688e-02   +4.254656921681852e-02   -3.336166123365442e-02   -1.265913926263337e-05   +1.947674395236150e-02   +1.125634718347237e-02   +9.973724605181348e-03   +2.606863784415857e-02   -9.531831171381471e-03   -3.703324229886250e-02   +2.073992737772896e-02];
L2I_L2E_iAMPA_netcon = [+4.401994597899223e-02   -7.731960791101633e-02   +2.777039713483893e-02   -2.486251812168088e-02   +7.762809580056818e-02   +2.086535442544137e-02   -2.631938431279157e-03   -2.950398750004714e-02; -4.735478312591263e-02   -6.482915872598094e-02   -8.743400210357605e-02   +1.245142661915752e-01   -2.473170170170071e-02   -2.069167685685804e-02   -2.403246054129464e-02   +4.469743466036615e-02; -2.896677774823971e-02   +5.549935287278835e-03   -3.929948627589059e-02   +3.061663142648179e-02   -5.938686043890779e-02   +1.938140961192413e-02   +5.701279248408674e-02   -8.687990750473798e-02; +4.296452571068632e-02   -1.438106971757454e-02   +1.587581984860131e-02   +1.848652362652658e-02   -9.080267812137739e-02   +5.248134716851799e-02   -4.880742982642569e-02   -1.260940050368189e-02; +6.305169764057077e-03   +5.597822864370292e-02   +1.462132544510013e-02   +1.649873866839043e-02   -2.096050565357627e-03   +9.276672308770054e-02   +6.189738389237949e-02   +3.804908724343678e-02; -1.340291872485258e-02   -1.926531092503013e-02   -3.690039086062100e-02   +7.677531601254992e-03   +3.025422983336648e-03   -4.889232561721679e-02   -8.869253320093629e-02   +7.405373121321479e-03; +2.224061106462796e-02   -1.851754244046601e-02   -4.087584559308706e-03   +1.818964339863113e-02   -5.041932364380368e-02   +4.014537606049084e-03   -2.964997782906356e-02   +4.040007561655484e-04; -4.126666462367180e-02   -1.750786451788175e-02   +5.921586860806452e-02   -1.699592021238815e-02   +7.313733591980041e-02   +2.919470692853124e-02   -5.173203054305314e-02   -8.082121871058265e-04];
L2E_L2I_iGABA_netcon = [+3.950281207572294e-02   -4.523138725773831e-03   +3.276328015067183e-02   +2.391564304457724e-02   +4.047826787428090e-02   -6.228448784644353e-02   +2.603889388834632e-02   +5.399205397120249e-02; +8.306210418677677e-03   -2.484343242724256e-02   +4.005068027608009e-02   +3.598873025221817e-02   -1.698667243673791e-02   -5.565539204471365e-04   -1.347504418862323e-02   -1.522172744047783e-02; -5.650939896798338e-02   +8.145164508330074e-02   -3.687088307791603e-02   +6.623795407207314e-02   +1.395583961924618e-02   -4.201907553474765e-02   +3.859110070606878e-02   -2.753177153896747e-02; +8.006941856544202e-03   +6.209209619948444e-03   +4.661375854725369e-02   -3.243686083398541e-02   -7.358702900084335e-05   -3.248685105428597e-02   +1.010288136681800e-01   +1.734857876777089e-02; -1.928103046286528e-02   -5.621801565576196e-03   -2.897179277040400e-02   -3.421044802370865e-02   -1.160761710271375e-02   -2.124985038914800e-02   -2.323024905697093e-02   -3.553514096440517e-02; +1.454361702824331e-03   -6.040782986393141e-02   +2.849619416095401e-02   +6.425949989810187e-02   -6.320586069526879e-02   +7.016963615971349e-02   +1.003657140291317e-02   +1.593741582173810e-02; +4.926217067849382e-04   -1.091585475700170e-02   +2.638631166952743e-02   +8.366156930719200e-02   +5.518989029167186e-02   -2.107969336226256e-03   +3.745580191659777e-02   +3.926015081846138e-02; -4.596459568036976e-02   +7.521644953002249e-02   -3.807690405757517e-02   -1.068713785273847e-02   -2.170309056590504e-02   +3.245919013681128e-02   +7.590576083445539e-03   -2.565571419848135e-02];
L3E_L2E_iAMPA_netcon = [-3.848269119832066e-02   -4.615054250931502e-03   -1.630532852847125e-02   -3.254628099451670e-02   -2.090299533279655e-02   -4.737684981215513e-02   -6.939365056666587e-02   -6.005732201610367e-03   -4.417814174240879e-02   +3.692163861742928e-03   +2.612131318611086e-04   +1.229472702787837e-03; -7.764149119382813e-02   +2.085145568096981e-03   +8.342580911220820e-03   +5.905199253474211e-03   +5.396406671941978e-02   -4.189669771153705e-02   -4.137534767570840e-02   -2.955891218307663e-02   +3.949692891646565e-02   -1.514568788088243e-02   +2.647696205529237e-03   -1.380559275451020e-02; -1.174813175946639e-02   -5.020457366133536e-02   -8.452899443668389e-02   +1.383919612885727e-04   +1.060511712693226e-02   +7.776245848889746e-02   +2.846380394850517e-02   -6.712004642882351e-02   -3.456988132224666e-02   -9.240358220797256e-04   -2.406043444213184e-02   +5.307110062294492e-02; -1.211401553002763e-02   -3.220075904006115e-02   +1.014782621383169e-02   +3.132722945203856e-02   +5.921674066068936e-03   +3.012456483718517e-02   -6.094694732626708e-03   +6.346156391462172e-02   +3.840630287423607e-02   +2.188806532202251e-02   +1.417072903827778e-02   +1.217869722617330e-03; +4.151380952766305e-02   +6.157535627798687e-02   -3.708328819840356e-02   -1.776885636127375e-03   -5.733164714374174e-02   -4.803984616801472e-02   +1.065777210966524e-02   -3.379735297688509e-02   +2.393582895131387e-02   +3.381836138536538e-02   -3.271434079625619e-02   -4.803078428135302e-02; -2.796919527013575e-02   +2.115956881496230e-02   +1.871233373984411e-02   +3.733603107228541e-02   -7.475311810416137e-03   +5.209565725157154e-02   -1.828660401859823e-02   +2.115431424561947e-02   +1.037199050790433e-02   +4.935737342763340e-02   +2.267331397561363e-02   -9.417836594598812e-03; -1.319835442004899e-02   -4.056905295202923e-02   -6.008686485753077e-02   -2.603791663186887e-02   -6.340867206766892e-05   -4.241546261545633e-02   -3.208259028523278e-02   -1.292507046609512e-02   -1.711711378518894e-02   +3.255042774042577e-02   -1.978575803165485e-02   +2.397249434762556e-02; -4.307997590532321e-02   -1.239383468017597e-02   -1.626399896186732e-02   +5.631680896681463e-02   +4.045084372476313e-03   -1.572257850427631e-02   -1.200332874605869e-02   +9.971141852381271e-02   +6.721997725542869e-03   -2.827165568491210e-02   -5.957036764656020e-03   -7.890264098952876e-02];
L3I_L2I_iGABA_netcon = [+4.357787682263380e-04   +3.537519115490786e-03   +1.220719038446504e-01   +1.431938351961101e-02   -4.602776588868342e-02   +2.815607657711759e-02   +3.465894805723529e-02   -4.190944166557273e-03   -3.134737804185846e-02   -4.699327894022723e-02   -2.521884998861609e-02   -5.392710212302273e-02; +6.500014540147318e-03   +3.881392761216577e-02   +5.283125060705821e-02   -2.604367038746562e-02   -1.734021902862068e-02   +1.966418600809067e-02   +2.053431871062140e-03   -6.429029543901177e-02   -8.009786908551461e-03   +1.993790690125117e-02   +2.687922089537172e-02   -1.581467853294392e-02; -1.289439516895756e-02   -1.091200139502512e-01   +7.887384733767948e-02   +3.131269664382805e-02   -6.863687906126037e-03   +2.203304530532937e-02   +1.641408076096418e-02   -3.222175407794965e-02   +3.269829103486622e-02   -3.617179615570836e-02   -1.142452565445804e-02   -6.335154642702706e-03; -7.122391358899536e-03   -6.815191378867148e-03   -7.454718232348122e-03   -6.543662087399278e-03   +4.761523841495517e-02   -2.371854123011008e-02   -1.641193600282854e-02   +4.172400692508489e-02   -1.594863997186209e-02   -2.452753315710835e-02   +1.547919552044275e-02   -5.417308967580921e-03; +7.731711625244647e-02   +2.494610123740158e-02   +2.866743962520123e-02   -2.536420656528147e-03   +3.132611838506539e-04   +6.656811082649934e-02   -1.837210020337951e-02   -1.614092805822889e-02   +6.420323300420083e-04   -1.714500409133290e-02   +3.724945239508513e-02   +3.331854279178519e-02; -8.954347421320917e-03   -4.426998723002638e-02   -2.318436245373482e-02   +2.758420296421121e-02   -4.437719704002533e-03   -7.002394147039821e-02   -5.968118447841002e-03   +4.176211885934487e-02   -8.006610245651363e-02   +1.840821282312347e-02   -2.471149039971327e-02   -1.044687777583791e-02; -2.268926059179499e-03   +3.418647712011558e-02   -1.974191963966996e-02   +3.004251685195233e-02   -4.965788516875644e-02   -2.861768169720212e-02   -3.670517054866820e-02   -3.465677090363026e-02   -2.281479413154863e-02   -2.820574081415492e-02   +1.724393080646386e-02   -5.461133863004446e-03; -4.807622445398437e-02   +1.205468958930551e-02   -2.006787782698378e-02   -1.202626472172713e-02   +2.529034288799433e-02   +1.688675356169098e-02   +2.176450887536032e-02   -8.484617883171447e-03   -5.538418607409393e-02   -3.755120834792747e-02   +5.374094168036292e-02   -1.157158960593569e-02];
L2E_L3E_iAMPA_netcon = [+4.958543636568000e-02   -1.478406982007434e-02   -4.166795353076386e-02   -4.168461237287746e-02   -2.285317735083974e-02   +2.609086847838416e-02   -3.148137460324775e-02   -2.421857702920220e-02; +7.120882460909424e-02   -3.311371437232741e-02   +3.884686783031736e-02   +2.344577614917572e-03   +5.181263460773830e-03   -3.899705964367907e-02   -3.153578028260622e-02   +1.025773706085238e-01; -4.111172313660588e-02   +5.158997860206940e-02   +2.284511967565588e-02   -2.436534155088202e-03   +4.636203078160328e-02   -8.745941313967592e-03   -1.856627659884533e-02   +1.872156216782747e-02; +6.410029989195271e-02   +6.307820224872283e-02   +1.522572873389684e-02   +5.412392769281589e-02   +3.948994360658853e-02   -4.581063281555642e-02   -2.093384688175227e-02   -4.293749807518674e-02; -5.543043050248307e-02   -3.869651441012036e-03   -4.595317313646406e-02   -5.727504177123468e-02   -1.624560723812249e-02   -6.514161631750934e-04   -1.136942108380964e-01   +1.068368738586581e-02; +6.965377336396722e-02   -7.058222666981132e-02   -4.890323115054574e-03   +3.482625371073394e-02   +9.295234994776649e-03   -1.386076967981694e-02   -4.378126290632344e-02   +1.306884452722955e-02; +2.709448478099729e-02   -1.634146453480553e-02   +5.330656010456243e-02   +6.272635745608245e-02   -2.448863179921903e-02   +1.053151762777072e-02   -1.369107361453791e-02   -6.914827856897848e-03; -3.294596908965874e-02   -4.112125157504672e-02   +5.292520341903027e-02   +9.823059934736363e-03   +9.099137061205498e-02   -1.296820484221340e-02   -2.989587765021818e-02   +1.478721924261673e-02; +1.177106546314734e-02   -5.734892544589075e-02   -2.344328384817246e-02   +8.193254703672694e-03   +4.906267206644109e-02   +4.430376689215162e-02   +2.730046256301331e-02   +1.125361417790375e-02; +2.267416065461819e-02   -2.625334530469051e-02   -2.193709012058270e-02   +1.288739331260651e-02   -5.569163038465812e-02   -4.489618308838153e-02   -2.670008680840619e-02   +7.101284178387811e-02; +1.710196202369296e-03   +8.694583543643206e-03   -5.386906818371925e-02   +4.744366686049586e-02   +4.858428558514883e-02   +2.629313616141003e-02   -3.512958462729069e-02   -5.160937689612632e-02; -5.439268814738955e-02   +6.041027921304683e-02   -3.599021819505629e-02   +2.849912173285897e-02   -1.862232525521356e-02   -5.106727607878548e-02   +2.225032556786207e-02   -8.629391637599285e-02];
L2I_L3I_iGABA_netcon = [-3.581800111714804e-02   +2.012819629171924e-02   +1.357094639232997e-02   -2.481976194482848e-02   -3.428089329080238e-02   -3.062921857536198e-03   +3.894462177379117e-02   +3.851459339387021e-02; -1.486025391692296e-02   -1.795158104631816e-02   +2.346741354497139e-03   -3.172382011997126e-02   -6.070139337248748e-02   +1.545657736090349e-02   +3.039358107049952e-02   -4.473172344026198e-02; +3.399039339454613e-02   +7.905166190077931e-03   -4.873801077845885e-02   -2.030358064039704e-02   -1.530625705566535e-02   +4.825036052984301e-02   +2.130645149819295e-02   +6.804026172080153e-02; -2.603467275450831e-02   -4.722362400974879e-04   +7.183964310893434e-03   -2.897086961429365e-02   +3.551581394051340e-03   +1.037282151469018e-03   +2.465456293058185e-02   -7.953199444314143e-02; +1.257803412594842e-02   +3.687388450654852e-02   -4.736996909101746e-02   +1.615117551867107e-03   +1.691719429443741e-02   +5.125622070512671e-02   +9.200324210981508e-03   -1.444665183357119e-02; +7.249269913753373e-03   +2.662861153051473e-02   -1.049234669088672e-02   +2.326278887148203e-02   +2.076124133334379e-02   +4.795478877068863e-02   +9.781653419150813e-02   -1.153984351550847e-02; -3.260067270543141e-02   +2.939185420938923e-02   -1.787171691154066e-02   +1.629170765738571e-02   -8.214271878676625e-03   -1.847374826206090e-02   -2.600139555730132e-02   +5.210269667276269e-03; -5.288536611596985e-03   -1.546544181708825e-02   -3.129313288454068e-02   -4.090332173981186e-03   +2.119837600123484e-02   +8.699722194073065e-02   -2.438797602645109e-02   -8.589421458780751e-02; +2.082771398107396e-02   +4.107721462150226e-02   -3.143632823370815e-03   +6.114077277864335e-02   +3.376729307094019e-02   -4.044515416073440e-02   +5.877773825025360e-02   -2.028645129548010e-02; +4.595966959948123e-03   +2.202334487873124e-02   +1.881273377140685e-02   +5.208813310973295e-02   -7.314097700349322e-04   -3.729493894116821e-02   -3.773958775510483e-02   +3.209552427519411e-02; -7.011130303782322e-02   +5.850829083945480e-02   -9.785777371426364e-03   +2.084719680609257e-02   +6.332242206133853e-02   +8.322066629633690e-02   -3.467597537740959e-02   +2.603253728065321e-02; -9.329996313589857e-02   +4.329768282751753e-02   -1.465470891815511e-02   +1.278536879256188e-01   +5.237978069740148e-02   +1.920739681411120e-03   -3.401652395211928e-02   -4.598491947427367e-02];
L3I_L3E_iAMPA_netcon = [+5.781115173320751e-02   -6.255669703749098e-03   +1.551886302830384e-01   +4.076355832341669e-02   +4.084593666676160e-02   +7.097153348834170e-02   -1.012507523120377e-01   +1.890622338617534e-02   -8.140856177751701e-03   +1.407456417661354e-02   +1.097377909926209e-02   +4.629762881172035e-03; +7.971310150709503e-03   -5.564635322870592e-02   +1.402443949909628e-02   -1.127668153188663e-02   +8.858561882163787e-03   -9.244200563714594e-02   +2.639302682841226e-02   +1.146646708329424e-02   -5.517199620054595e-03   +6.348174922324536e-02   -2.007041293780945e-02   +3.264345653129273e-02; +3.537431756915667e-02   +4.078205534129714e-03   -1.874643765698222e-02   -1.312592841631609e-02   -3.458713076367462e-02   -1.766413828531222e-02   +2.871694155512950e-02   +6.596678171997711e-02   -4.650355248153003e-03   -4.989824926853476e-02   +5.187927944088074e-03   +5.009387818259353e-02; +4.683864843596871e-02   +2.909721886035230e-02   -2.682405735404368e-04   -5.084811163326744e-02   +2.691252456286747e-02   +1.039682872190690e-02   +3.310608735267569e-02   -2.063457199434523e-02   +2.522386371529743e-02   +1.148075337065797e-02   -7.194764842476402e-02   +2.346692021392799e-02; +4.486995673884385e-02   -9.108155793795181e-02   -5.563258095277830e-02   -5.516209097653429e-02   -7.189242080395477e-03   -3.817212376618019e-02   +1.463847467926886e-02   -3.926639395045582e-03   -1.066607348179547e-01   -5.802317404648157e-02   -3.950257645994594e-02   +2.831312647168997e-02; -2.971851126356861e-02   +3.493558234160798e-02   +6.296981192432735e-02   +6.825283695442760e-03   -2.246379788658888e-02   +8.983307767485982e-02   -1.574523941068907e-02   +2.802630267173842e-02   -4.169118576444111e-02   +6.593357330106837e-02   +5.570030024429586e-02   -1.231202349114480e-02; +6.468805773847990e-02   -2.010671515409964e-02   -4.624116206077967e-02   +9.893022732678114e-03   +1.750886487649866e-02   -2.885535949220727e-02   -6.176543359166915e-03   +5.652795898230425e-02   -7.776364697087184e-03   -2.533497862332874e-02   +7.798756087422044e-04   -4.276808396486871e-04; -4.222172431111084e-02   +2.968329350614401e-02   +8.063975464050280e-02   +3.273967616116492e-03   +1.366478530013225e-03   +3.215625598060219e-02   -2.636110472835008e-02   +5.658817260673414e-02   -3.831709003252869e-03   -4.486963646127218e-02   +4.080686611615196e-03   -2.818264030972577e-02; +2.494534617727064e-03   -2.702119630305978e-02   +9.791312821548931e-02   -7.211359316978658e-02   -3.223518058705478e-02   -3.103976333736972e-02   -3.379854958770913e-02   +2.072045793964725e-02   -5.369012923225757e-02   +4.134170212962383e-02   -6.230491904126086e-02   -2.628825385827697e-02; +4.054588489978059e-02   +1.429139606131738e-03   -3.220858066854316e-02   +5.612393359787488e-02   -5.329603143037468e-02   -2.419534833770276e-02   -3.187705445175661e-02   -4.323103617703496e-02   +1.023749905911188e-02   +4.491292556273934e-02   +2.257239066588058e-02   -1.979817951836643e-02; +4.768425401407952e-02   +6.579799892046129e-02   -7.110969079202470e-02   -1.056557994268626e-01   +5.727698009331299e-02   -2.091990850188019e-02   -3.283072168491299e-02   +1.270578164490327e-02   +1.174306637322728e-02   -4.255316407494528e-02   +4.492302676077946e-02   +3.906107105647377e-02; -9.971796379899305e-03   +8.741472496040370e-02   -4.785466474531670e-03   +4.362999717807145e-02   +5.965626528168737e-02   -5.868184260024143e-02   +1.249858175200574e-02   -2.231568964054015e-02   -5.104881780453747e-02   +1.144389226312151e-01   +3.742475031988836e-02   -1.644871741706447e-02];
L3E_L3I_iGABA_netcon = [-1.693943649484990e-02   +3.980719620971472e-02   -2.099517786832147e-02   -1.063561906866940e-02   +2.628478939182145e-03   -4.816460763710393e-02   +2.602203849055305e-02   -3.360187506641013e-02   +3.091748010568955e-02   -7.014966479556435e-03   -3.143682223453996e-02   +1.164663203398949e-03; +1.853961586059874e-02   -1.179083318038436e-03   +4.860292856657114e-02   +3.340247212826163e-02   +6.134782920210104e-02   -2.303969477986274e-02   -2.405799070905880e-03   +2.334601292890880e-02   -5.610703832797792e-02   +9.469376706713179e-03   +7.616366325574377e-02   -3.071429302495540e-02; -4.739630959563008e-02   +1.951898406654015e-02   +1.220615096041120e-02   +1.898324609884707e-02   +1.488093827138077e-02   -3.201686138544155e-02   +3.280682784594122e-02   -2.495267823882176e-02   -3.331169643154770e-02   -4.271925830161344e-02   +1.989095208818740e-02   -4.573636160346470e-02; +1.059828335147764e-02   -1.953632100407304e-02   -4.721378433259762e-02   +8.958101352334389e-03   +6.159670894488609e-02   +2.915275699196969e-02   +3.105640146040864e-02   +6.694159490329349e-02   +6.095773323066246e-02   +2.208064410575061e-02   -6.223343533044398e-02   -1.323359822006055e-02; +1.082335259361062e-02   -7.477762109071252e-02   +2.475240295329737e-02   +4.556776906857495e-02   +4.155287278168827e-02   -1.004390442194888e-02   +1.751398055079439e-02   -5.619514341338903e-02   +3.813714479942926e-02   +1.424397117547353e-02   +3.474073915124398e-02   +3.506899656585873e-02; -7.768292583946197e-04   +2.191527005694060e-02   +1.924223234051742e-02   +1.769239543146447e-03   +7.172430075158949e-02   +1.532214656669427e-02   -3.390706823311702e-02   +2.255903829762408e-03   +5.137239461244055e-03   +2.000780998936896e-02   -1.579919933586960e-02   -3.255818604822674e-02; -5.940274545016022e-02   +1.372908200786119e-02   +7.387123176756599e-02   -4.503963906198503e-02   +1.028578918145293e-02   -5.238576092704907e-02   +2.890241186088237e-02   -4.789108288549533e-02   +5.543582441937508e-02   +1.314845077874678e-01   -3.600005398265442e-02   -3.115180034124253e-02; -7.060573310881731e-02   +4.380930209196922e-02   -4.863926116118372e-02   -7.540783533358489e-02   -3.774066504335019e-02   -7.004967334042149e-03   -3.579915593261214e-02   +1.536801094006454e-02   +1.716228688887601e-02   +1.617606582739459e-02   -5.105454896451568e-02   -7.312143417593224e-03; +1.405426429664732e-03   +1.879127299438617e-02   +4.076143591430299e-02   +3.919930806658770e-04   -7.662382068107008e-02   -8.939735430483473e-02   -5.862472214785291e-02   -2.965195822264595e-02   +7.702279372623597e-02   +4.867961727674240e-02   +3.525959061125726e-02   -4.118791598927466e-02; +3.343148722974151e-03   -1.042467718505156e-01   -9.085226528025285e-03   -5.745600561646329e-02   +2.796043032891529e-02   -6.181316769767466e-02   +4.580764344991703e-02   -1.571363148541621e-02   +2.462526540990615e-02   +2.728729248521106e-02   -1.102954867305960e-02   +8.563506005143509e-03; +1.398700285895811e-02   +5.166740671350101e-02   -6.156493343385890e-02   +5.722584637861232e-02   +1.666763911953404e-02   +2.049698301800541e-02   +6.326564679471822e-02   +8.142876420252130e-03   -1.118247132208621e-02   +3.907478056487650e-03   -3.566850529373018e-02   +3.122827744922484e-02; -3.963630644951602e-02   +1.614829677002900e-02   +7.375817349713965e-02   +3.544145274418346e-02   +5.075927776223305e-02   -4.395955729759253e-02   -1.900835173374835e-02   +4.134911660234303e-02   +8.073473018016013e-03   +7.196781072274493e-02   -4.810257319843955e-02   -5.724070519404085e-02];
L2E_Input1_iAMPA_netcon = [-3.418390087728772e-03   +1.976478114919973e-03   +9.565398718991425e-05   -7.521007785388377e-02   -3.100170494164188e-03   -6.998500786742148e-03   +1.427966221642478e-02   +2.629279805812799e-02];
L2I_Input2_iAMPA_netcon = [-8.059906736205787e-02   +2.219182380623512e-02   +5.583502754023424e-04   -9.376270307429857e-02   +5.822724029597752e-02   +5.741980263161921e-02   +1.299652304818790e-02   -3.619207410484784e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
