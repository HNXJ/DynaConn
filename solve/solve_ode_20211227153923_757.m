function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+9.172367947682496e-02   +7.547830560815709e-02   +7.533663418570589e-02   -1.172597450493754e-02   +1.169683314700539e-01   +1.879902567880995e-02   +6.660435054258504e-02   +9.624308164652161e-02   +1.273255403552692e-02   +1.065496665757312e-01   +2.109976992466123e-01   +1.713419247774532e-01   +5.087899650004457e-02   +8.986996278536315e-02   +1.441938108326161e-01   -5.998617669528627e-03; +1.839086306090097e-02   -2.981119625009928e-02   +5.990003375501833e-02   +1.779790847047074e-01   +1.044020296420847e-01   +1.751832316248507e-01   +5.858404902376295e-02   +1.699047389497898e-02   +6.245612167412978e-02   +6.502013615768246e-02   +8.381324019725542e-02   -1.064811400664355e-02   +1.600446336333023e-01   +1.002246127110715e-01   +1.331250018670486e-01   +1.203424263418478e-01; +1.604408982765148e-01   +1.213560087594653e-01   +9.949536352185848e-02   +4.926795238297726e-02   +3.751366182378435e-02   -2.343799727700805e-02   +8.833463302280524e-02   +6.162456485554516e-02   +2.987611932072812e-02   +1.787292387072204e-01   -1.934766375194388e-02   +8.873493810622603e-02   +1.892830263440759e-02   +8.141008301574039e-02   +4.558170103031584e-02   +9.782205309381999e-02; +9.434306657817000e-02   +1.461935309933107e-01   +1.239873660354089e-01   +1.400887661514231e-01   +1.064009272072159e-01   +3.984812978495600e-02   +1.011317183191003e-01   +1.515194250622932e-01   +5.132780878306727e-02   +9.518769724982806e-02   -9.871614146742751e-03   -1.440915824867905e-02   +1.494300037925061e-01   -3.900631043937710e-02   +1.501594604831709e-01   +3.312402718188503e-02; +7.189662075883227e-02   +1.577288014430216e-01   +1.962075581368604e-01   +8.400280192671797e-02   -2.643536419434898e-03   +4.287982205544378e-02   +1.728506695475479e-01   +1.096881740124759e-01   +5.657221422767595e-02   -1.088512827928903e-02   +3.583388159354922e-02   +7.189464296216334e-02   +8.757346520490136e-02   +6.494323259282055e-02   +1.261692628539478e-01   +1.798859697834834e-01; +1.064363313268456e-01   +6.511501195374728e-02   +2.047116526625391e-02   +1.741026576076435e-01   +5.169196613084794e-02   +2.291043991783565e-02   +1.028799786635067e-01   +2.049677758850786e-02   +1.291292723010663e-01   +4.708590551451559e-02   +1.356318500347694e-01   +2.003411152163518e-01   +2.743171041770024e-03   +7.756696522080227e-02   +7.797930988606308e-02   +4.109128569116190e-02; +7.117967219195343e-03   +6.205647928277093e-02   +5.008021241057865e-02   +1.484586794837182e-01   +4.483528796379798e-02   -1.597494275399995e-02   +1.169947504396690e-01   -6.652265260215121e-03   +1.449132771748558e-01   +9.141055742861656e-02   +4.684448453216826e-02   +1.071775577044093e-01   +4.141696087371431e-02   +1.037613066869398e-01   +8.586962146432646e-02   +9.831007196827200e-02; +1.096630021615981e-01   +3.409824508135325e-02   +1.822185771523055e-02   +8.902005844145161e-03   +3.090122190874758e-02   +1.961631838277729e-01   +4.886395694614429e-02   +7.590444737471100e-02   -3.137699526337114e-02   +5.464733455239408e-02   +1.321418896216477e-01   +4.093598480197699e-02   +4.111734879019151e-02   +9.802814427834897e-02   -2.427983455726163e-02   +3.089304047264788e-02; +1.359865691782211e-01   +2.359933339457237e-02   +7.739991339337522e-02   +1.212032416305286e-01   +9.520294178025272e-02   +4.536707206389064e-02   +3.201577923172145e-02   +3.220905839901345e-02   +8.568970909642037e-02   -4.556409915275079e-04   +1.509324020116952e-01   -3.329102504650669e-02   +1.015436082390978e-01   +3.583844024818741e-02   +1.021392316826594e-01   +3.886164277887365e-02; +7.828077432386359e-02   +8.899571239591027e-02   +1.037660921069107e-01   +1.307822226096298e-01   +1.767014856013927e-01   +1.891481507332139e-01   +6.080366484522449e-02   +5.122778114622922e-03   +1.774596335854022e-02   +1.412667825965589e-01   +8.082749836162527e-02   +8.483895754865697e-02   +1.824847597274767e-01   +9.982068424343474e-02   +1.130064742009012e-01   +1.347506556416863e-02; +5.067530928460572e-02   +2.352751520227182e-02   +1.015300270313096e-01   +3.630871275835790e-02   +2.528610089783611e-02   +2.506284965954195e-01   +5.964931364842766e-02   +2.161320451218987e-02   +8.142992891535025e-03   +5.119532102468344e-02   -4.433852217070106e-02   +1.119328212571270e-01   +3.285500273987609e-02   +7.031512491805396e-02   +1.167831331870326e-01   +9.607534915584823e-02; +3.381322801962108e-02   +3.134258020761919e-02   +2.370495163067646e-02   +1.403365723610346e-01   +9.511575159877672e-02   -1.633206415826834e-02   +1.424459097113254e-01   +1.411856849111321e-01   +1.146467004810342e-01   +8.765818210763766e-02   +1.283246812493004e-01   +1.352555168913348e-01   +9.119958015569747e-02   +1.260247259768429e-01   +1.181418888618219e-01   +1.508793481928144e-01; +2.216737649700339e-01   +1.223194846517849e-01   +5.551488607137180e-02   +1.781513785632852e-03   +8.684868753546326e-02   +8.167676896527361e-02   +9.159037058876007e-02   +2.540335292312127e-02   +7.992194926728104e-02   +1.752974359723153e-01   +1.488750267555876e-01   +2.672357644463517e-02   +9.131478641104024e-02   +6.699502376749919e-02   +1.384586130683314e-01   +5.300619893669714e-02; +1.380208898604374e-01   +7.386952027783455e-02   +3.696528430608035e-02   +1.602499140879970e-01   +1.812390642066058e-01   +5.595597899955526e-02   +7.960620439859145e-02   +5.966499991629237e-02   +9.313650764323003e-02   +8.956792040993614e-02   +1.583200334757268e-01   +1.755017374999212e-01   +1.508425859148393e-01   +1.739662320475114e-01   +1.779861858767947e-01   +8.711347308073157e-02; +1.320828900289560e-01   +3.562905857043794e-02   +1.555131652852833e-01   +1.744632909530370e-01   +1.154979558263743e-01   +1.700193140878378e-03   +1.225881384860367e-01   +7.001734977659535e-02   +1.260255757102006e-01   +1.244261818268989e-01   +7.288819008818116e-02   -3.903125453584388e-02   +1.400295361366272e-01   +5.445408319926215e-02   +3.853866893911295e-02   +1.384726625860682e-01; +1.945798764191155e-01   +1.392437101282624e-01   +1.182572650897045e-01   +1.675441910554037e-02   +1.355912431381826e-01   +1.217344651429329e-01   +6.689646786021888e-02   +6.881623545054852e-02   +9.604665223441081e-02   +5.277025819409240e-02   +7.201685765089062e-02   +3.616944123496337e-02   +9.052198610699741e-02   +4.420655861247770e-02   +9.595356714755232e-02   +1.737978823335395e-01];
L1E_L1I_iGABA_netcon = [+2.299365555939682e-02   +2.206884872759132e-01   +1.943501276943574e-01   +1.610808168729179e-01   +9.737227447883970e-02   +1.369583779917654e-01   +1.347086426967496e-01   +7.454805265036482e-02   +1.569059221528524e-01   +5.302549682197242e-03   +1.119767734148850e-01   +4.116182597851336e-02   +4.487461144769282e-02   +1.243948731472835e-01   +9.679808524611543e-02   +1.769976882790271e-01; +1.510011116955343e-01   +3.334665710652801e-02   +6.752447782658957e-02   +4.677076059189309e-02   -2.278569122372531e-02   +9.407454756509445e-02   +5.365741298366000e-02   +1.083277552846358e-01   -5.080071734090082e-02   -3.694818083263406e-02   +1.321420050996644e-01   +4.354391797565928e-02   +8.109983499621531e-02   +8.172035021712261e-02   +1.227211401275446e-02   +8.926824731005026e-02; +3.300261685069676e-03   +1.514921205705926e-01   +1.619867619900016e-02   +1.516275586675286e-02   -1.972074341405061e-02   +5.442810110252816e-02   +1.015946775862896e-01   +1.017295537143540e-01   +3.167026827300292e-02   +1.954819489633578e-03   +1.069801284508785e-01   +9.236876693567402e-02   +4.689558797695688e-02   +3.621153067366975e-03   +9.065211895835272e-02   +9.186463671211734e-02; +8.481998554282352e-02   +7.876161182606758e-02   +1.430870367720809e-01   +6.444794782259758e-02   +6.723234524702079e-02   +1.977045277639175e-01   +8.688266414556169e-02   +1.278300800849691e-02   +8.914053412705183e-02   +1.607706386122172e-01   +1.132403132598605e-01   +1.399889543912037e-01   +5.066809969918147e-02   +1.237854277818519e-01   +4.329851334803840e-02   +6.087052938718457e-02; +9.602204644656682e-02   +1.501891283496850e-01   +1.867966169052473e-01   +1.361604047616765e-01   +5.667738411191915e-02   +7.960567609141882e-02   +1.037962843908613e-01   +9.981338174156200e-02   +1.905712142765186e-01   +7.981889361093644e-02   +1.389304481838465e-01   +7.449723682897302e-02   +3.679882561650412e-02   -5.754311249720463e-02   +5.736942930421951e-02   +1.613412906885900e-01; +1.343205082815284e-01   +1.007561494764116e-01   +7.632250411797252e-02   +9.473609083736777e-02   +7.355899874662031e-02   +3.954275978962492e-03   +4.989776869318467e-02   +6.634922161890051e-02   +1.641075584975310e-01   +9.382865474160162e-02   +1.003278988211253e-01   -3.434638853194304e-02   +1.103064975986472e-01   -3.568146727472550e-02   +5.463499407117643e-02   +5.987342205014126e-02; +2.794013480299032e-02   +1.019664099168462e-01   +2.010289964400071e-01   +4.150403711257817e-02   +2.563928585104554e-02   +2.329054276083292e-02   +1.527996753116018e-01   +1.139955087273421e-01   -1.874217595724135e-02   +1.469610966726090e-01   -2.622568851593997e-02   +1.174950551396838e-01   +1.073493552329156e-01   +8.184531453679753e-02   +2.538199454976214e-02   +5.104730752713833e-02; -6.938051513320120e-03   +7.037342900157623e-02   +5.747752007246080e-02   +8.661098108188667e-02   +1.265324848288468e-01   +3.244655817686312e-02   +4.438625293723768e-02   -1.230084802431766e-02   +1.239021471685839e-01   +9.915333105224625e-02   +1.698379476877074e-02   +7.180277875466506e-02   +1.981698206303154e-02   +4.675577312995026e-02   +4.871543886997558e-02   +2.199487244456195e-01; +9.223848022600843e-02   +1.822160743709560e-01   +1.370251580269437e-01   +6.473010921364289e-02   +1.509598430210862e-02   +1.738447578488993e-02   +3.228912755485114e-02   -3.503471144158363e-02   +1.222694963489157e-01   -2.329249194201909e-02   -1.312365088507985e-02   +1.316046557933898e-01   +1.176515153492204e-01   +1.458802187360396e-01   +1.667339425634159e-01   +1.025955717074748e-01; +9.899721198255587e-02   +1.598750015759699e-01   -2.783153637811792e-03   +2.023435505378571e-02   +1.596725307384812e-02   +8.593976284106561e-02   +1.390801280887824e-01   +3.808235108884052e-02   +1.610309277800588e-01   +2.892279586653476e-02   +7.657350409859279e-02   +4.221809176571462e-02   +1.154659970582110e-01   +1.751176004762110e-01   +1.265127782990973e-01   +1.352827731974008e-01; +9.124529811405155e-02   +5.550352037121316e-02   +6.464426014894833e-02   +5.443426028449992e-02   +1.708395750336689e-01   +1.931149112834886e-01   +1.309462402395969e-01   +7.377799512595967e-02   +7.490196147159967e-02   +5.299271319080022e-02   +5.521141089133944e-02   +1.367574957932454e-01   +4.031427855023195e-02   +3.629638006976879e-02   +2.940373296681632e-02   +8.169663989906746e-02; +1.497123108208988e-01   +3.257878455296811e-02   +4.648648972309982e-02   +9.970895123270002e-02   +1.146682538476380e-01   +1.572332780634723e-02   +1.382691427323235e-01   +7.490131869294078e-02   -8.781792891266111e-03   +6.126121952990556e-02   +1.092558071294754e-01   +1.018622861348988e-02   +7.389628009077384e-03   +1.256778914915899e-01   +1.751027409229471e-01   +1.353776141856868e-01; +2.814609953248066e-02   +5.936019678632062e-02   +1.536752798283753e-01   +7.632689648791315e-02   +1.147749968288857e-01   +4.080053683941385e-02   +8.263240206451053e-02   +1.146925555241262e-01   +1.074521415361767e-01   +1.484650080959701e-01   +7.605849615420399e-02   +8.851758288795039e-02   +4.086271663889640e-02   +8.109368274009472e-02   +6.149622229615541e-02   +3.797182083631383e-02; -3.789026040868630e-03   +5.586479446401432e-02   +5.714705054031202e-02   +1.019604721065078e-01   +1.260562338078611e-01   +6.109304613138245e-02   +1.477672217071299e-01   +3.632883115863293e-02   +7.740209127658525e-02   +9.040417172485961e-02   +5.221334216157782e-02   +6.617701894476122e-02   +1.291531211370779e-01   +1.561091564049887e-01   +1.776444773125048e-02   +2.359657999707136e-02; +6.126722539763870e-02   +9.939646005687929e-03   +1.935453621539494e-02   +1.398761194308676e-01   +4.972585783283518e-02   +5.595166144510420e-02   +5.644250565675140e-02   +6.202222153987998e-02   +7.412012576290349e-02   +1.041618442667295e-01   +7.282868672923828e-02   +1.072251965553598e-01   +1.163410854943885e-03   +4.156261752717431e-02   +5.415703148263036e-02   +1.631469659979736e-01; +8.515949846754380e-02   +3.903086823183162e-02   +2.585992692291243e-02   +1.825256494742716e-02   +8.465994794261020e-02   +1.955237056266893e-01   -7.091017891721955e-02   +1.419240882312811e-01   +1.189721725930282e-01   +1.694599162994502e-01   +1.479899782782204e-01   +8.088922677712794e-02   +6.055465941959180e-02   +2.140501046083401e-01   +1.876578946618266e-02   +7.303655561019473e-02];
L2I_L1I_iGABA_netcon = [+7.575485419053593e-02   +1.391756532217900e-01   +4.544513614912289e-02   +8.613782058618039e-02   +8.991635099624865e-02   +7.222733481637032e-02   +4.025831254544290e-02   +9.152982818069907e-02; +2.783230392678178e-02   +1.610646273268815e-01   +5.355092822455740e-02   +1.208602470332911e-01   +5.876840555177689e-02   +1.198929162864937e-01   +1.163286903648408e-01   +7.815642033392479e-02; +5.737613147000181e-02   +5.114850094234148e-02   +1.825263273512473e-01   -2.111794964764900e-03   +9.719830031006006e-02   +1.176647985665560e-02   +1.397153568001600e-01   +1.017455336171583e-01; +9.215352143054095e-02   +1.276040669822475e-01   +4.478965267795620e-02   +1.159901703764711e-01   +6.214177783515026e-02   +1.454825472286466e-01   +6.047997861086950e-02   +1.180576927620381e-01; +1.778466294816355e-01   +7.575607988215330e-02   +1.057898393518692e-01   +3.353836096774260e-02   +1.297560656038868e-01   +1.219629336901945e-01   +7.885124908331557e-02   +1.224309159308278e-01; +4.679442876284301e-02   +1.159777708191950e-01   +1.276562787966557e-01   +7.867233136860297e-02   +1.072723932134440e-01   +1.033138736086320e-01   +8.147048830101029e-02   +9.665634051478911e-02; +1.150980475131810e-01   +3.961323314160681e-02   -7.632561102432616e-03   +1.079793398359759e-01   +5.539229598024287e-02   +6.245679817778436e-03   +1.082563515342211e-01   +9.907580903451882e-02; +7.439351516499020e-02   +7.906692574879735e-02   +4.898505423638718e-02   +2.150598474883668e-01   +1.707763917657065e-02   +1.234574595292801e-01   +4.841533905550691e-02   +1.248521845636448e-02; +1.084293533304441e-01   +1.025008760841358e-01   -6.367711630050855e-04   +1.489534103499885e-01   +1.175955341872340e-01   +1.850422685091168e-01   +1.962915491879989e-01   -2.644640295897741e-03; +8.078214319259554e-02   +1.693150632233849e-01   +4.560176236276402e-02   +1.804013168998494e-01   +1.368011601276299e-01   +4.036608265943240e-03   +1.112571331613309e-02   -1.244805989044814e-02; +1.518888075710400e-01   +7.442661357342714e-02   +1.936759373852238e-01   +8.111171023950926e-02   +8.401877752496727e-02   +4.750869182148396e-02   +1.965745984025279e-01   -3.221799223901936e-02; +3.281810944884374e-02   +1.223426304068511e-01   +4.833933083368985e-02   +7.193878940053147e-02   +1.918390478031012e-01   +1.177714081243328e-01   +6.972803654542833e-02   +4.948435935971961e-03; +7.862645487179964e-02   -7.306002951038691e-03   +2.036951808248139e-02   +1.357054972634668e-01   +4.822091928507870e-02   +1.015216637218944e-01   +1.217948262495750e-01   +5.667433530028839e-02; -7.786609439100330e-02   +1.038532677975931e-01   +1.817898561718411e-02   -8.149022555225720e-03   +1.143837215139736e-01   +9.671651434300385e-02   +1.026961955947377e-01   +9.352492647815916e-02; +1.937760821255050e-02   +6.067456328803719e-04   +8.601177440449399e-02   +1.200742507930419e-01   +7.866149139316357e-02   +1.117529912109137e-01   +1.368504828198793e-01   +1.189788281675083e-01; +2.943625353351260e-02   +1.283808925681314e-01   +4.172346054680868e-02   +1.435602333472741e-01   +2.053130629477250e-02   +6.714719142366611e-02   +5.338566069108041e-02   +3.110101858158285e-02];
L1I_L2I_iGABA_netcon = [+5.245746691017272e-02   +1.067882682613185e-01   +3.420822799368535e-02   +1.714050294547084e-02   +1.325218888913278e-01   +5.235323131553839e-02   +6.384347166321849e-02   +1.262465756909723e-01   +6.008974031968321e-02   +2.978909145857569e-02   +6.391150687347377e-02   +1.607513966905318e-01   +4.929878952250821e-02   +1.529175136876930e-01   +1.170144354128247e-02   +1.149111862556336e-01; +1.536300643962190e-01   +5.764981787942651e-02   +7.256611982130304e-02   +1.141012714153308e-01   +6.617103838651003e-02   +1.018015463842577e-01   +1.788221759190440e-01   +7.828386348957225e-02   +1.305008419324263e-01   +1.319959659191955e-01   +1.832105797974495e-02   +6.307924985566983e-03   +1.377097272274651e-01   +4.030248616619165e-02   +1.501145598595867e-02   +7.431690488395500e-02; +8.338173116959866e-02   +1.592652989138881e-01   +1.144784005094152e-01   -4.395264570989428e-02   +1.354063855091708e-01   +3.219784340547068e-02   +5.326593592531390e-02   +2.334746634890222e-02   +1.606858284183004e-02   +1.951215827983209e-01   +1.288137488723225e-01   +1.025683439151083e-01   +1.385688456689789e-01   +4.297262944302728e-02   +8.126263574567191e-02   +3.629299485987669e-02; +8.719675741835238e-02   +8.273439450631133e-02   +1.342630827706956e-01   -4.340840122594537e-03   +6.345349170403836e-02   +1.027254299166432e-01   +1.055461755072725e-01   +9.839877225613826e-02   +1.044271014777285e-01   +1.310352472948888e-01   +1.131895439448628e-01   +9.122961548264025e-02   +1.475976458418173e-01   +2.359024712112149e-02   +3.855227720445015e-02   +1.719989919716449e-01; +1.078266010201158e-01   +1.047870885052032e-01   +1.745138142781561e-01   +8.220632989181545e-02   +1.500003065083557e-01   +2.209844214431000e-01   +6.108153141354759e-02   +7.632935961288118e-02   +5.397956197483847e-02   +6.691032205299861e-02   +6.385333184566248e-02   +1.071340541289498e-01   +1.437952858376076e-01   +3.977801673828809e-02   +1.239515169353586e-01   +1.871124085298511e-01; +6.489513205479377e-02   +6.072961879466635e-02   +1.811888481790767e-02   +1.355684442944138e-01   +1.635720308418628e-01   -1.742862207797803e-03   +1.016538459518485e-02   +8.716134773519540e-02   +7.191607561354589e-02   +1.225686867628828e-01   +1.400325913609665e-01   +5.996039809559534e-02   +5.021844788247690e-02   +7.464287917972476e-02   +1.379463701139798e-01   +1.855628026160087e-01; +1.258998242556356e-01   +5.172349325415431e-02   +1.913378512919700e-01   +9.280103811583490e-02   -3.006843623462517e-02   +1.130183355823998e-01   +7.906047159559525e-02   +4.986236662202379e-02   +2.861753424388462e-02   +1.803255372932491e-01   +7.824233060322831e-02   +1.490040535532787e-01   +9.588446987288486e-02   +3.324920419980093e-02   +5.061567177316685e-02   +7.266458713040160e-02; +8.116426476529336e-02   +3.198761559075272e-02   +9.194772810298028e-02   +2.353105409859924e-02   +8.564583851627013e-04   +1.436026132782343e-01   +1.488228277221368e-01   -2.057676696462523e-02   +1.829194094454061e-01   +6.363044252585039e-02   +1.287031572973830e-01   +1.318033618589108e-01   +9.685314967495398e-02   +1.235865446712550e-01   +8.951688088327062e-02   +1.916679981555631e-02];
L2E_L1E_iAMPA_netcon = [+7.444345072843157e-02   +1.819527915511707e-01   +2.126173084922820e-01   +9.292668215355653e-02   +8.569907319840347e-03   +7.313633338320119e-02   +5.166753946397917e-02   +6.205357785770835e-02; +7.155247120599174e-02   +2.282853534899405e-02   +1.259488205038857e-01   +8.608440165458896e-02   +9.110460312910039e-02   -5.546765480957282e-02   +8.903255741398428e-02   -1.611016283469277e-02; +2.780510581674996e-02   +8.353717219981559e-02   +7.009382724124273e-02   +1.274199419607625e-01   +1.371791041938039e-01   +1.532412959833998e-01   +1.710346046946985e-01   -1.565709153977225e-02; +1.039222010683341e-01   +3.357820048539544e-02   +2.062286397689366e-02   +2.357328103589042e-02   +5.714296434193876e-02   +1.404113506473759e-01   +9.088867353318918e-02   -2.077167871954566e-02; +1.337531006430220e-01   +1.472196672701776e-01   +1.249785028387060e-01   +1.006958867391783e-01   +7.466143417305687e-02   +9.761514024704146e-02   +2.561071405242100e-02   -1.213564878858306e-02; +1.911871840830226e-01   +1.677654359445117e-01   +5.064349378275936e-03   +1.439322607937895e-01   -5.585863299257520e-02   +1.432794008697234e-01   +8.952069197952404e-02   +1.064680087417013e-01; -6.945716430077954e-03   +1.601525573723766e-01   +4.466028995517032e-02   +2.963969058124856e-02   +4.587243601905738e-02   +1.959419617323614e-01   +4.120219249338317e-02   +1.304481969157890e-01; +7.329530064192148e-02   +1.935974513158197e-01   +1.655569252036743e-01   +1.378749848477024e-01   +1.395950009919767e-01   +4.627856794318441e-02   +1.280935651294834e-01   +7.750646237424662e-02; +4.880231794801883e-02   +6.520649135307723e-02   +6.214867615448137e-02   +1.150073821004106e-01   +1.926313230649132e-01   +1.164340137133817e-01   +7.421873819495801e-02   +1.357824671980084e-01; +1.918319995295622e-02   +1.814236021966447e-01   +1.453633443941471e-01   +1.199628231167556e-01   +2.150699813101888e-01   +9.179904947112284e-02   +5.437711501529233e-02   +6.881702874916835e-02; +1.126707594986850e-01   +9.754542409573699e-02   -1.188025384664455e-02   +3.343190960625319e-02   +2.981732508629333e-02   +1.684978635793052e-01   +1.143548629358001e-01   -6.216063080990028e-02; +2.024974384104223e-01   +8.836116014713369e-02   +9.987577266905467e-03   +1.406901176588132e-01   +1.297791733295361e-01   +2.182218433817661e-01   +9.990029776626909e-02   +1.514307796347249e-01; +7.939983932604838e-02   +1.776959286774878e-01   +2.185211953891747e-01   +7.290958501673599e-02   +1.226585567812422e-01   -6.063648069929473e-02   +1.119078735335114e-01   +1.397035577944847e-01; +8.777834892968774e-02   +6.504894027658578e-02   +6.513378253516816e-02   +6.048688778708199e-02   +1.247838725983852e-02   +1.030513903380119e-01   +1.023035015823368e-01   +9.972348726995395e-02; +1.048433620574171e-01   +1.362691135979631e-01   +3.936670659215099e-04   +2.040568107735412e-02   +8.165553022145117e-02   +1.337930434394717e-01   +8.350276885485022e-02   +4.572645569557933e-02; +1.446006503344278e-01   +8.844037459412914e-02   +1.407579935874170e-01   +5.315806956989900e-03   +7.995682662674330e-02   +7.835561613573305e-03   +1.217713007267423e-01   +3.015866158301960e-02];
L1E_L2E_iAMPA_netcon = [+1.067424194424765e-01   +9.941965800521796e-02   +1.329040671980045e-01   +1.205018969047900e-01   +1.099300549112763e-01   +5.448864248288206e-02   +1.232393367777865e-01   +1.649605272671792e-01   +1.081882505413641e-01   +7.420092088036979e-02   +1.780422088491309e-01   -2.174788507962393e-02   +5.706058844424870e-02   +1.084478329936439e-01   +1.236748667457827e-01   +1.695906713906566e-01; +1.473136872115093e-01   +1.321901650352675e-01   +1.189709547479582e-01   +3.536867953615339e-02   +1.558810011920167e-02   +8.176885585500566e-02   +9.193962661379954e-02   +1.438668305311144e-02   +1.675136506398951e-03   -4.691002713459344e-02   +4.362513682192803e-02   +5.682779601692869e-02   +6.007508449220112e-02   -6.338184545696315e-02   +2.334831706420447e-02   +5.131044646741848e-02; +6.520050611424991e-02   +9.105683693490935e-02   +1.819996032183403e-01   +1.254926787521997e-01   -1.137907771730279e-03   +1.360401761829866e-01   -6.476770645735779e-03   +1.273206074625749e-01   +9.270361069389235e-02   +7.617456494009527e-02   -4.165819009874405e-03   +1.092495313170014e-01   +8.261066180561140e-03   +4.453514725755665e-02   +6.195894630208926e-02   +6.102787884007093e-02; +8.302849558966435e-02   +4.784625942093077e-02   +4.853202321723687e-03   +1.834507979988593e-01   +2.838195229359707e-03   +2.174484562923066e-02   +1.043223248400740e-02   +1.754198776937298e-01   +1.664576469973044e-01   +1.634352077710245e-01   +4.955525467181676e-02   -3.776698242515067e-02   +4.605546295519466e-02   +7.426672164527362e-02   +2.257011260040856e-02   +1.631387229278229e-01; +1.064741246231773e-01   +4.583889133787920e-02   +3.777111405145478e-03   +2.901203239416502e-02   +1.555795423153129e-01   +1.625981843438679e-01   +1.694038643212993e-01   +5.263645492113893e-02   +3.239494715717305e-02   +7.788668576131835e-02   +2.057701176156003e-01   +4.558723432817918e-02   +1.184431249724435e-01   +1.655899086286300e-01   +7.255593865733728e-02   +1.540726519392177e-02; +2.012614194243142e-02   +6.065593697613240e-02   +7.041734005758149e-02   -3.420999447749319e-02   +9.868193995217647e-02   +2.839344175056733e-02   +1.123396283724025e-01   +1.483162162867125e-01   +1.561546501765197e-01   +1.326504671343368e-01   +4.511454845507782e-02   +5.119762138729131e-02   +1.303264278128499e-01   +9.424026282640169e-02   +2.198490519096045e-03   +1.388291336773883e-01; +4.876366345983667e-02   +5.704012714508242e-02   +7.265073481016507e-02   +8.762772687616618e-02   +9.221808813860244e-02   -2.819586230913247e-02   +1.486034613020571e-02   +5.658783624853395e-02   +9.064448953386946e-02   +6.440787749838797e-02   +4.805519716043056e-02   +6.472206809738824e-02   +1.864840930637538e-01   +1.200283887439873e-01   +1.815812238610725e-01   +1.042678707668165e-01; +8.114233205727604e-02   +3.570600245362277e-02   +1.822403391896028e-01   +1.378906578532935e-01   +1.044268460580201e-01   +7.395614147476379e-02   +1.296847386348916e-01   +2.495912777243836e-02   +5.353185280563015e-02   +1.777649397996519e-01   +1.574269659266129e-01   +1.865123745551200e-02   +1.386572785570586e-01   +3.227493349746125e-02   +1.611697022504500e-01   +1.007317578800987e-01];
L2I_L2E_iAMPA_netcon = [+3.081581044227594e-02   +1.965537112450598e-02   +2.077706311564973e-02   +3.969501469874474e-02   +1.570624712029525e-01   +6.314340809497945e-02   +1.467311648854768e-02   +4.281358634413486e-02; +8.310793073217013e-04   +7.788870725106653e-02   +2.080092376142333e-01   +4.992150341551294e-03   +9.348625121063642e-02   +2.787899793057444e-02   +1.683206924099630e-02   +8.583464071561629e-02; +2.245902450276577e-03   +1.524970454071000e-01   -8.050171848484246e-04   +4.927642107285106e-02   +1.564599145453481e-01   +1.597156679096509e-01   +7.932826680733998e-02   +3.688153851746973e-02; +1.211570156621954e-01   +1.817166303198568e-01   +1.693470058417887e-01   +5.901104780998238e-02   +6.859369608147953e-02   +1.005657768330388e-01   -9.454892088458280e-03   +1.001394719750095e-01; +1.624390018582670e-01   +1.298502301707759e-01   +7.308282421349808e-02   -5.953645640415847e-02   +5.604229007114370e-02   +1.281126931385110e-01   +6.275023719914304e-02   +1.667095322267771e-01; +5.248277153833314e-02   +7.891184554870297e-02   +2.172280236559451e-01   +5.939314921975872e-02   +1.871877714350016e-02   +4.422560833315741e-02   +3.858170887447120e-02   +7.788790745373184e-02; +4.775574871756159e-02   +1.002222160654277e-01   +1.973676752199363e-01   +3.235880291475764e-02   -8.060504923332504e-02   +6.207736016229687e-02   +3.573018869567267e-02   +1.900617536338898e-01; +1.182982005606801e-02   +1.150848201606396e-01   +1.490818928215011e-01   +1.986745958330917e-01   +1.883128128485974e-01   +1.386640499915439e-01   +1.434781647833007e-01   +3.248842176076450e-02];
L2E_L2I_iGABA_netcon = [+1.397209907413317e-01   +8.440847755862263e-02   +9.161146196850337e-02   +3.524598917070364e-03   -3.311791999522805e-03   +1.583288298888257e-01   +1.498599841670552e-01   +8.590944636730943e-02; +2.169093313754110e-01   +1.665262417386544e-02   +6.236459782966365e-02   +2.045913452760519e-01   +6.620535778871781e-02   +2.514773446141249e-02   +2.168662186505512e-03   +1.098645991415740e-01; +7.386747883070062e-02   +7.574597953708333e-02   +9.094530445265159e-02   +8.818840143831536e-02   +8.346083939522109e-02   +1.538177200001617e-01   +1.024776766166953e-03   +5.705183735892749e-02; +1.151531489669043e-01   +6.116536384287404e-02   +3.374051279405975e-02   +5.027184259378609e-02   +8.916646091820410e-02   +1.681241464278152e-01   +1.111597757718201e-01   +8.120441140342066e-02; +8.191697595364728e-02   +1.363870957742652e-01   +1.365806382609407e-01   +1.463718110411857e-02   +2.417052023762174e-02   +7.834721124700367e-02   +1.219689600303239e-01   +1.116731170695850e-02; +1.164057555793257e-01   +4.905018997970127e-02   +3.874985804851383e-02   +9.408243539689680e-02   +6.924129547210094e-02   +1.478673949208812e-01   +6.737788212482101e-02   -2.487968440545703e-02; +1.594317766843013e-01   +5.619583838643016e-02   +1.352908629434229e-01   -6.752245820369724e-03   +8.643388793607384e-02   -3.967337122798302e-02   +9.183668995143009e-02   +4.695451819315048e-02; -1.035401033729496e-02   +1.187030718791234e-01   +4.800660770138093e-02   +1.757620090082679e-02   +7.672025024655843e-02   +1.311354090158099e-01   +3.842489293141686e-02   +1.547320958874469e-02];
L3E_L2E_iAMPA_netcon = [+3.088704405777818e-02   +6.913462569488982e-02   +1.956999001723929e-02   +4.009650571942586e-02   +9.339766845752923e-02   +4.430384625885505e-02   +1.623194022021948e-01   +1.133216858493600e-01   +1.274896001331267e-01   +1.082623842627421e-01   +6.295917208809887e-02   +9.530405579949636e-02; +6.777550617257738e-02   +1.635273230613355e-01   +1.299893498501634e-01   -1.884273567662478e-02   +1.311261312184768e-01   +1.018956463465489e-01   +8.622610957116125e-02   +2.012480783165016e-03   +1.376390443386524e-01   -3.158021836963783e-02   +1.148190924426099e-01   +1.219846216808255e-01; +1.578766600714579e-01   +1.180303886352636e-01   +1.651807684698475e-01   +1.011722480319528e-01   +7.064573512492293e-03   +7.773059611753486e-02   +1.412111079398504e-01   -8.222441819105917e-03   +6.051841348335465e-02   +1.626553050845825e-01   +9.209192089448730e-02   +1.266366816719458e-02; +6.781598903532360e-02   +1.401817567060067e-01   +4.702907090417397e-02   +1.250261841887495e-02   +1.779967942763535e-01   +9.128389019432231e-02   +5.165966901082005e-03   +1.017295948774844e-01   +1.425045127360652e-02   +6.666263189433985e-02   +1.179659117809460e-01   +1.145944654646837e-02; +1.118374594818174e-01   +1.865384832324138e-01   +1.223236788383938e-01   +1.628512592033636e-01   +1.179271570920786e-01   +2.126805462002620e-01   +9.626155614143547e-02   +6.078852955250735e-02   -1.950750708662944e-02   +2.584687477304630e-02   +1.275881182370337e-01   +6.937733226223951e-02; +6.673876026440870e-02   +5.602028127419791e-02   +1.730222273917737e-03   +6.936629465611435e-02   +1.300940913907635e-01   +3.483419632446359e-02   +2.166540949147957e-01   +1.374949259661463e-01   +1.297593917216773e-01   +8.842989453330734e-02   +1.245193657011611e-01   -3.867790838702604e-02; +1.580359703032775e-01   +7.846931453465365e-02   +7.844237479056032e-02   +3.535945605783843e-02   +2.356115956522380e-02   +4.619189480324285e-02   +3.981264458071317e-02   +3.122379791260721e-02   +4.125051634344280e-02   +2.400245694850090e-02   +1.430752528134689e-01   +1.304730428553029e-01; +1.382994866836394e-01   +1.140098865461671e-01   +1.051866408259608e-01   +1.362340456252432e-01   +1.541436601493848e-01   +8.917153713962681e-02   -7.385961850048067e-02   +3.400070820423713e-02   +1.094834721480068e-02   -4.110695597869185e-02   +4.015269503960395e-02   +5.308555787170065e-02];
L3I_L2I_iGABA_netcon = [+1.202082081699048e-01   +1.863685858668050e-01   -5.952815815579614e-03   +1.342858108760099e-01   +2.617169883233314e-02   +1.030796044916960e-01   +1.218088236945939e-01   +4.665627851113960e-02   +4.953593567492316e-04   +3.855959747054163e-02   +8.795084127623326e-02   -2.204209727435601e-02; +8.405352969318831e-02   +1.093675172428351e-01   +5.059781260422081e-02   +7.206119501314065e-02   +9.436730672618988e-02   -8.382339605224418e-04   +1.488802300485786e-01   +1.370570280066336e-02   -2.472157584705103e-02   +1.085805756256902e-01   +9.445265786603219e-02   +2.555322109640102e-02; +1.012451047290012e-01   +1.636313758257637e-01   +1.236855258262088e-01   +9.733523343720606e-02   +1.353595026539241e-01   +7.705385687023614e-02   +2.083624390588604e-02   +5.650199641452657e-02   +1.130965963592430e-01   -5.684590313810344e-03   +1.635344757935223e-01   +6.999116705024862e-02; +8.823999045832362e-02   +1.950576767707416e-01   +1.653627353703652e-01   +7.645362394874144e-02   +1.165781964520995e-01   +1.140218404133226e-01   -4.865025953072338e-03   +3.482797484081707e-02   +1.406573011434317e-01   +1.452862345394587e-01   +3.940672490882498e-02   +1.439695164553237e-01; +5.312376125669045e-02   +1.370274770725460e-01   +1.797163585379150e-01   +1.004113942931213e-01   +1.746956654223869e-01   +4.560364253561360e-02   +4.758191375154164e-02   +1.446551396326171e-01   +1.564183350319320e-02   +2.253907180382332e-02   +2.562135625785892e-02   +1.064904245524623e-01; +9.589917298237595e-02   +7.300788628100528e-02   +1.560191660335482e-01   +7.898170272637971e-02   +1.085079311819230e-01   +1.686999464209034e-01   +5.377862625815332e-02   +9.208027079605227e-02   +2.544193499191062e-02   +3.134968336825024e-02   +8.059890217845926e-02   +1.061935054170832e-01; +5.593975956437264e-02   +6.601203624269426e-02   +1.849906050244549e-01   +1.821640955945824e-01   +1.111249808621862e-01   +1.342150153193989e-01   +5.759667177548856e-02   +4.176627074487662e-02   +2.613035172222289e-02   +1.035606609798829e-01   +1.518160265353454e-01   +6.640938724749801e-02; +4.442309459128871e-02   +4.557955781982814e-02   +1.277083875443721e-01   +2.067213984418071e-02   +1.457645258762631e-01   +1.606132020976678e-01   +1.593545720441508e-01   +1.031923765020087e-01   +5.955515662515759e-02   +9.934524767095303e-02   +1.898761400984772e-03   +1.207416437347413e-01];
L2E_L3E_iAMPA_netcon = [+1.859423961063710e-01   +1.246967359176507e-01   +1.473502514720148e-01   +6.928128673606686e-02   +4.972936056746075e-02   +1.334273796124879e-01   +8.130441845438033e-02   -9.628000798727086e-03; +1.254062528408042e-01   +1.442985599390249e-01   +1.288720295559783e-01   +1.198040891213891e-01   +2.310459877077898e-01   +2.807253224499475e-02   +7.542236080887764e-02   +1.562803631819387e-01; +4.864931029832827e-02   +5.124512625237984e-02   +7.359576175344269e-02   +1.349034275471925e-01   +7.747584822366059e-02   +1.420823649644007e-01   +1.203522842344404e-01   +5.332032365906933e-02; +6.057613794022117e-02   +1.977571542564514e-02   +5.728791346550326e-02   +1.368765146306616e-01   +1.021459096650827e-01   +1.720826820670980e-01   +1.157203226760446e-01   +6.338114686874992e-02; +1.183266646923741e-01   +1.299920125688656e-01   +1.699187600663332e-01   +1.490848956710450e-02   +1.568199755917694e-01   +6.373123049382801e-02   +7.506729641643919e-02   +1.870852427658225e-02; +6.932328966812050e-02   +1.923861359807788e-01   +8.226978969379524e-02   +5.117458411977501e-02   +1.738084275189043e-01   +3.754562268007577e-02   +7.391524303390384e-02   +8.773293563580498e-02; +9.368326456990042e-02   +7.201627821940660e-03   +7.064743669820145e-02   +4.366469623547575e-02   +1.245633954834088e-01   +6.173549658018414e-02   +1.125985579772030e-01   +7.936325589760669e-02; +1.101849419279733e-01   -2.101144509158735e-03   +3.879365885081268e-03   -5.588726241482452e-02   +1.450686575029361e-01   +8.215677906317630e-03   +3.512241814476576e-02   +1.245995812447531e-01; +2.129587910362758e-01   +1.943014127987613e-01   -2.188536112960796e-02   +1.119332023504492e-01   -9.896315543711391e-03   +5.476907780933510e-02   +1.976635180797473e-01   +8.373215879525077e-02; +5.055481572226828e-02   +3.805340081235375e-02   +1.167914451451216e-01   +4.337589399073958e-02   +3.535941200104712e-02   +8.811546583630682e-02   +1.472815887404323e-01   +1.126982261605752e-01; +9.437090429805893e-02   +5.248894211968191e-02   +3.880277569837017e-02   +8.583504730349269e-02   +4.455914367994358e-02   -1.122946288454616e-02   +1.899005882919722e-02   +1.584637609932901e-01; +1.218349354529743e-01   +4.320931355096010e-02   +1.540270780978402e-01   +1.470750864037747e-01   +8.239001023673274e-02   +5.915399740773811e-02   +7.973628968935195e-02   +7.294200141324871e-02];
L2I_L3I_iGABA_netcon = [+5.260026617924625e-02   +8.704911172079324e-02   +6.478580248621262e-02   +1.025789304282854e-01   +6.764654109163465e-02   +7.596338224055528e-02   +4.297155490972160e-02   +1.152426036149844e-01; +4.305764215176774e-02   +1.455380133441427e-01   +1.353411743105502e-02   +1.660117452188021e-01   +1.955616063002723e-03   +1.207647247434486e-01   +6.249407553487851e-02   +4.831955550510483e-02; +1.648273474394683e-02   +1.512994259288369e-01   +1.282081123499312e-01   +1.618530794888333e-01   +2.976851530447028e-02   +5.736363844752737e-02   +1.421898561139182e-01   +1.815481628365950e-01; +1.622665494722467e-01   -2.354209842585102e-03   +9.940640487460374e-02   +6.988985463230189e-02   +6.402722294438101e-02   +1.195428348446743e-01   +1.533404775182338e-01   +2.395489607547410e-02; +5.703939831798951e-02   +1.801674698262146e-01   +1.155980642977358e-01   +1.261556564998944e-01   +2.856763917495048e-02   +9.959383010888204e-02   +1.044335622298189e-01   +1.257989690146115e-02; +8.944198292345093e-02   +1.037791489310113e-01   +5.831037646099622e-02   +2.016451079803118e-01   +4.646933632775420e-02   +2.160966940955605e-02   +1.036202131376903e-01   +9.074026862261317e-02; -1.146433664770662e-02   +1.501606708925944e-01   +2.044163115273362e-02   +1.860262091015667e-01   +1.180146839783457e-02   -3.737186295109607e-02   +1.011032877523445e-01   +9.581104730988430e-02; +4.992239827732460e-02   +4.259683551392553e-03   +1.000539196256568e-01   +8.128850178901045e-02   +1.520271827164491e-01   +8.664881731834163e-02   +2.979062213450053e-02   +3.302354400945120e-02; +8.519684971503572e-02   -5.520560659449221e-02   +1.894377446327570e-01   +2.084993620050083e-01   +1.281139339417243e-01   -5.101535491406857e-03   +5.334885689762243e-02   +1.277227638416795e-01; -2.720257834783382e-02   +1.956067229165271e-02   +2.654066575579491e-02   +1.303166549949057e-01   +1.092424873575445e-01   +3.323020565284728e-02   +9.265621898146979e-02   +7.887505442992074e-02; -3.661106914538970e-03   +1.613228260268284e-01   -2.678510995752702e-02   +1.008469844471076e-01   -3.642328769300100e-02   +1.261340975761977e-01   +8.008019889906657e-03   +4.307393895435185e-02; -2.697899032333473e-02   +5.252646318892268e-02   +5.289349820153126e-02   +4.187120481242633e-03   +1.495704023354810e-01   +1.182446394588747e-01   +6.220680578090455e-02   +4.032693805485543e-02];
L3I_L3E_iAMPA_netcon = [+6.163989461641228e-02   +7.258000711434526e-02   +1.139900353749023e-01   +1.346207311035668e-01   +1.542450892372992e-02   +1.568540696836739e-01   +5.173329089657083e-02   +3.750765956105982e-02   -1.580926666261917e-03   +2.492443758898572e-02   +1.184427195242408e-01   +5.361082078203551e-02; +1.260369632570527e-01   +2.085885405413741e-02   +7.293699867006416e-02   +2.105748308320900e-01   +9.887078968625489e-02   +1.022297172319690e-01   +1.463616697933878e-01   +1.826798859458274e-01   +6.474401994275647e-02   +5.722895489619167e-02   +8.255560484589565e-02   +1.355944743474169e-01; +3.374179654070522e-02   +1.322875903591320e-01   -1.053153660647371e-02   +6.445095957006687e-02   +1.439995037063150e-01   +1.410138652641385e-01   +9.397503929847797e-02   +6.437157402149651e-02   -2.424788569198280e-02   +1.434994004707745e-01   +8.332752706043232e-02   +1.316078982045442e-01; +1.646057858197440e-01   +3.361864052314012e-02   +1.039364114619958e-01   +1.406120216741517e-01   +7.952953565384792e-02   +2.917496056887667e-02   +9.822861637407417e-02   +1.493888323763424e-01   +1.170218211884790e-01   +1.405829959770004e-01   +7.715583745294784e-02   +1.189122650307240e-01; +7.194830533682282e-02   +1.505888121939328e-01   +3.149719365773750e-02   +2.024734198490645e-02   +1.217988184821722e-02   +3.120944639628357e-02   -3.447804844103768e-02   +8.613392371900354e-02   +8.012300531686711e-02   +3.123606287354099e-02   +1.458383617954992e-01   +1.245808063033597e-01; +7.550707708610731e-02   +1.078336194374734e-01   +1.000105166234946e-01   +2.083337280258353e-01   +4.653483799031283e-02   +3.812427109893829e-02   +8.178204751789260e-02   +3.914292166729212e-02   +1.249822338827728e-02   +1.408066065154836e-01   +1.172055450295462e-01   +6.131769444039422e-02; +1.373448437327350e-01   +8.873943376929816e-02   +1.470025741880586e-01   +1.621353664023459e-01   +1.275298465467138e-01   +6.614236123932815e-02   +6.424498158963086e-02   +1.844721762516009e-01   +7.705279395149006e-02   +4.804729622376694e-03   -5.881600136387143e-02   -6.373193631792903e-02; +1.676702917690795e-01   +1.021628731675821e-01   +5.030322697018418e-02   +9.267195026587667e-02   +3.024703521572845e-02   +2.837316474213111e-02   +7.058427746815238e-02   +1.791948731628597e-01   +6.838748723653222e-02   +9.062625049287580e-02   -3.270794451222536e-03   +2.350300843632858e-02; -7.467644872170643e-03   +7.074303935521617e-02   +3.917936927723206e-02   +9.861978066970627e-03   +3.985735811887323e-02   +8.277794721691155e-03   +1.031267191962529e-01   +5.018596585777026e-02   +8.932043105005254e-02   +1.732951942887946e-01   +1.058399671343517e-01   +1.427214125739841e-01; +1.332137546863246e-01   +1.610972366752090e-02   +1.037300220133355e-01   +4.175563765187727e-02   +6.882242223615419e-02   +4.925227133173984e-02   +7.571467942821140e-02   +1.603795403204211e-01   +1.221908703459123e-01   +5.300931524606288e-02   +1.963145945924882e-02   +2.137433570132207e-02; +1.421850532995575e-01   +8.081292346278791e-02   +5.568174234443395e-02   +5.001551001666474e-02   -7.754561564772395e-04   +1.363351544428975e-01   +7.731544379799582e-02   +1.497760503000515e-01   -3.975291560285816e-03   +6.045025261163253e-02   +9.303243846386397e-02   +1.262695606505093e-01; +9.568580682876283e-02   +2.142805510282613e-02   +6.564358571360593e-02   +1.949752492174608e-01   -1.737116889678482e-02   +3.840745052305732e-02   +1.300247770702818e-01   +5.130059553921484e-02   +3.326177785465282e-02   +1.496719671490503e-03   +8.507790901708467e-02   +2.030428265756996e-01];
L3E_L3I_iGABA_netcon = [-4.290856746115885e-03   +1.713517296422201e-01   +4.918390191689460e-02   +1.572399115890146e-01   +1.505477577036906e-01   +1.390069131713168e-01   -1.909332514310360e-02   +3.591526025798114e-02   +1.447653705444119e-01   +1.281174089912153e-01   +2.066675726098109e-01   +6.643326875195801e-02; +3.048798256820274e-03   -1.516249148291042e-02   +2.008008632120087e-01   +1.076371573981959e-01   +6.680182262117274e-02   +7.991678464871646e-02   +1.415741039285605e-01   +5.525818713859930e-02   +5.756441859568858e-03   +2.094844971148336e-01   +8.274384789828981e-02   +1.132103088864744e-01; +7.342598767869886e-02   +1.614257560193108e-01   +1.410362203176720e-01   +1.609265245626397e-01   +4.167719516761430e-02   +1.237084598835807e-01   +5.566533289277871e-02   +4.407296988738290e-02   +1.298672700852590e-03   +1.211782774969913e-01   +4.367191992426019e-02   +1.616268226214230e-03; +8.870541069320406e-02   +1.352147869398169e-01   -8.875633860354233e-03   -2.673589126406930e-02   +2.995829689470328e-02   +1.576123448519304e-01   +1.074758567837589e-01   +1.048734555942235e-01   -8.117056835492322e-03   -1.903704909333252e-02   +1.047517975944258e-01   +7.033686973035989e-03; +1.226837457962741e-01   +1.191007203071741e-01   +2.299414779196055e-01   +1.162863704990923e-02   +1.273602048086456e-01   +4.858020945187217e-02   +1.419626009174731e-01   +8.513387526177707e-02   +1.218201741105711e-02   +1.652524579357636e-01   +5.159166981399317e-02   +4.498556119768855e-02; +6.412521372371295e-02   +2.537672748277393e-02   +1.061410714897202e-02   +4.444834712831364e-02   +3.342406632892024e-02   +1.800199854621563e-01   +5.038736272455013e-02   +5.013911056043305e-02   +9.780411431808961e-02   +1.669433496901862e-01   +1.076497172807766e-01   +3.239956080618126e-02; +1.127995710942572e-01   +9.738280726173766e-02   +4.381245306026092e-02   +2.932854165846913e-02   +7.998452554234479e-02   +1.432955765242898e-01   +1.394831573224199e-01   +1.304952635319431e-01   +9.341101243997225e-02   +1.343203554491557e-01   +9.983926155566275e-02   +7.461194485071396e-02; +1.065482314523205e-01   +1.130009767540473e-01   +1.118892851384723e-01   +1.821276736110327e-01   +1.048672796002695e-01   +4.475929226282598e-02   +3.316203774201473e-02   +8.430080873739612e-02   +6.653863400938013e-02   +5.122506546396314e-02   +7.262611908064888e-02   +1.054379196464189e-01; +1.631278541613130e-01   +5.007681755238085e-02   +1.275727909694756e-01   +3.738118529788316e-02   +1.501403271874083e-01   +5.302048603312773e-02   +4.237960863331407e-02   +1.204457557605281e-01   +7.055912163610763e-02   +1.700819762851542e-01   +1.428616185881693e-01   +1.261579237720042e-01; +1.130398640905999e-01   +8.265393759645401e-02   +1.010714434801520e-01   +3.853277990649184e-03   -1.401573018795859e-02   +7.372311109452848e-02   +5.004828088875486e-02   +2.621271150438866e-02   +6.661253371514800e-02   +1.239801688754788e-01   +7.471934460645405e-02   +8.842025876929541e-02; +9.043422242587702e-02   +1.447170567949127e-01   +3.771990088864809e-02   +1.895254002875237e-01   +2.032970901623827e-02   -8.435041983703498e-04   +7.550709715922560e-03   +4.938874441568344e-02   -1.755394879530898e-02   -3.122268797208029e-02   +1.804956880026388e-01   +1.581641136728922e-01; +1.150819176047479e-01   +9.104920224827394e-02   -3.760419213470763e-03   +7.984608965581189e-02   +1.118100980092337e-01   +4.747754809963801e-02   +1.318575419488585e-01   +1.320945883646992e-01   +5.830706447957718e-03   +2.457608181324179e-02   -1.284903102468077e-02   +5.535603156473095e-02];
L2E_Input1_iAMPA_netcon = [+6.623187125562922e-02   +6.142552876989608e-02   +5.752880476472887e-02   +6.058342869509578e-02   +1.230722587844423e-01   +9.597955763215921e-02   +5.255526598566623e-02   +1.237921210977125e-01];
L2I_Input2_iAMPA_netcon = [+8.155356217463305e-02   +3.778381786242027e-02   +1.962769014133742e-01   +1.244896677593245e-01   +1.055338569667001e-01   +2.796034372670156e-02   +1.327757025518324e-01   +1.670521601915742e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
