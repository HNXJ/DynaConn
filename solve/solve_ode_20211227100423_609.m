function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.451392961189710e-01   +1.494244844042653e-01   +3.931819084014537e-02   -1.720078252834241e-01   +1.576040040616875e-01   -2.787471783205784e-01   -1.769002144678858e-01   -7.107629509799492e-03   -2.962691558996695e-01   +3.806211329202562e-02   +9.398431077079404e-02   +1.846595817037625e-01   -3.729091571606455e-01   -1.617608367476311e-01   +3.778820219139351e-01   -3.762641607305238e-01; +5.552227675218376e-02   -1.001743134497503e-01   +2.487946333225275e-01   -1.042560672537705e-01   -2.812012879608617e-01   -4.782425237100981e-01   -2.494471801622592e-01   -1.950229527121514e-01   +2.173235390112860e-02   -1.710723103015502e-01   -4.283786386945720e-02   -1.875000803463474e-02   -6.996588175293522e-02   +1.025376155342328e-01   -1.306865970415652e-01   -3.247913547572450e-01; +9.771913865916390e-02   +1.116671604723328e-01   -1.827051362517045e-01   -9.655984753316239e-02   +1.245070953351728e-01   -2.737689052069255e-02   +1.287179589239270e-01   +1.703831091252845e-01   -2.568941297599564e-01   -3.899099891579353e-02   +2.387676550033502e-01   -4.698381880067963e-02   -3.006695680802590e-01   +7.192560297836824e-02   +1.809221469985735e-01   -5.372609472765846e-02; -2.166259486780540e-01   -1.310507168180610e-01   +9.026240925954571e-02   +6.155524878442557e-02   -8.970814427143525e-02   +4.010349246623431e-02   +4.036733430977006e-02   -2.699149040282185e-02   +1.268900961990924e-01   +5.207620336047862e-01   -1.202521802552496e-01   -3.664708538233404e-01   +8.399241629909571e-02   +1.491555479845741e-02   +1.382184699733355e-01   -1.273263266485912e-01; -1.115305365564148e-01   +1.715037540986616e-01   -2.700001705067231e-01   -1.381770162699941e-01   -1.288395959272482e-01   +1.860138829065472e-01   -1.117837166431720e-01   +3.017235672339908e-01   +3.655832327789782e-01   +1.232259691649367e-01   -2.359723044563047e-01   +4.283334221563730e-02   +2.800552039751193e-01   -4.389092130191652e-02   +1.614040399771623e-02   -6.008260584963958e-02; -1.490155915610061e-01   +2.272203582494681e-01   -1.343033065284708e-01   +2.584538168575110e-01   -2.612798434815148e-01   +4.421566082988920e-02   +1.041251943659579e-01   +7.107453389561952e-02   -1.876002288471518e-01   -1.733685924336060e-01   -3.212144553612994e-01   +1.573506824520402e-01   -1.759161668999668e-01   -9.841309511368217e-02   +1.261498949407562e-01   -1.567880350232772e-01; -1.232065677710509e-01   +3.088159011191063e-02   +1.340227908959672e-02   -4.995705129678002e-02   +2.029438285447474e-01   +1.627556066005786e-01   +2.909959086317719e-01   +1.294256071243909e-01   -1.979150500351727e-01   -1.234226134773304e-01   -2.399973832946178e-01   -1.961577278571642e-01   -7.297854007960990e-02   -8.734445756314552e-02   +9.864131385036211e-02   +2.707840640164524e-01; -2.152276020033652e-01   -5.982501930555616e-02   -6.523873750697980e-02   +1.622994472834028e-01   -2.014025717142106e-01   +1.246998864621747e-01   +1.855436959531092e-01   +1.175496813486609e-01   -7.619707424700868e-02   +6.560133346436557e-02   +2.057903695869235e-02   +9.875648498454401e-02   +3.365351396451701e-01   +4.147660593611764e-01   -1.537491881082918e-01   -3.066040000990496e-01; -2.374783689207457e-01   +2.298814026874081e-02   -1.526063870300215e-01   +1.758087654086954e-01   +3.375500605087343e-02   -2.997894216066219e-02   +1.363268377110727e-01   -1.224727993502355e-01   +2.108031163527316e-02   +1.805404239557001e-01   +1.775275157272495e-01   -1.138560944485562e-01   -2.222960163911735e-01   -8.119578731949156e-03   -9.828103800007225e-04   -1.989716427362247e-01; +4.911279361834692e-03   +5.265541611726920e-02   -5.415463994260262e-02   -1.380318021303620e-01   -3.424439047054594e-01   +1.199247059714922e-02   -7.110358254098764e-02   -6.117919179272258e-02   -3.119405954396241e-02   +4.176412826955078e-02   +3.265837361744400e-02   -3.124566576652129e-02   +2.575052951888938e-01   +9.135143952446030e-02   -1.577229020485469e-01   -3.628405440713439e-03; +4.207007044637373e-02   -1.144987884664260e-01   -1.547481744158776e-01   -1.813795774307647e-01   +5.347175569069322e-02   -3.900615428595318e-02   -9.200488546873457e-02   -7.387580559832060e-02   +3.905822352393842e-02   -1.155217758854872e-01   -1.110747639446068e-01   -2.725417513600245e-01   -2.239515149994367e-01   -2.821429748422700e-01   -1.524014774655237e-01   +4.164234882622183e-02; -9.620469071345249e-02   +4.536863146406642e-02   -3.376906560078449e-02   +2.097695344956869e-01   +4.813999873244502e-02   +2.349273299365237e-01   -6.304412908713318e-03   -2.490116601890690e-01   -8.926420642485280e-02   -1.702179935075778e-01   +5.107465099286725e-02   -1.907560951062666e-01   +3.475980075509624e-02   -2.268175671468631e-01   +3.510625261491866e-03   +4.284758181583884e-01; -1.193824915326444e-01   +1.511363565652902e-02   +3.085500665838073e-01   +4.900296327975709e-02   +1.706390686713710e-01   +5.678548559631147e-02   -7.211938044692340e-02   +3.683874621621339e-02   -1.228693113110317e-01   +2.126605397287362e-02   +1.785578498298173e-01   -5.718966857634851e-03   -8.317613789984060e-02   -2.429101821186677e-01   -2.848712504614859e-01   +2.196896039957449e-01; -2.135067747625900e-01   +9.985048563761159e-02   +5.512970703411828e-03   +1.510802555035449e-01   +1.874624834020881e-01   -7.224623512636077e-02   -1.590355782183640e-02   +2.539258275566358e-01   +1.321779397714579e-01   +4.764202121773239e-02   -1.061032414346874e-01   -6.442538032667103e-02   +6.526023106388704e-02   -5.220389763599190e-02   -2.642035571062415e-01   -2.094788113360739e-01; -1.167087845918207e-01   -2.944446008056811e-02   +1.018235641620978e-01   -6.916091932379501e-02   +1.471081663075972e-01   -3.406904194827216e-02   -1.208182268615300e-01   -1.245543941227198e-02   +8.647394607658557e-02   +2.134797326734963e-02   +2.042076040935874e-01   +3.298904367599679e-01   -2.206220419139358e-01   +2.450818872473386e-01   -2.477820191188123e-01   -1.242208923392307e-01; +1.561145587248893e-01   -8.222834837067990e-02   -2.035519026340035e-01   -1.141225121517195e-01   -2.165814599066977e-01   -1.592541007748359e-01   +3.071701388695862e-02   +2.285416030174710e-01   +8.494189389360376e-02   +2.569972312721816e-02   +1.380191628287912e-02   +1.227681167187628e-01   -1.470603940107547e-01   +8.708659490718451e-02   -1.438668436958565e-01   -2.879559972581636e-02];
L1E_L1I_iGABA_netcon = [-2.842156006022903e-01   -2.027021121356885e-01   -3.442768032959677e-01   +8.834526975700210e-02   +6.250700648694935e-02   -8.966739217435693e-02   -1.106699852791530e-01   -1.134067424772606e-02   +1.284778531792806e-01   -3.437692299132540e-02   -1.593114459636585e-01   -1.913303107479035e-01   -9.087740904318192e-02   -1.740093105320350e-01   +1.426542069793524e-01   -6.887689364599106e-02; +1.618621913809703e-01   +1.263824766354261e-01   -2.335528894564939e-01   -1.860874194780920e-01   +2.226965547781505e-01   -1.878832252833097e-01   +2.922327502521249e-01   -2.338649289007468e-02   -9.672138661937985e-02   -1.055368235387788e-01   +1.910838842464525e-01   -1.691393359628903e-01   -1.798155168121650e-01   -8.917365886768559e-02   +5.763897804665324e-02   -1.197392583159137e-01; -7.166081762309016e-02   -2.101430063648631e-01   -4.899891933108947e-02   +8.554184634632397e-02   -9.952194130983706e-02   +8.937531576840668e-02   +1.010691295106382e-01   -1.056463958893647e-01   +7.453766754836560e-02   +1.840135054198450e-01   -2.800533141756545e-01   -6.281481761842819e-02   -3.932019194765706e-02   +2.271999226481521e-01   -1.179538840615074e-02   +3.007348746507765e-03; +3.524074458781341e-02   -7.322490002531157e-02   +2.488280708877695e-01   -6.384559704073714e-02   +3.053925734403689e-02   +6.581334385997244e-02   -3.987838978594794e-01   +5.871140732528881e-02   -2.794525208081284e-01   -5.891227238943394e-02   -2.183308270117851e-01   +1.430174496354627e-02   +1.725296231145971e-01   -1.804027836781448e-01   -2.894497022873044e-01   -2.908997029862218e-01; -8.290357696003200e-02   +1.430073370328052e-01   +3.936306144371342e-02   +1.212648395748406e-01   +6.466149159225471e-02   +6.805554073527267e-02   +3.859481583880349e-02   -8.979847590818978e-02   -9.727371619421638e-02   +3.333633787958220e-01   +2.174062165256260e-01   -1.307710780896362e-01   -3.443239808808109e-02   +1.498565579681625e-01   -2.499879955265532e-01   -1.822345923544801e-01; +1.482511782294799e-01   +5.885977082418110e-02   +1.387005497356923e-01   -4.132164465971593e-02   +7.746693906960005e-02   +1.112636649855795e-02   +2.390846265288291e-01   -1.809424580013995e-01   +1.571360496358307e-01   -1.749371065094858e-01   +1.094000041997632e-01   +8.171260081563464e-02   +2.195908207930902e-01   +2.085957709267008e-02   +4.764286673174428e-01   +5.607282428919746e-02; +1.358904381483759e-01   +4.068268670681152e-02   -3.982102249426299e-02   -3.345646736179890e-01   +7.963483661155323e-02   +6.937626670298189e-02   +1.305245324280232e-01   -4.507330760182934e-02   -1.135509608082823e-01   -6.030381064638397e-02   +1.723568014802490e-01   +1.555478663098473e-01   +2.462247186186199e-03   -2.428646688707853e-01   -7.124602058801084e-02   +2.139559501354261e-01; +2.979295177626122e-01   +4.222406961945566e-02   +8.389480524453252e-02   -1.484769356291735e-01   +8.155233467098176e-02   +3.792224360447315e-01   -1.561473654059044e-02   -1.148322196191469e-01   +6.287190748688998e-02   +1.064095842304458e-01   -2.734987600409658e-01   +1.780716838165666e-02   -2.166441674257002e-01   -1.735243442185442e-01   +2.344401054515659e-01   +6.790639096321251e-02; +5.693268003089100e-02   -2.150985890876983e-01   +1.263981116653473e-01   -3.107151106379540e-02   +1.810244732537817e-02   +1.047382456847255e-01   +9.648546832762396e-02   -1.639100357186159e-01   +1.525848159149885e-01   +3.200997038406436e-02   +1.762302855345797e-02   +2.119276855831756e-01   -2.530189141920217e-01   -1.580604700786488e-02   +7.682324483176892e-02   +2.539805958402963e-01; -2.356916631240442e-01   +1.699039329796415e-01   -1.770539809727875e-01   -5.213040353663074e-02   -1.447833433966604e-01   +1.098321590763611e-01   +3.658824422606705e-04   -2.599568797238944e-01   +1.437804529089528e-01   -2.335870839524360e-01   +8.789090288026664e-02   +2.450523076740747e-01   +5.575996810551499e-02   +6.725158031258432e-02   +1.888073172747058e-01   -6.060674647231127e-02; -1.115630312066127e-01   -8.314506004963729e-02   +1.540375720942370e-02   -1.849787969277774e-01   +9.271027856241799e-02   -2.268898315417698e-01   +2.575638902351443e-01   +2.779705456506211e-01   +2.074968697517436e-02   -7.030063773773039e-02   -8.048952435308608e-02   +4.782569353761268e-02   +6.173897953235799e-02   -1.526555484297168e-01   -1.775827611632993e-01   +5.126168224912097e-02; +4.088879763025618e-02   +1.308627417921089e-01   -1.246505997681352e-01   +2.687746521976597e-01   -1.828226109576406e-01   -2.129773803409257e-02   -2.943848451682257e-02   +1.085852908648217e-01   +2.020655932783424e-01   -1.888473064437818e-01   +8.603521578161549e-03   -1.550172855592956e-01   +1.324410424892297e-01   -3.755447797050954e-02   -2.844729641973623e-02   +2.589451342762111e-01; -5.818615625013170e-02   -2.803500703690371e-01   +1.025882814712398e-01   +1.295975737350684e-01   -8.039165877950308e-02   -1.633801203939511e-01   +2.323944533690844e-01   +3.969941849492585e-02   -7.468443778787212e-02   -2.572216728069555e-02   +1.465601066594409e-02   -7.740063412840101e-02   -2.839720607868342e-01   -3.009421630121160e-01   -1.449574793193343e-01   +2.422209749407356e-01; +1.765421571901610e-02   -3.301725503613091e-02   -2.345369489100444e-01   +1.647282820370460e-01   +7.563269843639225e-02   -1.271123181629383e-01   -7.680321797059469e-02   -2.895087581920983e-01   +1.558910175028393e-01   -1.934201089263411e-01   +7.807396276155298e-02   +3.805315573715939e-02   +9.857516529781354e-02   -1.354807377319951e-01   +1.243630593650004e-01   -1.053895012742950e-02; -1.272441798786657e-02   +4.802211050716375e-02   +7.581844091473536e-03   +1.838546728149432e-02   -8.893859525566072e-02   +5.977947233832381e-02   -3.627698822750781e-02   +1.404514375571540e-01   -5.713543076931617e-03   -1.322470607905135e-02   -2.931010063395266e-03   -3.483319044820831e-02   -5.390898144529813e-02   -3.993197465590204e-02   +2.163516638907130e-02   +2.703103106272880e-01; -2.709460928729990e-01   -1.316589569509291e-01   +5.561228930118414e-02   -3.312915802419901e-01   -1.294523913131858e-01   -1.759149912180796e-01   +3.138408101244182e-01   +9.138725341723564e-02   +1.193025090233404e-01   -2.375562834034216e-01   +2.974914081187956e-02   +1.088750705399716e-01   +3.827761113281856e-01   +1.467487345907599e-01   +1.504650195369987e-01   -3.780411370511851e-02];
L2I_L1I_iGABA_netcon = [-1.913441132690826e-01   -1.737706936246375e-01   +2.468922383491425e-01   -3.068920784960712e-02   -1.647981719408746e-01   +3.910567925565601e-01   -3.222822100426841e-02   -1.061303948543362e-01; -5.575428912395528e-03   +1.667333913556687e-01   +9.767771727197036e-02   -1.696772119123318e-01   -1.039627161039115e-01   -1.633765317147354e-02   +8.210581785657336e-03   -1.147489334533931e-01; -9.850633790841595e-03   -1.882219443997064e-01   +4.169732858388178e-02   +1.140071026982612e-01   -9.784324886849294e-02   -7.389090056112259e-02   +1.135956455897263e-01   -1.880858806605791e-01; +3.257621488072091e-01   -1.381085900177203e-01   -9.843453284599103e-03   +3.787070633336907e-01   +4.911582875908142e-02   -2.752584286203749e-01   -7.032803013981555e-02   -2.937582985592571e-01; -5.893012749332700e-02   -4.018323248919713e-01   -1.959494128318983e-01   -3.670354960356444e-02   +5.547911977524116e-02   -1.795628309360016e-01   -1.726889947114113e-01   +7.301084921870919e-03; -1.358025169974884e-01   +1.505090670862219e-01   +1.952411952975165e-01   -1.776415974924343e-01   +3.025885739601192e-02   +1.207351588382858e-01   -1.210020999990654e-01   +1.937413073441169e-01; -2.639820342569281e-02   -1.393438048990787e-01   -2.169770884829698e-02   +3.468269538953978e-02   -5.842379478975975e-02   +7.345687783398142e-02   -6.935324542378397e-02   -1.508643896132706e-01; -1.356363257398750e-01   +1.976627063112578e-01   -4.567379765464405e-02   -6.895614415906130e-03   -2.784256182874947e-02   +4.356055440543764e-01   +1.049491847990452e-01   +2.437329009094241e-01; +1.395246132335728e-01   -1.364540933682614e-01   -8.523083437470819e-02   -3.120769211364999e-02   -1.113295081903691e-01   +2.672570301134031e-02   +1.084266676328458e-01   +2.024954953399215e-01; -6.741965881860709e-02   +2.455225031705364e-01   +1.771269333629755e-01   +1.309641110226443e-01   +1.307302280143614e-01   -1.840793530251707e-01   -1.967901882867970e-01   -1.730201757344051e-01; -4.914400337651224e-02   -3.384992949929837e-01   -2.645621072681924e-01   +2.366749952596786e-01   -5.409737499994306e-02   +1.015740072882138e-01   -9.046882017779294e-02   -6.425813021325789e-02; -2.026345186642647e-01   +3.036178904747421e-02   +1.656643053065439e-02   +3.302659856361425e-01   +3.553030660521205e-01   +1.298392996896265e-01   -2.355333660619781e-01   +5.306804301084750e-02; -5.842975571924259e-02   +1.657869399853290e-01   -5.678680184928058e-02   +1.335731356166495e-01   +2.810155879705900e-01   -6.452865206109654e-02   -4.246168294154151e-02   +8.419010063355521e-02; +1.359817098266614e-02   -3.530792384371476e-02   +8.596455874872821e-03   +5.089372201287474e-02   -8.089816388227750e-02   +5.891923406957691e-02   -2.049922780322236e-01   +1.461429532623624e-01; +1.704806573599599e-01   +1.734601439450452e-01   +6.219522387663072e-02   -1.107098255167856e-01   -8.684694934434202e-02   -7.125497612624747e-02   +2.467437733911598e-01   +1.706271903861284e-01; +1.401819532166719e-01   -4.567747794405769e-02   +1.749607067613129e-01   -1.402294309704949e-01   -2.559584712590398e-01   +2.349876683392915e-01   +2.804169923978819e-01   -8.076848072736677e-03];
L1I_L2I_iGABA_netcon = [-8.941472223877893e-02   -7.969914310556003e-02   +1.849412068015489e-01   +1.547411312760620e-01   -1.631384520612691e-01   +6.243412210760043e-02   -3.536339844119409e-03   +1.199029892933802e-01   +2.121712858500791e-01   -2.576732519892432e-01   +1.542276753728576e-01   +2.835502552129279e-01   +2.128431288198939e-01   +1.769220151605702e-01   +8.276713344246833e-02   -1.630251201735519e-01; -9.348235994313250e-02   +3.302967426014098e-01   -1.490593099447919e-01   -2.646057316630336e-01   -2.721965987053810e-01   -2.315080859920261e-01   -3.550638035962986e-02   -5.231070805158635e-02   +1.778015022312502e-01   -3.563260314029398e-01   -1.376554248916193e-01   +1.404593075474020e-01   -2.137383821090814e-01   +2.687780652127293e-01   -1.689228145702492e-01   +8.136452205595250e-02; -1.985125344197707e-01   -1.810893622570139e-01   +1.887321854234910e-02   +3.178423242367070e-01   -2.839772143462604e-01   +1.883397460599538e-02   +1.821089001806338e-01   -2.846729589715991e-02   -3.331232244353152e-02   +7.155409525121698e-02   -1.114985353412649e-01   +4.751959551785068e-02   -1.720802484971264e-02   +2.276514176970994e-02   +1.886204654686053e-01   +9.330881929344335e-02; +3.972405928376387e-02   -8.558431740534006e-02   -3.140382119931555e-02   +2.585265925372361e-01   +9.399949187601275e-02   -2.624302266326876e-01   +6.628264809913530e-02   +1.239976119768611e-01   -3.084209388169897e-01   +2.137353304072581e-01   -1.746172464877607e-01   -2.667111055212620e-02   -1.092285119990981e-01   +6.969298749871462e-02   -1.591001995627482e-01   +1.825678432782903e-01; +4.410347513068481e-02   -1.552353470069082e-01   +3.775712404665482e-01   -1.564911908739702e-01   +6.309536192699935e-02   +6.289755170440506e-02   +1.822767641029837e-01   +1.323191095407353e-01   +1.991531837045826e-03   +2.317237577700929e-01   -1.576389700854161e-01   +1.390119625725465e-01   +1.747040831691911e-01   +1.477439194759648e-01   +1.759465384271454e-01   -2.222887259300959e-01; -1.927914871887308e-03   -9.188967523214758e-02   -1.569677496445077e-01   -4.120991636411798e-02   +1.387268125565464e-01   +2.099272835766131e-01   +1.147063089841765e-01   -1.915881205647564e-01   -2.458734467224605e-01   -1.545242770276629e-01   -9.607172682946942e-02   -1.513335622319569e-01   +5.239981897330220e-02   -4.620498092567055e-02   +1.847706678106770e-03   -2.031690011749520e-01; -1.154127290598395e-01   -2.277750736838396e-02   +6.121858489537654e-03   -2.557410272553191e-01   -2.222467558870760e-01   -5.092304268112894e-03   -2.461866380587504e-01   +1.877876637695798e-01   +1.658804049468258e-01   +3.480124961136897e-02   +1.197770844882138e-01   +2.005628952694124e-01   -3.160705457563881e-01   +4.801795035520606e-03   -1.345978922858668e-01   +4.056030880559064e-01; -1.630632595542579e-01   -1.807236267960162e-01   -1.389050013065380e-01   -5.252281128611354e-02   +3.292538927255373e-02   -2.827648321187229e-01   +1.275124891132705e-01   +7.385262506779580e-02   +4.247499497764327e-02   +2.271994211844266e-01   -8.202923779378674e-02   +2.697231183756918e-01   -2.249723745037522e-01   +1.112932944780854e-01   +1.804333577259489e-01   +7.524023108602773e-02];
L2E_L1E_iAMPA_netcon = [-1.997294139850961e-01   +2.058188539667536e-01   -8.522285824605177e-02   -2.706414864923525e-01   -6.634057057823547e-02   -1.189947327143995e-01   -2.770775209946894e-01   +1.422953962302638e-01; -4.939690553947384e-02   +6.393380211551698e-02   -4.224048005887660e-01   -2.383639173702917e-01   -1.943733307584837e-02   -3.913728322056596e-02   -7.906989173610701e-02   -3.492259052994407e-01; -6.029922195466184e-02   -3.019507064127759e-02   +2.803912710852567e-01   +2.511329517016770e-01   +5.426450837856503e-02   +1.593303887555680e-01   +4.694486742183433e-02   +1.852292898081009e-03; -9.301247070173289e-02   -2.744984888496663e-01   -1.710252842216118e-01   -2.557155645592094e-01   +1.787305466860210e-01   -8.088385990815061e-02   +9.580414524023997e-02   +1.414149199401757e-01; -2.944214336567025e-03   +3.776636805613194e-01   +3.723098214907017e-01   -9.750538512239976e-02   +5.488439281988558e-02   -5.780420052693096e-02   -6.509600259552911e-02   +1.868099702923940e-02; +3.332929065366826e-02   +2.530790641506456e-01   -7.473595221741695e-02   +3.162223212875800e-02   +5.910441283107505e-02   +1.257227942783262e-01   +1.393611713493857e-02   +2.714850714661748e-01; +1.664252200023762e-02   -2.320198237076957e-01   -1.271974087738858e-01   +4.556170210577351e-01   +7.764228761632677e-02   -7.643504608801452e-02   -1.336710140599674e-01   +1.653752462661900e-01; -3.619941543909719e-01   +2.239681642281262e-01   +7.703009446881398e-02   -1.327608338187078e-01   +3.058440149551864e-01   -9.231416668639700e-02   +1.386593407255126e-01   +1.060837841337021e-01; +1.075542287657796e-01   +9.144999252470003e-02   +3.828304310529085e-02   +5.959385643446375e-02   -1.906795505320830e-02   -4.212606067378748e-03   +2.424555711569319e-01   -2.542892743163168e-01; +2.708414516641694e-01   +1.220652554911896e-02   -4.114315282316446e-02   -4.992919678758232e-02   -2.366848375882576e-01   -8.332578480224687e-04   +3.170328357563060e-01   +1.790398153883108e-01; +1.239507519594888e-01   +2.732481772963641e-02   +3.575826904863009e-01   -1.362713480819246e-01   -1.569159552029069e-01   +1.094578998812017e-01   -1.752668958951190e-02   -1.646364479402352e-02; -6.098155006753746e-02   -1.309205721502704e-01   -5.295198785478349e-02   -6.243832831325167e-02   -2.084532241483107e-01   -1.248184478413897e-01   +7.086748447060223e-02   +1.564948463948833e-01; +2.968721241757311e-02   -3.103705812027550e-02   -1.835433711227195e-02   +2.789346275952799e-01   +1.003756369788328e-01   +3.996822168811841e-02   -2.266114525245995e-01   +7.311552754648970e-02; +4.205459711485733e-01   -7.062876906662993e-02   -1.351482620418497e-01   -6.283754512950646e-03   -1.405029291098914e-02   +1.333955296160149e-02   -2.170047125314408e-02   +2.051810634760371e-01; -1.504838035280326e-01   -7.683372523721242e-02   +1.945445932646717e-02   +7.834808081553954e-02   +1.965876960626831e-02   -2.887746175412307e-01   +1.328412124325680e-01   +2.654673227467688e-01; -2.575031955037111e-02   -1.857934121209435e-01   +2.381456353969210e-02   -1.116201325845904e-01   -1.529720768945662e-01   +2.824179626824906e-01   +2.122677610910623e-01   -1.127387453819373e-01];
L1E_L2E_iAMPA_netcon = [-1.261418124557039e-01   -3.553378812555467e-02   -7.550151032038155e-02   -1.930287157967174e-01   +2.236212778213372e-01   +1.463755135013428e-01   +9.064677233862339e-07   -1.885702012723964e-01   -8.651540156816225e-02   -1.503251615745502e-01   +1.049978770593581e-01   +3.563795871125914e-02   -2.701298042823713e-01   +2.132159538855986e-01   +9.991631983758650e-02   +2.993436166871519e-01; -5.580421178988916e-02   -4.165241182370160e-02   +8.354451779684638e-02   +6.382699927197069e-02   -2.765910988698797e-02   -6.108384682876737e-02   +1.489058939514013e-02   -5.248361425291170e-03   -1.938738615643340e-01   +1.387737372521434e-01   -1.389074683678455e-01   -3.009565993099672e-02   -1.286898331769423e-02   -1.015368990195582e-01   -1.425837386675110e-01   +2.588910869482233e-01; -1.476564344439117e-02   +3.156831076942171e-02   +1.016628737316746e-02   +6.508850275349631e-02   -5.924660101348842e-02   +2.994673508863409e-01   +2.078547963341944e-02   -1.243859527686045e-01   +3.096989787479126e-01   -1.222046888465153e-01   -5.534240620185587e-02   +1.752688102310649e-01   -1.780535438904503e-01   +1.491304007206457e-01   +2.830050508335765e-01   -1.319133717346101e-02; -8.017463040777487e-02   +1.797878780162043e-01   +1.651408359660127e-01   -8.013473633819065e-02   -1.927900904274177e-01   +9.128620942676241e-02   -1.963145709914326e-01   +2.223944607135536e-01   +1.294353051119111e-01   +2.494656567527605e-02   -8.181445770203999e-02   +5.793400171737034e-02   +2.509579332282512e-02   -5.353875805626078e-02   +6.585869102172391e-02   +3.360235113571765e-01; -1.331126969942499e-01   +1.181561476830666e-01   +4.122007718035827e-01   +2.175241365011452e-01   +9.089228888633653e-02   -1.034155355106776e-01   -4.501325033220468e-02   -6.812263137600287e-02   +2.661131555344522e-01   -3.627174262206769e-01   +8.428465759516007e-02   -2.204202005218545e-03   +3.136407306616003e-01   -1.685433481467944e-01   +2.869342766070557e-01   +3.047873665339331e-01; -2.317097980494413e-01   +3.085363532552912e-01   +2.510474086511371e-02   -4.175757636768720e-01   +8.418111650934405e-02   +1.017003447143286e-02   +4.722927936457142e-02   -1.524841878054486e-01   -1.156555855055645e-01   +1.290174415828619e-01   -1.530606370752981e-01   -3.045028100195376e-01   -1.914342634533173e-01   +2.879393571042005e-02   +2.952867129692527e-01   +3.250211960548332e-01; +5.664316943157576e-02   +3.129369813517879e-02   -3.154925371019074e-01   -3.759478023451154e-02   -1.859875434373528e-01   -1.369563517164628e-01   -1.017214914837713e-01   +2.239010528881208e-01   +1.066133076466815e-01   -1.232262213737585e-01   +1.635668904249947e-01   +2.572057160960178e-01   -2.379473485478192e-01   +9.126850563544025e-03   +5.373455256827844e-02   +5.438545883002557e-02; -3.624637432749507e-02   -9.284024272438123e-02   -7.440806532950675e-02   +9.415926046295048e-02   -1.427011698504339e-01   +3.869961786746428e-01   +1.728466772843300e-01   +2.699645751963685e-01   +9.547088220358664e-02   +1.096398074001298e-01   +6.110353594467283e-02   +5.996211132526439e-02   -7.194569943741565e-02   +1.120618020951465e-01   -1.243803720370776e-01   +1.320696990910940e-01];
L2I_L2E_iAMPA_netcon = [+3.738994901021774e-02   +2.501930904224353e-02   +8.019338264661335e-02   +4.994020355083530e-02   -1.457477938549052e-01   +1.938767860458610e-01   +1.063631063815857e-01   -5.536169109305540e-02; -1.565935834714305e-02   -5.228052369177654e-02   -1.752888913419097e-01   -5.335527256038153e-02   +1.161755574823422e-01   +8.811579349528534e-02   +7.202886786000184e-02   -8.473980162184069e-02; +1.430135326410323e-01   +1.846890989218241e-01   -1.425996725109448e-01   +2.525014036424227e-01   -1.376218146330227e-01   +2.255484862306894e-01   +1.211349045846504e-01   -5.197945835439537e-02; -6.864435611699783e-03   +1.151038515912445e-01   +3.441429164112988e-01   +2.672443280370698e-03   -4.460805238200613e-02   +6.036139059120152e-02   +1.898522415980867e-01   -1.937423382531925e-01; -9.552210075368052e-02   +5.752508064587880e-04   +1.994988212514116e-02   -3.221876614564435e-01   +2.924578393995088e-01   -1.227776323812106e-01   -7.589783499684521e-02   -1.049472286674745e-01; -1.332141202098787e-01   +9.803379498939420e-02   -7.532811404986664e-02   +2.365741071498516e-01   -2.534681128514892e-02   +1.151988220868101e-03   +1.956321991503771e-01   +1.698480089716177e-01; +9.201593910365995e-03   +2.999988489587520e-01   +1.905431579571347e-01   -1.199180208974858e-01   +2.496928644413965e-01   +2.483534408933542e-01   +9.641386867269391e-02   -9.379847746817295e-02; +9.631858723247567e-02   +3.245758415837989e-01   +1.376760224884823e-01   -4.355517492401596e-01   -1.550445689746501e-01   -9.108894216681690e-02   -1.731078565700606e-01   -2.512136217502014e-02];
L2E_L2I_iGABA_netcon = [+2.303848090627728e-01   -3.040752577661553e-01   -1.339272003521917e-01   +1.790308175318975e-02   +2.417490631668053e-01   +9.699307900221510e-02   +8.708596208591009e-02   -7.279832001338568e-02; -3.502805204470373e-01   +8.676964003601872e-02   -1.667508461081808e-01   -9.126821946543968e-03   +7.565210704434999e-02   +3.434919615731064e-01   -1.578273928667538e-01   +1.058550133377229e-01; +3.523498245254287e-01   +1.471371374114361e-01   -2.485364774126642e-01   +2.841257494250685e-03   +4.434255270966475e-02   -5.338858273337573e-02   +7.420892270722708e-02   -1.739305061967936e-02; +2.323943308272741e-01   -1.609616916671221e-01   +5.037682049010817e-02   -9.699592200141699e-02   -9.861097819012313e-02   -1.399604135205700e-01   -5.253855065337797e-02   +6.897896408681983e-02; -6.243805575586735e-02   +3.996990565398359e-02   +4.799405544894872e-02   +1.432467978164466e-01   -2.562849415372631e-01   +1.318323881512995e-01   +1.293965159957310e-01   +2.504785804519938e-01; -3.550717934663847e-02   -5.827110842459706e-02   +5.756254745373014e-02   -2.086787790704804e-02   -1.323592236004350e-01   +2.196006810140609e-01   -2.507576219086420e-01   +1.609142269116821e-01; +1.275344064718069e-01   -1.814892657053691e-01   -7.362588981784995e-02   +2.824286084082592e-02   -2.932619068885542e-01   +1.937120921976817e-01   +1.052594357539897e-01   +8.791014741173603e-02; -2.935205816088217e-01   +9.541961150093116e-02   +3.765079150513984e-01   +8.853567627777005e-02   +1.409695639542723e-01   +1.512331364370966e-02   -1.483625185107631e-01   +2.232555085853136e-01];
L3E_L2E_iAMPA_netcon = [-2.565920973088275e-02   -3.132782348270872e-01   +3.465253253490241e-04   -9.510687157261524e-02   +1.856559266699312e-01   -1.114572665322362e-01   -2.840295464969994e-01   -1.928726413841070e-01   +6.436904495330126e-02   -2.285364196053569e-01   -4.693175296634417e-02   -1.709125273239625e-02; +7.089328872378378e-02   -1.516212932550698e-02   -2.787390857779438e-01   +1.290068855308562e-01   -1.315683678356545e-01   +7.701085006410696e-02   -2.197682452100775e-02   +1.994187932840603e-01   +2.114795438349628e-01   +5.187830573497083e-02   -4.622067409172304e-02   -6.662110422986016e-02; +2.324218749243895e-01   -8.606674278143552e-02   +1.874588628803241e-01   +1.247490088026712e-01   -2.857384677763676e-02   +1.057840295837764e-01   +7.321543547287770e-03   -3.880815653592828e-02   +5.319914431673900e-02   -1.536122044171281e-01   -8.810517513403582e-02   +1.491727279249909e-01; +3.507618693653642e-02   +3.060740831181523e-01   -8.347582549221724e-02   +1.338290344834375e-01   +1.159687646760190e-01   -1.317202225778603e-01   +1.023255861213953e-02   +2.588659155330452e-01   -5.780808155566489e-03   -2.375318423263795e-02   +4.896799067951499e-02   -3.472327009180899e-02; -1.844437337332119e-02   +2.146563394568685e-02   -3.023545447772485e-03   +2.805104363788307e-01   +2.927019940337013e-01   +3.808717627965562e-02   +4.044631096607755e-02   -5.350931216418787e-02   -1.250639184373407e-02   +3.846225205356817e-04   +4.813265671639068e-02   +1.446256396463790e-01; -1.556704345705717e-01   +9.119317243222386e-02   +1.264954982993213e-01   +1.480651883656466e-01   -1.335492332101213e-01   +8.225345713859031e-02   +3.107808307280191e-02   -1.451826187608952e-02   -6.886746713810796e-02   +8.429840340991382e-02   -5.857879789809856e-02   +6.669935991598674e-02; -1.492383750433381e-01   +3.679029065868705e-02   -1.840051540840645e-01   -1.734674820195485e-01   +5.219969629930563e-02   -4.324191360529763e-01   +1.330619556414536e-01   -2.021377418426993e-01   +9.602455975686122e-02   +7.585443839142031e-03   -3.721866172759906e-01   +2.043158109352412e-03; -2.775602995034239e-01   +3.177010151291022e-02   -3.309266484565360e-01   -2.180536133535457e-02   -9.799316016193726e-02   -7.876039839080762e-02   +7.316449407198361e-02   +8.309533442820691e-02   -1.439035089143235e-01   -3.540181427347876e-01   +1.502542419339090e-01   -4.012318325061384e-02];
L3I_L2I_iGABA_netcon = [+2.371127602001890e-01   -1.668319175497169e-02   -3.869427309243329e-01   +1.121887328275043e-01   +2.644020124782592e-01   +9.455719685285421e-02   +3.194019517607258e-01   -1.392467968877363e-01   -3.000576064934078e-01   +2.872361880480833e-02   +3.583063827432895e-02   +6.116689482752194e-02; +1.667526916961917e-01   -1.659958478636628e-01   +1.821594323281381e-01   -1.048774681900566e-01   -1.070243742183674e-01   +1.586316856139736e-01   -1.575345416209800e-01   -8.601874894809106e-02   +9.870512805832915e-02   +3.038860096774809e-01   +1.579854473637863e-01   +1.423289207644174e-01; -8.223330720267030e-02   +2.940714478532873e-02   +1.580498153856583e-01   -2.664822220993470e-01   +1.990584582550887e-01   -1.143601249432505e-01   +8.654045072028851e-02   -7.095471676390176e-02   -6.832026764571804e-02   -2.308411552266210e-01   -8.485350936989605e-02   +1.230985494257756e-01; +1.167507234267439e-01   -3.301489701261411e-02   +1.620493530421256e-01   +6.960778401389875e-02   -1.096120720893637e-01   -6.190212994531872e-02   +9.273046798062321e-03   -1.152782925449672e-01   -2.569547795196933e-02   -1.807414091597608e-02   +2.643935830335493e-01   -1.814071764915089e-01; +6.592023305095933e-02   -9.573695576741037e-02   -3.177732944423309e-02   -1.771095435328602e-01   -6.210775881778938e-02   -2.710081775195798e-02   +5.077633495020335e-02   +2.607110157422296e-01   +7.608625806905839e-02   -4.650582951830878e-02   -1.652189537779022e-01   -7.771570416283525e-03; +2.829596156111050e-03   -3.696435954188015e-02   -2.830596244974177e-01   +1.294863595212751e-02   +1.563132533868475e-01   -1.581133705181937e-01   +1.025077881574697e-01   +1.230835832024328e-02   -4.242614663191913e-02   +1.468773078012590e-01   +1.361920924052002e-01   -1.576758671706945e-01; +7.859652576575106e-02   +1.855765726264462e-01   +1.936190744843343e-02   +1.058165800173941e-01   -4.026738866225472e-01   -9.549525872763380e-02   +1.380499455996103e-01   +2.028748368457755e-01   +1.435360573118559e-01   +7.350585273407426e-02   -1.955206390991683e-01   +4.245059726613680e-02; +1.293509804408251e-01   +2.359854495457793e-03   -4.514547485213678e-02   +2.001731061395294e-01   -1.426757009369561e-02   -5.883370539447316e-02   -2.292566570295147e-01   +2.008729386375389e-01   -3.386904996300746e-01   +1.243477664523633e-01   -2.224549878658736e-01   -1.004407396312150e-01];
L2E_L3E_iAMPA_netcon = [+1.992705131868547e-01   +9.597380227719032e-03   -3.595572668780194e-01   -1.626887983126384e-01   +9.797337099666981e-02   +1.685563946001755e-01   -9.976616638303556e-02   +2.025394050591997e-02; -1.256405746469249e-01   -2.272263103437800e-01   +1.534608166099524e-01   +3.306329694935201e-01   +1.973699757961824e-01   -2.248944901378742e-01   -5.335157940534768e-02   +1.239094839025524e-01; +3.568827940641828e-02   -3.780177821486183e-02   +2.206764512567017e-01   +1.081515179906596e-01   -2.607032977495745e-01   -6.607362443448474e-02   -2.285355368686978e-01   -9.292752602442163e-02; -1.411958620434540e-01   -5.427842757130120e-02   +1.274643161809656e-01   +1.474566771427104e-01   +5.737567652498349e-02   -4.064954746289345e-03   -1.959194295709098e-01   -2.197504110103764e-02; -2.126907322724800e-01   +1.413156979749355e-01   +3.176584470825784e-01   -1.203828998371526e-01   -7.974962004747252e-02   +5.750198885586412e-02   +1.391053243113430e-01   +1.424107259865356e-01; +2.143712326382460e-01   -3.740357619552439e-01   +1.288602356697175e-01   -2.319125853969462e-01   -1.484866806177834e-01   +9.086633218119117e-02   +1.978918331186257e-02   -3.300929568793779e-01; +4.110541427042039e-02   +1.296005910576550e-01   -1.599824740960393e-01   +2.069171169350187e-01   -2.574877898335679e-01   +1.998916427352265e-01   +7.525617173050161e-02   +2.390536520862669e-01; +3.725744759917328e-01   -8.792850003150972e-02   +1.633814607494860e-01   -2.648715332663841e-02   -7.004576227913775e-02   -3.969000335655637e-02   -8.928366001928430e-03   -2.515572237460103e-01; -1.941442274997626e-01   +3.592958733544582e-01   +1.933250148328420e-01   +5.696009749162895e-02   -1.104641809073647e-01   +2.862289707731730e-01   +1.961804714114333e-01   +6.522416470041802e-02; +1.626461899748762e-02   -7.904514553865384e-02   +5.916943742682214e-02   +1.756379379255582e-01   +3.230434133220138e-02   -5.337065299731315e-02   -6.789184660259584e-02   +2.036684353284391e-01; +5.396554593839069e-02   -2.595728624700710e-02   -1.253173001166497e-01   -1.154178918503640e-01   -9.766916853593606e-02   +1.438082814974796e-01   +8.745001381563930e-02   -2.214853318936837e-01; +3.784709371463330e-02   -1.136985198924120e-01   +5.855323713419451e-02   -1.532815420583004e-01   +1.546772841397600e-01   +1.899752932909670e-01   -1.718912132098289e-01   -1.757775667926327e-01];
L2I_L3I_iGABA_netcon = [-2.937976851283740e-01   +1.018885571437863e-01   +8.700606398385922e-02   -7.780531227639857e-02   -6.723886696234964e-02   -6.977490955571258e-02   +7.771643351531604e-02   +1.090359137907677e-01; -1.473359014231521e-01   -1.526771512400570e-01   +1.589242931690504e-01   -1.792623417672085e-01   +1.010616452377522e-01   +1.648418290098649e-01   -1.189513295597044e-01   +7.331166439115112e-02; -1.271783897169064e-02   -6.795015077182523e-02   -5.073178723251871e-02   +4.670375873316662e-02   -4.950569898181280e-02   -1.923489975903897e-01   -1.061645548162561e-01   +1.019423919629736e-01; -5.263645802849406e-02   +3.644062421963144e-02   -7.854145615681582e-04   -3.070465047903599e-03   -5.830824001774952e-02   -1.662780564036951e-02   +2.256725449452752e-02   -4.269556352408659e-02; -2.597027060107908e-02   +1.817810100619943e-01   -7.526284216765255e-02   +3.656697122189605e-01   -7.304938546680731e-02   +3.824502799385562e-02   +7.468179421106369e-02   -8.216643813193214e-02; +5.435961175265132e-02   +4.657162553139232e-02   -1.533182819351006e-01   +1.733571904282404e-01   +1.003238509343769e-01   +2.095327898388075e-01   +2.405344594065419e-03   +3.533060343659623e-02; -9.877050802604354e-02   +1.288444630322612e-01   +4.652177897923229e-03   -5.343206056124797e-02   +1.581669908558272e-01   -3.099782980517550e-01   +2.030034646490710e-01   +2.526445704614335e-02; -2.376553115030137e-01   -3.243332637443302e-01   +1.916104042369227e-01   -5.617507219119812e-03   -3.835141495559668e-02   +1.892240165173323e-01   +9.672675324353214e-02   +1.139977390080099e-01; -9.883559288093544e-02   +3.379242800198189e-01   +1.918421452352871e-01   +3.616205074516068e-01   +1.531832366965407e-02   -3.042528402636743e-02   -8.982611690159642e-02   +2.137416043940771e-02; -2.158927808030557e-01   -1.330571995414976e-02   -1.813831835693993e-01   -1.097092609021653e-02   -9.485787067157772e-02   -1.918040122523596e-01   +6.913790834195688e-02   +2.097863111550106e-01; +4.149964985071115e-02   +1.541385101235773e-01   +1.995675730512879e-01   -7.327082243749541e-02   +1.390508562824630e-01   +7.128778855112586e-02   +1.107229859402890e-01   +3.241362617594251e-02; -7.880726605951197e-03   +6.079612415302202e-02   +6.932625569372142e-02   +8.369776823026531e-03   +1.021623577426003e-01   -8.419271291883124e-02   -2.840966774405869e-01   +3.186922929570082e-01];
L3I_L3E_iAMPA_netcon = [-2.681502406172517e-02   -6.083698888814083e-02   +2.235080704022849e-01   -2.648141669142353e-01   +4.444120908058737e-02   -2.130919939213864e-01   -1.781888404566653e-01   -2.685144956686676e-01   -9.740490948654379e-02   +1.481521472074747e-01   -8.056984121565202e-03   -1.556826752392507e-01; -1.934044786479649e-01   -1.035874594530618e-01   -2.079948837360730e-02   +2.265584977636305e-01   -5.569638287353990e-02   +4.909882238207720e-02   -7.533266590408894e-02   +1.188114213757670e-01   -7.487294443271006e-02   -2.296907269322358e-01   -1.032782494706973e-02   +3.264555984594694e-01; -9.124003919372765e-02   -8.794485294530005e-02   -1.378360372792421e-01   -5.442154419834895e-02   +2.355218318781059e-01   -2.885971079332192e-01   +1.807007890827605e-01   -1.842003607314986e-01   -1.511936679129615e-01   -1.458385712862225e-01   -7.846488069256735e-02   -2.729976823812419e-01; -2.257692659569908e-01   -1.538170224807749e-01   -2.211549722655103e-02   +2.273479968448936e-01   -1.628324807208517e-01   -1.336269572565101e-01   +1.246335171154761e-01   -1.879459686989559e-01   -6.596697123161394e-02   -1.205665736685719e-01   -1.095895172740902e-01   +7.671787677420341e-03; +1.439427457295236e-01   -6.499099016391570e-02   -3.312499669278731e-01   +1.794366247286768e-01   +3.847255258481664e-03   -2.254317430560891e-01   -1.148287577883073e-01   +2.727448888446199e-03   +2.837409749523506e-02   -4.609217846313043e-03   -1.887088175322074e-01   +2.502984001906609e-01; +3.062311997328030e-01   +1.320395354129981e-01   -4.828922844159652e-02   -6.031253803567001e-02   +7.095683350266418e-02   +1.514509001379548e-02   +4.220180963743397e-02   +1.112487085885957e-01   -1.234142420130894e-01   +3.001441784645689e-03   +4.265317686071373e-02   +1.999700229247651e-01; -4.219727567976855e-02   +7.208943131114948e-04   -1.033329912873653e-02   +2.358202897674031e-01   +2.012760812602815e-01   -2.445830082102108e-01   -2.886325225128092e-01   +3.706633380466470e-02   +3.099953554105578e-01   -2.293673903521076e-02   +7.553733272180826e-02   +2.055029147191528e-01; -6.816901119984620e-03   -5.136511523093313e-02   -1.478572504476217e-01   +8.035531251194890e-02   -2.475288804511992e-01   +1.244997074332491e-01   -2.570208068733695e-01   -6.004308900149277e-02   -9.102174039723379e-02   +2.582629656722238e-01   -6.522888118243939e-02   -1.248253522816123e-02; +3.673612432351812e-02   -3.834301359880032e-02   +1.685058129183107e-01   -1.088045474885277e-01   -1.433626033042494e-01   -2.623249206629519e-02   +1.762884360717808e-02   -3.068697587223206e-02   +5.706638334989520e-02   +7.292139766960218e-02   +1.021797346327238e-01   -4.200099648727036e-02; -3.403229919540741e-02   +3.118517967937141e-01   -1.992183499225519e-01   -2.934638746112117e-01   +2.701011836432671e-02   +2.176819350851019e-01   +2.643324536097297e-01   +7.324005352648021e-02   -1.211479014760681e-01   +4.876574034896400e-02   -1.135258561151481e-01   -2.837758795677213e-02; -6.025266367649089e-02   +1.621572951693349e-01   +1.156069336285836e-01   +5.972249167838899e-02   -1.980285161587876e-01   +1.558646970418107e-01   -1.638228619037808e-01   -6.035106906964251e-02   +1.723303858424204e-01   -3.314624956693574e-02   -7.369251597230297e-02   -1.489405593666162e-01; -6.999482500995927e-03   +1.190879302960815e-01   -5.373956883944012e-02   -1.775079009169934e-01   +2.227289615638510e-01   -3.339868493925359e-01   -1.381898903280188e-01   -3.059554888366674e-02   +9.115370430556299e-02   +5.142669200473411e-02   +1.925232689313502e-01   +1.377037223778059e-01];
L3E_L3I_iGABA_netcon = [+2.884232092078861e-01   -1.805777586373125e-01   +5.468589824238673e-02   +2.055218778605931e-01   +1.306055849862948e-01   -4.127242724299776e-04   +2.387919198353288e-01   +5.283536018297848e-03   -1.493735087339373e-01   +1.722992930757861e-01   +8.257507263320259e-03   +1.447134691047101e-01; -1.339677533683407e-02   +9.202057288239890e-02   +1.435506577179140e-01   +1.909372527303160e-01   +1.684967427038596e-01   -1.055414083172933e-01   -1.246844757915963e-02   +2.394530911139842e-01   -2.265909400666323e-02   +1.482750914238796e-01   -2.684893293453823e-01   -1.730777769471521e-01; -6.228969745107683e-02   -2.381856486013561e-01   -3.555480891201276e-02   -9.245858650933017e-02   +1.874056802211920e-01   -7.787410212691728e-02   -1.920760887584815e-01   +1.626204385754487e-01   -2.123495480941914e-01   -1.400441936717460e-01   -1.636154139001242e-01   +3.457724447005811e-02; +1.920992725124470e-01   -7.761580779524120e-02   +3.354333988505560e-03   -1.915715150703756e-02   -1.937095185776043e-01   +1.306669355731212e-01   +1.608702345077861e-01   -2.657075184458019e-01   -1.210868922050985e-01   -2.742070473351629e-01   -8.524351074924851e-02   +1.944505331008822e-01; -1.438203316310173e-02   +1.470644042145776e-01   -2.683694230383314e-01   -3.676053218521257e-01   -1.176117064451764e-01   +1.337698352711685e-02   +3.707714658012149e-01   +8.550017542713831e-02   -3.813262450567520e-01   -1.954421726522830e-01   -2.912649410773361e-01   -2.345198658505538e-01; +4.526064131088881e-01   -1.631174920123893e-01   +1.746478796982965e-01   -7.593414468726652e-02   +3.992236201153777e-02   +7.256388007926498e-02   +9.086280715792240e-02   +4.289869624385191e-02   -7.928293749463786e-02   -3.230105990239289e-01   -3.361625396810290e-01   -7.021339910645316e-02; -2.505253176059313e-01   +3.157726116348757e-02   -1.251283772919728e-01   +2.995893687767653e-01   +2.107743066776181e-02   -1.204751451336972e-01   +3.137020614735291e-02   +1.215840874026317e-01   +3.737235074741321e-01   -1.712907945136723e-01   +2.825623021250455e-01   -2.015667509492696e-01; -3.198958278195933e-02   -1.557758027076116e-01   +3.295480736333911e-01   +1.719913484851146e-01   -4.677485982343083e-01   +1.341996903370434e-01   +2.824812074952920e-01   +2.474905052608644e-01   +7.560230948121312e-03   -3.758736005137147e-01   +1.918997770816611e-01   +1.955962342681574e-01; +1.981193856041825e-01   +1.314443252174498e-01   -1.090644024504248e-01   -4.956507364276883e-02   +3.408111020916404e-02   +5.688086613007992e-02   +6.387228192958069e-02   +3.168831689506044e-01   +2.419608307853655e-02   +9.796137496995616e-02   -8.938115469576161e-02   +1.318373406966933e-02; +6.958530175759180e-02   +1.098131194347855e-01   -4.169157613679921e-02   -8.299154386460619e-02   +3.677180479665699e-02   +1.808865964614403e-01   +1.316627967519999e-01   +1.259677585758516e-01   -3.935157595979252e-02   -2.938534634602066e-01   +2.777920849609579e-01   +5.098986786190412e-02; -6.821276966792682e-02   -3.280905118732116e-01   -1.522721781458080e-01   +1.393954814914599e-01   -7.642429263074027e-02   +2.996851569062694e-01   -6.232939698361328e-02   +1.573744163491142e-01   +4.523547022079106e-02   -1.380786362593004e-01   +4.996045561775363e-02   -2.492382690088198e-02; +6.538321502311811e-02   -2.630381233672963e-01   +1.455637748781345e-01   -2.604622787147662e-01   -1.536870519407034e-01   +1.845655686987696e-01   -1.390848848558055e-01   -2.347179129603044e-01   -3.292988729976126e-02   -1.479524599136686e-01   +1.545846487020711e-01   -1.312408842783812e-01];
L2E_Input1_iAMPA_netcon = [-9.410472676351533e-02   -2.114834540808502e-01   -1.410717761796809e-01   -4.719417255581911e-03   +7.861403841468245e-02   +1.063990005628764e-01   +1.026501743933192e-01   +1.152754810408175e-01];
L2I_Input2_iAMPA_netcon = [-1.134002565509509e-01   +3.794265191876980e-02   +3.062708184462713e-01   +6.449637072702832e-02   +6.849133122880807e-02   -2.320771394388381e-01   +2.588208006088266e-02   -1.224704360418785e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
