function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.234117490569004e-01   +4.254073470072316e-02   +2.522777378540169e-01   -1.826625271430586e-02   +1.857213056973795e-01   +1.983680545633408e-01   +2.342483237348895e-01   +9.564218714482262e-02   +1.450687560083529e-01   +9.115117147918857e-02   +1.795856277216062e-01   -6.288802781881829e-02   -3.727618527851566e-02   -3.006415207320012e-01   +2.140532264257330e-02   -1.411707858172286e-01; +2.046908827773284e-01   -2.346294176031377e-01   -2.695776683768542e-01   +2.395473615221797e-03   -6.586885962616582e-02   -2.858904808766899e-01   +8.010856730728599e-02   -3.209958396163375e-01   -3.431269385467754e-02   +7.788863631685572e-02   +9.896927488728037e-02   -2.564454225500351e-01   +1.320665760034584e-01   -1.215924419122868e-01   +9.795724696316048e-02   +2.706027760757220e-01; +1.165253262812471e-01   +9.265775021069581e-04   -4.208586927004949e-02   -7.969722003302490e-02   +1.397133064571921e-01   +2.028065610029949e-02   -1.627942445026930e-01   -1.763539914047322e-01   +1.812137234837905e-01   -4.286899909110960e-02   -1.140195450838146e-02   +6.506240560938617e-02   +7.873003434644305e-03   -1.545960325744914e-01   -1.142088156586898e-01   +1.747537036317209e-01; +2.432664801413816e-01   +4.753853589438647e-02   +1.894374945454602e-02   +1.409663118376717e-01   -1.055029381014289e-01   -1.928850694031896e-01   +2.011200443468809e-01   -1.943369754825613e-01   +9.381094662704823e-02   -5.605218354658414e-02   +5.967619153972311e-02   -3.092769369911796e-02   +5.018935336527591e-02   +1.752415073526520e-01   -2.273456462801057e-01   +6.838141734903287e-02; +4.767756324407863e-02   +1.413653692523263e-01   +3.210824127183672e-01   +6.077866420901216e-02   -1.047299565249574e-01   -1.480231886970998e-01   +6.395850933822839e-02   -9.307294685145153e-03   +4.736276994795106e-02   -3.556705368161660e-02   +1.235050226978763e-01   +4.109068617738545e-02   +1.759562417915581e-01   -3.745194076819066e-02   +1.342670116038571e-01   +4.384549560040807e-02; -8.117971548139988e-03   -6.688295721824003e-02   +1.546352912760140e-01   +7.508045139927293e-02   -1.954447918588804e-01   +3.233673308227365e-02   +1.878703579747336e-01   +2.198753227554023e-01   +1.393710751698808e-01   -1.296590002927900e-01   -2.719698408673447e-02   -1.425250309501132e-02   -1.944200968108478e-01   -7.603259134022426e-02   -1.453033654769783e-01   +7.304388633339331e-03; +3.825597950086119e-02   +1.118097092824129e-01   +1.518681227122286e-01   +3.608608762936145e-02   -8.929674720259664e-02   +8.710252013063628e-03   +7.962728088354018e-02   +7.677015433751437e-02   -1.641728331596527e-02   -3.254101033240536e-01   +9.473840263020350e-02   -3.085351806296911e-01   -1.617996475725259e-01   -5.387656119288509e-02   +2.544621593098784e-02   -1.041098772311982e-01; +2.339074628263903e-01   +7.510307833183100e-02   -1.849899228241877e-01   +1.599140699085307e-01   -1.551117365163321e-01   -2.555776220935375e-01   +2.765739450321207e-02   -1.358817223180027e-01   +2.294698665841061e-01   -1.717879666304234e-01   +1.244966406072849e-01   +1.170775717727699e-01   +1.184025297033888e-01   +6.155220766768232e-02   +1.635914812394890e-01   +1.779914390199083e-01; -2.588149199546274e-01   -1.211198500421067e-01   +1.358102614345825e-01   +1.589510519960963e-01   -1.496458115368056e-01   -2.428806458220713e-01   -1.875301281839260e-01   -2.502487847280340e-01   +2.521237894041001e-01   -1.358924588188752e-01   +2.264428179986092e-03   +4.823321845683088e-04   -3.902886806414065e-02   +4.038730447222236e-02   -8.143915936376769e-02   -1.139439835529034e-01; -2.035625565506354e-02   +7.662628289607845e-02   +4.932313085137331e-02   +6.482362868215584e-02   -1.387045490728486e-01   +1.625844198267392e-01   -4.457113451369555e-02   +2.392795231938674e-01   +1.673611375598966e-02   -1.638282475650112e-01   +1.002804659141804e-01   -6.845909894300999e-02   +8.366373350718050e-02   +6.475705884722607e-02   +4.750496531151220e-02   -2.207649491259070e-01; -5.644157686735459e-02   -1.994857240372621e-01   +1.973517025470088e-01   +9.299855600176965e-02   -2.329955205303898e-01   +5.233579236253878e-02   -3.050463636507295e-02   +1.422178459342731e-02   -9.456184697696814e-02   -9.617871617684504e-02   +2.810877773777206e-01   -1.091519192303856e-01   -1.576845236832378e-01   -4.021365395103091e-02   -9.147522014388774e-02   -1.126094587739308e-01; -2.696780764093890e-02   -4.457597077160722e-02   -9.393002541543924e-02   +2.374848699438261e-02   +1.540854704191920e-01   +2.778147342160235e-01   -2.127295113124960e-01   -4.878858013811660e-03   -8.968715136283789e-02   +8.624488515160944e-02   -8.853835587073098e-03   +1.720493377661989e-01   -5.201539737399950e-02   +2.718395297170866e-02   +1.092198647296078e-01   -1.053208481414801e-01; +5.334483604865643e-02   +6.128305433062686e-02   +8.515084537608483e-02   +3.011535979034664e-01   -1.947178678718554e-01   -9.288492190144804e-02   +1.151665311235034e-01   +9.610578568822802e-02   +8.384019045415576e-02   -2.446174336482122e-01   -1.443303327519277e-01   -1.715973054773044e-03   +3.141897591213670e-01   +5.290812699898365e-02   -1.301873852074249e-01   -2.303636394388104e-02; +2.105214870138498e-01   -3.125223383451543e-02   +1.703373202340290e-01   -1.476680292791357e-01   -9.517951447866975e-02   +1.625464110463511e-01   -1.685601295601449e-01   +9.512473607152105e-02   -2.027162861542669e-01   +2.304799074594620e-02   -2.883485991290616e-01   -8.219216062692442e-02   -9.455315387284330e-02   +2.002416785825119e-01   +5.903999947510379e-02   -1.039225448377860e-01; +2.026061420354952e-01   +3.770685462324468e-02   +1.923414317808102e-02   +1.840440479355574e-01   -8.432274469429665e-02   +5.477310520305970e-02   +7.033889083486231e-02   -6.394054297825379e-02   -9.316624736727230e-03   -8.126254782436940e-02   +1.738334796197178e-01   +1.489558391204087e-03   -1.387279432417822e-01   -4.177692354127147e-02   -2.832773204150510e-02   +1.330095313414947e-01; +2.233936094902163e-02   -4.612055137739481e-02   +5.810200565600145e-02   +9.337143439713315e-02   +1.345357499881085e-01   -1.240880359414367e-01   +2.681184979814684e-02   -1.586049009696599e-01   -1.363777806679732e-01   +4.072905667527787e-02   -2.310425872796831e-01   -2.277301278319223e-02   +2.002474423355948e-01   -2.660825535375609e-02   -2.711846933860834e-02   -2.216563869785040e-02];
L1E_L1I_iGABA_netcon = [-1.282654229680368e-01   +4.314633570741980e-02   -1.934096201848585e-01   +2.102525467002217e-01   +8.197300717564010e-02   +1.479726031376971e-01   +1.038639939853341e-01   -4.742410683990042e-02   -1.657069187838122e-01   +1.268659117331127e-01   -2.140466929747791e-01   +3.291759078863186e-01   -2.605511866654414e-01   -9.447495029382366e-02   -5.552131051073576e-03   -5.475910277793050e-02; +2.768890059684745e-02   +1.883213828349245e-02   -1.960292815443893e-01   +2.296549478812832e-01   +7.946170970549932e-02   -1.714235091230974e-02   -2.549297375280350e-02   +7.436586065582562e-02   +4.141619018754654e-02   -8.501618750999289e-02   -1.046675513155578e-01   -1.283846525601047e-02   +7.225921261424838e-02   +8.611595484827661e-02   +1.149638512892930e-01   -2.162418355163747e-01; -1.723968449398470e-01   +4.572406984560003e-02   -1.370852728251146e-01   -2.614787853569218e-01   +5.828999265178325e-02   -3.305964178100543e-02   -1.455697249277778e-01   -2.360071743898392e-02   -6.437397873244873e-02   -6.539944714369331e-02   +1.480130505581178e-01   -1.342385340498101e-01   -5.326387506576379e-02   +5.930085153351193e-02   -3.792509024842093e-03   -3.055220385402447e-01; +2.252613336749623e-01   -1.485866030756661e-02   +1.978312128073811e-01   +1.403142960141752e-01   +9.865587280135008e-02   -1.342250769846290e-01   +7.821049218913495e-02   +5.790367330508744e-02   +2.644618898110756e-01   +3.056172445281612e-02   +1.467594927004494e-01   +2.040722268167071e-01   +1.059746107318266e-01   +3.396195836711599e-02   +3.973863057986065e-02   -4.460631743744251e-02; -2.338163298307767e-01   +1.536520600934187e-02   +9.377223103502200e-02   -2.661117245314011e-01   +1.619147997554468e-01   -7.518058799851403e-02   +9.442932220064050e-02   -6.778828463271636e-02   -1.041647360812134e-01   +5.082357536034433e-02   -1.539091838931010e-01   -2.609574881194378e-01   -9.950622512206825e-02   +2.030017139991416e-01   -4.074123193028444e-02   -7.134269375620376e-02; -3.258556341560500e-02   +9.967732854769631e-02   +2.311904239195520e-02   +2.880511469822583e-02   +1.279015083278690e-01   -6.326992242650099e-02   -1.069424364244737e-01   -1.948840551587194e-01   +1.053772568250224e-01   -1.379985859048957e-01   -6.589588529324752e-02   +7.970985372513309e-02   -1.078820538611239e-01   +1.125344294574291e-01   -5.591959776921589e-02   -2.429201284045083e-01; -2.890204033901769e-01   +3.994988431293396e-02   +1.950089710614099e-01   -2.197885446289384e-01   -1.124936202981132e-01   -7.908968190738148e-02   -1.328841463878509e-01   -3.783795441591983e-02   -1.134568533812715e-01   +2.030644850989198e-01   +1.366164644824926e-01   +1.501981660896223e-01   +2.412096205345592e-01   -3.262002978405563e-02   -9.868157365385548e-02   -1.501406328677239e-01; +1.447027461790309e-01   +1.665912672208447e-01   -3.007765633958667e-02   -4.194618954300339e-02   +3.468799929656868e-02   -1.289195428229023e-01   +2.268113146255908e-01   -1.090321981763207e-01   +4.121435397105851e-02   -7.658069168777364e-03   -4.492560666179606e-02   -1.528233817368465e-01   -5.885334691459811e-02   +1.895610640204763e-01   -3.453262011759643e-01   -5.274714967590467e-02; -1.024223997625174e-01   -1.595437165694559e-01   -1.006595631395009e-01   +1.216458185974558e-01   -1.041097567893065e-01   -3.407185816364372e-02   -6.530800450510187e-02   -2.214799991574553e-01   +2.552303305719085e-01   +2.465912257905332e-02   -1.251227024101710e-01   +9.294928149975419e-02   +1.924716660925603e-02   +8.426609714939889e-02   +8.054983929547288e-02   -2.367745380969072e-01; +2.028914276603223e-01   -2.586681626923966e-01   +1.054072939572361e-02   -1.280173778704151e-01   -1.487513044616798e-01   +8.833212986419610e-02   -7.923459694578228e-02   -1.092333252441132e-02   -4.294243673387277e-02   -1.206885098876682e-01   -1.951775913124332e-01   -1.956584567553239e-02   -2.163276031246004e-01   -3.631189869687073e-02   +1.604569834496911e-01   -5.946654519437093e-02; +9.741045325333073e-02   +1.062226942793517e-01   +1.550689494337118e-01   -1.553844414866404e-01   +1.280772936360342e-01   +1.589835849176229e-01   +2.188219169615399e-01   +3.171553279797592e-03   -4.640092137042279e-02   -1.424582012775133e-01   +1.006009503903302e-01   +7.249691767098183e-02   +1.980264037139811e-01   +2.356978087125629e-01   +1.029027438242904e-01   -1.676055308429729e-01; -1.904834900343132e-01   +1.119057235267312e-01   -1.799907509895040e-01   +1.422846446977029e-01   +1.960204278378608e-01   +2.218354841592701e-01   +1.197845699305556e-01   -4.642032230715504e-02   +6.426831381733325e-02   +1.675547109831025e-01   +1.837065915319536e-01   -4.473579416966516e-02   -1.266751576326108e-01   +9.396330051364389e-02   -1.236624498913398e-01   +3.005439201416643e-01; +6.959935344455608e-02   -2.202746405694507e-01   +2.951812057488928e-02   +3.761455838803619e-02   -3.293235571359749e-01   -2.179698328899711e-01   +1.004093178170084e-01   -3.911751250754837e-02   -5.496387379342706e-02   +1.518406642283535e-01   -1.186202187021622e-01   -1.913034019062708e-02   -1.196812708455377e-01   +4.524320448996458e-02   -1.005394480757909e-01   +2.767026274663412e-02; -2.573519312926258e-01   +1.417769355716043e-01   -7.979419807749067e-03   -7.955783799105338e-02   +4.338050948908685e-02   +1.635609867224478e-01   +8.255809016915849e-02   +9.278427474310164e-02   +3.146946874744801e-02   +2.469677153152119e-01   -1.215870690527144e-01   -2.186923145074849e-01   -1.864870953643544e-02   -8.682920981783836e-02   +2.165645848156697e-01   -3.152270247557679e-02; +5.997683806254237e-02   -8.426851326797659e-02   +2.273302396557760e-02   -1.003565436442156e-01   +7.363973054242201e-02   -9.919814633361126e-02   +9.023573775322177e-02   +6.710257245878759e-02   -3.451541384029565e-02   +2.740681140854722e-02   +2.592346766360460e-02   +5.331331654653328e-02   -2.222360937452756e-01   +1.126899163049079e-01   +2.091214980400043e-01   +1.075558694704560e-01; -1.749896256083779e-01   -1.282346848697551e-01   -2.810121061574243e-01   +4.526862519152321e-02   +1.176486725673532e-01   -2.355946980380017e-01   +1.074723017585731e-01   +1.072874826394516e-01   -1.879345415580036e-01   +8.920791154179609e-02   -4.465339250472913e-03   -2.837320781688525e-01   -6.124599659243697e-02   -2.085482678632116e-02   -6.378251412146350e-03   -3.191065124047251e-02];
L2I_L1I_iGABA_netcon = [-1.554316498690777e-01   -5.976749367166708e-02   +9.371130886870382e-02   -2.436227554971711e-01   +9.668968358250279e-02   +1.098443833730499e-02   -2.460218309673854e-02   +3.181489903772963e-02; +3.289526155311306e-02   -2.283284795049396e-01   +1.299234838354676e-01   +6.549542257756730e-02   -4.260162495696915e-02   +1.053858645978569e-01   +3.042532194561282e-01   -1.534076444928436e-02; -2.047370221167580e-01   +2.375820811641920e-01   -1.532630670798941e-03   -1.521851458485255e-01   +2.149973883147436e-01   -9.569638354922540e-02   -5.809255828901141e-02   -8.793515095168125e-02; +3.683395463734188e-02   -3.993036196709256e-02   -2.892855027345424e-01   -5.864291601499910e-02   +2.137143332312998e-01   +1.598550876936045e-02   +4.622904478803167e-02   -2.433804525630091e-02; -1.115340258379484e-01   -1.463529269113076e-01   -5.258566162970645e-02   -6.246582652831907e-02   +3.085618279598473e-02   +5.469551108835919e-02   +4.347639902898628e-02   +1.087174702949572e-01; -1.441886168163699e-01   -1.540503111336535e-01   +1.444109834123569e-01   +3.428499527822847e-01   -2.270449326128763e-01   -3.365301399058099e-02   +1.779964263151061e-03   -5.758761952187566e-02; -1.305192822699055e-01   +3.376425375384860e-02   +1.165119482703982e-01   -6.840184262157580e-02   -3.180858186867123e-01   +2.281223051625117e-01   -1.488873097585557e-01   -7.228323867837670e-02; +7.437951221359566e-02   -1.962412271038068e-01   -1.263045290545038e-01   +1.128532230736262e-01   -2.826985635978242e-02   +4.614857382671030e-05   -2.367938145051109e-01   -1.006734920755473e-01; -1.847675862311958e-01   -9.159979079963398e-02   -1.705697665247270e-01   +4.845683998961810e-02   -1.650572959624585e-01   +1.308100008303184e-01   +2.264525624364971e-01   +1.419271753155050e-01; -1.325071277265015e-01   -6.208709370138442e-02   -7.346039991268079e-03   -3.828027267839320e-02   +1.591119029915014e-01   +1.513414196963932e-02   -5.211203748583391e-02   +2.968982775331099e-01; -1.194665268278099e-01   -9.411629728720924e-02   +8.510538846356147e-02   -2.132696549105943e-01   +5.801159802198484e-02   -6.062275209131457e-02   -5.152782999091383e-02   -9.142792797242877e-02; +8.610241248780019e-02   +2.457360207379894e-01   -4.944671807647735e-02   +1.064247321260278e-01   +7.143067705381806e-02   -9.653619075760787e-02   +1.312044466439197e-01   +4.233434845217899e-03; +8.225153517385007e-02   +2.508241927975782e-02   -2.622614976638628e-01   +8.244221447892269e-02   +1.087573132831485e-01   +4.092027695968564e-02   +1.722008224501625e-01   -1.774868510030243e-01; +1.227330033059841e-02   +6.557229277310492e-02   -1.553445681072310e-01   +2.737491536203897e-02   -6.481329286672716e-02   +6.315404104721811e-02   -7.716994773102089e-02   -7.312070837095594e-02; +5.107768670493897e-02   -7.325187260820422e-02   +1.114735262540212e-01   -7.379707058740091e-02   -4.370873520183614e-02   -4.159604455936666e-02   -1.112125272837364e-02   +8.147892225398222e-02; -1.448004829701606e-01   -9.798754064744747e-02   +4.330137871822599e-02   -1.272973259527454e-01   +2.064478215357396e-01   +1.181506208778799e-01   +1.018521916216382e-01   +9.434844171368030e-02];
L1I_L2I_iGABA_netcon = [-1.010032779571981e-01   -2.071152730939985e-01   -1.576755207164911e-01   +1.142295618074737e-01   -9.599639529616422e-02   +9.394791814055266e-02   +3.193050191412543e-02   +6.020837646170175e-02   -2.230145036338045e-02   -1.668010039022443e-01   +1.290091379500656e-01   +9.287254054538518e-02   +6.143345123530428e-02   -1.029997250440514e-01   -6.945556215005529e-02   +8.189454425171661e-02; -2.406041669595626e-01   +1.670320588167305e-01   +7.881790477500195e-02   +1.243888377711126e-01   -1.334495463052108e-02   -2.114407125638144e-01   -8.875793827658882e-03   +1.065689810630282e-01   -8.031999453809785e-02   -1.533419475500331e-01   -5.616074514020511e-02   +1.177074154240028e-01   -4.144757259260706e-02   +7.594768465646570e-02   +3.283298558088316e-02   +3.069649385605030e-01; -1.483027877766115e-01   -1.024627882928508e-01   +3.309375461641992e-02   +1.401450751424925e-01   -1.059758121558355e-02   -1.497214585799961e-01   +1.019752067023408e-02   -5.322850703626177e-02   -5.130044399047090e-02   +1.834950713310196e-01   -2.020134456793542e-01   -2.701826353864593e-01   -4.659475868280233e-02   -2.865050588342427e-02   +6.258185700364147e-02   +5.116703383893904e-02; +1.258095981159810e-03   +5.293825977655989e-02   -1.753127168209105e-01   +1.207875795752606e-01   +1.628892842534437e-01   +1.937025029045202e-01   +1.232050016574464e-01   -1.173702257138725e-01   +1.841675038231924e-01   -8.733029041655413e-02   +1.176265604081464e-01   -1.024594971635000e-01   +1.801837485936576e-01   +1.644063422546521e-01   -1.141039345524025e-01   -8.959100871831628e-02; +1.104462818962398e-01   +8.005982959290714e-02   +3.375693834734715e-02   -1.386279755717896e-01   +9.511162649978201e-02   +2.349347564576401e-01   -3.202872398634491e-02   -9.031325226252347e-02   -1.610245701815467e-01   +1.559988536360998e-01   -1.296387079345153e-01   -6.351097107925037e-02   -9.073978179269034e-03   +2.197493243693991e-01   -1.782614355062889e-02   +2.056016907142615e-01; -3.648812010055056e-02   +1.417028667181211e-01   +2.936441825948943e-02   -8.926108220531179e-03   -6.825542971275167e-02   -1.550798891330739e-01   +5.770267037183373e-02   +2.024567560107275e-01   +8.155309155077924e-02   -9.975295128524102e-02   +1.097304592186320e-01   +7.969745862258286e-03   -1.322587758629375e-01   +1.596251004997477e-01   +9.744184723105359e-02   +1.344186715625540e-01; -5.266845353535171e-02   +1.526348364250957e-01   -1.091500446981215e-01   +2.319924023230922e-01   -1.509961107776888e-01   +2.103268644864865e-01   +1.880203628166039e-02   +1.727800484013794e-01   -9.707078268316985e-02   -6.823771558819899e-02   -5.181919713439648e-02   +2.813800441347207e-02   +2.097227665121755e-02   -4.460115057961563e-02   +1.876450602213392e-01   -4.125127940705677e-02; -6.506824539967426e-02   +1.791672912250159e-01   +2.290211487075191e-01   +1.009718881997915e-01   -7.176923874429114e-03   -2.565476916327530e-01   -2.026218844675750e-01   +7.198187320251069e-02   -8.839784673969650e-02   -6.029161029552347e-02   +6.508695751454409e-02   -5.554127725693647e-02   +1.696568582415525e-01   +6.612000879525089e-02   +1.594292857409146e-02   -5.307216766900883e-03];
L2E_L1E_iAMPA_netcon = [+3.962551129883687e-02   +1.971815119050645e-02   +2.545264287707126e-01   +8.249613656894586e-02   -7.449504388882928e-02   -1.375122514722090e-02   +4.889154211584170e-02   -1.904484977301058e-01; +1.675017821005296e-01   -3.770912677892109e-01   -3.033431702724693e-01   -3.028113852771672e-02   +2.862020210083565e-01   +6.525412466275726e-02   -7.122692931341358e-03   +8.088543038441658e-02; +1.076631099946312e-01   +7.286924636017034e-02   -2.374628788413287e-02   +1.021228866019696e-01   -1.198311324659547e-01   -1.956858374896989e-01   -7.258783702810635e-02   +1.299496053507222e-01; +7.656833219489916e-03   -7.298734311399030e-02   +1.211440727130554e-02   -2.026997684540974e-01   +2.673238779255938e-01   +1.093230692433072e-02   +2.966649577516827e-01   +1.099134427252798e-01; -3.335261485156128e-01   -3.551941419317198e-02   -2.256718799710800e-02   +2.219556614196648e-01   +1.370102149329558e-01   -1.424625285129160e-01   -2.040213687458724e-01   -2.397820722186531e-01; -3.741704511955401e-02   -3.828363795691138e-02   -3.756582709272405e-01   +2.876769690390387e-01   +7.418975620262834e-02   -2.829391002731968e-03   +4.689268240628775e-03   +3.046759112865768e-01; +1.700721700703321e-01   -5.297884265537434e-02   -2.061113810402834e-01   -6.224590988615360e-02   +1.800618115532459e-01   -2.741730951599507e-03   -4.108876382193317e-02   +2.728860739857576e-01; -1.318446341193533e-01   +1.136728030291266e-01   +6.041662249767104e-02   -1.763386424224790e-01   +4.576519487307544e-02   +6.609528242036754e-02   -1.136589399529704e-01   -1.519847843889076e-01; -2.655262723113718e-01   -4.093303137680638e-01   +1.491802492790376e-01   -2.417864673060559e-02   -1.721719326961257e-01   +1.263905325697513e-01   -2.099663209574084e-01   -1.534379693942362e-01; -1.546134650624618e-02   +2.607000573924415e-02   -1.284210606824158e-01   -8.875815647502650e-02   -2.422869806915995e-01   +1.417779386869518e-01   -5.313268943390313e-02   +4.239956948475504e-02; -9.227386250514556e-02   -3.113049284659251e-02   -2.763043499549969e-01   +1.023004241391567e-01   +1.138354292664762e-01   -8.642754841096914e-02   +2.484136409955469e-01   -2.167293189273253e-01; -2.530469124039018e-01   -1.582439764059260e-01   +2.486250783141646e-02   -1.614403515185002e-01   -2.098055443895673e-02   +2.946757287553582e-01   +2.894051620633569e-02   +1.001106056578703e-01; +6.159709025621922e-02   +9.908410530813690e-02   -2.282739980230191e-02   +4.093156201447151e-02   +6.809832734484868e-02   +7.325325247719175e-02   +2.560307841393243e-01   +2.223918270406507e-02; -1.137072010900497e-01   -1.776035598898540e-01   +5.462103153132131e-02   -6.080401591194828e-02   -7.585381575211030e-02   +1.362944506294104e-01   -1.521307845379505e-01   +1.721602814987952e-01; -4.064481554295497e-02   -1.575469184699524e-01   +2.717661565181484e-02   -1.155309267075666e-01   -1.358975202446696e-01   -2.133610188700140e-01   -1.286513655643419e-01   -8.997770624576787e-02; +2.758822198959794e-02   +2.042458963210229e-01   +6.500604980013017e-02   -3.504439159392101e-02   +1.272944488965246e-01   -1.336999264895067e-01   +7.488385897759554e-02   -1.350187782974648e-01];
L1E_L2E_iAMPA_netcon = [-1.458166755348217e-01   -1.355381583131099e-01   -2.998282013790978e-02   -1.844830046284782e-01   +9.308075438470112e-02   -1.843107658359399e-01   -1.010769384497912e-01   +3.494279448107895e-02   +1.152851579559262e-01   +8.181143927138969e-02   -6.358733911441958e-02   -2.889704779996936e-02   +1.747955925882010e-01   +2.474997613652967e-01   -1.052303869167761e-01   -9.212025566951419e-02; +7.106467675947184e-02   +1.513142213750232e-01   +6.454517666727509e-02   +1.681600391615424e-01   +1.024860520950102e-01   -4.226769228069814e-02   -1.011072177146762e-01   +2.877100355837635e-03   -2.694353049291292e-02   -6.986968058174123e-02   +1.029034876249672e-02   -2.843830566104666e-02   +3.766041441618452e-02   -2.923054899318926e-01   -3.734106404255341e-02   +9.416163644183215e-02; -4.964049347081246e-03   +1.868996066829999e-01   -3.932639808754226e-02   +1.180915235523325e-01   +2.554446423172159e-02   +1.256496670523576e-01   +2.922172895952134e-02   +8.073338984337315e-02   +2.444095859046217e-02   +1.477293280422211e-01   +1.968182288277389e-01   -1.029180266932304e-02   -3.069132230164475e-01   -1.325754201748810e-02   +2.218411779792134e-01   -2.335669182763720e-01; +1.904864223877852e-02   -1.936181950010484e-01   -1.926430666467916e-01   -1.122370645303946e-01   -2.280602926535649e-02   +7.640194146804360e-02   -1.747965538440071e-01   -5.032396547947339e-02   -2.654619214231866e-02   -2.889954367621341e-01   -5.195322745668870e-02   -1.291489226182406e-01   +1.056823017957209e-01   +1.139017004473982e-01   +7.539209299454833e-02   +4.173548079958993e-02; +4.322727999062064e-02   +4.818353837865805e-02   -1.764313065557464e-01   +1.780384371885678e-01   +2.043681201183475e-01   +1.737992232249214e-01   -6.258509555428497e-02   +1.215648464700828e-02   -1.788820672221901e-01   -8.867318172364914e-02   +1.095971791165324e-01   +2.116670162562851e-01   -2.080238194633864e-01   -1.216321759827078e-02   +1.891510457334923e-02   -5.549272427784868e-02; -2.230393493788500e-01   -8.918233165058241e-02   -6.422651548847008e-02   +5.407456094946381e-02   -9.786792355874552e-02   +1.415689451715071e-01   -4.376978081747426e-02   -5.502696604985535e-02   -7.883982289527797e-02   +2.053983626013885e-01   -1.848317974687509e-01   +2.054739731304750e-01   -1.259899646459970e-01   -9.610960462812711e-02   +2.299390832636874e-01   -1.425692093459307e-02; +2.335247707366958e-01   -1.135742434699538e-01   +2.993007689627697e-02   -3.868459811838913e-02   +3.577722233475439e-01   -1.480342576251781e-01   -7.384648250525469e-02   -6.903781096672766e-02   +6.873027724994968e-02   -1.407442643656585e-01   -3.814626563445368e-02   +1.928948239374205e-01   +2.549718141058400e-01   -1.352887486766889e-01   +2.717894681338633e-01   -6.146284915142915e-03; +4.171227547926264e-02   +3.603994795114526e-02   +1.554601690335347e-01   -1.596167099372575e-01   +7.424483483507376e-02   -7.158869219815764e-03   +8.791236642623697e-02   -2.993090194307396e-01   +2.026825784704101e-02   +1.912661110535276e-02   -2.129119904273806e-01   +1.016630699261358e-02   +1.789126327628175e-01   -5.286438393534711e-02   +2.948413056750314e-01   +7.038141147818691e-02];
L2I_L2E_iAMPA_netcon = [-3.040297297723893e-01   +2.468341032132985e-01   -1.569494136820165e-02   -7.413361428658578e-02   -1.458647282133127e-01   +1.545942937220498e-01   +9.174429374516622e-02   -1.433657300497003e-01; -1.004746564616937e-01   +2.356251128975007e-01   -1.662196147553666e-01   +8.535862851607556e-02   -1.762515295085903e-01   -3.172115683287276e-01   +1.660135118670535e-01   -1.174152579645197e-01; +1.166663295267145e-01   +1.734120847386760e-01   +1.372558060750162e-02   +1.177384929782925e-01   -1.881102605892518e-01   -2.226503392439825e-01   +1.914830569818372e-01   -3.623956036004092e-02; -2.988384724168507e-02   -1.058729833547556e-01   +7.819027100932361e-03   +1.137182056897744e-01   +8.916319359489829e-02   +2.302170736513655e-01   -2.043517808645020e-01   -1.226138992037450e-01; -1.512666500282606e-01   -4.569146530290187e-03   +7.886453324496280e-02   -4.428827863239409e-03   -1.712585938441281e-01   +4.863558506505166e-02   +2.229548241451589e-01   +1.874232535005100e-01; -3.898278256520130e-01   +2.019947878542202e-01   +2.695403091295596e-01   +4.481626024624186e-02   +6.774231384282062e-02   +6.553412106281721e-03   +1.043522004965375e-01   -1.502199560898793e-01; +1.285074258973881e-01   -7.071136833422828e-02   +2.217622394399744e-02   +1.805334892528717e-01   -5.586759681959207e-02   -3.593746234255188e-02   -9.651138527192181e-03   +7.062528845175511e-02; +2.225302406016946e-01   +2.018817416164209e-01   +1.675011051341562e-01   +2.798700121666212e-01   -1.008679465683898e-01   +5.632623711192442e-02   -2.820482431098711e-01   +6.599256718387450e-02];
L2E_L2I_iGABA_netcon = [-1.432563939751555e-01   -1.522173421423780e-01   +9.363880374646073e-02   +8.524302260019007e-02   +3.347056781763898e-02   +8.983883320662861e-02   +8.960680155354336e-02   +1.999890796584755e-01; -2.215138336067722e-01   -1.390390592023365e-01   +1.839426914823103e-02   +1.954206050406603e-01   -3.007526226374093e-02   +1.890657710573976e-01   +2.754489940944248e-02   -2.275002331042689e-02; -1.143808801692297e-01   +1.238392162628507e-01   -8.119339206535527e-02   -2.764993740411834e-02   +4.520384242865755e-02   +2.308828538947800e-01   -5.025543959808754e-02   +8.664775387145028e-02; +7.391938907316853e-02   +4.199144422032642e-03   -8.974067920828956e-02   +6.908308017895329e-03   -3.491968806359030e-02   +1.349846293491182e-01   -3.768129654349566e-01   +2.142498496605682e-01; +2.943727220966351e-02   +1.941711750692715e-01   -7.565007990223793e-02   -8.393160452299669e-02   +1.497340567231237e-01   -1.874012576187587e-01   +1.775839723635443e-01   +8.405773009297973e-02; +7.329931964616686e-02   -6.985892484901979e-02   -2.453513091993526e-01   +9.684203814303191e-02   +1.198162429419792e-01   +3.391819051443570e-02   +7.890487967563209e-02   +1.587285278423144e-01; -8.670156887525221e-02   -3.806535333873813e-01   -1.374683401345433e-01   -5.122704094024783e-02   +2.142797158988001e-01   -9.822546699985660e-02   +1.791975516393398e-01   -3.676281357229287e-03; -6.293409858712495e-03   +4.239487807233407e-02   -6.594246156480901e-02   +2.436428353583202e-01   +2.328757234685470e-01   -1.335640990524932e-01   +1.478284375292578e-01   +3.627038192778499e-02];
L3E_L2E_iAMPA_netcon = [+1.394612641269617e-01   -2.351533041097926e-01   +1.156301738786251e-01   +8.596444841475602e-02   +1.213508118650514e-01   -1.506322808237671e-02   +2.039900708383127e-03   +7.294392060169383e-02   +4.329024950578983e-02   +1.559889366384253e-02   +4.462977952887875e-02   -1.988830256249251e-01; -1.837414866315598e-02   +1.279183388984547e-01   +1.473034684304925e-01   -7.917309336082594e-02   -2.210658854127697e-02   +2.058100540872082e-01   +2.601061259156944e-02   +9.461974238386295e-02   +2.469254396695646e-01   +1.509979532437698e-02   -1.193694881985206e-01   +2.300460744136258e-01; +1.558053904887429e-01   -1.399856014512851e-01   +7.058875309382910e-02   +1.632357228321784e-01   +1.432127019723742e-01   -1.292870633132274e-01   +1.713105323470553e-01   +2.584569815891931e-03   -2.206497036126484e-02   -9.534403166405152e-02   +6.881806669187061e-02   +2.668710451083112e-02; -4.659424010569223e-03   +1.063200268034637e-01   -1.205050567443276e-01   +1.261975834888380e-01   +1.165782185687932e-01   -7.104591321125225e-02   +7.666816986265011e-03   +1.164176384056257e-01   -1.039420364997087e-02   -1.537736406183614e-01   +2.044213697154242e-02   -2.365904653811404e-02; -3.988731732230491e-03   +3.998732693296829e-02   +3.263477969372929e-02   +2.006030573075186e-01   -2.721416099933979e-01   -5.053007235643807e-03   +1.778202642177791e-01   +3.402056320204894e-04   +1.056689089122490e-01   +1.241510744114569e-01   -7.473561614527571e-02   -3.793533179585529e-03; -6.742744743109312e-02   -4.225146335153685e-02   -1.914062430412503e-02   +2.867290781678204e-02   -8.600158427790208e-02   +2.814241682153157e-02   +8.402884417526682e-02   +2.052802315839646e-01   +7.344966544873043e-02   -9.187663014583712e-02   +1.005907080649989e-02   +7.383431884276369e-02; +1.088283537838143e-01   +1.505206279863474e-01   +1.109392216274083e-01   -1.467576353815101e-01   -5.342836847550127e-02   +1.311860573884536e-01   +2.162784655212445e-01   +2.344992712861296e-02   -1.286352198334698e-01   -3.299084521758357e-02   -2.135169954408721e-02   -8.045224305002938e-02; +9.436309803347383e-02   +1.318259558030629e-01   -1.713588009323244e-01   -6.105422998529149e-02   +1.081075216851107e-01   +1.747352527467843e-02   +1.682148880350097e-02   -6.661285521258795e-02   -2.133960777748098e-01   +2.354919067730822e-01   +3.208397045080282e-01   +1.289846836262839e-01];
L3I_L2I_iGABA_netcon = [+2.714085073981347e-01   -1.899498585260717e-01   +2.714706528706451e-01   +3.663420319238870e-01   -2.016639553033233e-01   -5.228232107025003e-02   +9.602633521890469e-02   +8.548935113298038e-02   +3.590719050223261e-02   -1.848674060330790e-01   +1.858818832592072e-01   +1.947419619658407e-01; +3.191277969089368e-02   -1.547824013140542e-01   +1.720478914626825e-02   +1.026018261287015e-01   -2.222961181315363e-01   -1.034184346503045e-01   +3.058562590719303e-02   +8.597975249796252e-02   -5.769184720126952e-02   +1.195865046223498e-01   -3.984111588254652e-03   +1.149904532934592e-01; +1.664160805724243e-01   +1.681277652743708e-01   -1.359735982073557e-01   +3.272406631829669e-01   -2.994423864451385e-02   +5.631921618878395e-02   +4.104125875014888e-02   -3.711405846978280e-02   -3.535751115602960e-02   +1.939554532295149e-01   -7.771081515691894e-02   +1.333609833917680e-01; +8.397754541633505e-02   -2.590820805766489e-01   -2.240449724146749e-01   -8.106181851729073e-03   +4.488550138553071e-02   +1.028058734933518e-01   -5.307550141425114e-02   -1.379916291801430e-02   +1.769670291004096e-01   -8.148843528232037e-02   -1.906420794864096e-01   -3.036691352494728e-01; -5.918304508337992e-03   +4.331422832430583e-02   +1.333931220330555e-01   -3.087319695175561e-01   -7.549400783003342e-02   -1.287296508067878e-01   +1.744077423274367e-02   +1.035394121937318e-02   +2.861180262056237e-01   +6.769610917396812e-03   -8.607881496952306e-02   +1.137702300215422e-01; -2.856461816081939e-01   -1.609283704243187e-02   +6.661164478905779e-02   -3.328358478444763e-01   +1.711821256996184e-02   +2.713154873108627e-01   -1.869343675163957e-01   +1.168162766393712e-01   -5.575119392075849e-02   +7.459453628047852e-02   -2.049791111653223e-01   -2.227874850053209e-01; +1.870188994134004e-01   +2.823497922238347e-02   +4.374462156861620e-02   +2.475835805913613e-03   -2.478093541337169e-01   +4.133199869248868e-02   -8.573087548225486e-02   +1.269111219920796e-02   +5.782053962732128e-02   +1.526322725752441e-01   -1.129822582575615e-01   -1.427239797140611e-01; -1.009101346250492e-01   +3.096414725193728e-01   -2.636567248047105e-01   -5.613353940090782e-02   -1.019719976857247e-01   -5.265832435125185e-02   -8.634859696403137e-02   -7.312529300091379e-02   +8.114219406454995e-02   +1.366790970023833e-01   -1.200218501904702e-01   +6.266943558772538e-02];
L2E_L3E_iAMPA_netcon = [+6.701407352912983e-02   +1.303914294898728e-02   +1.827601852372507e-01   +3.789781730796008e-02   -1.929402280567800e-02   +1.113302223076198e-01   -1.700920913989372e-01   +1.390888090479137e-01; -1.337921313292452e-01   -9.818588189700903e-02   +2.485736395004192e-02   -2.358641097071385e-01   +3.242732694849805e-02   -1.406170555766914e-01   +1.167410356858815e-01   -7.964564511065565e-02; +1.297693596762678e-01   +2.557834226780995e-02   -2.007245243588089e-01   +1.314225888720030e-02   -2.429103792414703e-01   -7.220107961446336e-02   -4.995773997105823e-03   +2.857311489289412e-02; -3.953336332993016e-02   +2.414797408569532e-02   -1.709791434306273e-01   +8.621513337235487e-02   +9.740067654416819e-02   -3.761121948723425e-03   -1.142206684490781e-01   +2.122755751921077e-01; +1.944166208196770e-01   +6.011985986481488e-03   +1.529310240736619e-01   -1.492041828259281e-01   -9.259260595119696e-02   -4.698664857697772e-02   +1.625956109692477e-03   -1.151533348012659e-01; -1.189513773099293e-01   -4.580327643376901e-02   +9.425222821916232e-03   -6.356612867486221e-02   +9.384198351034367e-02   -1.330857808087811e-01   -3.863297527108824e-02   +9.303637451631491e-02; +8.164870592232054e-02   +2.007058079708787e-02   -1.932320493059078e-01   +7.485472760697913e-02   +2.300651665603619e-02   -6.508400571062563e-02   +1.561160964573561e-01   -1.724468283044290e-01; +3.884740719836155e-01   +7.798903248790605e-02   +6.677657685560200e-02   +1.028474837973846e-01   +3.127267824997046e-01   -4.825388129282872e-02   -2.887960794849474e-02   +5.287437499400920e-02; +3.058194358882807e-01   +8.633390208514406e-02   +9.066165061389035e-02   +8.977964164170094e-02   +2.294423146224523e-01   +9.389859718074252e-02   -6.429413294484108e-02   -2.447583846405438e-01; +1.852626486993122e-01   +1.107519540231621e-01   -1.334950942409664e-01   +3.604573573747565e-03   -1.531670910421748e-01   -2.957976622715931e-01   +1.560346461578800e-01   -5.670651881640176e-02; -3.355541016853981e-02   -3.977196628657734e-02   +1.447062399956483e-02   -8.593269938366599e-02   +5.564128863057152e-02   -6.723264664454426e-02   -1.257349078677282e-01   -3.764453331782835e-02; -8.803371513237371e-02   +2.286475574464620e-03   +5.012542396841732e-02   -8.573291850283675e-02   +1.123785283918148e-02   -8.777589777972210e-02   -1.859766364160585e-01   +1.673268127533614e-01];
L2I_L3I_iGABA_netcon = [-7.769891572168358e-02   -3.241718078095899e-02   +9.849414214655340e-02   +2.191251767548719e-01   +1.230236735167444e-02   -5.554453641358311e-02   -2.287478091684686e-01   +1.533766769234909e-01; -3.291855419536395e-02   +5.318259071448499e-03   -1.171510739452075e-02   +2.147031850982367e-01   +7.539649040643090e-02   +1.789151959979205e-01   +9.288000507967045e-02   -2.994282361381305e-01; +1.178298000629970e-01   -1.067888284906120e-01   -7.450676995346019e-02   -7.507501777405553e-03   -1.522040729846854e-01   -1.175945698565651e-01   +1.249110573553710e-01   -5.217253366739945e-02; -1.009778929184440e-01   -5.837651962097653e-02   -1.275882628692319e-01   +8.935505248823794e-02   -6.489335836731834e-02   +1.642832304137012e-01   -2.722982856366631e-02   +9.839175904130261e-02; -1.868495977760236e-01   +9.410623615773149e-02   -7.261133973323512e-03   +7.542530265896760e-02   -1.081818737077862e-02   +1.543033983072958e-01   -2.598682220261768e-01   -1.697415600140223e-01; +3.463849087005785e-02   +1.196180852487592e-01   +1.646043990932213e-01   -1.362906205184574e-01   -2.695833211323928e-02   +6.891211800376508e-02   +2.867906952873176e-02   +2.954353334196183e-02; -1.572439499886061e-01   +9.325392150555367e-02   -3.725295778560181e-02   -3.234633107017258e-02   -1.203058737948060e-03   -1.729544073951343e-02   -6.393005566133492e-03   +6.134015613298602e-02; +1.037529466014680e-01   -3.334638826617406e-02   +4.883067105412451e-02   -6.143387794251110e-02   +8.447267356824605e-02   +8.536917487829615e-02   -9.378219967804632e-02   -1.207086755640003e-01; -6.595617225595125e-02   -2.924783893943967e-01   +8.366773099525057e-02   +1.437443380068229e-01   -1.026144836489284e-01   +1.090125197497375e-01   +1.305467339109442e-01   +6.661550882573997e-02; +1.614597781669818e-01   +4.415914665078945e-02   +1.750934150874305e-01   +5.135503104482045e-02   +4.487022623868567e-02   +2.060626980291972e-01   +1.295657000419839e-01   -1.644847301285277e-01; +9.225175172169890e-03   -1.736154968582945e-02   -1.148340219422347e-02   +5.832314891352047e-02   -3.185571842657343e-01   +2.616108161646121e-01   +1.293870414438242e-02   -8.783839643996665e-02; +2.844591002888452e-02   -4.977383221311130e-02   +1.006111568221175e-01   +7.002562885475909e-02   +1.303275887423230e-01   +9.805987052662900e-02   +2.021025465805232e-01   +1.196742723169008e-01];
L3I_L3E_iAMPA_netcon = [-8.474661951684441e-03   -1.835172179875445e-01   +1.787919586044175e-01   +1.417749661870479e-01   -9.049513136432802e-02   -9.891129938469290e-02   +1.000810510962572e-02   +3.696985557681198e-02   -1.299204974922313e-02   +4.455061820332603e-02   -1.221698404341747e-01   -8.262818967388375e-02; +1.014673184330380e-01   -1.619408530909064e-01   +8.464850583372550e-02   +1.980007510721628e-01   -1.196297614194737e-01   -1.816554579835423e-01   +1.113469707660151e-03   +1.277837548437783e-01   +7.347444897420115e-02   +9.929886704049665e-03   +1.631298696999996e-01   +2.532111599550134e-01; +5.506355822876816e-02   -2.094567736940458e-01   +6.619577180105847e-02   +2.049757820054222e-02   +1.679251971840887e-01   +2.920832358747569e-01   +2.166842896017329e-01   +3.486095545022896e-01   +1.365723615725788e-01   -3.602866777921281e-02   -2.936881679672831e-01   +1.439447329613972e-01; -3.601070252757998e-02   +2.941884924807346e-01   +6.590944336162206e-02   -1.063414014977404e-01   +1.139693269201023e-01   +2.782759871733900e-02   -7.315191984034790e-02   +1.276786956759116e-01   +8.490523674362624e-02   -1.641541730529561e-01   -6.401522512681672e-02   +9.805480194940515e-02; +2.060407001307511e-01   +1.399344093817152e-01   -1.057669996474433e-01   +1.055564694027905e-01   +1.475083286140949e-01   +4.568503113963664e-02   +1.049309778485199e-01   +5.897987149025546e-02   +6.121277649821727e-02   -8.589054327412035e-02   -2.429317666409815e-01   +1.901778067886976e-02; +1.304197018621287e-02   +1.651616621304806e-01   -1.490999693678643e-01   +1.934329110702912e-01   -1.459935064916808e-01   +1.517868326155563e-01   +1.842040283845389e-01   -2.609378754075200e-02   -1.769054320215177e-01   -7.999389971583237e-02   +7.737384358817080e-02   +1.817801641642523e-01; +4.268643058792030e-02   -5.863400729123003e-03   +5.754470527571513e-02   -3.717950165791385e-02   +3.167281819742994e-02   -9.567567621560197e-02   +1.861108656832529e-03   +1.012203338923608e-01   +4.205335224046369e-02   -1.172012243102604e-01   +9.843832387198129e-02   -2.163619808761290e-01; +1.978757896178522e-01   -2.019846858032013e-01   +1.050078049279561e-02   +1.172764144115172e-01   -2.153713458629089e-02   -1.097822743565438e-03   -1.062317553978695e-01   -3.754693456050301e-02   +2.445057279541943e-01   +3.020520681120905e-03   +1.277488102017698e-01   -7.138531120869042e-02; -7.459289168744579e-02   +1.675188420965318e-01   +1.524453536381314e-01   -1.182528929593413e-01   +9.990251987747006e-02   -2.694007098170505e-01   -1.671071767905157e-01   -8.123053086505945e-02   +7.835527000453041e-02   +2.356298399126807e-02   +5.384573804248620e-02   -1.340127156287116e-02; -9.380715315255059e-02   -6.499856188595474e-02   -4.182869543533550e-02   -2.239217491748315e-02   +2.247195591771756e-01   +1.950212987313838e-01   -2.609584619880524e-01   +2.180952514869700e-01   +9.689977486282874e-03   +1.318645290110638e-01   -2.617504500859505e-02   +2.365131806226781e-01; -3.323260567951172e-02   -4.037673044928309e-02   -1.620878833761610e-01   -9.590446147126344e-02   +1.298858135412022e-01   +8.719794794640102e-02   +1.762436133793829e-01   +2.070849415327908e-02   +3.201509003654718e-02   +2.622310722721839e-01   +2.720368990900512e-01   +7.623111251931557e-03; -1.188413045435529e-02   -6.240296745460407e-02   -2.112350025122532e-01   +8.467638066727126e-02   -1.163650021502030e-01   -9.167956739737040e-02   +1.170928378781654e-01   -1.208698358079109e-01   +2.346689868613173e-01   +1.038957849088294e-01   +5.815906276387709e-02   +9.228081197200635e-02];
L3E_L3I_iGABA_netcon = [+3.294575561906265e-02   -4.476142495678544e-02   -8.372806064905569e-03   -1.051887613471176e-01   -8.680093693292798e-03   -1.407097029895714e-01   -7.766850054924512e-02   -1.567380687387882e-01   +7.687408065091736e-02   -2.069342242369456e-01   +4.594875392190070e-02   -2.218712296536723e-02; -1.364207158253489e-01   -3.324981513879704e-02   -7.205500127305636e-02   -1.456204213215392e-01   +2.230395121064780e-01   -1.953151643969600e-01   +1.829342533604746e-01   -1.724029424149997e-01   -5.034949897475400e-03   -2.573587068896749e-01   +6.435243446073897e-02   -1.289918908687570e-01; -9.813474526590724e-02   +3.510062001287488e-02   +1.669645746634048e-01   -8.941227016900061e-02   +1.020953699995982e-01   +1.965569184404932e-01   -1.023261858843797e-01   -8.928293030010945e-02   -5.145014422215252e-03   +4.860223774523829e-02   +5.293389589384771e-02   -4.666782777585909e-02; +2.508201451315609e-01   -1.276379185805522e-01   +1.271138659425445e-01   +1.521299984616000e-01   +8.925593669140477e-02   +8.808095001642495e-02   -1.820728394721559e-01   +1.557744305874447e-01   -9.522325872446551e-02   -6.451945817102195e-02   -5.476404102876200e-03   -8.166486565163508e-02; -9.190848919152513e-02   +6.987454826905486e-02   +3.799960210406877e-02   +9.116827228393089e-02   -4.214817447362637e-02   +6.038399918708388e-02   +5.286631305389005e-02   -9.285535656000966e-02   +1.483227385974207e-01   -4.303098354231534e-02   +2.585156725366914e-01   -6.758026046159346e-02; -6.729238953366574e-02   +1.981238400014213e-01   -2.400648995414025e-01   -9.939269516005249e-02   +3.241769871734461e-01   +2.654604502047592e-01   -7.390112200568819e-02   +9.958823486049315e-02   +7.674234267232034e-02   -1.514276104465584e-01   +2.132250494614207e-01   +1.645478018434632e-01; +2.212856494172822e-01   +6.805971004544045e-02   -1.745797020815419e-03   -2.615902318472864e-01   +2.974896976569182e-02   -1.801234294042349e-01   +3.116940001061438e-02   +7.036521720608042e-02   -1.784104346008380e-01   -6.434748510221477e-02   -1.939920518776204e-01   +6.934720772253314e-02; +2.053903296933960e-01   +1.171726835111248e-01   +1.319248433155222e-01   +1.318567293897435e-01   +1.484085297468921e-01   +1.550163682174216e-01   +2.338288904872213e-02   -3.083895301291232e-02   +1.494815793871615e-01   -9.932599003731710e-02   +2.581306785989940e-01   -1.425016311425787e-02; -2.950468487348355e-02   -1.013925303488952e-01   -1.245828049256812e-01   -9.575645771882800e-02   +1.459957234622836e-01   +2.345287806171472e-01   +1.442784604652160e-01   -1.316966580481013e-01   +2.212357396461836e-01   +1.398853488434614e-01   -2.881098943798590e-01   -3.145977077157713e-02; +1.905907911908643e-01   +1.715705158719287e-01   +3.622775605454066e-02   -5.117380675418033e-02   -1.264946935832058e-01   -2.207598260611650e-01   +2.021556058472237e-01   -7.918703963725846e-02   +1.235866079632236e-01   +7.730835088111279e-02   +8.424842374813361e-02   -1.847000665293214e-01; +7.190034533325357e-04   -2.352404605715506e-03   -3.242059755117888e-01   -7.092906828630741e-02   -8.700722747371195e-02   -1.390791477044439e-01   +8.026330465273286e-02   -1.401604598822892e-01   -6.528285393821859e-02   +5.660695196622920e-02   +1.034371713939568e-01   -1.365647460072253e-01; +8.747945774489987e-02   -4.052344734647974e-01   +2.289512304928723e-02   +2.233091417399383e-01   -2.929001042750692e-01   -8.604510590914832e-02   -9.748596708892920e-02   +6.026279203045524e-02   +1.235437896329105e-01   -1.773380027860827e-01   -1.168883550270332e-03   +2.225248797322737e-01];
L2E_Input1_iAMPA_netcon = [-3.397550701292382e-01   +2.864690554987359e-02   -1.151717494695907e-01   -1.027580295498879e-01   -1.247620126000936e-01   +1.625436113194320e-01   -2.035025728503443e-01   -1.340987379524576e-01];
L2I_Input2_iAMPA_netcon = [-1.280442867400321e-01   -3.569951188795972e-02   -1.293627032773804e-01   -1.074331735008725e-01   +4.651406335222865e-03   +4.772036401225331e-02   -3.236210602684712e-01   +1.208070469289561e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
