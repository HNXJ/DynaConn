function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.117665626451247e-01   +1.597151179325576e-01   +7.090588659827145e-01   -1.811534411438396e-02   +1.389271959548241e-01   +7.219714057822106e-01   +1.488153995759368e-01   +1.505064570673710e-01   +2.787145008036017e-01   +5.684073626847855e-01   +1.257095399497589e-01   +1.182635432927013e-01   +7.288374617651409e-02   +3.284181130939843e-01   +7.332436531841877e-01   +2.192672764239904e-01; +7.125233047011089e-01   +4.473182787940557e-01   -1.978096643438673e-01   +1.749231143802176e-01   +7.206333724545946e-01   +4.414179765612951e-01   +2.725158070653262e-01   +3.883489064830826e-01   +4.535720840176447e-01   +1.868158352222691e-01   +4.601009758668496e-01   +6.540924822804492e-01   +5.226142440936988e-01   +8.715422015774587e-01   +4.216172443882564e-02   +2.743351001249187e-01; +3.967870800835088e-01   +3.921724025953422e-01   +1.985791608570483e-01   +4.839765813292820e-01   +5.563425921387809e-01   +1.468421595478360e-01   +2.596570700922448e-01   +2.187139397965074e-01   +2.149979201044495e-01   +3.850059162532987e-01   +5.586736984799964e-02   +3.398947821136643e-01   +5.488953300425539e-01   +5.821642414522763e-01   +1.235940870868976e-01   +3.901626051786878e-01; +6.397488176724553e-01   +3.690481878002649e-01   +7.800974806461475e-01   +8.410019869966229e-01   +8.737126860796772e-01   +2.926806659244117e-01   +6.756184291680913e-01   +8.600381073358343e-01   +7.843264937715153e-01   +4.837795152871570e-01   +1.656819378149391e-01   +2.387204852274587e-01   +2.519080242613901e-01   +3.084302686387503e-01   +3.602656117560746e-01   +2.299473979441042e-01; +4.551199166012445e-01   +6.809689389510195e-01   +4.122561442187908e-01   +9.779523407977779e-01   +1.926197911394952e-01   +3.969349131551066e-02   +1.870339466286745e-01   +7.578597210160410e-01   +6.900745566791233e-01   +7.759023040811264e-01   +9.213775079436225e-01   +2.276347112452647e-01   +7.912830349611734e-01   -6.809943625420811e-02   +2.357852188979159e-01   +3.472468242951033e-01; +1.114896008472409e-01   +2.747753494050841e-01   +4.423818021814199e-01   +5.672384950228944e-02   +1.478613702176956e-01   +8.284978947089855e-01   +6.118179316673944e-01   +5.285437553919869e-01   +1.832352250691990e-01   +6.797801974594994e-01   +1.264289466747891e-01   +8.597600459178810e-01   +2.886381169163565e-01   +3.260761888365003e-01   +5.886905484191276e-01   +5.459579929951381e-01; +4.600827172252576e-01   +7.513258492761991e-01   +1.245624937361583e-01   -2.787400001083983e-02   +5.503796716132111e-01   +6.995875650499150e-01   +5.854181134433724e-01   +1.645396073218269e-01   +1.591327806359126e-01   +5.916615208104614e-01   +6.106425709022556e-01   +6.684905785209714e-01   +4.611159639319920e-01   +2.057870133338306e-01   -8.076297239973110e-03   +7.546615510475158e-02; +7.116817370627349e-01   +7.331597344815655e-01   +3.854070577847815e-01   -1.425311545795456e-01   +4.625724921918303e-01   +1.108885009837947e-03   +3.508883515363472e-01   +2.515222046454792e-01   +4.098501855206510e-01   +6.591677440689667e-01   +3.997782697930648e-01   +2.768529673184178e-01   +2.723746160890538e-01   +4.905123753279704e-01   +3.943751818663017e-01   +7.689186252360745e-01; +1.705559133200810e-01   +3.357003151620594e-01   +1.118280853169994e-01   +6.429403903005533e-01   +8.614340696085950e-01   -1.216521267587364e-01   +5.610392009945765e-01   +4.665730648644428e-01   +3.021552995391454e-01   +1.918518639610330e-01   +7.193870264059473e-01   -7.583099058860888e-02   +2.211362035178489e-01   +8.472836992134899e-02   +3.707675248370098e-01   -3.044037185034132e-02; +3.605863639234358e-01   +4.835188393052507e-01   +3.714990587702757e-01   +4.095755810015067e-01   +7.116989045058046e-01   +5.696509576618904e-01   +3.871271735095319e-01   +5.750662942442042e-01   -1.539505495326567e-02   +2.084441478446661e-01   +2.199274229678693e-01   +5.354594862405520e-01   +6.037993521012119e-01   +6.047956423518991e-01   +3.872877276293551e-02   +6.109568568742829e-01; +3.432278616456682e-01   +4.849868771028131e-01   +4.276103570490477e-01   +5.858570809204554e-01   +4.968393720949904e-01   +4.298990945366039e-01   +5.502028065878829e-01   +7.434716125092405e-01   +4.326831241318418e-01   +1.044638122394072e-01   +2.951619544635128e-01   +7.010696211913560e-01   +2.540359624745390e-01   +4.953947318491068e-01   +3.402457520001694e-01   +1.037935809940540e-01; +4.183762042224985e-01   -1.179779849715445e-02   +6.475546271192884e-01   +4.921454672077967e-01   +5.275960338430837e-01   +3.842162775737848e-02   +3.627095565507126e-01   +6.052931831209112e-02   +5.144564430085157e-02   +4.879991061328144e-01   +2.092198826397695e-01   +4.103520272451380e-03   +7.369062213761682e-01   +5.030063284057246e-01   -6.150792468474158e-02   +1.055503336235511e-01; +1.604504159952530e-01   +1.953974262360496e-01   +8.585941540376173e-01   +7.131443802992864e-01   +6.328167120105941e-01   +9.403900353083546e-01   +1.814269685045289e-01   +3.675646374362154e-01   +1.607584293307995e-01   +3.925875115144243e-01   +3.067373648524875e-01   +5.035127814503726e-01   +3.558556835969062e-01   +6.595285886254723e-01   +6.132948809568077e-01   +4.292223190709777e-01; +4.716771194280552e-01   +7.918702323648837e-01   +6.902371881374756e-01   +7.339837052183317e-01   +7.471209000748388e-01   +3.565971307612012e-01   +1.733143765881189e-01   +2.474110177383160e-01   +6.530402148272131e-01   -9.573379985687147e-02   +5.247202537078663e-01   +1.445597719043932e-01   +4.564657205601753e-01   -2.036841177479314e-01   +2.159422046561593e-01   +2.611978168383665e-01; +1.863686073779067e-01   +5.143747732054957e-01   +4.066982131061861e-01   +5.475633376611779e-01   +7.108019705665486e-01   +8.991034627912597e-01   -6.940479247613561e-02   +2.532613851485550e-01   -2.077747762239861e-01   +3.428865648269077e-01   +3.483108611993068e-01   +5.943233970292093e-01   +8.241173085697492e-01   +7.779157041506050e-01   +3.699997375215676e-01   +3.000408942010740e-01; +5.354696612783281e-01   +1.955253727993068e-01   -1.123253794613845e-01   +2.510560240173138e-01   +4.997140765539227e-01   +4.856939719520891e-01   -1.218907634433607e-02   +2.686815786055789e-01   +4.145935557248153e-01   +6.306234461993556e-01   +7.095607308885835e-01   +3.643046529019121e-01   +6.454066997740839e-01   -2.567102144221907e-02   +5.594202123836274e-01   +5.625805247595550e-01];
L1E_L1I_iGABA_netcon = [+5.178072793086566e-01   +5.557916668089531e-01   +4.782005355887042e-01   +1.753060614183404e-01   +5.839963387077444e-02   +3.090635293423551e-01   +4.355805422587892e-01   +8.467371396639271e-02   +7.235613036550851e-01   +5.268786568190922e-01   +3.999383687074859e-01   +3.260684569271669e-01   +8.860674420746185e-01   +2.104408159817550e-01   +3.548794866293858e-01   +1.353098278244723e-01; -6.453764902397620e-02   +1.203306703493061e-01   -1.068157095246227e-03   +3.368692526656074e-01   +1.736358400471425e-01   +5.163960464722442e-01   +2.639476052738233e-01   -5.910820176274729e-02   +6.888545292781373e-01   +3.448998715755219e-01   +3.641173053581153e-01   +1.075769754273914e-01   +5.091085611397684e-01   +3.938004710495410e-01   +2.192390884570254e-01   +4.329502200432453e-01; +5.590217555806114e-01   +5.523691832631472e-01   +5.972335115759697e-01   +1.088743106064975e-01   +6.203115596897530e-01   +7.310744084450976e-01   +3.281678063459337e-01   +6.266516973086980e-02   +6.018686479448389e-01   +3.342600627293971e-01   +6.556733575380134e-01   +6.160932614761030e-01   +7.998125307316353e-01   +2.000685941430624e-02   +3.050576402644614e-01   +4.504264190615935e-01; +2.635841546653763e-01   +6.806583485478285e-02   +2.022617081489194e-01   +4.811316563910586e-01   +6.927246990367159e-01   +6.249146937971032e-01   +7.217014664426944e-01   +2.753200777381098e-01   +1.776451692203715e-01   +8.490007783934085e-01   +1.119291718149091e-01   +2.159207645421676e-01   +6.481517458381560e-01   +9.232325183730956e-02   +4.929011955743944e-01   +4.118606315420600e-01; +1.974421209767374e-01   +7.267884281309096e-02   +1.988485009136646e-01   +4.365792642983873e-01   +2.286673947215847e-01   +5.701447148279011e-01   +7.616884975605368e-01   +7.181989186460320e-01   +2.588802059428438e-01   +4.146923201880247e-01   +5.811044509686734e-01   +7.277214161930002e-01   +3.179938008065534e-01   +4.570699521246193e-01   +5.413383264459065e-01   +1.504360512483721e-01; +5.196332124832339e-01   +2.951473650816497e-01   +4.539630621532108e-01   +1.617612510167434e-01   +2.339966650484936e-01   +3.096879602038676e-01   +6.239579513686915e-01   +3.942899776356279e-01   +7.437001818420882e-02   +5.615495363856211e-01   +3.009887083149047e-01   +3.084334899152089e-01   +9.563896595149525e-02   +4.403827649086146e-01   +4.275356140334632e-01   +6.648368626269409e-01; +1.998014385254011e-02   +9.126785110518477e-01   +2.126017292767114e-01   +3.997518673025004e-01   +5.614693582685015e-02   -1.943553108333056e-01   +6.974199063180887e-01   +4.549757307115205e-01   +7.575649132307435e-02   +3.421932669993656e-02   +4.387635546321962e-01   +6.188635197695624e-02   +1.454916948745256e-01   +4.086075019249979e-01   +6.593779799731773e-01   +1.738795571232116e-01; +1.642385314724082e-01   +9.888193395862344e-01   +6.178854872817195e-01   +2.087573077542632e-01   +5.171861945327640e-01   +7.650190358111969e-01   +7.602871892385303e-02   +7.433987569366469e-02   +4.295555993218049e-01   +6.325692014580586e-01   +4.905387330048240e-01   +6.851693186337211e-02   +3.911333631295469e-01   +5.426528351929785e-01   +5.738039548121143e-01   +2.321331134401988e-01; +2.330214797950755e-01   +1.607135138799940e-01   +5.453286461592479e-01   +7.212238965523827e-01   +8.193288452300571e-01   +1.633149350428560e-01   +8.221422699948585e-01   -5.573377306465457e-02   +3.543033218227857e-01   +1.576847445554976e-01   +1.429749672298052e-01   +8.089265409430650e-02   +2.647480574764308e-01   +3.502682642404312e-01   +6.444564115139098e-01   +2.049460861695914e-01; +3.116214667844309e-01   +8.330646166674300e-01   +5.486821835153246e-01   +1.473968087801258e-01   +3.707190512882914e-01   +7.536332631244126e-01   +5.487752091190132e-01   +3.487032983187408e-01   +3.898580161842865e-01   +7.223171886993798e-01   +2.150021362615108e-01   +5.959828438796158e-01   +5.356589053819076e-01   +2.869024227871088e-01   +5.972877671042208e-01   +1.831168500655297e-01; +6.947615671541711e-02   +6.622927066881787e-01   +6.836288610661367e-01   +5.010940987031388e-01   +5.803833949115619e-01   -4.130867730073549e-03   +2.189281992498089e-01   +5.485279664609518e-01   +5.309160855275686e-01   +4.236674201017939e-01   +6.412767074420225e-01   +6.013353643429560e-01   +4.353951222918527e-01   +6.463194151136230e-01   +1.455881750587630e-01   +5.422326818758892e-01; +5.841208773099410e-01   -1.276472735956821e-01   +1.957431676694079e-01   +7.659657530611990e-01   +6.295349869271486e-01   +3.609016796469173e-01   +1.198560687303770e-01   +3.970533866601508e-01   +1.230511523114661e-01   +7.413624478207428e-02   +4.887371694863888e-01   +4.131749821019418e-01   -6.485671897012961e-03   +2.137978045940751e-01   +4.605627316570954e-01   +7.394993971837263e-01; +5.350541705993033e-01   +8.061351670294001e-01   +7.966958840490151e-01   -2.316629553514608e-02   +4.830396968620249e-01   +8.595229361416582e-01   +4.800053356949130e-01   +5.929267479620355e-01   +3.469327068220320e-01   +2.797204402507047e-01   +5.930982061906100e-01   -4.929791223343826e-02   +6.881689127094354e-01   +3.795962366006261e-01   +2.612317261032092e-01   +5.042211466846241e-01; +5.101479562433056e-01   +4.780687406539708e-01   +1.134144431029408e-01   +7.241835397555738e-01   +1.000000000000000e+00   +8.560345173344691e-01   +6.213843913471009e-01   +1.813997949523024e-01   +4.099697636673680e-03   +3.995265941569812e-01   +9.966864138725630e-02   +8.168369059277407e-01   +2.323266957849321e-01   +7.326967130667585e-01   +7.083077669487514e-01   +4.285156860429758e-01; +9.249134496862799e-01   +7.811391417352630e-01   +2.167452624578005e-01   +1.897840179219271e-01   +5.775771252252716e-01   +3.684726573753103e-01   +1.928675623766739e-01   +1.905314705194844e-01   +5.676610857349770e-01   +1.791078739684860e-01   +4.926887546048844e-01   +4.361987928039261e-01   +6.412093588902266e-01   -2.509934213371322e-02   +2.503466598689668e-01   -6.967314411820473e-02; +1.928149098285943e-01   +4.372594112486691e-01   +7.080434123368821e-01   +2.133264065534726e-01   +3.057194028937280e-01   +5.370496963835162e-01   +4.064593053187138e-01   +6.635741896114807e-01   +7.186340650747034e-01   +2.656337467739679e-01   +9.576544865498823e-02   +8.017534171202823e-01   +7.410129907972711e-02   +4.409568074636465e-02   +1.783431884551533e-01   +3.812684130007331e-01];
L2I_L1I_iGABA_netcon = [+2.757797453347645e-01   +2.510221145294210e-01   +7.726379112823265e-01   +1.055563170021801e-03   +7.696385224159885e-01   +7.376509161567466e-01   +7.623375110643578e-01   +8.633833135093278e-01; +3.343024737068974e-01   +3.611035935952893e-01   +4.012921221820899e-01   +2.036441710223005e-01   +5.719959781433492e-01   +1.734270815186963e-01   +3.381468638355585e-01   +8.339459459676499e-02; +3.474645635497007e-01   +6.674388500776540e-01   -5.540125948275879e-02   +1.570290812895621e-01   +4.923250015512975e-01   +5.186671521555566e-02   +5.046916016314020e-01   +2.266663841788611e-01; +6.779628133900597e-01   +5.403132724716847e-01   +3.790839388917959e-01   +4.354992054232860e-01   +5.325410347279369e-01   +1.427582712997016e-01   +8.737190217036731e-03   +1.854782674634720e-01; +6.805821635031378e-01   +6.312373503932411e-01   +4.713394688110954e-02   +1.244744993921141e-01   +6.168285941110361e-01   +4.401686560721251e-01   +5.057421537428316e-01   +3.576521309414797e-01; +8.091718622675812e-01   +5.491157949110383e-01   +4.098001679019950e-01   +7.144058430057363e-01   +5.807466077297327e-01   +4.515643377045220e-01   +7.177536918563546e-01   +1.409033536985581e-01; +2.987310645058841e-01   +3.000837649990336e-01   +6.711660912773360e-01   +7.342714653737569e-01   +2.465875814594640e-01   +7.939701326972111e-02   +3.404440840417408e-01   +4.605414665544715e-01; +4.383076115559609e-01   +4.664565671534627e-01   +1.108611064591954e-01   +1.421599836010059e-01   -5.444531677347211e-02   +3.868921243257873e-01   +3.873964261555040e-01   +5.753808058968740e-01; +4.294372996066528e-01   +2.567912479506621e-01   +7.795799592294917e-01   +4.187021086450500e-01   +3.503897824677600e-01   +8.041707014918216e-01   +4.623230776092331e-01   +7.257332504361105e-01; +6.643622936868300e-01   +2.873149666935930e-01   +1.518745968707459e-01   -4.155957110602239e-02   +7.128378643605442e-01   -5.986364623388063e-04   +1.076083637475820e-01   +5.891706300858653e-01; +3.352515087647849e-01   +2.862854576880855e-01   +4.001217318267846e-01   +8.754570295041472e-01   -1.457799171144959e-02   +5.175013277338222e-01   +8.994885319114408e-01   +7.857392029812760e-01; +6.250977209130630e-01   +8.057451550358220e-01   -1.143183352955927e-01   +2.817654602819527e-01   +2.948084789521205e-01   +8.283591781973210e-01   +6.558434070669386e-01   +3.387147600574825e-01; +9.345514186698675e-01   +2.501040864460047e-01   +6.055412751577457e-01   +1.702389362234485e-01   +4.493942750713061e-01   +1.997072931581226e-02   +7.001348567359995e-01   +4.334309090317259e-02; +6.611162909044781e-01   +1.233885995132582e-01   +3.583788505231613e-01   -1.404927719820559e-01   +4.329003471155657e-01   +5.022372961972900e-01   +1.506324975264688e-01   +2.815172150499877e-01; +1.127472834013611e-01   +1.000000000000000e+00   +5.627672266522703e-01   +9.957551349142738e-02   +4.026880481034494e-01   +6.694151610462089e-01   +3.418386068296114e-01   +2.587257993879569e-01; +2.418325968156064e-01   +7.370287797180120e-01   +2.990965204957301e-01   +5.683822182183365e-01   +1.374844507038559e-01   +4.201955495958801e-01   +3.913208205815780e-01   +1.231479542221428e-01];
L1I_L2I_iGABA_netcon = [+2.106494883093872e-01   +4.556457721613074e-01   +3.829866330740812e-01   +2.667386452591899e-01   +5.894033465830529e-01   +1.942750933453093e-01   +7.071528208908674e-01   +1.076587893121301e-01   +2.456203273707277e-01   +6.981831074442413e-01   +3.758522624816572e-01   +6.378883200684980e-01   +2.410507298076647e-01   +1.145580234439552e-01   +1.921356431274378e-01   +5.448338531848070e-01; +8.291625047718401e-01   +3.584994660520586e-01   +4.721764747563360e-01   +3.482108101767253e-01   +9.064817415889537e-01   +8.332241110055099e-01   +5.322298924985466e-01   +2.689649975237319e-01   +5.197801750782330e-01   +6.118135505875200e-02   +2.151135472677793e-01   +7.206876036604045e-01   +5.093108360032330e-01   +5.695909688654853e-01   +4.182312729418527e-01   +8.573573909209516e-01; +1.953373023939728e-01   -3.086724490172370e-02   +2.036162081628080e-01   +3.220485089672103e-01   +3.425175141342107e-01   +6.131717365695513e-01   +4.591727571042103e-01   +5.873413027014645e-01   +4.614351041955065e-01   +4.542200455533380e-01   +2.391963430166654e-01   +6.360658518623886e-01   +2.670765787938739e-01   +1.000000000000000e+00   +4.375322505615454e-01   +8.560633039167044e-02; -2.200406155235093e-01   +6.556814615707861e-01   +3.530884318165468e-01   +7.865522533204594e-02   +6.678162146524570e-01   +6.900731396573027e-01   +9.898645353018667e-01   +2.739219935279913e-01   +8.945176885058278e-01   -4.728998859250926e-02   +3.472317197490926e-01   +9.839313511518878e-01   +8.903021023554525e-02   +4.249916957021150e-01   +6.372270245498792e-01   +7.367796566433396e-01; +7.413303838615332e-01   +8.114878719576849e-01   +8.484727328508173e-01   +3.311367866820019e-01   +2.080410342565495e-01   +4.609576581055545e-01   +7.416851800343010e-01   +1.795134744664818e-01   -3.618125016292975e-02   +5.082424984243565e-01   +4.394484143185480e-01   +7.765885191165049e-01   +3.355604411975736e-01   +4.864061965701919e-02   +5.348624396880920e-01   +5.073411815129210e-01; +7.959239611937590e-01   +7.133815662686150e-01   +2.158826797693308e-01   -1.144096747350780e-01   +2.803349396927548e-01   +1.069381231007787e-01   +6.054653626922269e-01   +3.352151049675771e-01   +2.298249594390120e-01   +8.441094561953630e-01   +9.207733236760918e-01   -1.158074129905413e-01   +2.774501923421681e-01   +5.270556102938300e-01   +3.945464682192122e-01   +3.625162054550760e-01; +3.451551419158953e-02   +7.731083691737282e-01   +5.313150799957996e-01   +6.576276696592985e-01   +3.182645953034566e-01   +7.705379263851789e-01   +5.956452171304480e-01   -4.083190277211041e-02   +3.018427563041446e-01   +2.293369316313846e-01   +5.039144283827733e-01   +2.825046754672899e-01   +7.040386070031555e-01   +8.315263508199982e-01   +1.794485827513197e-01   +6.135533406993201e-01; +3.693248250734962e-01   +5.682967849123015e-01   +4.945247021787890e-01   +5.975653117922355e-01   +9.691771900914002e-01   +5.224089385184446e-01   +3.172091124676163e-01   +2.041705068920225e-01   +1.246893235622445e-03   -1.157921561624986e-02   +2.277784269335363e-01   +4.931179510112696e-01   +2.575879339186349e-01   +8.375018102474654e-01   +5.518393899411487e-01   +3.686845002954912e-01];
L2E_L1E_iAMPA_netcon = [+5.206346530522565e-02   +5.873585508172720e-01   +8.945230718336534e-01   +7.145647393536377e-01   +4.985796555960673e-01   +3.428882084189177e-01   +5.655339217337767e-01   +8.879275553366457e-01; +8.996179792681739e-01   +1.911310330613127e-01   +4.063108092217261e-01   +6.916751709187087e-01   +3.567511526747696e-01   +5.148862865431318e-01   +3.161111707382482e-01   +6.995791376170890e-01; +4.580785655541452e-01   +1.155532928340617e-01   +4.113803749977235e-01   +8.905620501446807e-01   +1.995206654451443e-01   +6.304310562064613e-01   -3.528813069286048e-03   +9.409308741853132e-01; +5.344201893924151e-01   +2.570689786305593e-01   +3.780090374103626e-01   +8.426125332457294e-01   +5.254370785080050e-01   +5.729707345335786e-01   +7.708311397952674e-01   +5.900534623717525e-01; +9.910150156127424e-01   +8.686869389734924e-01   +3.768684488891846e-01   -6.842141695418236e-02   +3.754964370991484e-01   +3.482916683237751e-01   +1.695402924815621e-01   +5.448601115471657e-01; +9.263443472467723e-01   +2.564952836442415e-01   +8.016127664203621e-01   +8.259519249101691e-01   +9.080855300970575e-01   +7.827123778091285e-01   +5.998691337488613e-01   +8.267833049672837e-01; +5.014345821388604e-01   +2.573937504490458e-01   +2.325160277473409e-01   +2.560091928644959e-01   +8.716498297448342e-01   +6.854175688560177e-01   +2.725134149809696e-02   +7.063851648196120e-01; +7.944655010533307e-01   +4.384614438805002e-01   +8.552951177115665e-01   +6.195093797836060e-01   +1.458654684844188e-01   -2.869876617263018e-02   +4.643367993177985e-01   +7.033079598735142e-01; +9.247582404427196e-02   +2.516153121100296e-01   +6.696156252762644e-01   +8.321410267062365e-02   +6.551780774186210e-01   +9.131081435035854e-01   +3.441284308177953e-01   +1.231626995129692e-01; +4.948020953634848e-01   +4.479019354326131e-01   +3.282703806833587e-01   +7.277165300153482e-01   +6.941259109907234e-01   +8.276094633065234e-02   +8.350269337871491e-01   +7.255210823968243e-02; +4.297420391182736e-02   -5.870164110025118e-02   +4.608389579725304e-01   +6.361763663212006e-01   +2.402483641146764e-01   +7.633229166710426e-01   +8.885351777085718e-01   +1.949768471784186e-01; +6.844387375906261e-01   +2.506105538552726e-01   +1.830683573925037e-01   +8.018619605992539e-01   +7.765141900042571e-01   +1.905857659909150e-01   +2.935929381382612e-01   +5.598717187741178e-01; +3.658494846869124e-01   +7.089891706457471e-01   +4.631193230264490e-01   +4.203718732831159e-01   +7.097124620026446e-01   +3.291816326929052e-01   +1.568697380484092e-01   +4.472290845208916e-01; +2.299888687662712e-01   +9.331389144689490e-01   +9.179057472184913e-01   +6.236614950275525e-01   +5.237873064953870e-01   +3.738405100694276e-01   +5.353015728982820e-01   +8.809762129802515e-01; +7.651269350987876e-01   +3.618232033656745e-01   +2.901788809636994e-01   +6.059573561374234e-01   +8.786278104434930e-01   +4.653722671961047e-01   +5.680681455184200e-01   +7.814514892086155e-01; +4.170719986408588e-01   +4.821833494821965e-01   +2.877996355463362e-01   +8.997009684768234e-02   +8.585490755183668e-01   +1.601879151282471e-01   +1.897271007152443e-01   +1.466054669199556e-01];
L1E_L2E_iAMPA_netcon = [+3.223544244873377e-01   +3.845463732458632e-01   +1.554377813319177e-01   +3.169181600380696e-01   -9.203511877800044e-02   +5.840161069435342e-01   +3.461028365874597e-01   +7.659443567840407e-01   +6.658614142456922e-01   +3.746503564715754e-01   +1.774825107842086e-01   +8.454221477245331e-01   +6.211802852964494e-01   +1.334018073469802e-01   +9.659406502558601e-02   +4.910885135246981e-01; +3.145322197007125e-01   +3.917935533242577e-01   +9.300412790156595e-01   +6.407259491700127e-01   +5.046443079547059e-01   +7.587926470829152e-01   +5.426743933774026e-01   -1.385634272407351e-01   +4.452039156279336e-01   +3.620282550780296e-01   +1.754586038580405e-01   -5.957741197813150e-02   +5.845303295493074e-01   +2.711447567508560e-01   +5.565389922643385e-02   +1.880817075387864e-01; +1.321308695185078e-01   +2.708539272530520e-01   +4.521773534587608e-01   +7.001542567893280e-01   +9.749966286650616e-02   +3.889270561407763e-01   +1.657943681550351e-01   +9.697860940383557e-02   +5.915774033701461e-01   +4.136415641232654e-01   +9.420772765865115e-01   +2.749404345030044e-01   +2.392331205903920e-01   +7.909540776068753e-01   +4.124304208344756e-01   +3.945563757195050e-01; +7.290894183008685e-02   +6.638278727472103e-01   +3.862916456646286e-01   +4.881857814809940e-01   -8.005597977080638e-02   +5.756860905991468e-01   +4.198344963743130e-01   +2.311766417617362e-01   +5.131867051744594e-01   +5.711479298498058e-01   +5.717121101670816e-01   +1.478015228171199e-01   +3.611623711648349e-01   +2.353923611564133e-01   +2.907230586488317e-01   +3.595039056695363e-01; +2.869774079516211e-01   +6.734502545051051e-01   +8.414698411068527e-01   +2.032936168224024e-01   +2.290008537417897e-01   +7.232273221246925e-01   +3.799172838237729e-01   +4.041100121243617e-01   +7.716694914005005e-01   +6.192071497961684e-01   +8.445821151012841e-01   +1.361225418339898e-01   +8.348364044330313e-01   +7.484865566440229e-01   +3.343621483660161e-01   +2.330501900130494e-01; +4.718863539155206e-01   +8.044102193597522e-02   +3.197301200690587e-01   +3.432919137752497e-01   +5.563160802126311e-01   +5.636719193881046e-01   +6.186666436864071e-01   +1.313794874382975e-01   +4.448310554350033e-01   +4.788688075061951e-01   +3.470140999359291e-01   +5.853555498150351e-01   +3.980078524867369e-01   +4.916105560946445e-01   +6.758582845516553e-01   +4.464608787810609e-01; +6.161996617830952e-01   +2.767586436511755e-01   +3.494720269956196e-01   +5.138211172250037e-01   +2.220839677371336e-01   +1.464401034566946e-01   +9.613589733004217e-01   +7.177933705191062e-01   +3.868252947669497e-01   +7.381135184372976e-01   +3.709630338653370e-01   +6.316488352497067e-01   +1.935268811207856e-01   +4.575150446714539e-01   +1.321686761628223e-01   +2.500006064991364e-01; +6.054454399886360e-01   +5.984035260804149e-01   +4.448392527971270e-01   -1.080595091890619e-01   +6.745639746726836e-01   +5.140241682254680e-01   +5.434152105548163e-01   +2.861981506168630e-01   +4.366178277926239e-01   +2.107859385276764e-01   +6.301227051751477e-01   +3.105032169660049e-01   +8.965121336103457e-02   -1.105975695685028e-02   +6.203594750059308e-01   +7.625754855921976e-01];
L2I_L2E_iAMPA_netcon = [+1.351480093896036e-01   +7.621371368190606e-01   +7.311510592912590e-01   +6.690890720161637e-01   +3.921281044685012e-01   +9.548846498935488e-02   +1.000000000000000e+00   +7.174462681963423e-01; +5.815645499006370e-01   +8.552730873040763e-01   +4.714173374561573e-01   -4.139763341128185e-02   +7.417757137129287e-01   +9.068828111152545e-02   +3.376965293088245e-01   +2.033681190740771e-01; +5.374183753785525e-01   +4.712036887976703e-01   +7.867700752396076e-01   +1.094155091425289e-01   +2.988287590412573e-01   +5.914761691325419e-01   +3.477245618569068e-02   +1.373702842957917e-01; +4.433280985157142e-01   +8.302670656450554e-01   +3.686422871165625e-01   +2.564800559470592e-01   +7.524213316078037e-01   +6.010352542993141e-01   +7.542529147699066e-01   +6.586544425144669e-01; +7.155179765615849e-01   +3.947282591744431e-01   +5.975425764749605e-01   +2.153368957166193e-01   +1.225739502012560e-01   +6.217678845797920e-01   +5.279747445157843e-01   +2.003475004606256e-01; -1.053695518547737e-01   +1.492213824703068e-01   +1.239293569916667e-01   +4.459494333105252e-01   +1.797683024931578e-01   +6.561853801279610e-01   +6.496779879924219e-01   +3.737014130843800e-01; +6.802713065901103e-01   +4.260700740898906e-01   +7.116628754339362e-01   +2.043817344289703e-01   +1.606331892590527e-01   +1.848373217795403e-01   +7.540293752847045e-01   +3.618021085156037e-01; -5.994500334225231e-02   +4.253371040442398e-01   +3.645853106540675e-01   +2.304878454311777e-01   +7.188081292678719e-01   +5.704956731445073e-01   +9.096585345121394e-02   +1.996615338423111e-01];
L2E_L2I_iGABA_netcon = [+8.753387746389737e-01   +6.766171656698290e-01   +7.073164308190887e-01   +4.648661708740577e-01   +2.934173513568554e-01   +1.715494741613029e-01   +3.468632442164722e-01   +2.714387727374464e-01; +4.540045822452585e-01   +8.989210306828801e-01   +6.777268099594754e-01   +7.668621090086809e-01   +2.173033777740364e-01   +3.825927554218092e-01   +1.141160351086308e-01   +7.539658679438268e-01; +2.667267573476446e-01   +7.334443951062015e-01   +9.566070333838202e-01   +7.327055137317605e-01   +3.566771543051582e-01   +5.032215884219856e-02   +5.776663209116587e-01   +2.182247496697267e-01; +3.796485198265498e-01   +4.238492722850590e-01   +7.373827186961414e-01   +2.276592847709387e-01   +7.031902006468032e-01   +5.460990548265623e-01   +4.638208686534052e-01   +4.820134112800888e-02; +6.724155411549609e-01   +9.175417959573722e-01   +4.175635197334870e-01   +4.630795000298785e-01   +6.401069797507579e-01   +4.686871900489939e-01   +6.865158601120794e-01   +8.524467394331592e-02; -2.331301355027052e-02   +4.939299162678955e-02   -1.091350255067118e-01   +1.274286391586065e-01   +6.902917087843935e-01   +5.802619495186746e-01   +5.057071421257120e-01   +2.284916377925503e-01; +4.194564040626126e-01   +7.828164889974711e-01   -1.895476231481681e-01   +4.470797717176867e-01   +5.175453442063112e-01   +7.820707174010029e-01   +7.088379013430302e-01   +6.431803710005070e-01; +1.860542158479426e-01   +2.915257292014306e-01   +2.530141459446425e-01   +7.617397428819432e-01   +4.878097771814139e-01   +4.493663790152923e-01   +2.235950534212375e-01   +2.713387411323340e-01];
L3E_L2E_iAMPA_netcon = [+3.299392852563952e-01   +3.171683676714247e-01   +5.982251362352355e-01   +3.304147058202193e-01   +4.573086273041492e-01   +6.912893439240406e-01   +4.527343565038030e-01   +6.577936528389311e-01   +9.052837904484747e-02   +8.077829446430228e-01   +7.890546270565990e-01   +5.379846179078778e-01; +3.265333928524830e-01   +5.326228818873715e-01   +8.110662385862705e-01   +5.066632233404982e-01   +4.066856344441344e-01   +3.140628743223037e-01   +3.883507178778812e-01   +7.808224953495229e-01   +1.702487270186616e-01   +5.739685242850313e-01   +3.635629763008955e-01   +2.865571010128215e-01; +1.604567939187044e-01   -1.207288112360698e-01   +2.214647675208971e-01   +3.554717841396541e-01   +1.274102352980764e-01   +5.382054344314164e-01   +1.772268251168491e-01   +9.629692542536684e-02   +6.068446099060461e-02   +3.832122855456949e-01   +3.288801036240374e-01   +3.453578369371277e-01; +5.465168868114629e-01   +6.871174544360500e-01   +4.159858742236381e-02   +5.638040182931978e-01   +4.271760261517989e-01   +1.979808572548208e-01   +2.922673285627519e-01   +3.866452971522056e-01   +7.210289486482011e-01   +1.415382160063919e-01   +3.863510282132659e-01   +5.933732142577882e-01; +6.499134617301040e-01   +3.241648366944565e-02   +7.264721761501607e-01   +4.374330240153081e-01   +6.572664454599239e-01   +9.137395612807412e-01   +3.805237070130130e-01   +6.539904720101500e-01   +9.074236470171955e-02   +8.544484403446708e-01   +5.299106084308438e-01   +2.082048280441129e-01; +5.136160638605511e-01   +6.167525304081017e-01   +4.261970225352119e-03   +3.754299975851063e-01   +2.658501933672625e-01   +8.239346620013841e-01   +5.236308375851660e-01   -1.323994609037105e-01   +3.155670806523701e-01   +8.678301632160585e-01   +2.639808354732606e-01   +4.837635038815141e-01; +1.392458797175079e-01   +2.472645392868927e-01   +2.556571877905516e-01   -1.417770987170494e-01   +1.000000000000000e+00   -1.464753214070738e-02   +6.865415613568503e-01   +6.368967545880114e-01   +2.466002148027204e-01   +2.080088914259637e-01   +8.871716136107531e-03   +5.770081214719157e-01; +4.478055700699168e-01   +7.102440734997881e-02   +5.232770424096672e-02   +4.082799039925190e-01   +7.435251126937165e-01   +2.096553672493102e-01   +6.312533341156652e-01   +1.115864419181138e-01   +1.375796393585585e-01   +5.009039587961671e-01   +5.085511728170264e-01   +3.723533165352966e-02];
L3I_L2I_iGABA_netcon = [+9.365477159598153e-01   +5.750845237003822e-01   +7.218314956464673e-01   +1.766828897452080e-01   +3.278250258247102e-01   +6.401784872639091e-01   +6.388655877285913e-01   +4.720278434399723e-01   +5.096477699247665e-01   +5.463340580973641e-01   +4.734224554566596e-01   +7.852396728875494e-01; +5.843973557666601e-01   -8.330472727595066e-02   +9.616927714525127e-02   +7.314695627607634e-01   +2.805032928809225e-01   +4.059971535845660e-01   +3.433698858452004e-01   +2.909364171624698e-01   +6.685737664044875e-01   -4.877961604279102e-02   +7.311108602079577e-01   +1.733622924900879e-01; +2.938270644643659e-01   +5.212560677775966e-01   +8.171988484737025e-01   +8.092773537918444e-01   -5.619435132597758e-02   +4.428040122234240e-01   +1.715992226070411e-01   +6.389056741233441e-01   +5.015951939561213e-01   +3.530710020341613e-01   +9.617217762404184e-01   +8.832634921003557e-01; +1.408650625428686e-01   +2.409380557387724e-01   +8.749164068162300e-01   +2.372633423170643e-01   +5.217573307674304e-01   +6.292441196033275e-01   +2.702476759224339e-01   +5.943265636953099e-01   +3.224952553375679e-01   +3.487526611962865e-01   +9.264487751066421e-02   +4.791445561324909e-02; +1.946763614327122e-01   +4.034968197556973e-01   +9.925986693836993e-02   +2.385822366633011e-05   +5.647247540358260e-01   +2.807414146231223e-01   +4.815616731979268e-01   +3.787354318396348e-01   +3.490840819071266e-01   +7.675922166296196e-01   +7.927602336957043e-01   +7.475956575235480e-01; -3.582427819600711e-02   +8.464138010200776e-01   +3.678161755861535e-01   +4.049714427251564e-01   +1.359983005219055e-01   +1.317713756456426e-01   +1.584654412253813e-02   +4.020536363121665e-01   +1.909753075527705e-01   +5.257979086805470e-01   +7.056394688294824e-01   +7.356802000417533e-01; +6.388429160746468e-01   +6.045217235905725e-01   +7.162425998062140e-01   +3.814954050007082e-01   +4.666782933851451e-01   +2.672476154954289e-01   +3.985181969643549e-01   +3.696626985740638e-01   +4.408934987681256e-01   +6.702108491282283e-01   +4.284805794277196e-01   +6.907465899773253e-01; +5.564709928915191e-01   +9.528922886147984e-01   +5.356990634794861e-01   +1.682130722889038e-01   +1.216229228399215e-01   -1.170703453410901e-01   +9.549551427032069e-01   +7.629298200242335e-01   +7.643031335320155e-01   +5.998269738514370e-01   +2.496359513521640e-01   +6.438337085178285e-01];
L2E_L3E_iAMPA_netcon = [+1.814712081686199e-01   +2.580891568588650e-01   +3.319774023703892e-01   +6.895467507751796e-01   +6.424866826815202e-01   +1.237458762612063e-01   +2.046598645925912e-01   +4.719650234223268e-01; +5.517214804256771e-01   +7.782167754971834e-01   +2.336713185958171e-02   +6.547551762358397e-01   +1.120972053827541e-01   +5.239163838495379e-01   +1.150830965698935e-01   +6.930530563985977e-01; +9.367305828084680e-01   +3.704998767478483e-01   +5.285162624963908e-01   -8.627779639641224e-02   +9.027090302971679e-01   +1.820996795291938e-01   +3.404287235300428e-01   +3.325794131365781e-01; +4.339360730921050e-01   +6.083614933690977e-01   +8.216414691835230e-01   +5.554843715062909e-01   +7.559971514563963e-01   +4.175153356810002e-01   +5.087097620969054e-01   +6.720472936949138e-01; +2.930482461047704e-01   +2.777644422834939e-01   +8.537130580290212e-01   +6.888611221440397e-01   +5.063342885372382e-01   +2.543865796357337e-01   +8.640128544136337e-01   +2.646533786468739e-01; +2.496321680068302e-01   +6.718073740469974e-01   +1.916364247772282e-01   +7.794346486434963e-01   +2.702783661156861e-02   +7.077009082335900e-01   +2.050008460752739e-01   +8.224668651061279e-01; -1.252307088928899e-01   +6.147498434838798e-01   +5.463369245064679e-01   +9.333879607001098e-02   +3.434281948813624e-01   +1.385570339009912e-01   +9.006357702810144e-01   +7.806299378233849e-01; +4.166765239873628e-01   +9.011718951763791e-01   +2.434724385154665e-01   +5.326705633532839e-02   +5.020351444644220e-01   +5.102317060546209e-01   +6.404061128027074e-01   +7.537125636615405e-03; +4.050983150957336e-01   +9.454289417493932e-01   +7.165393502102113e-01   +8.630966449850533e-01   +3.121383481660679e-01   +6.759931683791501e-01   +5.071093443335033e-01   +8.798073170662731e-01; +6.063899983342070e-01   +1.512327889089040e-01   +2.954270291216393e-01   +7.345403781950066e-01   +4.428045665176220e-01   +5.732260190697557e-02   +9.528995951294477e-01   -1.558338408199456e-02; +3.698078294488764e-01   +4.746257404630941e-01   +2.075097555484884e-01   -1.768443524321850e-01   +3.546940150777851e-01   +2.813105735795197e-02   +5.790510357863027e-01   +8.346656159350381e-01; +5.424853068988490e-01   +4.166118548176162e-01   +3.219109804654284e-01   +9.198381661328197e-01   +9.153761150318160e-01   +1.666217460223308e-01   -5.233484655035059e-02   +3.143227117317746e-01];
L2I_L3I_iGABA_netcon = [+5.845698223124207e-01   +1.836086497538577e-01   +2.030786201658869e-01   +1.000000000000000e+00   +5.897318834875687e-01   +1.657625901089817e-01   +9.149263178182607e-01   +1.081810255434396e-01; +5.622368841952629e-01   +4.540713135766850e-01   -2.086165384540146e-02   +8.028590876008244e-02   +5.358068226712449e-01   +8.125842867555887e-01   +9.227406649907969e-01   +3.594730151058691e-01; +4.266465478167333e-01   +6.573824405673103e-01   +1.196845795300770e-01   +8.850078372813814e-01   +3.250749020498098e-01   -3.808681336599738e-02   +5.295119924634392e-01   +6.209614637573847e-01; +1.986553210791602e-01   -1.728665294252834e-01   +6.309127189393383e-01   +5.594399362899131e-01   +7.469159522493882e-01   +1.966429708385409e-01   +6.248165141470612e-01   +3.473954357099757e-01; +3.827794672887574e-01   +6.685720105996985e-01   +3.655953242051913e-01   +4.300943218146874e-02   +2.941703743185830e-01   +4.051598417555642e-01   +8.334219714876689e-01   +7.204426402426614e-01; +1.524107744613719e-01   +4.680327727399109e-01   +2.694618442659398e-01   +4.997117089928927e-01   +3.284435216836423e-01   +6.913700954664254e-01   +9.485101248667592e-02   +4.095435633955458e-01; +8.391952678362236e-01   +2.751090620957146e-01   +4.555155493220919e-01   +7.367202473061514e-01   +3.053929718281417e-01   +1.476797433751907e-01   -1.006906515441732e-01   +5.355343916944281e-01; +6.725976466213897e-01   +6.599223571590606e-01   +7.219048180688512e-01   +3.832466559681263e-01   +4.054505086994573e-01   +8.703894288495388e-01   +4.211652925111242e-01   +1.476007458221480e-01; +3.107922144701280e-02   +2.032947385400073e-01   +3.851432800651710e-01   +3.262351350030392e-01   +7.288162796630432e-01   +7.507745036516856e-01   +6.198849079604212e-01   +3.881755239711854e-01; +7.074171199258322e-01   +3.651290968884298e-01   +7.643865368169853e-01   +1.886584716074230e-01   +3.307630756995007e-01   +2.125858217444894e-01   +4.642963592654475e-02   +1.208347951946458e-01; +5.105930187984133e-01   +7.911739841091221e-01   +2.293223678633103e-01   +7.693602356387288e-01   +1.929340956279516e-01   +2.150332284099930e-01   +3.574019659457530e-01   -9.698184635458686e-02; +7.323092394859204e-02   +4.558015749461720e-01   +2.518476504154565e-01   +5.130353022242610e-01   +8.059971694039639e-01   +8.207701182815872e-01   +9.183213441298933e-01   +1.965766019218583e-01];
L3I_L3E_iAMPA_netcon = [+4.852697862276255e-01   +7.316925784517808e-01   +1.084673282312175e-02   +4.540026953407998e-01   +7.730149879387792e-01   +4.780684141328515e-02   +6.142087018214961e-01   +4.765632342403874e-01   +2.635422967156142e-01   +2.473477428575953e-01   +2.944772288947624e-01   +6.383316939834046e-01; +5.559698940979468e-01   +7.487837091660087e-01   +7.112458388527505e-01   +2.075799025251401e-01   +1.064016300216023e-01   +5.512270002641321e-01   +8.006739786759732e-01   +1.000000000000000e+00   +7.705763878482359e-02   +7.038057540590789e-01   +4.006069869122268e-01   +6.966292343665992e-01; +4.981565806780492e-01   +5.335035554341082e-01   +5.190911594141123e-01   -1.155388389068241e-01   +7.096918724295854e-01   +6.760840330787726e-01   +4.670991679699455e-01   +8.191177869198212e-01   +8.743961044389394e-02   +5.907981082357415e-01   +9.937173245584332e-01   +5.129582745822152e-01; +6.872240991071632e-01   +4.765765128149736e-01   +4.416811028430661e-01   +9.162947836522690e-01   +8.010601508435159e-01   +7.331134455531357e-01   +7.911906651161008e-01   +6.694569633669208e-01   -1.850488002954872e-02   +6.431034393211242e-01   +3.963682680954593e-01   +5.892457265672578e-01; +8.703918146322022e-02   +2.386067654824385e-02   +2.512831556159282e-01   +5.421828048074687e-02   +5.113686061035149e-01   +8.668278966015386e-01   +8.809244851118174e-02   +7.083578441484706e-01   +4.604747313286340e-01   +3.609168810381286e-01   +8.141161641641904e-01   +1.370223818363765e-02; +4.536150557407630e-01   +7.514149617136625e-01   +1.306903234162765e-01   +7.111511671448207e-01   +4.669316457285920e-01   +2.211681183397968e-01   +5.402528950078036e-01   -8.577472146560018e-02   +3.729773897531644e-01   +2.347994999307364e-01   +4.188849354373894e-01   +5.373044735228174e-01; +6.675523231571530e-03   +3.840785760172860e-01   +2.301243531074677e-01   +3.028806813119573e-01   +8.721615054791495e-01   +2.358705608041186e-01   +4.588515988725163e-01   +7.752489006502488e-01   +3.258480309944579e-01   +2.703016064090264e-01   +5.352250286648568e-01   +4.310525906876370e-01; +4.836194228513691e-02   +2.398680450730897e-02   +1.876983120734459e-01   +1.011365402972026e-01   +1.240617998026187e-01   +8.105468612199566e-02   +3.845111871850717e-01   +4.695858553259467e-01   +1.787088209871499e-01   +7.770366942012946e-01   +3.318106948949872e-01   +2.453174943484669e-01; +2.148164278598067e-01   +2.327711278636445e-01   +4.762348009425053e-01   +4.693070522214214e-01   +3.010949137869323e-01   +1.075937018091906e-01   +2.862137811220878e-01   +3.569053786187736e-01   +5.825704847688024e-01   -1.513467720147280e-02   +2.702845674590881e-01   +4.029454810411725e-01; +5.239187834723803e-01   +7.444274189684178e-01   +5.373065322463432e-01   +5.180804388530402e-01   -9.536274754863926e-03   +3.011949142007223e-01   +8.128517494692010e-01   +5.623062691468886e-01   +5.544476327679786e-01   +6.807352134066511e-02   +5.237184471779383e-01   +2.843000804408888e-01; +1.042400018551205e-01   +1.408652090447109e-02   +5.828775477123457e-01   +1.679072856406206e-01   +2.338701468943763e-01   +6.009598817053293e-01   +2.309540356411884e-01   +3.183701381575763e-01   +9.366681779257287e-01   +7.343572690278746e-01   +8.404701939573053e-02   +7.899158924343402e-01; -1.514858623973203e-01   +2.921792379493234e-01   +4.648632666874793e-01   +6.324659128951218e-01   +8.748902278335301e-01   +3.922733969698182e-02   +1.445082478319334e-01   +5.610307469904197e-01   +6.246006027540434e-01   +3.965120235123143e-01   +3.525343997427887e-01   +5.338466643222680e-01];
L3E_L3I_iGABA_netcon = [+6.138117418554502e-01   +1.063770566413154e-01   +2.625681398826448e-01   +7.647411599335450e-01   +4.599385001918180e-01   +9.253005617964704e-01   +8.542694414391446e-01   +7.081981778173918e-01   +7.597225461359145e-01   +1.560939963082386e-01   +1.943854665903464e-01   +6.469391107375784e-01; +5.387273572541073e-01   +4.212340942866903e-01   +8.173967305293314e-01   +4.721308423827851e-01   +6.287575812948627e-01   +5.875844232048505e-01   +1.000000000000000e+00   +2.429208003246873e-01   +6.272872641343290e-01   +2.492023288812546e-01   +3.449975076138923e-01   +4.226796711360528e-01; -9.431409848531876e-02   +1.420469606323965e-01   -3.488566648128628e-02   +4.489782521871760e-01   +4.107899364575944e-01   +5.888969280612818e-01   +7.513342710874563e-01   +6.850738193715969e-01   +4.295327102358337e-01   +4.937647430336879e-01   +5.292147835553089e-01   +4.558276122932105e-01; +6.107513776315571e-01   +8.499491289057097e-01   +7.443900383609064e-01   +1.087536821250747e-01   +8.254007849796767e-01   +2.716463133619312e-01   +6.162523966081563e-01   +5.517783115231738e-01   +5.167210022367656e-01   -5.861491030029180e-02   +7.253135193320044e-01   +6.161141741820497e-01; +9.960605531895492e-02   -1.158912589824001e-01   +3.863414207458338e-01   +4.426384178926268e-01   +4.199867927048999e-01   +2.912189666377892e-01   +6.515895850927829e-01   +4.320070128148726e-01   +4.227895274497899e-01   +2.669146787910616e-01   +4.200708790990861e-01   +2.687825397852806e-03; +2.277918515953679e-01   +1.713715703274994e-01   +7.241110417369209e-01   +7.704782568621283e-01   +4.709041966049989e-01   +2.220643834650706e-01   +6.886781976468653e-02   +2.694737998212670e-01   +4.246220164878520e-01   +9.460619175587093e-01   +7.771534020489550e-01   -1.091308973111162e-01; +3.691933557916975e-01   +3.983622906540430e-01   +8.058061641079489e-01   +3.249234261187862e-01   +4.528083182566111e-01   +7.809519034723363e-01   -1.833619427887533e-01   +6.287387217801110e-01   +6.572660262799581e-01   +4.144666774586010e-01   +5.396821550071140e-01   +4.205820427139763e-01; +1.339450230362992e-01   +3.327036233196934e-01   +4.068272562872651e-02   +9.312903728725058e-01   +7.790025948396300e-01   +3.259909950913836e-01   +5.260190323784792e-01   +1.229970953006625e-01   +3.341711674717050e-01   +3.331580374143899e-01   +4.405557492059055e-01   +9.241160779793572e-01; +5.029199655282609e-01   +1.897187730280115e-02   +6.903650286338571e-01   +6.724071134507993e-01   +6.112344674187101e-01   +5.218214859186718e-02   +3.009632568293915e-01   +7.536313592088144e-01   +3.266358795146081e-01   +8.501674853327425e-02   +4.825057268683390e-01   +6.832698815090100e-01; +1.895090076379537e-01   +7.299899364000586e-01   +9.684973797610925e-01   +7.897857581052025e-01   +4.128871680860567e-01   +3.484937647382334e-01   +7.387271493686045e-01   -2.446799800629779e-02   +9.353002638477133e-01   +6.658764232177419e-01   +3.472842992435976e-01   +7.381114167618953e-02; +3.003138204744653e-02   +7.715862355565675e-01   +2.628702960983187e-01   +4.756652694034788e-01   +7.780449340234622e-01   +3.148183320103088e-01   +7.912209717068152e-01   +8.459071997353719e-01   +4.772985907705152e-01   +4.863943827380260e-01   +1.299956377682210e-01   +8.728921189462214e-01; +6.652885360805463e-01   +1.520195499803974e-01   +5.428996970448670e-01   +7.048092411263143e-01   +7.306979746456638e-01   +7.511929807037278e-01   +3.949337298131630e-01   +3.862126087773462e-01   +6.280557563216601e-01   +3.434136865198180e-01   +4.270757210426997e-02   +2.049894349910711e-01];
L2E_Input1_iAMPA_netcon = [+1.000000000000000e+00   +9.162607998479230e-01   +9.542556121317564e-01   +9.431188116977863e-01   +9.865681104051900e-01   +7.271517570773606e-01   +8.617793408491701e-01   +7.548430567041788e-01];
L2I_Input2_iAMPA_netcon = [+9.479233277511632e-01   +9.061934128541429e-01   +7.523011875230083e-01   +9.554214594633246e-01   +8.700007283498116e-01   +1.000000000000000e+00   +7.673783214522888e-01   +8.434683974322000e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
