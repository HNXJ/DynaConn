function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.144841973192900e-02   +1.666847838955816e-01   +2.910281980308499e-01   +2.182967070190007e-01   +1.949427344645842e-01   +3.062970844384233e-01   +1.594229628540546e-01   +5.909109510066474e-02   +6.067055282641664e-02   +1.459509363470160e-01   +1.847155132041921e-01   +6.384492126252461e-02   +1.285237063509376e-01   +2.118614168476956e-01   +1.379790315742735e-01   +2.301522481061895e-02; +1.185091694349486e-01   +4.997782189689487e-03   +1.636496043693073e-01   +2.013040478716769e-01   +8.962561342596477e-02   +1.032958061806593e-01   +2.889830648991335e-01   +3.146689600490993e-01   +2.153504903607222e-01   +6.543008048517211e-02   +3.141935674563985e-01   +6.868546909047213e-02   +6.628928442403124e-02   +8.091506181896137e-03   +1.673893858304836e-01   +1.129273275177926e-02; +2.134006260555375e-01   +2.227273757864754e-01   +2.694887662449481e-01   +1.477200343747889e-01   +3.295662300698090e-02   +2.642168902194251e-01   +2.800028177001802e-01   +1.362195190764930e-01   +1.499115989707126e-01   +1.321652060647575e-01   +1.426978917027499e-01   +4.914414818869629e-02   +1.972418258678792e-02   +4.510388907127560e-02   +2.594329737455047e-01   +1.885169704856460e-01; -2.420421106869481e-03   +9.134693217310997e-03   +1.447548954736448e-01   +1.966415114596254e-01   +6.431266274520019e-02   +2.477230238608066e-01   +1.424541919145858e-01   +3.023266218679556e-01   +1.512632501610104e-01   +9.502274082407054e-02   +2.850881935697388e-01   +2.810588215146326e-01   +4.069501028642501e-02   +2.910330668214394e-01   +7.197799431162499e-02   +9.812375123038013e-02; +1.505520068611487e-01   +2.046922344058362e-01   +1.987494941581232e-01   +2.219517589552991e-01   +1.194821118714806e-01   +2.605649844884974e-01   +1.531453733380133e-01   +8.403056341401333e-02   +1.772259379079210e-01   +2.661888560592389e-01   +1.164768727779778e-01   +2.173730898296207e-01   +7.676339662982622e-02   +1.033902233947197e-01   +2.825259942906988e-01   +5.085390954973672e-02; +1.527551701192843e-01   +4.279610778597428e-02   +2.653486939361041e-01   +5.377197778810597e-02   +1.976024195513644e-01   +1.006918099135569e-01   +1.399812110332290e-01   +5.877569365013764e-02   +1.535115246978265e-01   +1.542784401328001e-01   +2.358820777830930e-01   +7.772378410201969e-02   +1.564969563720203e-01   +1.680482052443290e-01   +1.478727785108693e-01   +2.251138030910085e-01; +1.016356126885523e-01   +2.057297995043179e-01   +2.962312883253437e-01   +2.049595866394430e-01   +1.218094636025701e-01   +1.934436974377526e-01   +1.181105803013011e-01   +2.618002979851954e-01   +3.030642467553878e-01   +1.273517139991876e-01   +5.030468041810982e-02   +5.306627584504942e-02   +1.340772268157989e-01   +2.959169512207886e-01   +1.303624147983963e-02   +7.579169820664250e-02; +1.797352655140812e-01   +1.131188053652530e-01   +2.427119458280746e-01   +1.964613590561519e-01   +1.836522327105873e-01   +4.745985151577167e-02   +2.060086913969514e-02   +1.409055540526245e-01   +2.416191489732575e-01   +2.100279818032453e-01   +8.899914665320929e-02   +2.389663678321743e-01   +9.739703810885361e-02   +3.205482650136898e-02   +2.242666914734020e-01   +1.939464067441113e-01; +5.235133982492864e-03   +2.070933499805946e-01   +2.109840374897576e-01   +2.193995540747576e-01   +3.075532843051166e-02   +2.842324454846601e-01   +1.410820488726567e-01   +1.431296518728335e-01   +1.557016952090525e-01   +1.490583964840771e-01   +5.218528857060670e-02   +2.825764676940388e-01   +7.051592314904300e-03   +2.427514811063634e-01   +1.172947162440238e-01   +1.595353888031918e-01; +2.230390170011211e-01   +3.434497504364210e-02   +2.750322062792816e-01   +2.582639390758183e-01   +1.962246579576491e-01   +6.008834788998927e-02   +2.946223976642444e-02   +8.823749141012475e-03   +2.368030095344277e-01   +1.257553186338730e-01   +3.311104074584763e-02   +1.783907175610129e-01   +2.623015677507649e-01   +8.342065554784742e-02   +2.744123663771318e-01   +2.064321981938308e-01; +1.263074896311999e-01   +1.535918992347430e-01   +1.600190354313565e-01   +2.475729486344894e-01   +2.797341526143109e-01   +6.025040598162872e-02   +2.002577457158635e-01   +1.827630370120649e-01   +7.356817606254426e-02   +9.162359111597926e-02   +2.322299198930668e-01   +2.996914142987465e-01   +3.888058289530563e-02   +2.213414723512774e-01   +2.419263537829452e-01   +6.092290066338098e-02; +1.684546062584972e-01   +9.254504230208842e-02   +3.341108216446261e-02   +1.839719882808877e-03   +3.031946459607124e-01   +2.861051272343747e-01   +1.257772373839203e-02   +2.179149771358375e-01   +2.160023789516854e-01   +9.590682597878676e-02   +3.691388782040385e-02   +7.397269834597641e-03   +2.920092454254140e-01   +2.438002324702205e-02   +1.705693995378850e-01   +1.283856211733621e-01; +2.031408578399168e-01   +2.335833832000896e-01   +2.767768555969788e-01   +4.700156804103660e-02   +2.039475895146172e-01   +2.218794251809754e-01   +2.243644500998748e-01   +1.993419879000453e-01   +2.786026868351122e-01   +1.365913738560821e-01   +1.326591075221464e-01   +2.760168339123766e-01   +2.628942375308218e-01   +2.242752783006435e-01   +1.393355088874149e-01   +2.829654082317047e-01; +2.640758233120776e-01   +2.103733991709270e-01   +9.870774502044262e-02   +1.934085691965765e-01   +3.244350333398110e-02   +7.540681465846688e-02   +1.901910436872506e-02   +7.605950529232644e-02   +1.054070887281130e-01   +2.230232925297502e-01   +6.291826405043656e-02   +2.525211179069776e-01   +1.772433065586757e-01   +1.957247330749792e-01   +1.266333417965402e-01   +1.031681197923652e-01; +1.423761296240833e-02   +1.662194550868485e-01   +2.652377865623596e-01   +1.663496703319387e-01   +8.626505777421307e-02   +6.121269190149602e-02   +8.487104110546596e-02   +1.257962533017844e-01   +7.368120732540236e-02   +3.136895138762490e-01   +1.111624505120553e-01   +1.844056122541995e-02   +6.042458102862679e-02   +2.313002957174714e-01   +9.578324294591406e-03   +2.136826337729468e-01; +2.493711869693051e-01   +1.140185892893543e-01   +6.698599237757595e-02   +3.033433799854436e-01   +3.566277992829275e-02   +4.462057747349684e-02   +2.777293942106105e-01   +4.821071547262069e-02   +1.874708702605571e-01   +2.370547223825323e-01   +2.041929609373161e-01   +5.098328515433417e-02   +2.347131124422521e-01   +2.494227522299457e-01   +2.975413573463104e-01   +2.767085368350655e-01];
L1E_L1I_iGABA_netcon = [+1.602193691871366e-01   +2.028982815104699e-01   +2.080452385387653e-02   +1.017695775775421e-01   +2.601803040794608e-01   +1.202782133041741e-01   +1.117093081868867e-01   +7.249697322353080e-02   +2.745501629405344e-02   +1.190143482949905e-01   +1.161214726957147e-01   +1.834835168751373e-01   +9.783608909182037e-02   +2.844948346968398e-01   +7.318194248097483e-02   +1.585966104649125e-01; +4.385001325051089e-02   +2.880009944972023e-01   +1.577786466544563e-01   +2.766033389435238e-01   +1.385818537671856e-01   +1.303370798321445e-01   +5.282372635858542e-02   +1.580259741851459e-01   +1.491919999137744e-01   +4.707293048670341e-02   +6.192565976305164e-02   +2.226915302680378e-01   +1.540612593550348e-01   +2.273437333173920e-01   +1.559198310950871e-01   +2.234200765395832e-01; +2.009859650547470e-01   +3.156065391037456e-01   +2.453327184524366e-01   +2.060577583993488e-01   +3.210635454264954e-02   +1.830550182120958e-01   +2.054997032307482e-01   +2.713731770399970e-01   +2.755833628060355e-01   +2.979517854022715e-01   +2.066243167604963e-01   +1.605893485419438e-01   +3.038597818015886e-01   +2.596605392422672e-01   +1.377308166687144e-01   +1.793066333981596e-01; +1.757010108158541e-02   +4.448743525045037e-02   +2.843137608111083e-01   +1.553652729740860e-02   +5.664937248584718e-02   +2.245434268533067e-01   +2.242648014742537e-01   +1.751111787099204e-01   +1.605114997147447e-01   +3.053081391974120e-01   +1.991386962608101e-01   +2.773884077635197e-02   +1.115244943228623e-01   +5.889887555840227e-02   +3.374888477380374e-02   +3.047917405491041e-01; +2.941010444394133e-03   +2.758853001387646e-01   +1.648793755529732e-01   +3.209991494321498e-02   +1.311459017313751e-01   +2.648448322080428e-01   +2.224753171720520e-01   +1.262920598479857e-01   +3.926716100832412e-03   +5.116199518211856e-02   +2.230686390767887e-01   +3.414534461341712e-02   +2.576031378704220e-01   +1.437712719303298e-01   +2.063169016613071e-01   +1.727688046835008e-01; +2.393584252859184e-01   +2.928592247615446e-01   +4.572562401777354e-02   +2.109637516147913e-01   +1.110742849418316e-01   -6.100334352824903e-04   +2.157486371238616e-01   +9.483845063040874e-02   +2.591227815867200e-01   +5.087262784415201e-02   +2.964639382497850e-01   +4.511477873196969e-02   +1.145789141848397e-01   +4.227259963025925e-02   +1.679151023253846e-01   +4.516290560995523e-02; +1.559135028800195e-01   +6.892486737285471e-02   +4.709858929495762e-02   +7.952682934393818e-02   +6.154509337960836e-02   +1.187956219317931e-01   +9.547463306806675e-02   +1.668762293006883e-01   +2.735951053804960e-01   +5.169870639653768e-02   +2.384902204119413e-01   +3.133627612384749e-01   +3.141364227610869e-01   +1.594499422695914e-01   +1.585398950835754e-01   +8.996334322409411e-02; +8.962552269001847e-02   +6.875772721257985e-02   +3.432354690681551e-03   +4.676521413589393e-02   +2.290235134000330e-01   +1.609520507525192e-01   +1.529475060178747e-01   +1.944596003067537e-01   +6.128023282916903e-02   +1.302571366580328e-01   +2.610066931917817e-01   +2.986342106506588e-01   +1.657622146692577e-01   +1.452633089572238e-01   +5.904616293230681e-02   +2.231746647073033e-01; +9.395794415508581e-02   +1.951903571543644e-01   +9.478142730815199e-02   +3.926154039103956e-03   +5.686287482726793e-02   +2.184357048523255e-01   +2.522721054249799e-01   +2.812416446195870e-01   +1.123742498680920e-01   +3.611743005049335e-02   +2.378433259099907e-01   +1.121851732149100e-01   +2.762167816419409e-01   +2.962815337769332e-01   +1.890973360464568e-01   +2.158438749250973e-02; +1.549128647746422e-02   +1.267263926593349e-01   +4.956540790671407e-02   +1.787932884713686e-01   +1.241075497841486e-01   +2.653281915908251e-01   +9.931794751260567e-02   +7.035404778415562e-02   +2.933744707110427e-01   +2.375875319438968e-01   +7.491548529910297e-02   +1.931701002422458e-01   +2.421987609437778e-01   +5.857155625392479e-02   +2.478993809048656e-01   +6.656404665440852e-02; +2.722651808543510e-01   +3.296695174356766e-02   +9.531395828100765e-02   +1.275029947956069e-01   +1.673895839533238e-01   +2.092860893127819e-01   +1.423712940113489e-01   +3.036086454764775e-01   +1.002051892685250e-01   +1.297018282212705e-01   +1.834822109448648e-01   +1.511171960643198e-01   +8.224654962006170e-02   +3.028886522374915e-01   +2.814224213206437e-01   +1.051183497634325e-01; +5.652624876880801e-02   +2.851682415368565e-01   +1.727124352969812e-01   +2.885010800369913e-01   +3.071624330842024e-01   +2.069214204670324e-01   +1.472941619857631e-01   +4.147522964501651e-02   +2.259983329115178e-01   +1.460275992629542e-01   +1.046835179291865e-01   +2.619509938922420e-01   +2.135297199709642e-01   +1.523660496033910e-01   +2.501879123490902e-01   +7.296500452810603e-02; +2.278411960739088e-01   +2.781866085182156e-02   +1.698559764002112e-01   +3.797540310817435e-02   +1.715258218734234e-01   +1.777450494078563e-01   +1.875486949660548e-01   +6.541302275015755e-02   +2.369664764313196e-01   +2.776299582834424e-01   +5.855319854660945e-02   +2.455700875370572e-01   +3.031953892004416e-01   +1.954024722712258e-01   +1.149678814137431e-01   +3.935548987231319e-02; +8.093624071286300e-02   +8.219507648951753e-02   +7.802265824531245e-02   +3.052534288293882e-02   +6.131630201783309e-02   +2.723449719632725e-01   +2.921892110359788e-01   +2.374834809253449e-01   +1.379259198891898e-01   +2.012849902560494e-01   +3.124609548603526e-01   +2.318317184287164e-01   +1.983929906601619e-01   +2.677154321059086e-01   +2.063820110048022e-01   +2.326901316215608e-01; +1.322575965063237e-01   +5.496765424969585e-02   +1.432028011148950e-01   +2.760311079592332e-01   +1.919367138067733e-01   +1.612260191071439e-01   +3.950984778102604e-02   +1.098344683932616e-01   +5.719743921470453e-02   +1.618600693133130e-01   +8.206891187454754e-02   +1.386874534901057e-01   +1.183776082134108e-01   +6.652797272205928e-02   +5.471054259595787e-02   +9.240781686246889e-02; +1.395994336879315e-01   +2.065637694336817e-02   +5.505177082272499e-02   +2.893276667928101e-01   +2.947983811000328e-01   +1.952663508575784e-02   +6.695221025199109e-02   +2.551329384202433e-01   +2.479954821950038e-01   +4.093736952113931e-02   +1.300479673370903e-02   +1.942165564211443e-01   +2.069891912914443e-01   +1.606031892973743e-01   +1.257925946684695e-01   +1.433142659423805e-01];
L2I_L1I_iGABA_netcon = [+3.079795969595565e-01   +1.520847696694930e-01   +8.748798251239324e-02   +2.774666081359259e-01   +2.904290587322518e-01   +2.918258888170937e-01   +1.144328920749914e-01   +2.476351104978246e-01; +2.460209101927016e-01   +2.772384349002974e-01   +2.257562774471782e-01   +8.736266286658806e-02   +1.363635155062305e-01   +2.100869061459337e-01   +2.800757200564921e-01   +6.918623119301512e-02; +6.640941804672136e-02   +7.113868162481531e-02   +8.438753245336700e-02   +1.185802622382214e-02   +2.498694262317606e-01   +3.054423013379001e-01   +3.519675838147757e-02   +1.892069862556771e-01; +1.184817298532767e-01   +2.465364328028298e-01   +2.107844473388681e-01   +1.942441193077239e-01   +1.903601016060176e-01   +1.898634624160851e-01   +1.577448972487552e-01   +2.479772157912259e-01; +1.013718232433588e-01   +5.620925926706603e-02   +1.896519651825296e-01   +1.806688375536778e-01   +1.449371667886748e-01   +2.417995354256682e-01   +1.575974017407714e-01   +1.852194887757063e-01; +2.427035593065847e-01   +2.258599658587913e-01   +2.836264855559029e-01   +1.327860659070826e-01   +9.175545710432052e-02   +2.173041801744658e-01   +1.328074983684917e-03   +2.103248319011540e-01; +4.017429922599743e-02   +1.109415144551531e-01   +1.143184816558533e-01   +7.727933725140530e-02   +2.181788803214449e-01   +8.933887760974173e-02   +7.149667033125180e-02   +2.072165871678914e-01; +1.814311075741949e-01   +1.090126269884037e-01   +2.510512031426620e-01   +1.204921126687928e-01   +9.270179281950150e-02   +2.160882852896297e-01   +1.430964297260766e-01   +9.427760665670233e-02; +1.280913197908946e-01   +2.189640193621098e-01   +6.267112376639328e-02   +7.772377631307564e-02   +1.004373045582670e-01   +5.109907239574510e-02   +1.317293915080025e-01   +2.998004543268498e-01; +1.657247865569023e-01   +2.086968205590534e-01   +7.000903579449619e-02   +1.726618978285334e-01   +9.582774220257573e-03   +2.223834655677490e-01   +2.808057121448841e-01   +2.154441988780990e-01; +1.635605316768468e-01   +2.474098321265764e-01   +2.615455387418773e-01   +1.151390232837966e-01   +2.234609694932515e-01   +3.097116156245732e-01   +5.873314377490351e-02   +8.526619463098148e-02; +2.441037172928306e-01   +1.630351726209452e-01   +1.880970311462044e-01   +1.315726335358370e-01   +3.067070782613118e-01   +8.470534990661782e-02   +1.955375579641672e-01   +1.022201687942674e-01; +9.668892653324643e-02   +2.989533693920347e-01   +2.885609096649814e-01   +6.253992319477152e-02   +1.731680885386208e-01   +9.368136531915165e-02   +9.805759285557676e-02   +1.586128316581722e-01; +2.157270898237912e-01   +8.032868839043844e-02   +3.114210013124500e-01   +1.628718206658156e-01   +2.624345818434253e-01   +5.632360836909527e-02   +2.995432743155829e-01   +7.093211358566844e-02; +3.002937335277970e-01   +6.675768640511900e-02   +8.146520449707298e-02   +2.893546698982539e-01   +2.093705813383403e-01   +4.412314949108995e-02   +1.238818947857918e-01   +2.188921239990038e-01; +6.180979087101098e-02   +2.209454729130725e-01   +2.193041758894477e-01   +1.905974692719929e-01   +2.597441332379612e-01   +3.978895958341644e-02   +3.089589490348962e-01   +9.103152525567716e-02];
L1I_L2I_iGABA_netcon = [+1.795653121650624e-01   +2.161045385111530e-01   +9.580789033051280e-02   +2.194694720964236e-02   +1.618085912061369e-01   +1.208870016099615e-01   +3.077821064863557e-01   +2.192240544078740e-01   +1.295668164966941e-01   +2.410285872591936e-01   +4.166663000803549e-02   +9.930253834530085e-02   +3.400126708229262e-02   +2.681142521124919e-03   +6.348218397164242e-02   +2.488852167017471e-01; +2.486258931388561e-01   +1.909932129424401e-01   +1.221961787790213e-01   +1.470173394274332e-01   +2.876670876878883e-01   +1.379216314235420e-01   +2.109107059109629e-01   +3.036371232303318e-01   +1.364189912233492e-01   +3.063450326023701e-01   +2.075160632042513e-01   +1.137517339033315e-01   +1.562187700259944e-01   +2.059831850651597e-02   +1.379431105023896e-02   +2.772735018406711e-01; +2.700148557341190e-01   +1.825165774793829e-01   +6.744631390440096e-02   +2.593961305601670e-01   +1.041996630452866e-01   +2.678914168151974e-01   +2.354771480709015e-01   +2.062777284848326e-01   +1.194157450082399e-01   +1.130361499160969e-01   +2.136144463631512e-01   +1.227166617985577e-01   +9.897503990099660e-02   +5.334841793688548e-02   +1.917677363773674e-01   +4.238909084940308e-02; +1.266661502955943e-01   +1.298950685888595e-02   +1.844089772406076e-01   +2.713731631191604e-01   +3.030139840049630e-02   +1.451916100781911e-03   +1.139004421269262e-01   +1.098882818075605e-01   +1.902652685963098e-02   +2.045779163508974e-01   +1.744954112665127e-01   +1.514242890321228e-01   +7.772514816886211e-02   +1.744621299013490e-02   +2.484638766711544e-01   +1.625933377934003e-01; +2.393475926966375e-02   +2.558074224619449e-01   +2.451349357048206e-01   +2.066726658382029e-01   +1.969533062008043e-01   +1.569030304348747e-01   +1.945323625242127e-01   +2.648178901549305e-01   +1.903140794804192e-01   +1.045718959121876e-02   +1.009982487903933e-01   +2.388535352786353e-03   +7.825347384141733e-02   +2.781039909013751e-01   +6.539795622435618e-02   +1.493413294997763e-01; +1.920199708024512e-01   +2.212933966810224e-01   +4.010245406437962e-02   +2.792643227659518e-01   +1.807851253324489e-01   +3.038854798947302e-01   +2.254634252784170e-01   +2.612619447145650e-01   +1.729714215413098e-01   +1.818053663387174e-01   +3.174820093445506e-01   +2.586691053456511e-01   +4.475366519546765e-02   +2.856684540845449e-01   +2.259629764079578e-01   +2.842430189203041e-01; +2.447957388283911e-01   +4.141171330358602e-02   +2.696057280263157e-01   +3.074159746930034e-01   +1.201855052225321e-01   +3.073848988234292e-01   +1.634410602326458e-01   +1.488921877687404e-01   +7.657835051271253e-04   +1.834262189586597e-01   +9.232432554434193e-02   +1.115934067063788e-01   +2.463495932766668e-01   +1.299194924264044e-01   +2.627279586733919e-01   +1.787207574872527e-01; +2.334221966020230e-01   +2.945850328698766e-02   +2.841525227432601e-01   +2.250936175052444e-01   +3.478828631158344e-02   +2.472209657581447e-01   +1.868727899567634e-01   +2.410699292305607e-01   +1.107807268683607e-01   +2.701590092315758e-01   +8.460353707973167e-02   +1.550649939688218e-01   +1.581854835477152e-01   +1.533737388620577e-02   +2.869818743758291e-01   +2.877540459892215e-04];
L2E_L1E_iAMPA_netcon = [+2.468681902321321e-01   +9.257440894317082e-02   +4.385477124928372e-02   +3.122287174813275e-01   +3.244322992498160e-04   +1.540349062762493e-01   +2.081484386262768e-01   +2.427158667112951e-02; +2.875934851482655e-01   +2.715292471850332e-01   +1.672253884130477e-01   +1.180861921743185e-01   +1.581629965558825e-01   +5.630314312213556e-02   +2.893343232791399e-01   +1.260209891933468e-01; +3.024062420514053e-02   +4.060401267640774e-02   +9.817281269424290e-02   +4.522224720725503e-02   +2.016894255454380e-01   +2.660886486443518e-01   +1.016243461671043e-01   +1.009601124973212e-01; +8.513179759118088e-02   +2.299644651672111e-01   +6.483508414703860e-02   +2.108269979420346e-01   +2.327342011903785e-01   +1.001644895169236e-01   +2.790692233296408e-01   +2.584400261336336e-01; +6.082778473783304e-02   +3.092553930084563e-01   +4.712623245604047e-02   +7.722080021153506e-03   +2.919776460413048e-01   +2.999671685849227e-01   +2.153074816316305e-01   +1.452006151880083e-01; +2.198422819050919e-01   +1.639979039927102e-01   +2.960694064519639e-01   +2.451369499746634e-01   +2.173335783245290e-01   +7.233738779533869e-02   +2.483778339449615e-01   +2.166661050914359e-01; +3.375160250161544e-02   +1.041903609433171e-01   +8.693166852162362e-02   +1.424268852255847e-01   +2.851797985327522e-01   +1.462754062052110e-01   +5.497410480492203e-02   +1.097033050509522e-01; +2.179512569941256e-02   +4.124764892007026e-02   +1.684481602532259e-01   +2.113679487990772e-01   +1.214696253892358e-01   +2.864365935901018e-01   +3.021082840205422e-01   +2.863228242332402e-01; +1.126591949372007e-01   +2.793601688654812e-01   +1.541719404081651e-02   +7.857385242240597e-02   +5.008756914528087e-02   +3.028860741714535e-01   +1.715784883006559e-01   +2.129846760902598e-02; +9.027055309411776e-02   +9.139358445341268e-02   +2.693838518343152e-01   +1.258199756771029e-01   +2.576644741273446e-01   +2.799619322997456e-02   +4.239461381145345e-02   +3.006211632048034e-01; +1.811392573907599e-01   +1.527932847211277e-01   +6.049806810587489e-02   +1.936160991069577e-01   +1.306735113688513e-01   +1.337542916001792e-01   +1.860774337280908e-01   +2.832580344273906e-01; +8.305002847217488e-02   +1.404752640860457e-01   +2.597374070496615e-01   +2.335705811800409e-01   +2.019373050870085e-01   +5.980553795135217e-02   +3.134565541623112e-01   +7.515204269866127e-02; +1.877726742170312e-01   +2.638843897073166e-01   +7.781448161956989e-02   +1.442069441736388e-02   +3.082578431373014e-01   +2.082237893806248e-01   +1.434918560893314e-01   +2.515105031509102e-01; +1.302456120729993e-01   +1.387657700579179e-02   +3.320473991263759e-02   +2.096012578795093e-01   +3.146583494426872e-02   +9.355570429802605e-02   +2.260330293692279e-02   +2.332292861365400e-01; +8.729657663490112e-02   +6.651794576022706e-02   +2.370445176451713e-02   +2.432949762081551e-01   +3.245685730336863e-02   +3.079053266871458e-02   +1.267338649539640e-01   +6.910114642201980e-02; +4.467304788344327e-02   +1.420355957174941e-01   +4.537431799581915e-02   +1.688763075984345e-01   +8.070662165735820e-02   +1.722990735190458e-01   +3.240843172222022e-02   +2.599545878615047e-01];
L1E_L2E_iAMPA_netcon = [+1.142982726648170e-01   +4.707647858770344e-02   +2.931767480781959e-01   +2.968905132083454e-01   +1.049809708170679e-01   +2.983323189832520e-01   +1.594658362797964e-01   +3.078136912512854e-01   +4.294812050389646e-02   +2.051133560614513e-01   +2.002295404729497e-01   +2.382992321889973e-01   +1.168086815298103e-01   +2.114443636148480e-01   +1.775021534656794e-01   +1.577304678980787e-01; +1.171879834818148e-01   +1.616829577998276e-01   +6.790816361558703e-02   +2.766225198019702e-02   +1.717114365131050e-02   +2.111237341767584e-01   +2.499329651866509e-02   +1.004677813442153e-01   +6.913307501549415e-02   +1.013664394402675e-01   +8.370892479620119e-02   +2.956835321098279e-01   +4.562279872574400e-02   +8.359390761357346e-02   +1.879873667195963e-01   +7.683649897446197e-02; +1.025449575602631e-01   +1.824500106867788e-01   +2.826678350248102e-01   +2.868038949194313e-01   +2.988673722512031e-01   +3.580927694888410e-02   +9.495999259466852e-02   +1.825101371490461e-02   +1.407126710997106e-01   +1.811224632257997e-01   +1.046019152841197e-01   +3.162963003774928e-02   +2.341763445157330e-01   +1.910950737891908e-01   +2.777121627446142e-01   +2.181902146977692e-02; +2.459021367250486e-01   +6.852427227821527e-03   +6.701540102138237e-02   +6.629993016241485e-02   +2.268572369937984e-01   +9.871456724880373e-02   +2.852470598944223e-01   +2.784925648591129e-01   +2.461278996381790e-01   +2.440209832534341e-01   +1.430790603118987e-01   +1.769316427388223e-01   +2.875765750425137e-01   +1.097691512003653e-01   +2.885491959174598e-01   +3.052073771235173e-01; +4.316745497453937e-02   +2.698218952891889e-01   +2.715140614242966e-01   +9.022379781456853e-03   +5.039499419309657e-02   +2.571811302083438e-01   +2.905751243444999e-01   +5.461928053077623e-02   +1.800053513215907e-01   +1.356900264128649e-01   +1.761841496046939e-01   +2.405879403772512e-01   +7.218199135504673e-02   +1.686763090727820e-01   +3.143891767761577e-01   +2.025200527465501e-02; +1.278803890821676e-02   +2.722522936762499e-01   +8.260293638044056e-02   +2.544718088532234e-01   +3.073522284331927e-01   +2.709104674224420e-01   +1.630087916001100e-01   +2.876523546388409e-01   +1.048450805407263e-01   +1.252746012556926e-01   +2.663915356412503e-01   +2.889276444706769e-01   +2.644824179045395e-01   +1.970429985131014e-01   +5.956988850365504e-02   +1.754967054084932e-01; +9.882425350224650e-02   +6.607502646352903e-02   +1.788643953450885e-01   +8.506955624440588e-04   +1.192308139512228e-01   +1.642929348681215e-01   +2.320542528488676e-01   +1.853044376578738e-01   +1.854416966455990e-01   +2.499125279722189e-01   +1.972185003361508e-01   +3.966750764523048e-02   +1.130620966509108e-01   +1.771428287772300e-01   +7.499597374501621e-02   +1.105910857490538e-01; +2.563389586767776e-02   +1.672242284615598e-01   +1.556386710336685e-01   +1.223222240243780e-01   +2.301539856514625e-01   +3.052666080653776e-01   +3.080451541758270e-01   +2.049926476594218e-01   +2.756820410236661e-01   +1.252432551555278e-01   +1.080773528953330e-01   +3.075448470101180e-01   +2.047058072038697e-01   +2.876613681310943e-01   +1.004169169908598e-01   +3.085496175049314e-02];
L2I_L2E_iAMPA_netcon = [+1.961051875336038e-01   +7.410914335245911e-02   +2.856133174128152e-01   +1.474530532143100e-01   +2.409004952539571e-01   +1.224559770881718e-02   +6.768943343273765e-03   +2.867275533456753e-01; +5.054348787193752e-02   +3.947183376201990e-02   +5.399216474673764e-02   +2.664842908910608e-01   +2.424187461538703e-01   +1.230118687783610e-01   +2.217413063484766e-01   +1.545038807440524e-01; +2.672888790050241e-01   +2.373083981991261e-01   +2.603033309527520e-01   +2.360400951159472e-01   +1.665666052711262e-01   +1.589934394601122e-01   +1.567391255172653e-01   +2.270346513207777e-01; +1.244849676334321e-01   +5.044251383540418e-02   +2.800889478122792e-01   +1.366057189513901e-01   +3.039150249617800e-01   +4.626680042146489e-02   +1.412626552623831e-01   +2.695021143451410e-01; +2.172221099857634e-01   +2.680568510744722e-01   +2.005061167573543e-01   +1.915073360673417e-01   +2.899191856016774e-01   +2.337471637455174e-01   +1.258887415924904e-01   +2.334496471761597e-01; +1.923007145232203e-01   +9.376000330569838e-03   +2.737294977419173e-01   +2.329831317052532e-01   +1.661651157456148e-01   +6.218421663505226e-02   +3.592384267867645e-02   +2.228383127555901e-01; +3.003149107608694e-01   +1.470432221084452e-01   +5.297827725558238e-02   +1.625183121981541e-02   +3.898813217620254e-02   +6.833804215857005e-02   +4.567929806847961e-02   +5.311267768871524e-02; +2.874777739183886e-01   +1.012400150276021e-01   +1.746446999097502e-01   +1.548701702914642e-01   +2.763016161143647e-01   +7.471852578005546e-02   +3.643434492957218e-02   +7.389202905311828e-03];
L2E_L2I_iGABA_netcon = [+2.955230325270577e-01   +7.392235527004913e-02   +6.389978225665677e-02   +5.642061390874003e-02   +2.101414918214788e-01   +1.146271058960743e-01   +2.609567141963367e-01   +2.945607381089467e-01; +7.865151251415216e-02   +1.319809989040691e-01   +4.323567336096517e-02   +4.847535630064867e-04   +3.141776848649971e-01   +2.190656350105149e-01   +2.368960855933231e-01   +2.265689304511581e-02; +2.041726149946476e-01   +1.091251350333138e-01   +1.766083144107416e-01   +1.727552363608778e-02   +1.215065960542396e-01   +2.492036343238325e-02   +3.071633175934589e-01   +2.576331652323942e-01; +2.685292819475800e-01   +2.581602478530755e-02   +8.233550787474776e-02   +2.275259393285130e-01   +2.856173998191112e-01   +1.988877878621061e-01   +1.386985953219355e-01   +2.081087825146076e-01; +5.011772117557244e-02   +2.857343588115973e-01   +2.136568971267622e-02   +2.608282941925003e-01   +9.626794921457402e-02   +1.149606352439417e-01   +1.330464952958594e-02   +8.669457181149487e-02; +2.357614636332966e-01   +1.035296817974900e-02   +1.718294873221554e-01   +2.473764544661967e-01   +2.769795944606580e-01   +8.333682222883783e-02   +2.971781097076128e-01   +2.410666036072720e-01; +5.059359281559792e-02   +3.095465748270427e-01   +9.315023798850533e-02   +9.023815247281550e-03   +2.267163480026524e-01   +1.640281508304657e-01   +1.876404479413513e-01   +1.965579187354459e-01; +2.726766140199957e-01   +9.846062595459683e-02   +1.617188935113794e-01   +6.470850989208747e-02   +1.425060785224234e-01   +2.476215569459406e-01   +2.988968587792391e-01   +1.978924417949723e-01];
L3E_L2E_iAMPA_netcon = [+1.124395613157799e-01   +2.001468160105176e-01   +4.931641892560780e-02   +1.993803653804806e-02   -4.950045873594576e-04   +3.081156333086347e-01   +1.221487392719117e-01   +2.679166256400621e-01   +3.618502284489140e-02   +9.002405132850821e-02   +8.775753447556903e-02   +1.822388507812746e-02; +8.730803421251379e-02   +2.807688171995529e-01   +9.567299999854983e-02   +1.175303712031689e-01   +1.429849348149158e-01   +1.741880792076463e-01   +2.856116806383245e-01   +3.084299228369857e-01   +1.796950683394598e-01   +2.997017767645007e-01   +1.069598640826241e-01   +8.002534876226720e-02; +3.019053263258826e-02   +2.361566356357398e-01   +3.343838723321203e-02   +2.306938283784936e-01   -1.451555998602735e-03   +5.245265708947061e-03   +1.648455998017236e-01   +3.068474624631748e-01   +1.863779699271633e-01   +1.903335294912897e-01   +7.880702503205414e-02   +2.193350676105259e-01; +1.206457175818185e-02   +6.096295904157047e-02   +2.549773800578216e-01   +7.944145810691523e-02   +8.848349447352773e-02   -2.063680328562793e-04   +1.085531886376636e-01   +2.349402804350733e-02   +6.800600179385574e-02   +1.016122678212893e-01   +6.204320759327607e-02   +1.049838783077980e-01; +2.859853702073705e-01   +1.164754238953149e-01   +1.064649301867437e-01   +3.094117884624897e-01   +2.149283281651485e-01   +1.110952784613686e-01   +3.044746556415120e-01   +5.307275191871075e-02   +2.652445877181326e-01   +1.490976508055674e-01   +2.187399400151497e-01   +1.252920429842999e-01; +2.742217680851854e-01   +1.908134756562517e-01   +3.051131062186327e-02   +1.558695617780984e-01   +2.000825096842999e-01   +2.864367972225537e-01   +2.775517680500211e-01   +1.203698697118578e-01   +1.462993947865013e-01   -1.997896933535539e-03   +1.995572446432089e-01   +7.917008341770046e-02; +1.982658664276705e-01   +1.576067757129052e-01   +1.972672517414756e-01   +6.530622679677046e-02   +2.180128053590081e-02   +1.119953002147690e-01   -1.212513280170148e-03   +1.133796138944323e-01   +9.050268071509374e-02   +2.821689516674117e-02   -1.283034389822671e-03   +1.445690297677106e-01; +2.662100044188223e-01   +3.524947329424048e-02   +1.478150248439465e-03   +8.295926054238313e-02   +1.729325331392426e-01   +3.208854184259460e-02   +7.215391687685162e-03   +1.509677769536625e-01   +1.556701463835352e-01   +2.652766305119129e-01   +2.802304724059022e-02   +1.895687028670650e-01];
L3I_L2I_iGABA_netcon = [+3.078659693156707e-01   +1.574930519655080e-01   +2.086169447913324e-01   +8.544119382630173e-02   +2.973406803032628e-01   +1.362608809723981e-01   +1.292439052397575e-02   +5.545697055932478e-03   +2.710903633855486e-01   +1.383056995220257e-01   +3.494518042421916e-02   +2.324573760846400e-01; +2.831258472953354e-01   +3.023659951025024e-01   +2.782690567101951e-01   +4.890009869845183e-02   +1.568231236982052e-01   +2.590749229604703e-01   +1.847629389720382e-02   +6.734216280130034e-02   +1.542832477441017e-01   +2.116591544287015e-01   +3.656745741839040e-02   +1.978963383818117e-01; +3.289129989205818e-02   +2.711319585554001e-01   +2.838973346577991e-01   +4.784545461679020e-03   +2.218082074634919e-01   -3.000486771226903e-04   +1.969298141866750e-01   +2.968960174388457e-01   +2.235603433472715e-01   +8.216811572252626e-03   +1.921981143239709e-01   +3.568241053734866e-02; +3.005029820662613e-01   +1.411237069076531e-02   +1.400056702216418e-02   +2.057614496599943e-01   +2.804136669342118e-01   +1.711705229215189e-01   +3.663710608801792e-03   +5.864084348114022e-03   +2.700849628409210e-01   +2.602652469016206e-01   +3.115264098371975e-01   +1.728173139831609e-01; +4.986364166499598e-02   +3.007072172918339e-01   +1.310757928351321e-01   +1.375980061100045e-01   +1.820440363706769e-01   +2.927767501099418e-01   +1.253472748680846e-01   +5.189422010909532e-02   +3.190188469553841e-01   +1.579633638674368e-01   +6.706810946346528e-02   +6.009761296858042e-02; +1.124298860484180e-02   +2.153803200192252e-01   +6.318747223752237e-02   -2.160106845925226e-03   +5.102826774609674e-02   +2.017973247697373e-01   +2.197788196272169e-01   +7.506485157560665e-02   +1.576707758038467e-02   +2.398641040964442e-01   +2.770320427421843e-01   +2.028712930901789e-02; +1.957040098811128e-01   +2.743746809749638e-01   +1.812936617802271e-01   +2.072824244345833e-01   +1.351568051286811e-01   +9.631056613586633e-02   +2.171829207552106e-01   +2.759361170658205e-03   +2.666892865745000e-01   +1.182645401107457e-01   +1.558410959399337e-01   +2.257921181002372e-01; +1.566439672982293e-01   +6.654320211639853e-02   +1.006913607257723e-01   +1.871755508922883e-01   +1.088064132708290e-01   +4.219430945391110e-02   +7.424264833947840e-02   +8.607567340483707e-02   +1.737917024872271e-01   +3.055245785792513e-01   +8.755443918172608e-02   +9.045122740268610e-02];
L2E_L3E_iAMPA_netcon = [+2.129523489401505e-01   +2.082895479489141e-01   +7.098407531331286e-02   +2.727641192929348e-01   +1.856786126285314e-02   +1.643982398672675e-01   +2.123024300516749e-01   +2.932793981682494e-01; +1.724353612138323e-01   +2.310089383599368e-01   +2.310162401265671e-01   +2.503977165311288e-01   +3.152096954898462e-02   +1.616151764476989e-01   +2.690873175106122e-01   +2.164892267448439e-01; +2.634884641202687e-01   +2.784646249520299e-01   +2.613204898116329e-01   +2.842287580196118e-01   +1.831420194307478e-01   +2.076467339949490e-01   +2.764746170483301e-01   +1.838475499532154e-01; +1.253311086056348e-01   +3.010975685160827e-01   +2.680669858135135e-01   +1.896274287641900e-01   +1.632879889089706e-01   +1.589087979375001e-01   +8.536507632487018e-02   +5.665672673125595e-02; +4.593338502302027e-02   +1.757908876094442e-01   +8.030875053701989e-02   +2.893898613930717e-02   +5.776263661115130e-02   +1.692158909833797e-01   +2.807140956227172e-01   +2.419883728251358e-01; +1.538974498856717e-01   +3.120328085196791e-01   +2.837425452577689e-01   +1.721235398691960e-01   +1.598914930841800e-01   +3.059980786819027e-01   +2.289068041721277e-01   +3.050108875894983e-01; +1.530374632369435e-01   +3.686330436441409e-02   +1.610032336643775e-01   +7.832470756676039e-03   +1.137763283809932e-01   +2.524444439556200e-01   +1.111223836343952e-01   +2.423221642806287e-01; +2.956128669540126e-01   +2.140849897840986e-01   +1.394678196014721e-01   +2.450464351439446e-01   +1.101500117494012e-01   +2.388800924923227e-01   +1.609347049681889e-01   +1.346547360358441e-01; +1.468571881891909e-01   +1.754707180411051e-01   +2.779412767341677e-01   +1.959523531200606e-01   +1.815006436322683e-01   +1.101834588221043e-01   +1.883264998898636e-01   +2.094268713754875e-01; +8.584774636091808e-02   +4.879263482332264e-02   +2.464910695971997e-01   +2.749436525186594e-01   +2.789789194805501e-01   +3.330618615204131e-03   +4.095651178391734e-02   +1.999454553348899e-01; +1.817160367045131e-01   +1.017905419595353e-01   +2.304838181297590e-01   +2.580182461081565e-01   +2.943646591005752e-01   +3.020946505774197e-01   +8.208587276722856e-02   +1.176835023491557e-01; +3.370301661705057e-02   +1.857072023848375e-01   +1.321250119464142e-01   +2.723823721005754e-01   +1.541546492543127e-01   +6.316736033311537e-02   +2.042258115039492e-01   +2.718559213892457e-01];
L2I_L3I_iGABA_netcon = [+2.983211517171381e-01   +1.311902942297596e-01   +8.990883239415703e-02   +2.229635224727476e-01   +2.341417366632808e-01   +2.635323494343592e-01   +8.783033089382570e-03   +1.653072222523129e-01; +1.696922556461538e-01   +1.477724081532977e-01   +2.196797968555588e-01   +5.501201061867218e-02   +2.795382465854194e-01   +2.551013366583901e-01   +1.440549485355284e-01   +7.848096926557850e-02; +2.446052007061427e-01   +2.298454330723106e-01   +2.961397739913672e-01   +1.929481716472644e-01   +1.105853799869099e-01   +1.894988486261269e-01   +1.231691164828725e-01   +5.290753019681847e-02; +6.437620238790563e-02   +2.606696676315095e-01   +6.854354209857080e-02   +1.546657218558048e-01   +1.456463622455628e-02   +1.092868292364480e-01   +1.216998333554468e-01   +3.075273143944312e-01; +9.893916846398948e-02   +1.209698041816075e-01   +1.652242323000460e-01   +1.463169616810355e-01   +1.135744139444164e-01   +2.008805419348097e-01   +3.373539828654007e-02   +4.563199007190864e-02; +4.957090108868972e-03   +8.304527999665641e-02   +1.321149846223678e-01   +5.471682953862014e-02   +1.121785907964895e-01   +1.263325976147373e-01   +1.642353302257407e-01   +2.209809915323272e-01; +1.109704630744884e-01   +1.442061673021535e-01   +2.944463091633953e-01   +2.032839270470085e-01   +2.306901114259633e-01   +9.657779890491243e-02   +1.002741865805734e-01   +9.543376954227130e-02; +7.845270192005573e-03   +3.102158309916780e-01   +1.004472761268481e-01   +2.777336471057958e-01   -1.504512820647055e-03   +2.386510241990427e-01   +1.786712980435478e-01   +2.419452892626795e-01; +2.771058938443977e-01   +9.251083573671443e-02   +2.631318413628034e-01   +1.720705486311746e-02   +1.571877878113888e-01   +8.696761905635093e-02   +1.286864705018266e-01   +1.425106442634129e-01; +2.372712484327617e-01   +1.574231279350806e-01   +8.155567451818485e-02   +1.555131737772896e-01   +1.950826171615161e-01   +1.056470772887103e-01   +6.331295612195542e-02   +9.502012454372495e-02; +2.250219972106539e-01   +3.045909895945036e-01   +1.688318319036042e-01   +2.136737904113028e-01   +9.027880704109770e-02   +1.167253374211156e-01   +2.981312174463352e-01   +4.286477017660246e-02; +2.367486809139478e-01   -1.220286445135083e-03   +1.060731483646145e-01   +4.302427057508169e-02   +4.309389494932077e-02   +3.064586072054096e-01   +1.548666591167504e-01   +1.730715185388686e-01];
L3I_L3E_iAMPA_netcon = [+1.349372466022839e-01   +3.124083236251381e-01   +8.069254663544803e-02   +1.923086342978789e-01   +2.441669685111808e-01   +1.025413843348158e-01   +9.420464820766232e-02   +7.429878870047574e-02   +1.030356497877703e-01   +8.570572024267557e-02   +8.403422882521985e-02   +1.921651297930647e-02; +1.229263501499412e-01   +2.655632235270609e-01   +6.846120646968888e-02   +4.313787111460052e-02   +2.552210568469767e-02   +1.705284491789152e-01   +1.718089895467304e-01   +1.741771378425274e-01   +7.449127882306879e-02   +1.551443795780565e-01   +2.377337051416630e-01   +1.769366534229881e-01; +1.138219113148772e-02   +1.932384026432646e-01   +1.481271194946723e-01   +1.857342269182443e-01   +1.506643535538035e-01   +1.426701435438695e-01   +1.592855518745123e-01   +1.429318442486076e-01   +1.149360495881353e-01   +1.771268487587335e-01   +1.447542488946873e-01   +1.718887140344762e-01; +1.229668985672837e-01   +2.316740625787704e-01   +1.995194937333952e-01   +1.361262794588527e-01   +1.407560250157766e-01   +2.767322814259680e-01   +2.398910504110613e-01   +3.878363697935250e-02   +2.929619344183417e-01   +2.847634830755314e-01   +5.133277502870046e-02   +2.357002698118776e-01; +3.667496092226495e-02   +1.086095302597101e-01   +6.772926494581107e-03   +2.658055328559085e-01   +2.409552282559531e-01   +1.725085031400229e-01   +3.018446624682122e-01   +2.087935517677944e-02   +2.787053500421144e-01   +1.819712755990953e-01   +1.181707332985160e-01   +3.626845122266189e-02; +1.079168702976959e-01   +2.118875173113252e-01   +2.603069741614049e-01   +1.339471009804895e-01   +3.095740837588038e-01   +6.775286797098717e-03   +2.824974723477351e-01   +8.440874780643638e-02   +2.130747950680872e-01   +8.924531932175924e-03   +1.065578114832256e-01   +4.806158467593670e-02; +2.530545559891434e-01   +1.125322181771409e-01   +1.227434553737542e-01   +8.738374210214792e-02   +2.066044505165092e-01   +6.352999070037653e-02   +1.732342399757970e-01   +2.903189648434288e-01   +2.636858338676438e-01   +3.065303132542342e-01   +1.659391130023661e-01   +2.280787403187539e-01; +2.328809150760804e-01   +6.654950869325564e-02   +2.255808849558413e-01   +1.864236813858680e-01   +3.072800583531298e-01   +1.858017621282277e-01   +3.353917677116518e-02   +1.572552531013335e-01   +1.401541897786650e-01   +9.435731025507073e-02   +7.637940243943217e-02   +2.967534372943959e-01; +2.997722372877211e-02   +2.668755312841683e-01   +2.290782498665577e-01   +2.563155785371685e-01   +1.167949986162777e-01   +2.306200695408856e-01   +5.528796689033896e-02   +2.470776941821184e-01   +2.619065840145674e-01   +1.450544346599663e-01   +6.596547707609876e-02   +7.394714240477018e-02; +2.890962267413297e-01   +2.464112097048860e-01   +1.230937617745169e-01   +7.063611338566193e-02   +1.811447491039735e-01   +2.454203667095962e-01   +1.592999017436569e-01   +2.760695182664284e-01   +2.111730943721788e-01   +1.033469878081851e-01   +2.785976910777845e-01   +6.763117158046660e-02; +1.379184240604669e-01   +1.091686320808870e-01   +3.104728278780498e-01   +2.994646049624246e-01   +4.857026861874976e-03   +1.954938314454398e-01   +2.443302858317196e-02   +7.543486232042261e-02   +1.443738796865873e-02   +3.036590506297751e-01   +2.342091897030983e-01   +1.132733645201529e-01; +3.088772601275342e-02   +5.443477487907212e-02   +1.452334559106684e-02   +1.395479285792822e-01   +1.354392292978829e-01   +7.393536035218252e-02   +2.486917471742482e-01   +5.561304759186446e-02   +1.029325688008777e-01   +7.540396853763436e-02   +2.409418118178684e-01   +8.996695888255965e-02];
L3E_L3I_iGABA_netcon = [+5.697225645341926e-02   +1.453161474954075e-01   +1.033556885044720e-01   +2.864470100157241e-01   +2.588554240785317e-01   +1.700452988933135e-01   +9.869427055619673e-02   +2.358133293484736e-01   +1.987794647984963e-01   +2.304918234216270e-01   +1.918986224965506e-01   +7.491042293793558e-02; +2.438054971248652e-01   +2.000370630581692e-01   +9.450043280224048e-02   +7.740000972836994e-03   +1.175542822703495e-01   +2.217299474414574e-01   +2.046068625258396e-01   +3.073965376424916e-01   +2.650456312601224e-01   +1.417882030712280e-01   +3.425193019534917e-02   +2.586871487102871e-03; +1.827012420913247e-01   +3.002105193202705e-01   +2.993175954361325e-01   +2.629885822011808e-01   +7.401495523697206e-03   +2.352239844372706e-01   +1.808126363396995e-01   +2.199679363141274e-01   +1.282005960605853e-01   +1.299690247733857e-01   +8.504044286713637e-02   +4.528714197502141e-02; +1.327647999837593e-01   +2.003117746163862e-03   +4.472654009070085e-02   +2.257360201348662e-01   +2.263077717302981e-01   +8.180773140519688e-02   +1.316170543306501e-01   +1.192307022119476e-01   +3.104040680132732e-01   +1.438543334216963e-01   +1.206838755226325e-02   +1.851717746026565e-01; +1.361863288610907e-01   +1.240006329657334e-01   +3.100580401457814e-01   +8.757700449200899e-02   +1.703576528455711e-01   +2.402840709023746e-01   +3.074594331480488e-01   +2.916927922142214e-01   +8.104872206522550e-02   +1.791918626548921e-01   +2.614009918488381e-01   +2.144710423962649e-02; +2.142011905556318e-01   +1.490808695293184e-01   +2.641635959142670e-01   +2.963463920535850e-02   +1.487211845587118e-02   +3.123536940899080e-01   +2.859674382276998e-02   +2.186069657353255e-02   +2.577081491233061e-01   +1.906984648732954e-01   +8.346281480052697e-02   +6.763042652740170e-02; +1.811882922967242e-01   +1.129489304982279e-01   +1.524078199569150e-01   +1.839559477238917e-01   +2.164427625293466e-01   +1.476295940412413e-01   +1.054247780683596e-01   +9.658836089516015e-03   +1.094549431620927e-01   +5.217877069729809e-02   +9.644560230441165e-02   +2.264872075865718e-01; +9.722528688230925e-02   +4.910956406152645e-02   +3.973712225080596e-02   +2.850009234911945e-01   +1.373789478088616e-01   +2.379860383138398e-01   +1.639512890001492e-01   +2.405534670003588e-01   +2.424626047102953e-01   +2.664360374785591e-01   +5.146053149868904e-02   +1.800930618377098e-01; +8.996891419070277e-02   +5.860625231091397e-02   +2.433297479210077e-01   +1.098008961056357e-02   +2.962839209643761e-01   +2.821686255329286e-01   +5.726974955763512e-02   +2.214112788337623e-01   +7.250720002737338e-02   +1.313770040550456e-01   +1.295995392317463e-01   +1.933428969293498e-01; +2.553954276648352e-01   +9.965692507446983e-02   +2.624822208522711e-01   +1.031126581098665e-01   +1.130298928454937e-01   +3.076852279780467e-01   +2.369843956537367e-01   +1.769621763557704e-01   +2.918670250407910e-01   +3.039914051335919e-01   +5.432170678775442e-02   +1.241216655276316e-02; +1.766857291451826e-01   +4.614114641889250e-02   +6.393668332057253e-02   +5.901236254684456e-02   +2.440790699737622e-01   +1.589987322000836e-01   +2.726329032296224e-01   +1.921651732430320e-01   +1.772125932134531e-01   +5.401062279717739e-02   +2.877086078061886e-02   +2.533781798488483e-01; +1.982795765658033e-01   +1.588261906637847e-01   +3.115054354340099e-01   +2.238927427931428e-01   +9.029919683212885e-03   +1.588537168847613e-01   +3.044109668323632e-01   +1.979748934800655e-02   +2.438512973806654e-01   +1.249246413684908e-01   +1.448701857528684e-01   +1.371963072314783e-01];
L2E_Input1_iAMPA_netcon = [+3.123565520240059e-01   +3.151393518060351e-01   +3.120687715038504e-01   +3.144196527742233e-01   +3.172789824986754e-01   +3.191875890859733e-01   +3.178355348751348e-01   +3.108581474132936e-01];
L2I_Input2_iAMPA_netcon = [+3.168059603111956e-01   +3.179890816564113e-01   +3.175212573265792e-01   +3.120594602667348e-01   +3.141418231731365e-01   +3.140998538096527e-01   +3.167257422130970e-01   +3.153940082305013e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
