function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.765516736178182e-02   +6.213769294155835e-02   +1.667042249911455e-02   +1.237722311840287e-01   -2.559427125099914e-02   +2.562436363937877e-02   +4.477052863739468e-03   -2.919086776259998e-03   +2.872266828893806e-02   -6.080169575230172e-03   +7.708420712805861e-02   -1.121637337135621e-02   +1.817421487374310e-02   +1.007533092566297e-01   +4.806002998007008e-02   +8.839199442396242e-02; +3.135773416260496e-02   +4.703932329902760e-02   +9.418889290298707e-02   +8.017155196721563e-02   +1.125067240818580e-02   -3.056150498889831e-02   +7.509296381858019e-02   -1.864759335090884e-02   +1.033255452836921e-01   +5.632874008494923e-03   +6.390709009717617e-02   -3.641785827853336e-02   -1.017928596313849e-01   +2.865884745701005e-02   -5.756723827958467e-02   +3.352148038431820e-02; -4.309277725707116e-02   +6.378221793059456e-02   -2.414700149189293e-02   +6.476907715095268e-02   +4.473179775827218e-02   +1.333293458995008e-02   +3.673455927739362e-02   +7.968362914869198e-02   -2.215859205918721e-03   +4.491156359959844e-02   +8.146533678982762e-02   +4.653425509960699e-02   -2.515501165179562e-02   +3.976241449323847e-02   +8.011793167116332e-02   -1.918496358242121e-02; -3.727894672455500e-02   -2.973429287203233e-02   -4.709276238952097e-02   +1.334609711803176e-02   +9.150662549765663e-02   -5.509686704955812e-03   -4.307793582342877e-02   -9.115663221820992e-02   -3.648267218156660e-02   +4.175469475435002e-02   +5.577350890592452e-02   +3.710030359487709e-02   -4.242394649673513e-02   -3.059338291009214e-02   +8.286566207284672e-02   +2.429260109304720e-02; -8.441220449297822e-02   +1.165954307450382e-01   -4.907315696213662e-02   -8.369976500826624e-03   -5.081816944048415e-02   +6.463394497312636e-02   +4.865471028351799e-02   -2.438553085247457e-02   +2.544515647959042e-02   +1.568396976933948e-02   +3.937295990911343e-03   +5.326991048257936e-02   +2.511714792731382e-02   -1.160226705862621e-01   +7.606186538691686e-03   +8.496108825081880e-02; +5.693671311395941e-03   -1.225891206844424e-01   +1.576839309018508e-02   -8.261385123073373e-02   +1.347126432429938e-02   +8.004250106930975e-03   +7.003805711490506e-02   +9.954119068364377e-02   +6.679018815385940e-02   +2.444903681800816e-02   +1.469892814058591e-02   +2.467078791403566e-02   +2.873304854152366e-02   +5.595146708645780e-02   +4.376461094419293e-02   -4.058614201238175e-02; -6.572470850934605e-03   -2.645243249177655e-02   +4.296350769044451e-03   -1.455522718235766e-02   -4.356414986779071e-02   +4.650546496416585e-02   +7.462412805891498e-02   +7.523570719432507e-02   +1.022085344034617e-01   -2.929194930659568e-02   +1.191546901751943e-02   +1.996222066581597e-02   +2.884753074050325e-02   +6.318222122138334e-02   +9.575271076142262e-04   +3.096409008558279e-02; +3.680363926847194e-02   -2.811770377820843e-02   +6.974332552278498e-02   +7.910528685208346e-02   -4.845301322143371e-03   +7.362383339989412e-03   -8.455489464767870e-03   +1.157519103103436e-02   -7.071245418926519e-03   -2.713342800763030e-02   -4.096434899971912e-03   -6.947525174324339e-02   -1.721532012625461e-02   -1.539726481436948e-02   +9.495153257591808e-03   +2.405316302351033e-02; +3.230726854996012e-02   -2.214013185002421e-02   -4.481516272645785e-02   -6.767821298742069e-02   -2.735414869597814e-02   -9.779494694328451e-02   +9.062247419178010e-02   +4.601342478742929e-02   +7.320438555014050e-02   +1.319914450083642e-02   -1.141961000863981e-01   +5.872889482362599e-03   +4.457804301916499e-02   -8.483272887373704e-02   +1.014311996028936e-01   +4.218586444614352e-03; -1.468483082938778e-02   +5.173634644402593e-02   +3.613966826065448e-02   -9.161016121316647e-02   -2.739086411763299e-02   +5.413010329946213e-02   +1.962654126446094e-02   +4.806437775154759e-02   +4.223673397860930e-02   -4.505754291019375e-02   -2.734964785615306e-02   +3.395801824745702e-02   +3.431419627837311e-02   +2.170998119125642e-02   -3.686878203836642e-02   +6.512961404416762e-02; -2.614278522294830e-03   -7.268881298032509e-02   +2.904259537177337e-02   +7.950081939973483e-02   -5.272279586102850e-02   -6.223081173660714e-03   -9.015924391879100e-03   +1.785052475987601e-02   +1.754934242119582e-02   +7.484378279321729e-02   +2.593733583045427e-02   -5.068990809040774e-02   -2.562150276700306e-02   -1.594099023998861e-02   +8.381839346011544e-02   +7.289434889278368e-02; +3.635976799792082e-02   -9.694962113697717e-02   -6.956643242854390e-03   -2.358704187869117e-02   +5.092333984306234e-02   +2.251163918998882e-02   -2.028317502346856e-02   +5.669672203928426e-02   +4.684115256289249e-02   -2.547046023408188e-02   -4.108050963066113e-02   -4.985228311465364e-02   -9.096764750874146e-02   +5.640343102293317e-02   -3.095190585376767e-02   +3.405975515883769e-02; +1.172950683396810e-03   +4.027490076359987e-02   -7.958449963121658e-03   -7.816214052014928e-02   +1.526411146654184e-01   +5.247101466615949e-02   -5.290379806368838e-03   +6.481684155254164e-02   +2.552631827026918e-02   +2.751317596020809e-02   -5.990090695881713e-02   -6.521233619592974e-02   -1.791713596404090e-03   +1.349551944447650e-01   +7.196506741264555e-02   -5.449261474337821e-02; +8.972955532839321e-03   +4.608681319818164e-02   +7.842616464530500e-02   -1.971810915532648e-02   +4.332699247749948e-02   -2.668059059727403e-02   +2.086302630202846e-03   +3.679240546563391e-02   +2.823137404489418e-02   -2.842994829930227e-02   -3.602049021553255e-04   +6.172351259498640e-02   +7.628344006277005e-03   -1.316237330769585e-02   -7.385709576469759e-02   +4.458964063825505e-02; -5.209298008863125e-02   -2.069657509952916e-02   -1.530600954386322e-02   -3.869276431569264e-02   +7.597915925424720e-02   +4.371665703135188e-02   -5.531103412604867e-02   +1.432210636867580e-01   +7.742639506097417e-02   -2.812237386785789e-02   -7.047292401773173e-02   -2.162540026390396e-02   +1.946455702356770e-02   +1.160771921002457e-02   +5.807036224608110e-02   +4.716066746837421e-02; +2.933824558409715e-02   +1.456606533281750e-02   +7.643073901543167e-03   +2.643318134905017e-02   +1.004615179437562e-03   +1.607602077090729e-02   +4.496275693542634e-02   +8.372808670056464e-03   -2.802589389913573e-02   +8.293541750827853e-02   +1.060742557478299e-01   +6.876064843867870e-02   -9.482125979690841e-02   +1.000096569806115e-01   +8.435269822226084e-02   -1.120513490785078e-02];
L1E_L1I_iGABA_netcon = [+6.788535369234444e-02   -8.948672390417373e-02   -1.750223353524775e-02   -7.174301764895125e-02   +1.410088702197873e-02   +2.698748404938360e-02   -3.488535898559172e-02   +1.806274470582823e-02   +2.480738341680585e-02   +6.262582847252647e-02   +7.855187053639219e-04   +4.142327996236456e-02   -3.296958582844260e-02   -1.010228957981893e-02   +1.500465482476458e-03   +5.372869943273574e-03; +4.472351093621323e-02   +1.031900009108336e-01   -3.252643354457738e-02   +5.412845273078459e-02   +3.680407607413397e-02   -6.925531940706192e-02   +4.393119206301541e-02   -7.449939808510306e-02   -4.868149479766402e-03   +1.352628233118422e-02   -2.338599839806611e-02   +6.810778027895098e-02   -3.899226089745203e-02   -6.959736655262994e-02   +7.841524977745687e-02   -4.485485760945913e-02; +3.977963584916756e-02   +1.876546260753216e-02   +5.232527466303492e-02   -2.291787777526176e-02   -3.216357893853856e-02   +1.368474186480535e-01   -8.052928010408493e-02   +4.661762974796542e-03   -5.784575761217162e-02   -1.817787806650542e-02   -2.413866294590533e-02   +7.091461426499254e-02   -1.512806055556226e-02   +1.810794477000703e-02   +3.618632360269123e-02   -1.070461645013870e-02; -4.275619314550831e-02   -1.008098219397045e-01   -1.110950694451547e-02   -8.462795178083765e-02   +8.025105574686775e-02   -1.193710777733342e-02   +5.690340479149950e-02   +6.571781520504126e-02   -5.687681856998540e-02   -8.315204484168611e-03   +1.373272386423359e-01   +1.644130911956984e-02   +9.512272161071747e-02   -4.271321510870295e-02   +3.714065819292608e-02   +3.141527240627545e-02; +7.637335508141535e-02   +6.939354096962140e-02   +2.631842461415256e-02   +1.529119855718040e-02   +3.970558105923769e-02   +1.651409798607457e-02   -5.448121058385292e-02   +5.132291620605633e-02   +3.652191705033785e-02   +4.342092175841741e-02   +3.302992944235048e-02   +1.436884815263559e-01   -3.734263252024591e-02   -8.629543277159427e-02   +7.386655110166970e-02   +1.314487751709539e-02; -2.140528349168457e-02   +6.754931370149213e-02   -7.429615071670487e-02   -5.215344891772546e-02   -8.394263911247858e-02   -4.982877210763375e-02   -2.274115090851268e-03   -6.595816546592799e-02   -3.124882229176641e-02   +8.450652554982070e-02   -1.083725906819530e-01   +6.459893587102345e-03   -1.076937082654640e-02   -1.852231817510754e-02   -3.267954609410305e-02   -5.449710104555297e-03; +7.890396987987849e-02   +8.487111973331360e-02   +1.700657092902808e-01   -8.196136761841227e-02   +5.205315597020626e-02   +1.526345810165940e-02   -1.714939888564597e-03   +9.167647458393986e-02   -3.520729586995478e-02   +2.394893080311384e-02   -4.021808983432917e-03   +1.886320998075792e-02   -4.242101156064802e-02   -6.366516045727852e-02   -5.046190069959655e-02   +4.725806610087094e-02; +5.420131635187331e-02   +1.142305200160573e-01   -2.018571170312470e-02   +1.278636419783907e-01   +9.758774558907388e-02   -8.489743386942405e-02   +6.148076447382257e-02   +1.881297208317004e-02   +5.294617698988234e-02   +3.075312970399098e-03   -8.810285388747613e-02   +1.102683192880564e-02   -3.888723813822428e-02   -3.814034475076367e-02   +3.089249350285397e-02   +2.430432108940225e-02; +3.632340775225079e-02   +1.153333173228547e-01   +1.221907374087942e-03   +1.808457328628295e-02   +1.057022061196817e-01   -5.515790141691124e-03   +2.887164751930779e-02   -1.468382547963210e-03   +3.775510943328936e-02   -3.999875911706256e-02   +3.503676200521059e-02   +2.290924899887782e-02   +3.245718339158713e-02   +5.147563632976386e-02   -3.750283881436653e-03   +7.987646500290199e-02; +8.478608009043133e-02   +7.138506183154372e-02   -8.520743706453585e-02   +5.470074960448183e-02   +3.301015225849434e-02   +1.129522199047947e-01   +2.574692922911104e-02   +1.670131265714278e-02   -8.686224209492971e-03   -2.194900529407044e-02   +4.836561489101786e-02   +3.948605589449683e-02   +2.926159394138491e-02   +1.029474420973967e-01   -4.878432376312936e-02   +1.177045308884572e-01; -4.189823177792636e-02   +6.672037541232420e-02   +1.827837384175294e-02   -1.747860560210572e-02   -2.681413172850763e-02   -1.168343501375737e-02   +2.920335932580972e-02   +2.124894436612392e-02   +2.634038766128802e-02   +8.927236318448717e-03   +4.263667374891289e-02   +8.367947255649404e-02   +5.031209604565241e-02   +2.465341405047110e-03   +2.256678767108824e-02   +5.209161726638722e-02; +3.473541337874636e-02   +4.911925637302514e-04   +1.254939778927297e-01   +8.544851037938782e-02   +5.889505152556192e-03   -3.095913420241262e-02   -4.344574156546974e-02   +5.832055474942929e-02   -3.098086589182678e-02   -6.071599868264230e-02   +9.880736257987756e-02   -4.650424859450800e-02   -2.389859559066753e-02   +6.079497836165763e-02   -7.663761930841846e-02   +2.324188614661905e-02; -1.058497521719994e-01   -6.431891431359772e-02   +2.127741182997890e-02   -4.084665309609206e-02   +3.021369741377967e-02   +4.904565148692863e-02   +9.269306315912258e-02   +2.765140386937863e-02   +4.319360370148635e-03   -4.761282204834034e-02   +2.565943040925195e-02   -1.407346837407459e-02   +2.116608831847207e-02   +1.266345852453788e-01   -3.187462968090909e-02   +3.741467911048820e-02; +1.099408056452309e-01   +2.910229842517720e-02   +3.624677010798887e-02   +6.951301159480578e-03   -1.095274805119945e-01   -8.712592872443511e-02   +2.891080838515964e-03   -5.380450810244586e-02   -6.719448351073215e-02   +5.429695513999686e-02   -1.381733349021905e-01   -5.485748851937398e-02   -4.866704165602984e-02   +5.657071659386002e-02   -9.263490543149065e-03   -1.162081419213441e-01; -4.120300887693520e-02   +2.940779242176941e-02   -7.303027645421367e-02   +1.027855867367894e-01   +2.344806077855953e-02   +4.742197688654588e-02   -2.775817673206788e-02   -2.759559304427277e-03   +2.829493008226898e-02   +1.102439305925246e-02   +1.762672831818487e-02   +7.686620459171165e-02   +6.025942243128269e-02   -7.245744062664491e-02   +1.436752170082283e-02   -7.243075059033796e-03; +9.737535235057135e-02   -2.530711283936588e-02   -1.057413186063886e-01   +7.699078258939009e-02   -2.116707290049317e-02   +1.107451423645122e-01   -1.315587850713918e-03   -4.734941079454304e-02   +5.178904388734812e-02   +2.333809024318548e-02   -9.584407490884976e-02   +1.076411236902724e-01   +7.186140679172245e-02   +9.220108443829517e-02   +4.431246268397915e-04   +7.083200257043190e-02];
L2I_L1I_iGABA_netcon = [+1.183767881076698e-01   +4.417291055027085e-02   +4.165442578686805e-02   +1.752840912597783e-02   +1.487852899849327e-01   +1.107142980717227e-01   -2.962954078664300e-02   -1.191005667223742e-02; -5.822535994888495e-03   -1.978033000937973e-02   -5.894393317032373e-02   -3.997413992440339e-02   +3.743895511435066e-02   -1.085309517538630e-01   -5.527562241098873e-02   +8.642814694374940e-02; -9.233700509982193e-03   -1.108170386794509e-02   +4.585261834027640e-02   -7.697214729870949e-02   +3.945816644318822e-02   +5.038154899246926e-02   -9.458733494054770e-03   -5.292302670332511e-02; +1.076674667374305e-01   -2.414766834229365e-02   -1.961226663838990e-02   +3.938488964772118e-02   -8.397035694663857e-02   -3.298033503257047e-02   +1.356877987043198e-02   -6.990785690589570e-02; -2.742807379186189e-02   +7.541210558960221e-02   +8.165160577016312e-02   -7.448151662598837e-03   +7.258417760401915e-02   +9.596583473374484e-03   +9.692693275429716e-02   -5.571906837043252e-03; +8.793777098044981e-03   +7.484809098939427e-02   +1.319326578970347e-02   -4.393506796412455e-03   -6.491990426537027e-02   -2.443811799057265e-02   +2.525389100173320e-02   +5.016653694188693e-02; +4.623918129556848e-02   -5.412820868192965e-02   +3.029719352399898e-03   +1.450934992542124e-02   +3.967652377445048e-02   +8.953087434190869e-02   -2.019444503310501e-02   +3.703888629128708e-02; +1.588356345696838e-03   -1.838269270624074e-02   +1.165518204443203e-03   -2.253591770845813e-02   +1.362225554354776e-02   -1.329884313337842e-01   -7.703487594718678e-02   +8.339382663637861e-02; -5.429883346458943e-02   +6.463512042868313e-02   -2.827307719102462e-03   -2.803941859013307e-02   +2.869840084628716e-02   -1.495452143091403e-02   -1.750442410603145e-02   -5.862447138645475e-02; -3.278677081470531e-02   +8.122430737980241e-02   +3.037073133180161e-02   -2.937415106375495e-02   +5.342337927066804e-02   -1.366509784305912e-02   +1.340803708455324e-02   -2.932585628229769e-02; +1.115989381606630e-01   +5.766833056375213e-02   +2.680374697010188e-02   -3.682509603565207e-02   -4.112199168065542e-02   +1.172842769411076e-01   -6.162252282925287e-03   +1.374290042484105e-01; +7.137326103338777e-02   -3.802447823089670e-02   +3.532902403404103e-02   +2.831352227286134e-02   +6.127299962014159e-04   +2.847793284449771e-02   -9.763095329290591e-02   -6.253743033041066e-03; +3.094786392781904e-02   +6.688726429639147e-02   -2.948380453111748e-02   -6.383581257959703e-02   +3.022202935946335e-02   +3.369496151201697e-03   -3.864481355724422e-02   +5.307894596483163e-02; +1.937813179564388e-02   +1.909213212185124e-02   +9.395459969461395e-03   +6.780834233516457e-02   -8.310778629656021e-03   -4.527122813243606e-04   -7.096957336396120e-03   +5.720326975952136e-02; +2.910486082054381e-02   -1.960518253762638e-02   +3.664178166861758e-02   +9.688828437211183e-02   +5.974406562812864e-02   +4.179465044749923e-03   -2.533278772878437e-02   +5.244595380752554e-02; -2.971964089943704e-02   -1.074847102769794e-02   +5.159033723186519e-02   -2.898024044039760e-02   +5.340323738617516e-02   -7.224460475148262e-02   +4.881391980795337e-03   -1.000169059992386e-02];
L1I_L2I_iGABA_netcon = [-2.337405147778185e-02   -3.316368017867692e-02   +1.012687822003046e-01   +3.035756902120921e-02   +1.317715122149630e-01   -8.300499830198513e-02   +8.549577000806327e-02   +3.452384490017316e-02   +1.578620279772558e-02   -8.489386954091838e-02   -6.080882608017579e-02   -1.875400837594074e-02   -2.719750953552431e-02   -7.478486801360332e-04   +4.681158191857592e-02   +4.849219308029323e-02; -3.312455904864368e-02   +4.099093608690758e-02   -5.448170288355775e-02   -2.686417218961228e-02   -5.640411681949871e-02   -8.253887677543639e-02   +2.170990414288590e-02   +3.817047888840319e-02   -1.602565194122915e-02   -3.856080199316388e-02   +5.929371593547304e-03   +7.147827800233489e-02   +3.565450263835994e-02   +4.007838173289707e-02   +1.034394184794458e-02   -2.308872505907011e-03; +6.380086871197442e-02   -1.027164430432791e-01   -1.362896754624703e-02   +2.921081454878391e-03   +8.699004526066013e-04   -7.502004182518321e-03   +6.813568872296898e-02   +6.888944808282046e-02   +1.951561185445457e-02   +6.544142841755805e-02   +8.423078371084212e-03   -2.825385520936815e-02   -7.787347895088763e-02   -1.871021137012070e-02   +6.260964179347854e-02   -4.379574121000426e-02; -5.238868430709566e-03   +1.419341810832330e-02   +4.773502543569978e-02   +2.213922275896126e-02   +3.487114759885297e-03   +8.302958473638913e-02   -1.736742520407789e-02   -1.322484104801067e-02   +7.448024445532188e-02   +2.334040438015412e-02   +4.429059276403283e-02   +6.889612201944090e-03   -7.054938275904782e-02   +3.434655040122317e-02   +1.136188478547995e-01   -2.376408073184974e-02; +2.051956380513289e-02   -3.950632694398083e-03   -7.038746590165786e-03   -7.886009372885790e-02   +1.457921724116824e-01   -1.062830546257925e-01   +2.977582330130706e-02   +7.739885525392520e-03   +3.853608716507200e-02   +5.167633159500813e-02   -6.509065494061395e-02   -6.037527781080692e-02   +1.105086068463735e-01   -7.631409499747435e-03   +1.131048265790237e-02   -9.779355858091104e-02; +9.223097100994382e-02   -7.517131757840514e-02   -2.286470958758291e-02   +8.797499809013198e-02   -8.888272003118765e-02   +1.012356375520243e-01   +3.679008356747713e-02   +2.656720323815670e-02   +3.117325555143310e-02   +5.096641563068892e-02   -5.189826431497541e-02   +8.723083705921009e-02   -1.008942238215008e-01   -6.604645227025301e-03   +1.709462482560405e-02   +4.095026917171157e-02; +3.877450798428018e-02   +3.719311762444247e-02   +1.644766260998894e-02   -5.316683848005509e-02   +6.301016378109578e-02   +4.763463790391076e-03   +2.869406116326219e-02   -1.134763679490505e-02   +2.179198923802542e-02   +5.323751557509167e-02   +6.881919654531116e-02   -6.198896604472108e-02   +2.176781295820164e-02   -4.572175411617354e-03   +7.312072644684307e-02   +2.521025428978559e-02; -8.187694492068867e-02   -3.780325042425676e-02   -4.529172805998312e-02   -9.055873418893073e-02   +4.194517158830347e-02   -1.029148644022462e-01   +2.644937509335518e-02   +2.858107226642569e-02   +2.532161256942768e-02   -5.822613920549343e-03   -5.098775072518083e-02   +4.405119163902975e-02   +2.640384308928055e-02   -2.400432293442677e-02   -2.393792756109929e-02   +2.302382501549372e-02];
L2E_L1E_iAMPA_netcon = [-5.179069329832147e-02   -7.562921755483501e-02   -1.053162029152730e-01   +3.218721251619380e-02   -5.061949987966893e-02   +7.553857754463858e-02   +3.580843501749075e-02   +3.362449560191946e-02; +6.120804375070742e-02   -1.870380679932376e-02   +4.431109201168433e-03   -1.994997841265017e-02   +1.328104261052684e-01   +2.124147655091060e-02   +1.319953655470356e-02   +1.768500671262777e-02; +5.570103413290200e-02   +7.673711270804391e-02   -2.890915936478494e-02   +2.151530804861848e-02   +2.111633433088234e-03   +3.790464269309823e-02   -9.794925561949247e-03   +4.809675662418359e-02; -7.400187283536795e-02   -2.734984862139972e-02   +7.703631819840057e-02   -3.725193612528103e-03   +1.888127137927609e-02   +9.743330310502336e-02   -2.825396323430832e-02   -7.354063907003669e-03; -4.785469243579395e-02   +1.126088082894508e-03   +1.348556086464749e-02   +1.939285463094936e-05   -7.059649728164724e-02   +6.703720638404453e-02   +3.594668455676057e-02   +3.111527755805326e-02; +2.747688819981271e-02   +1.382498262883072e-02   +3.790008879854082e-02   +1.016139883709325e-02   +1.317926891359871e-01   -2.219034379675998e-02   +7.985641323526790e-02   +1.233574352829851e-01; +5.820105710465376e-02   -5.470614539366821e-03   -5.560598094159976e-02   -2.934454898858349e-02   +3.759211033056948e-02   -2.607349574159760e-02   -2.717905535793466e-02   +1.876504690495657e-02; -3.514718280889791e-03   +3.812911920822341e-02   +6.463926599775545e-02   +5.137953475819659e-02   +6.190170934774702e-02   -3.333380299429566e-02   +1.389424328703679e-03   -4.291301275401035e-02; -2.613092531925588e-02   -3.053087507789358e-02   +1.818362363672609e-02   +6.028085591918650e-02   +9.318793240932485e-02   -5.345040581757814e-02   +3.805350391592843e-02   -9.316914615860397e-02; +7.996289627810062e-02   -1.476769134996655e-02   -6.974504502381549e-03   -7.367231300180610e-02   -3.514112719037681e-02   +7.461611190621135e-02   -5.664605476025006e-02   +6.455544717270587e-02; +1.089687269956207e-02   -3.469298558001475e-02   -3.969413623261211e-03   +2.288764854185063e-02   +8.403168465083968e-02   -1.031361312647160e-01   +5.844671979919035e-02   -5.026413873816293e-02; +8.834852423419297e-03   +3.165032005339422e-03   +4.268494607066137e-02   +1.447034969048697e-02   +3.228563236456015e-02   -1.348106066193422e-02   +5.075394049454431e-02   +9.452384859334889e-03; -3.204945887932940e-03   +3.740756260620071e-02   -3.192894020923751e-02   +6.714578485563305e-02   +4.817554915381519e-02   +1.442457733595063e-02   -5.462045024511535e-02   +1.393470699532990e-02; +2.663214441074166e-02   -5.967634327570829e-02   +9.400570959023424e-02   -3.510842948088543e-02   +2.672956790223837e-02   +3.657215111759184e-03   -2.566638637142366e-02   -1.066986620663199e-01; +9.917467029039650e-02   -2.006344145697396e-02   +4.115333348084591e-02   +2.255964373723744e-02   +2.698372582795945e-02   +3.086025804552689e-02   +3.888513870522407e-02   +5.941451137280666e-02; +1.353196804245516e-01   +5.196281714464034e-04   +9.480578508966503e-03   +2.666642116593284e-02   +2.613328265188401e-02   -1.043044346221667e-02   -4.148697925051137e-02   +1.003155193105489e-02];
L1E_L2E_iAMPA_netcon = [-5.064940378398486e-02   -9.403874234607972e-03   -1.298755033600960e-02   -2.027848647432930e-02   +1.154260129362818e-02   -1.593549273414023e-02   -9.459524222274729e-03   -1.177638993037266e-02   +1.968838746473126e-02   -6.693478291495288e-03   -5.846182525645373e-04   +6.171696906090408e-02   +4.964309482905761e-02   -1.826734486285121e-02   +4.574683022727066e-02   -3.697894370722809e-02; -4.851395580900148e-03   +1.234598456454977e-01   -5.175805608517007e-02   -2.543604134934108e-02   -5.459893926957792e-03   +1.393255556611373e-01   -6.572271288786127e-02   +6.710568119344022e-02   -1.122894476090119e-02   +3.328977826909829e-02   -5.840280175842390e-02   +3.593819499167122e-02   -4.259935209558519e-02   +2.196739777898621e-02   +6.969778878562971e-02   +6.050415830071434e-02; +2.904079168096309e-02   -4.319244721994262e-02   +3.341775432407638e-02   +2.157848751202348e-02   +1.059778407819784e-01   -7.019947160503800e-03   -3.527108580698584e-02   -2.914441415637466e-02   -4.181284267186017e-03   +3.213321828315161e-02   -2.964556495515612e-03   -3.165895361474599e-03   -5.536243513369457e-02   +2.146540041940613e-02   -5.862156990995342e-02   +1.543734654673803e-01; -4.480794492597643e-02   +6.843835853962058e-02   +4.399830323013380e-02   +9.127855875650956e-02   +9.291593095853573e-02   +9.118438014078428e-02   -6.124869430567845e-02   -1.038178378211694e-02   +6.856893320417914e-02   -3.276287144123330e-03   -3.062219961072619e-02   +5.241163318023883e-02   -9.905740383918760e-02   -9.862006344980113e-03   +9.215891789355476e-02   -6.126524700449090e-02; -1.206636959273003e-01   -1.325006624321531e-01   +3.116046638219742e-03   -5.389400118404337e-03   +5.148111865905194e-02   +5.775589800177627e-02   +9.491885141360190e-02   -1.918279698370409e-02   +2.931053800880820e-02   +4.099869294921014e-02   -5.652573928075817e-02   +1.561337898972963e-02   +1.048260495960156e-01   +1.379458442222965e-02   -5.063434453316482e-02   +8.601345132614187e-02; -7.457426196832031e-03   +7.002845598394691e-02   -2.103712231940041e-03   +4.253143303621985e-02   +5.635657375889493e-02   +1.006429682822203e-01   -6.321248165254158e-02   -2.707697984306335e-02   +5.288759162379847e-02   +2.596899801915132e-02   +5.449135136249530e-02   -6.760365682025107e-04   -8.331845973637715e-03   +7.787620490910382e-02   +6.665594674255335e-02   -6.757891751414828e-03; -2.938242015897365e-02   +1.736534589611251e-02   +6.354953466830217e-03   -6.217081994341633e-02   +3.327655480465786e-02   -4.571258732010102e-02   -1.142506795796823e-02   +6.368786267551917e-02   -1.416372502641445e-02   +1.153117135508154e-02   -1.072048585330446e-01   +2.706925649239562e-02   +1.696990060932493e-02   -2.864920184274115e-02   +5.295659914927116e-02   -6.978007516182452e-02; -4.287189483010505e-02   -7.659896488382172e-02   -5.044443335250429e-02   +3.760948769475016e-02   +5.498178250080650e-02   +4.565792966049921e-02   +4.848611429897957e-02   +4.850622855009958e-02   +4.671690293469648e-02   +2.184249464880275e-02   +1.022451989744376e-02   +2.727361446271184e-04   -6.159027977408668e-02   +4.631297802369114e-02   -2.542329283777460e-02   -1.598773883675669e-02];
L2I_L2E_iAMPA_netcon = [+4.769757065756748e-02   -5.238078279415304e-03   +8.392578584218235e-02   +4.862430581179251e-02   +8.627392607741377e-03   -3.283504630265598e-02   +8.262682064230503e-04   +3.332105202057199e-02; +3.014374427569411e-02   +5.661255405128231e-02   -3.061405766294935e-02   +8.493498963585477e-02   +4.545326802198682e-02   -7.519287309934559e-02   +5.541651912277309e-02   +1.361051817006702e-02; +5.538406639326556e-02   -6.347609038787476e-02   +6.214030733858368e-02   +2.890821370401946e-02   -1.028084535326240e-01   -8.334263602411746e-02   -4.712736109216201e-02   -1.302721661711668e-02; +5.875763534847285e-02   -9.597125441910076e-02   -9.210476127630642e-02   -1.362369976473815e-01   +1.870288178265948e-02   -1.413848082992316e-02   -7.203698190620925e-02   +3.033942603389350e-02; -5.154732355215651e-02   -1.101118970296988e-02   -3.758373828903214e-02   +8.715215430615891e-02   +7.794750330238337e-02   -1.142274272495539e-02   +4.855199937543009e-02   +3.985441294262003e-03; +3.839093893927642e-03   +5.279109779631926e-04   +3.036632633587805e-03   -5.910095120547242e-02   -2.833663819667887e-02   +2.560026028112658e-02   +4.306734035269326e-02   +1.332555963906705e-02; -4.736344682055309e-02   +7.753416684353179e-02   +1.129815929736422e-02   +7.574714907875860e-02   -4.507364640269400e-02   -7.827621732993598e-02   -1.227581414470308e-02   +1.074008330856817e-01; -8.975344314916232e-02   +3.549476748165858e-02   +1.173847787100732e-02   +5.108962098290103e-02   +1.400123715563624e-01   +4.751204769883297e-02   -1.085282402751837e-02   -1.934544410141560e-02];
L2E_L2I_iGABA_netcon = [+1.392246589840743e-02   -6.349256539985196e-02   +7.923848627175242e-02   +3.838765729104592e-02   +1.484415425453615e-02   +1.130148483958152e-01   +1.955462950422877e-03   -4.751704034029362e-02; +4.461019231707236e-02   -5.474011236087587e-02   +4.804322009196564e-02   -6.439004703925000e-02   +9.563712651731171e-03   -4.270111401881535e-02   +1.133167179552232e-01   +3.419157561375585e-02; +5.107853254988743e-02   -2.654712829613805e-02   +3.708427186303514e-02   +1.698688577674825e-02   -2.966046977906830e-02   +5.662041868648672e-02   +5.089991355157632e-02   +1.200519699536467e-02; +1.008248852353092e-02   +2.704855140269037e-02   -4.953398196666629e-02   -1.215381634937253e-02   -4.344050776159108e-02   +7.566953844373842e-02   +6.624750147053773e-02   -9.047011088880241e-02; -6.381027264747196e-03   -3.202863490239370e-02   +2.263629331619995e-02   -6.700727139116025e-02   -4.803212247042094e-02   -9.086062511242578e-03   +8.912239706739526e-02   +1.761445166788088e-02; -6.508355388686687e-02   -9.063832502125503e-02   -7.848461358053120e-02   +1.024268548079563e-03   -9.117909559824933e-02   +2.154994190752273e-02   +5.220627280783832e-02   +2.146430100057985e-02; -1.935724616674801e-02   -1.013549082514460e-02   +4.154413695163654e-02   +7.590905944805620e-02   -1.160451491462616e-02   -7.576476978410041e-02   -2.555333355380163e-02   +1.044431011135162e-01; -7.063537790462096e-02   +8.143210993444248e-03   +1.212274195861677e-01   -1.639773942357083e-02   +3.134941693856874e-02   +9.978663643279875e-02   +4.525755927501951e-02   -1.548956146720818e-04];
L3E_L2E_iAMPA_netcon = [+2.982204764494048e-02   +6.676662474429387e-02   -2.970252265285534e-02   -5.692097933555679e-02   -1.732380163815929e-02   +4.294250287817473e-02   -4.361538751984104e-02   +6.641940503684739e-03   -1.128329438433278e-01   +4.715094279066126e-02   +3.355992063877901e-02   +6.112751146620986e-02; +1.554743657562279e-02   -3.795219010904707e-02   -1.035389817734415e-01   +7.624816361584835e-02   -4.170124378194284e-02   -2.372131806257002e-02   +3.220731863811650e-02   -7.026067599805375e-02   -8.913882966564739e-03   -2.600972226215850e-02   +9.532757253257045e-03   -2.353727372472107e-02; +8.514955036491006e-02   +9.437873791773163e-02   +1.381422609775588e-03   -2.036602234105236e-02   +2.132551117330906e-02   -1.277709734027298e-02   +7.022867003980027e-03   +4.342293139282800e-02   +1.532673249991992e-02   +7.021672606019692e-02   +3.416610084667059e-03   -9.419713063713746e-03; -4.044935588137545e-03   +3.788548036575508e-02   +2.667130808267541e-02   +5.913222686682270e-02   -1.627601676555638e-02   +2.932754116234542e-02   -9.752744339619526e-02   +1.123619151559831e-01   -1.270409733002782e-02   -2.085781882162780e-02   +1.281452327019108e-02   +1.108830636952269e-01; +1.742845587833289e-03   +1.914085738935430e-02   +1.089623186357647e-01   -7.755989237092015e-02   +5.129758256298007e-02   +5.492681633037202e-02   -1.157669178247840e-02   -1.177575253930671e-02   -3.441623694073908e-02   +8.795441593750043e-03   +4.063135152898331e-02   -5.778761869070369e-02; -5.511622175448790e-02   +2.091874619270244e-02   +6.270995005550806e-02   +2.843480748896352e-02   -4.937539254831665e-02   -3.824023282981213e-02   -5.414676563487068e-02   +1.420100213051762e-02   -9.794337583294680e-03   +3.094550656231379e-02   -5.204640796683391e-02   -4.854886491420511e-03; -2.839047595279594e-02   +3.246464704567896e-02   +5.345522937595523e-02   +5.035458082718595e-02   +6.147235285653022e-02   +3.944794677422911e-02   +1.300179768413631e-01   +3.274764441840783e-02   +7.814687905516028e-02   +1.272367993930292e-01   +4.609860999366519e-02   +8.243597526903729e-02; -2.377778238805882e-02   +8.430224964392723e-02   +3.317783263313012e-02   +3.690761042215457e-02   +3.202645684622651e-02   +4.528490977690419e-02   +3.442941204513227e-02   -3.304132799388139e-02   +1.846510871728101e-02   +9.646789504685348e-02   +6.464842069563326e-02   +2.375031477974984e-03];
L3I_L2I_iGABA_netcon = [-1.023162890565866e-01   -3.440182432226905e-02   -9.576639325260074e-03   +1.390197548743086e-02   +4.226884190571599e-02   -2.750175000202917e-02   +3.733717474728157e-02   -4.779345668881078e-02   +4.109436787657251e-02   +8.351105905250605e-02   +1.717009145703071e-01   +1.057003796958442e-02; -1.696352934883235e-02   +1.638532291448048e-03   -7.387129446555438e-04   +7.011474777525810e-02   +1.367074697059931e-02   +7.417934846757089e-02   +6.481230841790943e-02   -4.411393963912245e-02   -7.838726699408785e-03   -2.904557216659251e-02   -1.313714922171924e-03   +6.395048781019783e-02; +8.480837115511389e-02   +7.021967496067144e-02   +8.698890958102917e-03   +2.615789656798484e-02   +5.913682863204343e-02   -3.962597100852566e-02   +3.567147343251378e-02   +6.543774197720459e-03   +2.414064663728310e-02   -2.566966953367580e-02   -3.662631873521044e-02   -5.291327186428676e-02; -2.374243552121826e-02   -5.884466743405327e-02   -3.075110259858089e-02   +4.414777076269481e-02   +1.229405996112357e-01   +5.120674319930062e-02   +7.571431382862640e-03   +3.281049003211245e-03   -3.074322945635037e-02   +6.919794575323018e-02   -3.897340026094080e-02   -1.527198336243265e-02; -3.818163421980835e-02   -4.396676331478736e-02   +1.950551263622415e-02   -1.322781144922490e-02   -1.006057368864659e-03   -1.457416391265503e-02   +4.059421354158688e-02   -5.410230212858193e-02   +2.979680225866681e-02   -1.076781080467205e-01   +2.395417239153094e-02   +1.889957969214687e-02; +2.079750056980697e-02   +7.890629953568937e-02   +1.864974644247844e-02   -3.996140154981290e-03   +1.570974895794662e-02   +9.126654353447577e-02   +1.878832466879827e-02   +1.253160018226273e-02   -6.069961336727513e-02   +5.335323995173253e-02   +4.595800725781265e-02   -1.783771265830494e-02; -4.057476323670499e-02   -1.476669219116921e-02   +1.106411583676860e-01   -2.328749888285699e-02   +1.024270337811593e-01   +1.226147566744160e-01   -9.819842311693579e-02   +5.596455617814025e-03   +8.836470166298907e-02   +4.314812468705626e-02   -3.144177251101316e-02   +1.069666431553325e-02; +7.743712552219162e-02   -5.852124832722440e-03   +2.386792026029382e-04   +4.645228316016011e-02   -7.090418514946693e-02   +4.957838301273682e-02   -5.901402644554953e-02   -4.345547531794741e-02   +8.620111221472035e-03   -6.104644297525779e-02   +9.287111901342740e-02   -7.196471330021056e-02];
L2E_L3E_iAMPA_netcon = [+9.627186624991894e-03   +2.455548697247066e-02   +3.835424206653923e-02   -6.381174059481907e-02   +2.294618549821044e-02   +4.275092014089954e-02   +5.132529065641974e-02   +6.780056692180350e-02; +1.090820607283719e-01   +3.202609254683077e-02   -8.024206359370027e-02   +1.221867653290652e-03   +1.392611838658468e-02   +2.658949475267938e-02   +3.688943435050748e-02   -6.195755708292075e-04; +5.131605298393549e-02   -1.064651681993287e-02   +3.897406521057458e-02   +1.188707047046641e-01   +1.174607575303612e-01   -2.342146190621577e-02   +4.438143317277486e-02   +9.599108809737994e-03; +5.032989598111093e-02   +5.380532107424257e-03   -1.014926821834906e-02   +1.476186203577411e-02   +3.515973910114466e-02   -4.309048383683074e-02   +9.118207856220502e-02   +1.466570815191499e-02; -2.846931029820692e-02   -5.797004559868888e-02   +5.359931117187888e-02   -2.187215104414584e-03   -6.425395313679798e-03   +4.702724650757765e-02   -6.705774415294949e-02   +4.015262444068971e-02; +1.293311398407934e-02   +1.772373197764224e-02   -2.970877799457206e-04   -2.983822333961751e-02   -8.010802112915735e-02   -3.808084804416299e-02   +5.910624144724853e-02   +1.458844350440057e-02; +4.718084466965366e-02   +1.752048056687318e-02   +1.401638995733450e-02   +1.170621685128948e-01   +1.185283415640871e-03   -4.360923898858460e-02   +2.271580955591776e-02   -6.879170202524808e-02; +3.841055065713926e-02   +2.492579601914029e-02   +7.607243239516857e-03   +1.885698992089997e-02   -5.859791592113759e-02   +5.257559735900442e-02   -1.711250615285219e-02   -1.022310245648185e-01; +1.232806921669508e-02   -7.801584367798391e-02   +1.199473996654157e-02   -5.583195671641770e-03   +1.128437212315723e-02   +8.071973632160218e-02   +4.917155521946101e-02   -2.202124005001329e-02; -5.888471172127042e-02   +6.615603060306882e-02   -9.778718795003365e-02   -5.063817896572361e-02   +4.540429498535327e-02   +3.256697649023771e-02   +6.989651423461690e-02   -2.804395188816540e-02; +4.583779603306167e-02   -5.663799857259179e-02   +3.798537533107654e-02   +6.499775606003656e-02   +2.559183058640904e-02   +2.644097087144736e-02   +8.886903822206416e-03   +1.020541635623800e-01; -3.096408777082119e-02   -2.256220397995622e-03   +2.264617489756061e-02   -7.248600006886352e-02   -4.098556034851120e-02   +1.780884468982863e-03   +1.060678067199953e-01   +2.131946968437684e-02];
L2I_L3I_iGABA_netcon = [+4.322665463638789e-02   +3.454189245801731e-02   +1.885670708891351e-02   -7.953082807591488e-02   +8.254087913296942e-02   -1.848149850778303e-02   +7.251316331495146e-02   -1.716918560033557e-02; -5.225837225515323e-02   +2.948004497028724e-02   +1.161018170298609e-01   -8.171692387768915e-03   +5.233539532065498e-03   +4.764370788224491e-02   +1.250069050017102e-01   +2.406824517761234e-02; +5.573364763077964e-03   +1.522825959746095e-02   +8.475205632190364e-03   -3.223636264760624e-02   +9.638882713403348e-02   +8.232572166788371e-02   +4.538437050135914e-03   +7.971427230887512e-02; +7.577151790174108e-02   -2.344934500016945e-02   +8.435948505058152e-02   -5.232702485835766e-04   -2.360598279459575e-02   -7.612741382632543e-02   -9.628640315190005e-02   +2.186565617159134e-02; +4.485746260927995e-02   -6.870327213634976e-02   -4.477422687753295e-02   -1.214014507326193e-02   -8.394959411797570e-02   -2.533282675108289e-02   -5.479115499896596e-03   -4.777774096015958e-02; -5.021852612548507e-02   -5.589586687664180e-03   +6.223429440353144e-02   +4.362412031642348e-02   +2.282594560686114e-02   +6.359044779059717e-03   -6.194774838180006e-02   -5.853846506637841e-02; +8.383602913857389e-02   +2.083653777736173e-02   +1.108459547508905e-01   -5.417118774475826e-03   +9.422647042738784e-02   +2.626197317277366e-02   +5.936145383539201e-02   -1.332920431638752e-02; -2.385733096730646e-02   -7.143101085266576e-02   +5.996687791783176e-02   +1.075085600300981e-02   +1.045225318273266e-02   -1.219700919199170e-02   -2.687924176278512e-02   +7.259320874721920e-02; +6.851105697244922e-02   +1.443935845893093e-02   +9.110356983719917e-02   +5.123328456616038e-02   +4.643974393406166e-02   +5.801625401810272e-02   +8.451478060774664e-02   -1.127671389432450e-01; +5.313193354939458e-02   -2.455789589475733e-02   -6.169752150002143e-02   +2.071091553066709e-02   +1.003478000955255e-01   +5.200081965487299e-02   +4.681146866960176e-02   -3.918373267745982e-02; +7.276700898778057e-02   -3.701002284444872e-03   -2.082947949346835e-02   +6.427699660749592e-02   +6.325064614984260e-02   +1.226045061527340e-02   +8.393689864382679e-03   +5.434138341361550e-02; -3.197214393525439e-02   -2.573253238196911e-02   -6.911499666797324e-03   -3.948342430031769e-02   -9.138973407660553e-02   -8.389439547078015e-03   +1.614743485074580e-02   -9.499815276565578e-03];
L3I_L3E_iAMPA_netcon = [+4.894205478363504e-02   +5.825309797528648e-02   -9.300455966800877e-02   -3.974671763078239e-03   -4.706439190774869e-02   -7.309697967663716e-02   +4.655873530744126e-02   -1.071579191131162e-02   -9.799092090796914e-03   -7.209908422887518e-02   -1.044187422318979e-02   +3.405178659271253e-02; +3.042389640951280e-02   +5.955377387367669e-02   +5.264002502792757e-02   -6.390422886610653e-02   +2.135601108745090e-03   +2.583964974759210e-02   +7.608770035169198e-02   -4.898118839827335e-02   +2.811044804516247e-03   +9.504597427006142e-02   +4.670340489263901e-02   +1.122898267196388e-02; +3.804566168225832e-02   -8.633673797399542e-03   +3.642335848966816e-02   -6.238108803345453e-02   -2.478090635517173e-02   -4.425312656734984e-02   +2.829037239935351e-02   -1.144413689451017e-01   +1.668748815286250e-02   +1.066241281449778e-02   -1.846152673050289e-02   -9.247255287650896e-02; +9.152588929373977e-03   +5.131029533522236e-02   +6.800629482985407e-02   +9.993024444238924e-02   -2.926378821078311e-02   +1.918306332356568e-02   -1.566075483371777e-03   +3.598376403694604e-02   -2.940774444503877e-02   +5.990675704319764e-02   +5.264919748980794e-02   -3.319296382252866e-02; -3.878892645394397e-02   -2.267172539314107e-02   +2.002346122046450e-02   -5.956333026333362e-02   -9.561567187090755e-02   +6.028973105476311e-02   -1.006666353488891e-02   +2.247391385770351e-02   -3.345426075444075e-02   +3.631798539615624e-02   +3.738230324271397e-02   -1.054239656213370e-02; +4.468248144222614e-02   +1.037269877787414e-01   +3.932345286500124e-03   -5.412414621588001e-02   -6.353758243232001e-02   -3.249211499710537e-02   +2.873027759352768e-03   -4.932357084757133e-02   +3.366093504668435e-02   +1.126318735531098e-02   -7.877028471031361e-03   +1.142600282142908e-01; -6.317819737706744e-02   +7.147357886443642e-02   +2.733129203294354e-02   -7.214726104866102e-03   -8.014230606924879e-03   -1.009816836360654e-01   +3.627744341302701e-02   -3.693318484183999e-02   +8.124482086175555e-02   +8.282752991622128e-02   -6.983810763663040e-02   -1.391824837371761e-02; +8.852433852780443e-03   +7.559366304047248e-02   -4.398397015311286e-02   -8.451105679350989e-03   -9.418991844000484e-02   -5.069491995677536e-03   +5.926906958087536e-02   -4.773478902840864e-02   +7.501976237705087e-02   -8.887468550373084e-02   +9.346459687589789e-02   -1.958541977626067e-02; -3.743194325545995e-02   -3.134166263263420e-03   -3.800399894768085e-02   +3.195779051404814e-04   +1.898558338523922e-02   -4.246955039773428e-02   +1.264340429373585e-01   -6.294795392751135e-02   -1.008421036090185e-01   -8.051066547679242e-02   -3.939281928831531e-02   -1.274048184241124e-02; +6.899211381013845e-02   -1.301923487233539e-02   +8.310025160090474e-03   -8.475800143898744e-02   +4.089009283685113e-02   +8.314681492589122e-02   +4.549489907832387e-02   +8.587795753018229e-02   +3.082978724836661e-02   +6.759469969590112e-02   +2.754254747518801e-03   +3.422926174135141e-02; +8.708968050009515e-03   +3.926894781790009e-02   -2.193907030205722e-04   +1.998465473906029e-02   +4.172678242143250e-02   -3.672514633060144e-02   +1.127331278573099e-01   -2.222142982283434e-02   +1.466510958437061e-02   +8.609392071335020e-02   -1.731303050298334e-02   +1.427955677864718e-02; -3.891356092105211e-03   +7.644475476841872e-02   +1.051594146634638e-01   +4.775164451285924e-02   +4.845273698932927e-02   +7.246147584943431e-02   +9.079995797667492e-02   +5.107112278942547e-02   -8.763841937461665e-03   -5.700097761243578e-02   +1.677520796578415e-02   +2.792903266986076e-02];
L3E_L3I_iGABA_netcon = [+4.539392846529228e-02   +4.955628017592612e-03   +4.648305378544802e-03   +1.077702208920731e-01   +8.700101230635809e-02   +5.526601138257914e-02   +1.285892863621047e-01   -7.206492628487784e-03   +7.960536929598513e-03   +5.476885514996084e-02   +8.868108536691054e-02   -3.548401769535241e-02; +9.242061670794971e-02   +1.004022993592704e-01   +1.700723205881646e-02   -1.537875256407622e-02   +5.140453366172260e-02   +1.293508370900183e-01   -2.956451393356724e-02   -1.975733970544628e-02   -7.595633777275726e-02   +9.747320620094997e-02   -8.700611473412856e-02   +3.473179705061662e-02; +7.060084837936939e-02   +3.183478157157738e-02   +4.440720016111557e-03   -4.727013052610972e-03   +9.743167907841936e-02   -5.097369702536490e-02   -7.639842598822594e-02   -1.436610238835143e-02   -1.911685709203333e-03   +4.152448903856019e-02   -8.821750154268782e-03   -5.793114118557655e-02; -9.378634628455028e-03   -2.636771509013803e-02   +6.706295497346902e-02   +4.580964427580457e-02   +1.243983920032081e-01   -4.406680620287274e-03   -2.406242058165907e-02   +1.922586301717993e-02   -1.049381732691701e-01   +7.123565983394274e-02   -5.057091924695398e-02   -4.256475743931029e-02; +5.381447016683738e-02   +3.839519623871313e-02   -2.136022372443811e-03   +5.557545608300923e-02   +1.116658253375686e-01   +3.913774917573368e-02   +6.464870126658610e-02   -1.215240260353044e-02   +6.689697878529013e-02   +5.504806977745720e-02   -1.148869011431360e-01   -1.819286463027878e-02; -2.490174595830431e-02   -1.003154692228558e-02   +6.489494467816821e-02   -3.706093265178383e-02   +7.299593823072842e-02   +6.377844602030334e-02   +9.672886031125937e-03   -4.998504278067793e-02   +2.349062113051336e-02   +1.186144074966452e-02   +8.303937258282049e-03   -1.531692914346538e-02; -5.969472683141267e-02   +3.661558629507024e-02   +8.156566352243592e-03   +3.977984110404686e-02   +7.071073002128787e-03   -8.154163082943482e-02   -2.735323420702283e-02   -3.589130066864234e-02   -1.868882069607940e-02   +1.968533377815434e-02   +4.460688127052766e-02   -5.061332085271768e-02; -1.799382087887488e-02   +5.021352189215916e-02   -2.963618034774873e-02   -4.666351977851541e-02   +2.933625646252367e-02   -2.824826012516402e-02   -1.414283450286165e-03   -5.573598151060757e-02   +6.015605033944751e-02   -4.847674318570077e-02   +2.771631005834747e-02   -5.985657290396918e-02; +2.410122875252384e-02   -5.886720328556400e-02   +6.491348901437122e-02   -2.719802407757996e-03   +1.036653778701277e-01   -3.025554362275854e-02   +2.227740503665917e-02   +1.159567021686825e-02   -2.347578468444727e-03   +3.162866695735887e-02   +1.078788657247337e-02   +1.252936110580342e-02; +1.363559331585822e-01   -3.440120831936595e-02   +6.843720466323897e-02   -3.693150960920395e-02   +8.394054018324333e-02   -8.259695912813239e-02   +5.695878468172337e-02   +2.112233363263548e-02   +6.587018997955696e-02   -3.101745233873134e-02   +3.057273282384800e-02   -5.442683658143224e-02; -1.861370133829253e-02   +7.179900264660927e-02   -4.721187759344435e-02   +2.699974774137462e-02   +4.313271136815508e-02   +6.685060860003680e-02   +9.935353239735646e-02   -2.048732864082881e-02   -4.020647180448998e-03   +8.085875060733436e-02   -8.559204894869728e-03   -4.055719617009698e-03; -1.778722104026027e-03   +2.048002526529142e-02   -2.447461115696925e-02   +8.302518652331656e-02   -2.771020004476287e-02   -5.248918096988170e-02   +2.184576802243430e-02   -5.264549900552473e-02   -7.137642284523343e-02   +6.952641820177957e-02   +4.243325575379552e-02   -7.333507103018566e-02];
L2E_Input1_iAMPA_netcon = [+2.474007667455360e-02   -1.030552863648339e-01   +1.013774981164901e-02   -2.307668756662041e-02   +6.990560791955858e-03   -2.867184538662292e-02   -3.171087101660455e-02   +4.197238937613736e-02];
L2I_Input2_iAMPA_netcon = [+5.460466497738443e-02   +9.951245573321048e-02   +3.842865102966363e-02   +1.231041580948948e-02   -4.963070248613825e-02   +3.103293464604773e-02   -4.493175971093182e-02   +1.069835157471921e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
