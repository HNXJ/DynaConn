function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.158195360558172e-01   +3.426673506803373e-01   -4.704812057555451e-02   +4.632763250925547e-02   -3.468137625193114e-01   +7.704134848276181e-01   -2.081280423434180e-02   -2.488561265221013e-01   +2.495206142809074e-01   +1.872321749605101e-01   +4.406193297540970e-01   -5.207933974410229e-01   +6.296570180930776e-01   -8.801258975673844e-01   +8.801811190440359e-02   +1.126798958299958e-01; -3.933139418995264e-01   -9.004211890414864e-02   +3.262492997495778e-01   -6.132421308935261e-01   -3.021094266777307e-01   -3.751713816030757e-01   +8.745129715212459e-01   -5.626292519268834e-01   +2.620337571282617e-02   +6.300845323290593e-01   -1.414017525570738e-01   +5.329911048233438e-01   +4.427412062506192e-01   +5.702119807153387e-02   +5.925476775919121e-01   +4.278906733593523e-03; +1.056100478476181e-03   -2.657347222840355e-01   -4.505360037305502e-01   -9.312734784007281e-03   +5.777068097577993e-01   -5.353975882207705e-02   +8.425872865873285e-03   +4.593622302229765e-01   -4.752797572961896e-01   +5.174661044441151e-01   -9.007235868989042e-01   -5.650400760137501e-01   -3.594519012046812e-02   +3.972013095933574e-01   -4.270211646004071e-02   +1.463950706898644e-02; -7.560822705197324e-01   -4.189172569701803e-01   -4.797321113154674e-01   -6.083767649874856e-01   -2.110238650379493e-01   +5.014629364113279e-01   +2.256249620333136e-01   +2.845246396364394e-01   -4.552323768289421e-02   -2.342038274342878e-01   +2.088251059656926e-02   +2.305827275895061e-01   +4.430300758168421e-01   +2.213481517078589e-01   -4.761949343204003e-01   +6.491539684670130e-01; -3.109241421833668e-01   -1.563560062764024e-01   -2.848971539357010e-02   -2.977357121977000e-01   -2.941900735485242e-01   -1.749452317731774e-01   +9.690618245296174e-02   -4.138219940167716e-02   +3.161893093255521e-01   +3.672624126080836e-01   +6.366036231605454e-02   +1.838602769152051e-01   -2.279989713685624e-01   +3.484161392749546e-01   -2.847962176838665e-01   +6.968397928263581e-01; +3.900685035035809e-01   -3.319383836286018e-02   -3.788236110515712e-01   +2.734541855067794e-01   +1.500044803163008e-01   +8.102482161927502e-01   -1.096739974933050e-01   -2.154320211633959e-01   -7.239195020495233e-02   +1.000000000000000e+00   -1.998819432089991e-02   +4.085460712443045e-01   -1.848988612129799e-01   -1.969433449228763e-01   -3.019202969149698e-01   +6.883339136965911e-03; +7.726429929112098e-02   -1.403629263562896e-01   +2.077828847987460e-01   -1.519488970726955e-01   -8.331121143228419e-01   -1.781879563420176e-01   -1.837192997038698e-01   -1.740441683815789e-01   +4.832259147998900e-01   -8.887021147111246e-01   +9.252032002430586e-01   -5.708321341302353e-02   -2.474828343754347e-01   -2.878329457666308e-01   -3.906815049920683e-01   -1.311601308795998e-01; +2.548798835930639e-01   +5.515876857468401e-02   +4.417431116144278e-02   +6.236656905403130e-01   +4.650471059233739e-01   -3.157942843146606e-01   -4.566357412639490e-01   -2.161641562160261e-01   +2.946627575177265e-02   -1.475403190446863e-01   +3.767205322817694e-01   +3.230344287352750e-01   -1.496901973045659e-01   +3.205188700945442e-01   +2.606642604797312e-01   +4.200401581789801e-01; +5.425132118976347e-02   +3.855043049570997e-02   -4.070781095559752e-01   -4.115871793793641e-01   -4.789734082807604e-01   +4.659679271106869e-01   -8.491692411048450e-02   -3.995995187158905e-02   +6.548090556010281e-03   +1.598366174811391e-01   -9.052405752206873e-01   -1.483165504264098e-01   +3.597269774173386e-01   +3.217254975376572e-01   +2.418929336413845e-01   -2.108814218757231e-01; +5.580360191249011e-02   -4.295133357489574e-01   +2.272233926848915e-01   -4.203407796363994e-01   +4.094183588892800e-01   +2.587687981786979e-01   +1.249034939485403e-01   +9.857358311322673e-01   +8.041611781491786e-01   -7.787920242615093e-01   -3.633567562237501e-01   -6.729509588312672e-01   +5.531809832716639e-01   +7.631809043571343e-01   -4.214848174153069e-02   +5.539360640698944e-01; +3.356696915960383e-01   +4.978818908214989e-01   +1.555012004522157e-01   -4.979170137610066e-01   +3.204690470334650e-01   -8.809078866842891e-01   +3.414819842111655e-01   +1.855219929886500e-01   +1.871874487420217e-01   +2.907936349685435e-01   -6.245024556035766e-01   +1.294881997255457e-01   -2.436707569674509e-02   +2.566663018178484e-02   -3.451115083343763e-01   +3.047242052567938e-01; -2.611378068027438e-03   -1.590248865492347e-01   -4.104165460393884e-01   +2.926143314149730e-01   -1.405772716472456e-01   +6.189486432234175e-01   -2.810542894844277e-01   +3.631639706775667e-01   +3.093273278400227e-01   +7.206680936877781e-02   -4.026978432614843e-01   +7.987433149597624e-01   -2.700685158971686e-01   +3.637693871010071e-02   -2.827002800288878e-01   -3.267777722086009e-01; -3.543163024161055e-01   +4.297164390116310e-01   +1.038954323063487e-01   -1.571277040652668e-01   -5.290489957281943e-01   +9.431931960156719e-01   +2.711716548702222e-02   -2.618071191380927e-01   -3.742094589154345e-02   +6.533924318647955e-01   +3.692014954721065e-01   -7.713688364480481e-01   +4.310174184351830e-01   +4.507929752215086e-01   -2.278002991825807e-01   +3.944694248374354e-01; +8.097673472160236e-02   +6.401325810621403e-01   -3.986311154069697e-01   +5.239382259526070e-01   +3.258540957624340e-02   +2.381627902973652e-01   -3.654467773318815e-01   +2.131811534803733e-01   +9.575663534829070e-01   +2.556769289212886e-01   -8.731236454890720e-02   +7.999288388765180e-02   +3.677998554270801e-01   +4.940635215162946e-01   +1.827464324006830e-01   -4.101400639989870e-01; -9.946070389161790e-02   -4.912572133641955e-01   +3.682692345103493e-01   -3.906861144267380e-01   -4.453999245307990e-01   +1.282522222273216e-02   -7.063265214252678e-01   +1.123179895228765e-01   -3.055983339981395e-01   +3.662609668050295e-01   -5.256617863828222e-01   -2.107430681372555e-01   -3.963433422730989e-02   -3.713866801101715e-01   -5.574577054219587e-02   +3.207515589978789e-01; +7.112335641907913e-01   -6.063099014746156e-01   -3.961879471855345e-01   -3.246452202996757e-01   -9.129966216383693e-02   -5.285055423762199e-01   +3.707372715938146e-01   +1.371980381372121e-02   +3.505511979533409e-01   -4.606289233118530e-01   +4.389234518258425e-01   +3.398025046692237e-01   -1.824792358324093e-01   -1.923643294907472e-01   -1.067745154062696e-01   +1.512435843813242e-01];
L1E_L1I_iGABA_netcon = [-7.856978326097703e-01   -3.588725863449317e-01   +4.645350819495004e-01   +3.054910119948571e-01   +6.892779953113171e-01   +2.681698472882381e-01   -7.804429406051117e-01   -8.553632688305355e-01   +1.734177106004322e-01   +7.470322982884070e-01   +2.811230617662490e-01   -3.458537337638828e-01   +2.553167591748783e-01   +3.784066488777728e-01   +5.400799224391943e-01   +3.750674789679638e-01; -3.400433017872528e-01   +6.151409444081537e-01   -7.057364092491966e-02   +2.021659200832131e-01   +1.456256535254281e-01   -4.345457499374897e-01   -5.259224960983858e-01   +3.351575705555312e-01   +3.038897704562468e-01   +3.276842741840304e-01   +1.260967075034699e-01   +1.136426361339882e-01   -2.263524112697671e-01   +3.413553120973179e-01   +1.000000000000000e+00   +6.302403292866590e-01; +4.027003731963701e-02   -2.936625500047056e-01   -4.561323357538287e-01   -4.425049192104030e-01   +2.300050194955339e-01   -1.819263607609994e-01   -1.634733182201639e-01   +1.477996793783096e-01   +2.158794144112240e-02   +4.258580505433053e-01   -2.350420707017634e-01   +1.596975856132292e-01   +8.306462194541706e-02   +1.373757513613878e-01   +2.988149884409463e-01   +6.918741925404509e-01; +5.503580130351172e-01   -5.109137280709963e-02   +6.303396228273956e-01   -2.534524993612796e-01   -4.032791947598748e-01   -5.520379366383696e-01   -2.569563515280095e-01   +5.106782620470993e-01   +2.835833953827044e-01   -4.220412027951367e-01   -3.291241594431488e-01   -3.032802417746945e-01   -7.402577540771735e-02   +1.426761903508761e-01   -1.741492333332007e-01   -4.107746379672749e-01; +5.150222735426280e-01   -2.242797673807863e-01   -4.000455892786115e-01   +4.276443338038909e-01   -1.880504489555278e-01   +3.598550698934065e-01   -1.439760639158486e-01   +2.555198362409441e-01   -8.268744957133649e-01   +1.843600611445042e-02   -4.187034153572457e-02   -6.243779989274201e-01   +1.248128433221837e-01   +3.825011140454652e-02   -8.357474969059522e-02   -8.425517383665111e-01; +3.191878581321360e-01   +2.960552739404032e-01   -4.575564288528433e-01   -1.574623557716822e-01   +1.489713850623941e-01   +1.879563383978038e-01   -5.041117428003046e-01   +3.004355450647181e-01   -1.050307274437455e-01   +1.385710414742549e-01   -5.121156410275078e-01   -4.979698511809980e-02   +4.192560270083055e-01   +9.805558017501249e-01   +2.285350238736162e-01   +3.802023639563122e-01; +3.776553201100781e-01   -2.416143797150139e-02   -1.143486569556917e-01   +8.013138668590405e-01   -5.428893101411310e-01   -3.248083007964704e-01   -1.849950338140783e-01   -1.700960951120060e-01   +1.728439140938824e-01   +6.001756383233984e-01   +3.405878097397047e-01   +2.978814014126321e-01   -1.461642125079549e-01   +1.730796039971191e-01   +4.247968081446202e-01   -4.466109069697258e-02; +5.697708672463787e-01   +7.029086097139993e-01   +7.921657178346815e-02   -2.918705697336270e-01   +4.644523636402199e-01   +3.854974360377159e-01   -1.929064414944984e-01   +7.415285209984176e-01   +2.639777655184556e-01   +3.212422083239997e-01   -6.416202562654704e-01   +6.047119216846466e-01   +1.207515520085634e-01   +3.461902090598453e-01   +2.757706412302330e-01   -2.901969168834044e-01; -1.691631479246156e-01   +2.746536693242379e-01   +3.572852643686153e-01   +4.400056700108392e-01   +1.052933640944338e-03   -1.695859595988435e-01   -1.003733340839389e-01   +3.256280005383811e-02   +1.536147629028323e-01   -7.624377027485033e-03   -3.309811661131401e-01   -8.514964844675522e-01   +3.195784791925081e-01   +8.559520020321869e-01   +9.818571546099382e-02   +2.131316758916647e-01; -3.003100137111859e-01   +3.642312943313698e-01   +3.536010748327453e-01   +5.037855028755420e-01   +3.795592459907635e-01   -6.306488399222516e-01   +7.620710828246430e-02   -3.601574164967922e-01   +4.772100171882692e-02   -3.041655444338500e-02   +5.716340006658819e-01   +3.530567838809524e-01   +1.491353943779446e-01   +5.845255747657112e-01   -9.926896809038361e-01   +1.436614931005671e-01; -4.926963152233557e-01   -5.735724075156867e-01   -6.430630597072964e-01   +6.313071238450851e-02   -2.812411075600103e-02   -2.025801712175050e-01   -3.113234968886512e-01   -3.517748653150625e-01   +4.736775160208311e-01   -5.802269347190739e-01   -2.837998832665420e-01   +8.697147814609033e-01   +3.578404449783528e-01   +1.656286286761497e-01   -5.584368910863677e-01   -5.926627531067471e-01; -1.252316473308678e-01   -9.502270920691754e-02   +1.621610152183797e-01   +4.512156438954027e-01   +4.170876517419104e-01   +5.228728751936695e-01   -3.795474148781047e-01   +1.200570829308271e-01   +2.479221371046626e-01   +1.849460682793911e-02   -2.388757772064695e-01   -2.831758425972187e-01   -7.512616495207473e-01   +3.433453789937810e-01   -1.304398946011285e-01   -2.403551910162222e-01; +1.710766512162376e-02   -3.095803111601367e-01   -4.424059456560679e-01   +1.884722219890242e-01   +1.348771255866453e-01   +5.456633840002358e-02   +2.059153446226570e-01   -1.789081667421212e-01   +7.091686568498646e-01   -1.737827552127011e-01   +2.494150827401260e-02   +5.987586547938356e-01   -1.219818338621049e-01   -6.373202579950776e-01   +4.118932012262343e-01   -4.397018031387174e-01; -1.833582469867190e-01   +1.901152118630324e-01   -5.792095303577609e-02   -2.218226179325451e-01   -3.163136660564430e-01   -7.852899103374042e-02   +5.688549762376281e-02   -5.529895592676916e-01   +3.498445692644653e-01   +6.063252320630040e-01   -2.094918331714535e-01   +1.730017076045005e-01   +3.042650770591604e-01   +2.318411721033637e-02   +6.669736912795287e-01   +6.583122537718926e-01; +8.857041545567676e-02   -7.730856690662584e-01   +5.610171335391845e-01   -2.643437554535084e-01   -1.786193500084678e-01   +4.588113682871803e-01   +3.500420024335312e-01   +1.752833082852236e-01   -2.607194686647233e-01   -2.687871249087290e-01   -9.376565385642005e-02   -5.455211611754440e-02   +2.732000318946867e-01   -5.202249486405300e-01   +2.524544323089668e-01   +4.004948282428806e-01; +4.567799747577527e-01   -3.040719472036187e-01   +5.645076828158089e-01   +3.132667056372167e-01   +1.723916852469618e-01   -7.777225295801246e-01   +2.744242528389016e-01   +6.864250163914677e-01   -3.246807789860514e-01   -4.586945904210545e-01   -4.730970134783004e-02   +1.557938206111159e-01   +1.834494465106978e-01   -3.614935182602652e-02   +8.196903152106370e-01   +3.039620427289334e-01];
L2I_L1I_iGABA_netcon = [+2.427880387940132e-01   -6.595168409985841e-01   +2.081352227249626e-01   -2.225753358628577e-01   -1.445331014281120e-01   -2.919006396937009e-01   +8.951681634894388e-01   -2.559202613971313e-01; -4.225495283991791e-02   +4.432202098774738e-01   +2.248694715192089e-01   +5.987023230164856e-01   -7.889258857098200e-02   +6.480158576892401e-01   +2.361340437428577e-01   -4.180589362493232e-01; -3.173326290354080e-01   +3.956450458541174e-02   +7.455724948856847e-01   -6.839222002870031e-02   +3.157811236989060e-02   -3.000196926408966e-01   -2.284967463752207e-01   -6.984948858884778e-02; +6.481532261358656e-01   -6.463004601438985e-02   -7.792334645000417e-01   +2.703789383354333e-01   +9.446723263273708e-02   +3.906899631025472e-02   +1.000000000000000e+00   +2.454421634419028e-01; +8.245443779334284e-02   +1.001441102509334e-01   +6.798956179787432e-01   +1.556920859465838e-01   +2.280161194533388e-01   +2.753147690736028e-01   -1.462325735471459e-01   -2.232506259025832e-01; +2.294475028870555e-01   -6.108709190013539e-01   +5.571928889242368e-01   -3.427213570717397e-01   -6.001517908128706e-01   +2.088661296767023e-01   +8.539534175334903e-01   +4.075208070591506e-01; -1.941039428227963e-01   -1.314954587381681e-01   +6.718380555083320e-01   +6.962669313704184e-02   +6.103836160274408e-02   -4.279024604761584e-01   -1.126712556586042e-01   +3.351178473695660e-01; +1.577103957432945e-01   -3.017490590946220e-01   -3.184697506644120e-01   +3.758981081912021e-02   +1.648086711704002e-03   -4.429126736056465e-01   +1.243435096567106e-01   +1.344881025901838e-01; +5.604162188075784e-04   -3.853574894938774e-01   +3.227528475937645e-01   +7.772866374849503e-01   +2.239218044815660e-01   +3.901510095035957e-02   +1.201047234740881e-01   -1.365678404727731e-01; +2.775489204533089e-01   +2.310611029995704e-01   -1.453766109641685e-01   -3.191940356317705e-01   -5.961686999629043e-02   -5.574424340597499e-01   -8.855448164783408e-01   -2.453791045151219e-01; +4.200075693300531e-01   -5.249432670770982e-01   +7.428296188381165e-01   +2.516871934135182e-01   -1.019177949439552e-01   -7.530362063657154e-01   -6.258793897058348e-02   -1.244933677304377e-01; +1.420774252047018e-02   -4.229201098104312e-01   -1.862539807588811e-01   -3.584233278216347e-01   -4.821562515235910e-01   -8.136295162721509e-01   -7.141159805980486e-01   +3.281342520638316e-01; -7.885793370442747e-02   +3.664427525059982e-01   +1.349704470303095e-02   +1.096772736531139e-01   +3.421653280585136e-01   +7.275758106590025e-01   +4.550031365171726e-01   +1.894897112045045e-01; -7.194069392881564e-02   +4.534381305743566e-01   +4.934191158271382e-02   +3.027310079148495e-02   +4.249168129707037e-01   -4.037737858333550e-01   -4.736410287712790e-01   +1.142275626302472e-02; -5.392706129538226e-01   +8.684569882525468e-01   -1.671153536952132e-01   +6.656170666585788e-02   -1.751832402246205e-01   -8.002771277379465e-01   +6.607492574503432e-03   -1.588048508693249e-01; +3.255464934095720e-01   +5.010792089995874e-01   -3.334029400555096e-03   -1.779688787098307e-01   +4.821594463584151e-01   +4.892446269645551e-01   -3.002067087080057e-01   +5.372635910099047e-01];
L1I_L2I_iGABA_netcon = [+8.176896901105075e-01   +9.440813878150847e-01   -9.007899825640233e-01   +6.281736548741765e-01   -4.006212615678936e-01   +8.089154132489960e-01   -4.817798076411002e-01   +1.847581759298497e-01   -5.627713216051569e-01   -6.092906393747815e-01   -1.472104375420107e-03   -6.203423352545077e-01   -6.406926035219835e-01   +7.523473728021637e-01   +3.867289768741336e-01   +5.881087551577978e-01; -6.077858088032961e-03   -3.084782626689402e-01   +3.710170205757158e-01   -7.656667289841381e-01   +6.359106578054016e-01   -8.105560692467890e-01   -6.127510363457153e-01   -3.493478058110540e-01   -6.251116993715756e-01   +5.303181913256453e-01   -5.974282534653261e-01   +3.395065389763475e-01   -1.512500338534490e-01   -2.282185036420839e-01   -3.814880616844517e-01   -1.932981083778123e-02; +3.776254713018919e-01   +7.993211269137872e-01   -5.221479887313036e-01   -6.502429994419723e-01   -4.399735553428512e-01   -1.673564844636320e-01   -2.988779774844187e-01   -1.434487805896344e-01   +2.151824932759799e-01   +1.941130985004028e-01   +8.981600253167728e-02   -6.712080292800051e-01   +4.199994732927987e-01   -4.688101984868467e-01   -6.217617315467251e-02   -1.118580466070001e-01; +7.618197902857983e-02   -3.436446278093137e-01   +1.863959911759286e-01   -3.504831216147384e-01   -6.329922379726450e-01   +3.801015427281250e-01   +3.683766991448473e-01   -3.399362292360368e-01   +8.296118196881029e-01   -4.819552025693634e-01   +4.674525787536896e-01   -7.085624644333385e-01   -3.543184526008983e-01   -2.711821475757969e-01   +2.465311102402553e-01   -9.298038937781200e-01; +7.850479659305540e-02   +1.904406370079965e-01   +4.835445339863280e-01   +7.602235505705013e-02   +7.684559506209971e-01   -1.000000000000000e+00   -2.179868815863200e-01   +1.127685512484955e-01   -6.864617284801289e-01   -7.626977910554830e-01   +2.646873565332771e-01   +4.698337556356047e-01   -1.518534733451899e-01   -4.392269675270252e-01   +9.110193673081122e-01   -9.243418614153444e-01; +4.864446120606913e-01   -4.108728036071244e-01   -3.739066503100102e-01   -6.971324139580558e-01   +3.747534163919756e-01   -1.116357396032367e-01   -3.611024332725032e-01   +1.793314176944390e-01   +3.459136106585473e-01   +5.976942502872015e-02   -5.102136495832383e-01   -2.647627103509298e-01   -5.216476770694154e-02   -7.941721359534505e-01   +1.593773519455267e-01   -9.886967872711665e-02; -3.722543165942892e-01   -5.705636360601299e-01   -2.301751831693019e-01   +4.444160098517933e-01   +9.467699219755582e-01   -9.689611235904216e-01   -3.966028910598087e-01   +3.422005249901833e-01   +3.596654852386150e-02   +6.010650701169356e-01   -5.845498031701155e-01   +1.840470188500682e-01   -1.786707931670299e-01   +5.856145768940777e-01   -6.190943835978354e-01   +4.371607148726628e-01; +8.588700394722233e-01   +5.114261269519302e-01   +3.263870851289747e-01   +3.194759898022975e-02   -6.340953240655276e-01   -9.901178059740622e-01   +5.387042337402395e-01   -2.171616748778943e-01   +1.103954535245693e-01   +6.542689908868778e-01   +4.113737392330727e-01   +3.977042628551796e-01   +3.770260823480452e-01   +1.282465322270968e-02   +7.722398980497861e-01   -8.147251285051083e-01];
L2E_L1E_iAMPA_netcon = [+1.582529502720965e-01   +5.468142050701320e-01   +1.875142950477159e-01   -8.885272257275281e-01   -2.881011401983527e-02   -1.255083756513522e-01   +2.642913710513442e-01   -1.393957489498660e-01; +4.427086138377050e-01   -4.797953664632359e-01   -6.375524542912070e-01   -4.174525563539679e-01   -3.092348870156313e-01   +4.024145130264624e-02   -6.296534756256579e-01   +7.497640393125421e-01; -2.635610845751848e-01   -8.445976790475666e-01   -2.677972349051737e-01   +4.516033124241137e-02   -4.061545944498900e-01   -5.120707577868114e-01   -1.392620817975926e-01   +1.846615530208881e-01; -3.925580009452239e-01   -5.900863241543812e-01   +2.400025313385381e-01   +9.212512496885635e-01   -3.015742099544608e-01   -2.476499107129067e-01   +6.318033204236279e-01   +3.615615593940413e-01; -2.192572014390179e-01   +7.444757867238290e-02   -3.594371411513503e-01   +7.888380225717752e-01   +6.767320939077246e-01   +4.284659498237554e-01   +4.081580513836570e-01   +3.690649737774023e-01; +4.360403657864970e-01   -5.224533175436596e-01   -5.688708502986206e-01   +1.284623078941395e-01   -4.777265175136615e-01   +1.928914350016001e-01   -4.742788439727295e-01   -2.329011255998702e-01; -4.921785792824811e-01   +6.756123604911245e-01   +2.818448316909260e-01   -2.961734694535472e-01   -3.258012576612952e-01   +1.562431313231036e-02   +1.823324679408439e-01   +9.553875422661946e-01; +4.108644060929669e-01   -2.699075372830001e-01   +2.763476406653702e-01   -8.453474023340873e-02   +1.000000000000000e+00   -2.883137519974538e-01   -3.703300224245329e-01   -1.953187193630620e-01; -7.614054074246574e-03   -3.261463148813863e-01   -4.777360420981639e-01   -1.958310244212672e-01   -9.715178923749411e-02   -4.827016094932640e-01   +9.754775825739544e-01   -2.353943109473740e-02; -1.974234145553359e-01   -1.162288086122536e-01   +5.323375078559119e-01   -5.552923625657875e-02   +2.087236521315885e-01   -8.066451161717549e-01   +5.661379702981566e-01   -1.171205893187003e-01; +1.399885902979413e-01   +3.091372116870796e-01   -5.173041701858794e-02   +2.305403821885539e-02   +3.978078334430202e-01   -9.846131473453151e-01   -2.297816489714336e-01   +1.748162571737613e-01; -2.652854891826066e-01   +5.797357295013388e-01   -2.946180309553420e-01   -1.015745621205180e-02   +8.207319022300040e-01   -1.560228327300544e-01   +7.692035663643728e-01   -6.772474769816119e-01; +3.214454807444159e-01   -3.083836071826224e-01   +6.296755115634971e-01   +5.223211399246512e-01   -4.522874534918017e-01   -3.531733791167661e-02   -1.411120205040924e-01   +1.407034057754639e-01; +1.955357079446405e-01   +4.921935252361165e-01   +7.767718874148731e-01   -1.603329271113371e-02   +1.438048016921477e-01   +4.527317215773211e-02   -1.411787739801969e-01   +7.358144049734663e-01; +5.068792357249986e-02   -3.802431755997940e-01   +5.608018822906634e-01   -4.317565436268111e-01   +5.515419939269491e-02   -1.366200070371833e-01   -4.255728308621912e-01   -9.506205508639527e-02; +1.291836777525471e-01   -3.015534940844037e-02   +2.740833935029149e-01   +5.398800840081041e-01   -4.892455145335824e-01   +3.160895160631154e-01   +2.965878158817163e-01   +4.262926524585455e-01];
L1E_L2E_iAMPA_netcon = [+1.886529123727475e-01   +8.349723703472731e-01   -8.535326460421235e-01   +2.379049005699787e-01   +4.384424007943809e-01   +2.801022115680621e-01   +8.924958315814677e-02   +7.835997213578817e-02   -5.061420255372096e-02   +6.821005823749701e-01   -4.662738746087985e-01   +9.157456533361243e-01   +9.399057664596447e-02   -5.900294460785135e-01   -5.344665565861551e-01   -8.477379623836067e-01; +1.792866398703996e-01   -6.817083142005695e-01   +4.670741716222130e-01   -4.159269074203678e-01   -4.178215075457854e-01   -2.193153643148828e-01   +1.678613706607202e-01   +6.116852679216004e-01   -1.197401684894440e-01   +7.089684371342728e-01   -8.837941576154872e-01   +5.856819488291996e-01   -4.241944211764512e-01   +1.000000000000000e+00   +5.941983573326363e-01   -1.679265905689861e-01; -8.360868223588085e-02   +2.651526447152667e-01   +5.172756690890342e-01   -9.046151064332147e-02   +9.118435933269057e-01   +5.071871101720345e-01   -1.482046588901048e-01   +8.679811566518461e-02   -3.083976355954518e-01   -1.385760942331115e-02   -5.881692665194469e-01   -1.199157913769068e-01   +5.304260709582343e-02   +7.037805409050536e-01   +9.809930476127205e-01   -6.118330322357561e-01; +5.176900544225109e-01   +7.589326347614872e-01   -4.621055033159564e-02   -5.015704574679311e-01   +2.039169937884102e-01   +1.002980390007220e-01   +6.794976949245415e-01   +1.044209406588890e-01   +3.497335399562611e-01   +2.609867910856719e-01   +4.966074076647555e-01   +6.488792184117304e-01   +2.663855674903707e-01   -2.038168036563383e-01   +3.858143809600721e-01   -2.959960386399459e-01; -6.863838533652512e-01   -5.007850305309676e-01   -6.640475226991198e-01   -9.681282965830986e-01   -3.147178622544887e-01   +2.685541209399737e-01   -9.863952234240738e-03   +6.227129987213613e-03   -7.116970940691116e-02   -8.624990700823597e-01   -6.685960824249605e-01   +1.979798079495507e-01   +6.607431265229738e-01   +6.180240166280246e-01   +3.520055335845690e-01   +4.312214238241173e-01; +2.203528858257569e-01   -5.068634578338703e-02   -2.832907861276268e-01   -2.078798461274356e-01   +9.890924175452295e-02   +1.193312581996402e-02   -6.732592236376489e-01   -1.457429974277940e-01   +4.808421230703128e-01   +9.095630168635770e-01   -3.977378340390704e-01   -3.057070988959646e-01   -3.695023542505219e-02   -2.646668962772873e-01   -3.119879816821808e-01   +6.508223587813974e-01; -3.286835139581693e-01   -5.593187712325632e-01   +6.222649856533888e-02   +9.929498488688937e-01   -9.798175936662183e-02   +8.798841808568615e-01   +2.404574668942694e-01   +5.124917973282600e-01   -7.318637899732563e-01   -4.761350081580068e-01   +1.598600723715465e-03   -8.432634820606444e-01   +2.288389620229959e-01   -3.871515812390205e-01   -7.403483661664724e-01   -4.063235993841023e-01; -1.726855155971607e-02   +5.723864710784120e-01   +8.215998558339455e-02   +1.498494250195039e-01   +2.475783501432723e-01   +4.664986779466888e-02   -5.777269113261687e-01   +1.767524927749600e-01   +4.882103448582086e-01   -1.395124690821616e-01   -5.792872377342430e-01   -3.900377209500617e-01   +6.643964285659096e-01   -5.869765125518454e-01   -4.422303645154200e-01   +7.953755587127627e-02];
L2I_L2E_iAMPA_netcon = [-1.189732298179843e-03   +2.269672314408246e-01   -3.247998700271004e-01   +4.940418786165245e-01   +9.583867901091485e-02   +6.803606696150288e-01   +8.193660321030102e-01   -4.930040791186749e-01; +4.968740202732126e-01   +3.758250301562797e-01   -3.973189727572832e-01   +6.623661514146441e-01   +4.068499609599347e-01   +2.507678754995763e-01   -5.518160562268029e-01   -2.323870571131202e-01; -2.255897522830326e-01   -1.354012384141794e-01   -6.217933171189730e-02   +9.536607209162340e-02   +1.489824169579732e-01   +4.723598501330698e-01   +2.995525207766433e-01   +6.995226684596199e-01; -3.430009513531127e-01   -7.522789370921708e-02   -2.071829729002272e-01   +7.299112096296289e-01   -1.055231694810852e-01   -5.526470839466767e-02   -4.593724493724959e-01   -4.689469760559841e-02; +5.113259490749597e-02   +1.883634616915920e-01   +3.435382166458789e-01   +1.000000000000000e+00   +2.123243728566206e-01   -1.166551835608270e-01   +8.312317713308863e-02   -4.571405457257561e-01; +2.330059509187504e-01   +6.302860302400969e-01   +3.888711032736017e-01   +1.422155741358012e-01   +7.242547884992732e-01   -4.003846699003894e-02   -4.933960460509724e-01   -5.230331027966757e-01; +6.042368823718090e-02   -1.699375411495222e-01   -4.952078549353553e-02   -8.563667389776923e-02   +5.090131226283654e-01   -8.445034375591735e-02   -1.823235274074898e-01   -1.500761410423236e-01; -2.477469684121276e-01   +1.882256328232240e-01   -4.028493359224818e-01   -4.835685533979429e-01   +4.263574085390350e-01   -7.907950980791213e-01   +2.537208477248876e-01   -7.534957219984291e-01];
L2E_L2I_iGABA_netcon = [+6.272444459378947e-01   -4.673709836891230e-01   -5.671976416068868e-02   -1.565683102789678e-01   +4.894906407760761e-01   +4.470557032509859e-01   +5.174387876106327e-01   -1.612414898899089e-01; -3.727216102537510e-01   -1.137595111998382e-01   +7.544054125392882e-01   -3.116957149316929e-01   +3.303624126236673e-01   +6.159236224814130e-01   -2.104435830768478e-01   -3.285357528662569e-01; -1.346336853602166e-01   -3.746835629169136e-01   +1.274936387474779e-01   -4.424441293649649e-01   -7.949319030569986e-01   -6.002324854857056e-01   -5.435622581652681e-02   +4.707503688536328e-01; -3.557686335641003e-01   +7.496227857797709e-02   -3.600066194049541e-01   +1.663288596001174e-01   +9.272244947383145e-01   -1.000000000000000e+00   +7.002692308097899e-01   +4.672002963108490e-01; +9.699530936847395e-01   -3.836576124236893e-01   -3.905974791535041e-01   +7.027685900029766e-01   +7.163564694443985e-01   -3.424502460761026e-01   +4.579337284790273e-01   +2.640357970371563e-02; -2.851195165735747e-01   -5.884224761168431e-01   +6.005770099319574e-01   -5.185864723082156e-01   +2.037901620692978e-01   +4.664602174244231e-02   -8.303974882705852e-02   -4.871677864317392e-01; -1.058925416571776e-01   +1.402672152833990e-01   +1.079371879138719e-01   -3.938566302922865e-01   -7.951698657846600e-01   +2.488722119664348e-01   +1.068957586381291e-01   -3.088571932919252e-01; -1.001142920292684e-01   -5.846249588596470e-01   -1.022312454502345e-01   +1.911874294274036e-01   -1.391761005127266e-01   -5.152824036559110e-01   -1.642876812760231e-01   -5.558355541069050e-01];
L3E_L2E_iAMPA_netcon = [+2.166314408990695e-01   +5.561273700047893e-01   -5.872377649417939e-01   +1.535838679304474e-01   +3.015686910843178e-01   +6.055549150644822e-01   -4.535016729984087e-01   -4.647950679918719e-01   +5.840945572267329e-01   -3.889334153800348e-01   +1.786034505440646e-01   +1.682127417758269e-01; +6.609795841162754e-01   +4.835753146781079e-01   +9.540385843942404e-01   +9.216540381286568e-01   -3.219238869603295e-01   +5.087913750262451e-01   -6.825445645030412e-01   +1.000000000000000e+00   +5.438803353434813e-01   -6.982587368963833e-01   -3.267339538922265e-01   -1.835678643782760e-01; +4.369305629373345e-01   +4.179421925274188e-01   -1.877781534635976e-01   +5.450372100371663e-01   -7.372053010828600e-01   -4.303221298000618e-01   +9.191964062161216e-02   +5.740949719080544e-02   +5.441638600270055e-01   -2.274438546090965e-01   -3.536753756875795e-02   +9.012644668901693e-02; -3.974380355928270e-01   +4.574408634218414e-01   -5.523368285113521e-01   +3.051592512692645e-01   +6.176242718208991e-01   -5.806839907001740e-01   +8.334057286003982e-02   +3.256494513129530e-01   +7.908902958152678e-01   -1.939840023381318e-01   -3.059591044412138e-01   -9.499400307166495e-01; +5.693579300391665e-01   -6.018934647204141e-01   +1.797180073727085e-02   +4.030365759671733e-01   -1.110124431080960e-01   +1.392074039760381e-01   +3.571794293839489e-01   -9.686392525971428e-01   +7.506723867237016e-01   -5.456594857006138e-02   +4.433380378554669e-01   +4.397659004409048e-01; +4.855838323053573e-01   +3.152594356574116e-02   +3.581149545415220e-01   -3.645354870891622e-01   +5.243373346098308e-01   +8.750991640162207e-01   +7.598492112180520e-01   +2.407581671899391e-01   -2.721347360911890e-01   +5.598388373202338e-01   -2.523580994505544e-01   -2.382083319630668e-01; -1.129484824462164e-01   +2.801909435175640e-01   -7.003286365632504e-01   -1.639439915621289e-01   -7.549649453928973e-01   -5.281587657528984e-01   -6.381233613210194e-01   +2.081643768615437e-01   -5.143502328446966e-01   +8.603615061730727e-01   +6.400826041010892e-01   +1.861817165629792e-01; +2.248523650129786e-01   -3.608201176605181e-01   +5.979528236539995e-01   +3.263352665289836e-02   +5.090858921570435e-01   +3.102776154573939e-01   +1.904034254923357e-01   +3.533847190928256e-01   +4.492933587666302e-01   +1.999939037551085e-01   +8.375628357358154e-01   -7.669361691961831e-01];
L3I_L2I_iGABA_netcon = [+1.848786382766075e-01   -6.969364184080290e-02   -5.618901980715297e-01   -1.176927039213396e-01   +1.811447267719913e-01   -2.019640911851245e-01   -1.717283036730982e-01   +1.807201844842251e-01   +8.775729498037062e-02   +4.450800521027474e-01   -2.315133753232519e-01   +2.915414589730371e-01; +6.308856597353248e-01   -7.020032545844637e-01   +6.995649600144074e-01   -3.540495431930991e-02   +4.329960820699275e-01   +1.831189761043360e-02   +1.198478185562788e-01   -6.125264991516367e-02   +8.316358495912403e-03   +1.567761135603008e-01   -2.255070434341022e-01   +3.068933647995996e-01; -3.539652703539491e-01   +5.387556404714952e-01   +3.415346229748895e-02   +6.750441623982238e-01   -4.333095905257751e-01   +6.654464242945288e-02   -1.668225805172140e-01   +4.430076976564488e-01   -6.032849172106672e-01   +3.833504613920712e-01   -5.698070357663115e-01   -7.871211750736531e-02; -5.106505539088380e-02   +1.000000000000000e+00   +1.802807801913328e-01   +3.363057349752064e-01   -4.253629459155262e-01   -3.383889756121756e-01   +8.874095017596731e-01   -7.760409367799718e-01   +7.480791996034925e-01   -5.168788962928607e-01   +4.939319621527035e-01   +2.602128145470641e-01; -7.910583502164181e-01   +5.208181901599398e-01   -4.729433700291327e-01   +5.143821057709206e-03   +7.101862607907571e-01   +7.038294823053547e-01   -3.541250509731718e-01   -7.165594639798869e-01   -7.762677673745721e-02   -2.477655279305068e-01   -1.950863646878457e-01   -5.313626981414817e-01; +1.578587668090633e-01   +3.196932075458912e-01   -1.502451470513389e-01   -7.568484938374762e-01   +7.269114412830492e-01   -2.653100244521401e-01   +1.069622570962861e-02   +8.170873012251632e-01   +6.145176069656814e-02   +5.828014269012007e-02   +2.258782017791408e-01   +2.074244524090834e-01; +2.974773589944513e-01   +5.398067349710988e-01   -4.196788173426733e-01   +5.720696227993488e-01   +2.637389230588164e-01   -4.645433493739487e-02   -1.434971887586264e-01   +7.239537799633371e-01   +4.015342312143807e-01   +3.869310177711511e-01   -4.165987328848326e-01   -5.309078745340661e-01; +1.510371931093724e-01   -4.502847619074162e-02   +7.597251775151832e-01   +3.410004200460624e-01   +2.085417934698337e-01   -1.714848923509203e-01   +7.058698414629050e-01   +5.383810911670864e-01   +1.787156341460076e-01   -2.611735477411707e-01   +6.274894088943710e-01   -3.596871680220322e-01];
L2E_L3E_iAMPA_netcon = [+2.004429234587892e-01   -2.037560583096079e-01   -4.806294809134676e-01   -7.188968328540173e-02   +9.481782371727472e-01   +4.549981271604393e-01   +7.656188770403303e-01   -5.243701700804781e-01; +6.106171203696334e-01   +5.268299202651044e-01   +5.121928511019695e-01   +5.397483913430534e-01   -3.905263993306338e-02   -6.545984331484800e-01   -5.387790239048179e-01   +3.572317424379999e-01; -1.929249473673952e-01   -2.769866222406664e-01   +1.478895516774955e-01   +4.739491457671846e-01   -1.246805788848465e-01   -6.437166311617575e-02   -5.745833033258050e-01   -1.815967670943451e-01; +2.507316504677961e-01   -2.852535758643607e-01   -2.731730375186346e-01   +1.179997051152062e-01   +4.118714437204274e-02   +3.500016956963612e-01   +3.840705295549279e-01   -1.527259793218435e-01; +2.455148006470963e-01   +4.742170075662193e-01   -6.680227300667920e-01   -8.800932472138404e-02   -1.334873980196506e-01   -2.538932597116456e-01   -6.398106649197215e-01   +2.919695553289415e-01; +8.779816609042589e-01   -1.514670329824146e-01   +2.916944986735977e-01   -8.844086354880973e-02   -5.506523891366825e-02   +6.788573475792623e-01   +1.986995642576238e-01   +1.937348178412021e-01; -7.138868230890022e-02   +6.286114470929705e-02   -1.422052940637673e-01   +6.090959828696442e-01   -4.713619126181260e-01   -5.519490817719810e-02   -3.015484505618504e-01   +1.800562161472522e-01; +5.374113423933734e-01   +4.592593059017837e-01   -9.386095399662357e-02   -3.642213871150449e-01   -1.899084024710920e-02   +7.535181991097517e-02   -6.804216956601533e-01   -1.661381059619445e-01; +9.974843592697576e-02   +5.774884095827973e-02   +2.348838512440680e-01   +1.584107434523136e-01   +6.718603843996993e-01   +2.519884163833256e-01   +5.861203967672578e-01   +1.766343885299742e-01; -4.741733453106395e-01   -7.586613130220253e-02   -3.200082250161854e-01   +5.742589924073380e-02   -1.000000000000000e+00   -7.227194286780586e-01   +7.103717440909919e-01   -9.475481637036180e-02; -1.029884217444146e-01   +1.619715375422327e-02   -4.758322292373128e-01   -1.505466828646173e-01   +5.480069751980451e-02   -5.325075864782448e-01   -2.972755481103930e-01   +3.375470291399148e-01; -1.721509800775005e-01   -2.693587264919718e-02   +2.838591566066183e-01   -2.231687167166534e-02   +7.956673633326952e-02   +3.848215908143529e-01   +1.057664947605001e-01   +2.605823422009987e-01];
L2I_L3I_iGABA_netcon = [-6.321344757651750e-01   +1.000000000000000e+00   -2.365069607396746e-01   -1.871002625767188e-01   -2.247729588778822e-01   -1.202289972806832e-01   +7.955420554792887e-02   +1.025558571731562e-01; +1.288545635081420e-01   -5.236933576196673e-01   +6.866500571206433e-01   -3.592493589003484e-01   +1.676386830428453e-01   -3.465843465990481e-01   -3.549932345799902e-01   +2.469559660653712e-01; +3.069706889927133e-01   +5.013042490387397e-01   +4.272902580480081e-02   +3.767300023940342e-01   +8.540461229047451e-01   -1.987289754778913e-01   -6.216057026916509e-01   -2.537644327399389e-01; -1.691685533032859e-01   -7.118819885799146e-01   -1.611164777634540e-01   +6.906784329186790e-01   -3.361408575804547e-01   +2.666059100717779e-01   +6.355632164955680e-01   +3.712155375909932e-01; +3.915987197628075e-01   -5.433034594674848e-01   -6.993225046175892e-01   +6.617474604724572e-01   +4.631844808601200e-01   -3.482431634127475e-01   -6.938749610875445e-01   +1.700455788402960e-01; +2.583904375189878e-01   -2.354879195758548e-01   -7.347201049726737e-01   +3.518586208369484e-01   +3.286917428365932e-01   +2.701906586949016e-01   +4.674873698862309e-01   -2.143453530562996e-01; -1.041313065585747e-01   +5.345019015788436e-01   -3.185373729242871e-01   +5.340275274652641e-01   +4.865722222388990e-01   +1.223245089635314e-01   +4.596179023834260e-01   +1.017013208170406e-01; +2.574231031526444e-01   +4.232750988503395e-01   +1.653494949386982e-01   +9.777159694441720e-02   +6.491093607048620e-01   -2.788335469453834e-01   -3.084053384402930e-01   +1.459050005273769e-01; +3.917739822517075e-01   +9.994875140833182e-01   +4.561324629129492e-01   +5.397263139332699e-01   -2.738384169393112e-01   +3.756386988575459e-01   -6.628717211866252e-02   +1.719766204677358e-01; +4.421843319007654e-01   -4.622986278954377e-01   +1.878206038097226e-01   -3.552850948584587e-01   +4.800490503191676e-01   +4.889494921339341e-02   +3.296609726475800e-01   -1.390834250329341e-01; -6.638993066940869e-01   -2.641696263340483e-01   -2.299361080799801e-02   +4.012298102269003e-01   -7.209832488708742e-01   +1.585208274709762e-01   +2.054713457190101e-01   -7.761819797250161e-01; -3.363306073730151e-01   +4.512316468105931e-01   +2.210365314180765e-01   +1.833460161615905e-01   -8.488479653033452e-02   -6.001633601431466e-03   -1.145726677746079e-01   -8.559423762628603e-01];
L3I_L3E_iAMPA_netcon = [-1.414263398962103e-01   -1.968585974206946e-01   -1.718952415198754e-01   +7.622316774224514e-04   +1.632356802984725e-02   -7.242383261457099e-01   -1.762125848114925e-01   +2.923543270747466e-01   -4.076651082776446e-01   -2.738644623354705e-01   -7.450809056830261e-02   +4.569191872488197e-01; -2.738852424160464e-01   +5.148456895904694e-01   -2.726827120397812e-01   +2.078618881046751e-01   +6.043702911723609e-01   -6.106184864081922e-01   +8.595275012231747e-01   -2.304692135352389e-01   -2.994107538034202e-01   +4.974323872413861e-01   -2.400561611670732e-01   +4.172941320774386e-01; +2.887698271457049e-01   +3.017310219638601e-01   -5.562891474683548e-01   +2.466696476228481e-01   -3.704976505423494e-02   -3.718390620582519e-01   +7.964796704659470e-01   +2.247738197380366e-01   -2.807744099477719e-01   +5.652824821647182e-02   +3.545317339832991e-01   +5.001573393011189e-01; +3.653547857048731e-01   +7.972209688561849e-01   -2.626529875708991e-01   +4.533901125476423e-01   +2.761732073850260e-01   +6.874636408710720e-01   -4.065898167674043e-01   +1.264503743287846e-01   -3.336557528922656e-01   -4.457819082363977e-01   +3.933128747008865e-01   +3.092250252311019e-02; -5.709847376334555e-01   -1.855721893516606e-01   +2.247358542488169e-01   +3.858063545267404e-01   +1.757213138157990e-01   -8.814472501720212e-01   +1.826379694030640e-01   -5.190189544690987e-01   +9.408347573416895e-01   -2.523150710893264e-01   -7.074953219692981e-01   +1.274205317334033e-01; +4.867939744665936e-01   +2.070670325566124e-01   +3.052475884132424e-01   +7.014313391910767e-01   -2.287618558394587e-01   -2.713316676005987e-01   -2.255561535256281e-01   +3.013371422494139e-01   -3.305545579448237e-01   +3.273615386809517e-01   +6.425488758578265e-01   -4.276797184015252e-01; +7.724861997409771e-01   +1.090740104370180e-01   +4.307035473485113e-01   +2.248250162118246e-01   +3.811632495431506e-01   -2.258458129170793e-01   -2.500219661968011e-01   +9.059388359676167e-01   +2.431107337723975e-01   -2.930510415507716e-02   +6.054787462692479e-02   +4.715992171291620e-01; +3.009699221133124e-01   -1.000000000000000e+00   +7.863495443696362e-01   +1.982260797122663e-02   -9.867481131363830e-02   -4.684572956584998e-01   -1.274575480196954e-01   +2.360338678148301e-01   -1.136891280229663e-01   -3.927144617448058e-01   -3.056986634002386e-01   +4.394176394234121e-01; -2.021611889422937e-01   +5.674886116555167e-01   -5.994766238342502e-01   -1.135890253229316e-01   +1.265200392897926e-01   -4.425701889048590e-02   -2.632614909868378e-01   -1.759393982987513e-01   +1.687374974864523e-01   -3.132329855853880e-01   +5.784645409340660e-02   +3.511215883493722e-01; -4.800275192508833e-01   +4.652859910129228e-01   -1.255321650543724e-01   -4.604111130854940e-01   +2.503155045290386e-01   -2.299106310041807e-01   +1.060532005100372e-01   +6.757769288101507e-01   +7.601927124161592e-01   -1.043308676221277e-01   +2.259023571808760e-01   +1.418313661702923e-01; -4.918066050370019e-01   -2.021236079659802e-01   -3.010716274011725e-01   -3.089169015326367e-01   +4.625936570805863e-01   +9.054258500417603e-01   +3.784105546692343e-01   +5.111367148532536e-01   -7.539266019199762e-01   -3.376415808683574e-01   +9.647682635361510e-02   -7.952107775795184e-02; +1.485407889035996e-01   +3.764999068361296e-01   +2.474201105236682e-01   -3.542120691424465e-01   +2.713813222026272e-01   -2.317128598492861e-01   -6.284652168845256e-01   +6.273489083219509e-01   +1.743745995893271e-01   -1.598125520471227e-01   -7.063114622360881e-01   -5.010303904464215e-01];
L3E_L3I_iGABA_netcon = [-1.366559324178347e-01   +4.546599408434406e-02   -6.647871154544154e-02   -1.159971220534432e-01   +8.432416795532233e-02   +1.321372684736710e-03   +6.511545374292418e-01   -1.527551184138662e-01   +6.989664719206434e-02   -1.227089400466048e-01   +1.640778335436243e-01   -2.326600492388885e-01; -2.617872684181267e-01   -4.974217147227702e-01   -9.183986125907990e-01   +5.087797545029652e-01   -1.344259155805488e-01   -3.655309905119601e-01   +5.789985631910918e-01   +8.190871191870490e-02   -1.914347144562422e-02   +4.529552381783738e-01   +1.484904722520387e-01   -7.694154132121986e-01; +1.854839106110922e-01   -2.596096057910278e-01   -6.031100874166065e-01   -6.178428276301113e-02   +1.380037671674248e-01   -5.037858547802211e-01   +5.450861024749598e-01   +6.639410150294868e-01   -2.253713672602530e-01   +5.555984513359271e-01   -7.684001465389377e-01   +3.206672254873784e-01; +6.125336103841623e-01   +8.711991085710073e-03   -3.454239093884650e-01   -4.104644239542818e-01   -4.065560152425336e-01   -3.106555784978092e-02   -2.466451612477573e-01   -1.000000000000000e+00   +4.753857347870619e-01   -7.132956789361032e-02   +8.414553734173902e-02   +4.542754993545972e-01; -5.529579174397022e-01   +3.234803974713731e-01   +4.924027612288417e-01   +5.168112511797873e-01   -6.286738531749564e-01   +3.072652895469730e-01   +2.034890137851385e-01   -2.581330236367140e-01   -2.747190274372957e-01   -2.743253911644286e-01   -4.236869047165618e-01   -6.673449358897804e-02; -5.112627978147014e-01   -1.546535153396806e-01   +2.557205057933590e-01   -7.097855021901779e-01   -3.378518594638893e-01   -8.334780410447896e-02   -1.910482270082257e-01   -3.087690233081272e-01   +1.776440988124064e-01   -1.596900803314293e-01   -4.872263226464885e-02   +5.870972749705616e-01; +4.056649499969997e-01   +2.461037860222130e-01   +3.489815124319968e-01   +2.205545135771227e-01   -4.337926869028436e-01   +5.512123204136717e-01   -5.202151098126868e-01   -2.569254551868539e-01   -2.365246805295412e-01   -2.262764361508773e-01   +2.262615727525646e-01   +4.424179702427536e-01; +1.716695695945215e-01   -4.837167270423283e-01   -1.959999619777565e-01   -1.039330579819308e-01   +6.777375371418703e-01   -6.869801607239610e-01   +2.020777568763896e-01   +5.651786731869857e-01   -3.994286982928163e-01   -5.231763254261537e-01   +2.039921613465598e-03   +1.494621842551353e-01; +5.554098628018221e-01   +6.204586000683203e-01   +5.104927678669527e-01   +6.214055499800453e-01   +7.698618244233844e-01   -1.513845428548746e-01   +5.310119693733474e-03   +3.661352063935051e-01   +1.004501607124831e-01   +3.223616696419782e-01   +9.559687270183513e-03   -4.739705197781566e-01; +2.655231389598445e-01   +2.204903609634049e-01   +2.172045168782023e-01   -6.150339951408708e-01   +7.616922871864995e-01   +4.265914081440126e-01   -1.096912149733161e-01   -2.173437049176635e-01   +7.980546565005532e-01   +6.413495249474113e-01   +1.517280324327751e-01   +1.151407987610983e-02; +1.177409433392308e-01   -5.663674290041757e-01   -3.449089890545426e-01   +4.695845905250932e-01   +1.169480924524302e-01   -2.190615019925093e-01   -4.873428500425815e-01   +1.711523778038444e-01   +3.068841609412531e-01   +4.251344831995867e-01   +1.203543048866465e-01   -5.770284737485468e-01; -1.927460736684067e-01   -6.901084861000782e-02   +3.825998602274280e-01   +3.202821442744058e-01   +3.489930291382080e-01   -1.709759192089821e-01   +3.736141414700470e-01   -2.512817909689844e-01   -4.456557627561272e-01   -1.935596332807423e-01   +3.366964720219216e-02   +5.483041650165955e-01];
L2E_Input1_iAMPA_netcon = [+7.837998489477455e-01   +4.692422774022366e-01   +1.419067884199341e-01   +7.328878423901737e-01   -1.332828064744562e-01   -1.000000000000000e+00   +8.903654029582470e-01   -6.355280536823902e-01];
L2I_Input2_iAMPA_netcon = [-8.896204630976234e-01   +1.000000000000000e+00   -1.742851175623032e-01   +1.309662777061868e-01   -4.845861432326807e-01   +4.222391619963137e-01   -1.494194899157523e-01   -1.098806689893750e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
