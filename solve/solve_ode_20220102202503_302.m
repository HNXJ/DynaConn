function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.209606170920196e-01   -3.057695219089412e-01   +4.790822647607628e-01   +2.941197912545884e-01   +7.630222752817552e-02   +2.057153394265898e-01   -6.821498815902075e-01   +1.099162747309056e-01   +5.645040515500893e-01   +6.525379855156007e-01   +1.718329780018206e-02   +6.430723922316499e-01   +2.555753236865544e-01   -5.869057137444251e-02   -3.039043041879309e-01   +5.537502106628549e-03; +4.289156401465956e-01   +1.374242455707121e-01   +5.871603364224033e-02   +3.653656942861500e-02   -2.348404964516262e-01   +5.275170828557187e-01   -7.077596814213247e-01   +9.040349595901657e-02   +7.105139635856886e-01   +1.026645932268266e-01   +1.000000000000000e+00   +5.594999511070944e-01   +2.777661113287308e-01   -2.071023128990766e-01   +4.265417454329753e-02   -1.265538934011212e-01; +4.957031229673083e-01   +2.717556440425030e-01   -1.841676734863971e-01   +1.275448961186708e-01   +1.976211954618748e-01   +7.205777922159846e-02   +4.030656691617124e-01   +1.781529519398250e-01   +4.462402587123291e-01   +2.947952845464993e-01   +4.115377811839450e-01   +2.719450148881702e-01   +2.297424513628109e-01   -3.263808547429022e-01   -9.804318291945099e-02   +2.508160887293670e-01; -5.872534001927818e-02   -8.917431873281810e-02   -2.166548672366773e-01   +4.288093690596282e-01   -9.899374591225704e-02   +3.414053154560211e-01   +5.340168644721293e-01   +7.311542521964308e-01   +5.531162981813532e-01   +1.326457506900227e-01   +4.711533250401219e-01   +4.264644540366930e-01   +1.924188760707314e-01   +3.468487889921412e-01   +4.110604596103418e-02   +7.545283263673119e-01; +3.333524352694202e-01   +2.236074767825459e-01   +4.343775408278498e-01   +7.257997794074589e-01   +6.796243052369572e-02   +2.513792778065697e-01   +1.612412699189409e-01   +2.952719106375014e-01   -8.737424457196429e-02   +3.402412548297132e-01   +6.174826823687002e-01   -3.109702430763517e-01   +2.062970863538060e-01   +7.713304678034334e-02   +4.124592406595374e-01   +2.905965768648760e-01; +1.633012600670242e-02   +5.215344450013634e-01   +1.464028358860254e-01   -4.403679285027717e-02   +6.272058663828891e-01   +1.235295281744022e-01   +5.218758158269754e-01   +2.947057226259512e-01   +2.569599300880308e-01   +2.949391931172504e-01   +2.028452779827513e-01   -3.862050885031187e-01   +2.031911367408601e-01   +2.436519376446949e-01   -2.637471163846071e-01   -1.134231542741832e-01; +2.941288841511357e-01   +2.736086584587462e-01   +4.215897310414691e-01   +1.548146720119221e-01   +1.143836674194207e-01   +3.019428038140288e-01   +3.442647779706665e-01   +1.522279882412921e-01   -1.401752918847886e-01   +7.600286728034569e-02   -1.343357722732159e-01   +2.954623402540681e-01   +3.350266685325087e-01   +2.014945123584874e-01   +4.061948648222085e-01   +4.174399164122530e-01; +3.909028718585789e-01   +1.368604477705329e-03   -1.507537505952816e-01   +5.380769852528730e-01   +3.747777341978355e-02   +2.008191916585945e-01   +7.869674334957673e-02   +7.067384949325898e-01   +4.580218258080799e-01   +2.620938288161553e-01   +2.702637093398801e-01   +3.070056955663082e-01   -1.309597381096037e-01   +1.507944336725220e-01   -1.931863727492475e-01   +2.533022067477402e-01; +8.043636228541845e-02   +3.461970773818845e-01   -2.620173433192792e-01   +3.938462647283054e-01   +4.249856906705885e-01   +3.550413894503000e-01   +1.118096471115738e-01   -5.186190843192903e-01   +2.003585542893612e-01   -6.981133355336611e-02   +5.418588392943899e-01   -2.382923802149857e-01   +3.413227881280586e-01   +4.026548257155529e-01   -4.225813001997817e-02   +1.829015329055074e-01; +8.989024780838645e-02   +6.153905470574921e-01   +4.607318809535215e-01   +1.867126909213885e-01   +7.026167858985160e-03   -4.444167480399011e-02   +5.900489691715518e-01   -4.024413444256233e-02   +1.775807162133634e-01   +1.136455749545337e-01   +3.838430534309630e-01   +1.440839708389137e-01   +5.079513704010692e-01   -1.756604947235161e-01   +4.432031771621716e-02   +4.043486702296122e-01; +5.894238892559445e-02   +5.408623225120253e-01   +1.478817509042576e-02   +1.227001776656270e-01   +6.535771003477078e-01   +2.284826118470964e-01   +4.803424435867701e-01   +7.462087903252242e-02   +8.274616089408056e-02   +4.420915137775658e-01   -3.325978253263584e-01   +2.551233545413734e-01   -3.632885635127797e-01   +4.606113973300803e-01   +4.592627941102692e-01   +3.178330733198714e-01; +3.486076955013641e-01   +2.803165664257962e-01   +2.489364817820159e-01   -1.445008545556443e-01   +1.942932360865857e-01   +2.472867218827672e-01   +2.495725532257171e-01   +2.549785940987432e-01   +6.796106428880492e-01   +1.112050550629845e-02   +3.619249033523020e-01   +4.333492179407272e-01   +4.459683697867109e-01   +8.144566581636208e-02   -4.730149795866551e-01   +3.341965444859757e-01; +1.003738050306566e-01   +2.593104318203571e-01   +6.721568179443140e-01   +1.978121380097261e-01   +5.271836587855564e-01   +4.955522425092946e-01   +1.059130538959939e-01   +3.856079679313427e-01   +7.297594334504924e-01   +2.709739911647263e-02   +5.774943405824063e-02   +5.433517893810516e-01   -5.164624905147903e-02   +6.193658731812374e-02   +7.251074988875353e-02   -1.019604896693311e-01; -4.010391708107112e-02   +1.548394965278722e-01   +3.612180036006699e-01   -7.126225558644020e-01   +4.459730402663097e-02   +7.358760953859214e-01   +1.034259350626674e-01   +2.834871268790307e-01   -1.510164713819628e-01   +8.308565454320960e-02   +4.219916522354983e-01   +1.153883816143111e-01   +3.586575876945280e-01   +5.188818034800832e-01   -1.257727387821927e-02   -6.471980893604633e-02; +3.944773604817106e-01   -3.474354285536783e-01   +4.987388151060920e-01   +2.936212294918980e-01   -3.175938421878769e-01   +3.811155535625757e-04   +2.596223153483154e-01   -6.555458085702340e-02   +1.229265833834310e-01   +8.150413747538940e-02   -8.637983626308397e-02   +3.471779355336307e-01   +3.317763856189158e-01   +6.179656375653196e-02   +8.453240984564982e-02   -3.545184872383336e-01; -4.725445542673281e-01   +5.175527555502619e-01   +7.700798857229500e-03   +4.169791834962668e-01   +8.753014147765840e-01   +7.411090465237365e-01   +7.406396663062956e-03   +7.655957484791212e-01   -1.731071340315020e-01   +4.338006619860358e-01   +2.919518864006740e-01   +4.038747817919556e-01   +5.291048791066542e-01   +3.935769604021456e-01   +5.922007066962107e-01   +7.398828338184049e-02];
L1E_L1I_iGABA_netcon = [+1.451765890236384e-01   +1.134570342686962e-01   -3.734855729404736e-02   -1.681462087387584e-01   +6.910367215120412e-01   -1.362728519439813e-01   +9.196166914001663e-02   +2.813378294817532e-01   -1.313564679217170e-01   -1.823773952332341e-02   +3.770923122533109e-01   +3.722387993711761e-01   +8.122752358078457e-01   -5.348611074848083e-01   -2.477228113280803e-01   +7.058363600955526e-01; -4.526819788503888e-01   -1.348439670474057e-01   +5.210077406479767e-01   -4.158387825297822e-01   +2.217788678074930e-01   -3.631952169107248e-01   +4.529470889989063e-01   +4.523207848926279e-01   +4.608859100413655e-01   +2.127208263284454e-01   +4.741939801354577e-01   +1.218297694428229e-01   +6.569344492282314e-01   +1.808889617597500e-01   +1.705813931818940e-01   -5.344160209826435e-02; +1.660955925303756e-01   +1.458837762505990e-01   -1.657593628095324e-01   +5.371322627265599e-01   +1.588765088367797e-01   -2.382363879546874e-01   +1.694508406095123e-01   -3.547524921659083e-03   -2.990264437613863e-02   +7.810709715593220e-01   -7.682844943255969e-02   +3.035237496841927e-01   +1.159982277431621e-01   +4.439272468892334e-03   +5.628474929479941e-01   +2.909701295589588e-01; +4.263168819192269e-01   -1.387699320528310e-01   -8.531663944137881e-02   +3.657591111356672e-01   +2.068004324338928e-01   +4.464509103259536e-01   +1.733623578813079e-01   -1.881715651085052e-01   -4.499536094376098e-02   +2.367673571253830e-01   +3.252644206365756e-01   +5.957827062132435e-01   +2.339323852404158e-02   +3.786130159489010e-01   +1.211035550729340e-02   -2.698936783530113e-01; +1.452219737549671e-01   -8.535436372096540e-02   -1.307219348447703e-01   +2.900179463765026e-01   +2.539611003553342e-01   -1.195208665908904e-01   +1.258863577067082e-01   -3.548486990494638e-01   -8.525346846308560e-02   +2.500213468675656e-01   -3.906397624797921e-01   +7.087236145589002e-01   +1.471818954536225e-01   +1.983779073895558e-01   +5.979716608545296e-02   +2.961640542976332e-01; +1.872279392267408e-01   +1.394323604044054e-01   +1.449089159012621e-01   -1.716837243233990e-01   -4.213101100732418e-02   +7.371153141945962e-01   +1.304300326036765e-01   -5.340792374687915e-01   -2.066104979128149e-01   +2.229977949386138e-01   -2.241814667839312e-01   +4.413025399897637e-01   +7.842035776152249e-02   -2.944038498612917e-01   +4.770928788927828e-01   +2.825162426101711e-01; +4.738699172495192e-03   -9.009500571245105e-03   -8.497783398555037e-02   -2.470346054315949e-01   +4.831388738410752e-01   +2.465458467987257e-01   +1.109726237595483e-01   -2.319592637209672e-01   +5.611643982394861e-02   +3.870705150845994e-01   +5.246451672265916e-01   +3.655252009013382e-01   +1.960587382565157e-02   +7.256536716637635e-02   +8.485965038173935e-01   -3.486232593140823e-01; +9.569239786228716e-02   +2.666353943807545e-01   -7.561545730561341e-02   +1.319949680766079e-01   +1.079881548296942e-03   -1.998346573265246e-01   +5.032972831727264e-01   -6.146618675391505e-02   +7.389798167201326e-01   +2.211872291283485e-01   +1.369143710418819e-01   -3.920150039623497e-01   +2.023325163579975e-01   +3.160837859541321e-01   +3.346230430917316e-01   +3.300958753997305e-01; +6.544734264074288e-01   +8.771264958892517e-01   +2.605203190313221e-01   -1.569014919799966e-01   -3.917470929569030e-01   +2.877363084450840e-01   +3.057664259697747e-01   -5.215126314255669e-01   +2.387931433766389e-01   -1.257179624388836e-01   +2.248759790041198e-01   -2.380855450933307e-02   +1.163408842295753e-01   -9.223284976307128e-02   +8.424552908639897e-01   -1.020703319567224e-01; +3.573687646792759e-01   +4.469086050166496e-01   -6.792837684516548e-02   +1.873580471666725e-02   -2.204514136108132e-01   -1.518424632922280e-02   +3.323804159192263e-01   +2.300954100217130e-01   +3.826319685362914e-01   +2.014603599176054e-01   -4.654615537305684e-01   -2.385425148205551e-01   +4.491194852477501e-01   +5.268867784459521e-01   +2.828842534633224e-01   +2.420417434843137e-01; +4.130864376945471e-01   +2.018502428475627e-01   +3.329799403004354e-01   +4.662938650167063e-01   +1.639020462066117e-01   -5.264900140941338e-02   +7.699054584014708e-02   -1.150202928290384e-02   +3.090113223778749e-01   -5.404075163610057e-04   +7.583495663860615e-02   +7.879702437977748e-01   +7.562824667654959e-01   +1.985328607900215e-01   -4.860428932948634e-02   -4.436563065377236e-01; +2.111643350897534e-01   +2.672651671351005e-01   +5.067377345495611e-03   -5.110769794801985e-01   -1.350495591087766e-01   +1.423738075807429e-01   +6.710328602643684e-02   +6.020142989846344e-01   -1.911879517351349e-01   -2.272410314282322e-01   +2.744866244519529e-01   +3.511139052009540e-01   -9.244847985985466e-02   +1.064270198996518e-01   +3.487052229493161e-01   +5.090631670974584e-01; +2.540273752241825e-01   +2.750954357244051e-01   +1.664747817476145e-01   +6.103747257244480e-01   -2.724159087008433e-01   +3.669294313047455e-01   +1.098086488418380e-01   +3.784576381074521e-01   +5.081183456897916e-01   -2.352538012054905e-01   +1.833577059414767e-01   +2.890712838452262e-01   +2.921227022095709e-01   +2.341478814565479e-01   +6.415793672160705e-01   +2.243068278951107e-01; +5.118876311394660e-01   +5.612997438972237e-02   -1.173318890788980e-01   +1.098235553296041e-01   +8.914415168718981e-02   -3.129983572202002e-01   +1.226548469823748e-01   +2.764137527249435e-01   +3.569008150577788e-01   -1.839145101977181e-03   +5.164288225071062e-01   -2.230174654090500e-02   +2.080849889468386e-01   -8.792715780448129e-02   +2.341244659117009e-01   -4.488780209207526e-01; +4.066380510158196e-01   -2.650518802345357e-03   +5.402680295278545e-02   +8.489449199883099e-03   +1.385229559150314e-01   +1.372140300522658e-01   +4.081940028070039e-01   -4.084776266424602e-02   +6.010106196563952e-01   +8.546881008497750e-02   +1.989646833030096e-01   +1.524537238518738e-01   +2.248500189997819e-01   -2.715229752612880e-01   +5.823029168070171e-01   +6.080936399347255e-01; -4.562461323990264e-01   +2.888235721837779e-01   +1.569206112830292e-02   -1.990376855678713e-02   +6.128253598670674e-02   +4.254372138004134e-01   +1.524300470668960e-01   +1.769530539397404e-01   +6.776493024571197e-03   +3.551492444486582e-01   -9.561695432972594e-03   +2.478955257103029e-01   +2.475230462130818e-01   +2.433325339571198e-01   -2.085139304379141e-01   +5.741177450204362e-01];
L2I_L1I_iGABA_netcon = [-2.077748602788706e-01   -1.978097940354248e-01   +2.109400611759935e-01   +5.142834850065879e-01   -7.183822012942513e-02   +1.237792052220375e-01   +3.490489899919131e-01   -4.304362710961810e-01; +3.470414713312149e-01   +6.054888188951139e-01   -2.282447151642245e-01   +1.665574549254523e-01   +4.572980070967331e-01   +5.833290026885447e-01   +3.078102920816815e-01   -1.234406840115618e-01; +5.361492300727045e-01   +4.459571132452902e-01   -3.090420726210576e-02   +3.971452037155983e-01   +4.132118782051938e-01   +3.119115453991351e-01   -2.603910576099671e-02   -5.543567417633562e-02; +7.182216651532702e-01   +1.405226515116101e-01   +4.917997885836202e-01   -1.544441706818316e-01   +3.880280476204214e-01   +2.732674894978440e-01   +5.677780066594120e-01   +2.720048476427709e-01; +1.879468794778058e-01   -1.884073257603223e-01   +4.691082403521395e-01   +3.080712483179792e-01   +4.372469651512665e-01   +2.056994684251784e-01   +2.303546721415832e-01   -6.287754953151078e-02; -1.665052666516630e-02   -2.170755656441215e-02   +2.801376310539184e-01   +3.446269122908631e-01   -2.087716735087991e-01   +1.883723444464879e-01   +2.521907445858831e-01   +4.624218952795192e-01; +5.993375010262930e-01   -5.996997538173772e-03   +3.084996889229661e-01   -2.405904142182565e-01   +2.153941990656826e-01   +5.410521591162842e-01   +5.492737621147188e-01   +1.024892935479934e-01; +1.655122613678391e-01   +4.387470314704981e-01   +1.452539585623383e-01   +9.206944616175540e-02   +2.460194703510653e-01   +2.096804786531210e-01   +3.335614488684729e-02   +1.811036318115285e-01; +1.436579911287369e-01   +9.467842610538568e-01   -5.295391572989377e-01   +2.493436340140344e-01   -1.734919212427924e-01   +2.634853608393287e-01   +1.721571840856234e-01   +1.176107945244293e-01; -1.232677711229189e-02   -1.364747198352408e-01   +1.693849220587964e-01   +4.094041533952983e-01   +5.332241024328310e-01   -6.255160640126328e-02   +2.104987948786061e-02   +2.075672921396405e-01; -2.529638110404351e-03   +5.175759286943080e-02   +3.608275773215051e-01   +3.095259531372480e-02   -1.115049966081448e-01   -4.802342826419878e-02   +1.518683326963649e-01   +2.620482738381959e-01; +2.245065311391844e-01   +5.622554158436731e-01   +7.038454725023349e-01   +4.634567456384087e-01   -1.243179972545651e-02   +1.631260758777306e-01   +3.824936098242269e-01   +3.327639389622280e-01; +3.928578029557793e-01   +6.746851995571936e-01   +4.245418188276180e-01   -8.327595806196217e-02   +1.533610291413334e-01   +2.293369479453984e-01   -1.810665429573817e-01   +2.706890464010326e-01; +3.414595263795974e-02   -2.269970142159501e-01   +2.681713888681648e-01   -3.957405524199697e-02   +5.184348860238286e-01   -2.754740835719631e-02   +4.932255187283481e-01   -1.708061821550190e-02; +3.037898668398759e-01   +1.131074482922518e-01   +4.561486300317582e-01   +1.295079919541751e-01   +1.827240577486904e-01   +9.452610462678271e-01   +2.943503434427486e-01   +3.535370563369803e-01; -1.002267851032393e-01   -5.161900454141427e-02   +2.524269447318356e-01   +2.505698974139737e-01   +4.293069260162131e-01   +5.841065009905725e-02   +2.496552898525859e-01   +1.752481182158729e-01];
L1I_L2I_iGABA_netcon = [+4.286330764037590e-01   -4.231307694911971e-02   -2.388896768172942e-01   +5.521527777068638e-01   -9.513340013413141e-02   +1.438073624298106e-01   +6.867623474168087e-02   +5.209283736688982e-01   -2.735047940997055e-01   +6.176608475732603e-01   -6.775643541703452e-02   +1.523241756681707e-01   +1.622195524452302e-01   +3.421036069194044e-01   +1.487257794111565e-01   +4.771514965696641e-01; +5.070615460125506e-01   +1.492540835572509e-01   -1.087886055011598e-01   -8.484603068657921e-02   -2.642821735311244e-01   -1.634179953886571e-02   +5.234945161163249e-01   +3.776397370681623e-01   +4.383026917004213e-01   +7.611468235500172e-01   +4.829339914848142e-02   -1.084086872205836e-01   -2.197910376230942e-01   -5.539037877366882e-01   +2.802262052600781e-01   +4.608529433414118e-01; +5.136460407287436e-02   -2.052866954422174e-01   +5.496138839324358e-01   -8.081647438425066e-02   +3.711222255260455e-01   -2.595045904101835e-01   +6.415362488450249e-01   +5.526017679872901e-01   -3.422606560431904e-01   +1.993730201584761e-01   -7.515488619528946e-02   +3.185871918426482e-01   +6.109758745830066e-01   +4.347830723226966e-01   +9.076718984656084e-01   -1.945318787434596e-01; +3.135860461885742e-01   +6.320881174225157e-01   +3.499082058033524e-01   +2.487592780449985e-01   +5.120613956934965e-01   +5.392350022429050e-01   +7.595356768922704e-01   +4.156542545563641e-01   -4.341052279543623e-01   +6.735917934926566e-01   +5.615840343947855e-01   +1.279057514172027e-01   +2.740926067773859e-01   +2.648786839239906e-02   +3.761822178939037e-01   -8.046064258563683e-02; -1.308578817632996e-01   +6.600037660567196e-02   -1.857645400046392e-01   +2.179033556675077e-01   -9.585128906384335e-02   +7.722484701382131e-01   +7.712578035361342e-01   +2.283114117919500e-01   +6.684609236513681e-01   +5.416812462534946e-01   -2.769770475683277e-01   +2.558081152064826e-01   -4.328855798348801e-01   +3.144858006891427e-01   +1.518206946234614e-01   +6.213071568076391e-01; +1.547292718543905e-01   +4.552236934492682e-01   -5.592470069459603e-03   +6.080068930178324e-01   -8.600552407145616e-02   +2.693551872182566e-01   +3.487881022664096e-01   -7.212906761927919e-02   -1.296465673348657e-01   -4.074782285832923e-02   +2.261598666834408e-01   -6.413843337984661e-02   +6.003476365922735e-01   +9.198112440316200e-01   +3.992114396652572e-01   +5.845325296182784e-01; +5.607190954649148e-01   +4.902661644197399e-01   -2.464707675986002e-01   +4.223551746391378e-02   +4.592356695014101e-01   -3.280207278567926e-01   +5.254674398537772e-01   -6.407636099894397e-02   -1.735675818073968e-02   +3.722364675336665e-01   +5.089913066779995e-01   +3.988924802403830e-01   +1.340075932905238e-01   -2.451503707577090e-01   +2.552145939779117e-02   +4.038007080470945e-01; +5.131343077254896e-01   +1.191691187311371e-01   -5.122302774560879e-03   +4.373231997456070e-02   +1.694413967832705e-01   +4.279407331522487e-01   +3.366585906692358e-01   +9.602760500907487e-02   -2.230170290104079e-01   +3.718322762960277e-01   +5.535050157853492e-01   +4.691323159994947e-01   +2.743751407628590e-01   -2.925589071594624e-01   +4.388272781626105e-01   +3.943402729392457e-01];
L2E_L1E_iAMPA_netcon = [+4.141448026475392e-01   +1.387894887800588e-01   +9.923980580326441e-02   +4.125530856776551e-01   +9.958179408774691e-01   +4.630029949361534e-01   +4.064464420832641e-01   -2.715030933118663e-02; -2.176591337244646e-01   +2.579145231646878e-01   -1.515235061186927e-01   +2.219743395377672e-01   +5.400199749363160e-01   +1.391025467928684e-01   +3.985650122431288e-01   +3.471747635232201e-01; +1.759946658160288e-01   +5.083797506001468e-01   +4.660499635727103e-01   +2.064739709208503e-01   +2.096226688031722e-01   -8.487164762213564e-02   +1.837535809752587e-01   +2.943876410697872e-01; +4.141381007921549e-01   +1.080150268701436e-01   +9.861576897177397e-02   +3.721573114430969e-01   +1.820396643404764e-01   +1.734715788075753e-01   +2.308558314859367e-01   -1.526938740679167e-01; -3.835546638447807e-02   +1.895452742457503e-01   +5.522144850942202e-01   -1.594002737128798e-01   +1.720107075872973e-01   +6.326539371900829e-02   +2.162816353631064e-01   +4.419145823248122e-01; +3.557420405784704e-01   -1.916240871491535e-01   +1.162332490742898e-01   -1.342008870856103e-01   +4.651233440238438e-01   +7.012605199229295e-01   +5.264543806762907e-01   +1.822622024247237e-01; +2.498868805517597e-01   +5.662891826103723e-01   +2.860657360053898e-01   -2.664113073468672e-02   -2.645856189766255e-01   +4.169367792664025e-01   +9.151362575019011e-01   -1.413016786516572e-01; +2.038295579926972e-01   +4.399126804537277e-01   +8.521681486970312e-01   +4.355036611216957e-02   +4.093178092625731e-01   +1.600144768600788e-01   +3.423517377232165e-01   +2.576015060225992e-01; +4.935367649692460e-01   +3.132631764399570e-02   +3.691751280194066e-01   +7.090387165712114e-01   -1.803663531813624e-01   +4.681555744229990e-01   +2.769749604964674e-01   -8.090260990191113e-03; +1.827650130026446e-01   +6.199785135713911e-02   +1.629606833527952e-01   +3.358257520385137e-01   +1.743716046027591e-01   -4.884172559960501e-02   -4.474522496795769e-02   +3.089182485773971e-01; -4.267005890689425e-01   +6.043699258899995e-01   +5.758780026849979e-01   -3.191058829309966e-01   +2.649102677123347e-01   -4.037935652775713e-02   +8.817159252700725e-02   +1.659661722927176e-01; +2.216144405445766e-01   +2.440058947566300e-01   +5.260407194691409e-01   +1.815792686166892e-01   +2.837160842860918e-02   +4.610553144665962e-01   -2.787647983621937e-01   +3.522239627998714e-01; -2.204054861935861e-01   +3.185442437155822e-01   +2.169415107462585e-01   -6.068636314220445e-02   +5.442968500840674e-01   +7.245239319034476e-02   +4.291424470137172e-01   +1.210507540836241e-01; +2.495516076944847e-01   +5.527517562541707e-01   -4.382059428192900e-01   +1.990135304937209e-01   +2.369689575400961e-01   +2.609729421387083e-01   -2.960135046780513e-01   +2.788004362146618e-01; -9.238587703289181e-02   -8.165629184392129e-02   +1.728405928510294e-02   +4.152121816438744e-01   -1.397546800521240e-01   -2.180308362861770e-01   -9.962517706236915e-02   +4.677592194257690e-02; +1.953704194311852e-01   -8.016510933364490e-02   +2.750647474483879e-02   -1.399640109666072e-01   +2.296023768294842e-01   +2.643584454826687e-01   +5.417170590041057e-01   +4.632345746144163e-01];
L1E_L2E_iAMPA_netcon = [+2.835492221947291e-01   +2.716859189042267e-01   +1.961113568629175e-01   +7.633447027717838e-02   +3.818654005540552e-01   +1.985100376731654e-01   +2.124725757147723e-01   +1.651961406998907e-01   +5.115366065940043e-02   -1.762822654858299e-01   +5.670918708599674e-01   +3.136713932350418e-03   +1.785100501414805e-01   +7.840474337320837e-02   -2.900514108903997e-01   -2.456268739647036e-02; +2.134229659914611e-01   -3.264356852500709e-01   +9.144280108234363e-01   +3.572894072836282e-01   +2.203385353419458e-01   +2.533737255574713e-01   +7.711863350020083e-01   +3.993974469765563e-01   -2.010385053263583e-01   +1.694598284538540e-01   +3.968741613557779e-01   +3.704178354270024e-01   +6.449617248427957e-01   +2.073337686084145e-01   +3.687974341015575e-01   -2.978824332728846e-01; +6.205520984140339e-01   +3.278735410328634e-01   +8.400535415519127e-02   +1.341880246412723e-01   -6.755394206640369e-02   +3.900765179944617e-01   +1.840458175435534e-01   +2.570164743690849e-01   +2.052682895631349e-01   -1.500626357474107e-01   +4.675999341730412e-01   +8.345846673828758e-01   +2.649193261752236e-02   +4.535031046934348e-01   -9.383187085896542e-02   -2.777733359509646e-02; +1.927144726079325e-01   +9.625234599694849e-03   +1.793488633576946e-01   -1.072079926199948e-02   +1.668601542575860e-01   +5.956842838390051e-01   +9.339413314509100e-01   +1.226964318051919e-01   -3.240188946906010e-02   +1.540909072216926e-01   +2.922658459492821e-01   -1.982597446586476e-01   -2.717516443901482e-01   +9.898875919686159e-01   +2.636851214952842e-01   +1.029428295085818e-03; -1.053089890265388e-01   -5.391690066897376e-01   +4.993904664624054e-01   +1.024021296580939e-01   +2.558689953175456e-01   +4.731041626137204e-02   +5.860280554358147e-01   +2.154976009278449e-01   +3.511168759001293e-01   +8.117061998289563e-02   -1.466883453351090e-02   -3.811638965811582e-01   +4.702562388343737e-01   +2.105291713317862e-02   +6.307180317811875e-01   -7.417685835459474e-02; +5.608691204256537e-03   +4.686272304632016e-01   +6.498672648391485e-02   +7.062960547248820e-01   +5.672260552215025e-01   +6.122529788036987e-02   +6.566741096959707e-01   +6.561135623835207e-02   +4.115519002296227e-01   -3.814986423824349e-02   +6.101921093078155e-01   +9.752602607838838e-02   -2.704439218514574e-01   -1.935664600687223e-01   -4.957276917868018e-01   +3.727662974896016e-01; +2.100408956882324e-01   +1.221327193900919e-01   -1.891107781350516e-01   +2.428739622081409e-01   +3.732237502085430e-01   +3.823259196771701e-01   +3.482471813616067e-01   -1.637893626027177e-01   -3.023791616606133e-01   +1.367514043585621e-01   -7.204136457540258e-02   -3.452591630454294e-01   -2.512529410683165e-01   +2.544585428052045e-01   +7.150805191237076e-01   +1.385067959077823e-01; +2.128205768454663e-01   +4.327638580033747e-01   +3.348682075022638e-01   +3.168747893986344e-01   +3.962506562981566e-01   +6.535534175338221e-01   +7.483070253242574e-01   +3.028468887068547e-01   +3.389759000761435e-01   +2.799302869487058e-01   +1.121050958919522e-01   +2.465475520140588e-01   -4.100789645362893e-01   -1.545980672624890e-02   +2.230434989222462e-01   +3.095924704822161e-02];
L2I_L2E_iAMPA_netcon = [+1.607812016143954e-01   +6.263202620082973e-01   +4.125400678110549e-01   +1.611363913737197e-01   -3.811170471179272e-02   +4.696756968705641e-01   +2.063150608813762e-01   +6.135347152001083e-01; +7.329045386164658e-01   -7.812595350708720e-02   +1.000000000000000e+00   +5.618441173840053e-01   +5.075330064823633e-01   -8.983191738076278e-02   +2.212975640693846e-02   -1.750944204778618e-01; +1.262362370766337e-01   +3.229970356811697e-01   +1.425435493229568e-01   -9.739109171106493e-02   -2.356560574944765e-01   +5.134677609748282e-02   +4.690656271654937e-01   +5.025692407732048e-02; +2.891507610942582e-01   -6.030239215750085e-02   -4.446655366890347e-01   +4.374577087377134e-01   +3.483652134417540e-01   -3.839434097426869e-01   +4.037750740309924e-01   +2.223472459099586e-01; +2.540216861815993e-01   +8.148178470577949e-02   +1.581850368288610e-01   +5.276692561783910e-01   +4.304122833291021e-01   -9.833807200556548e-02   +5.194792168844981e-01   -1.060505932270479e-01; +4.244512866215900e-01   +4.683990571477543e-01   -3.897057380086328e-02   +4.775484463731651e-01   -2.139055248926327e-02   +3.212380447140780e-01   +4.039538083167133e-01   +2.498330023147269e-01; +2.807676852087003e-01   -5.225540725641181e-02   +4.036633211468157e-01   +6.750171498878359e-01   +1.062610138538630e-01   -3.651790027712993e-01   +8.374696937803475e-01   -7.908497204563956e-02; +1.151363309933926e-01   +2.885887002839503e-01   -5.364180317480380e-01   +1.238913954483141e-01   +4.471686836416598e-02   -1.048593843466989e-01   +1.150328066434253e-01   +4.727460838815929e-01];
L2E_L2I_iGABA_netcon = [+3.368100315390146e-02   +2.551967750809100e-01   +6.187461625157661e-01   -1.772455121422350e-01   -2.511309579416756e-01   -1.337389950520923e-01   -2.048719000247211e-01   +2.978344486261148e-01; +6.835913813323455e-02   +1.749774785459904e-01   +3.332947823974927e-01   +8.198899080895297e-01   +6.411368715213469e-01   +2.001124603671022e-01   -5.381076253894064e-01   +1.889217918688031e-01; +1.238644276314570e-01   +7.062645064942189e-01   -3.141378607520273e-01   -2.863769295854946e-01   +4.217265644926882e-01   +5.859066530149100e-01   +3.525222658965960e-01   +4.348185280335176e-01; -1.756588290262191e-02   +5.241659255935346e-01   -3.553876359530220e-02   +7.239155921019299e-01   +7.206596558304527e-01   -3.763923738330353e-01   -2.441318338885216e-01   +5.301395202986575e-02; -1.330119774863485e-01   -3.578895445979791e-01   -8.425577216946428e-02   +2.049592684080229e-01   +6.554504240864181e-01   +2.399594450241002e-01   +4.191935622508784e-02   +1.610301386275654e-01; +5.807749199237862e-01   +5.253873157023804e-01   +2.505315638418518e-01   +4.660067943589240e-01   +3.638395058684574e-01   -3.520495043605683e-01   +5.825852249904280e-01   -3.015658994141922e-01; +2.099668102908886e-01   +1.917829330320160e-01   -3.918496579623862e-01   +4.956054141820210e-02   -1.304274470920325e-01   -3.342822977796924e-01   +2.024243647075184e-01   +9.746152369391007e-01; -6.322751815498795e-02   +5.110208416871532e-01   +4.882503770366662e-01   -1.387401414379748e-01   +2.923369172795949e-01   +4.770373568706866e-01   +4.571149638786887e-01   +6.173996786381685e-01];
L3E_L2E_iAMPA_netcon = [+3.560334409911824e-01   -3.367728657725835e-01   +2.312773901608488e-01   +1.092522444886934e-01   +4.980807416774062e-01   +3.062034677376365e-01   +2.074382690760255e-01   +4.918772974475166e-01   +2.970128119937535e-01   -1.432433094674514e-01   -1.545139980057215e-02   -1.429792556509417e-01; +3.220404960717446e-01   +4.721434715793996e-01   +2.135948897951775e-01   +3.033149011140868e-01   +2.407386315543520e-02   -3.579874578216105e-01   +5.410828004298145e-02   +1.136110598897391e-01   -7.724368440552232e-02   +1.122378323472921e-01   -1.068592589189502e-01   +4.765238070595528e-01; -4.351405322269704e-01   -1.886973132409057e-01   +4.197803313159669e-01   +3.291662807840080e-01   +5.732331302495892e-01   +1.759078159694158e-01   +4.096481771416786e-01   +3.057295675191367e-01   +7.672346000735796e-01   -3.593615278508211e-01   +6.815696806817965e-01   +5.347613404611654e-01; +6.395311770582517e-02   +3.666527933524646e-01   +3.762661096829876e-01   +2.104902764733055e-01   +6.276833771495592e-01   +1.470789908402070e-01   +1.481634309469753e-01   +4.122505119121678e-01   -3.442294949706428e-02   -1.090933523389413e-01   -2.422284308719252e-01   +4.896785333636466e-01; +1.212588788257734e-01   +1.229563894672026e-01   +2.971047568784217e-01   +5.962381979827288e-01   +5.391357825253406e-01   +3.688566258876891e-01   +2.700135739566313e-02   -1.097077084289548e-01   +5.773276242655161e-02   +4.288538958630391e-01   +6.791083298397195e-01   +4.492687386871227e-01; +4.743789669436831e-01   +7.877507526690199e-02   +2.598549548395541e-01   -3.009966641826337e-01   +3.518037585435040e-01   +5.174097756510877e-01   +3.570253531373800e-03   -2.972461476424764e-01   +2.865993587321202e-01   +4.103266524062689e-01   +9.486998491673162e-03   +2.252548654424272e-02; +8.949036498576668e-02   +3.041400363850976e-01   +6.240347644922045e-01   +6.274400148810978e-03   +3.245983976860756e-01   +2.800502521871057e-01   -5.572170201461780e-02   +2.617653949698632e-02   +1.233752262817207e-01   +4.503681929500747e-01   -5.861192250129110e-02   +2.723265742282989e-01; -2.686291256736929e-01   +9.477904844027402e-01   +3.102051133547257e-01   -6.493082693089279e-01   +4.212409612237423e-01   +3.515989684390480e-02   -8.519535655865411e-02   +3.214777798546124e-03   +4.440560557495933e-01   +3.585801932450166e-01   +1.070719424969879e-01   -1.404607633586226e-01];
L3I_L2I_iGABA_netcon = [+7.115901734905697e-01   +4.944979363805438e-01   +1.308704535210543e-01   +1.623262212948256e-01   -5.005524141181806e-01   -6.889326402301005e-02   +1.000000000000000e+00   +7.218651659524637e-01   +7.387922563277173e-01   +2.192710764180187e-02   +1.046172095297213e-01   +1.805786824562059e-01; +2.183960719878019e-01   +1.726884186386597e-01   +1.007228422236093e-01   -1.915071274826562e-01   +4.854939756121149e-01   +2.242285375329860e-01   +3.866830033952246e-01   +2.989611470925621e-02   -1.276405915137066e-02   -1.499494119304619e-01   +3.354926507371537e-01   -2.183750027153722e-02; -7.242562674127970e-02   +3.951794984987013e-01   +2.447722209835806e-01   -2.353168818118650e-01   -5.233846075203979e-02   +4.259871222315568e-01   +2.555747177355326e-01   +2.325882699397197e-01   +3.058602801019298e-01   -1.364448440246793e-01   -1.512827121665262e-01   +8.292290440600738e-01; +5.344980331321872e-01   +5.468611251433276e-01   +5.190352800883220e-01   -1.251844328148260e-01   +2.571935518488299e-01   -1.396745104223185e-01   +3.157739418707999e-01   -3.638644051667230e-01   +4.673523938815721e-01   +6.394800375063234e-01   +6.228192735568928e-01   -1.989506208434884e-02; +3.904400228167546e-01   +3.395661010212201e-01   -1.370571220345662e-01   -9.916094314293487e-02   +6.059401771392706e-01   +4.271477119619490e-01   -6.181366594980547e-02   +8.262448823524736e-01   +6.266706217238716e-01   -2.723813688890952e-02   +3.387809259856779e-01   +1.836402712795424e-01; -7.459680717518129e-02   +5.805658817596887e-01   +4.893415934864253e-01   -1.717687116597546e-02   +5.527982017831535e-01   +3.703998464397751e-01   +6.681771247124141e-02   -2.255929389338602e-01   +3.529811611808391e-01   +4.299842625754591e-01   -1.609652841559476e-01   +2.238177306628067e-01; +5.699458567055197e-01   -1.458132091189473e-01   +3.640359824769356e-01   -3.122036807466001e-02   +6.134222500404631e-01   +5.791598837052510e-01   +4.573288884965362e-01   +5.429079989766465e-02   -5.154998332441190e-01   +7.110877754131333e-01   +3.084084586693696e-01   -2.138399215679281e-01; +8.107041484473436e-03   +2.620383390676403e-01   +3.507735079384394e-01   +3.923357141855310e-01   +8.242498436422617e-02   +4.836507890087080e-01   +6.957671419354814e-01   +8.761048395387403e-01   +5.321287569055457e-01   +3.122205780344652e-01   +3.576399267368879e-01   +4.291410397392636e-01];
L2E_L3E_iAMPA_netcon = [+6.881332424361887e-01   +3.072476201232556e-01   +6.610746324614857e-01   -6.325370514452466e-01   +2.399093521520489e-01   +4.401360300928532e-01   +4.799256165579435e-01   +6.657891365834635e-01; +2.387203151920436e-03   +1.832722872876919e-01   +2.204654141470191e-02   +3.775258950614280e-01   +4.855342624240050e-01   -1.920337308133545e-01   -2.919694972482140e-01   -4.732320107480139e-01; +2.972258490031045e-03   -1.876536387923625e-01   +2.100178791456515e-01   +3.897113680491857e-01   +3.413274465665581e-01   +1.877455081979054e-01   +3.442022186505882e-02   +1.421379861969988e-01; +1.712960607803280e-01   +4.001026822158759e-01   +8.307800673260842e-01   +7.790445813313298e-01   +7.990658551575192e-02   +7.578570817030951e-01   -1.404087577392130e-01   -2.512770529259472e-01; +1.957443021822484e-01   +1.266427517782019e-01   +6.005935840538368e-02   +4.451145690065861e-01   +2.499464482195212e-01   +2.232789291686100e-01   -7.037399342261383e-02   -2.707029235011661e-01; -1.099548785920311e-02   +7.405453398296191e-01   +6.122432628555283e-01   +7.869469431556534e-01   +2.437772557227373e-01   +2.982656660975602e-01   +1.788874708055760e-01   +1.883688755823343e-02; +5.139557292652559e-02   +8.029349229679078e-01   +7.862933756293695e-01   -8.982313415700169e-02   +1.226719112077777e-01   -7.793239132085095e-02   -6.288972870240987e-02   +3.971816888776765e-01; +5.009247360969775e-01   +3.479224370657668e-01   +1.280320068013472e-01   +2.133291160380489e-01   -5.267597530468793e-02   +2.317219545905612e-01   +1.516280849918829e-01   +6.554423291417909e-01; +1.217678613423583e-01   +7.337567410012160e-01   +4.985146397336352e-01   +3.539653658246090e-01   +2.100146530215376e-01   +3.791448367043516e-02   +8.054247414288340e-01   -1.781379917013695e-01; +1.328099838844380e-02   +2.082201840808625e-01   +2.384388806389695e-01   -8.227118868110404e-02   -4.062421403455862e-02   -2.202057099683375e-01   +2.870729596640211e-01   -5.071908884080504e-02; +4.264397781959727e-01   +1.168095522621798e-01   -2.938835711937299e-01   +9.529619437967636e-01   +5.647730873027769e-02   +4.099782323552353e-01   -9.328388481226010e-02   +2.771761099438249e-01; +1.043420306978519e-01   +8.496128713729006e-01   +3.256896360001310e-01   +6.275039198518416e-01   -1.498317883988794e-02   -3.036952988737861e-02   +5.364877535442088e-02   +2.237386651992092e-01];
L2I_L3I_iGABA_netcon = [+1.799236030161315e-02   +9.884104481076132e-03   +1.230018287645273e-02   +1.606719265668339e-01   +4.476237570324656e-02   +6.316071947133003e-01   +2.436149195588338e-01   -1.034458153325761e-01; +2.294273720999757e-02   +2.667577430865160e-01   -2.622280299078552e-01   -2.016017683872737e-02   +4.109796981963031e-02   -1.051624857416715e-01   +5.254756490811409e-01   +2.666947827432440e-01; +6.702140386648340e-01   +1.000000000000000e+00   +2.118086263712460e-01   +5.944722933270565e-01   -1.887965966602207e-01   +6.953553518559301e-01   +2.541787191716778e-01   +1.442586155163477e-01; -1.510238315991292e-01   +2.797902550482112e-01   +7.134914174375571e-01   -4.719987260325733e-01   -4.814441887985142e-02   +6.455480213595937e-01   +2.455152720288574e-01   +2.139892194631829e-01; +5.965148010274626e-01   +1.709461646004695e-01   +3.505417213623252e-01   +2.693214788861049e-01   -3.016346660742429e-01   +2.132860032369558e-01   +1.247221222466678e-01   -9.763124381543668e-02; -1.416567928037554e-01   +3.240218599378785e-01   +7.635755767776298e-01   -2.260066402954513e-01   +4.270349407375558e-01   +7.233092178855507e-01   -3.566511390727783e-01   +6.811179230557059e-02; +3.865925481389668e-01   +3.136507910048090e-01   +1.673170817290476e-01   +2.542709199665461e-01   +1.807984436382465e-01   +3.470243528814790e-01   +8.108261854044214e-01   +5.055626597986862e-01; -3.080750844047298e-01   +4.433129093303741e-01   +3.371100222332267e-01   -4.333792452230639e-02   +6.469309317762380e-02   +3.069404808588593e-01   +1.140999238306175e-01   +6.940388329037949e-01; -8.236567954766716e-01   +8.087900708594036e-01   +5.004000113531711e-01   +3.079602184389567e-02   +3.622190590035994e-01   +2.501942896568056e-01   +3.829767292174425e-01   +3.803752306962916e-01; +1.441900640961560e-01   -2.713083065025282e-01   +2.109283877066069e-01   -4.251825935212664e-02   +4.327477177000349e-01   +6.236820218271617e-01   +2.744967030636228e-01   +2.569833634072428e-01; +6.174307991893274e-01   +2.339606572201841e-01   -5.095584814678297e-01   +3.198496734687805e-01   +2.722568673622716e-01   -9.198264163265542e-02   +4.675411134489547e-01   +5.830707892376600e-01; -4.680211572688373e-01   +8.135813194271670e-01   +1.461494456775167e-02   +6.577930922712523e-01   +5.743221574137153e-01   +2.812197746267699e-01   +1.738606680743810e-02   -2.525757898474734e-01];
L3I_L3E_iAMPA_netcon = [+2.651375550274867e-01   -1.828213961803364e-02   +2.451073765605559e-01   +2.953047276615341e-01   -3.072196190927331e-01   -8.039950626050170e-02   +2.307165921149680e-01   +2.562016512261898e-01   +1.104618381983874e-01   +4.851485368706135e-01   +1.497090179794030e-01   +2.900842780282918e-01; +1.110352638346047e-01   -3.674177587869164e-02   +1.111479938914272e-01   +7.161558462016353e-01   +2.205532687726282e-01   -1.178249113377325e-01   +5.030636991173173e-01   +3.179703373742020e-01   +3.926082363603108e-01   +2.127525116129755e-01   -2.721803546440714e-01   -1.003027399823770e-01; +1.704786650250217e-01   +4.996289543780901e-01   +4.974546621945366e-01   +1.221333385918867e-01   +8.291666804458688e-01   +2.531396888821906e-01   +6.523708107212151e-01   -9.433149774064031e-02   +4.168186536525852e-01   +3.961705104267912e-01   +1.352455034694951e-01   +4.857900930715320e-01; +3.854836834749255e-01   +3.022909301618126e-01   +4.528409265092873e-01   -2.605292027351871e-02   -1.053496718873283e-01   +5.129187295681621e-01   +8.727738243919554e-02   +3.307665989633533e-01   +1.831847633323342e-01   +4.350989759088671e-01   -1.203087459694785e-01   -1.670308471285160e-01; -3.843656189559478e-02   +3.557372944068134e-02   +8.537782359425534e-01   +4.597863046938767e-01   +2.935755339066867e-01   +2.580793688509704e-01   -1.327522766367523e-01   +3.979861213137352e-01   +2.330977690174035e-01   +3.285679144250202e-01   +3.543473190722057e-01   +1.186053564832560e-01; +2.222952650268760e-01   -1.033397975509056e-01   +8.210556889070600e-02   +5.617848957140908e-02   -1.252223409436818e-01   -2.648852614262241e-02   +3.241062587344224e-01   +1.398137508381594e-01   +2.916880755514348e-01   +6.611792677263581e-02   +1.584624199220399e-01   +8.454959575970451e-01; +1.028523024416659e-01   +1.054755316823705e-01   -2.385313848989825e-01   -4.940076746883801e-02   +2.666267297007532e-01   -2.192545742599796e-01   +5.116100395619774e-01   +3.813133760196761e-02   +2.348311557612629e-01   -3.667327719790203e-02   +3.915986508354311e-01   +1.393880487594080e-02; -1.753111378729232e-01   +3.173078810022485e-01   -5.138918513859875e-03   +9.184565242223182e-02   +1.533779884517580e-01   +1.353837731710599e-02   -7.582456356834597e-02   +4.959794533759646e-02   +5.595682937372776e-03   -3.236689139527013e-01   -5.252244928632897e-02   +2.943421293749593e-01; -3.209272889703521e-01   +5.958078521874156e-01   -2.713588525282544e-02   +1.955232984253383e-01   +1.258480238950056e-01   +5.079689351377581e-01   +2.296854261175875e-01   +4.345388572308066e-01   -2.308471147435802e-01   +1.426027646612475e-01   +4.790012048524858e-01   +7.603631806288191e-01; +6.922256040701900e-01   -5.132806990370824e-01   +6.285223286299674e-01   +2.610016516588205e-01   +1.119131896846062e-01   -4.743220387260119e-01   +3.718930240381133e-01   +3.841682715201508e-01   +5.128920355014543e-02   -1.240964897249906e-01   +9.962690244805461e-01   -2.165790278382856e-02; -3.435299005785067e-01   +4.964280760914349e-01   +6.980775200810860e-01   +3.531023781667273e-01   -1.444589734737231e-01   +4.301195596141443e-02   +3.478642767073522e-01   -6.952415139365085e-03   +4.232099641314973e-01   -1.875949265160822e-01   -9.197327586393422e-02   +2.599736955689836e-01; -1.399144650394454e-01   +1.826811527012893e-01   +2.149129909326198e-01   +5.697818630206507e-01   -2.827134409471039e-01   -1.297732840412258e-01   -2.230611301136138e-01   +1.452618396739617e-01   +4.308831693034974e-01   +1.699345455383471e-01   +1.770638918733998e-01   -1.384706838919044e-03];
L3E_L3I_iGABA_netcon = [+2.639587207628654e-01   +2.514311677084893e-01   +1.365439001118417e-01   +2.239107240427078e-01   +2.638414077360414e-01   +5.994319098757649e-02   -3.410588527770184e-01   +4.013101154482542e-01   -1.768713377232177e-01   +5.984818753872867e-01   +1.400534353986596e-01   -1.760786372152894e-01; +1.806412170859168e-01   +4.865948334583978e-01   +4.349756020666811e-01   +2.824013161315341e-01   +6.173098791666290e-01   +2.960736675069591e-03   -8.827245261863394e-02   +1.180012965318842e-01   -4.891211597497603e-01   +2.170008935586293e-01   -5.281595571452788e-01   +7.965915591498914e-02; +6.553261882261226e-02   +2.554699879082700e-02   -2.848089776973063e-01   -2.136203528955837e-02   +1.740218116428489e-01   +4.845785121896888e-02   +3.346762459511032e-01   +3.447763515322848e-01   +3.722573685302234e-02   +1.840221187092015e-01   -6.908375630571868e-02   +1.151837427532017e-02; +4.589108857561184e-02   +2.488673967416399e-01   -5.025306369384397e-01   +4.398155209212672e-01   +9.586058602001422e-01   +9.239135269113680e-02   -7.803657921785757e-02   +1.037808297838556e-01   +7.611114846260671e-01   +3.973415594377291e-01   -1.066402755086741e-01   -1.548606099522088e-02; +3.320617083630784e-01   +1.010488477522448e-01   +9.336985822648548e-02   +5.304771847901033e-01   +1.133723079927477e-01   +5.464328485605798e-02   -1.382152976787412e-01   +7.716034881265021e-01   -1.628675901417933e-01   +6.765188265377721e-01   +2.068972971237198e-01   +1.300618955027970e-01; +2.551049407114618e-01   -2.031146747417464e-01   -8.921233280655382e-03   -2.108220296196402e-01   -1.522580425295208e-01   +2.202316637794783e-01   +1.505293712159876e-01   -5.206515047942510e-02   +6.807256861872161e-01   +2.043031615614358e-01   -1.783175219905394e-01   +4.185836654490047e-02; -1.764452383578899e-01   +8.554589857042465e-02   +2.128704774806466e-01   +9.614280875858847e-01   -2.712360425133225e-02   +4.857931562790229e-01   +5.302404605124975e-01   +2.400148880386169e-01   -1.563597998624796e-01   +2.477446375581828e-01   +4.773825368456504e-01   +8.754788049783596e-02; +3.273524802802344e-01   +1.705310231763005e-01   +1.470801697130747e-01   +7.091724565453325e-02   +2.158351993059267e-01   -3.568719791702963e-01   -2.123449893704805e-01   +6.205901085689151e-01   -9.370343277556369e-02   -9.954087982577942e-02   +6.119558600715580e-02   +2.856232108412268e-01; +2.063300359826012e-01   -2.727760552879613e-01   +4.380342872208007e-01   +1.719289923669104e-02   +2.007121332257395e-01   +7.115168967577383e-02   -5.909431634650247e-01   -2.259313904617854e-01   +5.759195616648273e-01   +3.590499308315717e-01   +8.526876857483823e-02   +7.614450797676140e-01; +1.749212770441121e-01   -8.187399668991328e-02   +2.955346268616177e-01   +2.011403443757373e-03   -5.712010187698295e-01   +2.408177646588265e-02   -1.537315686617218e-01   +2.186957097472168e-01   -2.674565330632369e-02   +2.758933596901647e-01   +7.957570513426473e-02   +8.325739593421207e-02; +2.594437911524760e-01   -8.728182628366533e-02   +3.877919191592490e-01   -3.331047445851883e-02   +1.689924539088307e-01   -2.175693636631097e-01   +3.531275552527310e-01   +4.439544084844030e-02   -9.018544684110538e-02   -5.819881757920008e-02   +2.568540377917884e-01   +4.811934173972510e-01; +7.502189074698313e-03   +2.495123933686000e-01   -2.064592524721296e-01   -7.546338444762893e-02   +8.773008954746156e-01   +4.766631891676266e-01   +4.079394647141956e-01   +4.138682309848973e-01   +1.815650791112455e-01   -3.161160121664364e-01   +5.214625216131823e-01   -2.031597472666188e-01];
L2E_Input1_iAMPA_netcon = [+7.905887162084348e-01   +7.308156303030133e-01   +5.151968725134203e-01   +8.358282547008101e-01   +9.709832150207837e-01   +4.521544600801691e-01   +4.675401235279134e-01   +5.798857964443964e-01];
L2I_Input2_iAMPA_netcon = [+6.245386374554748e-01   +7.727640478455666e-01   +7.354611614267077e-01   +4.482539013308429e-01   +2.391677569211598e-01   +9.987994496106574e-01   +6.255462800977142e-02   +1.174544279247288e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
