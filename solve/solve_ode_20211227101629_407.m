function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.398804302518977e-01   -1.017986546509458e-01   -1.097823010141079e-01   +3.472573459475638e-03   -2.141451244390097e-01   -1.621437933500217e-01   +9.597609286838041e-02   +2.221144307676675e-01   +6.882697300311545e-02   -6.239466582745185e-02   +6.761125502471295e-03   +3.156121383586217e-01   -3.076926917534288e-01   +1.417500203832009e-01   +7.705695781613123e-02   +3.844752956234942e-02; +1.375299513416563e-02   +1.637932773264225e-01   +3.219669689526116e-01   +2.436387032918948e-02   +3.063880866165033e-01   -7.704483445489503e-02   +1.021358660414147e-01   +1.341468197951263e-01   +1.102521927099722e-01   -2.548658624524749e-01   -1.675743049594121e-01   -4.107876153955978e-02   -8.036198682776079e-02   +1.357585116228202e-01   +8.115127168218786e-02   -9.824364325534574e-02; -6.840335956507179e-02   -1.860511238212706e-01   +1.992124415810156e-01   +2.025985111693313e-01   +5.800383998052598e-02   +1.315156881252774e-01   +2.031852106998286e-01   -1.272249949918646e-01   -1.016985639101371e-01   +7.606139937684366e-02   -1.742172367729105e-02   +2.989623569455737e-01   +1.518794526724496e-01   -3.022458138235324e-02   +2.255652779107311e-01   -8.907425091574860e-02; -2.212530859835956e-01   +1.706429051795079e-01   +2.258640746586911e-01   +1.595601941863512e-01   +4.125722262697186e-02   -2.467731505608174e-02   +2.888291982804235e-02   +2.401843954947253e-01   +1.923219077885526e-01   +2.595621590546514e-01   -2.247319875842786e-01   +3.450866312905987e-02   -2.217901011595492e-01   +2.359155303703263e-01   -2.364253164572126e-02   -1.243834394219675e-02; -5.982238102864178e-02   +3.240487705778651e-02   +2.196517267511660e-01   -1.986739778650937e-01   -1.629768290008752e-02   +3.706281541143722e-01   -6.524450106226107e-02   +4.544719184826717e-01   +1.368820413985980e-02   +2.223807878663189e-01   +1.217523759858855e-01   -1.455236617350041e-01   -2.244157190764307e-01   -2.893530030362017e-01   -3.349903637592795e-01   -3.583056481252281e-01; -1.426047309732692e-01   -2.548630733270906e-01   -2.503946356600927e-01   +1.198056060712216e-01   -8.431942832166812e-02   +7.889413205045194e-02   +1.085905162303114e-02   +3.340839978294485e-01   -5.844952773402214e-03   -2.097958847852298e-01   +1.489627167150692e-01   -1.558189807871984e-01   -3.743367526566400e-02   +6.107006453481316e-02   -3.892158719432181e-01   -4.295081609076486e-02; +1.623139313668773e-01   -1.438958853119714e-02   -1.221084606896998e-01   +4.342707701149220e-02   +2.416945354265878e-01   -2.631605838571879e-02   -2.224880571813172e-01   +9.885272739951101e-02   -1.630439513817460e-01   +7.227717838338442e-02   -3.428635621556315e-02   +6.493942037152181e-02   -8.370683498234881e-02   -4.449721932463004e-02   +9.721385611178231e-02   +3.133744091542355e-01; -9.204732488152656e-02   +1.446008543950286e-01   +1.441095236762208e-01   +5.715126799319620e-02   -1.777003833724276e-01   +7.460847807082524e-02   +1.707014157230080e-01   +1.383203359759600e-01   +1.094056920337285e-01   +3.263110906646437e-01   -2.378421356183127e-01   +6.204651635597400e-02   +1.510345867780981e-01   +6.809446998097352e-02   -7.095794057640606e-02   -9.010917446713718e-02; +5.372994806105944e-02   +1.017870635678877e-01   -4.153794525667934e-02   -1.150051637734293e-01   -2.066342117037993e-01   -1.872821894141330e-01   +1.316256609695844e-01   +3.701968290958244e-01   +1.782324086415970e-01   -1.548437145279489e-01   -1.265333275103225e-01   -3.427685546333810e-02   -1.520389318692518e-01   +3.686263602094006e-02   -3.227787898485155e-01   +2.033473250997678e-03; -3.796620984005507e-01   +6.812517214490652e-02   +3.340633159939556e-02   +1.468604381268233e-01   +1.060648330303852e-01   -1.104258585151510e-01   +5.056406153595577e-02   -2.389994144404728e-01   +2.457897853780416e-02   -2.070001825937701e-01   +8.616175311256438e-02   -2.132614855578659e-01   +4.236327479465290e-02   -1.406399363864410e-02   +1.132887374769486e-01   -8.828458218449929e-02; -1.636444911884025e-01   -1.833916334419921e-01   -1.304274045228614e-01   +1.643249452276784e-01   -1.415804724382262e-01   -1.378024380712597e-01   +4.114537001396763e-02   +9.477219081639954e-02   -2.157694999804321e-01   +5.814980214406024e-02   -5.120125096291034e-02   +1.691126899132211e-01   -1.742532859563422e-01   +2.641302128486198e-02   +8.343542225642694e-03   -5.788461560936452e-02; +5.702087714989876e-02   -1.880013782326972e-01   -3.530965458291533e-01   -1.081227145346858e-01   +1.566742074903207e-01   +2.284947362600553e-01   -1.050407653286351e-01   +1.882589868414491e-02   +9.695381605562864e-02   -2.694652715607306e-02   -3.378425076711949e-01   -1.520435443665881e-01   +1.680798215942306e-01   +1.526870922397694e-01   -4.119084971238533e-01   +1.141796302088062e-01; +1.288456879300165e-01   +3.747731607389271e-01   +2.104153998289295e-01   -9.428819603315215e-02   +3.614133532742106e-01   -1.755965680001341e-01   -5.290546781285707e-02   +2.465134288005727e-02   -7.952704113017507e-02   +1.481887788496155e-01   -1.973643623508423e-01   +1.284472194418945e-01   +1.253276480498092e-01   +1.414624165360955e-01   -1.092927457137214e-01   +6.566775615270670e-02; +6.717208761912984e-02   +1.746780584712024e-01   +5.061518180177760e-02   +1.590492708447863e-01   +1.116813552683258e-01   -7.807746049000019e-02   -2.249206552984180e-01   +2.443319884985462e-01   -1.756879722474965e-02   -6.395582897746448e-02   +2.221210296260721e-01   +3.136124641800076e-02   -2.814754982724298e-01   -1.540769256553285e-01   +2.297862290819653e-01   -8.148443606807672e-02; -2.967199664455250e-01   +1.075446693107337e-01   +1.168462740100035e-02   -6.027732292924466e-02   -2.966818023753937e-02   +9.544565234930776e-02   +1.430718874801118e-01   -3.640500554839862e-02   +5.411296417729625e-04   -1.963209228890234e-01   -8.926491596260980e-02   +8.474654737219504e-02   +3.622446340491091e-02   +1.677700536475257e-01   -1.562253541159652e-01   +2.934902299281995e-03; +1.406022876447644e-01   -8.292728793857684e-02   -2.449933003491891e-01   +2.700091513097802e-02   -1.364155445117301e-01   +1.337756511607867e-02   -2.797421952217960e-02   -8.081780606049302e-02   +2.215955860067002e-02   -6.652449481969350e-02   -1.419738362359743e-01   +1.476624123317754e-01   -2.732051186966548e-01   -2.594086218888191e-01   +5.721020324179368e-02   +1.015247738634695e-02];
L1E_L1I_iGABA_netcon = [-2.472171687301072e-05   +6.820981252474029e-02   -5.649151934980683e-02   +1.924914407966996e-02   -5.384905386181247e-02   +1.152387550725447e-01   -2.386971658268603e-01   +7.293884042761183e-02   -1.225028918966755e-02   -1.619183115695345e-01   +9.218425788393848e-02   -2.492050838031907e-01   +4.449749153022526e-02   -2.198878248718679e-01   -1.040518321468209e-01   +1.506626561291447e-01; -1.258693583144560e-01   +6.573014845820671e-02   +1.429707670901406e-01   +6.709550175238430e-03   -1.890113183926557e-01   +1.624823857220467e-01   +8.516495898682402e-03   +9.475884821979826e-02   -1.487596856723112e-02   +7.165928627212156e-02   -5.557950045257691e-03   -3.155062170717334e-01   -6.520969103839476e-02   -9.476417157793590e-02   +9.994957108601954e-02   +1.419268831554521e-01; +1.319319085955815e-01   +1.050490238891303e-01   -8.946772691735756e-02   +8.099751407460654e-02   +1.817725749823938e-01   +1.514392748621405e-01   -1.711195855494797e-01   +1.158889964366368e-02   -1.871954257760862e-01   +1.690084837189580e-01   -1.767935400996169e-01   +2.751353319256216e-01   +1.180532710153192e-01   +1.750046409698519e-01   -1.287014152226679e-01   -1.240592357415670e-01; -6.227504404270108e-02   -3.382216884935850e-01   -5.667813654893609e-02   -1.530695268400600e-01   -1.969161180049772e-01   +9.536130880263666e-02   -3.376364258894610e-01   -2.390555033493552e-01   -4.734963887453017e-02   -1.438130117223421e-01   -2.737864015016012e-01   +2.120376929490056e-01   -7.429500389987140e-02   +3.782098413126378e-02   +1.058385693187847e-01   +1.367115962796037e-01; -1.494923892616332e-01   -3.975948011743512e-02   -8.618482986097885e-02   +1.088382326189423e-01   -1.491090801332094e-01   +2.830629792685526e-01   +2.412295300049746e-01   -9.163568510157161e-02   -7.058832268528804e-02   +3.616974366449775e-02   -9.586545140808528e-02   +3.674117860233518e-01   +1.039997390344904e-01   +1.418885569512373e-01   -1.098686149867284e-01   -9.806675776865455e-02; -1.583686785184856e-01   -1.646428763483146e-01   -1.043307284983608e-02   +6.345306531117278e-02   -9.225963535379991e-02   +3.448673207033223e-03   -4.513020147108380e-01   -1.223698476893252e-01   +1.107042991604427e-01   -5.821106022998557e-02   -1.337105007908401e-01   +2.803920434897501e-02   -2.759568872634309e-01   +1.852215803860534e-01   +1.567170602080685e-01   +1.262834507010700e-01; +8.514544419418764e-03   +2.837488711402564e-02   +3.175368996899697e-01   -3.677811142390955e-01   -9.800604789499440e-02   -8.439408514776604e-02   -6.724729815837309e-02   +1.979000523058674e-01   +2.178070935181098e-02   -2.257246505685175e-01   -1.336431250034397e-01   +2.444890789883618e-01   -9.195493925786084e-02   +1.054044532169634e-02   -1.662721758176963e-01   +3.284014619373547e-02; +4.009239561527983e-02   -1.801182580172651e-01   +8.588754580816907e-02   +2.305719318330066e-01   -5.716421766492810e-02   -3.248299432781310e-03   -1.037800279218892e-01   -1.455263410538907e-01   -2.618275641297755e-01   +2.794935624881549e-01   +3.679829714748239e-02   +2.487899225722922e-01   -1.411627164954859e-02   -1.325488960107929e-01   -1.699699284406442e-01   -1.701704736483948e-01; +2.833258633803913e-01   -1.052089951836150e-01   +1.937481376935794e-01   -6.814174022261194e-02   -4.593182065948966e-02   +1.343407190874141e-02   -2.706475933811058e-01   +5.705942552174863e-02   +4.560696988593196e-02   -2.176150272298500e-01   -3.301991634998619e-01   +1.745354054087692e-01   +2.276876523393583e-02   +2.090209453169887e-02   -3.118190726110062e-02   -3.110617674873593e-01; +2.434377557755940e-01   -6.645941263284255e-02   -2.104157690687129e-01   +1.163520987590556e-01   -2.435555816474964e-01   -1.190113710734491e-01   -2.253941797949094e-01   -1.216308939642524e-01   +3.489731720432994e-01   -1.276263658014293e-03   -2.872846318318912e-01   +5.315196344370540e-02   -9.638513951352480e-02   -2.970643648252638e-02   -1.147128557648607e-01   +1.155957261294015e-01; +3.084951766487961e-01   -1.294845798352995e-01   -6.223190465320198e-02   -2.405037383011261e-01   -5.020511682400794e-03   -8.503197615145994e-02   -1.715518211792917e-01   -1.944342586588892e-01   +2.000811491762997e-01   +3.391234836358191e-01   -1.427409427797502e-01   -1.551930653313762e-01   +2.336834212735357e-01   +1.294443254481953e-01   -1.554260904707414e-02   +2.139767825041577e-01; -1.094163420319207e-01   +1.270268055707062e-01   +9.112623473860267e-03   -1.073669672296177e-02   -2.448416872199625e-01   +9.995917956743428e-02   +1.858836902021027e-01   +1.234369116206270e-01   +4.746956484497738e-02   -1.199713685427716e-01   +1.589128331777944e-01   +1.298442937142612e-01   -1.810642206183352e-01   -1.546629474221794e-01   -2.216519003448706e-01   -2.782050978711197e-02; +1.260461400472157e-01   -1.931477961557437e-01   -1.146967853303760e-01   +2.499543338545719e-01   -1.647215834082982e-01   -1.823036041159907e-01   +1.024784298534398e-01   -6.253117166140176e-02   -3.046097041630820e-01   -4.179847206188381e-02   +8.405490286460832e-02   +3.270541182843195e-02   +1.130803596186238e-01   +1.386614147421447e-01   +7.227552880556212e-02   +1.601260100879288e-01; +5.046502508891491e-02   +3.215249310451769e-01   -9.845614454667166e-03   +3.526850640600395e-01   +1.069262800849868e-01   -1.952927756702888e-01   -1.119816198887188e-01   -9.178389381039724e-02   +2.763939131348568e-01   +1.907644733505974e-01   -1.651645744345731e-01   +1.752449336592835e-01   +2.746138861616008e-01   +1.393962925912816e-01   -1.238723686794486e-01   -3.940926967559549e-02; -1.101193499923552e-01   -1.141369867215732e-01   +2.068568716462307e-01   +2.391339245006334e-01   +1.517465662388149e-01   -7.952233548560508e-02   -1.021433598690610e-01   +1.524458579301713e-01   -1.284268004908222e-01   +3.061487904071165e-01   +1.036190765491969e-01   -4.682470251211330e-02   +1.075799325882568e-01   +1.477027247823540e-03   -2.693086295734733e-01   -6.962674899927616e-02; -6.080795979370603e-02   -1.585365069056552e-01   +1.554835228442895e-01   -1.554640670202794e-01   +2.247036450491792e-01   -3.197367606932748e-01   +3.922799356186481e-02   -4.695692096096709e-02   -2.352898659159654e-02   -8.692413399491657e-02   -1.048070728919518e-01   -5.050825190240088e-02   -1.413020127394186e-02   +2.596618258638626e-02   -1.743599727705883e-01   -1.006500498769410e-01];
L2I_L1I_iGABA_netcon = [-3.029905596753272e-01   +8.861774080541668e-02   +2.574536229057753e-01   +2.794758037279665e-01   +2.724030077123981e-01   +1.202749500240411e-01   -1.943684507123750e-01   +5.724142532649172e-02; +1.883893108032313e-01   +1.007347028230408e-01   -1.391239441055119e-01   -7.372858220421560e-02   -1.213265929853350e-01   +1.518853575287059e-01   -3.150190750777071e-02   +1.331343046271273e-01; -6.634628827865899e-02   +2.110105907186255e-01   -1.087818534994736e-01   -2.205637312724396e-02   +3.905962202633362e-02   +8.276030721511028e-03   +2.020426862698856e-01   -5.749926665902631e-02; -1.644517007433131e-01   -2.720531800794458e-02   -3.625334358306249e-02   +8.286653906002653e-02   -2.637318040129564e-01   -1.760457010094146e-01   -6.864844095561870e-02   -5.613964608116645e-02; -1.725516980994894e-01   +1.111142017426038e-01   +3.972915652259417e-01   +2.310783702332534e-01   -3.598064719586451e-02   +6.123303983564997e-02   +1.910468309843756e-01   -1.259710992793271e-01; -1.528232199272099e-01   +2.593885540758376e-01   +7.550572834140250e-02   +1.471778694517832e-01   -4.542966729880949e-02   -3.514136683771079e-02   -2.841850699266913e-01   +8.888850238718032e-02; -9.393848620682649e-02   -2.105873412413393e-01   +1.242395497562264e-01   -5.126997223299244e-02   -6.614479061983081e-02   +1.528147837260291e-01   +2.285091286198357e-01   -9.546698119563828e-02; -2.148638112195477e-01   -2.315227912175831e-03   -1.451130232610569e-01   +5.784685476288648e-02   -2.372793703164552e-01   +7.603728873458251e-02   -1.597623380225421e-01   +2.123319055615645e-02; -2.431309083425158e-01   -2.419942368274479e-01   -1.183849473381285e-01   +1.811993730650827e-01   -2.982658555083575e-02   -1.668442722025285e-01   +1.058921670818525e-01   -1.927824128401149e-01; -2.523757977420218e-01   -1.115965262404969e-01   +1.573056316392455e-02   +1.056431702895431e-01   +1.735186989914711e-01   +3.598262028599043e-02   -1.988781421160324e-01   -2.418442011762290e-01; +3.916970054173779e-02   -8.964678261252379e-02   +5.076487664540565e-02   +1.344350035462726e-02   -5.988141340984079e-02   -1.898066762288160e-02   -5.703337584917534e-02   -1.215803699099046e-01; +8.723406387765481e-02   -1.733490200084200e-02   +2.398000064833229e-01   -7.319535988210528e-02   -5.140903866311444e-02   +8.575796354257226e-02   +3.005259996246535e-01   +6.645707502612945e-02; +2.333645650035773e-01   +3.083499870937436e-01   -2.032750712669384e-01   +2.409635280501751e-01   +1.267490926829032e-02   -5.820125775670869e-02   -1.887676678553504e-01   +4.370644785384320e-02; -2.671685118893852e-01   +1.736714485305934e-01   +4.707411834192757e-01   -8.342427902912591e-02   -7.432263851007391e-02   +2.223865460792031e-02   +1.201340684604328e-01   -5.997833477767045e-02; +2.980729090501618e-01   -7.652459546479717e-02   +9.260585337134859e-02   -3.113316056025430e-03   +1.468355489090206e-01   -1.508327433604895e-01   -2.216570117449703e-01   -1.467782057358827e-01; -2.219504043873421e-02   -1.592187416594784e-02   +2.111123394753022e-01   -2.135713405488758e-01   +3.568296524458787e-02   -7.954552891391052e-02   -4.417729011257847e-02   +3.231533434178435e-02];
L1I_L2I_iGABA_netcon = [-1.329561409806487e-01   -2.074611529109175e-01   -1.778046291737403e-01   -2.000850910456157e-01   +1.479348932558032e-01   -9.763315120864416e-02   +4.616154148758776e-02   -8.090805602865084e-03   -1.267699270291692e-01   +2.085038876452445e-01   +4.210872541156764e-02   -2.213749924042106e-02   +2.270268343946901e-01   -7.346216079572050e-03   +4.205264779107839e-02   -1.387845405603287e-01; -4.051116905011947e-01   +2.335460180481475e-01   +1.476264600383412e-01   +2.738384139770603e-01   +9.856456100422213e-03   -1.271828888501936e-02   -1.184983209531661e-01   +2.246473064488653e-01   +3.196338828500951e-01   -2.298917870894574e-01   +3.992805422481759e-02   -3.245251797343730e-03   -1.922311872754426e-01   +3.077876927039473e-01   +2.029738375851835e-01   -1.309182530078323e-01; +1.171839093199311e-01   +1.335177287564571e-01   -2.929861751651933e-02   +2.446835319832243e-01   +1.126912677632554e-01   -6.115833047239865e-02   +1.795810461291094e-01   +1.738160903464812e-03   -1.527467946747004e-01   -6.959586664818587e-02   -1.605109725348698e-01   +2.059005883123844e-01   +1.891157583661748e-02   -1.655302168692075e-01   +6.498187002682876e-02   -3.257400007116775e-01; -1.362376606535096e-01   -1.225571093373377e-01   +2.550697745990714e-01   -1.769684462671771e-01   +5.116962131287309e-03   +1.314988038926678e-01   -1.404969261276466e-01   -7.795569151894205e-02   +1.139510352623916e-01   +3.237650951216058e-01   -1.198867143526109e-01   +2.452324350661836e-01   +7.311361356650661e-02   -7.528941718033652e-02   +8.872427437466206e-02   +1.756735515920141e-01; +2.465431940840058e-02   +7.599816795525660e-02   -5.660965639294521e-02   -5.678085813085866e-02   +9.306397306088995e-03   -3.402354351847799e-02   +1.355997749261934e-01   +1.351208890880926e-01   +2.787849442295226e-01   -1.462996610328839e-01   -1.415226636961828e-01   -1.371862714229198e-01   -5.986920712258290e-02   -3.795895241697534e-02   +8.565382501958488e-02   +4.409854761034461e-02; +2.533770291558819e-02   +2.603799679828588e-01   +2.445252231038290e-01   +3.189512249532699e-03   +3.049676711813432e-02   +5.764626094659338e-02   +9.268444687312200e-02   -2.217956945128358e-01   -1.757349410148068e-01   -2.027135364985890e-01   -5.669205762918150e-02   +6.220288471888140e-02   +1.243971123263250e-01   +3.918447818107714e-02   -2.691364776914064e-01   -1.108357729128149e-01; -1.553017375513072e-01   +9.135568195213453e-02   -5.518811766461101e-02   -8.910272069632409e-02   -2.749363066657617e-01   -3.919590994355735e-01   -1.527429004069353e-01   -6.930815568462348e-02   +3.027247342956909e-01   +2.214625455070427e-02   -3.372114882292469e-02   -1.234401397939550e-01   +1.789724278354252e-01   -1.721871016080261e-01   -7.026986708162458e-02   -9.082005502478845e-02; -1.011697375933812e-02   -8.685094062319215e-02   -7.194804556440280e-02   -8.647472651673188e-02   +6.546786595146568e-02   +5.003633589513067e-02   -3.584331397733557e-02   +9.302592818644387e-03   +1.605692724572459e-01   -7.578419698476754e-02   +1.925552804786876e-01   +3.889799270524480e-01   +7.893678649976144e-02   +1.941556946895604e-01   +4.772806758082945e-02   -1.437216778963157e-01];
L2E_L1E_iAMPA_netcon = [-8.540746130271563e-02   +7.445768554766767e-02   +1.854705596502978e-01   +1.034318213464378e-01   -8.088237590291716e-02   -6.030447368597236e-02   -3.592180707701130e-01   -2.141905918954525e-01; +8.735143547713037e-02   +2.167160009740075e-03   -2.505987798277541e-01   -1.200550127292683e-01   -1.810499303913433e-01   +1.772801439731218e-01   -1.845898906832604e-01   +1.412873591028190e-02; -5.100054409520577e-01   +2.302638244678687e-01   +2.026386947758546e-01   +1.051571451112442e-01   -1.112690663614140e-01   -1.715287382033730e-01   +4.913495066407465e-02   +2.322085110482338e-01; -1.882658200816660e-01   -1.353516791573856e-01   +1.742222410253847e-01   -2.679531805808585e-01   +9.969937608186868e-02   +4.099798615255767e-02   +1.715783882105916e-01   +2.249252096324546e-01; +6.978501944108520e-02   -7.381940548167822e-02   +1.248367929962942e-01   +1.945161255270438e-01   -2.235453909353685e-01   -2.480327215224189e-01   +2.413144048778330e-01   -5.107370358140016e-02; -2.058693051813937e-01   +1.847222073873055e-01   +2.693292812372890e-01   +4.429771113833338e-02   +1.250849115529020e-01   -1.299041592044653e-01   -1.185948724915632e-01   +1.922764646160569e-01; +1.276766736131919e-01   +1.142737201584897e-01   -2.007890223456757e-01   +1.743440948549280e-02   +1.072880802114155e-01   +1.989599656847195e-02   -2.937453234208590e-01   -1.283306936723257e-01; +7.003418643538135e-02   +2.660247630607602e-01   +1.740871977907866e-02   -1.153246516473901e-01   +1.896884288094299e-01   -2.196328322802700e-01   -2.087811355954755e-01   -6.522266517777070e-03; -9.483960587243312e-02   +1.569159056096535e-01   -1.453573238440642e-01   -2.246087643298035e-01   +1.503855166755134e-01   +6.817154490528232e-02   +1.312446677511900e-01   -7.992363587995693e-02; -7.685740553429971e-02   +6.007127333676020e-02   -2.006552498632658e-02   -3.916619134952452e-02   +1.667615263501083e-03   +1.553271894730435e-01   +1.893482302261684e-01   -1.684298730624026e-01; -2.008173348717393e-02   +1.771443056724017e-01   +2.895194948069412e-01   -1.760015621448629e-01   +1.586771244110247e-02   +2.569137497336088e-01   -3.531050210748586e-01   +1.775046194390776e-01; -5.509327855863730e-02   -3.189521832397383e-01   +1.043712849830084e-01   +1.431140616420940e-02   -1.362964422714148e-01   -2.221020871674963e-01   -1.959502995402825e-01   +3.603384418221504e-02; +3.307138692044921e-02   -9.670887562664522e-02   -2.627996498495173e-02   -5.543813143120887e-02   -1.488639115417478e-01   -1.682561107945828e-03   -7.959676044123842e-02   +1.802945131627945e-01; -6.408982998589795e-02   -3.617037655390734e-01   -2.592864878766983e-01   +1.844637325829532e-02   +7.345818278747741e-02   -8.577786725898504e-02   +1.119719239074452e-01   -6.183211637947023e-02; -8.679338684020946e-02   +5.184864205653023e-02   +2.946401377901811e-01   +1.379232947021655e-03   +1.498886619141604e-01   -3.310413620928475e-01   +3.415296439569474e-02   +4.800286253618383e-02; -5.237523393971680e-02   +1.444504512709431e-01   -2.434768237279683e-01   -1.404555260854099e-01   -2.356579119621455e-01   +1.281581811280431e-01   +2.173713468040522e-01   -2.307937874845755e-01];
L1E_L2E_iAMPA_netcon = [-1.554024382145474e-01   -1.567436740133122e-01   -6.274536292857186e-02   +1.055433915508056e-01   -3.228141504578660e-03   -3.283793971684353e-01   -1.279340781129874e-01   -3.882418633818191e-01   +6.425862963030814e-02   -6.543883426256586e-02   +1.256073017623365e-01   +3.587166136330667e-01   -7.177956253731789e-02   +3.525847751306066e-01   -1.275933253359423e-02   +9.763340586926333e-02; +7.680552171505917e-02   +3.648109842983241e-01   +3.060540943564905e-01   -2.375259049690597e-02   -7.170094984058678e-02   +2.464358476501050e-02   +7.726018471933800e-02   +1.804040628131813e-02   +3.011615270069558e-02   -1.201999009893426e-02   -4.166527527254604e-01   -4.222322719621873e-02   -1.566029331591516e-01   -1.314233094780036e-01   -1.445948714798687e-01   -6.178106966260781e-02; -2.106390602534291e-01   -9.885418419820377e-02   -7.915970668787879e-02   -2.394434515690471e-01   +3.019340344648622e-01   +1.016353350587743e-01   -2.785955982275852e-01   +8.624098363827364e-02   -1.805454590309464e-01   -1.586280230904763e-01   -1.836688415171442e-01   -4.384391659675752e-02   -3.198895486066528e-01   -7.903809192981878e-02   +3.204466538731737e-02   +2.009789623364099e-01; -1.329690534092962e-01   +9.110188560269936e-02   -7.272832315503151e-02   +1.140797078304123e-01   +2.242152810263977e-02   +2.395689946237551e-01   +1.741942960411315e-01   +1.463393761017004e-01   -7.065732211782506e-03   -4.046228179981345e-03   +5.576442697972157e-02   -4.734150537704726e-02   -1.219822021244175e-01   -1.072437711060464e-02   -2.562306961844117e-01   +3.901054411984327e-02; -6.640390435333036e-03   +1.762820317340658e-02   -2.395248154639269e-01   -5.642053158378239e-02   -9.732292769702797e-02   +2.838004682979804e-02   -1.549658905731394e-01   +2.253933848544011e-01   -3.320094319858504e-02   +6.395911874520378e-02   -2.407431245428232e-02   -2.041548127329857e-02   -1.050861782339465e-01   +1.253863971718750e-01   +5.634672236857918e-02   +4.935087161778659e-02; -1.678136193778736e-01   +1.130350957469912e-01   -1.020077937037848e-01   -2.434931265097157e-02   +1.154538632354934e-01   -1.456188127643037e-01   +3.955060715767028e-01   -2.675326944267800e-02   +1.202747818308300e-01   -7.545093330510247e-03   +2.676098066972444e-01   -5.094267558283631e-02   -3.599205477941488e-02   +2.752265526888368e-01   +1.546000784529005e-02   +1.370527543044703e-01; -2.660930257797736e-01   +3.320862310422921e-02   +3.425640559463218e-01   +8.658426660747830e-02   -1.556181857416391e-01   -1.599670429295857e-01   +6.522342672068154e-02   +9.254378131301440e-02   +2.010779805802755e-01   +2.324720013420952e-01   +2.085996304576201e-01   +1.545158932772840e-01   +7.133490621093286e-02   -2.659421709492285e-01   -2.129219550103786e-01   -4.086561901477827e-03; -2.541734303893747e-02   -1.723032128922325e-01   -3.539082408950701e-01   -5.796442619749359e-02   -2.667968823168726e-02   -5.761821485641309e-02   +2.386529601938511e-01   -4.571530243418907e-02   -3.749901688874706e-02   -3.075059256313574e-01   +3.705526822844692e-02   -1.158797913832693e-01   +2.037616293900258e-02   +7.784083155536520e-02   -1.769110734351422e-01   -4.584590925067957e-02];
L2I_L2E_iAMPA_netcon = [+2.604110615394816e-01   +9.048336467574321e-02   -6.960137045104976e-02   +2.297487876431197e-01   +1.444818880217189e-01   +1.619738004684692e-01   +9.411571130497863e-03   -2.857346329363974e-03; +9.251947373316645e-02   +2.653181180924121e-01   -1.843017197486391e-01   +1.557896051691564e-01   +3.187725569944066e-02   +4.034673892400749e-02   +2.521075445030966e-01   +1.595482428399144e-01; +2.542868613972386e-02   -1.892531779194133e-01   +1.435790475206556e-01   +1.106440596751426e-01   +9.987023944088534e-02   -6.696024090362251e-02   -1.566434643608666e-01   +1.610075247109388e-01; -4.634738002267973e-02   -8.470543213056594e-02   +1.888513535974767e-01   +6.807597943532806e-04   -8.807511805894386e-02   -2.205163694780508e-01   +1.517398960489319e-01   -9.889252145268088e-02; -8.987857869775144e-02   -1.175699939077188e-01   -8.856680541755198e-02   +1.590264382245152e-01   +9.266736413124854e-02   +3.149218148271436e-02   -1.081151809629997e-02   +1.825854947732195e-01; -7.291164593677173e-02   -1.057841569936339e-01   +1.272262830435304e-01   +9.991174403004519e-02   -1.432028386320691e-01   +1.386039118519763e-01   -7.893113108146282e-02   -6.974140654101230e-02; +2.085731289194662e-02   +1.908300536359567e-01   +2.246405962495948e-01   +1.018930416192878e-01   +1.247014999870926e-01   +1.445522456865338e-01   -1.099865227995115e-01   +1.191723217318481e-02; +1.783612160685079e-01   +1.367490716067766e-01   -5.841681722265386e-02   -2.935793128838856e-01   -1.200013686779921e-01   -2.354022690321538e-02   +6.116230641327028e-02   -1.433904578767861e-02];
L2E_L2I_iGABA_netcon = [+2.315263050273240e-01   -1.038504957230754e-01   -4.010275674592694e-02   -1.119785921734139e-01   +3.442941175086507e-02   -2.435784701549344e-01   +5.775750764758163e-02   +5.412054632929607e-02; -4.646109389335351e-03   +2.511862723456533e-01   -1.778521626269720e-01   -9.789845606884306e-02   -3.434232651132679e-02   -2.202222051954518e-01   -1.994351431480790e-01   +3.178217329720106e-01; -1.649854994224548e-01   +8.429869095052314e-02   -8.965120575721955e-02   -2.656527000733437e-02   -1.666601974585136e-02   +3.756532022197273e-02   -1.827471352776102e-01   +2.375487635804757e-02; -4.170905204941632e-02   -2.811371299687234e-01   +6.009008672976362e-02   +1.502981623742312e-02   +8.318679224767284e-02   +2.045222844139972e-01   +2.505594279807686e-01   +6.212166461494644e-02; -6.750892837224169e-02   +7.076253661897228e-02   +2.214618632057054e-01   -1.348172210900903e-01   -6.332061926623829e-02   -2.338841143036378e-01   -1.626927488457689e-01   +2.467140231006102e-01; +2.924278497892158e-01   +1.102028501893138e-01   +8.724874171513475e-02   +5.610843111679189e-03   +1.544350903489223e-02   +3.456881023364464e-01   +5.296289922416500e-03   +4.642730490519402e-02; +8.645755901984256e-02   -1.753022873678831e-01   +6.096214748464653e-02   -3.352760840039539e-01   +5.811189246942457e-02   +2.295663850214040e-01   -1.931124128107141e-01   -1.329715777905754e-01; +1.272061502035481e-01   -8.178933098705818e-02   +2.246790714699960e-01   -2.009528831406313e-01   -3.438964844552472e-02   +1.845667711430069e-01   -1.824366230287648e-01   +1.203061387122197e-01];
L3E_L2E_iAMPA_netcon = [+9.682495548230068e-03   -1.395238682836606e-01   +3.541333068101192e-02   -1.611721136607101e-01   +1.285783999233181e-01   +5.030192202560670e-02   +4.171515989603526e-02   -9.222893483197947e-02   -1.168452277913910e-01   +3.423140087557300e-01   -4.953736079739507e-02   +1.939887400588778e-01; +9.673016277843574e-02   -1.526613884284075e-01   +6.009561775132797e-02   +2.058296425396113e-01   -8.356536308835730e-02   +2.122065642120501e-01   +2.114530621120865e-01   -2.292014003725943e-01   -6.474418243125739e-02   +2.422565904979170e-01   +1.176882088498100e-01   -3.622825351076153e-01; +1.791138207558430e-01   +5.506627376746780e-02   -1.914302842122630e-01   +1.441031857512003e-01   -2.103067482694975e-01   -2.212754549845764e-01   +2.115671791638792e-01   +1.794480755647776e-02   +2.506711858400685e-01   -1.849441212322716e-01   +8.818415573239805e-02   -2.885156158397386e-01; -1.330926417356543e-02   -2.275303797075421e-01   +9.903735796131152e-02   -1.259409542527577e-02   +3.066721506275975e-01   +1.119055363245079e-01   +4.079233663125213e-04   -2.848690994652611e-03   -1.356639827930732e-01   +9.492038580212157e-04   +6.932208923693123e-02   +1.928867099435256e-01; +2.539770242245769e-01   +4.727502545399273e-02   -7.331302425768542e-02   +1.013394637983279e-01   +8.490765753018985e-02   +3.244355378737218e-01   +1.639608948871635e-02   -1.555528933113229e-01   -2.006612486722083e-01   -2.160172093028234e-02   +1.407200651812472e-01   +2.419763718974531e-01; -2.239265468427957e-01   +2.724845528879539e-01   +9.349888758399279e-02   -7.166440563411294e-02   +2.298917502921632e-01   +4.174658772023658e-03   +5.624399835801526e-02   -9.762463196505851e-02   -1.958792338496741e-02   -5.199850356583190e-02   -1.901070345376441e-02   +7.940091334393065e-02; -8.286232871735687e-02   -5.711330616448822e-02   -1.498281340913106e-01   -2.226992847902015e-01   -1.101015866354483e-01   -4.930354612339589e-02   +1.557840089849508e-01   +1.113852562824530e-01   +2.585382563274340e-01   -3.402314690941956e-03   -3.313813875566096e-01   -1.351883040807884e-01; -3.820087834121065e-01   -1.191883128183913e-01   -1.303653949257512e-01   -1.942831793059699e-01   -1.963160405055530e-01   -3.192746833655127e-01   -9.485135424204663e-02   +2.628467819713772e-01   -6.915162638735646e-02   +2.446620650126115e-02   -2.277367346484977e-01   -1.046042049426368e-01];
L3I_L2I_iGABA_netcon = [-8.209700408916682e-03   -1.236385843296271e-01   -2.117270639572318e-01   -3.788886039237343e-02   +2.473094315714559e-02   -1.711836234616777e-01   -1.931124258510429e-02   -7.389384105537894e-02   -1.019341410781835e-01   -5.312469275384002e-02   -2.520247601082739e-02   +1.685777706063526e-01; +2.300040834537823e-01   -2.605239967679430e-01   -3.282953806474141e-02   +1.874150941534190e-01   +5.912768821288271e-02   +3.659983633451803e-01   -3.288337153133944e-01   -4.082433736449968e-02   +4.248477579835891e-02   +7.606783331776730e-02   -3.238052964435595e-02   +2.196831508793676e-01; +1.568706641788914e-01   -2.066072521619614e-01   +4.414764623366290e-02   -1.507239637898868e-01   +3.639688947140070e-01   +3.666817351536416e-02   -1.421061991427975e-02   +1.294000713847384e-01   -7.361728154494984e-02   +4.710677124160251e-02   -2.822296370843408e-01   -1.420392432103351e-01; -4.317837620308466e-02   +1.370485501465476e-01   +2.616827179312989e-01   -6.449565498710094e-02   -1.377285809186606e-01   -1.703557304466214e-01   +2.285721175830893e-01   +8.939673966989811e-02   +1.928620331313621e-01   +1.528742218245396e-01   +9.700743296608152e-02   -3.661451560462474e-01; +2.416666411184711e-01   +1.615003928126878e-01   +1.361062771603167e-02   +1.671824678562040e-02   +3.912328426870976e-03   -2.202243838212717e-01   -3.885932819588001e-01   -1.660572571851952e-02   -7.994836050183668e-02   +2.857133706371392e-01   +6.779280055087961e-02   +2.859484469337605e-01; +1.702624972738434e-02   -7.536796348165394e-02   +9.780538333045692e-02   +2.098471323193671e-02   +3.248988149642996e-01   +1.059984003799828e-02   +1.079856527446925e-01   -2.337884711703441e-01   -1.970002964789415e-01   -4.720898593150727e-02   -1.259993708190486e-01   -7.662054497850364e-02; +8.413244978182183e-02   -1.234322022958931e-01   +2.047207147493817e-01   +4.511041758149535e-02   +2.830751514068151e-02   -2.616022279467519e-01   +1.947997787613359e-01   +9.803379891828948e-02   +5.868299420385049e-02   -2.234445107434450e-01   +6.594020536195533e-02   +5.971451001643801e-02; +3.639411842647345e-01   -1.859745237825751e-01   -5.245951691634464e-03   -3.501533410387884e-01   -3.054276483794305e-04   -1.897423216164046e-01   +8.646650405007407e-02   +2.654408629353606e-01   -2.308746656751483e-01   -1.035666817661095e-01   +1.866102876985807e-01   +1.520337987019076e-02];
L2E_L3E_iAMPA_netcon = [+5.228769956012679e-02   -1.012296545402135e-01   +5.751150146316741e-02   -6.285847236270504e-03   +2.310379587457465e-02   +3.703132497129615e-01   +7.703657148723708e-02   +7.717650096601093e-02; -1.369375186466790e-01   -2.128045311455224e-02   -1.315079704631519e-01   +1.500829774324660e-01   +1.367684306448821e-01   -1.919910260912935e-01   -4.158217722102859e-01   -1.051847586888830e-01; +4.704794230220806e-02   +8.138904002892594e-02   -1.133499212220277e-01   -9.011555972401608e-02   -2.012390425828989e-03   -1.369780532234769e-01   +1.837067956934373e-01   -2.708996804360726e-02; +2.253868843085446e-01   +1.816205023363446e-01   -4.300414550420194e-02   +1.091993528255051e-01   +1.044039218739597e-01   -9.978511987091558e-02   -4.952472359312587e-02   +1.857655758375889e-01; +2.012724822000084e-01   -2.272301458519491e-03   -5.694273501522790e-02   -9.375464342466194e-02   +8.385536968223639e-02   +2.700409859510100e-01   -1.051948276203864e-02   +6.098434585350898e-02; +2.903819149124309e-01   +2.677172330058457e-01   -7.429599518761221e-03   -2.016382483046444e-01   -3.035410748421091e-01   +1.290626549790269e-01   +4.672130881533319e-02   +2.230739781189028e-01; +1.742130249242246e-01   +8.800808687121525e-02   -1.252888952485854e-01   -1.400270483812110e-01   +9.715724331839898e-02   +8.919697460870174e-02   -9.294176049426131e-02   +1.414078377523133e-01; +1.161000586027021e-02   +1.391096059205267e-01   -1.380804580821436e-01   +2.561244266987588e-01   +2.708684991220013e-01   +2.003780508985829e-01   +1.976683330080388e-01   +7.745047931262482e-02; +4.286297612710288e-01   +2.666203976343059e-01   +4.899540362543435e-01   +1.440089721731789e-01   +1.765739809157348e-01   +2.286290883258195e-01   +5.716635742766984e-02   -7.237657779683473e-02; +8.984985292672026e-02   -1.221154422060114e-01   -1.136559336125902e-01   -1.234766263850460e-02   +2.336682369717973e-01   +2.167004733963876e-03   +1.299627441192971e-01   -4.678743179838878e-02; +1.958564196521884e-01   +2.357744750754604e-01   +1.310104721661021e-01   -9.571484262239997e-02   -2.525406003204504e-01   +1.872171476337255e-01   +2.144823467917893e-01   +1.054554009345392e-01; +1.032822478848315e-01   -1.443369001699051e-01   -1.990005894357638e-01   -8.838910688964013e-02   -7.117349081882815e-03   +4.990674663731379e-02   -1.167186276561494e-01   +9.359339232373613e-02];
L2I_L3I_iGABA_netcon = [-1.492388105073083e-01   -3.913542078055798e-02   -7.129593209117485e-02   -1.403474383985561e-01   +2.523382224118106e-01   -1.001299354186278e-01   +1.019264191312164e-01   -2.374014351353193e-01; -1.551248390443791e-02   +1.427236459982131e-01   -9.310892410598681e-02   -7.549124972608616e-02   +1.494745447459120e-01   +1.764167517059770e-01   +2.646669926740385e-02   +3.651126366065651e-02; -8.968087353567654e-02   +1.161408146989168e-01   +1.057491310275094e-01   +1.082552673122351e-01   +3.054538394254418e-01   -7.486282475543732e-02   +2.489630442007844e-01   +1.601692498941057e-01; -6.204325410570612e-02   +1.995026505130210e-01   +8.403090589981274e-02   +7.711164457931435e-02   +1.142929437055434e-02   -1.505194705740968e-02   +6.369056414729925e-02   -3.903761475235046e-01; -1.429428044185815e-01   +2.367518418612194e-01   -2.240184279705866e-01   +2.564618900323257e-01   -3.080835677930857e-02   -3.258045199327059e-02   +3.398674919317195e-01   -4.720557733908420e-01; -4.542360756540616e-02   -3.787551847734105e-02   +3.819683381670475e-01   -1.981856448368295e-01   +3.608788573846730e-02   -6.075989641930832e-03   -7.613430464266141e-03   +2.996254466377379e-02; +4.948915169249232e-02   +2.315830327698775e-01   -2.895232509339595e-01   -3.065987617415468e-01   -2.860812716747903e-03   -7.078091724892457e-03   +6.258780248759441e-02   -1.214608158492736e-01; +2.694728314954338e-02   +1.496399332035626e-01   -6.834475376808336e-03   +2.774840125871366e-01   -5.960603027977220e-03   +2.713918689999243e-01   +2.109571705895283e-01   +2.747788340032162e-01; +8.080320474060934e-02   +1.316036868811064e-01   +4.335214192439834e-02   -7.529949936397817e-02   -1.752928808327013e-01   -2.959210248629620e-01   -8.489922795067900e-02   +1.122128084327566e-01; -1.376701684884852e-01   -9.201244952212767e-02   +6.989346225168558e-04   -1.796930914340348e-01   +1.660691164483061e-02   -8.588375107780932e-02   +2.888084770632024e-01   -5.247523088311872e-02; -2.079596457287937e-01   +1.514277475037454e-01   -9.036415495574504e-02   +2.437560877087361e-01   -1.737280067273791e-03   -1.657470021500191e-01   +3.755104491873185e-01   -2.312174791512539e-01; -7.947976590023223e-02   +1.585561398691543e-01   +5.455858631520052e-02   -1.780780423643338e-02   -1.953197268509107e-01   +9.759765354614235e-02   -1.427760106092288e-01   -2.973800810421167e-01];
L3I_L3E_iAMPA_netcon = [-3.815245573229787e-02   -8.133263628744916e-02   +5.958456465303916e-02   +1.905837517456181e-01   +1.643783822229230e-01   -2.641196681554727e-02   -5.003594884606054e-02   -1.273132476701052e-01   -1.223131533835108e-01   +1.807936850014330e-01   -2.655976592762793e-01   +5.154979978542856e-02; -8.803260070972677e-02   -1.381446346261292e-03   -2.798509428082232e-01   -1.662005427957144e-01   -4.710692684646957e-02   -2.489454289309266e-01   -8.416282754393689e-02   +3.312044739449977e-01   +3.499668219652393e-02   -2.015922179156004e-01   -2.252164735767642e-02   +3.711417746261128e-01; -1.278901193078834e-01   +1.873018690011549e-01   -1.771410309738625e-01   -1.678996206448476e-01   +1.678056869912893e-01   -2.751887993075045e-01   -6.398598341747599e-02   -2.299078348627853e-01   -2.785693334243523e-01   -2.428135909897230e-01   +4.945331456580371e-03   -1.394608145329785e-01; -1.413349178145336e-01   +1.625676918895226e-01   +7.981430260932267e-02   +1.571547788676692e-01   -1.067792610510738e-01   -7.612258821876952e-02   -2.179612945638984e-01   -2.065720322057735e-02   -1.620255160083317e-01   +6.060248655500002e-02   -1.786440001774266e-01   -1.833344685478226e-01; +2.134360017711636e-01   -8.848794856378039e-02   +1.426780678021845e-01   -1.784203832315770e-01   -3.617072551862616e-01   +8.969253563398946e-02   -2.799906261096934e-01   -1.291108606335649e-01   +1.142057789959646e-01   +2.687102840797345e-01   -1.797355086630553e-01   -6.982822148219138e-02; +5.463207999333874e-02   -3.101091525150292e-01   +3.078106367649170e-02   +1.174933149774472e-01   +2.328825771895665e-01   +1.329694136574363e-01   -1.259721470920406e-01   -1.190992024633234e-02   +9.102990157045697e-02   -2.290061112732486e-01   -1.062248106643073e-02   +1.503228871284353e-01; -2.868963962599584e-01   +1.341707417269265e-01   -3.697283925006832e-02   +6.261393070706300e-02   -5.266782058741903e-02   +7.258988734111262e-02   -1.103443171851263e-01   -3.064516309293987e-01   +1.518943809354056e-01   -3.477249553413084e-02   +1.014997541024916e-01   -2.574408577665435e-01; +1.064041531632926e-01   +1.372449664766133e-01   -3.016718609857757e-02   +7.763560872282710e-02   +1.023773200319680e-03   +1.283543685633599e-01   -3.063897597788307e-01   -3.063364971478729e-01   -1.068388874499090e-01   +2.374240434074116e-02   -1.314706381531713e-01   -2.935133512734063e-01; -1.239675938001431e-01   +2.785249168454615e-01   -1.329359170715996e-01   +8.801904615974983e-02   +2.081816287983960e-01   -2.449550081821756e-02   -1.536375123517513e-01   -2.044078047126597e-01   -2.219339088840452e-02   -2.262819617935888e-01   -3.968332346021987e-02   -2.886298579905322e-02; -3.839819995789719e-02   +9.565862851048033e-02   +4.412409175538450e-02   -1.844808646419323e-01   +1.794259610942351e-01   +1.590201551410761e-01   +3.017295229128278e-01   +1.450746460343124e-01   +7.881299068951858e-02   +2.177288682536000e-01   +4.925133029585729e-02   -3.856379375824822e-02; -2.721406537233584e-01   -1.032057878545180e-01   -1.621168300804164e-01   +6.761896258423847e-02   +8.363949996992130e-05   +1.155400888904990e-01   -4.353831577267700e-02   +1.243989268137600e-01   +2.309662076416127e-01   +2.285345375500049e-01   -2.076630387245394e-01   -8.739907502493111e-03; -3.012983446136798e-01   -8.064704868606701e-02   +9.595913358332930e-02   -1.531455922775411e-01   +2.671858202825975e-02   -4.041404692279668e-01   -1.001263636758910e-01   +1.832722752225241e-01   -1.260379910226740e-01   -1.579098829440178e-01   +6.315722119660944e-02   +5.273944194061313e-01];
L3E_L3I_iGABA_netcon = [+1.739733168651370e-02   +4.709332873942810e-02   +5.238566511685647e-02   -1.238720636229159e-01   +2.003766783179297e-01   +7.808657187172230e-02   -2.890370062304161e-01   -1.071101630882401e-01   +1.018508348444128e-01   +1.123139650679324e-01   +3.197852132152551e-01   -1.099460491821520e-01; -2.166743169285541e-01   +4.371554272304474e-02   +6.587010971622657e-02   +4.944247140099403e-02   +5.792397061406110e-02   -1.162805428976609e-01   -3.277873932148824e-02   -1.831818547536944e-02   -1.456898207583857e-01   +1.094759318985649e-01   -1.756374334252585e-01   +3.150647796504204e-02; +1.083789759003426e-02   -2.796966074938885e-01   +8.730516848880698e-02   -1.893993019839491e-01   +2.381018908924689e-01   +8.483194341839156e-02   -1.544870451465336e-02   -1.716196948251376e-01   +2.080574933544096e-01   +1.423005293158681e-01   +8.324945296788640e-02   +3.971514215944643e-02; +1.409729058063127e-01   -1.155369935072113e-01   +1.942088517217839e-01   -1.575639789342227e-01   -8.593384401408197e-02   -3.250680092742210e-02   -1.176922961702749e-01   +2.511534083688112e-01   -2.228704000661292e-01   +9.462873612371937e-02   -2.296363318266206e-02   +3.732894842690602e-01; +8.182613566446409e-02   +2.056090232314842e-01   -2.275162226493928e-01   -1.123192600716041e-01   -1.843945622712621e-01   -2.501479392814309e-02   +5.284169803820053e-02   -3.674109879821016e-02   -1.913952553624628e-01   -2.985979876727795e-01   -4.011255982943968e-02   -1.323697987117450e-01; -4.823778768184015e-02   -1.948054203105605e-01   +7.559201793767832e-02   +1.522367055430245e-01   -1.424229473475485e-01   -4.323626717965059e-01   -9.415867645626233e-02   +4.745554162973820e-02   -7.651643263113302e-02   -3.947975328616818e-01   +1.140380727814583e-01   -1.261467479958147e-02; -2.514098507827259e-02   +2.010893446390983e-01   -9.957649865916887e-02   +2.354125386510262e-02   +2.562672557578041e-02   -2.011037558280522e-01   -9.418519408821982e-02   +2.321102186267842e-01   +1.422795916760574e-01   -2.000752684082732e-01   -1.436041389476606e-01   -2.419110507238883e-01; +7.105193300454386e-02   -1.075448752060093e-01   +5.073153797647518e-01   +2.094006349359005e-02   -1.597530746909634e-01   +1.430912388979748e-01   -1.201628717280601e-01   +3.842627478145320e-01   +1.072190265168544e-01   +8.144309461878850e-03   -1.870023704925991e-01   -1.915107877733315e-01; -1.348359869535754e-01   +2.080168970122708e-01   +2.104677454234876e-02   +8.867674177344161e-02   +3.122684586201089e-01   +3.034052409588095e-01   +1.840985689604708e-01   +7.845097387985901e-02   -6.426886765519284e-02   +5.741013179130794e-02   -3.446922247035536e-01   -5.929680473311546e-03; +2.006951286556945e-01   -1.382829504309077e-01   -1.712696941308333e-01   +3.160822375747213e-01   -9.833416929669223e-02   +1.794550688991383e-01   -9.833691355422476e-02   -1.539105165621390e-01   -2.059938306055992e-01   +1.088617881487780e-01   -2.105013302938727e-01   -1.761494671053266e-01; -2.036931550711209e-01   +7.309133676776479e-02   -2.716313722341063e-01   +2.345444000057099e-01   +1.520962590995057e-01   +9.245465624281005e-02   -4.356714338881897e-02   +2.744634070325646e-01   -1.031722004164977e-01   +2.543972242720365e-02   +2.789766553970906e-01   +1.360238479970720e-01; +1.674895945066727e-01   +1.123062258130577e-01   -1.317384739062784e-01   -9.617923323677877e-02   +1.122586227586634e-01   +2.777360386238108e-02   +1.611606097632028e-01   -3.159414399974576e-01   -9.286728931778795e-02   +2.431847174125828e-01   +1.474742782952932e-02   -3.029114508376173e-01];
L2E_Input1_iAMPA_netcon = [-9.330160464020348e-02   +2.503945004143681e-02   +2.700594057639695e-01   +8.895236468058657e-02   +4.633572693973310e-02   +4.649849263743971e-02   +3.856156550402878e-01   -5.881812472286366e-02];
L2I_Input2_iAMPA_netcon = [+7.329052306564490e-02   +1.641574252194964e-01   +1.609762121313070e-01   +2.792080309926493e-02   -2.200433280704878e-02   -3.232232923697015e-01   -2.606645374936336e-02   -2.232824273400291e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
