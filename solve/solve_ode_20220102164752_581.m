function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.907184491286959e-02   +2.296918712252813e-01   +3.988236375894732e-01   +3.015948122707006e-01   +2.702595142480155e-01   +4.213861437323789e-01   +2.169644787798669e-01   +8.050608241269397e-02   +8.586251043712329e-02   +1.940777595184935e-01   +2.486108036454599e-01   +8.292251098987424e-02   +1.706078030759635e-01   +2.858762739481951e-01   +1.897410303556330e-01   +3.390461882325625e-02; +1.593391223880158e-01   +6.982914995757129e-03   +2.277761238344420e-01   +2.710002046952994e-01   +1.230551021783326e-01   +1.413804964815032e-01   +3.952891103840864e-01   +4.288305708907880e-01   +2.975965970704743e-01   +8.515890793996081e-02   +4.257872734792850e-01   +9.343880822445433e-02   +8.545134481358967e-02   +1.492537523953300e-02   +2.295890475322353e-01   +1.477311597958579e-02; +2.861354940605277e-01   +3.081551060799048e-01   +3.677331612205625e-01   +2.033834158579978e-01   +4.960456644219573e-02   +3.657491087937306e-01   +3.807287904615797e-01   +1.850248511590020e-01   +2.051047027417386e-01   +1.789939693208200e-01   +1.949531206578397e-01   +6.244273008435727e-02   +2.993122924609597e-02   +6.283592135576745e-02   +3.565717209618172e-01   +2.544674749975748e-01; +3.458131976938334e-03   +1.116721678460695e-02   +1.973072524165547e-01   +2.674127305626636e-01   +8.905909471562939e-02   +3.444658366723617e-01   +1.948247634362636e-01   +4.185150199096961e-01   +2.093832007924484e-01   +1.296114310598613e-01   +3.864858751050785e-01   +3.851401753957191e-01   +5.534285650382074e-02   +3.981194051347129e-01   +9.835542747447082e-02   +1.357792652501326e-01; +2.028656620796978e-01   +2.773591511319818e-01   +2.678130747771915e-01   +2.974699068324817e-01   +1.711371424965941e-01   +3.565261696952749e-01   +2.146376101559586e-01   +1.144289939121646e-01   +2.397404864182144e-01   +3.645054049629942e-01   +1.599800186632596e-01   +2.963883420473610e-01   +1.049189912482625e-01   +1.369940862388903e-01   +3.851410578698778e-01   +7.035577344919343e-02; +2.098734415462610e-01   +6.073427902429823e-02   +3.615389651108412e-01   +6.946168484628165e-02   +2.731834883660899e-01   +1.338658525803222e-01   +1.947073333406537e-01   +8.000004292363146e-02   +2.134820851182027e-01   +2.077926446779753e-01   +3.253227717429435e-01   +1.043858912846666e-01   +2.102124304966891e-01   +2.282249980267007e-01   +2.095649448338665e-01   +3.025693955983281e-01; +1.400783392166820e-01   +2.844658273346721e-01   +4.038970481359308e-01   +2.828239931901287e-01   +1.664149227107634e-01   +2.666065147463751e-01   +1.618370249656240e-01   +3.598360504573715e-01   +4.150079552116149e-01   +1.727307806790518e-01   +6.569207065932693e-02   +7.417315642727490e-02   +1.825230593034630e-01   +4.053449638529998e-01   +1.939903270407047e-02   +1.036396736894517e-01; +2.463153889100411e-01   +1.529379138539786e-01   +3.358304651174461e-01   +2.655552919159645e-01   +2.510579211460968e-01   +6.557654223236256e-02   +3.385244055707321e-02   +1.873626189935065e-01   +3.306368622748297e-01   +2.930733296162445e-01   +1.259789399641907e-01   +3.246252486468851e-01   +1.356571728587768e-01   +4.730772867516299e-02   +3.085387227335844e-01   +2.681067583812918e-01; +4.481842465901040e-03   +2.882756877371402e-01   +2.912038259988169e-01   +2.940059538865211e-01   +4.040422736415501e-02   +3.905825368971971e-01   +1.948457758350701e-01   +1.913940883293719e-01   +2.140188545384112e-01   +2.099146652327556e-01   +7.348908305216977e-02   +3.862940405482972e-01   +7.398643679382142e-03   +3.330504228680157e-01   +1.619469174593077e-01   +2.159730463410299e-01; +3.034971755571988e-01   +4.645866806022682e-02   +3.830682495612130e-01   +3.564671505804370e-01   +2.718406108680006e-01   +7.962902800187353e-02   +3.680926576925404e-02   +7.873843894843885e-03   +3.262419536057780e-01   +1.724742602658700e-01   +4.438163669563652e-02   +2.401927972117471e-01   +3.599457490971045e-01   +1.138460647243918e-01   +3.734624235407030e-01   +2.845345631073802e-01; +1.710819645350142e-01   +2.079916776846528e-01   +2.228555939948537e-01   +3.434853848123956e-01   +3.895960973552557e-01   +8.164964177132920e-02   +2.694549127540503e-01   +2.568595561057450e-01   +1.065986734452369e-01   +1.255977189560455e-01   +3.115415924387130e-01   +4.074542705613378e-01   +5.270641217521979e-02   +3.033617148153992e-01   +3.303085655236333e-01   +8.246372923994372e-02; +2.276420283213018e-01   +1.318390539466569e-01   +4.511660420117664e-02   +4.499806816602434e-03   +4.181287519350231e-01   +3.920787342414119e-01   +1.783933630654071e-02   +3.002686024055940e-01   +2.981429587114191e-01   +1.281760999420930e-01   +4.763407195452930e-02   +1.306104609957943e-02   +3.972576902376631e-01   +3.508413657234272e-02   +2.310624913545063e-01   +1.756471815166125e-01; +2.839385670168231e-01   +3.169494007430687e-01   +3.799828414752126e-01   +6.579056166207600e-02   +2.875331120445483e-01   +3.043918700368214e-01   +3.083073058116385e-01   +2.773743754797946e-01   +3.851067652698144e-01   +1.900243825442808e-01   +1.787270623855086e-01   +3.768230194753602e-01   +3.643588409899123e-01   +3.084231393555733e-01   +1.931693583231381e-01   +3.876729487147089e-01; +3.617778802823255e-01   +2.890911086721822e-01   +1.307295417482653e-01   +2.678311670708452e-01   +5.060838297123011e-02   +1.055033411817455e-01   +2.388289284331303e-02   +1.012077810121754e-01   +1.480173762065613e-01   +3.010847810564791e-01   +8.422479694776187e-02   +3.389405322057515e-01   +2.429057345667744e-01   +2.693486200416440e-01   +1.696120281042789e-01   +1.376247674612538e-01; +1.845156524034927e-02   +2.284109341986809e-01   +3.642577828471453e-01   +2.256293227558064e-01   +1.164823980224360e-01   +7.986831400808839e-02   +1.163994419233807e-01   +1.719545430485415e-01   +9.928401486055691e-02   +4.307530277613746e-01   +1.549661659221890e-01   +2.345394565709631e-02   +8.123616308074788e-02   +3.129409361732022e-01   +1.294619306479889e-02   +2.933694471308322e-01; +3.377381177057386e-01   +1.578359180536194e-01   +9.211791757572080e-02   +4.139446872247677e-01   +5.174542364337135e-02   +5.900240958942832e-02   +3.814480564505749e-01   +6.414982251358398e-02   +2.628365532466331e-01   +3.261948473558285e-01   +2.855467304133020e-01   +6.512343863210135e-02   +3.208305694877971e-01   +3.424058245978681e-01   +4.087800322303659e-01   +3.852571010786047e-01];
L1E_L1I_iGABA_netcon = [+2.262787626403855e-01   +2.761772793619029e-01   +2.866718399518829e-02   +1.437151790454234e-01   +3.584475098299588e-01   +1.707855913816604e-01   +1.578668852070668e-01   +9.909398634499952e-02   +3.630501682231047e-02   +1.623199455747176e-01   +1.617355801345212e-01   +2.489920686892840e-01   +1.368572829185956e-01   +3.901297874828053e-01   +9.571929240718323e-02   +2.209845721449477e-01; +6.021721415387787e-02   +3.939356617787494e-01   +2.197362580114042e-01   +3.797042591030255e-01   +1.976928171638293e-01   +1.815386897518005e-01   +6.443336163259533e-02   +2.211591375459833e-01   +2.061704243399313e-01   +6.723486812182117e-02   +8.811800126737236e-02   +3.031529884308873e-01   +2.066971771916257e-01   +3.125467451423912e-01   +2.169953301041384e-01   +3.089987772635080e-01; +2.724043347176262e-01   +4.281279356709616e-01   +3.374781231352310e-01   +2.761515494859173e-01   +4.826184345701197e-02   +2.519057178200478e-01   +2.837791604327436e-01   +3.716006959987436e-01   +3.814912588627500e-01   +4.115968182785870e-01   +2.851072453232892e-01   +2.148495259890582e-01   +4.150456002651070e-01   +3.582585799980582e-01   +1.871895423337728e-01   +2.406986912502245e-01; +2.023680924260994e-02   +5.798821990978698e-02   +3.964899590318141e-01   +1.914003745829898e-02   +7.769683354736308e-02   +3.097175066439192e-01   +3.053133335928448e-01   +2.454192200518532e-01   +2.141101608323652e-01   +4.163421899983881e-01   +2.775465101382427e-01   +3.644860850892283e-02   +1.487117759659156e-01   +7.872487938370945e-02   +4.175149306434559e-02   +4.174778935675508e-01; +1.096549960074200e-02   +3.743851435187432e-01   +2.248851273242623e-01   +3.910402534094086e-02   +1.822665331964916e-01   +3.657275939352557e-01   +3.031295204607899e-01   +1.688889085803697e-01   +8.313686805626840e-04   +6.687755130426699e-02   +3.104601504330715e-01   +5.434569296409666e-02   +3.512858572397093e-01   +2.008196311363252e-01   +2.843584789629867e-01   +2.352314746151051e-01; +3.334541037878511e-01   +4.031174953361469e-01   +6.689684926126253e-02   +2.869070604626461e-01   +1.539087141611207e-01   +2.523654347460576e-03   +2.991682732462785e-01   +1.276484134387970e-01   +3.557774411704810e-01   +7.292861564714770e-02   +4.061651973044453e-01   +5.784517846703383e-02   +1.622663607642812e-01   +5.735507103002264e-02   +2.287966842368418e-01   +6.080645274641776e-02; +2.141808345860076e-01   +9.709780598173680e-02   +5.802087232265594e-02   +1.141682025941986e-01   +8.540729101230271e-02   +1.620218274903905e-01   +1.283225021857886e-01   +2.295226321983551e-01   +3.778256108350365e-01   +6.923595033508145e-02   +3.254349853197533e-01   +4.292718786536957e-01   +4.306833707493720e-01   +2.249279497649359e-01   +2.217745731701621e-01   +1.285013698841671e-01; +1.184821669431112e-01   +9.534931761786962e-02   +1.028087151774301e-02   +6.807401157900385e-02   +3.127205558951192e-01   +2.251641848305224e-01   +2.146690733477842e-01   +2.672534302129341e-01   +8.321033758451249e-02   +1.783012811790662e-01   +3.555921792188477e-01   +4.053913906723196e-01   +2.264412373854209e-01   +1.978134155403568e-01   +7.948210115860566e-02   +2.995287479481558e-01; +1.297330235081299e-01   +2.635542578100409e-01   +1.296375364416164e-01   +5.470548960215062e-03   +7.558727211294916e-02   +3.041325244868184e-01   +3.447126396925612e-01   +3.892061296746319e-01   +1.602565563557103e-01   +4.640109342589948e-02   +3.259256908336445e-01   +1.519742806406725e-01   +3.815593165697965e-01   +4.034111475276617e-01   +2.609228031459730e-01   +3.403628943448884e-02; +2.168689553735003e-02   +1.729333739944876e-01   +6.834453904506727e-02   +2.481137539052316e-01   +1.751951167668098e-01   +3.622141284997780e-01   +1.333652377955905e-01   +9.876066610547078e-02   +4.015954395842670e-01   +3.315729162379106e-01   +1.023571804965264e-01   +2.602084374706851e-01   +3.316854720679960e-01   +8.139984980407822e-02   +3.342005721148508e-01   +9.340724571531345e-02; +3.716537039112772e-01   +3.753806978763328e-02   +1.324178315887591e-01   +1.755818060272896e-01   +2.291871201922905e-01   +2.876275570803173e-01   +1.964854792924750e-01   +4.155073323368903e-01   +1.375725661884646e-01   +1.753331060195870e-01   +2.455550684284310e-01   +2.040839833203232e-01   +1.102194006488752e-01   +4.204046052221602e-01   +3.812495016456863e-01   +1.448718166068960e-01; +7.754298046181796e-02   +3.888590726499445e-01   +2.376443104415064e-01   +3.956588633250986e-01   +4.269571188343181e-01   +2.855084938717182e-01   +2.048185599067878e-01   +6.213455498615749e-02   +3.103412900708707e-01   +1.974736826120208e-01   +1.476784916482970e-01   +3.603352101362288e-01   +2.897138516680370e-01   +2.116912902992575e-01   +3.369949858042767e-01   +1.052634692461707e-01; +3.165693596502932e-01   +3.533807189663359e-02   +2.284553648349613e-01   +4.811794733347149e-02   +2.340843086551007e-01   +2.462337826368543e-01   +2.547665965169142e-01   +8.878420467781659e-02   +3.186380723857281e-01   +3.803702322305084e-01   +7.756552047801164e-02   +3.376095325846552e-01   +4.163511008099802e-01   +2.657990843518065e-01   +1.590646682503174e-01   +5.824608342273518e-02; +1.104810782156337e-01   +1.114757317163779e-01   +9.936753716533013e-02   +4.429860895104208e-02   +8.123825937967913e-02   +3.752599847732357e-01   +4.026651004097590e-01   +3.255937540575692e-01   +1.870448403487896e-01   +2.824627306275098e-01   +4.210520255035340e-01   +3.192137927280428e-01   +2.709864424450560e-01   +3.743838413416382e-01   +2.815996166321381e-01   +3.139176836391529e-01; +1.835701631068186e-01   +7.548685181854456e-02   +1.922714508991151e-01   +3.787827080550202e-01   +2.691118712218690e-01   +2.172889018997389e-01   +4.917368530942448e-02   +1.479184305942990e-01   +7.352252547173664e-02   +2.203833257083825e-01   +1.133863640736683e-01   +1.884153171115527e-01   +1.602301088262655e-01   +9.778799715553445e-02   +7.919876697259134e-02   +1.309355932548662e-01; +1.877190081775546e-01   +2.955216500559532e-02   +7.800280232482411e-02   +4.005034320791621e-01   +4.047854021472565e-01   +3.041827751857872e-02   +8.918723868221323e-02   +3.497700765413452e-01   +3.388065739487769e-01   +5.759065724995893e-02   +1.980895063451978e-02   +2.719330050372554e-01   +2.794442367100579e-01   +2.195943246240596e-01   +1.721543514776826e-01   +1.905076908511192e-01];
L2I_L1I_iGABA_netcon = [+4.240121821611261e-01   +2.051295355063261e-01   +1.259560559051295e-01   +3.785313775083773e-01   +3.984348938527073e-01   +3.997120955470589e-01   +1.555461319527441e-01   +3.387605509689617e-01; +3.388789702139775e-01   +3.731552088076351e-01   +3.054713503182375e-01   +1.218809898447808e-01   +1.848597861312715e-01   +2.891697400189206e-01   +3.840030042202179e-01   +9.299315213943739e-02; +9.115561282120088e-02   +1.013223132331176e-01   +1.134533535973252e-01   +1.375119713233706e-02   +3.415764562173138e-01   +4.140033211723904e-01   +4.824102533012332e-02   +2.629479152194084e-01; +1.645789940399049e-01   +3.384638504821579e-01   +2.886229273461465e-01   +2.679153914234994e-01   +2.561133784100528e-01   +2.619194713088356e-01   +2.138108529024266e-01   +3.410639601935899e-01; +1.358040979779803e-01   +8.353690995564232e-02   +2.607587766001029e-01   +2.494588840479417e-01   +1.934731835703913e-01   +3.345868985859594e-01   +2.168904454739302e-01   +2.547898940084440e-01; +3.365602030596818e-01   +3.104803465923811e-01   +3.912399274420248e-01   +1.757913252470761e-01   +1.267264135028421e-01   +3.018303966914562e-01   +3.980836116508375e-03   +2.914114332779560e-01; +6.215043213784269e-02   +1.580028818844780e-01   +1.621970661625809e-01   +1.041647634550890e-01   +2.987073305843853e-01   +1.207695962195609e-01   +9.584198963178911e-02   +2.867365065262035e-01; +2.460351879401645e-01   +1.487379470455014e-01   +3.390947009243067e-01   +1.674852573040223e-01   +1.202333949729258e-01   +3.006492390089718e-01   +1.931833686019363e-01   +1.287971068158389e-01; +1.740460389211016e-01   +3.037054379667251e-01   +8.700048205341407e-02   +1.027011946542925e-01   +1.332758996107513e-01   +7.462847568097808e-02   +1.804804145439974e-01   +4.102799916468132e-01; +2.292479310098410e-01   +2.949473543639121e-01   +8.944536007763168e-02   +2.306405072854429e-01   +1.145675925862287e-02   +3.025262254394790e-01   +3.882212841839635e-01   +2.990564848437874e-01; +2.237994967765450e-01   +3.422659432253720e-01   +3.589685242913388e-01   +1.604678118851676e-01   +3.070401698499069e-01   +4.194036437669176e-01   +7.875626492822535e-02   +1.155885571106127e-01; +3.379309208042990e-01   +2.242053690002570e-01   +2.625120338589347e-01   +1.824101042500149e-01   +4.157008093007640e-01   +1.134028409460141e-01   +2.720769388774976e-01   +1.381337735702123e-01; +1.311222290017652e-01   +4.091043844809494e-01   +3.959745914067400e-01   +8.584317861495790e-02   +2.368644577249293e-01   +1.239670132817367e-01   +1.315392030612807e-01   +2.186314159511139e-01; +2.939699123151672e-01   +1.072474001484359e-01   +4.284426849689667e-01   +2.202845227435238e-01   +3.554630424888037e-01   +7.938260374047172e-02   +4.137482810051007e-01   +9.515996043653771e-02; +4.101980122154406e-01   +9.241134270641378e-02   +1.157733023767756e-01   +3.892838444189548e-01   +2.841288793789220e-01   +5.806838802745078e-02   +1.660645069107693e-01   +3.012591746052668e-01; +8.329793053489298e-02   +2.975001007949100e-01   +3.067006270687006e-01   +2.645463282051392e-01   +3.534195764319062e-01   +5.361709903366021e-02   +4.214301635004259e-01   +1.312068925296657e-01];
L1I_L2I_iGABA_netcon = [+2.434168027916899e-01   +2.909188173447477e-01   +1.283023120783654e-01   +2.973711106653476e-02   +2.201384574062255e-01   +1.666613621596558e-01   +4.204581290295624e-01   +2.970122399915028e-01   +1.752068099699386e-01   +3.319606565407228e-01   +6.531348628021758e-02   +1.315171690124202e-01   +5.106872762867970e-02   +1.540075317141979e-03   +8.849152111507806e-02   +3.397112862897279e-01; +3.423835874135310e-01   +2.572183774081619e-01   +1.647100310405862e-01   +1.961264191060713e-01   +3.958502283035684e-01   +1.947846694032420e-01   +2.906281885918666e-01   +4.170292348747287e-01   +1.848199199898437e-01   +4.232184113021966e-01   +2.841102950249424e-01   +1.527070574018319e-01   +2.147863220574278e-01   +2.842720574083966e-02   +1.690517534271378e-02   +3.804227995810238e-01; +3.665378976499131e-01   +2.489415842661234e-01   +9.237333462602165e-02   +3.538910952741045e-01   +1.442531203461035e-01   +3.718396481978721e-01   +3.276597131350845e-01   +2.824548625545373e-01   +1.619246730187422e-01   +1.563499693744725e-01   +2.939566241941527e-01   +1.653922441259990e-01   +1.392565976648110e-01   +6.951294442931952e-02   +2.617585023470074e-01   +5.772789880821150e-02; +1.789696683189733e-01   +2.351148384011376e-02   +2.512546836066072e-01   +3.708695368986999e-01   +4.365648369742210e-02   +2.155600682469568e-03   +1.496714536347289e-01   +1.466507622967173e-01   +2.912935241171771e-02   +2.748086201497342e-01   +2.394581698501920e-01   +2.028718409222890e-01   +1.077650114520434e-01   +2.507392145653666e-02   +3.434354291933523e-01   +2.234816831867010e-01; +3.321787683227729e-02   +3.480918929445268e-01   +3.358124120678177e-01   +2.856698389413833e-01   +2.686150866646135e-01   +2.120424347277024e-01   +2.713831631677396e-01   +3.598506485809884e-01   +2.606762773884931e-01   +1.425506129076964e-02   +1.363378839536178e-01   +4.943285236980040e-03   +1.063506909431338e-01   +3.794681785219376e-01   +8.696248826008278e-02   +2.024422221531050e-01; +2.702282655541366e-01   +3.050694200143616e-01   +5.686321385813586e-02   +3.836554101438429e-01   +2.427040793737071e-01   +4.161226606004436e-01   +3.123424102427185e-01   +3.517006168360371e-01   +2.356605441532361e-01   +2.498761939558514e-01   +4.325031164548624e-01   +3.537532950791697e-01   +5.406699763190350e-02   +3.919068206913930e-01   +3.069562437577972e-01   +3.855500662233539e-01; +3.317086258554089e-01   +6.080241341341885e-02   +3.677748263395297e-01   +4.225631948301463e-01   +1.678967263019926e-01   +4.188753111543309e-01   +2.172391838766326e-01   +2.011005400081735e-01   +7.617711034649984e-04   +2.462509071175384e-01   +1.329846927142078e-01   +1.490982760769796e-01   +3.344311073005034e-01   +1.809959021441843e-01   +3.624156734584494e-01   +2.436374790391280e-01; +3.189546790790774e-01   +4.305667224667089e-02   +3.869809959035372e-01   +3.123897750584058e-01   +4.928360408540891e-02   +3.364116103137053e-01   +2.546664563991901e-01   +3.307830786335426e-01   +1.547550061800116e-01   +3.676003688211813e-01   +1.149248637808710e-01   +2.125240921121218e-01   +2.133648444969487e-01   +2.589553058420375e-02   +3.956339193143848e-01   +9.312520465857425e-04];
L2E_L1E_iAMPA_netcon = [+3.337951834047849e-01   +1.245581219463496e-01   +6.393810347269335e-02   +4.265577332004321e-01   +5.159481116162451e-03   +2.080653304713153e-01   +2.841626510932820e-01   +3.442942874291525e-02; +3.968027021771533e-01   +3.722102248118354e-01   +2.287836483423358e-01   +1.591800517361760e-01   +2.164733732577464e-01   +7.490803957547511e-02   +3.958177088478398e-01   +1.705706019778453e-01; +4.137405610678232e-02   +5.650889175573630e-02   +1.406990806384916e-01   +6.686845424571732e-02   +2.719375986674006e-01   +3.651559950208182e-01   +1.413148191296134e-01   +1.317441181844427e-01; +1.105472252960498e-01   +3.136015852515897e-01   +9.225812122044054e-02   +2.835751156279770e-01   +3.223467699776339e-01   +1.310610916802723e-01   +3.805864858849461e-01   +3.585744689214150e-01; +8.144401480983733e-02   +4.243224216238197e-01   +6.161627658596341e-02   +1.082021116135030e-02   +4.038357143466192e-01   +4.115689471149308e-01   +2.956972096040018e-01   +1.992682949064420e-01; +3.028014274305560e-01   +2.220667916886798e-01   +4.063521463320376e-01   +3.357604972251588e-01   +3.025786863871988e-01   +9.617249388647475e-02   +3.406478619769641e-01   +2.917537214116510e-01; +4.505640411036773e-02   +1.435802037365815e-01   +1.222592512350189e-01   +1.943467124293390e-01   +3.960620386297192e-01   +1.989583444564881e-01   +6.930874710716163e-02   +1.451407809296869e-01; +3.159071724479533e-02   +5.557233835954235e-02   +2.270655946408353e-01   +2.899553018553958e-01   +1.716899753989659e-01   +3.901762796028546e-01   +4.145185306904247e-01   +3.919612644161762e-01; +1.522035146107996e-01   +3.822248947827602e-01   +1.941172123172184e-02   +1.149036920114984e-01   +7.080712828179223e-02   +4.126028917846983e-01   +2.314559633697355e-01   +3.267217306699270e-02; +1.309176759700436e-01   +1.197230339836682e-01   +3.704142296767036e-01   +1.751679760520626e-01   +3.520405735709514e-01   +3.859630022298816e-02   +5.522802408616723e-02   +4.135835629456420e-01; +2.473871767681252e-01   +2.035158851666120e-01   +8.046253674354825e-02   +2.603046677687874e-01   +1.729157882377929e-01   +1.791407141808382e-01   +2.549805354891171e-01   +3.836651706918034e-01; +1.099865157107465e-01   +1.930091904928056e-01   +3.528797964052782e-01   +3.150914256620479e-01   +2.787827764357905e-01   +8.137829397717423e-02   +4.272713953739872e-01   +1.043928193408424e-01; +2.569425051748646e-01   +3.578416623283401e-01   +1.066889682665503e-01   +2.413335915868716e-02   +4.194966457737193e-01   +2.851224658691302e-01   +1.985609304790341e-01   +3.485933015617290e-01; +1.828085194288087e-01   +1.876597005770408e-02   +4.712736225151593e-02   +2.862240458830009e-01   +4.396801155742422e-02   +1.270114086555931e-01   +3.600397169610383e-02   +3.189807272218670e-01; +1.171121968742881e-01   +8.929365424336548e-02   +2.922603984254012e-02   +3.321789353773354e-01   +4.975308797807074e-02   +3.802478945886584e-02   +1.757332139748554e-01   +9.890442646212923e-02; +6.450262937336090e-02   +1.945218939090520e-01   +5.832598749138182e-02   +2.291422869477238e-01   +1.104266815052714e-01   +2.333020788851085e-01   +4.518195843726090e-02   +3.533272839684684e-01];
L1E_L2E_iAMPA_netcon = [+1.621568252657266e-01   +6.582636347378112e-02   +4.042055020273791e-01   +4.123881436317632e-01   +1.420217731350168e-01   +4.071133040886911e-01   +2.184792235003855e-01   +4.273961576791543e-01   +6.027818422489208e-02   +2.784505167189825e-01   +2.733879634350685e-01   +3.292900127168029e-01   +1.582248952566789e-01   +2.884262840167229e-01   +2.421919185558440e-01   +2.141583830467887e-01; +1.638980603858551e-01   +2.235197438625792e-01   +9.681142397522592e-02   +3.572396116762417e-02   +2.533021719836227e-02   +2.952814591890426e-01   +3.170484440921104e-02   +1.347740409962584e-01   +9.202077260847347e-02   +1.345126175697576e-01   +1.165548025121039e-01   +4.054774208159802e-01   +6.195705314474591e-02   +1.208709110907605e-01   +2.539506538156791e-01   +1.028697543030304e-01; +1.436202149666527e-01   +2.551107025839065e-01   +3.882300951935408e-01   +3.945374974285675e-01   +4.108871063706088e-01   +4.993552417872971e-02   +1.277817157843406e-01   +2.106511963931518e-02   +1.877032779927474e-01   +2.496156402645415e-01   +1.442037889049473e-01   +4.698898007498696e-02   +3.233096441945033e-01   +2.605278437231521e-01   +3.819216279999349e-01   +2.941244483038385e-02; +3.386549956698237e-01   +1.473539339140997e-02   +9.416322039991701e-02   +9.276664522082394e-02   +3.099627731360495e-01   +1.394596072616454e-01   +3.876752706149809e-01   +3.855721051257903e-01   +3.352697551271979e-01   +3.295949021958791e-01   +2.022545217210155e-01   +2.429401530055534e-01   +3.986061603234328e-01   +1.454384781764072e-01   +3.958719211460135e-01   +4.197411380667325e-01; +5.754611863505695e-02   +3.674904366687353e-01   +3.723047901568630e-01   +1.063547440139617e-02   +6.997350850804430e-02   +3.522316765098050e-01   +3.970435547177508e-01   +7.600965537692833e-02   +2.477968732658106e-01   +1.842957725933523e-01   +2.383737575001564e-01   +3.329871484584876e-01   +1.044279912479109e-01   +2.257178034453541e-01   +4.249129104982518e-01   +2.183000101446102e-02; +1.711423382222246e-02   +3.678780513309475e-01   +1.162319584593596e-01   +3.478086219528531e-01   +4.174543912992622e-01   +3.666833200242046e-01   +2.190538264502548e-01   +3.984377074475022e-01   +1.414598028775505e-01   +1.714485239924304e-01   +3.631306636359971e-01   +3.947661474549270e-01   +3.613636034926939e-01   +2.672795774404027e-01   +8.163946065483875e-02   +2.471196193658614e-01; +1.311238742982698e-01   +9.453454964619108e-02   +2.504358377318754e-01   +1.601217839253736e-03   +1.616867090062723e-01   +2.288329041514103e-01   +3.202711249791552e-01   +2.533326434694535e-01   +2.502876493626832e-01   +3.417440617619625e-01   +2.698737807484674e-01   +4.916383575593143e-02   +1.555866297988342e-01   +2.352973678990396e-01   +1.045266169286175e-01   +1.512154127038133e-01; +3.489825822483340e-02   +2.371862989186181e-01   +2.124553929067544e-01   +1.736018076305120e-01   +3.158322547398595e-01   +4.186884222996774e-01   +4.265944324256623e-01   +2.743544691217435e-01   +3.756089811509972e-01   +1.702224413508291e-01   +1.501156789082994e-01   +4.237346050512913e-01   +2.871280256311456e-01   +3.878666920207347e-01   +1.419477452640163e-01   +4.754649162030471e-02];
L2I_L2E_iAMPA_netcon = [+2.695534068038446e-01   +9.905834728821034e-02   +3.881670882856761e-01   +2.078551909182414e-01   +3.352149889784429e-01   +2.086006637360051e-02   +6.466486166925418e-03   +3.882837945430623e-01; +7.322336878988520e-02   +5.185864617467470e-02   +7.183545773287048e-02   +3.690593238599293e-01   +3.299534217578446e-01   +1.739907002117370e-01   +3.041272172596638e-01   +2.080754076691194e-01; +3.631392431411142e-01   +3.206642551477440e-01   +3.553901884644846e-01   +3.220893785549660e-01   +2.259492145772681e-01   +2.191688135680252e-01   +2.142913216582317e-01   +3.070141339806953e-01; +1.738562384945183e-01   +7.191396172591578e-02   +3.852260417060335e-01   +1.846451112535372e-01   +4.122640710669146e-01   +6.682081657750358e-02   +1.930467465831979e-01   +3.690282226056520e-01; +2.999593664203978e-01   +3.710610552794600e-01   +2.761090643877316e-01   +2.627449623042779e-01   +3.968535266601277e-01   +3.217846514539541e-01   +1.758682547352934e-01   +3.220491457681561e-01; +2.658673816294747e-01   +1.695849567993574e-02   +3.821698679286122e-01   +3.193163753043814e-01   +2.293750772118560e-01   +8.335561052103860e-02   +4.955546613254831e-02   +3.122554573778491e-01; +4.098791890560026e-01   +1.953890737605697e-01   +7.161530571452933e-02   +2.053381035179345e-02   +5.597093752582025e-02   +9.463168299340065e-02   +6.281950831458717e-02   +7.318484412553869e-02; +3.957147045952731e-01   +1.457064305572269e-01   +2.354818060736729e-01   +2.104889957562961e-01   +3.813279229501075e-01   +1.004099034633141e-01   +5.448155858551015e-02   +9.077967173918447e-03];
L2E_L2I_iGABA_netcon = [+3.988187931810618e-01   +1.040955220563191e-01   +8.527219450724087e-02   +8.326244743303993e-02   +2.869615893166326e-01   +1.608509466593064e-01   +3.570534219262845e-01   +4.068764945311433e-01; +1.090152931788947e-01   +1.821695499332782e-01   +5.426090431725477e-02   +4.082646182028660e-03   +4.273191917639366e-01   +2.993799437935851e-01   +3.260277989571503e-01   +2.708490252679515e-02; +2.847602623304054e-01   +1.515803898063317e-01   +2.365076997471834e-01   +2.053828449284914e-02   +1.651781066792452e-01   +3.250051562945724e-02   +4.220703893831890e-01   +3.581702442584796e-01; +3.732456043322792e-01   +2.994095221427615e-02   +1.099043806283496e-01   +3.149154366846666e-01   +3.951040110722369e-01   +2.775409833701067e-01   +1.879124830926529e-01   +2.868950152087119e-01; +7.464267751427067e-02   +3.902485292454992e-01   +3.054829697404009e-02   +3.612949833064948e-01   +1.328528194929615e-01   +1.613796634584455e-01   +1.814521791541719e-02   +1.171522724147994e-01; +3.265232643079788e-01   +7.906692816792063e-03   +2.356820020372531e-01   +3.418456601421434e-01   +3.833140381096155e-01   +1.187779828939558e-01   +4.120618036723264e-01   +3.375344781858273e-01; +6.729128874360865e-02   +4.220080798004055e-01   +1.301134969811736e-01   +1.329385087524081e-02   +3.104982572485091e-01   +2.251375437695004e-01   +2.619940436249997e-01   +2.707082838039186e-01; +3.726492932166089e-01   +1.327768014270199e-01   +2.159073799472248e-01   +8.732983939869379e-02   +1.960101699922349e-01   +3.341514293510249e-01   +4.077628859223109e-01   +2.652102287812229e-01];
L3E_L2E_iAMPA_netcon = [+1.558682651765425e-01   +2.761525816051201e-01   +6.717437618194302e-02   +3.286391142517255e-02   +3.503839758501815e-03   +4.202966528545444e-01   +1.688001933142107e-01   +3.712303525273639e-01   +5.382548525973901e-02   +1.249948538750669e-01   +1.246587673867848e-01   +2.112315790141064e-02; +1.136306199981744e-01   +3.792107747853526e-01   +1.293091851567583e-01   +1.617920303517940e-01   +1.997356823935564e-01   +2.412431252016618e-01   +3.925366366817888e-01   +4.259580453160230e-01   +2.414688748231407e-01   +4.174435565215672e-01   +1.501475088239371e-01   +1.125013539284747e-01; +4.457268394394020e-02   +3.186783690432182e-01   +4.535902783986336e-02   +3.193951247637574e-01   +4.787499999611892e-03   +4.764535381227392e-03   +2.323027289335481e-01   +4.225300402467669e-01   +2.556430886892597e-01   +2.647927473265931e-01   +1.055614550605455e-01   +3.059081756563316e-01; +1.496906290966523e-02   +8.963462239069130e-02   +3.487789623770366e-01   +1.087455562138836e-01   +1.211582649976111e-01   +3.868014061382979e-03   +1.441579907991201e-01   +2.742268952812568e-02   +9.420862348435796e-02   +1.361484032976908e-01   +8.447618288432886e-02   +1.420788545116577e-01; +3.872100194044539e-01   +1.621218600055021e-01   +1.474722087062467e-01   +4.260650794090192e-01   +2.905046707284896e-01   +1.578828115004776e-01   +4.204276948035320e-01   +6.814934452237947e-02   +3.658570092878489e-01   +2.081559539568660e-01   +2.989616975458491e-01   +1.748589227176585e-01; +3.794044249470902e-01   +2.601418529823088e-01   +4.981160158426929e-02   +2.104220966421682e-01   +2.741998845101034e-01   +3.904784226932070e-01   +3.819811585259655e-01   +1.665309240279464e-01   +2.012159443466459e-01   +3.397361653492265e-03   +2.749661734656425e-01   +1.058823159262289e-01; +2.706217458575508e-01   +2.216520416577903e-01   +2.721608494215060e-01   +8.869721586802871e-02   +2.475392277331839e-02   +1.566766102372187e-01   +2.829148874406578e-04   +1.527652382175519e-01   +1.211630228162988e-01   +4.044550926851595e-02   +3.775663997083332e-03   +1.981855783168738e-01; +3.670554672955766e-01   +4.287692114349906e-02   +2.702967238624739e-03   +1.123238653153332e-01   +2.330247057468509e-01   +4.220053496971233e-02   +1.249332945994528e-02   +2.061746008611211e-01   +2.115999780577615e-01   +3.676552471177367e-01   +3.902997428187256e-02   +2.585711817734895e-01];
L3I_L2I_iGABA_netcon = [+4.192911204030003e-01   +2.130473788857922e-01   +2.807410463174641e-01   +1.160323250416578e-01   +4.103021233762058e-01   +1.891948037193225e-01   +1.944659479809412e-02   +7.315679624924620e-03   +3.771991783580884e-01   +1.914484739169680e-01   +4.238105922156355e-02   +3.218923646894726e-01; +3.851478513038796e-01   +4.131354161190596e-01   +3.831541068512173e-01   +6.686106874306200e-02   +2.222531718224313e-01   +3.616977316831987e-01   +3.066694274844372e-02   +8.927149317008244e-02   +2.111055252050398e-01   +2.890390301627122e-01   +5.008485342987612e-02   +2.775038625739697e-01; +4.396636890446083e-02   +3.695119048634708e-01   +3.825398039467962e-01   +1.245546866434510e-03   +3.045613778367217e-01   -3.914099716964279e-03   +2.694589014436883e-01   +4.018950562112905e-01   +3.085149186456911e-01   +1.141384383093156e-02   +2.587872005642050e-01   +5.179033180046029e-02; +4.171872930480202e-01   +1.358823636413192e-02   +1.624003437149883e-02   +2.822227516162962e-01   +3.853885640209277e-01   +2.405140299041527e-01   +1.057057034554719e-02   +3.711182382194067e-03   +3.744052321456743e-01   +3.555178446581824e-01   +4.287432349508380e-01   +2.388421215786187e-01; +6.421971234136978e-02   +4.154345828109372e-01   +1.788114941345740e-01   +1.832142876368140e-01   +2.489177435439016e-01   +3.948460610705963e-01   +1.661383966113956e-01   +7.468446837969152e-02   +4.335484127731738e-01   +2.190574088756151e-01   +9.421439397417086e-02   +8.116147655219673e-02; +1.681487644529559e-02   +2.934695220503519e-01   +9.033813669566951e-02   +6.996585996214074e-04   +7.294723708679129e-02   +2.771055478446763e-01   +2.988947373398312e-01   +9.856751642724250e-02   +2.372146832603048e-02   +3.282858696059686e-01   +3.760398658183747e-01   +3.347492767212803e-02; +2.692758974240054e-01   +3.789099500787005e-01   +2.508386468855831e-01   +2.780841368060245e-01   +1.867257651733832e-01   +1.339584517336137e-01   +3.014535650572490e-01   +3.857212817691037e-03   +3.630215819890524e-01   +1.665469908770509e-01   +2.142812150970355e-01   +3.116331882746207e-01; +2.126628102364828e-01   +9.426159210365567e-02   +1.322664499639539e-01   +2.514967574155272e-01   +1.484209220325304e-01   +5.773987584687250e-02   +9.829175467739198e-02   +1.206728663194345e-01   +2.382775646349518e-01   +4.188911072703296e-01   +1.195647984157914e-01   +1.241014782846335e-01];
L2E_L3E_iAMPA_netcon = [+2.900742248376623e-01   +2.869059064973592e-01   +9.635173690883317e-02   +3.771972029631124e-01   +2.206243933273234e-02   +2.202682630628393e-01   +2.920791654140608e-01   +4.070531439966121e-01; +2.363059221945283e-01   +3.156048846572803e-01   +3.164808125778977e-01   +3.480780907335731e-01   +4.830700711649139e-02   +2.163496920935561e-01   +3.691611049403135e-01   +2.995494913328360e-01; +3.666349289431012e-01   +3.818535990512372e-01   +3.605182532473578e-01   +3.922073250610634e-01   +2.541583987573265e-01   +2.844121560828687e-01   +3.765493381856587e-01   +2.490049874895806e-01; +1.740186681629401e-01   +4.118859349871508e-01   +3.675327374870689e-01   +2.638448537621698e-01   +2.214650673716375e-01   +2.176961560837323e-01   +1.179533027079497e-01   +7.919175472370250e-02; +6.369576977660968e-02   +2.393697627926211e-01   +1.091742603196709e-01   +3.697307291724666e-02   +7.585151607413412e-02   +2.359359553332336e-01   +3.855506228841513e-01   +3.269698985591845e-01; +2.107277581184182e-01   +4.237400683346786e-01   +3.893634395595818e-01   +2.337972639252289e-01   +2.227270776609711e-01   +4.207267599109038e-01   +3.105702892661407e-01   +4.241738591750718e-01; +2.108788342197814e-01   +4.924842127380515e-02   +2.285246449111497e-01   +1.195739165286775e-02   +1.523995020422141e-01   +3.505489406865013e-01   +1.469856303178396e-01   +3.352668550202519e-01; +4.037059798402877e-01   +2.986356019193337e-01   +1.862856528011969e-01   +3.355920495202864e-01   +1.476606234268468e-01   +3.306554967321545e-01   +2.203693366072727e-01   +1.845604696384134e-01; +2.000734585491266e-01   +2.372952826011595e-01   +3.830231713534691e-01   +2.718735070405696e-01   +2.434859143080455e-01   +1.473908297853757e-01   +2.605172238764021e-01   +2.869482731003997e-01; +1.236295123985189e-01   +6.666160188643346e-02   +3.387543847593316e-01   +3.760017253563997e-01   +3.843168713489244e-01   +4.685226459760779e-03   +6.247465396500602e-02   +2.780328210570250e-01; +2.498047142773767e-01   +1.379699076384473e-01   +3.195941960349162e-01   +3.496995204433082e-01   +4.061468302091927e-01   +4.113504720628030e-01   +1.129644471776600e-01   +1.599688128440871e-01; +4.512784952201646e-02   +2.524474012045886e-01   +1.795131686672826e-01   +3.757522718471624e-01   +2.095755882588085e-01   +8.963371551981815e-02   +2.828710799439583e-01   +3.707150317103421e-01];
L2I_L3I_iGABA_netcon = [+4.050683778533956e-01   +1.754382766066884e-01   +1.150844186810816e-01   +3.073508542144880e-01   +3.174921340603490e-01   +3.630554646690834e-01   +1.551673097149910e-02   +2.248500840052350e-01; +2.383512432844929e-01   +2.034745894075725e-01   +3.042734085831626e-01   +7.232980514112514e-02   +3.803252564331567e-01   +3.495984961738979e-01   +1.976705970595994e-01   +1.060904282169910e-01; +3.393048808570693e-01   +3.145453626811643e-01   +4.029012865712537e-01   +2.675251833037881e-01   +1.533688727272842e-01   +2.645926820856092e-01   +1.733139327873303e-01   +7.335391087394370e-02; +9.126756460397073e-02   +3.567186469719772e-01   +9.724789597995523e-02   +2.087177978993796e-01   +1.211483011894362e-02   +1.531586613168900e-01   +1.627305360932605e-01   +4.195421892106080e-01; +1.288962332870286e-01   +1.686651427132107e-01   +2.294015069234136e-01   +2.014394556738164e-01   +1.540491904328678e-01   +2.763270648229181e-01   +4.310142016387685e-02   +5.747030976899157e-02; +9.032423116690348e-03   +1.106154264236339e-01   +1.878485961216277e-01   +7.741969179553171e-02   +1.536075985736847e-01   +1.699202517223619e-01   +2.259135002437470e-01   +3.027212319625990e-01; +1.516995703121657e-01   +2.034566735621867e-01   +4.045195439897947e-01   +2.773561805737415e-01   +3.151569974705805e-01   +1.275293187974814e-01   +1.400394983698891e-01   +1.326809763404621e-01; +1.511753830141130e-02   +4.259246588574352e-01   +1.348494129463046e-01   +3.807513557467634e-01   -1.037777697650032e-03   +3.268980294042447e-01   +2.475692692851696e-01   +3.291997103962379e-01; +3.836461170632052e-01   +1.251222097638804e-01   +3.642095397997500e-01   +2.704719929564836e-02   +2.136517051818183e-01   +1.149757532250405e-01   +1.752126890653374e-01   +1.944177389358430e-01; +3.279383475426556e-01   +2.145670973468074e-01   +1.086403363561630e-01   +2.142455494982652e-01   +2.679675136436758e-01   +1.497525037460337e-01   +9.186022697746443e-02   +1.305236740518158e-01; +3.088841737900863e-01   +4.178975395509691e-01   +2.317006937845601e-01   +2.975502087868777e-01   +1.236458049004631e-01   +1.560948042391691e-01   +4.087823846217350e-01   +5.399482059513439e-02; +3.269911944520065e-01   +2.761282414542989e-03   +1.437996822018092e-01   +6.116373749792590e-02   +6.371298463190271e-02   +4.133122585019051e-01   +2.076073661457356e-01   +2.410224326600396e-01];
L3I_L3E_iAMPA_netcon = [+1.886770146041180e-01   +4.273718236483509e-01   +1.164233971000679e-01   +2.639464765971700e-01   +3.333183676826861e-01   +1.396696013485422e-01   +1.238397580517856e-01   +9.661577833368885e-02   +1.409812877522400e-01   +1.208921949528306e-01   +1.126024176608127e-01   +2.019970785030174e-02; +1.735049481762643e-01   +3.673247720720970e-01   +1.006861962757652e-01   +5.639706480157838e-02   +3.544067763446438e-02   +2.317806000497985e-01   +2.394030124563825e-01   +2.389484462866181e-01   +9.905457461345586e-02   +2.099113183358375e-01   +3.242079988087253e-01   +2.444787522264583e-01; +9.838475603776004e-03   +2.657715057269094e-01   +2.016280574679258e-01   +2.538247961951349e-01   +2.091469076479716e-01   +1.953170040655557e-01   +2.179771455472769e-01   +1.975778452765407e-01   +1.499446406869176e-01   +2.426371667610979e-01   +1.990878757274474e-01   +2.392861261544038e-01; +1.682643495639961e-01   +3.172784866217321e-01   +2.730176426738983e-01   +1.843256654820492e-01   +1.942094771946684e-01   +3.824440349806079e-01   +3.298461467487279e-01   +5.011429745211195e-02   +3.950662917983775e-01   +3.904699792773442e-01   +6.963958755274874e-02   +3.194204442058484e-01; +4.863468448484700e-02   +1.437529334488158e-01   +1.695665946709942e-02   +3.702477475618583e-01   +3.257522200272558e-01   +2.342078946312559e-01   +4.151426633197553e-01   +2.310345834350304e-02   +3.804582311295958e-01   +2.463729387388760e-01   +1.651152482875403e-01   +5.098043500959114e-02; +1.471745995735546e-01   +2.877173373211376e-01   +3.580501891247733e-01   +1.812099675629604e-01   +4.258566947991842e-01   +1.030919326468113e-02   +3.843152185892827e-01   +1.075222293587814e-01   +2.896033579551648e-01   +1.279826518958205e-02   +1.490814438092439e-01   +6.699354378345306e-02; +3.508218918980391e-01   +1.588602923708737e-01   +1.696413246415346e-01   +1.212917868898473e-01   +2.896764963315495e-01   +8.733225172619014e-02   +2.441404522758833e-01   +3.992221193210846e-01   +3.615445691495601e-01   +4.217921866693083e-01   +2.276825058346901e-01   +3.062523093424213e-01; +3.136036148288291e-01   +9.235501823272650e-02   +3.126243898199083e-01   +2.547405816019618e-01   +4.236741561009526e-01   +2.558996424985719e-01   +4.094974034190928e-02   +2.139393642344458e-01   +1.871285149511671e-01   +1.276063469370749e-01   +1.044708859017349e-01   +4.073779140520662e-01; +4.047776779889291e-02   +3.653241079883947e-01   +3.165382206446642e-01   +3.458952332704077e-01   +1.577346503870901e-01   +3.133453457333022e-01   +7.564274941433329e-02   +3.365242066267767e-01   +3.593258357054070e-01   +1.984940115691670e-01   +9.142832949801072e-02   +1.023696769270945e-01; +3.981886173830137e-01   +3.338519527733824e-01   +1.737515721486400e-01   +9.979069019765553e-02   +2.433313685015124e-01   +3.309327070580687e-01   +2.180916127852709e-01   +3.761134600838488e-01   +2.893334617663107e-01   +1.466561054819783e-01   +3.824342340709043e-01   +9.300312708462495e-02; +1.908902378783305e-01   +1.476001888448441e-01   +4.222856756973331e-01   +4.087103627140232e-01   +8.269471380334023e-03   +2.681164881904840e-01   +3.368839462499433e-02   +1.047978503773805e-01   +1.764404885731375e-02   +4.137791918488054e-01   +3.266843735463902e-01   +1.526342599936162e-01; +4.845352435523103e-02   +7.580166400137017e-02   +1.658270466039398e-02   +1.975437096680273e-01   +1.880566029516962e-01   +1.001313039940903e-01   +3.391426065996581e-01   +8.338708269488458e-02   +1.441140494754783e-01   +1.019105934529182e-01   +3.332281333855993e-01   +1.169242579372761e-01];
L3E_L3I_iGABA_netcon = [+8.290779300158034e-02   +1.957296238937900e-01   +1.405150663961022e-01   +3.955151876036238e-01   +3.546100495679230e-01   +2.373668058586684e-01   +1.354564894770822e-01   +3.269233570792378e-01   +2.774822661066884e-01   +3.192043828510109e-01   +2.560204096715148e-01   +1.030162879713279e-01; +3.310203355601014e-01   +2.737605236358496e-01   +1.316817498688407e-01   +8.212339767979511e-03   +1.612573147036802e-01   +3.037760535513382e-01   +2.828939310753192e-01   +4.234192584836556e-01   +3.672449628782066e-01   +1.913869043958787e-01   +4.839506271841968e-02   +4.323148526630414e-03; +2.547020933022492e-01   +4.122727343552532e-01   +4.067044229083506e-01   +3.638622066050783e-01   +5.937166505547531e-03   +3.206432823920501e-01   +2.520204153245131e-01   +3.004546171537378e-01   +1.790905756257428e-01   +1.807713333489330e-01   +1.177364680027108e-01   +6.412274620823107e-02; +1.764613877139180e-01   +1.967935227541154e-04   +5.911007219342638e-02   +3.084582054947400e-01   +3.137014839128867e-01   +1.145120420845239e-01   +1.797291197686559e-01   +1.602100891113405e-01   +4.258012809001566e-01   +2.015071862107292e-01   +2.113342783039687e-02   +2.577911260805931e-01; +1.840491294805466e-01   +1.654568379296143e-01   +4.263536270778771e-01   +1.181873503837944e-01   +2.333184590545884e-01   +3.298533295205807e-01   +4.167787884123856e-01   +3.967118833612132e-01   +1.137219791442237e-01   +2.428347281222049e-01   +3.627665664430897e-01   +2.699920926108111e-02; +2.960486364383717e-01   +2.054291393732794e-01   +3.592588753323250e-01   +4.035690052788132e-02   +1.791437934728849e-02   +4.212304364781504e-01   +3.630906629819840e-02   +2.986077628863096e-02   +3.489586589999158e-01   +2.612013954464985e-01   +1.144251494837570e-01   +9.712931289171690e-02; +2.542259179767715e-01   +1.523574009170169e-01   +2.054967792931527e-01   +2.567288697579523e-01   +2.975233722706422e-01   +2.089038028414857e-01   +1.501126091599990e-01   +6.162625901839857e-03   +1.434193407641560e-01   +7.126766818539731e-02   +1.324093451781971e-01   +3.116664524846415e-01; +1.264774132389544e-01   +7.291421741773581e-02   +5.423049207732063e-02   +3.930839367331792e-01   +1.837364374940305e-01   +3.211716367379449e-01   +2.211621552793228e-01   +3.308206846124723e-01   +3.287648909727394e-01   +3.690307840453315e-01   +7.051892089224819e-02   +2.516477456926863e-01; +1.231729790727620e-01   +8.363795014831654e-02   +3.348633781267994e-01   +2.131025206708817e-02   +4.032148353397109e-01   +3.930465569757183e-01   +8.193371692498162e-02   +3.073901908203661e-01   +1.013904951417900e-01   +1.806975404606155e-01   +1.815610166983780e-01   +2.714906479210425e-01; +3.576140886043100e-01   +1.355583336165114e-01   +3.610314196483798e-01   +1.425176905062907e-01   +1.522058005292032e-01   +4.241163377434840e-01   +3.255036999971316e-01   +2.415350153625286e-01   +4.046841629843776e-01   +4.173443882596386e-01   +7.299515601665628e-02   +1.924410092855340e-02; +2.399643137984337e-01   +5.563852943761909e-02   +8.941943387911933e-02   +8.163036851039286e-02   +3.379180293073248e-01   +2.167464667824704e-01   +3.687651312219326e-01   +2.637618733723067e-01   +2.445166698577139e-01   +7.160476285372698e-02   +3.712107448787132e-02   +3.484223997290902e-01; +2.725667450910923e-01   +2.205778988207253e-01   +4.290650423673260e-01   +3.109080599467794e-01   +7.803983047528605e-03   +2.228883564683229e-01   +4.236815462992977e-01   +2.542740794083584e-02   +3.420598225130900e-01   +1.754078197667703e-01   +2.035694589369917e-01   +1.910632889797834e-01];
L2E_Input1_iAMPA_netcon = [+4.258299716218266e-01   +4.317187805450577e-01   +4.273944925319208e-01   +4.306829196357659e-01   +4.309825805405645e-01   +4.314057246427325e-01   +4.302969256713411e-01   +4.272374533583347e-01];
L2I_Input2_iAMPA_netcon = [+4.283940747816269e-01   +4.323712707957654e-01   +4.289842559121314e-01   +4.296353056748841e-01   +4.337771348589926e-01   +4.312613708628121e-01   +4.292617162644045e-01   +4.289361710888978e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
