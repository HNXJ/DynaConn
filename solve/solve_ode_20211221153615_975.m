function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.416126717533945e-01   -5.536669740024471e-01   +6.466558853243676e-01   -3.555920980667057e-01   +7.766806653982810e-01   -1.942339551761939e-01   -5.005156763379919e-01   +4.610996156611410e-02   +5.680316055295711e-01   +2.554237798870497e-01   +2.693603473455095e-01   -6.236995703000565e-01   -4.856829942238508e-01   -8.470234971413422e-01   -1.601993426575349e-01   -4.807480763564649e-01; -1.085971894692525e-01   +2.955187501785937e-01   +1.006759913376048e-01   -5.278009144740206e-01   -5.925304946535416e-02   -5.337597314512169e-01   -1.054300148231701e-01   +8.675802573191849e-02   +7.526015227547818e-01   -5.140233648912475e-02   +4.232879178726154e-01   +1.133877349568265e-01   +1.894175186117267e-01   +6.918519574498564e-01   +7.231780463825828e-01   -1.690034666002968e-01; +3.891521764532748e-01   +6.871647704402216e-01   -1.425615029326494e-01   -4.635285238135993e-01   +6.471359296798394e-02   +4.614393975375528e-01   +1.902062723115787e-01   +2.197256072356124e-01   -9.852987099303871e-02   +2.555145944412709e-01   -1.131388778089752e-02   -7.276983605623398e-01   +2.797646910509130e-01   -7.310892911941919e-01   +1.119115163055583e-01   -3.179908964526292e-01; +1.807337412517302e-01   -2.565085720947888e-01   +2.114565011245547e-01   +6.073786096440051e-01   -3.409140476941660e-01   -5.611240526182720e-01   -1.963806232441983e-01   +6.818302638137201e-02   +5.308358825747530e-01   +2.995054900950540e-02   -3.011717899621458e-01   +7.206343294008316e-01   +2.007717872749830e-01   +7.394665989800095e-01   +1.270913109819190e-01   +8.376311061724196e-01; +7.689572815427411e-01   +3.919710589414794e-01   +1.228400383633849e-01   -8.306585022602125e-02   -1.990870769791146e-02   +4.977174598071417e-01   -2.755817546506265e-01   +4.430606412081504e-01   +8.112252123746480e-01   -4.161797216632374e-01   +2.928888535169278e-01   +3.226477129255770e-01   -1.795340909888807e-01   -1.996602556100099e-02   +7.831736827820995e-01   -2.998101855408615e-01; -5.433987029081317e-01   +6.671515127201784e-01   +5.623443517807670e-02   -3.470721134505542e-02   +2.710533863983713e-01   -6.152127922350203e-01   +5.407720002776834e-02   -2.736445150651299e-01   -4.275371701052938e-01   +3.413091089552091e-01   -4.399608118743241e-01   -1.700216270697303e-01   +9.327656570945084e-02   +3.323097555448517e-01   +2.688068369085126e-01   +7.821124163398824e-02; -7.133896271452117e-01   +7.793694649853652e-01   -4.687187068630843e-01   +4.034538023217886e-01   +1.196456782575280e-01   +6.985739996965401e-02   +9.004914949344951e-02   +7.283654330316249e-01   +2.861393141679389e-01   -5.285483588281258e-01   +4.085405907536568e-01   +3.163430449986669e-01   -7.550576566446857e-01   -5.034376916474611e-01   -8.032292765860325e-01   +3.311697160182189e-01; +4.321010549973072e-01   -1.978322115013252e-01   +6.354962684555537e-02   -4.455676844960254e-02   -3.367423786530774e-01   -5.171410377990560e-01   +1.425790911081761e-01   -8.571501593934345e-01   -1.427651529391321e-02   +1.185060469011378e-01   -1.965573811190383e-01   -5.680855751593521e-01   +5.514614588071006e-01   -5.488371256967832e-01   -3.596217618620994e-01   +7.448193233493666e-02; +4.434467672879702e-01   -5.393354051694286e-01   +6.808229620807003e-01   -3.251595426930423e-01   -1.101882529265812e-01   -2.703011324754150e-01   +2.721917568508152e-01   +2.859548275119252e-02   +4.400436014100442e-01   +4.650697713219151e-02   +7.232056799097426e-02   +1.640148331850080e-01   +2.910017195282572e-02   -3.032182820164001e-01   -9.924938344163635e-02   -3.681211088316529e-01; -2.267947909261905e-01   +4.477590981843851e-01   +9.508126741928764e-02   +3.804304914513119e-01   +6.447273751795768e-01   +5.934098210491950e-02   -2.881301186365629e-01   -4.030113485181364e-01   +1.553212867254457e-01   -2.734926377606047e-01   +4.961291736614594e-01   -2.306690920393341e-01   +4.651172261657838e-01   -6.248913392996693e-01   -3.140173250948503e-01   +2.459343202987206e-01; +2.422383507791240e-01   -2.407985144856984e-01   -1.507183365876857e-01   -8.516862771767383e-02   +6.621604380755384e-01   +4.662872209152810e-01   +2.165451768701453e-01   -2.074649273710724e-01   +2.557177335652487e-01   +4.138055460870205e-01   +9.332194003776521e-02   +2.902880871018060e-01   +3.964141476194977e-01   -2.677217760547702e-01   -8.842731176137653e-01   +6.330284616960723e-01; -3.380037269870352e-01   -4.980832276544305e-01   -2.539375259873158e-01   -2.830556189237625e-01   +4.543366176204326e-01   -2.016663813072213e-01   -3.323474191041221e-01   -2.305846847423843e-01   +2.735067306134624e-01   -5.364876701205616e-01   +5.484954822472921e-01   -2.069341227332508e-01   -2.292516841601135e-01   +4.732246801155602e-01   -2.312724402674730e-01   -4.642293887918984e-02; +3.218116009068250e-01   -1.678126993109847e-01   -2.386829572855439e-01   -8.221290816004938e-03   -4.181743693007400e-01   +2.465054922382349e-01   -6.938804745649640e-01   +3.848104629004525e-01   +4.100972114439335e-01   -7.229027241448426e-01   -2.480909149027173e-01   -2.882811474699455e-01   +3.222030934609126e-01   -3.308258644962367e-01   +1.969391642867071e-01   -1.603806684983428e-01; -5.591039334179708e-01   -6.106038417003470e-01   +6.272852112017369e-01   -2.552154317074782e-01   -5.548544317759135e-01   +4.714933302970993e-01   +5.024498742825145e-01   +5.333621995501876e-01   +4.238363049913321e-02   -3.470859051471520e-01   +1.853462130274210e-01   +4.420426800841071e-01   -3.840216005654401e-02   -1.529585408362366e-01   -4.730356401210355e-01   +1.872625444178208e-01; +4.554662037125527e-02   -3.099868874773001e-01   +2.787074281049865e-01   +5.763556454473024e-02   +1.273994109572149e-01   +3.873173867778092e-01   +7.001956051413412e-01   +3.001794010236275e-02   -8.927873812245475e-02   -3.769882231453003e-01   +5.401971295711397e-01   -4.238084277550002e-01   +7.173204712245808e-01   +5.254437003792538e-01   -7.984809626725278e-02   +1.000000000000000e+00; -3.090778553964643e-01   +2.133594577815092e-01   +2.577820732009655e-02   -4.873143674204980e-01   +4.811206249883626e-01   +4.134138323088660e-01   +9.793314099814403e-02   -1.484913138993310e-01   -4.797484796265356e-01   -1.193639464905310e-01   -5.672353471960799e-02   +2.107802760832307e-01   -4.852399295306966e-01   +5.007385194601927e-01   +1.900883534099458e-01   -1.252228113177041e-01];
L1E_L1I_iGABA_netcon = [-1.884832204416319e-02   -3.838761646721121e-01   -4.622018674096293e-01   +2.589369867536701e-01   -3.836376203084300e-01   +6.853056005326033e-01   -4.574739694734357e-01   +5.934639714649602e-02   +4.007960573118740e-01   +3.695301713304345e-01   +1.953090586250678e-02   +2.051258383387060e-01   -5.738450987680476e-02   -2.884298562896714e-01   +1.694511351874124e-01   -5.080129529963288e-02; +3.039440665715432e-01   -5.772886569923836e-01   -4.785639049874426e-02   +4.790542340997823e-01   -8.699184289965527e-02   +1.601598894110026e-01   -5.482039024952846e-02   -8.158584019937198e-02   -7.773446978094262e-01   +3.392075418829756e-01   -2.934412869464293e-01   -3.328580846706400e-01   +4.663991338043161e-01   -9.917056173221819e-02   -1.174115524167550e-01   -6.910992322388886e-01; -2.233094033261961e-01   +3.501432833574251e-01   +3.764874971198264e-01   -2.596092728444341e-01   +2.762857697146436e-01   -3.370932190975932e-01   -2.646957312602132e-01   -1.163927380933744e-01   -1.612841061166340e-01   +7.635991664587302e-01   +3.590909565035507e-01   -2.810317621129442e-01   +4.536592877909322e-01   +4.665399081969088e-01   +1.655377855504128e-01   +5.847426354508336e-02; +6.524881972986236e-01   -4.643984593896787e-01   +1.113680143446103e-01   +4.794723499470659e-01   +5.485914858701655e-01   +9.586081025560589e-02   -2.303594296474854e-01   -2.031939667769025e-01   -2.718356304750588e-01   -8.209496082143588e-01   -3.119891828577939e-01   -1.864289455561056e-01   -1.547019887430545e-01   -6.498740002930196e-02   +1.034097140041527e-01   -4.772184796166305e-02; -1.952450978559511e-01   +6.358862198706080e-01   -5.458130289040537e-01   -1.898007436687283e-01   -2.578850917326369e-01   -8.287826705125990e-01   +8.685831512738551e-01   -1.062443731807678e-01   +1.128444151709692e-01   -1.777048274474820e-01   -5.729967443704435e-01   +4.111894944701947e-01   -4.934747483054325e-01   +1.740258402893328e-01   +7.946649328768803e-01   -5.794082019006233e-01; +9.596740112232856e-02   +3.618805122701478e-01   +3.451175919031528e-01   -8.569259927703446e-01   -5.681912234924821e-02   +2.445935699252304e-01   +4.627308183828829e-01   +2.625256776838453e-01   +5.491070620040055e-01   +1.171023245116158e-01   +3.450952521794897e-01   +2.628213905916660e-01   +4.163885887827296e-02   -1.366803161463729e-01   +4.084384721027782e-01   +1.174915371621932e-01; +1.276603269183569e-01   -4.002605181946444e-01   +2.910387045346927e-01   +4.676725570354761e-01   -2.748718790226916e-01   -1.000000000000000e+00   -3.744166734461520e-01   +6.178081548464096e-01   -8.806176036715802e-01   +7.037378297790667e-01   -1.390715636370182e-01   +3.187305373436042e-02   +2.952556522402993e-01   -9.155150694821934e-01   +5.440187254824537e-02   +5.024797221856612e-01; -4.464785814615996e-01   -3.211396734297718e-01   -1.200483180765110e-01   +2.554582467940245e-01   -6.051901637737612e-01   -3.666212993419109e-03   +4.312029779443569e-01   +1.171399530672689e-01   -3.359686492099650e-01   -5.657667280579144e-01   +7.037471815099168e-01   +2.319317635657395e-01   +4.503925661418420e-01   +4.368543953375998e-01   +6.220965934444950e-01   +6.446002510033566e-01; +6.700833522033507e-01   -3.660738581741025e-01   -5.879703330387602e-01   +3.630884496982572e-01   -7.566493559432430e-02   +2.776823214651511e-01   -6.750944576557846e-02   -6.948490620981128e-03   -2.863197198724274e-01   +1.780678660816811e-01   -1.279685776930307e-01   -4.654258954648473e-01   -1.363411542254529e-01   +4.094297567806423e-01   +3.150307744484204e-01   -1.997023769205751e-01; -5.674928863106186e-01   +3.207407302323683e-01   +2.072448943916067e-01   +5.183126382755300e-01   -3.320316237949915e-01   -4.284193178160368e-02   +8.587066460058567e-01   -8.909351375031979e-01   -6.168041866498195e-01   +2.562791288451049e-01   -2.161607391796989e-01   -2.268041496613000e-01   -3.862086872991447e-01   +6.535335085505480e-01   -3.492996798059126e-01   -5.543059966984019e-01; +5.758113817398416e-02   +3.208724237883587e-01   -2.013019277152461e-01   +7.714369086922608e-03   -6.475599316571152e-01   +5.815123664759841e-01   +3.082310496808199e-01   -3.261262064057294e-01   +3.403901339878214e-01   -8.815355121233621e-02   +4.102924115616516e-01   +8.545278564920031e-01   +2.430039330612439e-01   +5.665781163264494e-02   -3.461485207256614e-01   -4.854001317732055e-01; -1.622427857723361e-01   -3.370950246681607e-01   +2.670186742866217e-02   -6.489940227074703e-01   -2.401678884664601e-02   -3.279987938640225e-01   -4.049035620908833e-02   -1.939669875548012e-02   -5.440612005855262e-01   +5.473976048128304e-03   +6.419413978243488e-03   -7.370846197327376e-01   +6.341929786652828e-01   +8.561748409286277e-01   +2.014597045577580e-01   -4.399986695869780e-02; +1.007271455433390e-01   +3.811480507584812e-01   -9.161562105409320e-02   -5.181874108419822e-01   +1.725148116995713e-01   -3.297802947815643e-01   -1.851277831536804e-01   -1.367260983972045e-01   -1.191991528916088e-01   +3.350087235906808e-01   +3.326900329047451e-01   -1.564107670631305e-01   -1.560636016852145e-01   -3.154002636407156e-01   -6.784388967719336e-01   +6.692839670542847e-02; -4.653311528348963e-01   +2.180189049127835e-01   +4.207376260492233e-01   +1.903624495381783e-01   +1.617374113213315e-01   +5.161108784600825e-01   +3.350335191202652e-01   -3.030662649695000e-01   -1.458898407487058e-01   +1.726457693377291e-01   -1.771776922197724e-01   +3.861770941146359e-01   +2.229249129067829e-02   +4.022078149562839e-02   -2.628096955056499e-01   -5.481943297592081e-01; +6.272776136370189e-01   -5.517756380707475e-02   -6.409685242759674e-01   -3.915306319455998e-01   +6.237616788885810e-02   +1.208750786641125e-03   +6.500174605429035e-01   +1.842195651881580e-01   -2.355322555092004e-01   +4.597266049608781e-01   +3.782893462145125e-03   -3.156206745233807e-01   +3.391349471403522e-01   -7.133892960917207e-03   +3.041353295666738e-01   -1.334672285644700e-01; -1.353552887552610e-01   +4.836438902452974e-01   +4.471456579082922e-01   +2.394106588406566e-01   +1.312832901138750e-01   -6.052440088843880e-01   +1.452632208667816e-01   -3.315660881795219e-01   -3.028997927285941e-01   +2.683846054143098e-01   -5.343354417615436e-01   -2.746668935213663e-01   -3.625738815931452e-01   +3.951525787628513e-01   -2.006442645062637e-01   -4.597757577917887e-01];
L2I_L1I_iGABA_netcon = [-5.404561329192415e-01   -1.672099029693284e-01   -3.410182968051668e-01   -2.301511975638608e-01   +5.685214720867368e-01   -5.670295715593899e-01   +8.658280941088373e-02   -5.805480757707633e-01; +3.601534736995450e-01   -1.377307138748909e-01   +1.413105435842789e-01   -2.138578670065616e-01   -4.455072159429473e-01   +3.766473242891381e-01   +6.101990782147848e-01   +4.079759440766462e-01; +2.384153923086219e-02   +6.188883970698684e-01   +2.207345830655535e-01   +6.754372907298858e-01   +3.273053390725347e-01   +3.620180371643753e-01   +2.059808241430237e-01   -2.275465560028372e-01; +3.323724996114007e-01   -1.881905166020153e-01   +3.419311367778211e-01   +1.285786812104358e-01   +5.256470589931860e-01   -1.287088658475092e-01   -1.380821177940153e-02   -4.715294002483412e-01; -5.145323060544003e-01   -1.247192286801449e-02   +2.705552877834274e-01   +4.797806835124907e-02   +8.408041016007259e-02   -2.758137652750456e-01   +1.270926230807101e-01   -1.288686687758965e-01; +1.296417133154541e-01   -7.786963473758205e-01   -6.922318810160180e-01   +2.544874312342528e-01   -1.187423500892080e-01   -7.201005405678577e-02   +3.767417841728986e-03   -2.768617086837857e-01; +1.165638705206178e-01   -5.133704825069624e-01   -8.395781241566266e-02   -1.302579727731111e-01   -4.056713283749585e-01   +3.243499825447550e-02   +6.083137917256647e-01   -6.143159943661936e-02; +1.464487800825102e-01   +1.766487274441601e-01   +7.616111124668663e-01   -3.769186693385120e-01   +3.119735037703188e-01   +1.642644875667493e-01   -2.024495222358556e-02   +5.865282779353185e-02; -1.073720472512792e-01   +1.623582775033910e-02   -4.878368772446635e-01   +4.535116947339230e-02   -1.584564834978562e-02   +5.193309865601654e-01   -1.474207794847895e-01   +2.818258781805131e-01; +7.443735611591216e-01   -3.442843949340849e-01   -3.132765666437163e-01   +2.087768595018192e-01   -1.613953967417375e-01   -9.879330600437497e-02   -3.610392108430250e-01   -2.640846786403130e-02; -2.712364159454602e-01   -7.271757323479822e-01   -3.646717562959982e-01   -2.126405865011909e-01   +3.339915900816098e-02   +2.970668091772963e-01   -2.163062695169238e-01   -5.356701243911502e-02; -1.562511842983756e-02   -3.356363920588207e-02   +2.688015039607796e-01   +5.435516513089814e-02   -4.950964398802890e-01   +5.528751730531865e-02   -1.216531001366607e-01   +9.007643251023002e-02; +2.080666455535476e-01   -2.739404003183388e-03   -1.000000000000000e+00   -3.960235569758577e-01   -2.962570932904079e-02   +1.763124332532193e-01   -4.842913365704717e-01   -3.840691194020802e-01; -3.295913731301484e-01   +4.942092861746560e-01   -3.663465687814462e-01   +2.817692845091150e-01   +2.663950146462877e-01   -7.965433928975280e-01   +3.340469411433193e-01   -1.682613882060793e-02; +1.446219979857586e-02   +3.022698412282264e-01   -2.354415788575303e-01   +3.702731618259812e-01   +2.330830651701138e-01   -1.299427039387310e-01   +2.179972294766944e-01   -6.627693585369147e-01; -5.050130627119471e-01   -4.583594664301696e-01   -6.629147205822362e-02   -1.394860305934380e-02   -2.401889438531192e-01   -1.710731754978276e-01   -3.226517297526383e-01   +5.305602765385310e-01];
L1I_L2I_iGABA_netcon = [-2.369892233374873e-01   -3.167019124149117e-01   -7.634972159516797e-01   -9.476911478332460e-01   -4.567871254722940e-02   -2.323167234536575e-01   +5.050188935431470e-01   -3.314614700300654e-01   -4.744485113286739e-01   +3.428517884782369e-01   +3.848530146445198e-02   -3.841275872838307e-01   +3.053510937210440e-01   +5.458563209620795e-01   +3.332726765791456e-01   +1.160137483243054e-01; +4.187212722564001e-02   +1.188062220426393e-01   +6.258360970072082e-01   -2.334271185947916e-02   +6.126107100343983e-01   +1.049084425776977e-01   -6.207386647513875e-01   +3.793412155045410e-01   -7.869722556459199e-01   +1.116963899847685e-01   +5.913344404170963e-01   -4.155144080767848e-01   -3.923932643074450e-01   +3.000793195298317e-01   -3.136276773872436e-01   -7.343842489648164e-02; -1.263227489805515e-01   +1.000000000000000e+00   -7.305531767487744e-02   +6.952898300574222e-01   +9.306431169936401e-02   +5.160919253287276e-01   -3.347628879304510e-01   -8.572779563505369e-01   -4.344704281996150e-01   +2.328215440283331e-01   +7.572799611719291e-01   -2.135361918298217e-01   -2.186087134889956e-01   +5.882506303204136e-01   -3.966460282621196e-01   +6.164899681493318e-01; +1.299322772924036e-01   -2.144272678862570e-01   +3.390680382844479e-02   +1.422495855155484e-01   +1.148069948224709e-01   +2.690005283038875e-01   -2.303878839433810e-01   -4.844589607389255e-01   +4.505666459075292e-01   +2.071151342645140e-01   +2.727212969659737e-01   -2.332731304676363e-01   +7.005890758444082e-01   -7.506208767761499e-01   +6.532364055694679e-01   +7.564781343875950e-01; -5.799871658565627e-01   +7.725081814719851e-01   +2.079128545537049e-02   -3.091987423664911e-01   +6.026668453519272e-01   -6.008868660844328e-01   +2.988390482095147e-01   +2.666332892565578e-01   -1.332573972403631e-01   -2.585410185582896e-01   -2.416267847338420e-01   +4.906161549058822e-01   +1.115929778197235e-01   +3.413090762620570e-01   +7.014012676243557e-01   -6.038274883484808e-02; +2.000325192024857e-01   +6.018080284773902e-02   -4.378606979906398e-01   +3.519902791403381e-01   -5.503963312323866e-01   -1.233957443403758e-01   -2.875448403352181e-01   -2.769993862762439e-02   +2.907920972511636e-01   -1.124960452066446e-01   -4.456175627849738e-01   +4.176241631071763e-01   +8.509203757310062e-01   +1.572322042070781e-01   -5.294726670020178e-01   -4.152951696867067e-01; -3.986532281055522e-01   +8.795881580353037e-01   -8.736013830920446e-02   -4.451667042701887e-02   -6.116306916307835e-01   +3.418876795799838e-01   +4.213426878165032e-02   -2.796492120224174e-01   -1.865236781559878e-02   +8.022465003034250e-01   -4.230232097236077e-01   +4.266732846580369e-01   +3.713151832161778e-01   +2.736553594662625e-01   +5.702353434402043e-01   -2.107996046624451e-01; +3.250140460803818e-01   -4.103099723542907e-01   -4.956587932262604e-01   -2.196329253469886e-01   -5.232309067691230e-02   -2.934687710281380e-01   +2.628078533758130e-01   -3.383598621253626e-01   +2.977947258823960e-01   +7.124196830707037e-02   +2.310076479999176e-01   -7.064777721386591e-01   +3.249795397271611e-01   -2.081187927532059e-01   +8.890784104995202e-01   -1.382970520163896e-01];
L2E_L1E_iAMPA_netcon = [-6.353189924178953e-03   -9.647679244157122e-02   +2.887384806270386e-01   -5.222724108653022e-01   +2.033136765481467e-01   -4.914261829515165e-01   +5.818706370079015e-01   +1.000000000000000e+00; -4.872005232668662e-01   -5.150811972293364e-02   +3.084514878057224e-01   +2.162578986617653e-01   -6.081027189993869e-02   +2.809683640608770e-01   +2.015354954835880e-01   +5.706153214849562e-01; +3.386732077128758e-01   +3.723226877943381e-01   +2.909340383927583e-02   +2.544340751159091e-01   -4.104812815254634e-01   -5.591023901011922e-01   -5.775007386167246e-01   -2.170965545524595e-01; +7.879827876883876e-01   -4.748739451022427e-01   -2.192431286443326e-01   +2.990325190594684e-01   +4.668215927019345e-01   +4.162368776761748e-01   +4.793548255247357e-01   -5.685167772556653e-01; +3.199117033689445e-01   -7.699964349620480e-03   +6.966008291480040e-02   -7.404156386563985e-01   -2.686552582771511e-01   +7.263844866100039e-01   -1.101111234956183e-01   -3.317920289528425e-01; +5.732061744668846e-01   +1.262060841419587e-01   +9.723229602794865e-02   +2.472686615499813e-02   -5.626686691780773e-01   +1.622922575037866e-01   +1.442338751603874e-01   +6.166522870424704e-01; -5.825277738577518e-01   -1.627381964764282e-01   -6.567983939392498e-02   +2.171634831492823e-02   +1.054366364719520e-01   +4.626331293763037e-01   -3.164653022748068e-01   -7.095982654187332e-01; +6.805234667513465e-01   +6.159345276900750e-01   -5.489106075770239e-01   -1.902570548383354e-01   +5.653471930051369e-01   -8.813621338552613e-01   -3.278486715506111e-01   +4.259082235728615e-01; +8.670502758437130e-01   -5.178410061873514e-01   +4.235477477135121e-01   -4.048559297699179e-02   +2.556076660338170e-01   +5.210923963501058e-01   +3.212830071547027e-01   -1.597490524035326e-01; -2.387457679069691e-01   +1.319108317678918e-01   -4.632727544148735e-01   +6.708114650989551e-01   +1.386502583549007e-01   -3.575111202373971e-02   +8.181208635626679e-02   -6.450793701629493e-01; -1.719770418955229e-01   -1.085347445239416e-02   -8.346021314801991e-01   -6.931501883520001e-02   -3.687485681860974e-01   -5.474832664782080e-01   +3.954644176625280e-01   -5.757722341865870e-01; -9.901693015630786e-02   +6.629728782547848e-01   -5.866393796352411e-02   -8.113026838337503e-01   -7.555314060307923e-01   -7.884119454621025e-01   -5.080919603910921e-02   -8.826250132781578e-01; -4.340207431013827e-01   +2.654407607310068e-01   +7.485914448389508e-01   -7.051623985063288e-01   -5.957550730606409e-01   +2.362026043212596e-01   -1.388712703456999e-01   -1.263321782203913e-01; -2.255792187712058e-01   +5.936669032009744e-01   -2.388551034839556e-01   +1.416730694896064e-02   +3.056192224593358e-02   +1.345175510540973e-01   +3.859918865625093e-01   -1.603599757744149e-01; +2.615051601436107e-01   +6.852730187501385e-02   +6.492876173069485e-01   -1.508512262450795e-02   +6.849603407843173e-02   -4.889448577833827e-01   +6.847568088930796e-02   +1.099526257396491e-01; +4.785816546104550e-01   +4.231306450078718e-01   -1.250949129062766e-01   +2.017352119885815e-01   +5.755177949488948e-01   -1.733805228353204e-01   +6.875857008478437e-01   +1.214413535151788e-01];
L1E_L2E_iAMPA_netcon = [+2.401274166940520e-01   -3.700401903997638e-02   +4.954759973888648e-01   -2.885760829174379e-01   -2.820161323995652e-01   -2.311104610204371e-01   -1.374511675116798e-01   -2.130974116322598e-01   +6.447453428579775e-02   +7.624004933705750e-01   +2.963543237689570e-02   -3.378995959983578e-01   -1.490982742626713e-01   -4.909361231513470e-01   +3.422569343965373e-01   +5.567471743943259e-02; -6.921825345479505e-01   +8.660165513192714e-02   -3.766965900625101e-01   -4.812100109499912e-01   +1.441224013509795e-01   +8.500144578287128e-01   -4.017389135922487e-01   +2.161277734512271e-02   +2.153797627213408e-01   +8.687318775512718e-01   +2.559379646714451e-01   -2.839941942533004e-01   +3.120091356878575e-02   +1.445639837100597e-01   -4.349130461269242e-01   -9.666393331130232e-01; +5.885797525465419e-03   +2.128382840529525e-01   -8.432711563713169e-01   -3.649886750238640e-01   +7.304417002721277e-01   -5.230219899462598e-01   +3.994835862054854e-01   -1.230302170260484e-01   +2.336427495516508e-01   -4.491133949206605e-02   -2.276632732885271e-01   -3.631509188112779e-01   -7.869305382374286e-02   +8.682456287847082e-01   -7.869377386309828e-01   +2.550705333456695e-01; -1.496071451597558e-01   +4.780038824600950e-01   +8.615795181167916e-01   -1.571109825832311e-01   -1.073605066381403e-01   +4.160991473824861e-01   +3.534809882842572e-01   -5.676793345495954e-01   -1.131932534669330e-01   +6.957124417565397e-01   +8.047320345310410e-02   -5.284247066805137e-01   +6.314080605217592e-01   -3.315143518341115e-01   -7.506547848970309e-01   +1.387666196067219e-01; -5.588216866177516e-01   +2.216808215868182e-02   +5.987931221587978e-01   -2.259669623504976e-01   +6.347027012847033e-01   -3.908261309202896e-01   +3.264991808122912e-01   -4.281874991123625e-01   +2.194424552396630e-01   -3.900991405224050e-01   +1.845120496137080e-01   -6.197891978081767e-01   +1.392911695025308e-01   -7.463101181743982e-01   +3.078647380172830e-01   -3.726525342177668e-01; +1.247351896732934e-01   +4.615751544667475e-01   -1.978486982452078e-01   -4.184457560040326e-01   -4.214122400654846e-02   -4.272122117268317e-01   +2.215584090935217e-01   -1.069796988346439e-01   +5.495541902622672e-01   -3.618266783881716e-01   +1.258313139384696e-01   -4.960741815422104e-01   -1.065470348074578e-01   +2.715201538987092e-01   -1.680005275669571e-01   +3.558055951527164e-02; +3.263314770028408e-01   -5.615336814262962e-01   +8.635830478540981e-01   +4.792340960851543e-01   -3.226973835598693e-01   -9.945584585593498e-02   -3.194355833145862e-01   -1.313207468761921e-01   -1.352760531799417e-01   -3.154100754499916e-01   -3.236608427216696e-01   -4.123838522487491e-01   -2.918458585642966e-01   +7.341857528961675e-01   -6.724851905730783e-02   +4.336675111873512e-01; +3.030957829684346e-01   -1.317981764221517e-01   +6.592115126747822e-01   -1.849605310965390e-01   +4.816835597453061e-01   +5.116629138132182e-01   -3.443867928185806e-01   +2.265818022348338e-01   +8.341058872854460e-01   -4.798716530319280e-01   +1.402028033180936e-01   -6.354435758435470e-02   +3.735228489978493e-01   -8.075508957463553e-01   +4.363696802910866e-01   +3.393445118124616e-01];
L2I_L2E_iAMPA_netcon = [+2.245855449916628e-02   -6.949276271151505e-01   -7.936664278993434e-01   +2.429630561893454e-01   +1.600223319944676e-01   +5.831110454604708e-01   +8.302085267779481e-02   -2.865395832109774e-01; -3.126059716307474e-02   +6.723668089526973e-02   +5.916924605228854e-01   -8.568444682753740e-01   -8.056699582371786e-01   -1.828423948314598e-01   -2.225993066058085e-01   +3.543138383000506e-01; -7.042744963458339e-02   -1.469416951986287e-01   -2.284264424879516e-01   -5.273510244935189e-01   -1.720413095919972e-01   +7.644998145835391e-01   +2.424032724613643e-01   +2.724960760741821e-02; +3.746180152610107e-01   -7.306657456648882e-02   -2.381763880888328e-01   -5.477210641873943e-01   -3.922315500347650e-01   +7.958507490533908e-01   +4.568317707749212e-01   +1.535687316590085e-02; +3.414846681766397e-01   +4.723853565134971e-01   -1.164048783677527e-01   -2.233187622964711e-01   -1.810990859491092e-01   -1.027438906632842e-01   -8.162974570816028e-02   +2.266453117686123e-01; -3.759969111707976e-01   +3.671824380226196e-02   -1.567051971774635e-01   -1.000000000000000e+00   -1.888543419058996e-01   -5.179312931215362e-02   +5.023370501858546e-01   -4.775923766324461e-01; +2.223544776862672e-01   -2.142710368527909e-01   -3.029039547564477e-01   +2.431133884592387e-01   +6.899483543603887e-01   +4.470087400460278e-01   +1.041902114895095e-01   -5.752679795229877e-01; -6.090629552525328e-01   +1.115256633563393e-01   +1.721109711597069e-01   +2.469516122792417e-01   -6.130747444968916e-01   +4.190022864106187e-01   -1.657287207645200e-01   -2.810383911598358e-02];
L2E_L2I_iGABA_netcon = [-2.489647388232503e-01   -7.163305455965864e-01   +1.215834073952832e-01   +7.733399932789750e-01   +2.069416192275098e-01   +2.096103594244871e-01   -1.000000000000000e+00   +4.034887056860461e-02; +7.037855598950171e-01   +2.812658764036617e-01   +3.556905959664981e-02   +6.434096647914318e-01   -3.241525427332073e-01   +2.754786121940201e-01   +8.369309881703177e-02   -3.173678429143259e-01; +4.557492430803517e-01   -2.940803834291002e-01   +2.726457604232638e-02   +2.771070458860755e-01   -7.804024217825679e-01   -5.551996649613350e-01   +4.938997617100472e-01   +3.389509120862993e-01; +1.185584448304426e-01   +2.940141689963544e-01   -2.326899891216397e-01   -6.289306713594945e-01   +3.707303342762642e-01   -2.802938721273825e-01   +4.067236109177273e-02   -7.843469126492426e-01; +5.631766871140337e-01   +2.302921020575330e-01   -3.573856464357676e-01   +1.035802747188864e-01   -2.291212008860621e-01   +2.479295290556480e-01   +4.580210725890669e-01   +1.360715077301604e-01; +4.350740404046326e-01   +4.623899124476326e-01   -1.058632228235062e-01   -7.286324695591898e-01   -4.271500744088054e-01   -1.440840798132292e-01   -5.578424400429863e-01   -5.519742164162732e-01; -2.556132091822376e-01   -1.221007239992109e-01   +1.131844350160787e-01   +7.912375228398515e-01   +6.368424521143297e-01   -1.053257414009594e-01   -2.391652658676824e-01   +4.736680948848478e-02; +2.898267439822182e-01   +2.253148233339821e-01   -1.900572117666647e-01   +4.530906270541976e-01   -1.775124841649096e-01   -3.251164033785900e-01   +3.569692299585671e-01   +1.669716092070000e-01];
L3E_L2E_iAMPA_netcon = [+2.167543305128466e-02   +8.054844103272096e-01   -9.235672739745413e-01   +4.313276657901244e-01   +2.585948566493265e-01   +2.726487664765366e-01   -1.173152810784926e-01   +1.164824504696751e-01   -7.732705473453838e-04   +4.439562360857591e-02   -3.645129535317828e-01   -6.786045642181164e-01; +7.176722752139827e-01   +1.692921267207843e-01   +1.724033152035824e-01   +2.753255873827807e-01   -2.756069542577999e-01   -6.149084236936518e-01   -3.349448716996285e-01   -9.167047685707880e-02   +2.204558726617123e-01   +8.253959175249412e-02   -9.059393402577789e-01   -2.769513095182536e-01; +1.493996858687155e-01   -2.982324839567160e-01   -4.066757043241616e-01   -3.302632205317508e-01   +5.826787770502059e-02   +7.254647075812451e-01   -3.086839993474149e-01   -7.042156544745053e-01   +1.813098723389946e-01   -4.256935922464067e-02   -4.238401510066812e-01   -1.256045926075099e-01; +2.012936405631817e-01   -1.325973731277352e-01   -5.413721911912872e-01   +1.051159590876726e-01   -2.411618600120702e-02   +4.780174481467014e-02   +2.405509676850589e-01   -8.346972846922018e-02   -1.718829261236273e-01   +9.011434947206273e-01   +2.575911484599500e-01   -3.075643953110735e-02; +1.068838497207036e-01   +2.353640766460814e-01   +5.467576013482892e-01   +5.372839005946188e-01   -8.308455256896898e-01   -2.973159570963599e-01   -4.924345529928509e-01   -6.271467796655845e-01   -2.140481217641741e-01   +1.784983848588908e-02   +7.430275314333414e-02   +5.053603825954764e-01; +3.829309782477789e-01   +4.551851782265648e-01   -1.621179093260331e-01   +4.063820830513190e-01   +1.393572119376290e-01   +3.668074769950340e-01   +2.434978320636585e-02   +2.329671725683898e-01   +5.100142250044883e-01   -5.875225660579201e-01   +5.896410440049108e-01   -9.292507061691240e-01; +6.208609047890835e-01   +3.546634581565796e-01   -5.006964638006635e-01   -6.242810080813652e-01   +7.304829131224844e-01   +1.936992120447280e-01   -6.771910467411681e-01   +5.499983366086146e-01   +1.791711013862492e-01   -2.872975188863314e-03   -6.665103096373577e-02   +1.476883880787814e-01; +4.350766440114501e-01   -1.272662880504691e-01   -3.077484218020995e-01   -3.580649816375318e-01   +2.122533410440756e-01   +4.823310574842016e-02   +1.227061770015654e-01   -1.400957100516087e-01   +1.490193877882440e-01   -1.422012942150885e-01   -4.107423586341231e-01   +7.392948968825246e-01];
L3I_L2I_iGABA_netcon = [-2.276369812129812e-01   +2.378519437417721e-01   +8.069942574842968e-01   -4.758305538354740e-01   +6.123929843296790e-01   +3.343572566264740e-01   +1.998483742262986e-01   +4.876226809467572e-02   +3.647008210892193e-01   +1.559579599224837e-01   -2.638105754822510e-01   +1.909421350661686e-01; -7.222189720915736e-01   -1.472717349681513e-01   -1.289914758121830e-01   -1.811994882652271e-01   -2.673586908721384e-01   +1.579123574786378e-01   +4.084117520248137e-01   +3.239413229511443e-01   -6.074647405841294e-01   -1.743734321989845e-01   +4.411460446521321e-01   +1.222122384272622e-01; +6.666346617148513e-03   +3.723697560932411e-01   +6.428408220430853e-01   +3.492657333074795e-01   +1.061054756095752e-01   -9.466134486107836e-02   +2.206747896312169e-01   +3.489561567115896e-01   -1.707874940926183e-01   -2.575948722980597e-01   +8.512945546678112e-01   +6.340745765374802e-01; -1.190075186989656e-01   +9.799109727769363e-02   -3.193048624431026e-01   +3.995023807648030e-01   -4.085390858612394e-02   -3.549746803179751e-01   +7.274059286953667e-01   -1.346198379427952e-01   +2.137269688635152e-01   -7.838753736285518e-01   +3.312626306445964e-01   -1.000000000000000e+00; -2.990737469335704e-01   -3.554300362499715e-01   +3.913753984386533e-01   +1.958500769228237e-01   +3.382281197894336e-01   -3.922300419268031e-01   -2.195822011080787e-01   -2.950444784678226e-01   -4.868513961554853e-01   +3.074929648681740e-02   +3.272530727450711e-02   -7.121604247625291e-02; -5.435764375617033e-02   +3.688141636138376e-01   -6.367412831596927e-01   -1.153321807225201e-01   -6.321097437095522e-01   +2.747116328628746e-01   +2.409714504477713e-01   +8.080475037452808e-02   -6.116037181454158e-01   -6.277462554381104e-01   -3.365384024988251e-01   -1.488857515928140e-01; -2.888735217507841e-01   -4.719421909658213e-01   -5.331030886582494e-01   -7.218637135920553e-02   -5.920668289874462e-01   -5.666485810522066e-01   -3.241663828524919e-01   -4.084132514516747e-01   -3.448629144284712e-02   +1.685532659925177e-02   -8.103460042196019e-02   +2.455169244369253e-02; -1.989707821026083e-01   +3.883730212693613e-02   +7.399323248285856e-01   -3.601450210953402e-02   +5.670442348166800e-01   +3.121635211553557e-03   +4.075258620906357e-02   +1.470774902173065e-01   +3.002180934435532e-01   -2.844815949864686e-01   -1.775674612064889e-02   +2.136219692799472e-01];
L2E_L3E_iAMPA_netcon = [+3.071576592326248e-01   -8.046927498942795e-02   -3.794325850825217e-02   +5.628798236979016e-01   -6.903571413005805e-01   -8.469945572544253e-01   -2.485706723116921e-01   +2.610212104143468e-01; +4.399444018866674e-01   -1.358088814016041e-02   -8.212620271369289e-01   +4.704361390724738e-01   -4.237172665435390e-01   -6.449435179641654e-01   -2.973643664545733e-01   -3.431784002650809e-01; +8.908367410344353e-01   -3.831903659692092e-01   +4.363155914332481e-01   -2.305564723559964e-01   +1.004604308410005e-01   -8.398523547570297e-01   -1.746426920674829e-01   -3.142467480482933e-01; -1.590832460997569e-01   -5.719663660889095e-01   +3.007687037690072e-01   -2.476766251393566e-01   -7.305985258877949e-01   -6.374308900256946e-01   +3.438327697796582e-03   +2.318444201717787e-01; +8.242549407533838e-01   +4.288697355395947e-01   +3.179968004119736e-01   -6.068105495238176e-01   -1.155776992356431e-01   +3.261185641809755e-01   -8.794225188953496e-01   +3.216536641886769e-01; +9.229780820499029e-01   -4.881947868139759e-01   +7.616732679808998e-01   -1.568930325764576e-01   -1.145381188446621e-01   +9.807149877590291e-01   -3.291214664415608e-01   +4.002273571625078e-01; -5.350944905639685e-01   +6.299540309417067e-01   +2.322207647104969e-01   +1.068445078999696e-01   -1.491245717793997e-01   -3.746889585303562e-01   -4.465016050463362e-01   -6.677240632833138e-01; +6.071083829462683e-02   +1.557564054948719e-01   -3.718072764234388e-01   +3.092133645893191e-01   -1.366073993442398e-01   -3.263410035240237e-01   -2.732710431245071e-01   -4.807198921170815e-01; +9.758999141827300e-02   +2.704301482925572e-01   +7.384190036752927e-01   -2.940654192752898e-01   -7.231216208741494e-01   -4.780756344974123e-01   -1.000000000000000e+00   -1.031699219319527e-01; -3.111659021838504e-01   -9.006589920477008e-02   +2.271191416724275e-01   -5.854482415414212e-01   -7.429476248550078e-01   -2.250196702627026e-02   +4.138038805035918e-01   -1.950372026287203e-01; +1.069313113346172e-02   -7.291899440958595e-01   -6.311187415771018e-02   +6.815375635109124e-01   -6.801970912766763e-01   -2.410422869831889e-01   +6.671243555757599e-01   -5.643201778786437e-01; -9.697661220146813e-01   +7.733521560435529e-01   -1.549096766369386e-01   +3.480879400670355e-03   +4.017360023461011e-01   -5.310594720428577e-01   -4.776109113740513e-01   -1.730542376613631e-01];
L2I_L3I_iGABA_netcon = [-3.586274993294655e-01   -3.923709182219370e-01   -4.021552543154753e-01   -1.143229171537841e-01   -5.702981149556948e-01   -8.771834760486152e-02   -1.698147090537948e-01   +1.142053176865970e-01; -1.982983901032124e-01   -1.738306335056023e-01   +5.182003359769103e-01   +8.716942395295169e-01   -3.174586622885934e-01   -6.034246129678097e-01   -3.879667489468952e-01   +3.269584200392391e-01; -3.071597659607922e-02   +1.000000000000000e+00   +4.019164899271286e-01   +2.674898276369579e-01   +3.279353541376230e-01   +8.016239599977032e-02   +4.306732944919087e-01   +4.736619306302338e-02; +5.951867639489067e-01   -3.832065629649496e-01   +6.140114652034347e-02   -1.412252868663690e-01   -9.841358726979715e-02   +2.056875221770260e-01   -1.091119927926691e-01   -1.197788693387542e-01; -2.493103731940007e-01   +6.187646733921012e-02   +7.665654913497792e-01   +4.766217625925147e-01   -1.794080130395109e-01   +7.215285781228678e-02   -2.576116957833147e-01   -8.277514557838250e-01; -4.119558154471420e-01   -5.123702357614868e-02   -5.836335830548334e-02   -2.294506113726363e-01   +2.954930595105302e-01   -8.879646681140504e-01   -2.657569968488976e-01   -2.497947914886477e-01; +8.271181608973946e-01   +4.885040632768383e-01   +5.384480047009115e-01   +9.479820501641643e-02   -2.256725246841672e-01   +4.703063361312494e-01   -4.546507588168276e-01   +5.575319495778740e-01; +9.158323852314220e-01   -6.233090609874595e-01   +3.372453941934102e-02   +5.363678244346461e-02   -2.318349435046974e-02   +5.361865296813072e-02   -2.712653189350184e-01   +1.598498376934494e-01; +3.178082740506939e-02   +6.411276770123295e-01   +1.352869736324564e-01   +5.365077288095101e-01   +4.713343702925665e-01   +2.295656638467348e-02   +1.461337914828348e-01   -1.560699439383721e-01; -2.721362169244348e-01   +2.593084962579644e-01   +1.350108658928262e-01   -8.008318908943935e-01   -5.533816967279250e-01   +3.921825455266941e-01   -1.054565404469956e-01   -6.877066060117287e-02; +4.741364833969324e-01   -4.227096381258286e-02   +2.400116837756882e-01   +2.785467320719191e-01   +2.860978006267902e-01   -4.253033342132270e-01   -3.016043733681729e-01   +1.224270453473356e-01; +1.047341123063307e-01   +1.975744989636299e-02   +4.284063012079703e-01   -3.903167952904417e-01   -1.752373496119297e-01   +3.042492606719683e-01   +7.047022408291765e-01   +1.141129888870133e-01];
L3I_L3E_iAMPA_netcon = [+1.144135150200281e-01   -1.018777947813513e-01   +3.610677038726560e-01   -7.392101697246808e-01   +1.043669815076691e-01   -5.119874221944116e-01   +5.874148872532903e-01   +3.923888710871336e-01   -4.591653788419525e-01   -1.682663983255877e-01   -5.861424235833390e-01   -2.244127607988112e-01; -8.486388395254647e-02   +2.106577253974431e-01   -9.464565521186950e-02   +1.913038318853513e-01   -3.086259471234590e-01   -1.000000000000000e+00   +3.088230962824640e-01   -6.795035756484341e-02   +4.299984604627191e-01   -3.028886648467654e-01   -1.940046261639611e-01   +1.343493536167507e-01; +1.946105864672401e-01   +1.628369699851933e-01   -7.120150060106100e-01   -7.336926209891617e-01   -6.635585178687851e-01   +3.016085444305913e-01   +3.593740254469620e-01   +3.014271147323631e-01   -8.737492132801133e-01   -2.569361735004966e-01   -1.529839673266997e-01   -1.469066295243618e-01; +4.264232600815285e-02   -3.236857621677802e-01   +4.616149715679546e-01   +2.289517553552838e-01   -2.022607492205989e-01   +6.761219554415764e-01   +5.167081681884138e-02   -9.141466637556426e-01   +1.027858554366276e-01   +3.989930039451957e-01   +2.699478535198531e-02   +2.257520363457751e-01; -5.819457099465053e-01   +4.416409057094644e-01   +1.920480349758646e-01   +5.688908418485809e-02   -4.289130154875515e-01   +6.322137508351908e-01   -3.776542324289249e-01   +8.910068891681224e-01   +4.390766152689268e-01   -7.174699439114272e-02   -3.844910146369978e-02   -6.870609182320183e-01; +8.047207661098287e-01   +7.644676253959386e-02   +6.161602302269915e-01   +3.514845945544381e-02   +4.689673334316244e-01   +2.893958203314968e-01   +3.364713975399461e-01   +2.373579899647561e-02   -1.305266593982634e-01   -3.647015755248798e-01   +6.652534267315573e-01   -5.602318651503614e-01; +2.474910366884232e-01   +9.454260426603153e-02   +2.006901210382278e-01   +6.728571685871556e-01   +4.970989609041789e-01   +1.082027830220662e-01   +3.149088274140125e-01   -1.518231353878684e-01   +6.486609070627852e-01   -4.573121323815586e-02   -3.604246295281287e-03   +3.717771438434887e-01; -6.224366932071528e-01   +4.983964468711723e-01   -6.270360209604470e-01   -4.492315256732896e-01   +1.753723481281529e-01   -2.690458730865151e-01   +1.835792886238658e-02   -7.366876557259703e-01   +3.742273911258859e-01   -1.131997083433275e-01   +6.974878929424499e-01   +1.966689126998103e-01; +2.165492727034374e-01   +2.616873474560663e-01   +9.618967522843562e-02   -2.233186174656916e-01   +4.166038837925188e-01   +4.793580685620464e-02   +2.491788513577496e-01   -4.064662895716276e-02   -3.960717760163703e-01   -6.584579176311157e-01   +5.345742968245366e-01   +1.690451458392520e-01; -2.270996195382273e-01   +2.316525124879413e-01   -5.094270530325533e-01   +4.206389133802541e-01   -5.094269563900281e-01   +4.816121170569212e-02   -3.467809770987345e-01   +4.963554601314690e-01   -7.114765025287249e-01   -3.381384841953664e-01   +3.843640612420005e-01   +8.027919392297723e-02; +2.723516280098804e-01   -1.061183940167473e-01   -6.795552366873255e-01   +5.798197763867570e-03   -6.200862463738919e-01   +6.297134130893835e-02   +8.810705526431019e-02   +1.815471828773564e-01   +3.097914194232962e-01   -1.105771440833553e-01   +1.239336245152799e-01   +1.611152341499985e-01; +2.601429574285808e-01   -1.266056853237120e-01   -7.479957865479185e-01   +4.196339977515008e-01   +9.487504053736197e-01   +6.978835774474197e-01   -1.223529255178885e-01   +2.771783518701137e-01   +2.761630107796330e-01   +8.015142702645868e-02   -1.054206976923211e-01   -1.666129727522350e-01];
L3E_L3I_iGABA_netcon = [+3.729361519561893e-01   -2.252887120462867e-01   +4.329152998097444e-02   +5.704669846087246e-02   -3.285209068787804e-02   -4.831316460332204e-01   +5.463571515874782e-02   -5.502075700639305e-01   -3.447868847049643e-01   -1.698252592197448e-01   -2.704566804522080e-01   +3.347316418759166e-01; +6.407954382068378e-01   -2.031319409826466e-01   -3.220912253870795e-01   +6.503539139511454e-01   -3.698645718159413e-01   +7.578026963597455e-03   +5.511384187653453e-01   -3.809483637155851e-02   +5.061636232563822e-01   +1.972898170507504e-01   +5.655806086287331e-02   +5.142617042599035e-01; -5.325210736801179e-01   +4.337671506714825e-01   +5.453005960502176e-01   -5.172596248888891e-01   +1.443560206296373e-01   -2.606469702960603e-01   +1.768257400655960e-01   -3.291516933529234e-01   -3.203499621408868e-01   +7.545712829136329e-02   +2.841260737994896e-02   -4.475396402636635e-01; -7.289688556242354e-03   +1.314663772568729e-01   +3.882814321571617e-01   -1.969058380529307e-01   +5.206022190939820e-01   +1.662640459766401e-01   -4.664824559314904e-01   -4.870989891660037e-01   -6.140617003476044e-01   +1.375564466140023e-03   -4.364067482494562e-01   -6.342768528897555e-02; -7.339615889912966e-01   -6.302864239577453e-02   -8.228545010302745e-03   -4.993343168577974e-01   -2.281304268252901e-01   -4.357013468769358e-01   -3.516706631692759e-01   -2.028842668891221e-01   +1.654915631284131e-02   +3.295178741260124e-01   -2.339280279269656e-02   -2.520015220026594e-02; +2.441104958038520e-01   +2.827548183407662e-01   +6.430857286119174e-02   -6.840983033303948e-01   +4.242167904299525e-01   -4.051417126284798e-01   +6.158069300509280e-01   -2.211910118161324e-02   +2.470905554127059e-01   -3.995374953355586e-01   -3.466434817701021e-01   +3.262844416773600e-01; +1.701549213111947e-01   +2.574717775606180e-03   -1.750680428692888e-02   -4.316606727976993e-01   +8.753413914677016e-02   -8.675160930562484e-02   -8.120555999206863e-02   -3.855676016607424e-01   +1.943220654710082e-01   +1.043761355979188e-01   -3.822756165411986e-01   +1.040604610956175e-01; -4.007596583222741e-01   +7.701492746843910e-01   +4.645009479536038e-02   -1.569392781269009e-01   -6.215438633682246e-01   -6.974980534936491e-01   +6.302967770106505e-01   +1.069901108041522e-01   -3.834647984834364e-01   +6.929185845101521e-01   -1.022948175986233e-01   -2.750994371611548e-01; -3.905473727728943e-01   -2.997221783129877e-01   -3.531395456655115e-01   +1.793665749719152e-02   +3.963386285614062e-01   +4.518737503316058e-01   +5.404782194316021e-01   -1.025044768066475e-01   +1.548286542305741e-01   +1.797195869970843e-01   -2.937538618617649e-01   +2.863015136181330e-01; -2.068223051971652e-01   -1.214581357603753e-01   -1.914340369266714e-01   +2.713581721403848e-01   +4.128710268928462e-01   -3.393467868438729e-01   -2.421144127214151e-01   +2.647223397762116e-01   +7.731598207565594e-01   -1.394970127251837e-01   -2.243090419378348e-01   -6.675569303471719e-01; +1.000000000000000e+00   -5.821459158905062e-01   -2.546632136320779e-01   +4.797994231137437e-01   -7.346226419567460e-03   -2.176244283759423e-01   -2.593217960189210e-01   +3.223786529132092e-01   +6.476515798134589e-01   +6.224611501108923e-02   -1.492721449380288e-01   +4.685323033462441e-01; +3.015276602757377e-01   -3.928460478654147e-01   +2.823770295644642e-01   +4.698737054480342e-02   -1.869121431578429e-01   +3.818127742728712e-01   +2.884469778629458e-01   -3.766028882077328e-02   +3.605786445830929e-01   -5.400109341818771e-02   -3.573976634564791e-01   +3.567223562855636e-01];
L2E_Input1_iAMPA_netcon = [+4.536127658682756e-01   +1.832456072845780e-02   +6.507480925562294e-02   +1.360813808778744e-01   -2.179145934447407e-01   +4.123610431860332e-01   -3.583243734521829e-01   +1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [-4.976202350271323e-01   -1.706152351720602e-02   -8.130296458235517e-02   +5.955313775364754e-01   -4.782611783094575e-01   +5.342354775614794e-02   +4.734701723412592e-01   +7.075096080421481e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
