function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.205359445050201e-01   +3.494063092781934e-01   -8.574168248280348e-03   +3.872761759688937e-01   +4.365647609047991e-01   +7.228366083873533e-02   +2.743954876270688e-01   +6.007798403809625e-01   +2.650209868302970e-01   +2.713247522223663e-01   +3.406376540922391e-01   +3.366709641397799e-01   +2.320983151674335e-01   -1.975716507122480e-01   -6.292352838130899e-02   +3.557659917809895e-01; +9.284223765681588e-01   +2.810292811162574e-01   +5.237513718048358e-01   +3.310425494395256e-01   +2.156776755291429e-01   +2.431307519325024e-02   +1.342922602066894e-01   +1.797358667689586e-01   +5.468357889951583e-01   +5.403593734193076e-01   +2.068738832663644e-01   +5.267961753961703e-01   +5.635927500223268e-01   +7.885558143215650e-01   +4.422028175320017e-01   +1.248300611864471e-02; +1.965959810885713e-01   +1.512110177484014e-01   +2.658006335304680e-01   +3.765310012138422e-02   +4.528984680974709e-01   +1.229127747684405e-01   +2.431262450362552e-01   +5.137936071180135e-01   +3.197090845132867e-01   +5.213177735644924e-01   +7.012180137384129e-01   +5.662818774662361e-01   +8.207975497596403e-01   +7.541526512519953e-01   +1.747771119338374e-01   +3.868986658280888e-01; +3.491210322710345e-01   -2.279179649110133e-04   +3.794266865978618e-01   +9.029399800046612e-01   +4.057624216809034e-01   +7.037214467971908e-01   +4.784034683985811e-01   +3.048834073329705e-01   +1.686860702394192e-01   +1.218564071832032e-01   +6.453726758308531e-01   +3.995061562072059e-01   -1.210078628089471e-01   +4.272179547863193e-01   +4.510001720099450e-01   +1.779666519279285e-01; +4.516043276081119e-01   +6.361459554880325e-01   +3.868641128649912e-01   +2.258536317680231e-01   +1.127938505686817e-01   +5.485716674519330e-01   -3.108017257091095e-02   +1.476154100251510e-01   +4.254150409602110e-01   +7.634522287032502e-01   +3.736131378333755e-01   +2.065602192034316e-01   +5.758962843780105e-01   +3.225467171558449e-01   +7.765594337670851e-01   -6.320631915004229e-02; +2.589184709699659e-01   +1.654685860403347e-01   +6.918304553442539e-01   +3.299471320715964e-01   +3.479248844422624e-01   +8.071052649163266e-02   +2.365438883544727e-01   +1.124949984194726e-01   +1.341395224083482e-01   -9.000601485572861e-02   +3.739516745373356e-01   +7.602178871493998e-01   +2.983156961436775e-01   +7.078471313949514e-01   +5.596886893897758e-01   +3.629626131256823e-01; +9.902962966936607e-02   +5.323973317953332e-01   +2.875523427015182e-01   +2.586410414459620e-01   -1.958576304294127e-02   +4.815885196116991e-01   +2.807914344440139e-01   +6.005940855845385e-01   +5.533039360140352e-01   +3.249521752017072e-01   +6.390076849748036e-01   +4.979240273937400e-01   +1.040981269806753e-01   -8.578187418846685e-02   +1.993889862553079e-01   +2.371103613143362e-01; +2.023478284353687e-01   +5.402714903823725e-01   -1.622071839130064e-01   +7.590651421348270e-01   +4.164292909553420e-01   +3.802745979076757e-01   +7.538796163202359e-02   +1.554830678494468e-01   +3.794961669547359e-01   +2.704972684099159e-01   +6.142298255501258e-01   +4.784316993839229e-01   +4.038083797266047e-01   +2.552727539931303e-01   +6.099854455611439e-01   +7.554010197528709e-02; +3.237442131731998e-01   +3.750064152278579e-01   +1.210602867719449e-02   -2.483386060043830e-01   -1.705257309319148e-01   +5.544447959854011e-01   +4.112438303926439e-01   -2.253958483147616e-02   +3.402720605554877e-01   +4.727073055332760e-02   +4.264684140786248e-01   +2.838738252232093e-01   +6.341067084314688e-01   +7.066332633711192e-01   -1.179303567312525e-01   +4.398551384018129e-01; +4.995535261899626e-01   +2.326377867794421e-01   +7.085053842386421e-01   +7.493560384086183e-01   +1.290327797713303e-01   +5.893440877986333e-01   +1.724488364520478e-01   +7.528580237507694e-01   +2.660894171337386e-01   +5.694330268523897e-01   +6.467976659456030e-02   +5.962751063074969e-01   +4.781908336835270e-01   +3.895461040549410e-01   +2.315021338188095e-01   +7.851045796660019e-02; +3.361006688264143e-01   +9.604644309343989e-01   +7.604146586485013e-01   +1.770248565716420e-01   +7.705486952011764e-01   +7.144072004761355e-01   +1.588395063276247e-01   +3.293751780599070e-01   -7.384237476675724e-02   +7.013220456716205e-01   -1.003490671355092e-01   +6.271976207747350e-01   +5.232466935567499e-01   +2.429586088202551e-01   +3.503513257763175e-01   -2.739898869685992e-01; +1.087442341253468e-01   +3.412483090520580e-01   +5.852744403258014e-01   +9.641053217681690e-01   +2.756662516464622e-01   +5.033139744066359e-01   +3.185916730226233e-01   +2.761641897592432e-01   +3.528331257613574e-01   -7.347569442451471e-02   +9.201407828838674e-01   +6.228366414738477e-02   +3.954997126742356e-02   +2.715858380890482e-02   +3.529634837008497e-01   +4.733731677133992e-01; +4.970346810079512e-01   +6.913769416195327e-01   +6.806563856388315e-01   +5.990628983623811e-01   +2.952115099425659e-01   +4.671999756159237e-01   +5.569550025733114e-01   +2.797317207530540e-01   +2.516506971577702e-01   +4.564953295698847e-01   +3.762855876211809e-01   +4.478071001055906e-01   +2.798749266440335e-01   +4.023362361539494e-01   +7.255991750133893e-01   +3.143883778884486e-01; +5.388606899413442e-01   +8.163357427826974e-01   +3.579401747689398e-01   +4.874707146956541e-01   +5.447158897037024e-01   -1.136415705979913e-01   +5.453740271336159e-01   -1.304577746881102e-01   +3.269476163910566e-01   +5.222191713753500e-01   +1.942730987418044e-01   -1.613738889254851e-01   +4.186637954661277e-01   +4.828457391333593e-01   +2.610623260530357e-01   +5.372905711829251e-01; +6.133527385054658e-01   +3.066936754394881e-01   +6.129197546932161e-01   +1.043938659934602e-01   +1.708826123256838e-01   +4.611887974583688e-01   +3.435427008910945e-01   +3.486268312857617e-01   +1.518118949115088e-01   +3.587122007768577e-01   +4.613169866982377e-01   -1.410099622015860e-01   +6.185852275849998e-01   +4.189832501016344e-01   +6.167039991233062e-01   +4.908983796587766e-01; +2.004883803668017e-02   -2.442933619630468e-02   +1.353248818373233e-01   +3.747458653072107e-01   +5.539260188520073e-01   +4.045115095827058e-01   +4.434842587646500e-01   +4.680146408554230e-01   +1.853552009122875e-01   +1.708373767132725e-01   +2.250147596768091e-01   +6.221340335965511e-01   +6.291010816695958e-01   +5.475818504633790e-01   +2.472410835938514e-01   +1.850616906016808e-01];
L1E_L1I_iGABA_netcon = [+4.159180967369512e-01   +4.666928056980009e-01   +3.657366559060035e-01   +4.255676335955146e-01   +3.573552656456920e-01   +6.847318127490658e-02   +2.091289484055228e-01   +4.461372156903894e-01   +6.558136186937948e-02   +2.801420697149090e-01   +5.990068725007518e-02   +5.363052265499436e-01   +4.238942316493915e-01   +4.875908479208832e-01   +1.241417039537168e-02   +6.770491022191790e-01; +1.018200305831695e-02   +8.082424073934973e-02   +4.399694177020744e-01   +1.011245874383685e-01   +3.678220769837363e-01   +5.208050495030742e-01   +8.071056889842854e-01   +4.847941089622521e-01   +3.409158942142883e-01   +3.476835153232203e-01   +3.311851890090846e-01   +6.443590102757107e-01   -1.831038240051431e-01   +7.536416160301526e-01   +3.555819949872056e-01   +4.441091966991423e-01; -2.624423952021098e-01   +3.125929354071531e-02   +2.332736015576413e-01   +6.116998007669592e-01   +2.323159046715649e-01   +4.875044121724819e-01   +3.630692180903172e-01   +4.524154816872302e-01   +6.482666081899400e-01   +1.026649013027944e-01   +4.518218740697723e-01   +2.424393176762486e-01   +8.134036695212535e-01   +2.967476187976194e-01   +7.083582212381823e-01   +9.204510240625183e-01; +1.212335934071417e-01   +6.280499667557868e-01   +6.497439544389355e-01   +4.153136829549479e-01   +2.870438486098684e-01   +3.902307757054478e-01   -4.879682886616891e-02   +3.264523268189334e-01   +3.255105448308019e-01   +3.206445394914992e-01   +6.626820731948049e-01   +2.656964557824178e-01   -2.822188874285548e-01   +4.430664125574328e-01   -1.556677397779908e-02   +8.850625084578323e-02; +4.333710210362361e-01   +2.954274023020474e-01   +2.140305056946170e-01   +5.815973030590810e-01   +7.667041024185727e-01   +6.220346922346207e-01   -8.504483942366114e-02   +2.508978106614881e-01   +2.770608349950218e-01   +4.307391492509171e-01   +6.386529157970608e-01   -1.227369189430781e-01   +4.970271763939343e-01   +6.458404020438483e-01   +3.349644150696043e-01   +5.643075467871753e-01; +8.262538730078167e-02   -1.280973729557933e-01   +5.936944242888892e-01   +1.494422273726528e-01   -2.421654261367448e-01   +1.074888772890134e-01   +5.427662324728282e-01   +2.496654601490277e-01   +4.097412562959427e-01   +4.758493814807242e-01   +5.193122148112832e-01   +4.598290655271479e-01   +3.238474920021578e-02   +1.106087656966024e-01   -1.158406962104425e-01   +7.568357217645973e-01; +1.499775597690186e-01   +1.049413855181528e-01   +3.150888104391403e-01   +5.036219689418004e-01   +5.763582300410452e-01   +1.708823744946876e-01   +1.304798408079103e-01   +2.259266570993298e-01   +6.954076537530784e-01   +2.752577319352066e-01   +7.024518265922849e-02   +2.188167282534724e-01   +5.476571397186200e-01   +5.605035102522237e-01   +5.154891776422272e-01   -1.183964152684326e-01; +4.312968812063489e-01   +3.733965551217027e-01   +1.946066969969675e-01   +1.166296262311111e-01   +1.240346112313069e-01   +2.126125052827429e-01   +3.601102521706971e-01   +4.400063060692569e-01   +6.166855186622358e-02   +5.829628601465084e-01   +7.852170955588436e-01   +5.190058317652355e-01   +5.119439294062245e-01   -3.030982826707746e-01   +4.559344920817026e-01   +6.528787218035159e-01; +3.619348292734374e-01   +6.737182708233441e-01   +5.915170650242864e-01   +2.580496538013659e-01   +1.084444993068914e-01   +6.064048902687298e-01   +3.576982567401968e-01   +1.449834330075190e-01   +7.971910865696069e-01   +3.754455766642543e-02   +3.827359420360262e-01   +2.365742590675235e-01   +4.951848320195710e-01   +4.488198848621563e-01   +1.128661351601389e-01   +3.655232746728746e-01; +5.696454949719801e-01   +2.956043881954563e-01   +7.324049292880198e-01   +4.373182572694529e-01   +3.289607797672410e-01   +5.269013694718608e-01   +2.995365672514085e-01   +5.149060341621787e-01   +4.285589882180906e-01   -4.788322202371661e-02   +3.318562428377465e-01   +3.339503054121378e-01   +5.527601190857584e-01   -3.196184582779878e-02   -5.871220095062931e-02   +2.516364050468146e-01; +7.691179721822058e-02   -4.006890034522308e-02   +6.364275242908278e-01   +5.974838554616403e-02   +2.034141734345408e-01   +3.196618276548150e-01   +5.279209954018353e-02   +1.217529905072163e-01   +9.540871895078962e-02   -4.435479707423327e-02   +4.428235698246769e-01   +2.068515001979286e-01   +7.168639249015595e-01   +5.612312326997740e-01   +1.171765395605872e-01   +6.181420559550367e-01; -9.503121374706726e-02   +8.491567607771435e-01   +6.120485478414639e-01   +6.903802197547464e-01   +7.291107119235302e-01   -1.947583112963575e-01   +1.517152633052766e-01   +2.153235131717974e-01   +5.245217371977696e-01   +7.978169270953865e-01   +5.799644437097512e-01   +6.981237182283334e-01   +2.172385922884759e-02   +6.235223599014909e-01   +2.828787563545423e-01   +7.521449720835825e-02; +4.811774283850184e-01   +5.391252534928869e-01   +7.518583610029554e-01   +5.193191220352861e-02   +7.270833762665806e-01   +2.521452296750015e-01   +5.771310659455094e-01   +6.096400986400842e-01   -2.015813069128887e-01   +1.447666366925428e-01   -7.725964556818780e-02   +4.563738741043772e-01   +4.436900550982467e-01   +3.132041425187416e-01   +2.656523186008978e-01   -1.152536616351118e-02; +2.509364508112712e-01   +6.488772820828090e-02   +4.268117635893867e-01   +1.953324915153900e-01   +2.478903859382507e-01   +6.461780583541934e-01   +3.853690724588647e-01   +4.147203499519109e-01   +2.966506284999167e-01   +8.839100655716273e-01   +3.841353903292325e-01   +3.838594507545368e-02   +4.830511791447515e-01   +1.548392529057683e-01   +2.528476017355830e-01   +6.932937133452370e-01; +4.524207744685735e-01   +6.293348242136039e-01   +8.717288204167486e-01   +7.586953081800338e-01   +1.944224362378345e-01   +4.698537952088985e-01   +1.910488109144339e-01   +4.023988799204087e-01   +3.820076935788274e-01   +2.089189749766832e-01   +6.987556220506598e-01   +2.863251775742047e-01   +3.610900929893624e-01   +6.474877864365699e-01   +2.816402658181587e-01   +8.131039296556202e-01; +7.362656408655326e-01   +4.009023405057854e-01   +7.628657066047558e-01   +1.050436390162546e-02   +3.915242267375509e-01   +5.480153617084864e-01   +1.741479601107503e-01   +3.612064468677145e-01   +4.738563767708135e-01   +7.243201763409925e-01   +4.204385784161642e-01   +3.025234395334239e-01   +4.937198840319244e-01   +2.731466669594610e-01   +5.807840147896628e-01   -4.253296572396780e-02];
L2I_L1I_iGABA_netcon = [+3.267104532223578e-01   +5.668554448140063e-01   +5.457721854280243e-01   +9.918102445664244e-01   -2.052803829414578e-02   +2.753669119608033e-01   +4.626259808919261e-02   +4.556368652615322e-02; -1.146491516820582e-01   +2.632804457012718e-01   +4.771775545546817e-01   +6.319470471667730e-01   +3.262558986509592e-01   +5.778780298774179e-02   +1.237780850484677e-01   +1.813318051185533e-01; +2.004028584628486e-01   -6.760633380933359e-02   +6.416828569227344e-01   +5.602641185141448e-01   +3.871423863389740e-01   +6.373996475215570e-02   +2.835736340591554e-01   +7.736333902505679e-01; -1.695437025798811e-01   +4.972276922792815e-01   +2.668658645822954e-01   +5.166746664158015e-01   +4.307394193906935e-01   +3.097093966840175e-01   -5.727755876288197e-02   +4.510526654054975e-01; +7.528448474754184e-01   +4.962351726962978e-01   +3.880046583149349e-01   +3.997863479113242e-01   +3.583572718769891e-01   +6.177599529510206e-01   -2.990390534247914e-01   +5.700069560105272e-01; +2.572475240627766e-01   +2.823264917679894e-01   +2.961638600304569e-01   +6.688921673614409e-01   +5.395090148625623e-01   +4.566471483246138e-01   +6.205298224923537e-01   +4.239021920865976e-01; +1.336371798834613e-01   +3.462686037736227e-01   +6.391283529561125e-01   +8.494228346766822e-01   +3.531074501678772e-01   +4.593949849767922e-01   +2.916156206588482e-01   +2.239885179080617e-01; +7.164969677227065e-01   -2.076438242102769e-02   +5.445045830839562e-01   +1.432059168503621e-01   +4.461643906221635e-01   -1.138904567717657e-01   +3.619067368995119e-01   +6.845365878675022e-01; +8.954894263585736e-02   +2.419810656272537e-01   +3.250072057758128e-01   +3.638259919260950e-01   +9.081447384567450e-01   +4.036775313149195e-02   +3.209140687431727e-01   +3.213971368082596e-01; -7.286256908794245e-02   +6.167420772753855e-01   +5.013221750540342e-01   -3.506750900918879e-02   +4.325382825818490e-01   +3.793529410784786e-01   +6.112509576165142e-01   +5.363761356862946e-01; +4.223610627485339e-01   +2.869389130708978e-01   +2.652693442929672e-01   +4.010767147790757e-01   +7.180377002605562e-01   +2.806010000791314e-01   -1.352238976701035e-02   +6.263818321009926e-01; +3.559266435996303e-01   +4.554351039582905e-01   +8.081502184908789e-01   +1.286747131543119e-01   +4.498065265552150e-01   +2.059340708794512e-01   +3.455444145030644e-01   +9.018130653178776e-01; +3.391669237928651e-01   +1.785598882840422e-01   +3.839945830241226e-01   +7.115788025446116e-01   +2.389247629839859e-01   +5.826753544444452e-01   -1.617650677351276e-01   +5.835456429221669e-01; -7.454456961282199e-02   +5.006570039789878e-01   +5.061492979001611e-01   +5.446423878982301e-01   +3.854672457075661e-01   +1.873675028239468e-02   +1.448831172693709e-01   +3.544201270294515e-01; +2.047930222074513e-01   +4.060572180445281e-01   +4.678454249559179e-01   +2.418245256463548e-01   -8.520083932472586e-02   +5.992066914810672e-01   +5.611464846930218e-01   +5.299612104054017e-01; -8.486662704924725e-02   +1.770387944519569e-01   +2.683546248470219e-01   +8.251962771033519e-01   +1.624628191843430e-01   -5.373465192210565e-02   +8.920542672858776e-02   +4.078394202706651e-01];
L1I_L2I_iGABA_netcon = [-7.673338400259418e-02   +1.874897794262669e-01   +5.243768166160229e-01   +2.286364552286092e-01   +6.625138374238363e-01   +3.439597542897860e-01   +6.063514649584284e-01   +5.614246365542673e-01   +1.052010453312630e-01   +4.086952781173043e-01   +5.372572979934841e-01   +3.394885332491399e-01   +7.211502724341510e-01   +2.316361153209969e-01   +2.903992632044925e-02   +5.469454839353933e-01; +3.799846616643570e-01   +4.505781941005256e-01   +3.914841806092583e-01   +7.443605623564861e-01   -1.563326499748849e-01   +5.911303175413784e-02   +2.625053660708753e-01   +2.438056442821103e-01   +1.301243707971083e-01   +1.544911966679442e-01   +5.653754496146539e-01   +3.777096094754239e-01   +6.946967592863793e-01   +6.553248403679066e-01   +6.446378323264909e-01   +6.230222392040669e-01; -5.516328227652826e-02   +4.967744653258606e-01   +5.272184391922755e-01   +4.640180834067990e-01   +4.949067196863757e-01   +4.085358725940155e-01   +4.773967791148956e-01   +2.826044687650145e-01   +2.927513039625908e-01   +6.265563341778656e-01   +5.309444106846495e-01   +3.854858338601875e-01   +3.359786566287343e-01   +5.144342983491204e-01   +1.078165160072400e-01   +4.762486634028731e-02; +3.290120337438444e-01   +7.928391132542231e-01   +4.358227394776828e-01   +2.614652155739974e-01   +1.849802595230870e-01   +1.393656736790470e-01   +3.551719086673303e-01   -9.896843687971654e-03   +4.110792140257626e-01   +3.998615055802081e-01   +4.424574536232954e-01   +7.093411985284936e-01   +1.618342617202994e-01   +6.536643714521633e-01   +4.735325877223034e-01   +7.404907059111944e-01; +3.581075246331785e-01   +6.561311514583870e-01   +8.267691847820642e-01   +9.070923474635569e-02   +4.700417460278254e-01   +2.335083213100864e-01   +4.140071573850027e-01   +2.210883710668516e-01   -3.886828517063626e-02   +6.388159192273914e-01   -1.327168571532196e-01   +5.322357807883744e-01   -1.892404483536183e-01   -5.726130391618264e-02   +4.300317271973520e-02   +6.107700282291767e-01; -5.208898550649974e-03   +3.089716559635609e-01   +3.060740448230178e-01   +4.154111496244806e-01   +6.807440878122578e-01   +9.264770082026123e-02   +2.966811476495826e-01   +3.263470812944405e-01   +2.193394239711807e-01   +7.100267031063974e-01   +2.798240585372767e-01   +3.080709671679419e-01   +5.639986401207771e-01   +9.021333475426932e-02   +3.662962738600040e-01   +4.653673650214720e-01; +3.432115595177113e-01   +7.161164813379400e-01   +4.529377808957270e-01   +9.019093655883240e-01   -5.259024479241832e-02   +1.000000000000000e+00   -5.877924516599544e-02   +2.912481858525921e-01   +2.690882489512000e-01   -1.041697462254551e-01   +6.084263095339686e-01   +8.193450749093319e-01   +3.368398652349704e-01   +4.540008274251086e-01   +4.524166122019872e-01   +4.377848362456289e-01; +1.593882810878103e-01   +6.190592204289191e-01   +4.256904489631382e-01   +4.814939855454913e-01   -5.234631443119651e-02   +2.475551205928951e-01   +3.115877053480840e-01   +2.618500509848854e-01   +6.631971731693418e-01   +3.434711422003435e-01   +2.494915301832293e-01   +2.921163751920883e-01   +2.975033215820269e-01   +7.254412803494080e-01   +3.930745217785133e-01   +3.176126289641906e-01];
L2E_L1E_iAMPA_netcon = [+5.854485689316486e-01   -2.790513222709279e-01   +5.056206820603446e-03   +5.559259739724092e-01   +3.453689830728169e-01   +4.767451623731196e-01   +2.283589798364905e-01   +5.012550142779586e-01; +2.690702746990253e-01   +3.425492691499779e-01   +3.288036943955417e-01   +8.862648427380755e-01   +2.898764479148981e-01   -1.777287717780622e-01   +2.985848013601600e-01   +2.265911793215175e-01; +3.994148443653959e-01   +2.239683757208529e-01   +4.827499990242337e-01   +5.876768058373836e-01   +8.735713676291304e-02   +1.550104849601886e-01   +5.557455541744946e-02   +4.931649449754383e-01; +4.483998379367097e-02   +2.499999248586769e-01   +5.012209639894909e-01   -8.813531205413504e-02   +4.106373862663593e-01   +3.963848366355439e-01   -5.232840039191221e-02   +2.534404904385531e-01; +1.079935295178738e-01   +1.704140526471783e-01   +1.240889305037427e-01   +7.123524487426662e-01   +4.962014122327469e-01   +5.271266490894764e-01   +1.800030726573977e-01   +5.872332548172440e-01; +4.454629239394945e-01   +4.781103272827300e-01   +4.736630476231722e-02   +5.376090749119057e-01   +4.716759921273540e-02   +4.085974996318369e-01   +2.676059567262797e-02   -4.898563659131785e-02; +7.670517742377418e-01   +7.583587110128999e-02   +6.918122312267126e-02   +5.189079358751449e-01   +2.694465770346797e-01   +2.096881218434041e-01   +2.578800156838215e-01   +3.262760699391648e-01; +1.348779851677288e-01   +2.801294932179308e-01   +4.104143985375722e-01   +1.168914843745193e-01   +2.188414643067763e-02   -6.245453441900071e-02   -1.517447752085983e-02   +7.840390952552712e-02; +6.448443941858052e-01   +4.655270070334115e-01   +2.987626679242072e-01   +3.095772311986353e-01   +3.146884039308773e-01   +3.689743679818753e-01   -2.555288912884141e-02   +4.812252642183865e-01; -7.052613433853631e-03   +3.320249837624165e-01   +2.938130070340667e-01   +5.475125431616390e-02   +3.371527748247283e-01   +4.237430762954670e-01   +4.468210293527630e-01   +3.225314899714583e-02; +2.190438921044342e-01   +4.733578627448791e-01   +9.044899318457166e-01   +1.674382788997610e-01   +5.382920020334886e-01   -7.156607780252672e-02   +8.518147176954113e-01   +4.874369917280381e-01; +8.250180422584485e-01   +3.334100313316532e-01   +3.744652926990309e-01   +3.573083525849260e-01   +9.989522494528751e-02   +4.120767174786281e-01   +1.953420732844597e-01   +4.225068194388080e-01; +4.355100363581910e-01   +3.995560963004990e-01   +1.458131875532148e-01   +7.689546769740739e-01   +5.418707989259404e-01   -4.131852642274142e-02   +8.461268156068663e-02   +4.621187512625161e-01; +2.087127060623061e-01   +3.339513194634425e-01   +3.517422925056197e-01   +3.286631829079209e-01   +7.101140785562558e-02   +6.493010416427647e-01   +1.000000000000000e+00   +3.455962521558892e-01; +1.957735502304596e-01   +2.345390935555920e-01   +5.635737617912431e-01   +8.372238835882523e-01   +2.758594521856816e-01   +1.605843809449073e-01   +3.554357208406695e-01   +5.368219095206131e-01; +2.237011095148980e-01   +3.997771656347271e-01   +7.672895036690921e-04   +3.003756893524800e-01   +5.337914430747642e-02   -4.786647114200886e-02   +3.317124576243710e-01   -7.326791560849417e-02];
L1E_L2E_iAMPA_netcon = [+1.069854456387820e-01   -1.229999968387113e-01   +5.653412403503402e-01   +5.954081606116169e-01   +6.711096452699680e-01   +4.394090251504273e-01   +5.105399120629815e-01   +2.244313427081599e-01   +4.114246229131051e-01   +7.743380496583813e-01   +2.454698841166177e-01   +3.656755121370468e-01   +6.922825380950947e-01   +5.896005832478398e-01   +3.196506817921531e-01   +5.456309657574712e-01; +3.279311544667157e-01   +5.323587142678357e-01   +1.664376173792354e-01   +1.046112803954691e-01   +3.068220966214821e-01   +5.854314856178249e-01   -2.247994465577351e-02   +5.190247017988472e-01   +4.182935075582995e-01   +5.347795103067211e-01   +3.604873074883757e-01   +2.351547892455524e-01   +5.381672377482231e-01   -3.259921894713613e-02   +7.122078682070090e-01   -1.909877489318226e-01; +4.827019990498015e-01   +4.409169379674064e-01   +7.402156637003182e-01   -1.335442104646994e-01   +2.671563916440603e-01   +2.605440284172171e-02   +3.114403798658138e-01   +5.777175112722748e-01   +2.295779660761250e-01   +3.806526629422776e-01   +5.964381148484572e-01   +8.968285171916105e-01   +7.148319991027280e-01   +1.794447803471861e-01   +6.546707069814061e-01   +9.200806333506573e-01; +3.948838856368425e-01   +6.636952902354480e-01   -1.436226556262065e-01   +9.082628701540837e-02   +3.237664138578091e-01   +5.702156911491080e-01   +4.366942947237502e-01   -1.598224388620304e-01   +9.628383273770281e-01   +2.781777976529089e-01   +2.541800089016439e-01   -1.083670642732888e-02   +4.812549816120543e-01   +5.831914539051304e-01   +1.318370697616596e-01   -9.015648864610101e-02; +4.960980277659408e-01   +4.604903696553807e-01   +3.049509300396963e-01   +1.630401467687696e-01   +1.482194053162998e-01   +2.218704917812911e-01   +7.464299952664593e-01   +7.590959301330427e-01   -1.563583430623463e-01   +3.513409758015362e-01   +7.458572421073499e-02   -9.369990925654473e-03   -7.245276767615083e-02   +1.619067432261589e-01   +4.986153060799327e-01   +2.305069703906333e-01; +4.666097616950273e-01   +5.772164516024393e-01   +4.916875233188825e-01   +1.000000000000000e+00   -2.059378415488469e-01   +3.259937059758468e-01   +6.163936350109795e-02   +2.795958722111399e-01   +2.641544901433878e-01   -3.639962562493192e-02   +2.366491097901691e-01   +1.549603746215377e-01   +9.667002296065381e-01   +1.103889482595006e-01   +3.290737614689125e-01   +6.335837377705466e-01; +2.696507721686863e-01   +1.343392150956379e-01   -3.210200177562854e-03   +1.822461477343662e-02   +3.317814326618779e-01   +2.447030957904819e-01   +1.768455974351348e-01   +7.631847741315629e-01   +4.798513119908667e-01   +1.544905775872277e-01   +4.603401677223714e-01   +5.224471652742737e-02   +1.188602335339570e-01   +2.069840914020514e-02   -2.094836485137412e-01   +1.141383606722439e-01; +5.681809651150710e-01   -2.165689331669389e-02   +7.387768160810365e-01   -9.139020474855884e-02   +5.611036005444932e-01   +7.551216079052920e-01   +3.223101286235530e-01   -8.518862842211834e-03   +4.203811152513317e-01   +4.514354399168670e-01   +4.987754834599138e-01   +1.670450009469658e-01   +3.544736437236538e-03   +8.103331600356947e-01   +7.790662117921671e-01   +4.007637015840262e-01];
L2I_L2E_iAMPA_netcon = [-2.990574042419163e-02   +3.522854949491541e-01   +3.443788615683880e-01   +2.137898243422008e-01   +8.846623648484047e-01   +4.765095305080044e-01   +2.729940584357774e-01   +6.485214473261354e-01; +4.247629835563307e-01   +1.749763477538571e-01   +4.516621584993512e-02   +3.836450986515035e-01   +2.543642034095905e-01   +3.426883115558918e-01   +2.517026359116654e-01   +7.134902259850259e-01; +1.094805327982440e-01   +5.583034733858786e-01   -1.392733299989102e-01   -1.021499339082518e-01   +7.551101354984254e-01   -1.626501652125255e-01   -1.213806030618702e-01   +4.235516469224800e-01; +6.358206240532162e-01   +7.221448382796426e-01   +2.621521907186509e-01   +8.353599402803358e-01   +6.137582330582315e-01   +4.938180639803654e-01   +9.129924473542347e-02   -1.322935922945288e-01; -1.441143905178514e-01   +4.140763179416790e-01   +1.968917251615113e-01   +5.848599671837295e-01   +8.006726618635338e-01   +4.633731967377159e-01   +5.300078549396041e-01   +2.407852031636294e-01; +1.000000000000000e+00   +2.338100754119966e-01   +1.759496451623427e-01   +9.671976288924183e-02   +7.903358653233555e-02   +9.588026359566919e-01   +9.637002555085566e-02   +7.082586129972157e-02; +3.902481739680269e-01   +6.285467843295862e-01   +7.741666589350907e-01   +7.707224108904347e-01   +5.977266213030059e-01   -2.766441651094367e-01   +1.152847655775336e-01   +1.036781834411006e-01; +8.954361297113871e-01   +6.080010756504466e-01   -8.857961101625825e-02   -9.210680696028553e-03   +5.369877636643495e-01   +3.257359326480835e-01   +5.272543035733250e-01   +4.004419117932375e-01];
L2E_L2I_iGABA_netcon = [+3.119478685131278e-02   +2.512058128108318e-01   +1.673317433151423e-01   -1.279725401496875e-02   +7.488371330490741e-01   +8.021927311461877e-01   +2.929274277924874e-01   +5.025833952102144e-01; +7.248500700891031e-01   +7.107145032328968e-01   +1.264090865208453e-01   +1.339879501932338e-01   -1.898947644057960e-01   +8.887643060349260e-01   +4.952774409134896e-01   +3.367781317668175e-01; +9.760375501094652e-01   +3.284044239790614e-02   +8.428346345486301e-01   +2.021811030764534e-01   +7.624367620984753e-01   +1.000000000000000e+00   +9.776479345436312e-01   +2.952562352947087e-01; +1.238810712728285e-01   +1.366757909727148e-01   +7.697373838944672e-01   +6.802708141974203e-01   +6.964478763286465e-01   +6.657507829339857e-01   -4.807393055626149e-03   +6.680955218812750e-01; +2.889305964939216e-02   +5.985802155580932e-01   +8.605002909490334e-01   +1.347446665981457e-01   +4.443252489677160e-01   +1.773652956747913e-01   +6.718254783691406e-01   +1.630071882320318e-01; +8.408603380103548e-02   +6.947560865490260e-01   +5.752254500725201e-01   +3.200966031654781e-01   +2.710795808553905e-01   +9.411766667396260e-01   -5.059822622264099e-02   -9.963987731357786e-02; +4.883401289492648e-02   +6.684250212321261e-01   +4.512477934158778e-02   +9.993007615124828e-01   +1.704523260181501e-01   +8.275208577760081e-01   +7.335670620466965e-01   +6.153164624878427e-01; +9.520393016616739e-02   +1.047762555839872e-01   +6.414394741503687e-01   +5.828999329362724e-01   +4.937278445866283e-01   +3.101311328270499e-01   +6.340664502223072e-01   +6.406553472302786e-01];
L3E_L2E_iAMPA_netcon = [+2.467046757001258e-01   +1.000000000000000e+00   +3.566704322808756e-02   -3.548957161423086e-02   +7.921157019421441e-01   +4.291685921339725e-01   -1.147293145534534e-01   +6.729018327968580e-01   +5.090451236652311e-01   -4.112852840158886e-02   +2.348120565278407e-01   +6.073688552608962e-01; +3.134016262025200e-01   +2.860297307891888e-01   +2.339842781858059e-01   +2.019165993599077e-01   +1.887971043166586e-01   +4.272633705213799e-01   +2.271862182345236e-01   +6.035486367689333e-01   +3.575855405299099e-01   +4.030825685886432e-01   -8.839207743595730e-02   +8.122106381626670e-01; +4.468943952839592e-01   +6.006527252871867e-01   +3.758504264226382e-01   +4.066072868100018e-01   +5.722749905999688e-01   +2.927013460489132e-01   +5.602689690652061e-01   +1.317314046810619e-01   +5.157001726369962e-01   +3.686727049800351e-01   +2.124245926329532e-01   +9.879093656056244e-02; +7.748365265986545e-01   +1.407237825474378e-01   +7.924503823069984e-01   +3.606909143952597e-01   +6.368670481006353e-01   +4.046959223302668e-01   +1.268010684194777e-01   +2.252382736130906e-01   +3.685332057431636e-01   +3.833008160172761e-01   +3.392649935120468e-01   +6.658135571710405e-01; +3.165381337665864e-01   +1.569681202843757e-01   +3.992525641944181e-01   +3.660539385990376e-01   -1.606713756388244e-02   +5.238417750397784e-01   -4.825179244657390e-02   +6.018889327748288e-01   -1.082349856447351e-01   +8.296109566440306e-01   +7.160603189221496e-02   +5.323944079627837e-01; +1.008592876268304e-01   +3.419999918330899e-01   +2.273034712850618e-02   +1.914878192831704e-01   -1.529862113950852e-01   +2.740260531869270e-01   +1.868543171320996e-01   +8.353198826407155e-01   +4.996817963498726e-01   +7.107871810040198e-01   -4.428335238714183e-03   +3.560900477032158e-01; +2.825665953719340e-01   +4.436720822091456e-01   +1.335863442077568e-01   +8.309692061116010e-01   +2.777127272293188e-01   +5.756618143442130e-01   +6.731730467626245e-01   -2.908270330596441e-01   +9.159308414899557e-02   +6.633620930047397e-01   -2.775489875648454e-01   +3.445989190618554e-01; +6.829132264511299e-02   +3.165049360649690e-01   +6.291014753643862e-02   +4.866231859938717e-01   +8.390319622394803e-02   +2.245601779879553e-01   +2.194624253018664e-01   +2.663904120604685e-01   +1.848489370884817e-01   +6.633160863326012e-01   +5.537067394557184e-01   -2.995385395817894e-02];
L3I_L2I_iGABA_netcon = [+7.712722759835153e-01   +5.929680419730281e-01   +4.692675081830606e-01   +3.191615803049011e-01   +4.894467849850762e-01   +1.000000000000000e+00   +3.953250647971661e-01   +2.924024716154435e-01   +5.186007777755355e-01   -1.928008790866072e-01   +5.001393816745644e-01   +6.359232096715396e-01; +6.288764856641897e-01   +4.017369651603548e-01   -7.865084339810433e-02   +7.215951905413670e-01   +6.284047743381758e-01   -2.468160209974916e-01   -1.996106318649453e-01   +3.485015889581864e-01   +3.345193349473727e-01   -1.822572535966814e-01   -2.307661052491728e-01   +4.266336628640089e-01; +2.512397972500851e-01   +1.890037593165211e-01   +2.360714776748918e-01   -3.933079142464220e-02   +4.095161887641628e-01   +1.111599302939066e-01   +5.021217981849627e-01   +5.651114807192462e-01   +3.029834238950455e-01   +4.279880907100599e-01   +6.173616536461328e-01   +4.500910718770713e-01; +6.534241069225059e-01   +1.558086068228498e-01   +5.401881760802699e-01   +6.215974953807120e-01   +4.789127734228805e-02   +7.783172968488347e-01   +6.979027188530341e-01   +8.122369109224943e-01   +5.398581857457020e-01   +6.334428652173645e-01   +5.729987412961574e-01   +6.809972982660748e-01; -9.034259973825401e-02   +3.712543067630953e-01   -6.963170731154121e-02   +5.086628847375125e-01   +3.096797106933424e-01   +2.541632168532656e-01   -1.956578365525716e-02   +3.199427473897753e-01   +5.016628085457970e-01   +4.703420070530359e-01   +5.939019601621824e-01   +5.618008222427173e-02; +3.009600051561095e-01   -2.097677878228371e-01   +1.811960947577651e-01   +6.523887269506625e-01   +8.199375317026872e-01   +9.233262259623300e-01   +6.308278093513491e-01   -5.305685855319790e-02   +9.970895075993330e-02   +6.495667191606872e-01   +2.388032310155797e-01   +2.369541664464574e-01; +3.805094521782286e-01   +3.181017961910117e-01   +2.849340537041671e-01   +2.626964598914417e-01   +5.107652722011766e-01   +4.620072495594241e-01   +1.412020231848308e-01   +8.587952482576469e-02   +8.278376312108164e-01   +2.131615776289159e-01   +5.145535308738475e-01   +7.348924999757152e-01; +3.405336167886008e-01   +4.624551527130779e-01   +2.931812771768542e-01   +3.933450197415924e-01   +5.288583651172589e-01   +5.635915809066616e-01   +6.517303442054264e-01   +6.229670279493128e-01   +5.566947596532552e-01   +1.598801099500111e-01   +3.582071161641351e-01   -4.199125263276042e-01];
L2E_L3E_iAMPA_netcon = [+7.827383699003541e-01   -2.590738598576659e-01   +3.202752873951419e-01   +8.022278650951736e-02   +5.915713411903950e-01   +6.731054896243591e-01   +4.196588240276785e-01   +3.167905983834038e-01; +2.974570531183570e-01   +6.617034031651063e-01   +1.122738706642870e-02   +4.968999623889804e-01   +4.028821903924502e-01   +1.995703448360288e-01   -3.598352609878815e-02   +4.079829212474729e-01; +2.727594639898530e-01   +6.687675492988068e-01   +4.728740274034061e-01   +8.279409388128885e-01   +5.792515412108850e-01   +7.338280807736340e-01   +4.861357565891927e-01   +2.309144892777374e-01; +5.872519265659064e-01   +5.153399847643025e-01   +8.142434052328008e-01   +6.151973339141917e-01   +8.091437453650031e-01   -8.659530820687390e-02   +3.513693485752036e-01   +3.906762281171928e-01; +9.912804191489812e-01   +9.372092403032308e-01   +2.565984615856783e-01   +6.290246024458050e-02   +1.437143405659757e-01   +8.265455590192746e-01   -1.360290183209741e-01   +5.936935138309546e-01; +6.448194064199758e-01   +3.561750019697264e-01   +8.161814473383728e-01   +2.011093282834506e-01   +8.576108766504762e-01   +6.686913941018371e-01   +1.124696948086865e-01   +9.516242930695901e-01; +7.084641704531707e-01   +1.744276182250831e-01   +9.750917660437292e-02   +6.206549336038266e-01   +5.443399250921580e-01   +3.226840540241344e-01   +2.812867674091289e-01   +5.596196616428079e-01; +1.369727139410136e-01   +3.408005650656508e-01   +3.398944633952125e-01   +1.470764906261177e-01   +4.070609642134108e-01   -2.430011270416768e-01   +3.685012150666672e-01   +7.572955782819994e-01; +5.745674840259342e-01   +4.515138728537138e-01   +6.117886158070764e-01   +3.328438599348132e-01   -1.284515770303092e-01   +7.733292752613865e-01   +4.630057898995305e-01   +2.308315847361951e-01; +1.364458902137704e-01   +1.042901219732092e-01   +5.508348843065427e-01   +3.824258330929056e-01   +4.037558947926619e-01   +9.294448116636749e-01   +8.402238728071926e-01   +4.265700968748964e-01; +5.196213666775095e-01   -2.876451647573967e-01   +6.757000982811225e-01   +1.661340000426354e-01   +3.414050052016612e-01   +2.803604409053578e-01   +1.522782900880617e-01   +5.059276039092387e-01; +1.987476187102862e-01   +1.479269348539855e-01   +3.499114945731935e-01   +9.035592430089692e-02   +6.308142562881762e-01   +1.820404363717375e-01   +8.861551573678548e-01   +6.565152604321568e-01];
L2I_L3I_iGABA_netcon = [+3.933754955954052e-01   +2.794218403267533e-01   +5.153346584914094e-01   +6.065252056894345e-01   +3.752376779244706e-01   -9.866084909262807e-02   +3.421663593747410e-01   +5.494789041943720e-01; +2.489289654488258e-01   +4.621050492071316e-01   +4.626875113046908e-01   +8.681679063004540e-01   +2.572171683607586e-01   +7.262378617190534e-01   -2.124137081358266e-01   +5.450369701095075e-01; +7.310876613859164e-02   +7.579853381582357e-01   +5.197254267793597e-01   +2.745520124146253e-01   -3.517399846191342e-02   +2.764428339095432e-01   +4.758739623944832e-01   +2.070534798877753e-01; +3.695777761536618e-01   -3.359186274802592e-01   +5.634408211829315e-01   +6.218352444964505e-02   +1.265050096474585e-01   +2.026673402027555e-01   +4.300573140327262e-01   +7.013049639394596e-01; +4.407179559165964e-01   +5.905251676043082e-01   +2.336686961488538e-01   +2.918658888921150e-01   +3.528349370428611e-01   +8.090235178301577e-01   +1.409877271238377e-01   +1.132445469949593e-01; +1.506479486850831e-02   +9.824356670526455e-02   +3.425042559153338e-01   +1.470349236601708e-01   +5.039671583010359e-01   +6.751207110037309e-01   +8.673156517888335e-01   +2.081917253204529e-01; +1.000000000000000e+00   +2.029739933352668e-01   +6.257605654297090e-01   +6.069156451135364e-01   +3.628283803317582e-01   +1.855112571028802e-01   +7.899945508688009e-01   +5.073470501133834e-02; +5.557612224367283e-01   +3.988939839462748e-01   +7.833263369563083e-01   +5.209459566521554e-01   +7.706316274359315e-01   +7.187737408365497e-01   +3.947273415380314e-01   +2.739373108408685e-01; +2.772570108968432e-01   +6.496202527016127e-01   +6.294822588313552e-01   +5.231763174480237e-01   +7.232531416737856e-01   +3.191032123216286e-01   +9.891429289487246e-01   +6.620598591497834e-01; +9.304733446493256e-01   +3.816461264203487e-01   +7.352321515464525e-01   +3.582918159269329e-01   +2.020650152070044e-01   +3.964386511923550e-01   -1.653448996976173e-03   +3.069012357025880e-01; +4.914037849890305e-01   +6.496803101848464e-01   +1.467153916530882e-01   +4.217678104018874e-01   +3.377009988954646e-01   +5.161808826940841e-01   -3.321942053197453e-01   +2.124554657742363e-01; -1.602826060088312e-01   +4.433313210885858e-01   +1.758583623412027e-01   +2.072469119785241e-01   +5.976833276101591e-01   +1.884724640722085e-01   +1.615417075742202e-01   +5.925787122587758e-01];
L3I_L3E_iAMPA_netcon = [+2.581767966886712e-01   +6.753270215172232e-02   +6.143458875870320e-02   -1.471602171560948e-01   +3.216124397609469e-02   +3.871302335241688e-01   +1.403298716350601e-01   +2.559629874449305e-01   +2.770265849986911e-01   +7.411227355747385e-01   +5.373513905263602e-01   +4.483089851363926e-01; +6.289214450408644e-01   +2.405821918515386e-01   +6.189119641919776e-01   -1.244184486270256e-01   +4.460471698885872e-01   +5.199241591245226e-01   +4.888858410941514e-01   +1.442178485149170e-01   +5.275011520085693e-03   +1.480115916756912e-01   +5.177329022577191e-01   +3.869764979294892e-01; +6.288459986442057e-01   -8.991128098841925e-02   +4.551207853694703e-01   +5.055210673759328e-01   -7.198987434623128e-02   +4.264082952356137e-01   +6.929638704227844e-01   +2.981003797571978e-01   +2.508210692919371e-01   +4.118525129957096e-01   +3.969764581315146e-01   -7.739844256187543e-02; +8.766361655045711e-01   +2.294217195127747e-01   +8.327846362001016e-01   +7.199208124795894e-01   +6.940025774704942e-02   +6.214161985372929e-01   -4.586099095314370e-02   +4.932180824910751e-01   +4.411278324640957e-01   +4.685771347683748e-03   +7.316224148192655e-01   -1.804015628941366e-02; +7.463472851348467e-02   +4.396002334567861e-01   +1.702417578971960e-01   +4.281454390832419e-01   +6.593022325098720e-01   -7.834005785644013e-02   +2.383205042741578e-01   +6.500831907697502e-02   +5.997702775754775e-01   +3.546575710550083e-01   +3.871204523817086e-01   +4.900972244685839e-01; +3.819414455485819e-01   +1.945321703100416e-01   +1.068604281637998e-01   +4.910243134284063e-01   +1.460606177332910e-01   +2.028252561031333e-02   +1.270419954902118e-01   +7.734017083391059e-01   +2.863129296603539e-01   +3.113946704235090e-01   +4.750749201216238e-01   +1.834983120557667e-01; +1.705979041771805e-01   +7.478447237125107e-01   +7.275626363817893e-01   +3.217682288163838e-01   +3.901145063801063e-01   +1.686670498096344e-01   +2.037641458408114e-01   +3.234203219394576e-01   +2.060753686826969e-01   +4.593558368739513e-01   +2.726598521794993e-01   +5.910518367946586e-01; +2.955079884852598e-01   +6.372153976747510e-01   +2.417008277711508e-01   +6.779494547029000e-01   +6.040068277921453e-01   +3.657268058080201e-01   -1.175523507967663e-02   +2.728227244396300e-01   +7.362771089606880e-01   +6.332671821915979e-01   -1.102474888197740e-01   +5.940776530143288e-01; +3.208394499378672e-01   +7.839149678634162e-01   +8.095057664156295e-01   +5.157236636438592e-01   +2.919436610222587e-01   +6.024019267301969e-01   +3.312239343853621e-01   +6.115081913814442e-01   +2.314433517528566e-03   +3.376606925105051e-01   +5.208835774925825e-01   +5.272824536270204e-01; +6.261089030596891e-02   +4.308472268001228e-01   +3.681266887851475e-01   +5.800421116764368e-01   +4.541303164144121e-01   +5.004563612382606e-01   +4.717472888222266e-01   +2.473591240946249e-01   +2.370051879865830e-01   +5.714803849941364e-01   +3.857410094767603e-01   +7.000717250114259e-01; +6.834618164376890e-01   -2.952761477180796e-02   +7.118101302177333e-01   +8.294140833946066e-01   +2.889998630489397e-01   +3.452649511412209e-01   +1.213585774223086e-02   +7.148567595480374e-01   +7.903591220977054e-01   -9.986751441698798e-02   +6.127602337715693e-01   +7.121529067583839e-01; +4.142283831948363e-01   +5.399587789487783e-01   +1.699908779521172e-01   +1.640517783972838e-01   +3.396648013247294e-01   +3.335626710260882e-01   +9.256884748756734e-01   +2.395351315005016e-01   +3.633874418157531e-02   +1.264142979227308e-01   +2.275126501781271e-01   -1.931426409855750e-01];
L3E_L3I_iGABA_netcon = [+1.741754822599763e-01   -5.918586817361571e-02   +7.272835955903092e-01   -8.337945485447185e-03   +4.275877956690746e-02   +2.844834880994126e-01   +4.705625275997942e-01   +4.025131552152929e-01   +5.400969344144185e-02   +4.152302870480159e-01   +7.722953679857444e-02   +4.320706353063014e-01; +3.577470231517443e-01   +2.094723703738526e-01   +3.877130721441296e-01   +8.070798121810144e-01   +5.568780535475100e-01   +2.514627945025625e-01   -1.521445820333910e-02   +2.782460488112255e-01   +1.770564107016610e-01   +6.856730306236311e-01   +9.185113969641419e-01   +2.601205455793081e-01; +2.561227242950807e-01   +1.049173681885870e-01   +5.335342086045864e-01   +3.326667405773956e-01   +6.304681668336822e-01   +5.777660832642463e-01   +4.549084453149693e-01   +2.831316132361756e-01   +3.178421210253949e-01   +3.798896749902889e-01   +7.028949908611221e-01   +9.748789355133446e-01; +3.815158962685395e-01   +3.594224383590947e-01   +8.242101612150081e-01   +8.661929525483059e-02   +1.837329371196116e-01   +3.998458447786338e-01   +5.245951670518337e-01   +3.485345525081409e-01   +7.400614472489123e-02   +3.518657330761513e-01   +7.605106946026482e-01   +2.740354625510751e-01; +1.683725775782027e-01   +3.612325515423607e-01   +4.356730765158193e-01   +3.485875556507295e-01   +5.449498826773158e-01   +2.590837541738626e-01   +4.116019322304785e-01   +6.208349725953713e-01   +1.737832177481736e-01   +1.321692313747655e-01   -2.304978190259499e-01   +6.024843493149868e-01; +5.744599875130608e-01   +2.088426854215435e-01   -1.157495404102178e-01   +4.533623282452420e-01   +7.376242986695078e-01   +1.448519770095544e-01   +2.664745784604185e-01   +1.418252695150568e-02   +1.051731778488436e-01   +4.817801916583073e-01   +1.447566545301280e-01   +6.747198070217019e-01; +2.469709668445776e-01   +1.733386949927954e-01   +1.833854725782454e-01   +4.449467002215491e-01   +3.240877480438755e-01   -3.064750333717604e-02   +1.177450836920095e-01   +6.253634501199926e-01   +4.081832131803405e-01   +3.829765129743209e-01   +4.351073722223989e-01   +1.593558468315104e-01; +3.388851568654973e-01   +6.748791089470706e-02   +1.171517676474657e-01   +1.029351034585468e-01   +6.603374870532724e-01   +4.569957680385119e-01   +2.850419073450770e-01   +2.224894437108308e-01   +3.031105528834857e-01   -1.492988599812167e-01   +5.808746313069911e-01   +5.244507847004103e-01; +5.097802078472963e-01   +4.662756484993520e-02   +6.452679227530111e-02   +4.524825350028688e-01   -3.243887290325714e-02   +5.165123968207938e-01   +6.012716666828672e-01   +1.569480424658530e-01   +1.592497268776434e-01   +3.062857553080767e-01   +6.613757750308328e-01   +1.151777565074233e-01; -7.568493988447003e-02   +2.066842183157019e-01   +4.137697628316443e-01   +3.804916056868837e-01   +2.882443730855997e-01   +2.688535723208573e-01   +2.449774770340931e-01   +7.910514787666173e-01   +1.750949312103640e-01   +1.340144454165067e-01   +2.736558724645446e-01   +5.438532563626988e-01; +7.128469030416493e-01   +3.659737832672463e-01   +6.891478076068389e-01   +1.504081983551396e-01   +1.715796324623063e-01   +3.122913384834666e-01   -6.177778113867596e-02   +6.217251938277869e-01   +5.163321062194753e-01   +3.082333641978610e-01   +7.092683896117881e-01   +3.381125130319313e-01; +1.538525881102043e-01   +4.330365888807975e-01   +2.696479277876817e-01   +4.054327890943477e-01   +2.725158741513076e-01   +1.977619979488959e-01   +9.918038719288255e-01   +3.899725403714421e-01   +8.153955852493751e-01   +5.447544741560369e-01   +3.444853580767213e-01   +1.455220578416326e-01];
L2E_Input1_iAMPA_netcon = [+7.782159636295499e-01   +6.256593446439521e-01   +6.876322167806361e-01   +9.811047991479798e-01   +7.270098598730235e-01   +9.545513983057352e-01   +6.872615033828154e-01   +6.703921512378161e-01];
L2I_Input2_iAMPA_netcon = [+9.148470329965468e-01   +5.537430457965764e-01   +1.000000000000000e+00   +6.024390260774395e-01   +2.861686460747619e-01   +7.986518576325620e-01   +2.491816722488675e-01   +6.549997025505726e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
