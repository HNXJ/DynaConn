function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.788590771371681e-01   -8.075228674010853e-03   -4.901007510479172e-01   +6.079063775930398e-01   -4.478207770205568e-01   +3.058629101215937e-01   +8.835229167330148e-02   -1.151557678906380e-01   +1.752591012051625e-01   -1.775850221858728e-01   +8.065969712858468e-01   +6.350150363974028e-01   -5.051984501610352e-01   +1.842221926319342e-01   +3.136079676912880e-01   +9.273754008661836e-01; -3.453732737680910e-02   -5.870532389501676e-01   -4.202681824871191e-01   +2.493322877255937e-01   +3.866788947621026e-01   -2.050591604469845e-01   -3.264839564609234e-02   -4.194863943206700e-01   -1.313801303736682e-01   -1.032107732480943e-01   +1.807582538497692e-01   +5.578236595667342e-01   -5.114096936994598e-01   +1.929231847072378e-01   +6.118980501686982e-01   +3.399967955279082e-02; +3.057213226337994e-01   -6.101453763963133e-01   +5.401175253988780e-01   +9.219492137231071e-02   -1.072799668696181e-01   +6.555019068007242e-01   +2.497541151480245e-01   +3.705386533611649e-01   +1.203109621591143e-01   +8.780345901299055e-01   +3.121569484960266e-01   +3.365787659015681e-01   -2.141004611832328e-01   -3.127173890048327e-01   -1.229911520629081e-01   +3.594007772221175e-01; -4.831807369198947e-02   +1.795863977847631e-01   +4.012270914018075e-01   +7.030189076242309e-01   -6.875431466845595e-02   +2.725260896137758e-01   +7.656781205540019e-01   -3.576782585080963e-01   +4.595417644523797e-01   +3.116992275560896e-01   +1.388716574609327e-01   -1.170998538672803e-01   +8.475825754460392e-01   -5.270511243009150e-02   +6.539998697663510e-02   +3.990792769778651e-01; +2.013201479646305e-01   +2.502233777363576e-01   +6.953170413492132e-01   +1.067670049540836e-01   +4.243074365001858e-01   -4.364757301607222e-01   +5.731263403280307e-01   +7.814431639605789e-01   +3.614545580792594e-01   +4.012889729461053e-01   +5.057952712155076e-01   -2.773173619263598e-02   +1.483444124176207e-01   -3.337694808064287e-01   +5.359133130582161e-01   +8.284877337263468e-01; +9.364093524256730e-01   +4.961264111628148e-01   +4.433340574182597e-01   +9.157149219590291e-02   +3.706188828953008e-01   +1.578237786575322e-01   +2.886797398856555e-01   -3.484044399473227e-01   +5.358972915512077e-01   +3.940870879294037e-01   -1.231514650366636e-01   -3.236545359484629e-02   +6.411204723552429e-01   +4.423419028339309e-02   -3.735205551505957e-01   +1.843403960338551e-01; +1.788178841064670e-01   -1.079874156013242e-01   +2.940947298736138e-01   +1.699338602260351e-01   +6.259561288217337e-01   -1.376927509320030e-01   -1.128126136542997e-02   +2.948868797117909e-01   +8.107195191553065e-02   +5.142525480190160e-01   +3.713824889391907e-01   -5.400774803647745e-02   -7.664483426107721e-03   -1.298364603046583e-01   +4.752671450244019e-01   -2.726782121073046e-01; +2.269249680390807e-01   +4.500920739481197e-01   +6.151130381885320e-01   +6.046530557791858e-01   +1.009440852962892e-02   -2.028996256892336e-02   +2.215476492570990e-01   +3.345265849396580e-01   -2.619801286504170e-01   +6.407390094050082e-01   +6.384952383518322e-01   +3.870159979474864e-01   +8.109804757287141e-01   +3.752904290979751e-01   -1.589371965118028e-02   +1.077100369653445e-02; +3.670214887171041e-01   +5.838066825360118e-01   +1.276254061649899e-01   +5.088834662096604e-01   -3.947780968069844e-02   +2.997934770729277e-01   +2.213277767827402e-01   +2.976575893603268e-01   +5.787776986905498e-01   +1.118511532715974e-01   +6.394603512271348e-01   +1.131172148404515e-01   +3.738963495182029e-01   -3.773503606964310e-01   -2.498274111358248e-01   +9.016578473161285e-01; -6.417568326130494e-01   +6.076152735396811e-02   +1.911268252235601e-01   +8.910935600959115e-01   +1.850160906177264e-01   -3.681141617511192e-01   +8.061648215004171e-01   +2.421921050050970e-01   +1.517640250325043e-01   +3.754381610196192e-01   -1.747285777606988e-01   +4.401762662706213e-01   -1.926960382341485e-01   +6.991961864697027e-01   +2.336011703783840e-01   -7.885709139873956e-02; +7.710856069268313e-01   -4.470348229435315e-01   +4.584013966057546e-01   +1.218086409530419e-01   +3.242971729252395e-01   +7.592572433942142e-03   -2.614681495549774e-01   -2.292957983273788e-01   -3.669329325663769e-01   +5.462894578804085e-01   +7.065665247806985e-01   -5.223179731628728e-01   +2.200075082795673e-01   -3.721012556718309e-02   -2.750103738786717e-01   -4.806542322207846e-01; +5.557936753504539e-01   -2.970300175220588e-01   +3.949986142365129e-01   +2.256255878903129e-01   +4.665029034137745e-01   +5.047650964734856e-01   -1.624020180216800e-01   -3.063409072273818e-01   +4.937394152692881e-01   +5.356034315295821e-01   -2.452709976338686e-01   -6.767305896216487e-02   +5.714357286732513e-01   +2.883469731330359e-01   -1.602886646491964e-01   +1.029112823432690e-01; +1.214752725122346e-01   -8.793623068027412e-02   -8.961870102328859e-02   +4.859576044502583e-02   -5.746864421141118e-01   +4.631677320925032e-01   +7.648456509403487e-01   +4.381577785043039e-01   +2.474669968244084e-01   +1.686085544741732e-01   +5.953984577902351e-02   +3.578958118008794e-01   +1.000000000000000e+00   -1.109868064881771e-01   +4.526028079423811e-01   +7.244614806067824e-02; +1.598314162731435e-01   +8.305629859861143e-01   +7.250084471343260e-03   +2.861783904770682e-01   +4.410397630179586e-01   +4.484407425117631e-01   -3.501002823633474e-03   +8.448657317318258e-01   +3.132469107187633e-01   +6.739136846202639e-01   +5.883644897418782e-01   +1.925428282357913e-01   +7.680060745799796e-01   +4.689170012013843e-01   +3.388176633209628e-01   -4.675940199281662e-01; -1.562298907494912e-01   +2.407731464444805e-01   +1.107869312896420e-01   -4.613106469339930e-01   -1.514316703168032e-01   +2.982762529063178e-01   -1.886888572545083e-03   -1.835488094347947e-02   +5.290651367433318e-01   +4.630267504601849e-01   +5.396853408664428e-01   +6.201128928589578e-04   +7.508964621679066e-01   -2.821964333730668e-01   -2.059613594936063e-01   +6.593272740590643e-01; -3.157360039063069e-01   -2.958393113925676e-01   +2.202879150766346e-01   -2.434688455131416e-02   +1.225279340141450e-01   -2.923287428542642e-02   +2.041693803270429e-03   +4.678418977578805e-01   +7.843999203378155e-01   +8.033235688409585e-02   +4.969795942992279e-01   -6.555779279993192e-02   +3.263766087876968e-01   +7.460509547217683e-01   +8.964617343732545e-03   -5.053234059763602e-01];
L1E_L1I_iGABA_netcon = [+2.800268074197119e-01   +3.734086255932378e-01   +2.111732401722771e-01   -6.774007812892700e-02   +2.574581620701170e-01   -9.041985134436380e-02   -1.098408735550679e-01   +6.575899638318651e-01   +2.605697983658365e-01   -1.192911421088349e-01   -8.955837926974383e-02   +5.928479491143280e-01   +1.685252461505378e-01   +3.294339703348065e-01   -6.239494519880988e-01   -2.050017388791071e-01; -3.825868150182459e-01   -2.174541432738587e-02   -6.696839604678845e-02   -8.982542194117873e-02   +1.767147668672879e-01   +7.291153118347343e-01   -3.801053956093357e-01   -1.509051841112765e-01   +1.505033230957391e-01   +3.219891673694433e-01   +1.869083090151229e-01   -2.318528939038297e-01   +3.311913816530818e-01   -1.976261876618040e-02   +3.372625311935853e-01   +7.626842766222757e-01; -4.106392524176370e-01   -9.630852318928128e-02   -1.022860829701488e-01   -2.303497249773652e-01   +8.273707672521738e-01   +6.150171174400576e-01   +6.300223370103056e-02   +6.364129315477759e-01   +5.018805596238526e-01   -5.866021561506627e-01   +5.056279776722544e-01   +3.951604490662360e-01   +2.230405836382365e-01   +3.514344090346054e-02   +4.496480688858777e-01   +6.737234102187559e-01; +7.695982495756014e-01   +2.057625621729935e-01   -5.446744816329887e-01   +7.312944572931676e-02   +1.550289580983720e-01   -6.725772662083751e-03   +2.837105599151624e-01   +4.668113485970680e-02   +6.410089717507673e-01   -2.712108281100425e-01   -1.418350867264979e-01   +3.063593914948265e-01   +4.964422287901659e-01   -3.236038156440447e-01   +4.787999655988996e-01   +7.608934648698346e-02; +8.459136602828657e-01   +1.077438478405284e-01   +4.968675516998530e-01   -3.469602874210231e-01   +1.106888435931415e-01   -3.636563212443055e-01   +3.367413841772738e-01   +9.582517272401628e-02   -3.758355869654072e-01   +4.576985558643640e-01   +5.902047095598474e-01   +8.975286335276204e-02   +5.845392367899710e-01   +2.393624894927124e-01   +1.936086852140861e-01   +6.733518224172969e-01; +3.923576391923119e-01   +1.073353785792051e-01   +2.480281038451822e-02   +4.374044952389478e-01   -3.157971687884732e-01   +5.408433849261048e-01   +2.955017411644337e-01   +2.815585795087452e-01   +3.138588634951737e-01   +4.064021117011827e-01   +4.039405802871046e-01   +7.354296115522750e-01   -1.156608172400824e-01   -4.060872406001818e-01   +4.009234791988481e-01   -1.866151171310535e-01; +1.078060545830652e-01   +1.597300884732956e-02   +1.415178668818378e-01   -1.097645985392132e-01   +7.070394087535145e-01   -1.331204929615140e-01   +1.218964914489411e-01   +6.585945923439792e-01   -3.656027933629342e-01   +1.896778718842538e-01   -3.359444387019193e-01   +6.753631107771264e-01   -4.625324645472429e-02   -2.492189981040892e-01   +4.741319990458136e-01   +2.870481341756739e-01; -1.866479817394743e-01   -3.946985392482990e-01   -2.034122066719795e-01   -1.616317149929228e-01   +5.261015804060025e-01   +1.781568890951485e-01   -5.266988273088227e-01   +6.196544033908991e-01   -1.524568520467076e-01   -1.782356889777820e-01   +1.305658703139441e-01   +3.514021806716455e-01   +2.542695016296426e-01   +2.619652276080757e-01   +1.452753831578927e-01   +6.305168449718815e-01; -2.039782751947481e-01   -4.690477851657341e-01   -2.820086225277352e-01   -2.957539521716407e-01   +4.103916767606447e-01   +5.373574866581854e-01   +5.162903047206113e-01   -2.614256242166814e-01   +4.789326336836800e-01   +2.629265142877960e-01   +8.123623424910583e-01   +2.993647807677489e-01   +1.163213237161394e-02   -7.160521651278219e-02   -7.614314449898253e-02   -1.372908692138064e-01; +6.001260998513207e-02   +1.447132469722707e-01   +3.656519536810121e-01   +2.906244815646775e-01   +1.493181091249023e-01   +2.668284143261730e-02   +4.847696027577402e-01   +2.909703610072114e-01   +7.631332320887404e-01   +5.657282136218638e-01   +7.871144789799323e-02   +4.838255202049588e-01   -1.572136944159696e-03   +2.307187443095013e-01   -6.447026853552472e-02   +4.865544663746385e-02; -7.738489263096608e-02   +5.707036986225533e-02   -9.667592298047800e-02   +1.879979011727305e-01   +4.038160237716946e-02   +5.636580692861133e-03   -5.385513128466159e-01   +9.033408801217718e-02   +8.314307755853657e-01   +1.222943949588975e-01   +4.773728834264073e-02   +6.660100228998455e-01   +5.223513041295307e-02   +3.078616618093278e-01   +1.075667356017893e-01   +2.117809795082312e-01; -4.503614173763899e-01   -6.123690036333489e-02   +5.073027989195544e-02   +5.502641629561788e-02   +6.147238473733682e-01   -7.916121149579444e-03   -1.546827009677502e-01   +1.406534316662510e-01   -2.933406898266022e-01   +1.027756242735166e-01   +4.347173228017084e-02   +2.703914770710649e-01   -3.415056144857490e-01   +3.963037608784476e-01   +3.387054266319067e-01   +8.927841671921817e-01; +1.060230476635234e-01   +1.367010437205372e-01   +1.355686131248149e-01   +5.322416580142855e-01   +3.368647464250758e-01   -2.001531416655126e-01   -8.427974849673844e-02   +1.082991054290126e-01   -3.879612869230206e-01   +5.062359740760222e-02   -2.077611195974438e-01   +3.943767204906785e-02   +5.829132782428502e-01   +6.935481018362180e-02   +6.898572091767398e-02   +5.417926684576928e-01; +4.268304080294402e-01   +2.086211654232089e-01   +3.185531027782643e-01   -9.477891977754015e-02   +8.608142781682596e-02   +1.000000000000000e+00   -3.524956903981687e-01   +3.692849980577088e-01   -1.120309025628782e-01   -5.225700661575211e-02   +1.986118308831989e-01   +6.671477237080384e-01   +2.709759728668281e-01   -1.320285040509177e-02   -4.401837707903240e-01   -1.364009554740324e-01; +2.708892222710509e-01   +6.840606564838582e-01   +6.066480440606871e-01   +6.335731426790701e-01   -5.926380592658564e-01   +7.548743380348351e-01   -1.295006140331001e-02   -3.271874769334387e-01   -8.272749496621355e-03   +4.645340788827735e-01   +5.452740788487591e-02   +1.378182630325123e-01   -2.399327017144623e-01   +2.556180576728509e-02   +1.884756827783957e-01   -2.691728938625786e-02; +6.672038987427398e-01   +6.698275798078659e-01   -4.182053352801404e-01   +5.236538700868644e-01   +2.728527276890176e-01   +4.400481840918133e-01   -4.447762695805866e-01   +2.458539437868033e-01   +1.188857400193323e-01   -1.092520275832619e-01   +3.999140127077571e-01   +7.190055521726495e-02   +9.540377037799639e-01   +7.855805096680636e-01   -1.614018183170290e-01   +1.901689790234849e-01];
L2I_L1I_iGABA_netcon = [-8.373817601658308e-02   +2.955967481659068e-01   +4.423768366764532e-01   +3.211463647354301e-01   +7.771393522296640e-01   +4.254934409102513e-01   +3.432943989610502e-01   +3.285610766426457e-01; +3.794710020392157e-01   -1.788301934195552e-01   +7.132908880669537e-01   -2.086218493939014e-01   +7.649264685140728e-01   +6.010764329765439e-01   +2.344112794549706e-02   -2.288680492448223e-02; +8.791843660052888e-01   +4.027535016896748e-01   -1.308586256212690e-01   +4.199546147203747e-01   -4.142304944069647e-01   -2.479121511993199e-01   +1.934754666469821e-01   +4.201549994413469e-01; +9.559159584493102e-02   -9.941075012344347e-03   +4.044605615949298e-01   +2.388420037464392e-01   +2.735606069629138e-01   +1.363280413850521e-01   +3.165485621866289e-01   -1.040828647827912e-02; -4.154768014931506e-02   -4.259412223482593e-02   +1.915088426097027e-01   +5.122466410681493e-01   -2.080404905565576e-01   +4.859725403135365e-01   +1.617170969708745e-01   -4.311388579141857e-01; +2.580351078303124e-01   +2.140146419842413e-01   +3.624887390070085e-01   +3.686899307538374e-01   +4.869005877258457e-01   +7.782042937880591e-01   -1.078305938754269e-01   -3.449295740592175e-01; -3.805865042734460e-01   +1.722870032664585e-01   -2.495327863117675e-02   +3.964321716588353e-01   +5.587775254607772e-01   +7.416783648447237e-01   +2.564167215774997e-01   +9.366428383986231e-01; +1.341432453186840e-01   -4.456162860135826e-01   +5.851308698263444e-01   +6.301656051668457e-01   +4.839463865648009e-01   +3.407558499819636e-01   +7.317857319827616e-01   -8.630353013503302e-02; -6.921079573203948e-02   +1.313250931443106e-01   +3.011528289071898e-01   -6.529044915751433e-03   +8.548759689688264e-01   -3.434716111656211e-02   -3.339077252048234e-02   +1.000000000000000e+00; +1.094573157620258e-01   +7.199239060328368e-01   +2.986312375815135e-01   +1.319112000554237e-01   +9.405375629291819e-02   +2.036081245874673e-02   +2.423302375148829e-01   +3.654890026970470e-01; +1.880281463104830e-01   +5.100510225514978e-01   +3.774042846459779e-01   +3.318354819957615e-01   -1.354253965659665e-01   +7.467694762682782e-01   +2.741130180117385e-01   +1.949859831803795e-02; -1.584874174831667e-02   +1.866714949167249e-01   +4.936282521550750e-01   -4.814353143190156e-02   -3.248031317630717e-01   +2.468540055349269e-01   -1.090485408438432e-01   +6.455161448154894e-01; +4.941699520788793e-01   +5.016688229105259e-01   +3.298324291810215e-01   -2.638090746445228e-01   -5.099878254451422e-01   -7.265205034799910e-02   +1.545905384816493e-01   +5.311226526672655e-01; -6.186962656560761e-02   +2.980438542544656e-01   +2.923340374990309e-01   +2.874837806399640e-01   +7.079271078639727e-01   -7.515647081755768e-02   -2.522723964459757e-01   +1.118257014124435e-01; +9.880162246583944e-01   +6.812327258218563e-01   -1.188007420804758e-01   +3.005311591295428e-02   +4.717715120452373e-01   -4.308290152909913e-01   +1.693195294954035e-01   +4.136090367677428e-01; -3.461209691778842e-01   +7.370087460770078e-01   +5.262876147243929e-01   -3.462305941053839e-01   +7.178690588834392e-01   -1.162777350548907e-02   -3.030958794230774e-02   +3.009697556220410e-01];
L1I_L2I_iGABA_netcon = [+6.793605870857526e-01   -2.835274454074336e-01   -1.615017679890419e-01   -3.728686604975018e-02   -1.998896292717378e-01   +8.020037028711407e-04   -5.545309305705409e-02   -3.449989295307874e-01   +5.886776901233244e-01   +8.626372556750835e-01   +2.269935578838408e-01   +3.427768911349258e-01   +3.475213397316097e-01   +8.315030285336776e-01   +2.162440251907360e-01   +9.097883183649408e-01; +7.690596640583099e-02   +6.607989136956914e-01   +5.436570952584145e-01   +7.007553232829268e-01   -3.593610149640067e-01   +2.260589405844739e-01   +5.868056372073505e-01   +1.785163416115183e-01   -5.652971724489718e-01   -1.056665597748477e-01   +6.796779957133208e-01   -2.548871007648076e-01   -6.922968478255985e-02   +3.794245355667533e-01   +1.029584947283582e-01   -2.750191152758433e-01; -8.238369234305813e-02   +2.406574237433557e-01   +2.130424572605225e-01   +6.436359394021960e-01   +3.430972428489084e-01   +1.514089818497273e-01   -3.097544641412135e-01   +2.482232243079278e-01   +1.180455579858273e-01   +2.998109132846000e-01   -4.424478620954972e-02   +5.058651893811718e-01   +9.933612995679111e-02   -4.108575242974647e-01   -5.507260357738533e-01   +4.933641011527889e-01; +4.362474656210503e-01   +2.813983588922691e-01   -3.774082678528233e-01   +2.641149929795712e-02   +1.769118253351065e-01   +1.359317398173691e-01   -1.734710012353102e-02   +3.594574047899693e-01   -2.534908622701770e-02   +2.294926059014887e-01   -1.845295414498273e-01   +7.135808780894645e-02   +2.147252531722700e-01   +4.711510731862472e-01   +5.497629719836725e-01   -9.182714491875150e-02; -7.206489832604950e-01   +2.009858565643870e-01   -2.947070726342635e-01   +9.780010794706094e-01   +8.611294506785832e-01   -1.720627201992425e-01   +3.191306419248101e-01   +2.196643529912004e-01   +2.966273932711906e-01   +5.810374056370087e-01   -1.214636835510989e-01   +6.295022321199728e-01   -3.585411462401201e-01   +1.015676462623269e-01   +1.117208185255330e-01   +5.660787586335306e-02; +6.689228456850368e-01   +1.191089648363225e-01   +1.292461424968217e-01   +3.816157820907620e-01   +2.005156911537752e-01   +4.067354417895389e-02   +4.233755268007328e-01   -4.958220673168778e-01   +1.603315997823874e-01   -1.801694728589960e-01   -4.624550429625992e-02   +5.248933557018394e-01   +6.959984336860606e-01   +2.545054077582356e-01   -5.535268665801523e-01   +1.733839304060273e-01; +5.262272374971988e-02   +5.726048206876464e-01   -3.609618371791714e-01   +4.180750605212556e-02   -3.734015093207278e-02   +2.300112884094623e-01   +7.424953670587900e-01   +2.153351455056552e-01   +5.672869104070962e-01   -1.067821043979462e-01   +2.686802761621976e-01   -6.890338937902722e-02   -4.315074636031448e-01   +3.453671681659061e-01   +3.851888602804346e-01   -9.906554851014218e-02; +1.015780124828173e-01   +5.066857437527166e-01   +2.346989159795748e-01   +4.564129135116736e-01   -5.314344285577767e-01   +1.488355189386532e-01   +8.527629820785987e-01   +1.911059114277691e-01   +5.410113901572848e-01   +1.000000000000000e+00   -3.689446365495559e-01   +6.586957877469419e-01   +5.021679737375676e-01   +3.035486742580562e-01   -2.220984668435200e-01   +2.826400432919585e-02];
L2E_L1E_iAMPA_netcon = [-2.025197636068079e-02   +3.593339377432931e-01   -1.913201696665499e-01   +4.030755004921144e-01   +2.693013434741195e-01   +6.208097128747375e-01   -5.600362943033396e-02   -1.603041690545011e-03; -1.013156738054426e-01   +5.352755650799981e-01   +3.001031470746147e-01   -6.389925477577314e-03   +6.283660061806722e-01   +1.089690877839191e-01   +7.165406747825707e-01   -2.787048533393540e-01; +2.580401814700412e-01   +9.326082127832511e-02   +4.439361534538623e-01   +5.525597067923818e-02   +4.079377079421029e-01   +1.900003068689418e-01   -9.510459069772215e-03   -2.251794069608910e-01; +1.144911724301702e-01   -8.192880978722696e-02   +5.519987284846297e-01   +4.485306502538824e-01   -1.053173189328447e-01   +3.339259117503932e-01   -1.285574309112737e-01   +1.919059387138075e-01; +1.311926901398309e-01   +3.383961080662761e-01   +3.608130260587510e-01   -5.122482818245529e-02   +7.087019453207835e-01   -1.587088890439606e-02   +4.064800772023660e-02   +2.935520138605402e-01; +8.447676446549581e-01   +4.391449477324948e-01   +5.235623129945832e-02   +3.093521298153805e-01   +1.522921132349818e-01   -1.922856841159217e-01   +1.363633812018658e-01   -4.682267931007392e-01; +5.602176999322187e-01   +4.324714699564228e-01   -4.073902876897909e-01   -2.311123293694988e-02   +7.524368304924407e-02   +5.917153621129995e-01   -4.188329928027620e-01   +2.384068185940202e-01; -3.270660679489962e-01   -8.559163754251976e-02   +5.405249462152277e-01   -1.597588304967023e-01   +6.623519222001192e-02   +3.868864987518036e-01   -1.717426903393995e-01   -4.515168081093795e-01; +2.335205322449249e-01   +5.662063553887686e-02   +4.001464942921415e-02   +1.742960541889313e-01   +3.858659279498241e-01   +1.150837849340375e-01   -1.726198436355230e-01   +2.665817159744821e-01; +3.647834271905366e-01   -2.256363063015862e-01   +3.439399240184099e-01   +3.279084787174311e-01   +3.738702058832755e-02   +3.678678521748615e-01   +5.453597808272405e-01   +1.000000000000000e+00; +1.557621346374170e-01   +3.046988483280410e-01   +7.292674849588683e-03   +3.410125635687429e-01   -3.288862049458190e-01   -3.703646655005722e-02   -3.168901441581685e-02   -1.195242270843295e-01; +3.217339492823433e-01   -2.594245047792718e-01   +5.361861058950008e-01   -1.273150197162858e-01   +3.252953411571817e-02   -3.212889105647718e-01   -3.257769938232564e-01   -1.235396248115164e-01; +1.335488689336847e-01   -3.591671718254337e-01   -1.289765571551462e-02   +1.365955240463651e-01   -1.783797142638451e-01   -1.655567135156934e-01   -2.514565675865742e-02   -2.721425979573996e-01; +4.267644059095976e-01   +3.995440499348777e-01   -2.505566980362579e-01   +2.110539494643353e-01   -3.337788990095709e-02   -3.845981807622226e-02   +4.101383602675927e-01   -1.834920237477613e-01; +1.779193833637398e-01   -7.641611841408572e-02   +2.873928088832600e-01   +4.613064653407903e-01   +1.675643030580439e-01   +3.833733423303982e-01   -2.583634557635179e-01   +2.877159375655460e-01; +4.817582140529671e-01   -5.798964950207539e-01   -1.005206826264531e-01   -1.010448541889818e-01   -2.325815481232227e-02   +2.497849320253056e-01   -7.434000321733707e-02   +1.052006381061914e-02];
L1E_L2E_iAMPA_netcon = [+2.798312405542564e-01   +4.191110693101375e-01   +1.000000000000000e+00   -3.818022084369918e-02   +8.862730112717675e-02   +6.723532969663517e-01   +2.327280755016843e-02   +7.379043425622657e-01   +5.293420267372501e-01   +1.902450501410089e-01   +6.665399975499124e-01   -3.763564003635295e-02   +4.276309362737457e-01   +2.136417759731939e-01   +8.013566185001747e-02   +5.872284262226966e-01; +4.139699960510210e-01   +5.449073163708786e-01   +4.886008799305525e-01   +3.548823875174207e-01   +1.868694825169017e-01   -1.173135356947146e-01   +4.999747506801940e-01   +3.038358573265382e-01   +5.650499271210553e-02   -2.067922582097976e-01   +8.633011629374306e-02   +9.296944006631219e-01   -1.630042746671091e-01   +4.257785726412376e-01   +3.658775112355699e-01   +6.840437468676713e-01; +3.484683382254767e-02   +4.087226062710737e-01   +7.784308856999985e-01   +2.563560009341887e-01   -5.255163800554161e-01   +2.827299440171795e-01   +3.976805840922543e-01   +3.877534094130257e-01   -8.414260475261523e-03   -3.189519680116129e-01   +6.421287729759443e-01   -5.148182953095864e-01   +2.826734015980972e-01   +2.442621957286123e-01   -2.092616747125519e-01   +1.615351057869447e-01; +3.960250804784165e-02   -2.179243341302041e-01   +2.535815601824808e-01   +2.234546339476427e-01   -6.387520760556020e-01   +7.156083442454541e-01   -9.158598540203840e-02   -2.081444620044539e-01   -2.000535287369304e-01   +1.630855143545018e-01   +2.939618328789589e-01   +1.269367720338939e-01   +9.871696479407965e-01   +6.194261584172914e-01   +2.103301189007350e-01   +1.459666459032878e-01; +2.788191615519449e-01   +2.555104973812697e-02   -1.713103846086050e-01   +9.330441129426718e-02   -1.535632389204233e-01   +6.074489895814374e-01   -1.201665822568294e-01   +4.607534313657612e-01   -3.597407570443014e-02   +1.901078784671134e-01   -4.087315826629828e-01   +4.413538380876893e-02   -5.995567630801215e-02   +6.698001260944922e-02   +3.922360371943408e-02   -2.654651402445943e-01; +6.843226262267145e-01   -1.923075269652618e-01   +2.809222465860253e-01   +6.280945646641178e-01   -4.135071695914002e-01   +6.039990221478247e-01   +1.901493090610687e-01   +7.026723714746490e-01   -2.432809150740677e-01   +1.550758183698108e-01   +6.982182422430881e-01   +2.268757639727491e-01   +4.049503992998838e-01   -4.716163141456077e-01   +4.237807838553823e-01   -2.092962755325197e-01; -5.363230192243507e-01   +8.062243735096444e-02   +4.674106586453050e-01   +2.274632816471738e-02   +5.430059729084786e-01   +2.842456097063229e-01   +8.838117354829451e-01   +2.140931775570942e-01   +2.692063469357219e-01   -7.032798530818034e-02   +5.564818466122996e-01   +2.983739216214067e-01   +8.336471370040076e-01   +2.636439898985550e-01   +5.027932640920314e-01   +9.302284743646336e-01; +7.068849042169582e-01   +4.313371634510141e-02   +1.111391323132987e-02   +8.533253064089923e-01   +1.630860789509936e-01   +1.729274332356138e-01   +1.178571589729674e-01   +6.184616860423735e-01   -7.345739144119054e-03   -1.083787390332403e-01   -4.981550217743190e-01   -2.552870383132408e-01   -2.339001812270316e-02   +5.519941049238487e-01   +3.783801513530630e-01   -2.193921000748235e-01];
L2I_L2E_iAMPA_netcon = [+2.328873757703327e-01   +2.037612687096562e-01   +6.564122465087123e-01   -4.716592722027263e-02   +4.383946646055212e-01   +7.724669721224231e-01   +7.455748851214228e-02   +2.904632897119703e-01; +3.657942087344042e-01   +5.203991673956236e-01   +1.713603666043392e-01   +3.279964148780065e-01   +2.433965831603235e-01   +4.443030584177365e-02   +1.842732750701811e-01   +3.734245879792534e-01; +8.567800056747510e-03   +3.066555249670737e-01   +6.201972700714891e-01   +5.840314643259878e-01   -5.930982485474476e-01   -1.687123263556384e-01   +3.246221468689978e-01   +9.917451452925891e-02; +5.016954847464592e-01   +9.520029342839769e-01   +2.374947564243277e-01   -1.851614021851594e-02   +3.714959632207951e-01   -5.516171362815903e-03   +6.140630300543629e-01   -7.865412445689232e-02; +6.417872224919069e-01   -1.642652902950308e-01   +8.827954863311545e-01   +6.908834947327962e-01   -9.361193264780659e-03   +4.068418742208438e-01   +7.065717142916803e-01   +8.873818769892764e-01; +1.033209839174171e-01   -1.928036858056456e-02   -1.563136174346953e-01   +1.904059170700699e-01   +3.671744325742866e-01   -9.824238048437756e-02   +1.351183547835447e-01   +2.183471763359827e-01; +7.502243012077262e-01   +6.045635520190986e-01   +2.670573359105284e-01   +2.595921019514667e-01   +6.051033521396554e-01   -9.292710304087892e-02   -1.077661783004036e-02   +6.475538713806980e-01; +2.511421127291378e-01   +1.612820039479007e-01   +1.953506969189159e-01   +4.931794546460778e-01   -2.897328372912146e-01   -1.278231257478677e-01   +2.175456681077986e-01   +2.195198946228993e-01];
L2E_L2I_iGABA_netcon = [+4.069608628232643e-01   +2.890617006347170e-01   +3.065821982710437e-02   -3.466075976088270e-02   -1.497871397236209e-01   -2.106017672283719e-01   +5.180888694696715e-01   +4.113597267977383e-02; +8.766213550996575e-02   +7.456040776088178e-01   -3.205700816468146e-01   +9.422309020808720e-01   -4.546359417308629e-01   +1.808027021087624e-01   -2.006565526819731e-02   +4.776549007360478e-01; -5.952777971266986e-01   -1.374906243434190e-01   +9.012340941409114e-02   -1.757922014830239e-01   +2.323182154904611e-01   +7.157459034128815e-01   +4.020220409104109e-01   -4.774931198978700e-01; +2.255856987825741e-03   +7.416699539832236e-01   +2.813802715756887e-02   -3.637503858118249e-01   +4.384521086179567e-01   -2.108985465075899e-02   -1.186708736781670e-01   +1.141591309195166e-02; +4.843331627764227e-02   -1.027785735181605e-02   +5.265628045972739e-01   +8.933502303905476e-02   +3.263007643769699e-01   +4.649056280229773e-01   +2.462837154574438e-01   +2.250384888683327e-01; -2.927751423344684e-02   +5.833143073229645e-01   +3.076305857089736e-01   +1.159043338078720e-01   +5.987492608474182e-01   +6.583325500486846e-01   -1.421831704408008e-01   +1.000000000000000e+00; +2.079994224631954e-01   -4.377589037769498e-01   +3.061777748261854e-01   -6.313255213887206e-01   -3.889052708655465e-01   +4.227945433044042e-01   +4.062697254669057e-02   +8.718097594846624e-02; -4.016426426671257e-01   -3.524813555452331e-01   +2.996648002270726e-02   +2.584360542499660e-01   +1.268796748434090e-01   +2.360137121864897e-01   +3.202481343875506e-01   +6.901552844016776e-02];
L3E_L2E_iAMPA_netcon = [+4.130070321853211e-01   +6.826416306706559e-01   +3.821846883210919e-01   +3.882838901116803e-01   +9.526266219980148e-02   -3.995132153320535e-02   +7.935648100962804e-03   -3.077747286592389e-01   +6.365916590991049e-01   -3.237578239370204e-01   +2.123978809782211e-01   +4.716094351412409e-02; -7.963922106051563e-03   +2.011596307436694e-01   +1.699696462853234e-01   -3.979772352019212e-01   +1.048004972590547e-01   -6.623280356648686e-02   -1.152215743161822e-01   -1.879178110528705e-01   -5.449023415727060e-03   -2.342174819141527e-01   -7.699152806001618e-02   +1.440226910459085e-01; +8.097092351353528e-02   +7.090625855779663e-01   +5.887811696120319e-02   -1.172690376375892e-01   -1.062019657436594e-02   +5.459775420895302e-01   +1.848367550181979e-03   +3.382726739415318e-01   +6.158977071997853e-01   +3.665132331765414e-01   -3.966749537676292e-01   -3.301141074601420e-01; -1.859788124939202e-01   +9.230214417880039e-02   -5.186033940828931e-01   +1.494181108009411e-01   +2.656646937061121e-01   -1.485646455518208e-02   -3.519598400924665e-01   +5.322367787913372e-01   -1.230883298264012e-01   -4.292075833007792e-01   -3.199911246182703e-01   +1.000000000000000e+00; +1.709109000031186e-01   +3.793145478271137e-01   +2.898055415347435e-02   +4.255685215508943e-01   -1.692348943907047e-01   +2.572743416609611e-01   +3.775152483602092e-01   +8.763076394490722e-02   +5.298355570886525e-01   +1.531345693598806e-01   +2.700784127882209e-01   +1.780609147986360e-01; -1.442697261195151e-01   -4.017555262173640e-01   +5.193121070214898e-01   +7.978629549147993e-02   -2.577872760245752e-02   -7.077862051072630e-02   -3.894861118050334e-02   +1.859541201545331e-01   +3.681625940014638e-01   -3.452376311201837e-01   +8.743293642031063e-01   +9.160971130434745e-02; +1.465810794109091e-01   +6.942416931403136e-01   +3.177151070594189e-01   +4.385296046307492e-01   +4.599984526282437e-01   +2.371318336031895e-01   -1.048643311260508e-01   -2.022032619640506e-01   +7.849747153662785e-02   +1.237146548764943e-01   +2.413240714351027e-01   +6.267875320922803e-02; +5.685813419070048e-01   -1.887261384196368e-01   +6.037001454636086e-01   -1.796750062537892e-01   -3.018558977228593e-01   +1.134773844394166e-01   +2.781578894940310e-01   +3.875692876341612e-01   +5.968807887574272e-01   +1.979821219109968e-01   +4.941904311754667e-01   +1.809884304189892e-01];
L3I_L2I_iGABA_netcon = [-1.219066631350988e-01   +3.237730491965605e-01   +1.681439953984012e-01   +9.179276119423901e-02   -1.749701154292641e-01   +5.363104902317191e-02   +7.652126025793542e-01   +3.806198799456075e-01   +7.052362437303021e-01   +6.702125781264699e-02   +4.066020175849027e-01   +6.986369832300045e-02; +3.632129029431663e-01   -6.970052512385783e-02   -3.182250117924881e-01   -3.942009936157929e-02   +4.233392337151964e-01   -1.469246232694239e-01   +7.933785546781330e-01   -5.541640517277887e-01   +3.190033971276661e-01   +1.030503082840282e-01   -4.214491305474738e-01   +3.749510482605059e-01; -5.090130380761069e-02   +3.720246937959710e-01   -3.280548291423184e-01   +7.098853905551046e-01   +9.391937469997131e-01   -3.860918759847767e-01   +5.368272824587550e-01   +4.114428183992537e-01   +9.439524431518541e-01   +1.000000000000000e+00   +3.307382812260920e-01   -1.381528459696806e-01; -2.233035805096559e-01   +6.109019642184179e-01   +4.183376939080484e-01   +2.478409485397345e-01   +1.034256127909795e-01   +3.042551186386824e-01   +4.405499559174243e-01   +1.875357381030646e-01   -2.684318177373691e-01   +3.435712640991033e-01   +5.254462971182687e-01   -2.568610507450346e-02; -3.402881458687823e-01   +3.674711488147790e-01   +2.451569387116091e-01   +3.211947899908472e-01   +1.757603758347702e-02   +2.725118497690291e-01   -3.308803566150616e-01   +1.598807489791475e-01   -1.114673076717105e-01   +2.803130744332804e-01   +3.968030109393688e-01   +2.620338055265752e-01; +5.225456142030899e-01   +3.402484153959278e-01   +2.183204067281400e-02   +3.075694044142160e-01   +7.743597606921669e-01   +2.031172967082277e-01   -2.614013478911401e-01   -1.190867918687155e-01   +1.695557303945647e-01   -1.797311206946577e-02   -2.195434696664003e-01   +6.005319695028519e-02; +5.250359965874152e-01   +9.753912727960051e-02   +1.529024668142984e-01   -3.046903946879000e-01   -1.312097254072921e-01   +3.308077817344055e-01   +1.952258314838920e-01   +1.822589719695901e-01   +2.858484782395638e-01   -7.452511864719931e-01   +4.273550912978425e-01   -4.466841050588896e-01; +3.845709890057424e-01   +3.702112701055232e-01   -7.467732309236039e-01   +5.866834929163925e-01   +8.112994657160957e-01   +2.494956256836863e-01   +1.740114076461620e-01   +2.115188400086298e-01   -5.032646454360274e-02   +7.047457939349455e-01   -7.615361023833517e-02   -5.073039296992873e-01];
L2E_L3E_iAMPA_netcon = [+2.000256845498788e-01   -2.674797099683204e-01   +2.949691748841222e-01   -7.324880555866425e-02   -4.955152767571852e-01   +2.343769650618831e-01   +4.775594664369538e-01   +4.383436178942737e-01; +3.767982747354474e-01   +1.446472522928171e-01   +2.021616054454589e-01   -3.503754307414512e-02   -1.306493732795286e-01   +1.952858773789383e-01   +7.840451385025325e-01   +3.696053584279697e-01; -5.045259364327731e-01   +2.058906089420885e-01   -4.526137517756084e-01   +3.232111126063261e-01   +7.782172785997206e-01   +6.277276263312810e-02   +4.413410218307585e-01   +5.803927687315137e-01; +4.479851384188853e-01   -3.287771218625631e-01   +9.485333432415918e-02   +5.093593600194990e-02   +8.096646133093127e-01   -1.119848245093630e-01   +2.668409837488864e-01   -3.486428372856945e-01; +7.089069293785887e-01   +2.316137796477503e-01   +4.371819414826101e-01   -5.433753388015773e-02   +8.234738516538767e-01   +1.556999527324322e-01   +1.982438487928582e-01   +5.453442309458694e-02; +6.856947479897124e-01   +4.210674985776066e-01   -3.471280032546441e-02   +3.467027970849272e-01   -4.593559369773162e-01   +3.370059864373920e-01   +8.557218531460076e-02   +1.053638599402466e-01; +6.901478416746936e-01   +3.049611084295519e-01   +7.781358389182568e-01   +1.835712453407895e-01   +1.206313858550903e-01   -7.422049398018341e-03   +7.783854297991384e-02   +8.660390556859575e-02; +4.177422929362065e-01   +1.283602153467158e-01   +5.675317044415731e-02   +9.348592557440459e-02   +3.207489964853800e-01   -2.319806651487229e-02   +4.313415738508301e-01   +5.144021398065118e-01; +4.282234653449372e-01   +1.815549927349888e-01   +7.674715640344890e-02   +2.908756516235650e-02   +7.513766182422876e-02   -2.815430621506535e-01   +2.882982213486243e-01   -4.981420917270933e-01; +5.970174403964571e-02   +5.758911150213348e-01   -3.699379540379004e-01   +6.653584823221463e-01   -5.089275071528109e-02   +1.332430526285020e-02   +3.914293704791735e-02   +5.914784309122861e-02; +8.690943678518230e-01   -1.868318589146252e-01   -5.818193447221399e-01   +7.128081879168783e-01   -2.182221535351404e-01   +3.727751789082538e-01   -4.489045294311587e-03   +1.000000000000000e+00; +3.210666701949084e-02   +8.380048754293523e-01   -4.050056304748166e-01   +8.085974175852965e-02   -9.612250632510529e-02   +5.756522623071544e-01   +2.150149636685665e-01   +2.035624697455213e-01];
L2I_L3I_iGABA_netcon = [+2.181004948412222e-01   +8.469457976388578e-02   +3.110115568943895e-01   +3.934345658562671e-02   +4.195733146430016e-01   +1.453933219852858e-01   +5.450054752318847e-01   +9.161491231732629e-01; -2.495559175059603e-01   +8.477554173775576e-03   -1.117323462567551e-01   +4.406789646154912e-01   +2.494675785460367e-01   -2.557438123104849e-02   +7.497008046318810e-01   +4.729938382231036e-01; -1.432924514719930e-01   -3.820153032600690e-02   -1.145156629384000e-01   +8.050476910328003e-02   +8.883076668022619e-02   +4.534208435472168e-01   +6.533489140308663e-01   -6.027966957667585e-01; +5.110345117472834e-01   -1.039342976554514e-01   -3.519636656704252e-01   +4.450508626088403e-01   -4.082630866683200e-01   +1.728201543109676e-01   +2.359558809437559e-01   +3.722349290903302e-01; +5.166350621121392e-01   +2.380162172789494e-01   -4.625181121484463e-01   +7.966336895807402e-02   +4.385372088543952e-01   +1.210438160195530e-01   +5.410575517323304e-01   +7.570263201936602e-01; +8.226306359584579e-01   +7.169457744136752e-01   +5.246758334542793e-03   +2.458126568801546e-01   +3.491378551946525e-01   +2.699766699922714e-01   +4.234044338096223e-01   +7.239978722960392e-01; +2.375386545667625e-02   +2.978980911078870e-01   +3.350958537687488e-01   +1.764576741756135e-01   -4.789908187901943e-01   +4.935597244636034e-01   -2.413891270836512e-01   -5.396294338731025e-01; +5.359159525606275e-02   +3.928093028929216e-01   +1.933818445068099e-01   +4.171973921325451e-01   +6.211854897870862e-01   +2.022540904258781e-01   -4.593122627868108e-01   -3.847792985010288e-02; +9.482513361328716e-02   +1.987881945176994e-01   -8.162485561255831e-01   +4.926560724564482e-01   +3.524508757708537e-01   +6.940554602889003e-01   +4.299722063230305e-01   -4.896660136779218e-01; +1.960166803738665e-01   +8.906481854674519e-02   +3.075064856872212e-01   +6.468949407255628e-01   -1.730080810034640e-01   +2.326262183305915e-01   -2.964938692794393e-01   +6.183852360348927e-01; +7.192574914426239e-02   -5.796792742278073e-01   +5.566693298912281e-01   +8.500361175338148e-01   +8.383554202249167e-01   +1.000000000000000e+00   +4.505883363702403e-01   +2.863386577750098e-01; +6.607532644749697e-01   +1.997661395710920e-01   +1.140272222009359e-01   -8.713525898194187e-03   +1.792183836955936e-01   -4.226124443561108e-01   -2.918169688332984e-02   +5.755328117846404e-01];
L3I_L3E_iAMPA_netcon = [+4.926739697516735e-01   -1.750431980316699e-01   +7.121889328033478e-01   +3.941091941317822e-01   +4.006705860900026e-02   +3.225047343915016e-01   -6.918029798657963e-01   +9.193086740689819e-01   +1.847318086862096e-01   +2.609035251846061e-02   +6.354155123711682e-01   +3.023243391707326e-01; -1.046870606757557e-01   -6.093858258821564e-01   -8.365806010631460e-02   +9.994624386605288e-01   +3.926151726039449e-01   +4.291624758422644e-01   +5.837743678161736e-01   -5.556732516739373e-01   -5.557735947504587e-02   -3.864140198341898e-01   +3.596203200285703e-01   +5.303396715367269e-02; +3.378918564145265e-01   +1.058834112933576e-01   +1.980015160330861e-03   +3.939246296504078e-01   +6.046471145533845e-02   +2.767940415513528e-01   -1.775119419050318e-01   +3.434743038067232e-01   +2.385410199690451e-01   -1.094447081040983e-01   +6.921681558692696e-01   +4.288917169335067e-02; +1.036777176649384e-02   +4.841336088818622e-01   -2.829220049540789e-02   +2.436866451448444e-03   +8.486958604867639e-02   +9.278655825967704e-01   +1.910981450218713e-02   -1.599652908656636e-01   +4.389982296233299e-01   +3.964767507022816e-01   -3.912489732503358e-01   +3.551744662526435e-01; +4.253012078968660e-01   +7.097061455731710e-01   -2.161356416449576e-01   +2.950285526052221e-01   -1.890312195954241e-01   +4.351554149443927e-01   -3.736151889765302e-01   -1.823858043843551e-02   +7.926631562194508e-01   +3.110885840698911e-01   +6.229014280187559e-01   +7.764047961491285e-01; -4.021544332824238e-02   -5.473204770169428e-02   +2.067384150521326e-01   +1.449305170925936e-01   +9.912518535354603e-03   +8.528393113715600e-01   +5.331101217348628e-01   +7.159259140132668e-01   +4.307502601716184e-02   -2.740770180045561e-01   +2.560935653963470e-02   +4.345783379929216e-01; +7.102292481872334e-01   +8.433279535682919e-02   -3.496044091673012e-02   +4.178252318392115e-01   +5.102750072763484e-01   +8.420238983171202e-01   +2.772403487428073e-01   +1.977663971119160e-01   -4.208612389930056e-01   +4.781249903508377e-01   +1.575764758745427e-01   +7.683037513659438e-03; +2.873879649569342e-01   -3.016928087174477e-01   +1.063349634110117e-01   +3.032419695083075e-01   +2.514940372737554e-01   +5.673401297694147e-01   +8.115336635335284e-01   +2.406332653382776e-01   +1.622827669093066e-01   +2.379902881251544e-01   -2.911765802618239e-01   +6.618447077181749e-01; -8.661475046231479e-02   -2.412660056028512e-01   -3.501427794650396e-01   -2.040095751108872e-02   -4.848214061119688e-01   +3.501903910128494e-01   +4.300935409299695e-01   +8.296846005345239e-01   +7.841361838471737e-02   +1.538949761998251e-01   +1.113275834023997e-02   +7.375063811502301e-02; +1.989399711625867e-01   -2.510906141186807e-01   -9.488052640045153e-02   +1.879204646886709e-01   +5.398508588720968e-02   -3.354057926056830e-01   +5.987807285017415e-01   +2.783512841051450e-02   -2.183911615327360e-01   -1.395347619220837e-01   -5.718546954246973e-02   +2.241097989324552e-02; +3.321007839731113e-01   -5.590627472352381e-01   +2.234873689270812e-01   +3.347159441018743e-01   +2.556875373767001e-01   -2.576825703059436e-01   +2.003455392933762e-01   -7.269873875226041e-03   +1.653720765508552e-01   -1.068628280795686e-02   +2.592360998363401e-01   +9.457671233632214e-01; +3.059642634034072e-01   -3.126667055933808e-01   -4.788784300269032e-01   +7.830820291432945e-01   +6.895396026601706e-01   +4.186984083594261e-02   +5.402964189255158e-01   +7.984134402011391e-01   -3.747446232734075e-01   +2.833834969746919e-01   -3.993368108622874e-01   +2.412575100943550e-01];
L3E_L3I_iGABA_netcon = [-6.333276966231877e-02   +2.701152637122050e-01   -2.411110193459267e-01   +2.751940574913498e-01   +3.255756245578091e-01   +3.296225296666782e-01   -3.517987245439141e-01   +5.143853871222542e-01   +6.863199677837281e-01   +8.124449849376303e-01   -4.363665599624366e-01   -2.749347212363114e-01; +2.029852618191506e-01   -4.125524193663113e-01   +6.981091516430112e-02   +3.329436953139199e-01   -7.794147984263569e-02   +3.315061889990003e-01   -4.032497415893649e-02   -2.559022212895015e-03   +8.729841933311452e-02   -4.485660478523008e-01   +9.687128688316060e-03   -1.469384941896873e-01; -3.290920047039856e-01   +7.454054125999371e-01   +5.523470908246619e-01   +5.436037959560647e-01   +6.518059535247998e-01   +2.313293040471419e-01   -1.056893345841614e-01   +8.573996479514927e-01   +1.577740721760632e-01   +8.284059481072373e-01   -2.780254198298259e-01   -4.187860038746838e-01; -4.099742979463292e-01   +6.361104166220243e-01   +6.836904061960264e-01   +4.533992974650409e-01   -1.813279531423673e-02   +9.496249257531036e-02   -8.147892045594365e-02   +4.750626482819169e-01   +5.452439385024629e-01   -4.853869132082300e-01   +1.946591293166833e-01   -3.339918287828141e-01; -1.485112465670926e-01   +4.820376163500981e-02   -3.249650871167253e-01   +8.296729084399344e-01   -8.181843723605586e-03   +2.222232191414895e-01   -2.541753472327661e-01   +3.546785677984464e-01   -6.415966887540131e-01   +1.891154876254589e-01   +2.519574766561766e-01   -9.805302348024023e-02; -5.567620623641517e-02   +5.778179519433918e-01   +4.299023959241375e-01   -1.263824803735430e-01   +1.040951115536930e-01   +5.823335758186299e-01   -3.307352827470930e-01   +5.285787659431105e-01   -5.390034568463478e-01   -4.275266480014787e-01   +8.853437550454402e-01   +3.225495430405688e-01; +7.083890869916695e-02   -4.787351724418323e-02   -7.728003824268517e-02   -1.370051895825106e-01   +5.225424705771805e-01   +5.542162643771517e-01   -1.104371470602867e-01   -3.593426055013805e-01   -4.848520424636849e-03   +3.053517822627375e-01   -1.816464691547901e-01   +2.405872673322577e-01; +7.965755423289567e-01   -5.527617406985628e-01   +1.677820034662229e-01   +3.663410081656026e-01   -2.058907878644199e-01   +2.982106428479006e-01   +1.440111487718914e-01   +5.400112076498023e-02   +1.784224012034075e-01   -5.037597065443858e-01   -1.687569761393755e-01   +1.278092684563148e-01; +1.472243969250784e-01   +4.846568530525115e-01   -9.591490342271303e-03   +5.804422711852399e-01   +7.147636648205752e-02   +6.216923132031018e-01   +8.639838126589869e-01   +2.058571218380270e-01   -4.239783860833498e-01   -2.292937103245385e-01   +8.077857034874869e-01   +4.012814566153498e-01; +5.381587179687255e-01   +3.019484263721790e-01   +2.328858541494844e-01   +3.056827000499472e-01   +7.891367372657160e-01   +4.700661088986007e-01   +5.474583165004856e-01   +3.914875417128428e-01   -7.861504770583377e-03   +9.221075209713891e-02   +4.902234522512521e-01   +5.197179070853328e-01; -1.368974487168196e-01   +1.180647043819148e-01   +1.554925351044846e-01   -3.426001922980848e-02   -1.323914629903712e-01   +1.010513614639830e-01   +7.673163041564555e-01   +9.205851463011291e-01   +5.210840544402400e-01   +3.510211150868364e-01   +5.256593270795898e-01   +4.098443211385581e-01; +4.289312865882761e-01   +3.953188779544489e-01   +1.685457499475968e-01   +3.264011674266614e-01   +5.924213845598308e-01   -1.159569151229528e-01   -1.624299428511172e-02   +9.666525706845269e-02   +6.720265169502607e-01   +1.958645024020007e-01   +6.279197135059211e-01   +3.254769338312704e-01];
L2E_Input1_iAMPA_netcon = [+8.281284248855342e-01   +8.480825014187288e-01   -3.941356759241998e-01   +7.494227998375431e-02   +2.255624465022655e-01   +4.656032127602655e-01   +6.448231974409001e-01   +1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [-5.035718475199396e-01   +1.791113623315867e-02   +9.124205561841836e-01   -5.333911547066515e-01   +5.234701466294016e-01   +3.992073345765098e-01   +8.338468270738442e-01   +6.563314847626780e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
