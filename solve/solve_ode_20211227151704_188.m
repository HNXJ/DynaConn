function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.166575292989728e-01   +3.143390362838938e-01   +1.434594730375792e-01   +1.958538209174916e-01   +6.263167057642973e-01   +2.843186505771571e-02   +2.729508267314274e-01   +2.781870877425788e-01   +1.109551283849982e-01   +3.976299644020299e-01   +6.060906390858226e-01   +5.580731771474982e-01   +2.102822885067962e-01   +4.194354151966426e-01   +5.160766148630374e-01   +7.084430431509048e-03; +1.888768587322490e-01   +2.064265448429940e-01   +1.747176170931377e-01   +4.791536912737657e-01   +2.007178615433731e-01   +4.342282923598215e-01   +2.006998246161381e-01   +1.477584201307275e-01   +2.063105620301498e-01   +1.964471172320282e-01   +1.963866777856849e-01   +3.053285208666696e-02   +5.018182820610432e-01   +2.333209062029928e-01   +2.612357372176630e-01   +3.982056248101117e-01; +3.950869707338535e-01   +2.793711888941949e-01   +2.699882477240751e-01   +1.117789909906896e-01   +2.211063592944669e-01   +1.267825473395829e-01   +4.500190239679083e-01   +1.916958811050204e-01   +1.040176760635068e-01   +6.026669089821257e-01   +4.864658426225996e-02   +5.744707974560344e-01   +2.515401193295456e-02   +4.523726757012386e-01   +2.110335789191303e-01   +4.822977766909040e-01; +5.323549497985059e-01   +5.172555223500747e-01   +5.803787744720468e-01   +5.192971001650265e-01   +4.492481735513260e-01   +3.279803246877374e-01   +2.712574309627449e-01   +5.180666384685889e-01   +1.151969537669846e-01   +4.124631095535825e-01   +1.198335761690989e-01   +5.459288472139653e-03   +3.192765439190139e-01   +7.425651360028021e-02   +4.530232873683320e-01   -1.383101686787314e-02; +2.504379562338074e-01   +4.455208907152620e-01   +5.251739251359422e-01   +3.314612895716320e-01   +5.765267824651817e-02   +1.584149106549253e-01   +5.464769475289736e-01   +3.592501631240739e-01   +1.407428856980623e-01   +9.538493347698991e-02   +1.178555927138792e-01   +2.423012940560554e-01   +4.527956898645547e-01   +3.581629248780309e-01   +4.689381085439759e-01   +5.761588837079795e-01; +2.618789719515937e-01   +2.742967673627739e-01   +2.981284475025671e-01   +5.437472607941614e-01   +1.663399115942187e-01   +2.622841805336403e-02   +3.249146774217988e-01   +3.594717590750632e-01   +4.893693715480632e-01   +3.360896039760093e-01   +5.723451313620010e-01   +4.866208954564153e-01   +1.791316090882560e-01   +2.998261006024475e-01   +2.667374446181337e-01   +2.115452881735121e-01; +7.819443968336844e-02   +1.844873314495064e-01   +3.895196197462640e-01   +4.783880123051009e-01   +1.626912426324603e-01   +1.466318137156452e-01   +3.307366438483000e-01   -3.146149252318861e-03   +5.255339630014590e-01   +1.963028472003950e-01   +7.251688264063520e-02   +2.894628114561650e-01   +2.532896562170078e-01   +2.798870805059205e-01   +4.561670572732767e-01   +3.612777245409540e-01; +4.401181586788779e-01   +2.966147701469297e-02   +1.326008468491791e-01   +1.375683896777446e-01   +1.485654071108179e-01   +6.178628629423698e-01   +2.186284173758670e-01   +2.819089769608354e-01   +5.961030760536618e-02   +1.392934100145230e-01   +2.046594350796462e-01   +3.273942209059926e-01   +2.246129685878065e-01   +4.463856985086499e-01   +1.317842081420758e-01   +1.560055557261093e-01; +3.642616105151461e-01   +1.296814177409939e-01   +8.111122035345850e-02   +3.398345268774440e-01   +4.477049337807802e-01   +1.825017500294261e-01   +2.544423862593646e-01   +6.462284828632414e-02   +2.984691188276562e-01   +4.865475911503751e-02   +4.093302054111109e-01   +5.065699997255889e-02   +1.562305305392106e-01   +3.572573710973952e-01   +4.453059508100323e-01   +2.758465502721311e-01; +3.566438739084503e-01   +2.508376550695873e-01   +3.487623083030172e-01   +2.634159662519652e-01   +5.075275326138013e-01   +5.825988526054943e-01   +1.297635016863952e-01   +4.450905946706120e-03   +2.146221592946045e-01   +4.786685409681364e-01   +3.465610924357913e-01   +1.221974388845327e-01   +5.304715308146324e-01   +3.903318049545764e-01   +4.204371784679535e-01   +6.568389051530527e-02; +1.723888199786936e-01   +6.982710504550045e-02   +4.583033203552325e-01   +1.178040635428958e-01   +2.049013311127497e-01   +5.866855094709975e-01   +4.503203625864375e-01   +1.337330680504401e-01   +2.351564714067849e-01   +1.807943445762209e-01   +4.396034064851558e-02   +3.686165794483805e-01   +1.708886602377816e-01   +1.342061529978129e-01   +3.843546680202195e-01   +2.325148179568111e-01; +1.072708213399842e-01   +2.194904832370162e-01   +2.324477024803443e-02   +3.914021675933790e-01   +2.529387809145475e-01   +3.810323771798594e-02   +6.226370126848636e-01   +5.224052797093622e-01   +2.834388048583261e-01   +2.999889292079184e-01   +2.579579617028069e-01   +4.006942096757974e-01   +4.080497338708410e-01   +4.154017854549243e-01   +5.908546314860704e-01   +5.178743820292374e-01; +5.109439936968792e-01   +5.580789924039663e-01   +9.174873657649286e-02   +1.183923330503964e-01   +4.530697135632389e-01   +3.125886894480580e-01   +5.003716831521335e-01   -4.389175885823708e-03   +5.173918700078750e-01   +5.231294749602092e-01   +4.299283335101609e-01   -1.461764195375396e-02   +2.862823091167837e-01   +3.053289349065922e-01   +2.659035213087527e-01   +1.114239382693814e-01; +4.879707280966542e-01   +1.629044955170148e-01   +4.216836737158809e-01   +5.001133442494223e-01   +4.629179244737992e-01   +1.188758718899595e-01   +2.360917014703231e-01   +2.107915315112887e-01   +3.533920345287752e-01   +3.841387225753742e-01   +4.159188227221904e-01   +5.987754169279396e-01   +3.075786787962486e-01   +4.018252263935910e-01   +6.022724080865809e-01   +3.116176890803704e-01; +4.633319732288132e-01   +1.485515005717136e-01   +5.387168699713727e-01   +5.087671099477088e-01   +3.090659768107242e-01   +2.670725807117858e-02   +5.108712978661111e-01   +2.757652834501306e-01   +3.428046085274430e-01   +4.131336740582498e-01   +2.815032443879353e-02   +6.699052047532517e-02   +5.682955507512218e-01   +1.520706804074925e-02   +2.760193975172571e-01   +6.077564048428972e-01; +5.539392518216035e-01   +2.618149181722029e-01   +4.219724386131009e-01   +1.791170257332700e-01   +4.611302709086785e-01   +3.426069973686701e-01   +4.117407683556525e-01   +3.442832578275181e-01   +2.690730811191689e-01   +2.213295949666921e-01   +1.235553126071707e-01   +1.450339051119400e-01   +1.327047672753280e-01   +6.805502871576709e-02   +3.364139854899774e-01   +3.921284603936072e-01];
L1E_L1I_iGABA_netcon = [+5.415821882887011e-02   +5.362302276992511e-01   +5.869432986600365e-01   +4.414399904771418e-01   +3.921350373090181e-01   +4.241835890441819e-01   +6.224497345675362e-01   +7.828958324121750e-02   +5.055189162684555e-01   -9.172948306705868e-03   +5.094431424937754e-01   +1.924005546757625e-01   +1.489678500104767e-01   +6.151172841922687e-01   +2.309765987403336e-01   +3.979642591232510e-01; +4.184488454034989e-01   +3.816324690314197e-01   +3.878596497706985e-01   +1.923957971432886e-01   +1.274715719170797e-02   +4.519838506740145e-01   +4.113061187097380e-01   +4.465248195847125e-01   +9.503761769479248e-02   +1.317421661242785e-03   +5.748884246342377e-01   +1.409792533886406e-01   +3.261894746903131e-01   +3.082095724932017e-01   +7.840969612835491e-02   +2.524701867927835e-01; +1.927143143058839e-02   +3.635877664566813e-01   +2.791878107203036e-01   +2.027499471688461e-01   +1.361513062209773e-01   +9.645520524550480e-02   +2.142241104237592e-01   +3.617562589761605e-01   +1.424061591596728e-01   +1.089839271605162e-01   +4.173044081719453e-01   +3.769389232360214e-01   +3.733511651676417e-01   +1.492121607958304e-03   +2.739011089212645e-01   +2.984219585561548e-01; +2.130992019756908e-01   +4.088610378648479e-01   +4.327612438468120e-01   +3.528140729545737e-01   +3.407604847802861e-01   +5.962133403625846e-01   +4.920191022876257e-01   -4.244756654346139e-03   +4.108915080467184e-01   +5.866125698428450e-01   +3.325536622905400e-01   +4.950719543503608e-01   +1.560044612658474e-01   +3.648547448009986e-01   +7.548584805327141e-02   +1.130604067067856e-01; +2.732188870735269e-01   +5.681636662680692e-01   +5.481077453364223e-01   +5.765027176171877e-01   +1.704089034920816e-01   +1.334853753411011e-01   +4.108600413062085e-01   +3.015394940502849e-01   +4.506383930821303e-01   +4.489378131674425e-01   +5.056857609336464e-01   +4.098237938988031e-01   +1.658150003678851e-01   +5.058014454542861e-02   +2.477201329902775e-01   +5.715378057839724e-01; +4.042331066934178e-01   +4.267075236310221e-01   +4.481931872813857e-01   +4.467752115028396e-01   +3.566231712516963e-01   +1.466329247053093e-01   +6.205241027831441e-02   +2.026348248768949e-01   +5.026862591773250e-01   +2.965539226025325e-01   +4.646295474961926e-01   -6.004445819728322e-03   +2.204698389549958e-01   +1.601477704963485e-02   +1.323836047963962e-01   +3.096098132911396e-01; +1.681786391589473e-01   +3.998400237776928e-01   +4.869338638993680e-01   +1.957859940064956e-01   +3.504879531743799e-01   +1.131336532899251e-01   +5.010603544459095e-01   +4.403548975595481e-01   -1.741550336065869e-02   +4.122195456203037e-01   +9.025689843626462e-02   +4.293869021205147e-01   +3.939863347071830e-01   +4.526581760800970e-01   +1.638557289584558e-01   +3.501568623553423e-02; +5.378335780943352e-02   +2.921431004677893e-01   +1.601210690608670e-01   +1.027974585381575e-01   +3.438333859077508e-01   +4.991862408696336e-02   +1.078804870215626e-01   +2.466604759271870e-01   +4.740248396423042e-01   +2.225251529153514e-01   +2.402195857499665e-01   +1.841948214587698e-01   +2.486601912816868e-01   +1.094572195900006e-01   -2.308160029383333e-02   +5.785417280481682e-01; +2.654108958234076e-01   +4.274451224758958e-01   +5.402340017123893e-01   +3.683191463716566e-01   +2.343278278235109e-01   -1.538469648106696e-02   +5.829912641653687e-02   +3.602898971635544e-02   +3.950775049608445e-01   -3.250245243067058e-03   +2.015242826977350e-01   +4.823825949478612e-01   +3.304826684117654e-01   +2.612253396265186e-01   +5.010287225928077e-01   +6.008761607771330e-01; +2.193023582015243e-01   +4.785313715577362e-01   +1.815731895913267e-01   +8.503133282081074e-02   +3.387570067866950e-02   +3.138188986264048e-01   +1.622144026969348e-01   +9.740206882913076e-02   +4.530386329650350e-01   +1.396774774031765e-01   +2.821059359118164e-01   +2.503212936227239e-01   +4.870250500809871e-01   +4.907116587439053e-01   +4.659969007061920e-01   +2.321505148566711e-01; +3.576370179409375e-01   +3.192217740242311e-01   +3.212384695486327e-01   +1.731732073084207e-01   +3.899680586004023e-01   +5.197653194234169e-01   +4.543031884473112e-01   +5.115123100111949e-01   +3.500380914251497e-01   +3.018566056828222e-01   +8.360769884425027e-02   +4.771402959980474e-01   +1.390595849978188e-01   +1.792106059454073e-01   +2.613913420386972e-01   +2.911855063323797e-01; +4.679955135940236e-01   +6.987048825836173e-02   +1.364475940758509e-01   +3.037811092368481e-01   +4.476893385158245e-01   +1.478608348410705e-02   +3.850446984405339e-01   +3.226522571144040e-01   +5.480955349977005e-02   +3.160709545211725e-01   +2.803560436885643e-01   +2.327170423356711e-01   +1.103086854925914e-01   +4.060948089270947e-01   +4.951100540495201e-01   +4.426913681776335e-01; +2.178090907835604e-01   +2.821155236624036e-01   +3.094353342094973e-01   +4.615385954269178e-01   +2.500563541864979e-01   +1.820647908899327e-01   +4.455132366343305e-01   +4.121245048191686e-01   +4.039279926727596e-01   +5.747624571622350e-01   +1.015194547635409e-01   +1.852560054878758e-01   +1.903822999388295e-01   +3.270368135172790e-01   +2.806437040166269e-01   +4.191107562249162e-01; +1.459067273565126e-01   +2.536870633086297e-01   +3.649760764595760e-01   +3.188006392763617e-01   +4.533678193534429e-01   +1.297882908382615e-01   +3.048783317515806e-01   +2.273870508661070e-01   +2.117451639222339e-01   +2.637289771360020e-01   +2.496301527759100e-01   +2.384332859440713e-01   +5.027531761586020e-01   +5.790310989668800e-01   +1.823174220514094e-01   +1.799243124757928e-02; +1.974582424282366e-01   +1.410560491142590e-01   +2.189775870363349e-01   +3.394514232712680e-01   +2.634836555354758e-01   +2.921115167205925e-01   +1.780334211533809e-01   +2.145819129874273e-01   +3.919085993628479e-01   +3.825662990062568e-01   +2.550096205691482e-01   +2.118910183979052e-01   +9.236033091545764e-02   +2.567355699109619e-01   +4.395905861549234e-01   +4.481138263849927e-01; +2.095164341229502e-01   +3.021560597394464e-01   +2.840983159200441e-01   +1.448483779437889e-01   +3.340794330909022e-01   +5.218348511486016e-01   +7.762626451827606e-02   +4.939736046410666e-01   +1.287145388390485e-01   +4.673199175467203e-01   +2.881750672023546e-01   +3.802409797210689e-01   +2.933493019004588e-01   +5.644191311427306e-01   +1.250475442460042e-01   +4.683894190200224e-01];
L2I_L1I_iGABA_netcon = [+4.312077178902544e-01   +5.092758872960764e-01   +4.361074616614976e-01   +2.284231884652396e-01   +9.193285315831493e-02   +3.720201938964484e-01   +2.462843989197949e-01   +5.955352869006922e-01; +2.605708418727883e-02   +2.983852434637431e-01   +1.057190344854978e-01   +4.616226609558138e-01   +3.149493127111818e-01   +4.698307556720632e-01   +3.975295419054724e-01   +3.241263566984279e-02; +1.247178371903107e-01   +2.091662957499665e-01   +4.355118424519763e-01   +2.892282751973060e-01   +4.370741713059458e-01   -2.425456151688321e-02   +3.533117432272558e-01   +5.363327604541565e-01; +1.311506836721896e-01   +5.370007544268981e-01   +2.364100727356443e-01   +3.511466017145052e-01   +1.719517599736723e-01   +4.498499543592017e-01   +2.430975051685238e-01   +5.108754581491515e-01; +5.321110758699931e-01   +2.362287181198962e-01   +2.369825188001975e-01   +2.111336059120429e-01   +5.154421496131592e-01   +5.679225312629409e-01   +2.593284625054155e-01   +3.457013320059206e-01; +4.016848697491043e-01   +3.579319968274728e-01   +5.553433457629943e-01   +2.897761217222133e-01   +4.509278752325877e-01   +2.850954620565119e-01   +2.330288158273363e-01   +4.361798594221942e-01; +5.728090793702271e-01   +6.245309916007472e-03   +8.281226183395562e-03   +5.084291738407831e-01   +8.422753341137386e-02   +1.730578066619129e-01   +2.459864384923499e-01   +2.215122139220511e-01; +3.724883759758339e-01   +2.147737986948322e-01   +1.707467119708762e-01   +5.350243600667782e-01   +1.356571471375642e-01   +3.645421143309159e-01   +2.002036452513213e-01   +1.524902847837524e-01; +3.736729161242223e-01   +3.111988274700604e-01   +6.844539786529333e-02   +2.226514710370946e-01   +2.764161129924551e-01   +4.132080090413217e-01   +5.064171552816308e-01   +1.753594859184149e-01; +3.182711557093788e-01   +4.203123516033146e-01   +2.870094799264241e-01   +5.088068689121544e-01   +4.911563491736291e-01   +1.078781027521337e-01   +1.818822339403150e-01   +4.820282637532669e-02; +4.962399402135271e-01   +3.155895209233449e-03   +2.949902837597188e-01   +2.820247978801304e-01   +3.771209273030604e-01   +6.925906424528966e-02   +4.054454547961688e-01   +1.244490340638924e-03; +3.186342178798374e-01   +5.732494713517451e-01   +2.493780662479418e-01   +4.168744279707753e-01   +5.178509980466774e-01   +2.094743180502532e-01   +2.776943432896621e-01   +2.387718572671928e-01; +2.599011002077300e-01   +3.228630002907554e-02   +1.110705800857647e-01   +5.177114011369056e-01   +1.808356651812005e-01   +5.961925378640245e-01   +2.923948460972869e-01   +3.596607370271149e-01; +6.984876983414950e-02   +4.749602610346997e-01   +7.238581621279853e-02   +8.296497603466547e-02   +1.544327968725727e-01   +2.219263429457287e-01   +5.573461648972862e-01   +1.314725835636589e-01; +2.666449582157514e-02   +6.484853817594141e-03   +3.446051552401314e-01   +2.983765047953654e-01   +2.492473922257702e-01   +4.222591935266174e-01   +4.719964482907036e-01   +2.002457293159570e-01; +1.521560102688934e-01   +4.878498378322587e-01   +1.292216798500221e-01   +5.163327560239809e-01   +1.689288114380748e-01   +3.429058599582855e-01   +2.121061545165162e-01   +1.586433446132356e-01];
L1I_L2I_iGABA_netcon = [+5.627045307281598e-02   +2.498799332782776e-01   +7.697746752064447e-02   +2.558130384742992e-02   +5.593424242498771e-01   +3.153209118442285e-01   +4.146931467400111e-02   +3.466612728401828e-01   +2.100339984981687e-01   +9.060120963658076e-02   +1.978871448402842e-01   +4.396907237947841e-01   +1.367129316487704e-01   +5.829627015868539e-01   +1.141078065707817e-01   +2.206456345105554e-01; +4.693734974676428e-01   +5.543925262677138e-02   +2.736045117571481e-01   +4.492620691605693e-01   +1.050338363597430e-01   +3.573783164343274e-01   +3.667267157780681e-01   +3.282773720101227e-01   +5.088606013898369e-01   +5.551564765516389e-01   +1.104023782349010e-01   +1.187589290976260e-01   +3.022606149766879e-01   +2.792536229674834e-01   +1.429226428414639e-01   +2.696939983070987e-01; +3.227800291427241e-01   +3.182851904902442e-01   +3.334685891960466e-01   -1.794272995339024e-02   +3.430195879199256e-01   +6.762129362167495e-02   +1.658333184137596e-01   +1.762495199099159e-01   +3.138228719552100e-01   +5.467350002931587e-01   +5.018395162368738e-01   +2.731922037711405e-01   +3.624845669040002e-01   +2.216577382361437e-01   +9.228701986099155e-02   +2.255139379148179e-01; +3.670659032684520e-01   +2.612830536453929e-01   +4.764285543894251e-01   +1.025178121115070e-02   +2.861899318954415e-01   +9.954156285571373e-03   +2.578053263091228e-01   +3.804750647404774e-01   +3.860683018356196e-01   +5.175619467224105e-01   +5.547685173114532e-01   +2.491703910464272e-01   +4.725236595440883e-01   +1.058566934109934e-01   +1.852663481773891e-03   +5.035153934819406e-01; +2.934283099499347e-01   +4.503803664297721e-01   +3.838560712401410e-01   +1.402578856439299e-01   +3.197534831256128e-01   +5.566121153180156e-01   +2.421657786606905e-01   +1.845822247487731e-01   +2.945102160245872e-01   +4.619936170810560e-01   +3.924802732222520e-01   +4.057584377808801e-01   +4.145109562008839e-01   +1.323506179852428e-01   +4.179265997056510e-01   +6.048367406967418e-01; +2.104969131886293e-01   +2.323969647984315e-01   +3.225792420408163e-01   +4.408254885951628e-01   +6.065185761405314e-01   +3.437196747878225e-02   -2.512694017111280e-02   +4.491907425474009e-01   +4.509169647745957e-01   +4.631288616658583e-01   +4.121565142813932e-01   +2.193870154848312e-01   +3.337979862027500e-01   +3.547348946308435e-01   +5.004999145278847e-01   +4.837376865083133e-01; +5.179190161056236e-01   +2.280504080162932e-01   +5.376576311698481e-01   +5.428331973806624e-01   -2.397169424716286e-02   +4.609955116510297e-01   +3.803900470288092e-01   +4.822386860023259e-02   +1.069747432916502e-01   +4.765265610349197e-01   +5.614085459208896e-01   +5.474518361649068e-01   +2.922021643092818e-01   +1.308628326055077e-02   +3.738889389487061e-01   +1.799567170194996e-01; +1.849638825266149e-01   +9.970522942685338e-02   +3.434146428392569e-01   +3.079189624659986e-01   +8.614033484994513e-02   +5.670868866153002e-01   +4.233302162173718e-01   +1.381235934213298e-01   +4.921242325115323e-01   +3.442320174987624e-01   +4.672776251072199e-01   +4.003332320976768e-01   +4.155049863937736e-01   +2.919969814225554e-01   +2.888938827182032e-01   +7.273861225063108e-02];
L2E_L1E_iAMPA_netcon = [+2.795920299216255e-01   +3.439218385110923e-01   +5.204793700840848e-01   +1.563758433505336e-01   -1.450092753801187e-02   +3.423425875918909e-01   +8.203879611746938e-02   +3.110059212937623e-01; +2.138662971403943e-01   +8.282090035594038e-02   +3.150847012530170e-01   +3.228527480836344e-01   +2.193915835853823e-01   +6.791965469748348e-02   +4.942757347848267e-01   +3.847233958405437e-02; +3.227798916491972e-01   +1.148904377983052e-01   +3.021815364483428e-01   +5.462536456765396e-01   +4.098338911211477e-01   +5.473647103485619e-01   +4.666694130315244e-01   +1.207950922370177e-02; +4.173331370127839e-01   +1.946166317450694e-01   +2.286977349019017e-02   +1.173682982363463e-01   +3.070900094192458e-02   +5.495780127496771e-01   +2.600047848505108e-01   +6.816226327528965e-02; +2.987419897172425e-01   +4.070416854931034e-01   +4.976337601012190e-01   +4.104101678824468e-01   +2.444139908880066e-01   +3.758814253371238e-01   +3.762034689606324e-02   -5.597001684540484e-03; +5.252944244987676e-01   +6.269939439398721e-01   -1.676535311397434e-02   +5.537409613389110e-01   -1.953658553473738e-02   +4.411131445767069e-01   +2.976550059897505e-01   +4.535050335559360e-01; +9.946853639494685e-02   +4.731807026496034e-01   +2.585606428489545e-01   +7.764350111492995e-03   +5.399347212774457e-03   +5.059714950267873e-01   +3.224532127978151e-01   +5.245204098539872e-01; +3.018022799537365e-01   +5.813145592152871e-01   +2.757953178183528e-01   +4.336565459147920e-01   +4.240720394653462e-01   +3.453947220666629e-01   +4.928773417650978e-01   +3.078905305035657e-01; +2.096137489718715e-01   +1.214849937248582e-01   +2.765620065409672e-01   +1.997142465721306e-01   +5.721557608126647e-01   +4.820457902148759e-01   +1.226033882485622e-01   +3.581723471936981e-01; +2.105589407911848e-01   +4.986163765566758e-01   +5.028641564617891e-01   +5.165529873439428e-01   +6.027058559956693e-01   +1.641355977971558e-01   +2.872504538841181e-01   +1.664843645060651e-01; +4.172235907820768e-01   +3.646944884251697e-01   +4.039152101423659e-02   +7.724956709359947e-02   +2.395396117704022e-01   +4.571228770088522e-01   +4.165167058948096e-01   +6.068769736302979e-02; +5.643117659478664e-01   +2.323463388782351e-01   +1.339823486233228e-01   +3.818203443498753e-01   +4.913455234375829e-01   +6.290433018603100e-01   +3.585774221057801e-01   +5.329204278958439e-01; +2.512963864185600e-01   +5.288011873061457e-01   +4.991332284576311e-01   +2.214754455922062e-01   +5.668261320466984e-01   +1.963323655126273e-02   +3.994860475384338e-01   +5.384468393587375e-01; +3.044520580568359e-01   +2.081887808185804e-01   +3.915139799988211e-01   +2.216484745956731e-01   +7.607846413332577e-02   +4.732331646322815e-01   +5.809901990149565e-01   +1.631653525026468e-01; +3.645906662425289e-01   +4.595106333856530e-01   +6.790363491032131e-02   +1.358184019916552e-01   +2.482250116689572e-01   +5.420382409681737e-01   +3.601569449741928e-01   +1.248406395169816e-01; +4.009787851360760e-01   +3.907758569839462e-01   +3.250474189532236e-01   +7.593858248242830e-02   +3.299574316859538e-01   +1.742261105594694e-01   +4.495459118867401e-01   +5.381941785833656e-02];
L1E_L2E_iAMPA_netcon = [+1.588096434653368e-01   +2.777346061512894e-01   +5.995608822773126e-01   +3.318020515153370e-01   +3.780761435751679e-01   +6.102107567397800e-02   +3.532990145982594e-01   +4.643778736263732e-01   +3.629835002009919e-01   +2.788056801428990e-01   +4.570490019501756e-01   -5.181755197015681e-03   +2.573913561584800e-01   +2.713922019270289e-01   +4.291215861242815e-01   +5.648289535243091e-01; +4.342664214906634e-01   +5.060891675970878e-01   +4.395423387117865e-01   +1.914774591528177e-01   +3.066644653173182e-01   +3.647203151100961e-01   +4.813643817447757e-01   +1.134809136096008e-01   +1.231355718590854e-01   +2.759487796177101e-02   +1.064296911160623e-01   +1.939174943430156e-01   +7.671265000117297e-02   +1.676979095182573e-01   +7.999958996687948e-02   +1.938931831973081e-01; +2.200859844343366e-01   +5.321072729626013e-01   +5.940666363201549e-01   +5.463657711999682e-01   +2.017527241520616e-01   +4.916815720609456e-01   +3.129792187235532e-02   +4.900650795151776e-01   +3.260800583312535e-01   +2.257639536542115e-01   +1.102873610138457e-01   +5.044467283051590e-01   +8.357193052087192e-02   +1.592600947858014e-02   +2.523042513839535e-01   +3.400173588080369e-01; +2.496894426545181e-01   +2.283653746976873e-01   +3.393523502007090e-01   +6.176055148531163e-01   +2.400665865446692e-02   +3.532851591059288e-02   +4.519723679643511e-02   +3.704291744818810e-01   +5.690245774233957e-01   +4.483488685686804e-01   +3.428875700510983e-01   -1.441290441894586e-02   +3.556769195002862e-01   +1.231970396344370e-01   +1.422262074160668e-01   +3.181094907102299e-01; +5.046234366670870e-01   +2.052482307281312e-01   +3.832915966302342e-02   +5.445616592261507e-02   +6.151120627042065e-01   +5.320122301742619e-01   +5.319440077261582e-01   +2.627044173480474e-01   +1.672054160666240e-01   +2.203802837120372e-01   +4.276939204663565e-01   +6.291845496089157e-02   +3.820716651982924e-01   +4.346597598057135e-01   +2.287396670524210e-01   +1.399114551059873e-01; +6.814688469953376e-02   +3.701136985958451e-01   +5.784980313195854e-02   -1.373555029872700e-02   +4.323517107317297e-01   +2.946189357927550e-01   +3.332735825021103e-01   +5.061345176834966e-01   +5.221368015944017e-01   +4.292064406374136e-01   +1.080724654686093e-01   +4.367821021856261e-01   +4.582563447695823e-01   +2.871659614575973e-01   +7.682567514118549e-02   +2.032976103546292e-01; +1.609494249696580e-01   +2.397246084591797e-01   +1.821074380699252e-01   +1.574187904041524e-01   +2.076153483297921e-01   +1.988952313964875e-02   +1.406027987154055e-03   +2.447750838800703e-02   +2.330745933965297e-01   +3.414870527375480e-01   +1.002455312558672e-01   +1.364763746945228e-01   +6.123774829787162e-01   +3.619347675116853e-01   +5.216091487406770e-01   +2.933574725918431e-01; +1.381967110192385e-01   +2.458987757091715e-01   +5.664047234121196e-01   +4.888928717185466e-01   +5.813512420724042e-01   +3.112508234169709e-01   +5.454741628048784e-01   +1.630574272123627e-01   +2.385938290372686e-01   +5.356043529543858e-01   +5.285127527413174e-01   +1.315009687173470e-01   +2.911856304284791e-01   +1.631079253506856e-01   +4.957187969001425e-01   +3.011225393379284e-01];
L2I_L2E_iAMPA_netcon = [+3.544102514923383e-01   +1.444485043237029e-01   -1.119600551912817e-02   +2.810315050285074e-01   +4.912204309972656e-01   +3.887467089288274e-01   +6.493911956607884e-02   +3.631141893093332e-01; +1.015286326657440e-01   +1.859337538244965e-01   +5.367118043877022e-01   -1.754827517934685e-03   +3.562081083007806e-01   +1.507416629665563e-01   +1.132542783527733e-01   +3.670070983401583e-01; -5.984306616669226e-03   +5.375065928824598e-01   +1.801678155610949e-01   +2.541471466107994e-01   +5.342792875963110e-01   +5.918586439614126e-01   +4.279300071168859e-01   +1.769571643478212e-01; +4.460492961125117e-01   +5.081748871894861e-01   +5.515999833688178e-01   +4.611148214983137e-01   +5.088356499126200e-01   +3.483784115135849e-01   -9.358522824443175e-03   +3.151104084630534e-01; +4.481182925919213e-01   +5.483575115617950e-01   +1.667896082824623e-01   +2.952674977357147e-02   +2.407010737483913e-01   +5.538360845393330e-01   +1.565329347324206e-01   +5.760524712233048e-01; +3.314493893409125e-01   +2.204120985583886e-01   +4.534019561024686e-01   +3.857849884176371e-01   +1.245361770130559e-01   +1.919774391195347e-01   +1.038504921632685e-01   +4.354749467581027e-01; +1.302040830411460e-01   +2.234147240165675e-01   +4.615213740838358e-01   +5.738870456662978e-02   -1.021065189139360e-02   +1.869305337423023e-01   +2.883084049612408e-01   +5.929869963938351e-01; +3.477175646155550e-02   +2.450705652602612e-01   +3.002057000292357e-01   +6.136307542843046e-01   +4.674212285058374e-01   +3.884480457053572e-01   +5.784567384829116e-01   +1.995562207148615e-01];
L2E_L2I_iGABA_netcon = [+4.742083588090102e-01   +2.784982908426117e-01   +2.789726302807341e-01   +1.732718823544364e-01   +5.383854593570377e-02   +5.788577777211487e-01   +5.132088073957495e-01   +3.936205213577397e-01; +6.097744104590138e-01   +2.043267633388524e-01   +1.170591922428853e-01   +5.795695534605840e-01   +5.323856262611621e-01   +4.885178238242742e-02   +1.942234090349593e-02   +4.055986135337503e-01; +2.105608313456734e-01   +3.691246196935502e-01   +4.397171691557688e-01   +1.772633671661703e-01   +1.509581247569687e-01   +5.147627962134296e-01   +1.604041797811600e-02   +2.670513281014972e-01; +5.978562536089215e-01   +9.013711066176344e-02   +1.895757785532519e-01   +3.667446152861648e-02   +5.355935598720025e-01   +5.598284426753505e-01   +5.001023168035053e-01   +2.960220512851088e-01; +3.279605280212795e-01   +2.912038456565887e-01   +6.187076875493764e-01   +1.665548698661161e-01   +6.053083419892444e-02   +7.850169129632502e-02   +5.088799321618855e-01   +2.471655608562208e-01; +4.279568543438869e-01   +1.748586903643100e-01   +1.636271271827425e-01   +3.163400685980315e-01   +1.359224891179878e-01   +3.722232801732497e-01   +2.971683574727564e-01   +4.419767454422786e-02; +5.045363849565083e-01   +3.746062235999512e-01   +4.323237799621199e-01   +8.615559458697668e-02   +1.424050239479139e-01   +6.517217413277353e-02   +4.133859878311733e-01   +3.799573394419423e-02; +1.477263828564658e-01   +2.175544085169820e-01   +3.000829771330302e-01   +2.951846102170892e-01   +5.555455817093455e-01   +3.301041871399288e-01   +2.372780904835783e-01   +1.282821934090249e-01];
L3E_L2E_iAMPA_netcon = [+3.170132733074948e-01   +3.614673328619605e-01   +1.743578692303576e-01   -2.180896339977217e-03   +3.270411021306632e-01   +6.665201067614590e-02   +5.560611365991512e-01   +3.558770405797001e-01   +4.195867662985495e-01   +3.940835449275515e-01   +1.222268280635385e-01   +3.131641059995319e-01; +2.028769327878990e-01   +3.668679061654606e-01   +4.305577781263734e-01   +4.055010491161525e-02   +4.394651090979976e-01   +4.871087894211459e-01   +4.360679215925719e-01   +1.857647665607782e-01   +4.797407110222203e-01   +1.400543658977023e-01   +4.168753926897968e-01   +5.018867085188554e-01; +3.978325544414817e-01   +3.074329677790816e-01   +5.058812028188936e-01   +5.260865661932663e-01   +2.958893659621754e-03   +1.649298838762811e-01   +3.428536134424516e-01   -8.096854022355587e-03   +3.473177079915231e-01   +4.406133978209868e-01   +2.938086525770023e-01   -1.087331658926598e-02; +4.189493427476488e-01   +2.764970067165922e-01   +3.189041057806447e-02   +6.727100539576636e-02   +4.782459620812257e-01   +2.282395427859348e-01   +5.842764241850987e-03   +2.907289488957630e-01   +1.724613704863488e-01   +2.039707913244823e-01   +3.562488815009103e-01   +8.031327702119484e-02; +4.292360073243804e-01   +6.109576395428233e-01   +5.215860385553810e-01   +5.721928882912086e-01   +5.014177454261464e-01   +5.001251111417248e-01   +3.813731372189422e-01   +1.201896104593104e-01   +6.721680899182236e-02   +1.036951104402159e-01   +4.354836383517980e-01   +3.739969937589186e-01; +1.580326778771738e-01   +1.385848414178779e-01   +8.685492200401498e-02   +1.952580244379494e-01   +4.382543637227937e-01   +3.941514285281406e-01   +5.563747906456452e-01   +5.073210203302329e-01   +5.435718047645687e-01   +2.144729175913323e-01   +5.504150125997093e-01   +3.935526575793554e-02; +4.197184200595928e-01   +8.696612844491035e-02   +6.585245180822177e-02   +6.079850925438504e-02   +2.042317188745975e-02   +3.110802391595450e-01   +4.450476425150074e-01   +2.158836463991516e-01   +2.071525909243266e-01   +1.568739277415066e-01   +5.232219052868962e-01   +5.890520273135804e-01; +5.445358051737790e-01   +4.981147826782117e-01   +3.554551461428897e-01   +5.038355682118201e-01   +4.770087435407340e-01   +1.879252743760778e-01   +1.854429957408890e-02   +2.129566775047638e-01   +9.729899473325472e-02   +7.147101771631650e-02   +2.587784045057359e-01   +1.191857111305863e-01];
L3I_L2I_iGABA_netcon = [+3.376059212572507e-01   +5.943083253287909e-01   +1.151296762756332e-01   +3.224842994586488e-01   +3.042379286291350e-01   +4.234766143376428e-01   +4.291030781504310e-01   +6.075768098165475e-02   +2.594243001182642e-02   +1.540528070399992e-01   +5.281998145634117e-01   +1.329554534401557e-01; +3.338761839615370e-01   +4.073970371662432e-01   +3.309597430834843e-01   +3.999664140870633e-01   +4.495527739779442e-01   +2.378854288335824e-01   +5.234389593669413e-01   +8.046919889152811e-02   +1.966128873873767e-01   +2.290918521425043e-01   +3.536058523568060e-01   +5.264302871163930e-02; +2.691731904855249e-01   +4.398459666084002e-01   +3.407593958143386e-01   +2.425852441542056e-01   +3.036024167754919e-01   +2.462984804201149e-01   +2.923614691158495e-01   +3.748174670468200e-01   +3.782141678185849e-01   +6.513203311676796e-02   +3.686529448755273e-01   +4.120026406575262e-01; +4.218889646403468e-01   +5.289303277094144e-01   +5.551557047311440e-01   +1.107952540674345e-01   +3.371333901432246e-01   +5.873008227301300e-01   +6.325652718203878e-02   +1.013728508195916e-01   +3.837797406315815e-01   +4.821518550354980e-01   +1.206104041525351e-01   +4.449501854795865e-01; +2.783068410839296e-01   +4.904750152036781e-01   +4.718740785654745e-01   +4.382238821857055e-01   +5.307914176738879e-01   +1.990547555716027e-01   +2.261708021401942e-01   +4.636975290351112e-01   +3.064033793080088e-01   +7.124793416673923e-02   +2.022737504865200e-01   +1.952078545843795e-01; +3.610536165595058e-01   +9.161585908980369e-02   +3.777367661386764e-01   +2.160078419384719e-01   +4.576955591196890e-01   +3.599234714505663e-01   +2.672315548173130e-01   +3.075744828534327e-01   +1.668239309159027e-01   +1.602797479572878e-01   +3.181258757487794e-01   +3.886882116506393e-01; +2.867583758704192e-01   +8.732871901023868e-02   +4.849398130181702e-01   +3.893542307060960e-01   +1.561876649714753e-01   +5.701129071048687e-01   +2.033590130180827e-01   +1.116307265769152e-01   +2.114208051889468e-02   +4.839663271051931e-01   +5.574997871531339e-01   +7.383616145565430e-02; +2.410006708345662e-01   +1.284490986356309e-01   +5.213864238282726e-01   +1.057384176630513e-01   +4.473165986269328e-01   +4.981393365225235e-01   +4.433044835951096e-01   +3.411322472138073e-01   +2.705810387676870e-01   +4.582340212402154e-01   +1.357176763888623e-01   +4.930461365295093e-01];
L2E_L3E_iAMPA_netcon = [+3.490176744157191e-01   +1.423388950226567e-01   +4.985319820871355e-01   +3.954116812838327e-01   +2.963362018844826e-01   +2.592818259420028e-01   +3.089527329166802e-01   +2.025045140734458e-01; +3.042780831303442e-01   +3.063868059217906e-01   +3.946937559444158e-01   +2.427348094656980e-01   +5.528379369130878e-01   +1.953611851585833e-01   +3.614377312861837e-01   +5.580478211852846e-01; +1.688351084169432e-01   +1.281579950235747e-01   +3.885058080561222e-01   +4.070345383221628e-01   +3.852299741038661e-01   +4.725845849819574e-01   +3.658164123191924e-01   +6.484100339581997e-02; +1.194534925332569e-01   +1.312426133147339e-01   +2.383365169040527e-01   +5.695369502126896e-01   +2.229381747698367e-01   +4.629478401459060e-01   +3.641474005854498e-01   +1.682352991563379e-01; +1.354036605059850e-01   +3.910775666589114e-01   +5.979631682480253e-01   +4.541004118198707e-02   +4.473152016690022e-01   +4.373941748107407e-01   +4.459227118538588e-01   +2.820085541953266e-02; +1.016124192081160e-01   +5.448766095845936e-01   +4.104936305470894e-01   +1.825909427909405e-02   +5.660135551285562e-01   +2.500545004757417e-01   +1.800609692490169e-01   +4.542020109858693e-01; +1.707062859698970e-01   +1.312117871313525e-01   +3.052484321459132e-01   +4.763268057334793e-02   +1.910532961036976e-01   +3.898545838462639e-01   +3.546296215307946e-01   +3.150363393859670e-01; +3.590670751847161e-01   +6.140268300941335e-02   +3.524738966828912e-02   -1.660331242630520e-02   +4.904018438883096e-01   +3.231178343163104e-01   +1.047256162390068e-01   +5.590542774920279e-01; +5.868390756281454e-01   +4.452565714680472e-01   +2.178032367079789e-01   +4.691564298166185e-01   +2.110970446676176e-02   +1.870646367501328e-01   +3.608201278690444e-01   +2.499581331783344e-01; +3.310679446479611e-02   +1.572867243974183e-01   +4.937004440131422e-01   +5.630958579564600e-02   +1.555852823115336e-01   +1.078138211982442e-01   +5.237222680988471e-01   +5.496089251681825e-01; +4.405000716883111e-01   +4.479406942130500e-01   +3.121184630202736e-01   +3.670504894738472e-01   +2.516337025373415e-01   -1.327152648058329e-02   +9.638739715401957e-03   +4.893407376889505e-01; +4.542265294076125e-01   +1.018948262223481e-03   +5.176583466828100e-01   +4.913983764572236e-01   +3.503158882539449e-01   +6.533318551251427e-02   +1.811958750764473e-01   +2.093370695181336e-02];
L2I_L3I_iGABA_netcon = [+1.623617636327680e-01   +2.898162244365567e-01   +1.823255446966474e-01   +3.336244662291130e-01   +2.561555822043843e-01   +2.983384716323887e-01   +2.917358876130695e-01   +3.450689010044273e-01; +2.331648032667212e-01   +4.848163623756656e-01   +1.538319717564174e-01   +5.085161875739546e-01   -2.632512522660295e-02   +3.722427863648827e-01   +2.234598013936603e-01   +2.834705615497153e-01; +1.799677653365853e-01   +3.861138882714840e-01   +4.735157506933490e-01   +3.542669908229842e-01   +2.512313632832346e-01   +2.861148429991244e-01   +4.019129696066077e-01   +5.802416511466260e-01; +3.994132689699857e-01   +1.199740844625596e-02   +5.138218965547867e-01   +1.721654653049090e-01   +3.486240059372075e-01   +3.602317059947118e-01   +5.089059787318748e-01   +1.028057400202905e-01; +2.762946287721453e-01   +5.829274317577761e-01   +3.923746759889205e-01   +3.501876224853246e-01   +2.476270811958000e-01   +4.904580012102086e-01   +5.362092339862415e-01   +4.554441170086948e-02; +4.837738681812712e-01   +3.401981777349357e-01   +1.378795546078229e-01   +5.420040696362294e-01   +2.041945285715454e-01   +1.671821530030579e-01   +2.194529989614115e-01   +5.017264095777001e-01; +1.483747339595046e-01   +4.783511056342739e-01   +1.592326010828817e-01   +4.783270695243690e-01   +2.087904741820459e-01   +2.509895504072145e-02   +2.811699873656844e-01   +3.637026313080108e-01; +1.405127021092976e-02   +1.049311878071341e-01   +3.207653354641086e-01   +6.854342650228888e-02   +3.845445497447847e-01   +3.585845030249091e-01   +8.131083397058637e-02   +8.551485152495411e-02; +2.364205921696627e-01   +2.162445132123708e-02   +4.879986663398603e-01   +5.434065505680625e-01   +3.874543627672940e-01   +8.616113794083231e-02   +1.777633146709331e-01   +4.968642979946357e-01; +2.327331058409773e-01   +8.902488542297803e-02   +7.686294871213323e-02   +3.181073226528787e-01   +5.447154823337423e-01   +3.131660062417698e-01   +5.098003955799586e-01   +2.771293219294670e-01; +4.152961913671548e-02   +2.888537027547483e-01   +8.492335545197273e-02   +2.978519198219163e-01   +2.992624107541293e-02   +3.416112226038850e-01   +7.089854406366250e-02   +1.316093431214018e-01; +4.397966095113015e-02   +2.713951633088960e-01   +4.744664163586316e-02   +1.566026135706922e-01   +3.305848325626640e-01   +5.257664404567730e-01   +2.145366924672605e-01   +1.907926828213869e-01];
L3I_L3E_iAMPA_netcon = [+2.680960227631879e-01   +2.504500524589490e-01   +3.222104045740600e-01   +5.168320036382619e-01   +1.376807184648633e-01   +4.141757804156603e-01   +2.034992742152600e-01   +1.725701968026311e-01   +9.445526105729921e-03   +2.200211304994679e-02   +4.062930181712163e-01   +3.892330743265303e-01; +4.797798396623005e-01   +2.271252536202073e-01   +2.023200137836257e-01   +5.531483909591148e-01   +4.643718937019040e-01   +2.799312058204029e-01   +5.583802712619657e-01   +5.945583887046526e-01   +2.730788165614263e-01   +1.453826220161912e-01   +3.820159516165155e-01   +5.338530063172451e-01; +1.805178287351185e-01   +4.794432803824313e-01   +1.862619828955613e-01   +1.532817211186062e-01   +4.305211717385059e-01   +4.710535379957100e-01   +4.354040456670489e-01   +5.079622445093848e-01   +1.270917247825677e-01   +4.727012807319894e-01   +1.997833140632055e-01   +4.982246712103265e-01; +5.842186798706372e-01   +3.428972416196402e-01   +3.442097361711942e-01   +4.536538187506438e-01   +2.041940965236654e-01   +2.314402862444030e-01   +2.571209079763929e-01   +4.844207666639451e-01   +4.313833675243425e-01   +5.503648936303145e-01   +2.271958896769114e-01   +4.138778251364267e-01; +3.875460352552793e-02   +4.963763037575282e-01   +2.612591595627958e-01   +3.352258668141751e-02   +1.184337424503398e-01   +1.167556321111587e-01   +6.661539203228162e-02   +1.946095287270499e-01   +2.648655694520318e-01   +1.370587053809452e-01   +5.047874470056647e-01   +4.239644478324223e-01; +2.353704728670571e-01   +4.464414254968584e-01   +2.181705957614005e-01   +5.360618587593006e-01   +6.619063028370074e-02   +1.131614624894738e-01   +1.466164040230886e-01   +1.587334825281312e-02   +1.286749950038392e-01   +6.305792449745711e-01   +4.330977213190891e-01   +8.544198923151462e-02; +3.855775359385951e-01   +4.464205175516379e-01   +4.810720474343574e-01   +4.174393707013833e-01   +3.278458669896101e-01   +2.303849914244560e-01   +2.270208042412520e-01   +5.194854899352470e-01   +4.045458874737550e-01   -1.921788815694035e-03   +6.385156668150255e-02   -3.777467311079434e-02; +5.478406682455067e-01   +5.432852181455268e-01   +3.314378060295765e-01   +4.117854910839239e-01   +6.172222108369312e-03   +1.457336955576488e-01   +3.466790780099116e-01   +5.509217415120603e-01   +3.805791834226522e-01   +5.132550153720428e-01   +4.861409208111308e-02   +6.990165387747757e-02; +9.770913215733557e-02   +1.883687134976898e-01   +1.834303528078111e-01   +2.580490914765058e-01   +2.170909247138171e-01   +2.237332235577323e-01   +5.129086528379191e-01   +1.498318320473528e-01   +3.407047782110777e-01   +4.823639300472726e-01   +3.482345402900788e-01   +5.637852710381129e-01; +4.055227451378489e-01   +2.211178339180767e-01   +3.142985933356847e-01   +2.697853696673220e-01   +9.857836620394908e-02   +3.369262451244022e-01   +2.805037516997801e-01   +5.947490070528035e-01   +4.375694584297985e-01   +2.010801802716324e-01   +2.173895724705279e-01   +3.391363902666319e-02; +3.844957515734806e-01   +4.558873361212987e-01   +3.713717663336096e-02   +8.220613953961516e-02   +1.157442409416124e-01   +4.312302128064746e-01   +1.584144817668009e-01   +3.806286192219495e-01   +9.126851980018333e-02   +1.627108434872296e-01   +3.150790449994153e-01   +3.795047733475687e-01; +2.249327094795922e-01   +7.747527234530781e-02   +2.768133116531540e-01   +5.893963578349978e-01   +6.461989479606717e-02   +6.389265408663586e-02   +3.080810738474248e-01   +4.015579332455627e-01   +3.443779878582860e-02   +1.103701299300368e-01   +2.226419153293600e-01   +5.173560241665660e-01];
L3E_L3I_iGABA_netcon = [+5.839875128958292e-02   +4.451379613790424e-01   +3.027280534558094e-01   +4.779867729846473e-01   +4.406941578120919e-01   +3.523927773490810e-01   +4.873779921644540e-02   +2.675944419176473e-01   +3.696130694172995e-01   +5.089076370380387e-01   +5.506172170082503e-01   +2.203389912265494e-01; +8.761891809200500e-02   +1.069856675097725e-01   +5.566496760713315e-01   +2.724024545367348e-01   +1.953314272981820e-01   +3.573609674846501e-01   +4.891855449025087e-01   +3.554359492142367e-01   +1.819402985593608e-02   +5.665533040624148e-01   +3.749971020459495e-01   +4.944229747532546e-01; +4.169645174242351e-01   +3.882688084971678e-01   +5.130485313227736e-01   +4.415370377634287e-01   +1.206603934523906e-01   +5.118551123296425e-01   +2.545211669091410e-01   +1.578822123541809e-01   +3.801038653559904e-01   +3.706629970855796e-01   +1.362208648903335e-02   +1.403084076087285e-02; +4.114737723149636e-01   +4.309615348295566e-01   +1.315451416843223e-01   +9.525132005354486e-02   +1.964679010334312e-01   +5.282204570553753e-01   +2.084665208758013e-01   +2.856528092440225e-01   +5.458041913783945e-03   +1.969248350813063e-02   +4.968505199873923e-01   +1.023278295031781e-01; +3.620921641266399e-01   +5.274396795054643e-01   +6.218555188513801e-01   +2.610676917252824e-01   +4.214947728777408e-01   +1.355973494893082e-02   +4.634982197622186e-01   +1.500926362657313e-01   +1.495864769546263e-02   +5.033307073698403e-01   +2.770049504306982e-01   +3.037387541617147e-01; +1.472472808162927e-01   -2.300712360319645e-02   +4.533969182011682e-02   +5.695407767167441e-02   +6.635550834723634e-03   +4.876996106658215e-01   +1.910115166637641e-01   +4.426798706894590e-01   +5.652367455931444e-01   +5.226136839101937e-01   +5.069552596412887e-01   +4.614302496047079e-02; +5.386060325980503e-01   +5.240235151168838e-01   +2.779526803666387e-01   +1.065105778249663e-01   +3.675126399090673e-01   +4.272960782542854e-01   +5.374594304722373e-01   +4.978575577490041e-01   +4.240189572754252e-01   +5.663115472150362e-01   +4.063853222112601e-01   +1.163275317435961e-01; +2.859334645498053e-01   +3.464608736315187e-01   +3.584319751900042e-01   +5.333407922417062e-01   +3.153649243496319e-01   +1.384060223700614e-01   +1.945426424242108e-01   +2.833167664073145e-01   +2.748621881770219e-01   +2.815817247401486e-01   +3.199214844875876e-01   +3.772092492096732e-01; +5.127550810949209e-01   +1.628568281124680e-01   +5.335522099925418e-01   +3.271619354392334e-01   +4.839399176691526e-01   +1.971055295705770e-01   +3.354706336389109e-01   +2.687981059889849e-01   +3.229500737442346e-01   +5.419433946957652e-01   +4.443565118358314e-01   +5.734541533171453e-01; +3.157869165946965e-01   +3.009984079256334e-01   +3.787656975396060e-01   +1.039843820816229e-01   +6.117855925339646e-02   +3.131898912059341e-01   +2.448149446752515e-01   +1.387460662803360e-01   +3.168805952844895e-01   +2.520573539621386e-01   +2.571528763779718e-01   +1.472479338874525e-01; +2.960401690482080e-01   +4.412333654521839e-01   +2.367392718601480e-01   +4.832845036577877e-01   +1.243997829696530e-01   +4.468236309050407e-02   +1.353547096567139e-01   +3.834566596403993e-02   +3.522040147031764e-02   -3.609074365347414e-03   +5.357787418911243e-01   +3.835544180771530e-01; +9.012283731357203e-02   +2.684780611794123e-01   +2.068369883877530e-01   +2.054242590135510e-01   +4.068808214605267e-01   +1.528430744860976e-01   +3.711834813279284e-01   +2.770428880787736e-01   +2.281004389244228e-01   +5.043930584094378e-02   +5.361451166551416e-02   +1.091137486290024e-01];
L2E_Input1_iAMPA_netcon = [+1.491951656557173e-01   +1.256213477645452e-01   +3.426718526795435e-01   +2.256433494943712e-01   +3.228289536943009e-01   +3.872336912963247e-01   +2.961818603713727e-02   +3.706916290426978e-01];
L2I_Input2_iAMPA_netcon = [+2.496099587945818e-01   +2.374933525143824e-01   +5.508477012107517e-01   +5.349268632019128e-01   +2.972721843236555e-01   +2.967545377643642e-01   +3.628381212364187e-01   +4.698124706363049e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
