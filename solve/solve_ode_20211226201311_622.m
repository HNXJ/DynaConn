function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.654186283189871e-01   +1.129196651095887e-01   -3.378944780734901e-01   +1.194745503125269e-01   -6.582870514097612e-02   +2.251987072561817e-01   -1.043033645609723e-01   +2.153362645856040e-01   -1.791571465157729e-01   -4.189046863249477e-01   -2.761859226385354e-01   -1.097418720582955e-01   -2.168936434647146e-01   -3.895890497745141e-01   -1.542662608182088e-01   +2.265173804118273e-01; -1.562713877402748e-02   +2.229984353807985e-01   +1.515238474606858e-01   -9.483647702574963e-02   -1.289226244525300e-01   -4.658652649243492e-03   +1.067740333994275e-01   +4.928320223380367e-02   -6.057109027033478e-03   -2.100545008685268e-01   +1.124329584947830e-02   +2.210492598699270e-01   +2.025562940613413e-01   +1.202774251441725e-01   -1.397274892113583e-01   -6.169199750909853e-02; -3.427014661299865e-02   -1.663073948463155e-01   -7.492208925528292e-02   +2.402473183975358e-01   -2.196758542665219e-01   -5.071154500394486e-02   +2.152724074576855e-01   +1.046320692135073e-01   -4.076860552004982e-02   -1.209907261257835e-01   -1.034916989158281e-02   -1.436957201524675e-01   -1.793714101770426e-01   -5.220823164633812e-02   +4.182917173117928e-01   +1.311790199586629e-01; +4.697742410274774e-02   -2.159728561604375e-01   -1.772979898496912e-01   -2.010835604978277e-01   -8.120346070999818e-03   -3.774253834498753e-02   -4.436370529413170e-02   +7.298393086233446e-02   +5.963670197668583e-02   -3.750648360346108e-01   +1.191921573920898e-01   -3.202369307553667e-01   -4.092413081553815e-01   +2.023425245165272e-01   -5.014611916033711e-02   -3.126394029920382e-01; -6.843385403316926e-02   +9.466621554666248e-02   +7.512646883287752e-02   -2.397919742746925e-01   +2.889582211526039e-02   -2.662900451222858e-01   +4.559473809004117e-02   +2.039613636170673e-01   -1.048830236513040e-01   +2.431835521982039e-01   +1.768609142283782e-01   +4.974512199255621e-01   +2.693320283193016e-01   +1.185073836926233e-01   +9.356425061864153e-02   -8.232599370347064e-02; +7.645221115032493e-02   +2.704109706161030e-02   +3.950508035941441e-02   +2.616187264179809e-01   +1.557774084153932e-01   +2.436544955795192e-01   -1.286319970055572e-01   +9.641606139583385e-02   -2.457311242439273e-01   -1.143967943699036e-01   +7.559197440650374e-03   -8.094785888161672e-02   -1.155281335550662e-01   -1.837000040576124e-02   -2.445209747933683e-01   -1.281159709883349e-01; +1.101112468649846e-01   +7.037386507981422e-02   -3.630757979514737e-01   +8.780949401345771e-02   +1.118631463538094e-01   +5.753996326240294e-03   -3.798713548704167e-01   +1.734648552993623e-01   -1.014969408269005e-01   -1.049057777249087e-01   +3.288825420964145e-01   -8.414460407250332e-02   +2.054331195138096e-01   +2.765755603614086e-01   +1.168839212945865e-01   -5.505619209052320e-04; -1.418343760066155e-01   +2.336130585317480e-01   -5.321548784558177e-02   +1.535532598270252e-01   +2.946876462002487e-01   +2.064975527661332e-01   -1.103284012483719e-01   +1.808751240427199e-02   +1.545958504593224e-01   -2.905535442357303e-01   -2.506431106620301e-01   +3.509077467879131e-01   -7.945475733793453e-02   -3.157717438781700e-01   -1.591005797354802e-01   +3.910357759938498e-01; +1.126704729492535e-01   -1.306207258148376e-01   +3.299473266665384e-01   +2.267931122817264e-01   +1.564180700333076e-01   -1.906718999777160e-02   +7.292017103837613e-02   -5.556195260032434e-02   -2.777017797573385e-01   -2.419655069460838e-01   +2.642421591486976e-03   +2.788818722919862e-01   +2.573637767373833e-02   -1.748807849286146e-01   -1.408321693254762e-01   -2.783115648871353e-01; +4.110407551306784e-01   +5.603564409205575e-01   -3.819756557090832e-02   +1.944219624552324e-02   -2.782078670367697e-01   -3.427514762382284e-01   -2.439350885915450e-02   +2.176182068784081e-01   -9.743563378082160e-02   -3.402321165100107e-01   +4.645343963647309e-01   -2.582340129602743e-01   -7.409170428203199e-02   +3.191080777140551e-01   +2.060333048112327e-01   +8.656127245628151e-02; +1.378900939672384e-01   +1.841579384330455e-01   +1.145023807270519e-02   -3.163252545943009e-01   +4.679713287845753e-02   -3.300938813646626e-01   +1.393164199965941e-02   +2.049085258467916e-02   +4.284019946198159e-01   -2.471510241951017e-01   -1.568389023688497e-01   +2.365960745071333e-01   +3.093848057003574e-01   -4.665747840178291e-02   -1.511814520835805e-01   -1.212527440675678e-01; +9.997338387331535e-02   -1.188754894316247e-01   +1.149000140354364e-02   -1.277801465110617e-01   -8.378160703833987e-03   +9.342202698056193e-02   -2.296661603342730e-02   -4.782644722207722e-01   +2.687148633826282e-02   +1.310097789291339e-01   +1.181707609984500e-01   -2.009301279114874e-01   -4.181730431160036e-02   -5.244932151803651e-02   +5.129107969901898e-02   -1.936074994281637e-03; -1.213134623704057e-01   +9.807097963154399e-02   +8.227267669337103e-02   -1.498015407001552e-01   -8.204163461775633e-02   +9.177293741743835e-02   +3.372462718896256e-02   +8.255158036018984e-02   -2.858245002177174e-01   +2.048649333252227e-01   -1.269957352575018e-01   -3.676958144368649e-01   -7.688739613864803e-02   +1.821576662141264e-01   -3.540648567270925e-01   -3.312511039937909e-02; -3.893240908067055e-02   -7.914139171644548e-02   -8.585964984904088e-02   +8.312607781457368e-02   -5.545613014606385e-02   -5.956379748523489e-02   -6.424210210172836e-02   +7.971100264580737e-02   -2.379826910572344e-01   +1.257155461347092e-01   +2.200654345245695e-01   -1.679632099173284e-01   +1.621124626065948e-01   +3.496015612372498e-01   -1.618643620602334e-01   +1.823365633948486e-01; -8.208157353189335e-02   +2.061426529117390e-01   -3.459060965192490e-01   +2.056996232182928e-01   -1.075913789611316e-01   -7.901477010166749e-02   -2.796322155998900e-02   +3.311461873278192e-01   +1.062380896008863e-01   +2.002449582043904e-02   +3.647454339601746e-01   +2.756604351076358e-01   -3.366666522484716e-01   -5.652441051237463e-02   +1.757104571203154e-01   -1.696240278190095e-02; +2.533346273232722e-01   -2.988723523895333e-02   +1.640682779780292e-01   +1.716523231343981e-01   +8.003823984404693e-02   -2.471699784768004e-01   -2.289302237811319e-01   -4.904687609176261e-01   +1.455020140947343e-01   -3.090131063357884e-01   +7.215197043712626e-02   -1.298163028858370e-01   +1.586811976418102e-01   +6.573630256405602e-04   +1.890246091190964e-01   -5.704982071480956e-02];
L1E_L1I_iGABA_netcon = [-2.295212625979291e-01   -2.927439763479248e-01   -1.332114983108648e-01   +1.659087897646544e-03   -3.869007080875950e-02   -2.843747875506845e-01   +1.013183059482314e-01   +1.302235116576045e-01   +1.603635249153782e-01   +6.903482176867873e-03   -7.072624725249066e-02   -1.134734965696050e-01   -7.501357884465332e-02   -7.685615802619716e-02   -8.674454339240292e-02   -1.959211342447724e-02; -1.864342548360322e-02   +1.465537389655485e-02   +3.416035940413626e-02   -2.823407451913523e-02   -8.644660519527736e-02   +1.028961619188188e-01   +6.055206888667731e-03   +1.743368586432069e-01   -9.669084321338495e-02   +2.564210952120865e-02   +8.025387231851051e-02   -5.769263614814744e-02   -2.669118264527536e-01   -2.921469582001707e-01   -4.038903353973720e-01   +1.782103422527053e-01; +4.686846133534422e-02   +4.066704081017528e-01   -1.381351365762540e-01   +4.105614112151598e-02   -1.582537344211222e-01   +1.823711261960480e-01   -2.093507082015544e-01   -2.028641828674428e-01   -1.310788350966304e-01   +1.714397965171370e-02   -7.799623113960440e-02   -1.021968974641912e-01   -2.842822154379500e-02   +2.986910742400534e-01   +5.368375838254588e-02   +3.375066524470343e-01; +2.763254368869580e-02   +2.077145349786218e-01   -3.466984352161481e-01   +1.278374201657875e-01   -2.489759721376556e-02   -2.044852583610203e-02   -1.714708544399599e-01   +2.449579300914115e-01   +3.299263191777130e-01   -2.665641538727089e-01   -7.648801547887044e-02   +1.026141413216899e-01   +9.051324693416452e-02   +6.296628971551485e-02   -6.910632581349388e-02   +1.412274424625510e-01; +7.270834814695605e-02   -2.120895017109957e-01   +8.924648810609723e-02   +8.721032843047209e-02   +2.014314827331531e-01   +2.773514752879968e-01   -1.264681790093802e-01   +1.619236756291692e-01   +4.297074612218403e-02   +5.962166867943915e-02   -2.449092513153379e-01   -1.529148748532518e-01   -8.920466120178036e-02   +3.340032797355655e-01   +2.853190930867825e-01   +2.575717085498656e-01; +6.928004583955173e-02   +1.830979381516602e-01   -1.288626783430402e-01   +1.864718898815089e-01   -1.183132083613054e-01   -1.149634828095432e-01   +1.859854485663685e-02   +5.616711685386787e-02   -1.286177781503758e-01   -7.609052687786282e-02   +2.267471214422307e-01   -1.302695828930018e-01   +7.762035440462112e-02   -1.298759427534895e-01   -1.444158474787057e-01   -2.324247745011614e-01; +2.546620610315344e-01   -9.910146550056954e-02   +3.648403537604717e-01   +1.980971672646408e-02   -5.880505023675638e-02   +3.858069064047916e-01   -1.032227747852638e-01   -3.629715313701531e-01   +1.228427369105303e-01   +2.143364938620703e-01   -4.168506473335430e-02   -3.310408624540921e-01   +3.388928233586624e-01   +1.075898306627461e-01   -2.104852421432580e-01   -4.953767761836120e-02; -2.423280158516210e-01   -2.193547147068144e-01   +4.022873657094679e-01   -3.659945549923826e-02   -3.416384828249731e-02   -7.867350436399817e-02   -2.836155094298255e-01   -3.285037353242836e-01   +1.446466097010190e-01   -6.494970859098112e-02   -2.737416771281055e-02   +9.079092035502703e-02   -6.444368189188884e-02   -2.817630865288097e-01   +2.137428918000983e-01   +1.456411821891904e-01; +2.465845351755228e-02   +1.595418340391122e-01   +2.510142489781643e-01   -4.327881152513585e-02   +7.192651064022573e-02   -1.482834309664332e-01   +9.655515041789514e-02   +3.720587735931669e-02   +1.070778506866490e-01   +1.486527439224876e-01   -1.022808231189691e-01   +1.598071476405155e-01   +3.398886152272995e-01   -2.793212808475835e-01   +3.324650059341759e-01   -3.207582290864498e-02; -3.863635454923421e-02   -1.400896537565669e-01   +1.004869502025732e-03   +2.153294985174867e-01   +3.435943528566683e-01   -9.245708455096073e-02   +9.900150998449950e-02   -2.449713313663942e-01   -9.619458386242872e-03   -6.894942348708802e-02   -1.965438357414749e-01   +2.043314587769678e-01   -2.758434415074064e-01   -1.665190071624988e-01   -4.877483692935233e-02   +4.499411617741572e-02; -3.090762351215719e-02   +7.164161175311323e-02   -1.046396411878091e-02   +2.816447532977757e-02   +1.993834284880028e-01   -1.645487902053316e-01   -2.342797671777195e-01   +1.061572387810441e-01   -3.759797202709331e-03   +7.440713511394928e-02   -1.053812953643019e-01   +2.865724533336854e-01   -9.617225947190444e-02   -1.445072667746954e-01   +1.534401872660693e-01   +3.260415045789797e-01; +1.065996894240118e-01   -1.472366025837289e-01   +2.512420053365960e-01   -7.656065876773051e-02   +3.859362530662780e-01   +2.869619026354919e-01   -2.713819173139731e-03   +4.594327253316781e-01   +1.264285729309202e-01   +6.081736300316944e-02   -8.935152884700735e-02   +1.475225006329935e-01   -8.084460620624562e-02   -2.028639367347641e-01   -2.940372967768533e-01   +1.267501615048062e-01; +2.730145852962236e-02   -3.363471349751261e-01   +8.571962094427388e-02   +1.902930629721475e-01   +2.143842454529577e-01   -1.140888273624802e-01   -1.464154009800849e-01   -1.967543561780119e-01   -3.410562063191385e-01   +4.411572565264963e-02   +2.226695748142547e-01   +1.464873989297102e-01   +4.278027050202368e-01   +2.778643809583626e-02   +7.540798627324138e-03   +2.298396509517775e-01; -1.329538451424286e-01   +2.163287735005247e-01   -1.726901693501934e-01   +1.175554811769996e-01   +3.866815433578855e-01   +1.385064902878971e-01   -2.898520124870303e-01   +1.430121047087920e-01   +1.704148841582971e-01   +1.505035612863238e-01   -3.094247629635463e-01   +2.810057915747343e-01   -3.791453221212166e-01   -1.400667393673971e-01   -7.966723691351424e-02   -3.931983544747114e-01; -7.320106825906382e-02   -3.188494247327522e-01   +1.180346599163742e-01   -2.729514655496602e-01   +1.294027189758096e-01   -1.804125263206900e-01   +3.710109942949504e-01   -2.501771763912006e-01   +3.946683376900198e-02   +1.458135015621315e-02   -1.685737073764641e-01   +9.697694522736969e-02   +2.848856563225238e-01   +9.957985387771112e-02   -1.414308784531582e-01   +1.777488669506967e-01; -1.773644831522217e-01   +2.405703936043425e-01   +9.243722989176295e-02   -2.955173739186513e-01   +8.970095475603256e-02   -5.322206805428130e-05   -1.677383656677927e-01   -1.185838340596972e-01   -8.194095124820218e-02   +1.623103785434605e-01   +3.489678950879547e-01   -6.584220060741600e-02   +5.100426385672330e-02   +9.581752518495054e-02   +1.376705579263065e-01   +1.854400905962796e-01];
L2I_L1I_iGABA_netcon = [+5.078892367898949e-01   -1.965117013329487e-01   +1.804261751519388e-01   +2.899637577917428e-01   -2.096156106337512e-01   -1.680269131719062e-01   +1.129256495534239e-01   +3.846051791992287e-01; +1.146553501734746e-02   +2.804893283513208e-01   -1.896097605334330e-01   -6.755756838354927e-02   +1.312174431993961e-01   +1.170230860847699e-01   +2.247280691899902e-01   -1.327686521370982e-01; -4.414818009680779e-01   +4.226982588770847e-01   -1.315369465482035e-03   -1.162910585017180e-01   -2.291013967130841e-01   +4.820851236765758e-01   -2.392172077297870e-01   +3.079392239383365e-01; +7.263920505284760e-02   -1.103886364746053e-01   -8.180568260214444e-02   +1.380214288344283e-01   -5.344344604372673e-02   -1.061735061818507e-01   -2.161424548650306e-02   -3.960028203084472e-02; +2.569912527552576e-01   -2.410067716049889e-02   +2.899310211496099e-02   +3.419507457232872e-02   -2.286365871095971e-01   -3.223440568806746e-01   +3.987350562101097e-01   +5.527724324497640e-02; +3.234205218117653e-01   -2.093709954948459e-01   +1.101147950729013e-01   -2.980479971795802e-01   +2.259091734318104e-01   -3.373686599366157e-01   +2.137947057018709e-01   +7.696801890906119e-02; -2.984913707014267e-02   -9.134530630445105e-02   +1.390999804205734e-01   -2.623901655289283e-01   -6.043327940605055e-02   -6.467910779009228e-02   +2.373746458534716e-01   +2.545451289689856e-01; -1.065626941137013e-01   +4.149375124707853e-02   -4.494980227603930e-02   -1.468781841600036e-02   -3.003154123883579e-01   +1.429871124720088e-01   +4.044580473469180e-02   -1.980669456906443e-01; -1.873845096013975e-02   +7.214242111993202e-03   +1.536825578767275e-01   +6.992413797485499e-02   -2.963025174684328e-01   -1.216571168276049e-01   +3.188033222199229e-01   +3.265051493394767e-01; -1.188365429651615e-01   +1.995405170692334e-01   +1.038120497101543e-01   -1.531705598888595e-01   +3.898188783796995e-02   -8.849844478716144e-02   -2.022008254019836e-01   -5.296724577069249e-02; -2.355288210612963e-01   -9.548122113967641e-02   +5.819243329406587e-02   +4.123858434101772e-02   -5.474956806064993e-02   -2.869318207736132e-02   -3.468009205414579e-02   -1.635978514242486e-01; +4.382692717183316e-02   +1.239048374765914e-01   +2.175322789250489e-01   +1.628680758204855e-02   +1.970631427500438e-02   +1.667049469038580e-01   -2.744337179102109e-01   -1.256409533753828e-01; -2.491791466478742e-01   +3.026094908294312e-01   +2.485956404469342e-01   -4.869270088791541e-02   +3.609936971771440e-01   +8.733490203599430e-02   +1.147688199677528e-01   +1.277496395631148e-01; +4.022955007699358e-01   -9.364710298394308e-04   -1.064015950315563e-01   +8.311662999525893e-02   -2.832139991419877e-01   -4.030899596341795e-01   +5.326465025650653e-02   -3.172225558174621e-02; +1.868784586238519e-01   +4.055528452287217e-02   +1.914198837783391e-01   +2.864479109086193e-01   +1.984389910369143e-01   -1.923951329544799e-01   +1.229188988476949e-01   +2.425145972183491e-01; -1.755118043823105e-01   +8.769689373420109e-02   -4.216147355109223e-03   +2.418958668885240e-01   +1.999118281910196e-01   +3.907252490640660e-01   +1.779383221885268e-01   +1.188685737977116e-01];
L1I_L2I_iGABA_netcon = [-4.912146624306141e-02   -9.630697311973162e-02   -1.621711155904300e-02   +2.272116005919353e-01   -1.175856084556230e-01   -1.307257273417177e-01   +1.396059996636194e-01   +7.641461836808458e-02   -1.418056126281580e-01   +5.637876463562486e-02   +5.221123681070119e-02   -4.068790040419221e-02   -1.602442194096748e-03   +5.838428169421640e-02   -3.049582572591578e-01   +7.914088868890172e-02; +8.462233259795035e-02   -9.202478631037239e-02   -2.579224372088502e-02   -2.756841370579354e-01   +7.090632289666104e-02   -3.567727087244503e-01   +5.726070133260335e-02   -2.048172166109762e-01   +3.987455006923156e-01   +1.119939011602456e-01   +1.245927168068127e-02   +2.062706329461856e-01   +6.893912326838694e-02   +1.932247097061268e-01   -1.225866140192837e-01   -2.371787920655537e-01; -3.675682077283545e-01   +2.645693170554920e-01   +2.533790662814275e-01   +4.052733518111943e-01   +9.253591905765086e-03   -1.567775339438002e-01   -2.275484675730455e-01   -9.904615350344764e-02   +2.493227160723807e-01   +3.819246893720321e-02   -1.397276506743275e-01   -9.126243754205697e-02   +7.465313228339816e-02   -3.530554044370457e-01   -2.065085059045518e-01   +1.612573684833413e-01; +4.798123069161672e-02   -2.484820835499334e-01   -4.713574134789407e-02   -9.448174372573981e-02   -6.892386021941438e-02   +1.523773797775217e-01   -1.404879043771290e-01   -6.701799216515386e-02   +2.697404083443727e-01   -1.837772034553668e-01   -1.015236372115428e-01   +5.263465232628246e-02   -4.215294159304174e-01   +2.177057080144298e-01   +7.960468342801975e-02   -1.940537419113722e-01; -6.625467205982208e-02   +2.351788623840738e-01   -2.651148648974609e-02   +7.247931009788010e-02   +1.687838275780362e-02   +6.929113682731872e-02   -4.110416513149001e-02   +1.894154736073594e-01   -8.326067766254518e-02   -3.902517941329187e-01   -2.040483724432314e-01   -3.910976647402735e-01   -1.283785027649898e-02   +3.934275179659039e-01   +3.018427147120278e-01   -2.816733610820663e-01; -2.655604557077373e-01   +2.821234302811834e-01   +1.584554083296712e-02   +2.044116836303430e-01   +2.830372253243790e-02   +4.074147904170598e-02   -4.133233065578903e-02   +3.644802363034529e-02   +6.265855314501381e-02   -2.731979845835193e-01   +3.877110229815879e-01   -2.681804508090965e-01   +1.755313187085719e-01   -7.258580134164638e-02   +2.156615879492576e-01   +1.711022310128539e-01; +3.341585218748695e-01   +1.506520685715492e-01   +9.488647735828119e-02   -1.063820065833229e-01   +3.136773115873135e-01   +2.612312256786044e-01   +3.418642491370710e-02   -1.318433407028227e-01   +8.640201105556422e-02   +3.126940138610660e-01   +4.160234559327348e-01   -1.452283819750556e-01   +4.892612200854629e-03   -1.698688199175354e-01   +7.408009270813355e-02   +1.714495129929973e-01; -6.643609343213153e-02   +6.166082308756005e-02   -1.101084525248715e-03   +5.324539568378080e-02   +6.272518806262493e-02   -1.698157115345131e-01   +3.711054538425526e-01   +3.969165754194751e-01   -3.490717286560738e-01   -2.492214572724997e-01   +1.403333655238398e-01   -1.052968511205584e-01   -7.847123081582455e-02   +4.933827596183523e-01   -5.570046527942095e-02   -2.675891969267912e-01];
L2E_L1E_iAMPA_netcon = [+1.037455163829026e-01   -5.670117701068424e-02   -3.221652364039265e-02   +1.556536872698347e-01   +1.769282731563410e-02   -1.599881720944836e-01   -3.426617664173590e-01   -1.964054586992339e-02; -6.766304902586465e-02   +3.765253151494390e-03   +1.504451373899328e-01   +1.032947195490066e-01   -1.648836820536673e-01   -7.509677192509362e-02   -2.078800436529764e-01   -8.479576551421883e-02; -4.153903775354950e-02   -4.573992301375592e-02   -1.882980106076967e-02   +1.228711416220463e-01   -3.892485305828142e-03   +2.440472562364375e-02   -7.817243079827785e-03   -1.134931265340244e-01; -1.271123119308964e-02   -1.516269156720852e-01   +1.074386220792858e-01   -1.825848892739098e-01   -1.590444567573946e-01   +2.673463856396671e-02   -1.095610953123317e-01   +5.627764871831181e-02; +6.826243569263488e-02   -4.646078243211560e-01   +5.443270510161115e-02   -6.445153030079635e-02   +4.118360599151354e-01   -1.306724960477891e-01   -1.822716736515027e-01   +1.737361955687033e-01; -2.216435139843223e-01   -1.258146345034041e-01   +1.132250432302901e-01   +1.539578721701060e-01   +6.985226091314090e-02   -1.806725279523401e-01   +1.313087741798510e-01   +2.161684364067273e-01; +2.106347982162925e-01   +7.197318304826594e-02   -1.731275880599840e-01   -7.581957636653265e-02   -8.522439214961780e-02   -1.713186219508988e-02   -2.046086364307514e-01   +5.327863865836013e-02; -1.359467368764753e-01   -1.993740430071139e-01   +6.669763334273798e-02   -1.199761452105683e-01   -3.539434941971544e-01   -1.408653568732295e-02   -1.743234306296648e-01   -1.895425469864448e-01; +2.053473504359084e-01   -1.496382911671326e-01   -2.218420161412396e-02   -3.321273642123582e-02   +1.729741962403948e-01   -2.071629496813062e-02   -5.114134394739320e-02   -7.684450762012815e-02; +9.936581636405634e-02   +3.628805012557978e-02   +2.081109323001459e-02   +1.582231720011696e-01   +3.985595404625123e-01   +3.437025130145831e-01   -9.178966666068747e-02   +7.650906460979172e-02; -1.012216856233869e-01   -2.301873269591553e-01   +2.002548569716442e-04   -3.215694529654262e-02   +2.132637749766736e-01   +5.928398561161609e-02   +9.546220900771082e-02   +1.005750012919375e-01; +6.299314600256138e-02   +1.151826458042365e-01   +1.393996061528343e-01   -2.936279423511625e-01   -2.354451398765285e-01   +1.853011086732861e-02   +2.343498414621469e-01   -1.577981106324843e-01; +1.736525284847669e-01   -1.717282101354473e-01   +2.262912729450720e-01   -2.013404428920162e-01   -2.578387572837864e-01   -6.848884204003743e-02   +2.611027848503267e-02   -3.043555021722523e-02; -3.812722301956151e-02   -2.014950798888180e-01   -6.154676979347005e-02   +1.923472975486284e-01   -2.398661984772056e-01   +1.101343915292364e-01   -1.801383365163697e-01   +4.122288327653852e-02; -3.381504720943699e-01   +2.377906778138732e-01   +2.777621085938266e-01   +2.744583780463297e-01   +3.242879613084287e-02   -1.384641410995547e-01   -3.705913955790078e-01   +7.326858134285662e-02; -3.435917867595588e-02   -1.531552808425366e-01   +3.065271628183243e-01   -7.673882095942405e-02   -3.811051414413613e-01   +1.069014930336466e-01   +5.970233439042112e-02   +2.092769466518586e-01];
L1E_L2E_iAMPA_netcon = [+1.286009406562433e-01   -2.847836788800603e-01   +5.689930192135272e-02   -1.285451954590730e-02   +1.307517022803149e-03   +1.064958263016463e-01   +5.301037267686796e-02   +3.689907047490625e-01   +3.731668245739622e-02   +9.509365399390232e-02   +7.893386259959219e-02   +2.276838434657263e-01   +2.598756408343790e-01   -1.786225333214979e-01   +1.068685780520640e-02   -2.404973522025738e-01; -2.695454294774512e-02   +1.249800255736049e-01   +5.300008742390648e-01   +1.352138494902690e-01   +6.712765059163835e-02   +1.017285942939905e-01   +1.871826235764941e-01   +1.735635650642830e-01   +7.354124376705112e-02   -1.347703247941681e-01   -3.498687226572816e-01   +2.984134365195651e-03   +1.523826481449618e-01   -1.806632946351588e-01   -6.980038119867421e-02   -1.657154850804017e-01; -3.194948093973055e-01   +8.842579569665969e-02   -9.190753982974312e-02   -1.380247194574110e-01   +2.171521147696404e-02   +1.835186823634821e-01   -8.800626120180094e-03   +3.300725021448307e-01   -3.138088785226230e-01   +4.037042299310116e-02   +2.491963859688258e-02   +1.065023452181531e-01   -2.585878374246096e-01   -4.126320846231616e-01   +8.829516916556768e-02   +1.569362532702028e-01; +4.820614157773455e-02   -1.066471990104765e-01   +1.071781430158905e-01   -1.421000548526255e-01   +2.769130508019296e-01   -1.175640760630473e-01   +7.372172971472039e-02   -1.451622351658208e-02   -8.871872053019021e-02   +2.344837919424035e-01   -1.663906230936257e-01   -2.802493860879963e-01   +1.093636236331966e-01   -4.131739654183423e-01   -9.141525147682290e-02   +8.533952455453536e-02; +1.489349046862265e-01   -1.333302934420469e-01   +4.366581947078344e-01   -6.176698801301101e-02   -2.565344761100854e-01   -1.551445781766083e-01   -2.816831954070992e-01   +5.032177436499327e-02   +6.884399285674003e-02   +2.709105223878222e-02   -1.476577576530570e-01   -1.722663680179579e-01   +1.439770147464510e-01   +1.446013883260419e-01   +7.446729290967866e-02   -1.179002165280404e-02; -6.826717789208195e-02   +3.448570256324333e-01   -8.835457948233649e-03   +2.085653629741245e-02   -2.535821316046731e-01   +5.384060558157589e-02   -1.834526494373517e-01   -4.236094698110396e-01   -6.618340508096048e-02   +6.510340870675634e-03   +2.260076774879403e-02   -2.130362651387402e-01   +2.695736458686695e-02   -2.870062799606826e-01   -8.362289487355309e-02   +1.033878682005000e-01; -1.857595083412299e-01   +1.500789827646615e-01   +2.802977884507556e-01   -2.304629553945171e-01   +1.389557622928203e-01   +3.408235134967578e-01   -1.981303539237338e-01   +4.461629614745356e-02   +2.189189411611260e-01   +3.275450138481075e-02   +4.203130457718531e-01   +3.777749704021595e-01   -4.308127598456743e-02   +3.286359895133267e-01   +1.689866217132603e-01   +1.124043375387130e-01; -1.031574678239388e-01   -1.041879322722756e-01   -1.345528514063356e-01   +1.047279787204569e-01   +2.114983611499862e-01   -4.195065500233441e-01   +1.567003170259922e-02   -1.915131239403028e-01   +1.855168465018197e-01   -1.689104284203174e-02   -8.280542170575861e-03   +1.508229944915417e-02   -1.160133108099971e-01   -3.534064779250898e-02   -5.583267622920403e-02   +2.280820897353659e-01];
L2I_L2E_iAMPA_netcon = [+8.475947197667164e-02   +7.280264242100476e-02   -1.313912852537230e-02   -4.356727004526615e-02   +5.988228094872344e-03   -1.480052605413425e-02   -1.246947616533832e-01   +5.611141805432159e-02; +1.423233933848313e-01   +2.524180190649236e-01   +3.188097318874565e-01   -2.519121545349117e-01   +2.452130172350492e-01   +3.822364192595121e-01   +1.345732264037203e-01   -5.171153903399230e-01; -1.016274505025027e-01   -1.094353374621945e-01   -1.455077663180375e-01   -8.467889372968010e-02   -2.760382165102140e-01   -3.179730444741372e-01   -2.400132635496168e-01   +1.864902532419743e-01; +2.142110771560773e-01   +4.723654966559989e-02   -8.405616621354417e-02   -7.247713069203278e-02   +5.443207761786037e-02   -2.621979622104886e-02   +1.108402339134103e-01   -2.331599463668922e-01; +4.879035175117105e-03   +1.229357028505990e-01   +2.851885725011079e-02   +3.045484785678738e-01   +4.906460423477357e-02   -1.645694766387801e-01   -2.336172764114988e-01   -1.905584415879142e-02; -5.585484446139577e-02   +1.269740956745832e-01   -1.100273592027335e-01   +5.709876241627828e-02   +2.456307317420156e-01   -1.683162496982448e-01   -1.019474960980938e-02   -4.345639240308568e-02; -1.201294359444495e-01   +4.198730086508095e-02   -7.993874205407181e-02   +1.470308881117453e-02   -2.243827856442057e-01   -1.521809602440248e-01   +3.815884504835807e-02   -2.657769562494459e-01; +1.110051542947279e-01   +1.552784339562763e-01   +2.603780963457934e-02   +8.968185375270926e-02   -1.411666704455866e-01   +2.264346873866317e-01   +1.390786696748239e-01   -2.321209028359994e-01];
L2E_L2I_iGABA_netcon = [+4.541150381061276e-02   -1.466595390843882e-01   +1.341384354950734e-01   -5.611639571373916e-02   +2.478630136804917e-01   -3.330827384152622e-02   +7.470613193962633e-02   -3.001380687523114e-01; -1.456072411431569e-01   -1.904362663779587e-01   +2.326846731829635e-01   +1.350548398544739e-01   +2.936268280351954e-01   -6.571991480009391e-02   +7.019871552999124e-02   -1.309136886760454e-01; -8.948823942215284e-02   -3.053296461406786e-02   -5.394825577698497e-02   +4.798509888734151e-02   -2.886709008248754e-02   +4.411686596477543e-01   -1.658783531303913e-01   -7.970759439781809e-02; +3.869098600159901e-02   -4.133301942485423e-02   -3.855258910080457e-02   +1.169315364705077e-01   +3.725498557116486e-01   -1.848722891645832e-01   +6.160255145829897e-02   +1.530183516931318e-01; +1.893618782806902e-01   -1.713242760313567e-01   -2.467980524431050e-01   -2.305557656226996e-01   -3.583929738465683e-01   -2.011362657590992e-01   +3.469370300700087e-01   +1.363324409193587e-01; +2.071483788508161e-02   +9.143007977693658e-02   +9.553157900810327e-02   +9.409248088365185e-02   +2.963423123889322e-01   -1.428043253367736e-01   +2.230556345492202e-01   +7.483845659391869e-03; -1.158014563430358e-01   +7.226037406791898e-02   +5.849286122738370e-01   +4.803362588873811e-02   -1.289310375608095e-01   -1.897305044852535e-01   +3.760945659362173e-02   -1.405524401757413e-02; +2.053852155394949e-01   -2.399825692529398e-02   +1.445777071446578e-03   +6.775580360474433e-02   -3.697907235098386e-01   +8.285966378652568e-02   +1.735651466487096e-01   +1.486620354246444e-02];
L3E_L2E_iAMPA_netcon = [-2.185982397351597e-02   +5.224524415994701e-02   +6.300355436868377e-02   -4.311826366048168e-02   +1.592980282023517e-01   +3.215919689388562e-02   +3.999427810678950e-01   +1.729831810257657e-02   +1.046236963818659e-01   +1.240406321536517e-01   -3.300435243049074e-01   -1.473791611367111e-01; -5.281844827935116e-02   -1.410841086343132e-01   +2.869704605458971e-01   +2.245904276861146e-01   +6.073325037112810e-02   +8.689751440237317e-02   -3.412039819561434e-01   -6.032452736290465e-02   +1.196355459610936e-01   -3.695984213757065e-01   +1.155005230535155e-01   -1.192632055590087e-01; -4.542670717266306e-02   +1.032018531543341e-01   +1.703778818157656e-01   -1.071492360730309e-01   -1.687945674748755e-01   -5.250304938232012e-02   +2.123471898206956e-01   +1.896998058399386e-01   -8.711162928474650e-02   +5.089626315456875e-02   +9.024690849081626e-03   -9.403358911788023e-02; -4.410313719281247e-02   +1.475492496940334e-01   +5.035111609608336e-02   +3.433451127210003e-01   +1.033184725113264e-01   -3.752015865103236e-03   +2.002197479550406e-01   +2.512231487614363e-01   -1.569100382340279e-01   -1.176475403344475e-01   -2.675799866820459e-01   +1.172330038749112e-01; +2.421875381767684e-01   +1.477071262188535e-01   +5.503236752365775e-03   +7.663633581468454e-02   -4.076859222596286e-01   -7.571528534953313e-02   -9.430233354948542e-02   +2.786212949509645e-01   +2.182557425846959e-01   -1.803566044551904e-01   -3.027827725612120e-01   -2.233392164216329e-01; -5.068363150417149e-01   +8.232558307223042e-02   +1.019753679774038e-01   -6.240901957982070e-02   -6.975195998610620e-02   -5.401785712421515e-02   +3.131169911960970e-01   -3.587392026104222e-01   +1.013063462171317e-01   -9.982250231043793e-02   +1.940335383914643e-01   -1.104950597446762e-01; -2.129809733985177e-01   -2.740848903516039e-01   +1.056707109088548e-02   -2.375042837844109e-01   +2.617998593468088e-01   +6.576035722980285e-02   +1.099656467431691e-01   +2.895302058469537e-01   +3.710146612191061e-01   +6.639272072035678e-02   +2.061690111915923e-01   -2.386865185660170e-01; -3.411915968382399e-02   +1.953297543492736e-01   +1.865625332727366e-01   -1.437310438701948e-01   +9.474339560112703e-02   -2.100540272039328e-01   -1.198736762579513e-01   +3.166499809663622e-01   +1.137430441296839e-01   -1.081393728828703e-01   +2.574241265431948e-02   -2.654940055030146e-02];
L3I_L2I_iGABA_netcon = [-1.422988265528989e-01   +1.744114621534487e-01   -4.375356205226320e-02   +1.461565722922856e-01   -8.594919176556712e-02   -1.001199710971078e-01   -3.632915709308869e-01   -1.590470065786771e-01   +9.758281061354193e-02   +1.907227425628225e-01   -1.079649193226397e-01   +1.700401925157348e-01; -1.111128919177837e-01   +1.928950600637261e-01   +3.697004071435898e-01   +1.551795462767198e-01   +2.781449770381227e-01   +1.536856897064510e-01   +3.854292423815371e-01   +1.902434569551010e-01   -6.508653887609975e-02   +1.231101126158667e-01   +1.260298563467478e-01   -4.861224610976463e-02; +4.263256013735963e-02   +3.441932180287047e-02   -1.061264031256913e-01   -1.027698186709579e-01   +1.586396243702403e-01   +1.674614875250851e-01   +8.979377452105457e-02   +3.704193679282945e-01   +1.222014757772897e-01   -1.237795597345042e-01   +5.950393844168568e-02   +8.743284974840698e-02; +2.647868287201101e-01   -7.268280500408342e-03   -4.815421497682725e-02   -2.308086991304753e-02   +4.569511215245917e-01   +3.239286860704535e-01   -1.402106576743591e-01   +2.937855900108746e-01   -6.451996905404189e-02   -3.934686181616830e-01   +1.747772522461493e-01   +1.420702850671009e-01; +4.576612548883321e-01   -1.158957187577376e-01   -1.832985575130126e-01   +1.210900336439826e-01   +1.143890645690183e-01   +2.221111170693284e-01   -6.114381435618783e-02   -5.367988753159142e-01   -2.570883353101236e-01   -1.411476267763794e-01   +2.883257074829179e-01   +8.328862493340816e-02; +1.064525968134753e-01   +6.012933068554284e-02   +1.214169169220018e-01   +2.864674199454734e-02   +1.592558307220991e-01   -1.604846166338796e-01   -3.505800034984641e-01   -2.881407318039303e-01   -1.929716344504238e-01   -7.211709473423457e-02   -3.282224991516315e-01   -3.334890389946591e-01; -1.037877132688530e-01   +9.102582464852327e-02   +3.777437176313600e-01   -1.082429826637214e-01   -3.453276652125576e-01   +9.985879637300457e-02   +2.885322120921968e-01   +8.484040086214761e-02   +1.809269758594662e-01   -4.843335675875951e-02   +3.242839387553024e-02   +2.481136039722438e-01; -7.465941178412297e-02   -1.791330198507038e-01   -3.026440613319729e-01   +1.498984794605599e-01   +4.006470046298225e-01   -3.196921026449514e-01   +5.833718314065296e-02   -3.750095369618095e-02   -2.518213592422586e-01   +1.420699669920808e-01   -1.126215342238732e-01   -4.838831785839856e-02];
L2E_L3E_iAMPA_netcon = [-2.684808093660691e-01   -2.504346090168679e-01   +1.160198288425778e-01   -1.737694403439775e-02   +3.392836418141442e-01   +4.893461058347346e-01   -7.297039036469008e-02   -2.318285909234484e-01; +1.727866599371438e-01   -1.855629516992340e-01   +2.281644717424668e-01   +5.826625693446802e-02   -1.631749779203845e-01   +3.044072480247422e-02   -1.345240787614609e-01   -1.727885779045131e-02; -8.486070386981806e-02   -9.787708671997828e-03   -4.484748242527586e-02   -3.123057537790330e-01   +5.566605475064237e-02   +2.328714487180816e-01   +5.485742166744069e-02   +1.515340979652267e-01; -1.057628080668346e-01   +9.961453497148032e-02   +7.954441520060376e-02   +2.944357749762850e-01   -1.074408558059702e-01   -4.225637273438441e-02   -2.702300146019415e-01   +1.185601063059097e-01; -2.259239669448475e-01   -3.568141021483404e-02   +3.729296862960692e-02   -6.852171701793539e-02   -1.054745128687950e-01   -1.886613602020872e-02   +3.724746625889878e-02   +9.591536787813872e-02; -4.376479784840634e-01   -1.519587940436298e-01   -1.449710048151449e-01   +1.034639128282617e-01   +9.059884291334538e-02   -3.710340090237426e-01   +1.665584148285631e-01   -1.031582668311111e-01; +1.541590565165318e-02   -1.864315155915054e-01   +2.644954951808455e-01   -1.678282620497002e-01   +1.798764844596383e-01   -3.277710714978388e-02   -1.578502859955535e-01   -1.397398811711827e-01; +2.319489225435468e-01   -1.558536256042606e-02   -2.416837620902920e-02   +3.521325866401596e-02   +9.579032641786175e-02   +5.388713511318725e-02   -1.869315379493842e-01   -1.086124423703785e-01; +2.775252111204592e-02   -8.187064807558969e-02   +6.138403801477498e-02   -1.567295988248255e-01   +4.874864609901566e-03   +1.392554126874318e-01   -4.043785927304913e-01   -2.072559353819064e-01; +1.402778072328277e-02   +1.651099482723570e-01   -2.271837226105547e-01   -1.019984400789807e-01   +1.840822353814005e-02   +3.946024412085911e-01   +1.625747574979325e-02   +2.073866713229475e-01; +1.170735318599301e-01   -2.493526932075035e-01   +9.492282043143631e-02   -8.766419658347493e-02   +9.594001158210300e-02   +1.667339033599341e-01   +4.611048575002250e-01   +8.822530109710458e-02; +2.201705793990197e-01   +2.435235490631128e-02   -1.710017537235496e-01   +1.443749100848879e-01   +5.465650188194789e-02   -1.483343465532567e-01   -8.287197542122769e-02   +9.754996464956388e-03];
L2I_L3I_iGABA_netcon = [+2.680268630484486e-02   +1.330749935336980e-02   -7.950284531009481e-02   -3.010065878982799e-01   -5.433721187557838e-01   +6.213879807515343e-02   +7.848215048773594e-02   +7.554527836824822e-02; +1.749937486756187e-01   -2.384448355359467e-01   -7.333297226266573e-02   -1.574604856070387e-01   -2.341965419742523e-01   -9.698290062322300e-02   +3.051767919922840e-01   +9.750866466718501e-02; -1.897544465205343e-02   +2.495800466618673e-01   -7.618688907161886e-03   +1.228823875634761e-01   +8.395197116541323e-02   -2.017574910211158e-02   -8.812967558273072e-02   -1.901779748314752e-01; -2.012850119536423e-01   -1.719606474104464e-01   +5.509497019648517e-02   -1.974030477137866e-01   -5.449430929103867e-02   +4.486732849666444e-02   +3.219019072279162e-01   +1.101243372421983e-01; -5.340686132010236e-02   -9.800199656529239e-02   +1.410294065522606e-02   -6.374449533686030e-02   +1.529331921061326e-01   -1.545551905223512e-01   -2.864408985657881e-01   +3.152721941671061e-01; -4.040250654518909e-02   -1.571017780526394e-01   -3.774246985378766e-02   -1.936286352183427e-01   +4.520154188098716e-03   -1.528843825846589e-02   +1.515286451501231e-01   -1.810812275836833e-01; +1.319065368462373e-02   +5.059841521109429e-03   +1.190796517495382e-01   -1.588934411170165e-01   -5.050710315137726e-01   +1.426531756022845e-01   +2.343632509050674e-01   -2.675261187425175e-01; -2.834689500170809e-01   +2.032915162914779e-02   -3.772399621875834e-01   +3.604702287978831e-01   -2.954009752211745e-01   -3.607719776041365e-01   -2.157335963665801e-01   +2.064858878291538e-01; -1.989691248108016e-02   +7.612713010064087e-02   -3.676137816532821e-01   -1.222641432623584e-01   -2.339531770683763e-01   -2.044888540451781e-01   +7.901059805149335e-02   -1.770184675352844e-03; -1.429268922710480e-01   +1.326731705527202e-01   -3.359462915187183e-01   -2.733137779788199e-01   +1.084014317202776e-01   -1.568427383994790e-01   +2.583036385600243e-02   +8.847120617380119e-02; +6.942108795655508e-02   +1.127985234056161e-01   +3.614825441924821e-01   +2.382073057177876e-01   -3.952235446774068e-02   -1.652818682150183e-01   +8.553033545983985e-02   +1.390449723741487e-01; -1.490668001738805e-02   +1.220233779297620e-01   +2.576696582239423e-02   +8.085374630615517e-02   -1.017930640746411e-01   +9.974188202470879e-02   -1.128664089663191e-01   +4.486247922715512e-02];
L3I_L3E_iAMPA_netcon = [+1.144473388571869e-03   +6.829525845963752e-02   -7.963538266353917e-02   +2.493026909529895e-01   -1.535641425537024e-01   +7.199304778797681e-02   +4.478710085743625e-01   +5.315212550188211e-02   -2.106729633630725e-01   +2.314179445394204e-01   +2.526125095367727e-01   +6.577485494864421e-02; +1.929499183198680e-01   -2.906555981518591e-01   -7.869690822667000e-02   -2.391356066977292e-02   -2.607426632801279e-01   +1.819901928221845e-01   +9.820895041143522e-02   +1.375673573032724e-01   +2.140246448612489e-01   -8.642783326976897e-02   +6.182565165543356e-02   -8.116710146953698e-02; -3.292753176780500e-02   -2.883094343374817e-01   +1.246774979186302e-01   +1.685029843314234e-01   +6.784648709189671e-02   +1.634788385940305e-01   +3.140180375643381e-01   -2.430520769667295e-01   -1.347409206645440e-01   -1.862563067695175e-01   -4.685823538475323e-02   +3.268384775846767e-01; +6.359599101005323e-03   -1.777344036898319e-01   -3.377057879789163e-01   -2.634425167614038e-01   +5.331562748983550e-01   -2.650473011811659e-01   +7.651607645901824e-02   +1.500768254965019e-01   +2.016728391931872e-01   +5.200241752525939e-02   +3.321315563015816e-01   -1.223522478980816e-01; -2.549093519122019e-01   +1.043649872304087e-01   -9.829133329068938e-02   -4.933728554421743e-03   +1.073323414839509e-01   -6.303310119494777e-02   +2.353401190985877e-01   +1.423614470911132e-01   +3.922599904875542e-01   +1.121164837842801e-01   -4.920565729291183e-01   -1.405180831287266e-01; +2.112702523572650e-01   +8.074045705739309e-02   +1.864625116233502e-01   +3.207139047675696e-01   -1.332139769904745e-01   -1.989122251757067e-02   -9.710354733358463e-02   -2.645945391991034e-01   -1.593825874472363e-02   +3.409574844625021e-01   -1.998624429959228e-01   -8.932681379251295e-02; +3.978282719045253e-01   +8.353410927028210e-03   -2.592392292939856e-01   +2.034979523510801e-01   +1.818893870483231e-02   -2.602299407481345e-02   -2.289873785906378e-01   -4.091842356728426e-02   -1.841656713815180e-01   -4.077623870401788e-02   +1.155698050697613e-01   -2.724148904998029e-01; +2.005111906026208e-01   -1.037760562820103e-01   +4.179865204469160e-02   +2.595280765730364e-01   -3.041568967913300e-01   +4.265517901186542e-01   -2.046696508912350e-01   +8.159439356291766e-02   +1.163606009511850e-01   +2.117106462952287e-01   +1.680342912767723e-01   -3.613844440240585e-02; +4.725044583592007e-02   +1.051077556764794e-01   +2.620339947398905e-01   -8.372587592752848e-03   +2.837824482206468e-02   -1.484977019635119e-01   -3.916006137911184e-02   +1.445129123677877e-01   -6.115478591735672e-02   -3.235208352520000e-01   +1.556010623107048e-01   -2.130634687369174e-01; -2.942508133561758e-01   -9.216002072508241e-02   -7.911715817960441e-02   +1.871055984865685e-03   -6.251650280058663e-02   +1.902187494178599e-01   +1.021052434246900e-01   +2.182725230575346e-01   +1.226120846261351e-02   +2.257515383189902e-01   +2.937964727688295e-01   +3.661548990624461e-01; +1.396010280557380e-01   +5.873677768945644e-03   -5.978961945350990e-02   -5.316380309336185e-02   +2.505537993820321e-02   -1.528393826163261e-01   -2.082847501337492e-01   +2.420269759503913e-02   +2.340952231575493e-02   -1.167956475689680e-01   +1.318045721881274e-02   -9.564464378665091e-02; -1.355493285855465e-02   +1.013066959340020e-02   -2.363943040224843e-01   -1.568436156444769e-02   -4.957380916374309e-01   -2.967416417944524e-01   -2.069620849710766e-01   -1.627609228070377e-01   -3.401279886104808e-01   +8.383534631987706e-02   -2.772321589716387e-01   +1.470660070529194e-01];
L3E_L3I_iGABA_netcon = [+4.111380303190915e-02   +1.811344652348298e-01   -3.047717006476515e-01   -4.908256134463550e-02   -1.033878163972754e-01   +1.472899997792567e-01   +4.220320999706951e-01   -6.795042799874271e-02   +7.277990403839370e-02   +1.319606699318484e-01   -9.782240215256720e-03   +1.304591299842899e-01; +2.329121017831359e-01   -1.110532461496136e-01   -1.524026351759152e-01   +4.112007107844584e-02   -4.727349755650625e-02   +6.704900504014139e-02   +2.075034568388229e-01   +1.000570443007138e-01   -2.379439927419633e-01   +1.902452363697727e-01   +9.259938791570409e-03   -3.767753880157002e-01; -1.344740573787399e-01   +2.339772558767005e-01   -3.581295737840953e-01   -1.809995016047726e-02   +2.553471856886044e-02   -3.368360814455497e-01   +6.450962116551355e-02   +1.580771290788434e-01   -1.675716573778596e-01   -2.256035417301806e-02   -3.159058372355578e-01   -4.276740076944855e-01; +1.150983480022699e-01   -3.800843209714395e-01   +1.090618176518708e-01   +1.191847559140786e-02   -1.991103916263210e-01   -2.710094847802947e-01   +1.225530724679918e-01   -2.495441242496621e-02   +9.856768555011969e-03   -6.441291731298476e-02   +1.742160877849806e-01   -1.111958190145804e-01; +2.787848473829547e-01   -1.273939098374478e-01   -3.304538988766157e-01   +3.922660081516730e-02   -1.733766914844151e-01   -2.371237549791556e-02   +1.039370341727581e-01   -1.340085370740272e-02   -3.406690635888228e-02   -3.659334411996296e-01   +2.386777103029180e-01   -7.803253649349599e-02; +5.998055761948929e-02   -1.229674687062957e-01   -1.303029491287491e-01   -3.847697662168777e-02   +2.198640934563283e-01   +1.157506606641201e-02   -1.797385284666753e-01   +2.498276532994101e-01   -1.569344057424724e-01   -2.391262772931786e-01   -9.470722608811841e-02   +2.724586583465770e-01; -2.780147842812811e-01   -2.590715402068469e-01   -3.079882835090960e-01   -4.812857630681013e-02   -1.394359626462950e-01   +1.098807269112051e-01   +1.298933837154011e-01   -8.131105695543905e-02   -9.250987604458992e-02   +3.499525973410644e-01   +1.191530204941403e-01   -7.947621655337578e-02; -1.208929745939194e-01   +7.461127370766613e-02   -1.901930565094026e-01   +1.485096849922610e-01   -6.831838874221398e-02   +2.860489075238653e-02   -1.952056821810420e-01   +6.553915266268452e-02   -2.311331963071423e-01   -2.604247306733505e-01   +5.325499320097494e-02   +1.220015251002417e-01; -2.918687522045871e-01   -2.797863719039146e-01   +3.369348379721624e-02   -4.057009994753493e-01   +4.314645513014980e-01   -7.919710681328991e-02   -4.750218472473485e-02   +7.453511630007160e-02   +1.504577534336381e-02   +5.725044089335216e-02   +2.026836642264774e-01   +1.863766531589880e-01; +1.695970443130460e-01   -3.966977045140394e-02   +3.556108628358762e-01   +8.568518079635566e-03   +6.636692796164825e-02   -4.003152072094072e-02   -2.283575451391006e-01   -6.564062709023241e-02   -4.853415678585361e-03   +1.167852438067906e-01   +2.811678784453827e-01   +4.800118602394223e-01; +7.202065645149167e-02   -3.147582022519299e-02   +1.837659720866290e-01   -3.811242968156763e-01   -9.032907011805881e-02   -2.695100007796415e-02   +3.586250173478010e-01   -5.210452077125007e-02   -1.921238750296042e-02   +1.860231524204057e-01   -6.989830107014344e-03   +1.869567565921937e-01; +1.230524111596726e-01   +1.983725835432865e-01   -3.745897472341487e-01   +1.775298886193957e-01   -1.632585213110909e-01   +1.422360507030020e-01   +1.333236031250966e-02   -3.678870290487190e-02   +2.663336822946639e-01   +1.359187465187997e-01   +3.845591925590690e-01   +3.840741123389974e-02];
L2E_Input1_iAMPA_netcon = [-1.480219301046330e-01   -3.287451689575431e-01   -2.377983441596380e-02   +1.737637145683358e-01   +4.538325156062212e-02   -2.023335997708234e-01   +1.755692569476744e-01   +4.456401675014741e-01];
L2I_Input2_iAMPA_netcon = [-1.758192188374727e-02   -1.389989816198105e-01   +1.964402655157616e-01   -2.576078713899298e-01   +2.047138754631280e-01   -9.482979990918150e-02   +7.463223345447668e-02   +9.914325952715713e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
