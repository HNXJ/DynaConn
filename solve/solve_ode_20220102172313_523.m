function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.582454640348782e-03   -4.838759603972250e-03   +2.815871214886750e-04   +1.904614957432456e-03   -7.185478409482007e-04   +3.590947045817665e-03   +7.109317015738701e-03   -1.124321287169109e-03   -2.070860627340787e-03   +5.251631381494261e-03   +3.179119058985317e-04   -6.966757247467200e-04   +6.741626878360473e-03   +1.884223892369647e-03   +6.084112414669766e-03   +3.148285844594106e-04; +3.548341553027534e-03   -3.753149652495780e-03   +1.592818214738257e-03   +2.753838321810824e-03   +4.362526821627122e-03   +3.050101360039513e-03   +7.892902465289757e-03   -2.530090190172615e-04   -2.320409197680913e-03   +7.726917933636693e-03   +5.538607360667745e-03   +9.510852169613180e-04   -4.118018325387876e-03   -3.814739348277613e-03   +2.895195777966456e-04   -5.300509950674907e-03; +4.096571652234734e-03   -4.026411645340114e-03   -3.131595132485557e-03   +3.363990080603177e-03   -1.920186486985187e-04   +6.026077522868272e-03   +4.890939428593485e-03   +7.841062352236590e-04   +5.623465027932776e-03   +5.784912130766921e-03   +2.738960722282932e-03   +1.702521671277471e-03   +4.253597460519561e-03   +2.979372571692556e-03   +4.301351585201364e-04   -8.791113543389012e-04; +2.870589829240498e-03   +1.596763794478565e-04   -3.458102014276906e-03   -2.032729486819103e-03   -3.671778426683662e-04   +1.448266390060856e-03   +3.289397410863682e-03   +1.410494250500424e-03   +4.196736732257339e-03   +3.611234758687697e-03   +6.276969832826075e-03   +4.281568176005945e-03   +8.530764428343256e-04   +4.666505710375199e-03   -5.024119326648802e-03   -7.843487188222746e-03; +1.613907694404766e-03   -1.357889223851912e-03   +3.456410972113970e-03   +2.785057322877395e-03   +8.288488261086352e-03   -1.364216878417073e-03   -5.588626373398941e-03   +3.153467171347772e-03   -1.626543721531586e-03   +7.553106093887511e-03   -1.180048638767675e-03   -4.247509589267225e-04   +4.672266988125683e-03   +5.485976398600734e-04   +2.392783681620328e-03   -7.505496430608715e-04; +5.235485686488989e-03   -1.191272883589506e-03   +2.161103555698511e-03   +1.543688456605031e-03   +1.243284620583131e-03   -3.228356662035570e-03   -5.058542420415698e-03   -5.228565643801492e-03   +4.050866203840645e-03   -4.331827079662474e-03   -3.761053577205162e-04   -5.039479359894831e-03   -6.961895746947460e-03   +2.540610480646308e-03   -2.849686880723224e-03   +3.681866301481805e-04; +4.461697161932298e-03   +4.047402618358616e-03   +4.128044427574517e-03   +2.582111488712233e-03   -4.250002203666913e-04   +3.062611907037560e-03   +3.578592343914198e-04   -1.695075466494826e-03   +5.536036010917986e-03   -1.612318266451211e-03   +3.170240231251523e-03   +1.077133749127538e-03   -4.592493534179617e-03   +1.983270968331820e-03   +4.010453707397097e-03   -5.902845503908957e-03; -4.039343692914579e-03   -5.275201519164718e-03   +4.738922578259017e-03   +9.540467330452606e-04   -3.488129621542131e-04   +1.424323382923494e-05   -3.218887857787158e-03   -2.832996615708380e-03   +5.255680048770862e-03   +5.716732459662302e-04   +4.833159949851985e-03   +7.106241028639365e-03   +2.877192505301552e-03   +1.753798952273457e-03   +2.612805450109307e-03   +3.821390081141848e-03; -2.986461429746656e-04   +4.016742663473098e-03   -6.031327775700970e-04   +2.413218631699833e-03   -4.882141532182360e-03   +3.476254002702993e-03   -7.033709103655083e-04   -2.422592362629534e-03   +3.712651807708706e-03   +9.219418489599702e-04   +2.507119322681312e-03   +9.557357639713592e-03   +4.150410738530694e-03   +1.679946582307698e-03   +1.109626017695269e-03   +1.167395227002532e-04; +1.906896651721453e-03   +6.594475840943649e-03   +7.283487234321505e-03   +3.117239417658297e-05   -5.959976285606475e-03   -4.637773581814990e-03   +1.526216872941443e-03   -8.292836579413548e-04   +9.529540198211835e-03   -5.813495579808500e-04   -2.985767852685096e-04   -1.203373484066681e-03   +3.030118483325835e-03   -1.496591915314231e-03   +4.313368937576812e-03   +6.372441040234486e-04; +6.646429502266214e-03   -1.595159049077290e-03   +3.291661437210764e-03   -3.330889395249540e-03   +5.450203330157602e-03   +8.932176406181489e-04   -4.070301063591586e-03   +4.841849878790342e-03   -1.769736830360589e-03   -1.531262541942045e-03   +5.508722883406127e-03   -2.610138933745445e-03   +4.559594503408823e-03   -7.966788943800293e-04   +1.978191672402035e-03   -2.715692399964109e-03; +1.714074896206704e-03   -4.980247151232110e-03   -1.076245030095834e-03   +1.220953185941566e-03   +4.943634718671383e-03   -2.607836532132772e-03   -2.361473482960916e-03   +3.336279816754909e-03   +4.450600370546146e-03   -3.839960283524780e-03   -7.077449040943406e-04   +2.448106100228382e-04   -3.230856187802953e-04   -4.374741896128879e-04   -3.517319978379495e-03   +4.211539750298029e-03; +7.248659957571101e-03   +3.714558184243545e-03   +3.955072268167179e-03   -1.436047043682338e-03   -4.563800730395613e-05   +7.111999267421668e-04   +6.770023917233454e-03   +9.131367243608707e-03   +5.469180808896284e-03   +2.186989916574788e-03   +4.579645445742601e-03   -4.845580420868648e-03   +5.583062261829719e-03   +1.285622453568783e-04   +8.032759171307485e-04   +2.468120539193662e-03; +8.953988969745115e-03   +6.982069511445004e-03   +3.814490776358697e-03   -4.540121775267727e-03   +1.015097853464725e-03   +2.595004091901244e-03   -1.032630565228775e-03   +8.559956572568689e-03   -3.241412227118816e-03   -2.067716990897030e-03   +1.686274599562611e-04   +5.851609515842951e-03   +1.931466111593441e-03   -3.768049194778410e-03   +3.801149498264583e-03   +1.693700500917271e-03; -2.625455106305716e-03   -1.743595097627907e-03   -4.372650254611272e-04   +2.355040693140851e-03   -7.065087389195657e-04   +8.537971305412300e-04   +1.474905190090869e-03   -2.658656144740218e-03   +2.483609625305153e-03   +6.382520886087274e-03   -4.521555850204947e-03   +7.370306865714907e-03   -1.156684869733512e-03   +1.724673950989682e-03   -1.817025794626666e-03   -6.212903155343430e-03; +3.836838464383696e-03   +6.301213316504007e-03   -3.203965506310981e-03   +6.258047840844654e-03   +8.121915665676797e-03   -1.173662996346273e-03   +2.097538353500459e-03   +2.334134378898638e-03   +3.303385706752770e-03   +7.265840714042870e-03   +9.524845607377678e-04   -4.224510970504740e-03   -3.875237943428629e-04   +1.801695677769819e-03   +1.708844822316736e-03   +1.304914936875925e-03];
L1E_L1I_iGABA_netcon = [+6.001839597657226e-03   +8.149777019664222e-03   +1.998325607899482e-03   +5.326006507309976e-03   -3.590298742067473e-03   +5.208786738323002e-03   -2.588128752868831e-05   -4.713526668806623e-03   +5.014464338590829e-03   -3.237757615013274e-03   -4.561673631766096e-03   -2.109045085046770e-03   +8.521895432311575e-03   +2.466317756475679e-03   -2.926356733013277e-03   +4.559966330843086e-03; -2.248234027588421e-03   +1.713205164975958e-03   +1.004561906071818e-02   +5.243160369521016e-03   -4.012660167737411e-04   +1.103082368900044e-03   -5.531987358263333e-03   +3.636223876012220e-03   +3.994072654798217e-03   -6.496184955519403e-03   -9.773928720154998e-04   +1.998683929280524e-03   +4.627301547930926e-04   +3.358833710556892e-03   +1.865828494774746e-03   +5.144205955521978e-03; +9.291311136701780e-03   +5.190809181405357e-04   +5.976129092157475e-03   -1.123362237101567e-03   -3.337613138566492e-03   -1.384063312979616e-03   +2.033007251098758e-03   +3.512285727806098e-03   +5.362301834106467e-03   -2.273015178329675e-05   +6.996649960115199e-03   +1.442623778886650e-03   +2.001787281401758e-03   +6.714764703811920e-03   -1.538729078282229e-03   -4.285839127471839e-03; -3.891668718573744e-03   -3.246782574033097e-03   +3.846413781792340e-04   +2.555700774495709e-03   -2.679428215757463e-03   +4.907173775611556e-03   -6.071930983965988e-05   +3.235074620353909e-03   +3.494955397527851e-03   -4.381616793433706e-03   -5.535640509639424e-04   +1.424207641348516e-03   +2.837007185791153e-03   -5.049411941945622e-03   -1.592728992801571e-03   +6.247379091848831e-03; +8.813532288658347e-04   +1.447360320901249e-03   +4.120276257724064e-03   -1.049814983296216e-03   -6.365223610630358e-03   +5.427158120053806e-03   +3.117300931529301e-03   +7.483261420498398e-03   -5.694458564034889e-03   +4.603006926899919e-03   +2.806005996291680e-03   -4.470166141077183e-03   -1.538976736698814e-03   -3.421151537497294e-03   +8.227042438032954e-03   +2.437516049383720e-03; +5.741962062566857e-03   +6.261216288834200e-03   -9.475626416899279e-04   +2.057097917324408e-03   +3.556170872597215e-05   -1.547287999557850e-03   +6.603202759073348e-03   +1.275943617493847e-03   +7.029406078365673e-03   +9.596688257613559e-04   +5.154580938530572e-03   -3.180662419990416e-03   +1.309472025830798e-03   -3.128425817949124e-03   -2.102684496246669e-04   -2.397870042351983e-03; +1.510155018603304e-03   -1.099534161111815e-03   -9.591067814340483e-04   -2.458089419582412e-03   +4.336325080812151e-03   +1.889459100405331e-03   +3.709542406714571e-03   +4.505561351639543e-03   +1.830951141744738e-03   +7.826744255398838e-04   +3.139393569484670e-03   +3.796667064383125e-03   +9.019179556035116e-03   +5.398604952131538e-04   +2.559090144795501e-04   +4.763707742465239e-03; +1.235565743133083e-03   -3.956538428576807e-03   -1.286545208651757e-03   -5.054265945314598e-03   +2.132465818636263e-03   +1.871677098288205e-04   +7.737729265628699e-03   +4.449075608966992e-04   +8.415585741148796e-04   +1.781742655908512e-03   +2.797778342999168e-03   +4.256021158805433e-03   -4.925702854584218e-04   -2.408307553152001e-03   +2.128743517737546e-03   +3.304146072720994e-03; -1.705384790409467e-03   +4.114156724417345e-03   +1.054226234488542e-03   +1.225263116248362e-03   +4.135534700474080e-03   +3.674200308998997e-03   +4.700390761745779e-03   +4.851161231151245e-03   +2.026793685866112e-03   -2.613369751994807e-05   +1.101975622104114e-03   -1.677058289129750e-03   +4.376813639041743e-03   +7.027100328743509e-04   +2.061296321336703e-03   +3.841880292562063e-03; +9.881621734986060e-04   +8.323371911046429e-03   -4.177690404079754e-03   -1.247706598120175e-03   +5.026136510324552e-03   +1.407296489107378e-03   +9.600761551034435e-04   +3.878721894223021e-04   +1.007197481827135e-02   +6.342467468857456e-03   +4.582121413150565e-04   +4.033243736321299e-03   +2.749861191932835e-03   +5.106793133105170e-03   +2.957574236775880e-03   +1.185794161193860e-03; +1.258913090585325e-03   -6.399132486534616e-03   -2.023696985245338e-04   -1.893744600523274e-03   +1.304708072034555e-04   -7.422875040321423e-04   +6.221780250137404e-03   +7.566215393631182e-03   -1.148449364114218e-04   +2.350168487468916e-04   -4.771706316776534e-04   +3.493108231183282e-03   +8.143069998941001e-04   +6.699802363796872e-04   +3.394465135388041e-03   +9.744840363110725e-04; -5.517646581795608e-03   +2.092481042930678e-03   +2.693286531166654e-03   -1.606026666391540e-03   -3.366978062586847e-03   -2.989626965871422e-04   -1.862027951922515e-03   +8.524441819815686e-03   +2.300689838062667e-03   -4.029160292314574e-04   -5.073579836444134e-03   -6.668377312402876e-03   -5.864549788317398e-03   +7.925526788690035e-04   -9.006505142476396e-04   -2.989106882895112e-03; -1.759487694284128e-03   +2.749199731877309e-03   +2.215567967580336e-03   +2.898729994619684e-03   -3.429733623183930e-03   -4.522703424985431e-04   +6.992241280304932e-03   -5.054376554619875e-03   +4.545767637125377e-03   -1.537452201286347e-03   +4.152958809034345e-03   -1.409095442573381e-03   +1.984198186603203e-03   +3.032374710724732e-03   +5.042476967969487e-03   +6.724565027753604e-04; +7.003037504052102e-04   +4.617774491273094e-03   +1.579964601742319e-03   +5.066004411461182e-04   +5.175881334666822e-03   +6.093067667173114e-03   +5.542343277417977e-03   +7.754021438748382e-03   -2.819438209472287e-03   +2.235976309273791e-03   +1.141957003353417e-03   +4.616636487703611e-03   -1.024665432419832e-03   -3.848579093738181e-04   -8.884738195757649e-04   -3.021478035464525e-05; +4.942524418051193e-04   -6.146586707061088e-03   +6.311991192879049e-04   +2.776226938868824e-04   +1.278898057987627e-03   +6.901257746909478e-03   +4.410195119482987e-03   +1.787072923820259e-03   +3.103498770905381e-03   +1.809845025844969e-03   +1.335528594257953e-03   -2.607359022211221e-03   -4.256152014634870e-03   +1.253303013843000e-03   -4.857354756459757e-03   -1.941734996199599e-03; +2.974922893312019e-03   +5.649347747694759e-03   -2.467427412451985e-04   -9.149783443656843e-04   +1.720034355793797e-03   +7.338136606158878e-03   +2.157940805577866e-03   +1.265472178456125e-04   -1.828876475313015e-03   -2.939737127012604e-03   -3.279187881054700e-03   +4.849393226625754e-04   -1.840579735432644e-03   +8.166886044589365e-03   -1.220694165518299e-03   +8.025608650456741e-03];
L2I_L1I_iGABA_netcon = [+4.992030424767016e-04   +1.798750234603406e-03   -3.391689265502791e-03   +2.518393199027445e-03   +5.166302483448202e-03   +2.617633429588784e-03   +7.420401416967857e-04   +4.137161859781206e-03; -1.472315446840066e-04   -5.783930037803305e-04   +5.213200722588518e-03   +1.275895523235397e-03   +1.438092868097571e-03   -2.178861600441487e-03   +8.799848113829825e-04   -5.192145245264498e-03; -9.502219315417415e-04   +6.362973045324216e-05   -3.108121606354074e-03   +3.327757150214748e-03   -8.050666188371319e-04   +6.967558974700180e-03   +2.133248522097708e-03   -3.081842485856685e-04; +1.329299961017706e-03   -2.369799043164969e-03   +3.996692845698828e-03   -2.518342549595986e-03   +3.593115121568236e-03   -8.905433170728948e-04   +2.143130520126722e-03   +4.596969235577443e-04; +9.114376062072712e-05   +5.247785523453996e-03   +8.007717227863267e-03   +2.712744923526053e-03   +9.308292668092557e-04   +5.977610758687590e-04   -1.334797174943432e-03   +1.182241525352327e-03; +4.436950586008404e-03   -1.912827550916781e-03   -1.367126653396819e-03   +4.729891691080009e-03   +3.461232209882119e-03   +3.332116824384983e-03   -6.611475511036592e-04   +6.169095583062446e-03; -5.401025634135044e-04   -5.162740041990849e-03   -2.993763001842926e-03   +4.179535451798068e-03   -5.934153423706772e-04   -1.076894911924285e-03   +1.841515293952661e-03   -2.679150871649963e-03; +4.587270825594158e-04   +2.013060723965948e-04   -1.403209713649875e-03   +2.413669397256565e-03   +2.264687565242149e-03   +4.467551987281078e-03   +4.855511765467326e-03   -2.400673665357888e-03; +3.240795814495841e-04   +3.239346850433112e-03   +4.104132850653993e-03   -4.175362078893979e-03   -6.524253338107081e-04   -3.395524196886357e-03   -9.112286223526768e-05   +4.659875702858958e-03; -7.512071503627040e-04   +4.359698219729168e-03   +5.627537426014379e-03   +5.054446223765364e-03   +2.262673508907718e-04   +2.575446700822049e-03   +2.952841305405450e-03   -3.032159767463649e-03; +2.427861070281663e-03   -2.669089293732437e-03   +5.124858781426163e-03   +1.947038776976201e-03   +1.623860689707905e-03   +3.855938013549646e-03   +4.971185948841712e-03   -1.515157594109509e-03; +7.000293709845298e-03   +4.913346496428978e-03   +2.551378229905018e-03   -3.972026169859122e-03   +2.445155005878500e-03   +2.949541288960581e-03   +2.206998970044004e-04   +2.393760250563773e-03; -2.754252832683689e-03   +6.244102538370568e-03   +4.383625335781030e-03   -2.690043932767417e-03   +1.003053010952075e-04   +6.388015066010232e-03   +4.606178388660835e-03   +3.282873813673821e-04; -1.744083975276700e-03   -1.204339933878959e-03   +1.077013730814902e-05   +1.851286915734145e-03   +2.446619281002668e-03   -2.347215257516397e-03   -3.603150217841184e-03   +8.387336897313736e-04; -3.427818973196660e-03   +1.067996122497681e-04   +1.143701738183938e-03   +3.177876912999768e-03   +1.942100033148590e-03   +1.465747820347789e-03   +4.624396093695341e-03   -2.964370754789635e-03; +4.009518041358377e-03   -9.953141210480643e-04   +7.135461386709865e-03   +7.517279946724385e-03   +2.004257043461852e-03   -1.252425309850877e-03   +9.217063681982618e-05   +1.661110730662472e-03];
L1I_L2I_iGABA_netcon = [+4.532414806482860e-04   +1.712550305541315e-03   +4.696568157826825e-03   -2.217871946226537e-03   -1.448673416841414e-04   +5.612303045187528e-03   +1.786477567363738e-03   -2.370088557793088e-03   +4.366588070294616e-03   +8.129776709305033e-03   -4.428550943552703e-03   +1.904856729198398e-03   +5.822005428770157e-03   +2.822708663768695e-03   -3.885108125641056e-03   -1.198484205801484e-03; +1.402608580651385e-03   -3.331225444116128e-04   +2.202564654277101e-03   +1.482060896824262e-03   +4.477222045635671e-03   +6.311819512337290e-03   +4.004357246455786e-04   -3.135869121492193e-03   +3.800015207559258e-03   -6.286906249176231e-03   +4.274127682858279e-03   +2.493715130296107e-03   +4.358571743109866e-03   -7.913820317218536e-04   -2.988788249724116e-03   -9.458635028407815e-04; +7.054542215951309e-03   -2.770122520985357e-04   -8.233455459123252e-04   +1.755709308213827e-03   +2.302611061074502e-03   +3.715318257105794e-05   +1.111308067654581e-03   +2.159018395178889e-03   -1.732108893256445e-03   +1.643590894629367e-03   +4.524470620177387e-03   -5.974394894706130e-03   -1.594968977341769e-03   +9.055956033650050e-03   -3.273428792152634e-03   -1.560311347014786e-03; -1.615535603704408e-03   -1.430215146120431e-03   +7.618012150315131e-03   +1.592473514794224e-03   -7.493048245862054e-03   -8.421251460764417e-03   +6.736315831369930e-04   +7.020175130311205e-03   +5.626080307691362e-04   +1.371820794328917e-03   +4.170203287497860e-03   -9.235833496678393e-04   +1.234444583881955e-03   -5.533118437553044e-03   +9.978974757637710e-04   +5.617667465983412e-03; -3.463692532298295e-03   +6.220092561956039e-03   +2.988876720226933e-03   +1.761560842100301e-03   -6.088684507122703e-04   +3.447076835161255e-03   +2.309160987925851e-03   +4.102472747803967e-03   -1.162366181288433e-03   +1.104036643612252e-05   +8.647791393718606e-04   +3.884809419973858e-05   +7.729824423599021e-03   +8.727610688314146e-04   -1.454653872987902e-03   +7.292120515759961e-04; +5.572579291513249e-03   +3.919290013671650e-03   -3.488605146299422e-04   -1.840286117420496e-03   +7.761832990480717e-03   -8.664373512538251e-04   +4.363136400274460e-03   +5.145228304055311e-04   -4.143154660984106e-03   -9.003083970723857e-04   -2.518709223493381e-03   +8.008761114788062e-03   +1.878568181951556e-03   +2.100995481848745e-03   +8.320282818003153e-03   +4.731207748913719e-03; +1.649433717602396e-03   +8.686382035134846e-03   +2.764499422142816e-03   +1.425026018408879e-03   +1.420458470785226e-03   +1.105189189914839e-03   +9.083347311590473e-04   -1.750825582835767e-03   +1.836863771513232e-03   +5.911221974051232e-03   +2.195705865974109e-03   +4.276262841698606e-03   +7.247145212481369e-04   -2.589391449586645e-03   +2.259481361256504e-03   -3.529170687946935e-03; -2.834663345247171e-03   +4.719296176435800e-03   +8.845239413273669e-04   +2.700067948660217e-03   -4.894358254444851e-03   +3.144360185210654e-03   -5.151515471030830e-03   +3.768777767076090e-03   +4.612634984491973e-03   +2.436022041044779e-03   -1.502907472312855e-03   +1.910504440705295e-03   -2.914080356392261e-03   +1.295158077801530e-03   -1.482775389421234e-03   +3.219806184562394e-03];
L2E_L1E_iAMPA_netcon = [+7.454650834873014e-04   +3.728302993612808e-03   +1.830792099454838e-03   -1.203575198093528e-03   -5.974053535416275e-04   -5.142630951044268e-03   +1.067465353160366e-02   +8.986038441007383e-03; +2.536687641387496e-03   +2.809018914321166e-04   -1.072559336673503e-03   +6.499064423717505e-03   +7.191187463775769e-03   -2.429362143645937e-03   +4.710223587046378e-03   -7.478301545483597e-03; -3.616008403633415e-03   -4.098045180034966e-06   -1.163985442987237e-04   +2.592858137093236e-03   -5.323684354924362e-03   +5.609070145463224e-03   -1.085977399124260e-03   +1.466849952882961e-03; -5.860460962916307e-03   +4.990781646885310e-04   -1.330871744900933e-03   +1.194547257081899e-03   +3.422194442939628e-03   -9.737661792155895e-04   +1.912738633204888e-03   +3.599886479873320e-03; -6.089662142069459e-04   +5.790910976033175e-03   +8.563852158779792e-04   -3.244432828563869e-03   -4.182654136489493e-03   -1.228341843644049e-04   +1.578664667154823e-03   -2.283816896408596e-03; +1.365850191201782e-03   +5.171249402453740e-03   +5.582396515722944e-03   +3.452614277709098e-03   +4.603056889683234e-04   -3.073823004518970e-03   +5.490056057496862e-03   +4.453877318280355e-03; +1.662168989826389e-03   +1.780037480865519e-04   -1.885326970282915e-03   +1.983031627151033e-03   -3.012236586885558e-03   -6.163070196246832e-04   -4.022301832713263e-03   +7.923086205656031e-03; -6.175700838242582e-03   -3.474115482637037e-03   -4.103502690602445e-03   +4.496698749783264e-03   +6.043452869150380e-04   -3.917574261977307e-04   +8.252931616342173e-03   -1.248207769204073e-03; -1.046349619573408e-04   -3.909952189987952e-03   +1.657382130696220e-03   -7.042886078702060e-04   -6.392716350761185e-03   +6.439240553899522e-03   +2.869155074210561e-04   +5.740976466319566e-03; +3.948120994060598e-03   -4.175970751701330e-03   -2.642572716296091e-03   -1.338691193409642e-04   +3.503837090344126e-03   +1.665410241825825e-03   -3.249378946171584e-03   +2.781265076324172e-03; +3.948255921830177e-03   -9.956586022313110e-04   +2.109220799731743e-03   +1.550267756974283e-03   +4.715908107731892e-03   -1.921419488051071e-04   +2.015880055882970e-03   -3.375125955484511e-03; +4.613122111445268e-04   -2.978103236689314e-03   -1.565790456118103e-04   +1.003194219331880e-03   +6.811072822672105e-03   -1.886797394515466e-05   +7.502860838336530e-03   -4.638353935194298e-05; +4.862919113347052e-03   +2.694600423824886e-04   +6.177280653519720e-03   +3.911497284352651e-03   +7.149902192879307e-03   -1.831982658032255e-03   +6.961922665698131e-03   +7.399510091680227e-03; -1.381942635156903e-03   +2.646439350072392e-03   -1.576253818211449e-03   +5.004308851952057e-04   -3.838297626183086e-03   -2.731877011600907e-04   +3.216528266268424e-03   +6.264506929491093e-03; -4.818867009399549e-03   +2.333828799074108e-03   -6.024259460966585e-03   +4.980033796482615e-03   +1.435884686868700e-03   -4.072984441290693e-03   +1.733966957617761e-03   +3.347938546366213e-03; +2.730967944750104e-03   +4.513324522149999e-03   +9.216105859781323e-04   -2.661909154999875e-03   -4.861250456855295e-03   -5.342710176599236e-03   +1.838594166621337e-03   -9.491090489972255e-04];
L1E_L2E_iAMPA_netcon = [-2.695532657711496e-03   +2.224442011064595e-03   -1.401891602602175e-04   -8.016265493298029e-05   +4.776191188584402e-03   +7.032704989478288e-03   +9.787987404673299e-04   +5.954816322497607e-03   +2.449519072171811e-03   +9.392800139637588e-04   +3.241776145493491e-03   -1.950148930566468e-03   +3.808903417984218e-03   -2.645185842116777e-03   +4.180452192250911e-03   +3.713251939083101e-03; -3.254017304029965e-04   +6.864830908532888e-03   +6.273445458746030e-03   -4.269611234585330e-03   +6.979002070026191e-04   +5.271814588158925e-03   +3.208916627644091e-03   +5.399426602062577e-03   -4.840297913907862e-03   -4.529549638395632e-03   +1.504221990768973e-03   -3.205190704407420e-04   -5.426332629890895e-04   +3.289419377851936e-03   +4.775640258210015e-03   +1.742541988240265e-03; +5.017519429098390e-03   +3.029441540786664e-03   +8.028441303641302e-03   +9.144702194686613e-03   +1.682164674406240e-03   +1.939406199599839e-03   -3.963647077704325e-03   -3.000925085012820e-03   -1.013103479703936e-03   -2.459491032229706e-03   -1.601125716611442e-04   +1.926548333352694e-03   -5.509516482749507e-03   -7.891986106735476e-04   -1.313295726254452e-03   +1.826413508790700e-04; -6.306174001204952e-03   +1.759130520136288e-03   +9.003391966588572e-04   +3.633299530582533e-04   +2.511730722083476e-03   +7.079737744019745e-03   +4.170769398265073e-03   -8.232087739834220e-04   -1.034067559108676e-03   +6.274433215460555e-04   +2.333107427143055e-03   +3.298411087735060e-03   -4.414115230628927e-03   +8.203325912401338e-04   +3.916467290151741e-03   +1.462762147140012e-04; -1.005166846870180e-03   -2.553783185605757e-03   +5.450335857046032e-03   +5.129207591162133e-03   -4.250822237024972e-03   +1.484682358171494e-03   +1.953522773040586e-03   +2.130350848525909e-04   +2.336836907000297e-03   -5.033995291022565e-03   -5.117186478980314e-03   +4.531512741022111e-03   +5.958493732813482e-04   -4.068335472604124e-03   +7.085760863526409e-03   -8.723989147554226e-04; +1.075118865804942e-03   +5.635707261172944e-03   +1.300726651235972e-03   -3.660300904029475e-03   +6.147406439875783e-03   -3.963164336265358e-03   +1.277092334350032e-03   +4.462066256710185e-03   -2.133923351348522e-03   -1.944348357088315e-03   +1.026970484185845e-02   +3.330305455592448e-03   +5.073625557465996e-03   -4.758040256666808e-03   +2.823766849364516e-03   +3.629219180130183e-03; +4.705716054852495e-04   +2.764907997018261e-03   -3.585442874889274e-03   -1.195887106756887e-03   +3.814327912064216e-04   +3.744400708601993e-03   +6.788934075564892e-03   +4.308186220664531e-03   -2.527653558592760e-03   -5.130230898669433e-03   -3.772468295713773e-03   -1.699859840521882e-03   -4.553314237668370e-03   +4.590869823639398e-05   -5.141288352474103e-05   -1.074264921928386e-03; -6.248798924977886e-03   +2.535788006845971e-03   -4.323965732117623e-03   +3.104662846199228e-04   -1.280946933524035e-03   -1.278650110073187e-03   +3.955280561511025e-03   +2.407739944737383e-03   +4.687381890685367e-03   +1.098605581851841e-03   -2.311346188417581e-03   +9.483056398208936e-04   +3.349299412221858e-03   +2.497837639883166e-03   +1.863314579535313e-03   +7.569147105556489e-03];
L2I_L2E_iAMPA_netcon = [+2.596132041097809e-03   +7.023632917453303e-03   -6.776426588688341e-04   +5.939383351811100e-03   +9.786519105306024e-04   +1.655807920424086e-03   +5.560423733146859e-03   +1.054242031963074e-03; +9.325514196015425e-04   +1.285345822838717e-03   -8.292335273014840e-04   +7.776608961056641e-03   -1.399936377015294e-03   +1.366471803811832e-03   +2.242808041747745e-03   -8.003141895825260e-04; +4.176065325216884e-03   -2.212292951314852e-03   +2.384656051018493e-03   -1.104504386197153e-03   -1.910642462743931e-04   -1.906845703914350e-03   +1.051699992214203e-03   -1.091735989391517e-03; -1.813144647417983e-03   +3.562059418197840e-03   +5.400382810917380e-03   -1.653484160032616e-03   +6.449800550571799e-03   +4.622193333582179e-03   +3.610427761005444e-03   +8.956946503547142e-03; +2.949637222399604e-04   +2.759792792306464e-03   -2.022741777886074e-03   -5.454293061233595e-03   +1.662680598513071e-03   +5.655742175149678e-04   -7.544077807403074e-04   -1.115494554167271e-03; +5.812942101764596e-04   +2.860644587689504e-03   +4.549192157110846e-03   +1.647246798120431e-03   +1.998069758775895e-03   +2.078151157416917e-03   -1.474980527094669e-03   +2.854059170177562e-03; +9.536252783622894e-04   +7.471421187682152e-04   -3.359757656294605e-03   -4.404263612924836e-04   +1.658876173147451e-03   +2.706035736646999e-03   +4.867562261302443e-04   +5.097294655159812e-03; -2.079874324273292e-04   -1.505124305759984e-03   +1.797834678387942e-03   -5.304518229981028e-03   -1.549096547032767e-03   +1.026109364466402e-03   +1.238162756479184e-03   -2.244292980667535e-05];
L2E_L2I_iGABA_netcon = [+2.292699879363538e-03   -2.066352245496212e-03   +6.006364967274119e-03   +3.296589550797380e-05   +3.826589927530153e-03   +2.051796192008466e-03   +3.349416666628452e-03   +1.100838838857400e-03; -2.332027774641110e-03   +8.226473565284238e-03   +2.769397504317703e-03   +4.644070642029973e-03   +2.654124626769706e-03   +4.857256611693065e-03   +6.837318804263582e-03   +4.042967256049325e-04; +4.920774148411849e-03   -2.098502032917263e-03   -2.920200993979992e-03   +1.674003589091863e-03   +1.489693184985395e-03   -5.187987156548950e-03   -1.553109727056653e-03   +3.173682613710507e-03; +7.359552566301886e-03   -2.530079792639599e-03   +2.365305655394567e-03   +7.695958515507056e-03   +3.483131400146749e-03   +1.001183338009646e-03   -2.716689801992708e-03   +3.121092872825875e-03; +2.769311787724032e-03   +5.587562786529127e-04   +4.435070687467645e-03   +6.797333418838805e-03   +7.912097282360545e-03   +2.772828583218502e-04   +2.441800261172816e-03   +5.670325491289890e-03; +1.931947828915578e-03   -3.302149380578572e-03   +1.624053745832366e-03   -1.018886949562162e-03   +1.999513823779369e-03   -1.201115935088145e-03   +6.114052031464549e-03   +7.685955315724799e-04; +4.360885344073617e-03   +3.403784218056447e-03   -1.950734309998512e-03   -5.778318207922856e-04   +2.290511600346137e-03   +7.386881911500606e-04   +2.647028158849982e-03   +2.385665228921248e-03; +3.371944997335643e-03   +4.223631553335468e-03   +3.064040125906471e-03   -3.426990843507460e-03   +4.936179476515457e-04   +1.865672308864052e-03   +3.841328532534877e-03   +8.912431490084150e-04];
L3E_L2E_iAMPA_netcon = [-1.271577476562517e-03   +6.342679408928264e-03   +8.766387572009047e-04   -4.663042236733080e-04   -3.735531083685459e-03   -7.977853079851167e-04   +1.208536840079787e-03   +5.762725363713337e-03   +6.811210743180693e-04   +1.101665493513704e-03   +2.444270344065233e-03   -2.061922908085293e-03; +3.982378923141379e-03   +5.625174681809111e-03   +6.656469941369604e-03   -4.299584895733146e-04   +1.078769224705122e-03   -1.128541707863134e-04   +2.098227118073497e-03   +1.279605946193635e-03   +6.309364990881267e-03   +8.162654519294362e-04   -1.134642618423365e-03   -1.249403920048788e-03; +2.058882620684750e-03   +3.846276169846821e-03   -2.735942551993127e-03   +8.730052413521391e-04   -1.689441025736285e-03   +1.101373063518647e-03   +2.091967402614925e-03   +5.183268602273782e-03   +5.217755682838254e-03   +3.004366236478076e-03   +3.872462438264986e-03   +3.297010400550711e-03; -3.180783306723873e-04   -8.534184187681995e-04   -1.762378548046501e-04   +3.356972612505834e-03   -2.816990158598853e-03   +4.267295803193948e-04   +2.796637971213314e-03   +3.080787878867418e-03   +2.125318397949722e-03   +8.162251422842177e-03   +3.637074834309374e-03   +6.419140352136136e-04; +9.666058797416250e-04   -2.886827022134400e-04   -4.268183790226331e-03   +2.781079941337822e-03   -9.648629313569845e-04   +4.092776762380014e-04   +1.613181094669214e-03   +9.555251773029232e-04   +7.408814109145104e-04   +8.498439713591167e-03   +1.473656651833947e-03   +3.382570727405092e-03; -1.002019354818437e-03   -3.345804632830584e-03   -2.260092864050101e-03   +6.233614076546770e-04   +7.776925686299762e-04   +6.302707536584068e-03   +4.364338156115529e-03   +6.269742956753231e-03   +8.204632302016577e-04   -2.498015290088475e-03   +8.062837927315812e-03   +2.714862129434709e-03; +1.958718615887773e-03   +2.927999822126340e-03   +7.571815802342743e-03   +2.970863064931958e-03   -2.423257710529816e-03   +2.791161970702808e-03   +1.519994263909817e-03   +8.890772047061200e-03   +2.209544228708856e-03   +2.383157197048590e-04   +1.206836689730506e-03   -2.447601688907753e-03; -2.024951701899734e-03   -2.586720116127674e-03   +2.869676584009199e-03   +4.406989669258067e-03   +1.650405785054984e-03   -2.218219603276792e-03   -1.505259812270560e-03   +1.978090022712193e-03   -7.180203147672021e-04   +2.944387022833790e-03   +1.024993040937787e-03   -1.556891288915491e-04];
L3I_L2I_iGABA_netcon = [+3.929456824310551e-03   +3.642102275122894e-03   -3.371746648375892e-03   -1.854254245244418e-04   +1.879060788395402e-03   -5.416785408941379e-03   +2.034249649678680e-03   -5.550487506205679e-03   +2.506502779028395e-03   +2.736005521952835e-03   -1.049050396665466e-03   +2.298381904002748e-03; +1.536184819432867e-03   -3.778863747884504e-03   +4.128195267762545e-03   +3.171378550391665e-03   +3.434705135210095e-03   +1.132753429524665e-03   +5.279629216640428e-03   -3.652752214003214e-03   +7.683722815286751e-03   -2.466705420619227e-03   -5.226318614982840e-03   -5.200973482597393e-04; +4.474444368652834e-03   +3.957807250318050e-03   +1.056935368095263e-03   +3.338009832026922e-03   -1.219330610234180e-03   -5.937148847446208e-04   +1.561448163349023e-03   +1.890246148858995e-03   +4.620199626010621e-03   +2.591004049500802e-03   -3.273827655301339e-03   -1.676725030882943e-03; +5.541501790187180e-03   +3.019107988529753e-03   +3.380593180652931e-03   -2.795185623069460e-03   +1.187893064959948e-03   +7.961185495878232e-03   -4.990354967041037e-03   -1.089182722674499e-04   +2.646831667619419e-03   -5.972681753558230e-03   +2.738930804593660e-03   +4.814721272106295e-03; +1.487626818859336e-03   +1.754873774927198e-03   -4.625144083312196e-04   +1.361631802896628e-03   -5.903041601761841e-04   -7.114100690013005e-04   +1.445409407234209e-04   +4.363215568662702e-03   +2.403247237346218e-04   +6.629835957979337e-03   -4.669865702146052e-03   -5.040695080470302e-03; -4.828832956715486e-04   -5.222366891278492e-03   +2.003889833485736e-03   +5.294397524791887e-03   +4.907163581817402e-03   +8.352252918250680e-04   -3.018993563456487e-03   +4.462399974049080e-03   -8.720721591083300e-04   +3.679222875832115e-03   -1.643127665561384e-03   -1.749618234051942e-04; +1.700434349018533e-03   +2.770420136672524e-03   -1.702144169502686e-03   -7.950989381572790e-04   -3.617597921984515e-03   +3.571021248339265e-03   -1.288693748189503e-03   +2.757257849820738e-03   -3.256599205732132e-03   +5.514114180881840e-03   +2.385911056336752e-03   +1.473931980867357e-03; -2.433152266116814e-03   -6.033551248570629e-04   -1.439523480388311e-03   -8.933434205351458e-04   +7.823906861973014e-03   +6.621156088829178e-05   -5.191657769791043e-03   +1.169566344467766e-03   +2.778048889245923e-04   +5.569959076121467e-05   -3.976881278649501e-03   -2.374634667846517e-03];
L2E_L3E_iAMPA_netcon = [-3.477234101106857e-04   +2.012010451416248e-03   -1.785805999642550e-03   +4.040085291075586e-03   +3.204751601016301e-04   +4.140376899625275e-03   +2.223809129026033e-03   +3.964081273739675e-03; +1.655697851475179e-04   +3.333234960705096e-03   +4.472359784804038e-03   +7.570824131114985e-03   +3.785755514356537e-03   +2.718782234366414e-03   +3.456848964868803e-03   -2.325955667440431e-03; -7.322700761241887e-04   +3.003245014525545e-04   +4.170816958753234e-03   +3.486841153348409e-03   +2.398431924755487e-03   +6.440146890225040e-03   +7.891787298936197e-04   +6.178916293640786e-03; +1.856716428703424e-04   -2.755447396943171e-03   -7.894587052911752e-04   -1.179006518770905e-03   +2.277407524708948e-03   +6.980643267635184e-03   -2.654529459901652e-03   +8.076152029407474e-03; -7.094403986132678e-04   -2.332281589816397e-03   -1.591040365906055e-04   +6.917118161821643e-03   +1.842777858813616e-03   +2.253063370838916e-03   +3.559299369887502e-03   +3.175961364981259e-04; +3.840246818856585e-03   +5.930018838728173e-03   +2.131634677365387e-03   -2.829380010368119e-04   +1.141640075289422e-03   +6.104517275666859e-03   -3.235543781982692e-03   +3.212999312329868e-03; +6.604895235762284e-03   +2.432400385011394e-03   +3.475026882511806e-04   -5.194293407209378e-03   -3.589817948420690e-03   +4.403615162547345e-04   -8.276115373132981e-04   +3.583690268806321e-03; +7.723510288875562e-03   -2.086080461551106e-03   +2.416864919408987e-03   +2.813810668715710e-03   +7.000974184505283e-03   +2.884050358960699e-03   -1.047032962467632e-03   -5.427303006213570e-04; -2.290585395760509e-03   +3.924950154278597e-03   +4.504755771283554e-03   +2.614725202594979e-03   +9.415542250827893e-04   -3.322218021001345e-03   -2.815313552708579e-04   -3.104795406410949e-03; +2.791722507217552e-03   +1.755861671111094e-03   +3.746020414287521e-03   -5.250369454100184e-03   +3.732896926305572e-03   -9.863882785875503e-04   +3.769542663159759e-03   -9.061643588088658e-04; +2.807672697876489e-03   -2.722141438784111e-03   +5.303403037032708e-03   +4.606838550337226e-04   +1.082480969062860e-02   +3.085894778240197e-03   -2.239712002628565e-03   -4.669734934516417e-03; +6.098439217971404e-03   -5.592302074269254e-06   +2.882067153040181e-03   -1.271954382266534e-03   +1.553520570902471e-03   +2.914806363080237e-03   +7.881821723565916e-03   +2.982427359734524e-03];
L2I_L3I_iGABA_netcon = [+3.236749783759895e-03   +1.265725113362523e-03   +3.694822617215255e-04   +3.917765021168865e-03   +8.545366446226277e-03   +6.686821872539347e-04   -6.053506178967803e-04   +1.297844399202313e-05; +1.573540468371085e-03   -1.925574115111924e-03   +1.344925378650613e-03   -4.426244609765254e-03   -1.790647916275249e-05   +3.004205064480042e-03   -1.896145501272882e-03   -2.970685219562822e-04; +2.022803063332367e-03   -3.077086967195180e-03   +1.467985923333234e-03   -2.723255485486156e-03   +3.200515667207577e-03   +4.999600184376823e-03   +7.475705357920544e-03   +4.819992386952682e-03; -3.356528638421751e-03   +5.047757563295578e-03   -3.211740720030907e-03   +7.117202852482355e-03   -4.289181937997731e-03   -4.038249754348527e-03   +4.271080071565382e-03   -1.416601413061395e-03; -1.797150768229542e-04   -8.580918371003457e-03   -4.007314781185318e-03   -4.774552149511363e-03   +4.979990469342283e-03   -8.139412289799569e-05   +1.974779010471523e-03   +3.043486742415885e-03; -2.164117959756821e-03   -7.880880278949059e-04   +6.196884716226024e-03   -3.948120861383081e-03   -7.060943747385867e-04   -2.264628953257500e-03   -1.260409276607253e-03   +1.022780305115191e-02; -5.112160721963251e-03   +3.891911859188822e-03   +4.701242496971758e-03   +9.015721555438870e-04   -1.547628598613995e-03   +7.973559687868813e-04   +1.980329190599314e-03   +5.969930924313458e-03; -2.866998935272257e-03   +1.491742228915003e-03   +6.916776527363338e-03   +5.615090732945191e-04   -2.447380150026007e-04   +4.764012211227563e-03   +3.666194141381127e-03   +5.110204744429284e-03; +4.869775287369826e-03   -2.656637494302672e-03   +2.320778761795401e-03   +4.113240625461635e-03   +2.118531373477880e-04   +2.774778483636634e-03   +2.912807356443941e-03   +6.498734037039405e-03; +3.189576890173925e-03   -3.461387286351946e-03   +7.500976343197196e-03   -1.099491657767831e-03   +4.529013735938737e-03   +2.385689256414487e-03   -1.933937559323725e-04   -4.584499460470394e-04; +6.706866316059240e-05   +8.916099201716303e-04   +1.874159299414295e-03   -1.821181953412555e-03   +1.460848953621588e-03   +6.654708486392576e-03   +4.558718274434198e-03   +5.264694601630842e-03; -4.401508951240271e-04   -1.551398751268617e-03   +2.209811883538502e-03   +2.424492551169164e-03   +2.865160369703358e-04   +2.067968048658954e-03   -1.483377643199268e-03   +2.764688824376017e-03];
L3I_L3E_iAMPA_netcon = [+1.441670750991666e-04   +2.183151991465512e-03   +1.157049091711600e-03   +2.754482499832369e-03   +4.996926461522528e-03   +1.906530290451493e-03   -6.977447174636769e-04   -3.159099457529214e-03   +2.154751356202024e-03   +4.000696099056561e-03   +2.116270538482904e-03   -1.989493303693202e-04; +3.614201618208976e-03   +4.547811091552180e-03   +3.129416535810502e-03   -4.155782257943805e-03   +7.963760841319350e-04   -6.618986328758435e-04   +3.344625703573305e-03   -2.252445967671734e-03   -2.466281911418173e-03   +1.402789861791519e-03   +6.871078186379513e-04   +5.727511293501612e-03; -4.267176397496165e-03   +5.165358096983241e-03   +5.628379457978346e-04   +2.814254167984284e-04   -2.002472083422997e-03   +4.665820244481244e-03   +1.578128528946343e-03   +1.417666308709077e-03   -3.943386710145972e-03   -9.513315430179376e-04   -1.592845272932660e-03   -1.909996843507610e-03; +3.632169493842331e-03   +5.708411864969076e-03   -4.251474872886641e-04   +1.961923949017307e-03   +5.612818244233768e-03   +1.296743911592953e-03   +3.084818625082120e-03   +3.417686672558845e-03   +1.265429724241447e-03   +4.864204796387355e-03   +2.474054680209708e-03   +5.188775206033250e-03; -3.227588901836578e-03   +3.186807225698081e-03   +8.606825131724151e-04   +2.793905148315510e-03   +2.601523874308979e-03   +1.552722441682553e-03   -2.316529432696863e-03   +2.080448249569006e-03   +2.113550804214563e-03   -2.782775016807583e-03   +2.578025133982113e-03   +6.181372590568607e-03; -2.073085499472142e-03   +5.951705043607048e-04   +1.267388115692778e-03   +4.459281358047478e-03   +1.075289979185399e-03   +2.007582433524885e-03   +9.565411034524350e-03   +3.057645339282810e-05   +1.112900505910322e-03   +3.446392145641468e-03   -2.405911735804089e-03   -3.331721878679188e-03; -9.009034820860954e-04   -7.856847374069923e-04   -2.287385055263944e-03   -1.844596036902929e-04   +5.172426345176392e-03   +5.038790520699942e-04   +1.360639825258206e-03   +4.162529198417238e-03   +4.337691555020116e-03   +2.805232458436240e-03   +6.708110946974943e-03   +6.686364774570746e-03; +2.125439113711242e-03   -1.486770312772018e-03   +6.922892734939450e-03   +2.963164048878792e-03   +2.122206933318793e-03   +3.991012033003272e-03   +4.611684056705171e-03   -2.809891316474753e-03   +3.799853236507726e-03   -2.408074181334165e-03   +4.336287448543646e-03   +1.402095552046286e-03; +1.221220009831854e-03   -3.604859093388926e-03   +9.587371613570563e-04   +1.896894179351404e-03   -3.904566191530814e-04   +3.405539491663723e-03   -3.840583968386592e-04   +5.042129073304384e-03   +5.670216060837795e-03   +2.429440199382378e-03   +4.468296380604769e-03   -4.675988582872771e-03; +2.095239928781976e-03   +2.414017298298965e-03   +2.280935738128630e-03   +3.960421900503303e-03   +1.795812068059826e-03   -3.806176544584776e-03   +2.793097139509367e-03   +4.781951409109180e-03   +8.372956445121735e-04   +5.127195656913709e-03   +6.405621574528047e-03   -4.086596553278908e-03; +2.200736307276957e-03   +7.947873131694933e-04   +3.065988247131472e-03   +3.303025692733579e-03   -2.974653243544891e-03   -2.542879247037884e-03   +1.960737314722248e-03   -1.673136478152802e-03   -2.217229363357067e-03   +3.207089970004061e-03   -2.775119391571217e-04   +4.164542649708960e-03; -3.703633124320705e-04   -3.501446440356487e-03   -5.441786773721767e-03   -1.901097367482495e-04   -2.209126804613548e-04   +2.064700622392808e-03   +3.223003381028128e-03   -3.126732024533161e-03   +1.832829389775559e-03   -1.973284087751834e-03   +1.605527227608418e-03   -9.736792891060823e-04];
L3E_L3I_iGABA_netcon = [+4.339391529030614e-03   +7.267043284698713e-03   -1.907826495591268e-03   +4.085423040126089e-03   -1.759130579300121e-03   +7.722281638850893e-03   +2.761009307712741e-04   -5.269930199493220e-04   +5.296237366012266e-03   -4.544962978378496e-03   +8.558709007675284e-04   +4.391597159281127e-04; +9.791864376346350e-05   -1.423847024818027e-04   +1.350136428707846e-03   -3.908499343234775e-03   +2.081311116986320e-03   -1.719796295507309e-03   -1.092376955399053e-03   -5.689728677029376e-04   +1.403034825585514e-03   +7.594766325499337e-03   +4.413917370566297e-04   +1.547154505195571e-03; +3.639609033378910e-03   -1.282781125071600e-03   +2.164694975721585e-03   -6.533911188599512e-04   +2.518187895663508e-03   +3.543300106934598e-03   +1.206169277369356e-03   -6.601784000283466e-04   -6.110943789582757e-04   -2.969912714185374e-03   +5.232161833189221e-04   -3.916077013887834e-03; +1.184607146169602e-03   +4.371523383685874e-03   +1.679421093377332e-04   +8.420387661960300e-03   +3.289249257118878e-03   +2.844872190195171e-03   +1.587049977238348e-03   +2.320170465576441e-03   -4.529003893980894e-03   +8.743974243769726e-03   -2.638205274797136e-03   -6.467952190663290e-04; +2.193040667039990e-03   +2.690134922602898e-03   +8.824232559635170e-04   +7.336404696367288e-04   -2.458521673497551e-04   +6.044582674998603e-03   +4.041033504884566e-03   +4.239213097964885e-03   +5.194482166699464e-03   +3.590120999820497e-04   -1.685734340753235e-03   +5.447110427931631e-03; +3.383034847043729e-03   +4.775140909570706e-03   +8.049238748610171e-03   +1.958097883244720e-03   +4.493137131928762e-03   +4.043383063850823e-03   +1.277182160892276e-03   -8.458930516252115e-04   +3.046874636230784e-03   +6.085023000538613e-03   +4.835040093345904e-04   -1.974213568444842e-03; +1.721676431703459e-03   +1.170580849290352e-03   -6.277440187231237e-04   +4.798727572939677e-04   +2.714862205480673e-03   +3.806446491377593e-03   +8.598775770336299e-05   +6.381796704177409e-03   -4.412392337458231e-03   +1.952223576434991e-03   -4.160286955617801e-03   +6.345810453881506e-03; -4.385896403965008e-03   -1.947298734230273e-03   +2.197613608582485e-03   +4.980483290736780e-03   -2.596658467655037e-03   +1.173140245481622e-03   +6.092817492919549e-03   +2.547056165716587e-03   +1.070223444964680e-03   +1.736781591588565e-03   -3.474060523201315e-03   +3.675189712719569e-03; +4.084650675376202e-03   -1.088368876772038e-03   +5.480627678539004e-03   -2.629888510284379e-03   +2.568827441930632e-03   +4.884016242331106e-03   -6.011549646721885e-04   +5.493588831472845e-03   -3.222015016586439e-03   +4.158579926708883e-03   -5.169547360454719e-04   +4.264939968863658e-03; +2.509837748506685e-03   -2.351856249100314e-06   +2.465671522237968e-03   -2.373873546268194e-03   -1.542076898435891e-03   +3.046634627372925e-03   +1.636375617771553e-03   -4.471419482478827e-04   +5.747127725543555e-03   -5.807408561974314e-04   +2.006649405481209e-04   -1.747127218120083e-03; +5.881295472109381e-03   +2.777737322450875e-04   +3.835246036952147e-03   +5.995280306216003e-04   +5.969312888466423e-03   -1.662682284237439e-03   +5.268163058711305e-03   +6.179268196623110e-03   +6.143536519524971e-03   +5.219514634164059e-03   -1.356629322520837e-03   +3.692042684856667e-03; +6.234155384225566e-03   +8.498899720839510e-03   +3.474637832728365e-03   +2.187483661853776e-03   -5.786977682756600e-03   -1.531778101881509e-05   +6.792494983156484e-03   -5.805818210735449e-03   +6.573387972554431e-03   +5.609764486507543e-03   -1.100915152564783e-03   -2.284235062745428e-03];
L2E_Input1_iAMPA_netcon = [+7.317284137044519e-04   +4.610191315547948e-03   +4.830989539809910e-03   +2.237725572873829e-03   +6.501192423764944e-03   -1.085590286743341e-03   +8.704596815050606e-05   +3.217548820796147e-03];
L2I_Input2_iAMPA_netcon = [+6.933301557992239e-03   +2.307441700477921e-03   +2.436725375779081e-03   -3.437477277568233e-03   +4.349765469487577e-03   +1.422776973788886e-03   +2.486184076102120e-03   +6.148661490295131e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
