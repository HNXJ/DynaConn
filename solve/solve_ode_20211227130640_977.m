function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.435037933099058e-01   +1.095150342719606e-01   +2.802366872440611e-01   +7.452544782769920e-02   -1.092396781687249e-01   -3.619233834722309e-01   +1.349912074678106e-01   -2.283675715446566e-01   +1.678849672225228e-01   -1.558705122215424e-01   +2.523324344102129e-01   +3.336755252193830e-01   +1.494385615119327e-01   -8.423476994428672e-02   -7.930075084535404e-02   +3.259592296238731e-02; -1.486928192775178e-01   +1.211609188593024e-01   -9.473951363272751e-02   +2.553196988254359e-01   -1.484059604992049e-01   +1.345260894491810e-01   +1.274703776151871e-01   -5.418925454823481e-02   -2.615646323354051e-01   -1.305178474267173e-01   -1.276118533504639e-01   +4.863594708315834e-02   +5.112462429663432e-02   -3.720525220423985e-02   -1.039255027359842e-01   +1.768759489227227e-01; +6.308599704978796e-02   -2.310842680712114e-01   +1.487879767232510e-01   +2.074111011893349e-01   -1.122620562262346e-01   -1.043413092333097e-01   -3.469030219371038e-01   -3.050100418615440e-01   -3.700017527223711e-01   +9.705342992808993e-03   +2.756110715779825e-01   -1.534598745031647e-02   +2.458712138102393e-01   -2.479232505901644e-01   +3.620341630654065e-01   +1.886744060295514e-01; +2.690293507649038e-02   -1.356138117031175e-01   -6.867174391355499e-02   +1.436764066789360e-02   +5.158607309445640e-02   -2.452870489236884e-02   +2.958204311113683e-02   +1.728689570847167e-01   -4.117043022384396e-01   -8.667720718423368e-02   +8.872258506114034e-02   +1.937793542957074e-01   +2.393582261740986e-01   +1.569338764323503e-01   +3.038631433565074e-01   +5.617186934042917e-02; +1.006987633604483e-01   +1.574876880775818e-02   -2.386027902019842e-01   +9.522646748216494e-02   -1.865556445931141e-01   +4.753667110269113e-02   +2.641799615844589e-01   +2.292089513190600e-01   +2.058676463040477e-01   -2.555733109634183e-01   +5.803266321624118e-02   +1.946371230011987e-01   -1.078433280850640e-01   +1.615476394316926e-01   -1.081627422477439e-01   -9.932081387976258e-02; -3.888444266840878e-01   +3.505948259970026e-01   +2.268665073472130e-01   -2.003230145487780e-01   +1.662369662985670e-01   +1.262702246086924e-01   -4.177366620785330e-02   -1.330106038226804e-01   +6.644477260174311e-02   -1.805698747568202e-01   -1.298114454764673e-01   -1.056143579915290e-01   +2.369708866580881e-01   -2.065735518763559e-01   -2.461003077161751e-01   +2.100053681385152e-01; +2.444477207433281e-02   +2.838442350818303e-01   -3.792337885702994e-01   -2.016557475040534e-01   -3.595088620414177e-01   -1.553344761669429e-01   +1.483477819448822e-01   -1.190754668413667e-01   +1.645519157297085e-01   +6.636321434037684e-02   +6.669624880378644e-02   +1.333531594392999e-01   +1.094331671894100e-01   -1.623109240629326e-01   +2.386003199466226e-01   +8.377786674564347e-02; +4.143811828627221e-02   +2.950221531050182e-01   +3.753312490387364e-01   -1.643754990553760e-01   -4.530601177327612e-02   -1.991752899072036e-02   +2.014630999842203e-01   +2.291728150555736e-01   -8.656608137980631e-02   +1.008298568239111e-01   +1.151544486720758e-01   -1.417762106901589e-01   +2.091813606729984e-01   +1.967954161214054e-01   +2.346793917269208e-02   +1.849647265944427e-01; -1.038158072986985e-01   -1.911058209156082e-01   +3.998842849445605e-01   +1.985305710806587e-01   -1.476568492526120e-01   -7.387220868971268e-02   +2.956263863079919e-01   -2.372206016146384e-01   -3.506422697500300e-01   +4.508031651475004e-02   +8.003611689471793e-03   -5.774917573419858e-02   +4.215565936177410e-01   +3.339311392542749e-01   +1.537630470710706e-02   +5.373639012412196e-02; +8.066899264762536e-02   -2.335982033701754e-01   -1.906437857261676e-01   +3.071246249893746e-01   +3.820819144472163e-01   -1.418620506452770e-01   -1.849037959812877e-01   -2.142320221499697e-01   +1.111973857774938e-01   -5.061458002806105e-02   -2.149603699022192e-01   +1.399639408853077e-01   +3.126587672856132e-01   +3.964364567113191e-01   -1.704967017587413e-01   -3.503024297428289e-01; +4.212680815241963e-01   -5.275575793442525e-02   -9.045741044958408e-02   +2.921614799033173e-01   +8.000476623439529e-03   +3.637552723681758e-01   -1.062630999867373e-01   -3.220361911536567e-01   +1.214654164061079e-01   -1.290862027754752e-01   +3.459186763273053e-02   -1.718208497083394e-01   -3.185550323058133e-01   -2.802762694233041e-01   -3.393741629333209e-01   +4.025058954140021e-02; -5.224417715105778e-02   -4.461727438684568e-01   +3.742080326587124e-02   -1.168792704000577e-01   -1.655400625474100e-01   -1.621637410938946e-01   +2.098995415365536e-01   +2.253114868293755e-01   -1.782337073163758e-01   +1.368753190728630e-01   +4.692806964811266e-02   +8.513694828030921e-02   -3.120254808989373e-01   -1.581158242320237e-01   +1.893435131572316e-01   +1.008508491104422e-01; +2.689360579926872e-02   -1.176113661253828e-01   -2.832291006066287e-03   +8.354075528274003e-02   +1.063926936704317e-02   -2.317870252006157e-01   +1.170526586441139e-01   -3.343600116088317e-01   -3.502828812016459e-02   -3.333881918943130e-01   +1.848625431474626e-01   -5.581423745827069e-02   +1.741150213754929e-01   +1.799281981404724e-01   -1.834599507974335e-01   -1.706578500079500e-02; -1.257892562841907e-01   -1.167215100063623e-01   +3.297918666411266e-02   +2.711944002916669e-02   +3.347595716245214e-01   -2.800337343240517e-01   +2.874027614505637e-01   +6.641083175877430e-02   +2.067364805054833e-01   -9.424241868025762e-02   -3.951817924127139e-02   -2.454506309253963e-01   -1.473467928731718e-01   -1.965462234498471e-01   +3.634989804686615e-01   -1.311147802412507e-01; +1.082135274813150e-01   -1.136318551855605e-01   +1.331327148950499e-01   +9.634481576689062e-02   +3.595254858722958e-01   -2.069876396271848e-01   +2.441198388826622e-01   +2.556426235872767e-01   +6.609226537017471e-02   +8.024944615365512e-02   +1.305794138205099e-01   +2.014671214298811e-01   +9.134458489638017e-02   -4.503322197837984e-01   -5.332584632340494e-01   -4.055758829483492e-01; -3.107348705575288e-01   +2.916132222751697e-02   -6.657148354272333e-02   -3.428275510519503e-01   -2.457752008979081e-01   -5.139539943128493e-02   -2.565599025036562e-01   -3.457154657793439e-01   -1.911980389028611e-01   +1.468646960406708e-02   -3.115333756249771e-01   +1.653813817902914e-01   -2.296353078620507e-01   -1.161956599093712e-01   -1.472006189715870e-01   +2.622785045241213e-01];
L1E_L1I_iGABA_netcon = [-1.807904764116148e-01   +4.777957551086175e-02   -6.225161474703582e-02   +3.501916122490464e-01   -4.452993789317630e-02   -2.595994266108216e-01   -3.345437548725566e-01   +5.430675334836814e-03   +1.215764883532404e-01   -7.148230398832592e-02   -2.017620398088979e-01   -1.903396714297668e-01   -1.420660989973234e-02   -2.146220748644022e-01   -1.088990165358720e-02   -2.281202512649728e-01; +9.368558732323930e-03   +8.457758208450927e-02   +7.759210884512313e-04   +9.399925918553542e-02   +4.667702063618632e-01   -3.282586068301063e-01   -1.388362707381047e-01   -4.136824690466976e-02   +1.118801699249859e-01   -8.277729146288253e-02   -1.251250527358270e-01   +1.019148115966480e-01   +2.096673401461695e-01   +8.841060592830541e-02   -1.378062918899734e-01   -1.043747258998500e-01; -3.521800299665259e-02   +4.567093190710444e-01   -1.231912977902659e-01   +7.961677269759826e-02   -1.351866801400782e-01   +2.138354202115826e-01   -8.447536499525614e-02   +2.190800572315812e-01   -3.125002451745763e-01   -1.447621965513743e-01   +1.946789127364195e-01   -5.072946367656656e-01   +8.216375838181783e-02   -1.124875253346747e-01   +1.438008357389147e-01   +6.117840115436038e-02; -4.820092488474928e-02   -9.347506083997963e-02   -6.783849556652621e-03   -1.050714941689612e-01   -6.551660470109068e-02   -6.032224848117579e-02   +4.128420947499249e-02   +1.891622244934902e-01   -1.114673213745664e-01   -1.919343646827670e-01   +3.934874605614929e-01   -9.752536935156561e-02   -3.214829889107089e-01   -5.831730023786658e-02   +8.375811889286086e-03   -1.485783477865840e-01; -3.856685141610880e-01   -1.411973668190220e-01   -3.948371158799064e-01   -2.113817933799687e-01   +8.582700889901326e-02   +1.103526992654054e-01   +2.846943434151114e-01   +4.758277429001689e-01   +2.826448203964324e-01   +7.918504075724439e-02   -2.083896807157022e-01   -3.889242564514785e-02   +2.122476397409072e-01   +2.014270129189556e-01   -8.485542208638250e-02   -2.545983313185012e-02; +2.473084836792154e-01   +2.311965762763997e-01   +2.517826877770960e-01   +9.127100306158109e-02   +7.707223396844445e-03   -3.867334552956651e-04   +1.950839909637399e-02   -8.916397305784916e-02   -1.322216574037529e-01   -3.169800152397011e-01   -8.191459860766317e-02   -1.871967545634821e-01   -9.438898796851836e-03   -1.133592219218704e-02   +1.558443374154103e-01   +6.734250893451005e-02; +1.185407912789677e-01   +1.458597118117469e-02   -2.494581867062102e-01   +1.693532638091674e-01   -3.619669932408093e-01   +4.343093013360424e-01   -2.427986591637953e-01   +1.523033539404602e-01   -1.052740321718471e-01   +1.973427467234908e-01   -6.503673531254403e-02   +6.362440248174117e-02   -1.893157129702997e-01   -7.485631230999247e-02   -1.294641064706188e-01   +2.458958467471152e-01; +2.801516505709680e-01   -1.165732374935304e-01   -2.137877343474416e-01   -2.301531448489455e-01   -2.587323621278910e-01   -1.204205818603098e-01   +1.761440584643767e-01   +4.105957003424365e-02   +2.466895584779420e-02   -1.402691901465761e-03   -8.029528383747393e-02   -9.299430736849648e-03   -7.795235985101212e-02   +7.619519226113262e-02   +9.729249472234254e-02   +2.785136329029431e-01; -2.732035483966542e-01   -3.994779756172823e-02   +2.761111594589793e-01   +1.522181159622575e-01   +1.452660265858180e-01   -1.508702450106120e-01   +1.580426949227662e-01   +2.549197617345544e-01   -2.637581274115331e-01   -3.918907952627833e-01   -2.195617624045506e-01   +9.391535376950222e-02   +1.990106386044677e-01   +3.116310015011504e-01   +3.952773171868722e-01   +1.518856870892171e-02; -1.908897122209275e-01   -2.661939060285011e-01   -1.924956380822533e-01   +4.568528178722700e-01   -1.551285261808746e-01   +3.265543053823468e-01   -1.674068535481428e-01   -4.989473670969820e-02   -2.328742327092494e-01   -2.371551547067360e-01   -3.342118301317790e-01   -8.420973346605733e-02   -7.345012650567119e-02   +2.907127750727597e-01   -1.703403895963025e-01   -1.883128077037839e-01; -3.520281912046025e-01   -3.601972203961533e-01   -1.822312264728018e-02   -1.929966720897286e-01   -1.521654046603405e-01   -4.612393814068393e-01   -4.014499776314739e-04   -1.856024445064443e-01   +1.162388992643469e-02   -1.146061106355529e-01   -1.579997692666165e-01   -2.563545106956038e-01   -7.111372188340981e-02   +9.238925215727491e-02   -3.903710630458068e-02   +2.713422835639363e-02; -2.128717206146733e-01   +3.878356285773861e-01   -2.223826637066736e-01   -2.267379825598146e-01   +2.417514046134767e-01   -2.155570950965145e-02   -1.246891305949817e-01   -2.246947312164741e-01   +3.496022540038368e-01   +4.837828624828586e-02   -3.493892088119109e-01   -2.267318280867817e-01   +1.048301290517979e-01   -1.787063946360623e-01   +7.416412055881616e-02   +1.506651391628834e-01; -1.545727315471740e-01   +5.551100118189684e-03   +5.172932270218403e-02   +1.743922659589552e-01   +8.870752649424969e-02   +3.129898972458384e-01   -3.623372323844863e-01   -9.027357100409246e-02   -2.458578253891127e-01   -3.836927193810094e-02   +1.268006218834385e-01   -6.646006186299198e-02   -3.495444191396097e-01   -2.775503513727069e-01   -2.566264260559365e-01   -8.308544192915786e-02; -4.433194341035104e-02   -2.909421552585413e-01   +9.868210686204415e-02   +1.874847217476434e-01   -3.730769076913746e-01   -2.607724847500759e-01   -2.832875996679371e-02   -2.091791665224315e-01   +2.492487825136248e-01   -1.728262109252630e-01   -2.226000944630609e-01   +4.696805316326491e-02   +1.796040747794183e-01   -8.602154887802152e-02   -4.363855365904144e-02   +1.268160168346301e-01; -1.605258114579880e-01   -2.500437418299346e-01   +1.137868738436066e-01   +2.049024957399753e-01   +1.217608750588924e-01   +1.537404890252625e-01   +1.567427881837726e-01   -1.681829993073236e-01   +1.912929219271515e-01   +1.891378831264657e-01   -1.726302052528055e-01   +8.572473841666724e-02   +3.230507508449549e-01   -4.958145399144355e-01   -8.818648776046198e-02   -2.897784149691687e-01; +1.869478195654080e-01   +2.514477634145752e-01   +3.694537440143572e-01   -2.639994946792922e-01   +2.202286353262609e-01   -2.627114395063662e-01   -6.237492608254259e-02   -1.497507945771643e-01   -1.378819724056063e-01   -2.085145353181889e-01   -5.994053609672759e-02   -1.301507846040531e-01   -2.126487779480116e-02   -1.838165402382703e-01   +5.893588242901127e-02   -1.389009006108702e-01];
L2I_L1I_iGABA_netcon = [-5.115731004736362e-02   -1.717050027313973e-01   -3.401609038434115e-01   -1.524358788743180e-01   -1.917878201943574e-01   -8.121165941283204e-02   +1.797660477914939e-01   -2.134281285562382e-01; -1.147137191335404e-01   -1.830841243356465e-01   -1.648882497147926e-01   -1.127321324066591e-01   -3.852739415598219e-02   -1.139330526661117e-01   +3.847507231462120e-02   -1.470500623780486e-01; -2.385322920543691e-01   +3.366845692592667e-02   -1.326016841431133e-01   -1.842436726081376e-01   +3.686680287821623e-01   -3.528415046273618e-02   -2.069000759742090e-01   -3.028262193608585e-01; -4.154363497669770e-01   +1.883145912414389e-01   -5.382765163630557e-01   -5.364498430775615e-02   -7.300420993329129e-02   +3.149258180586495e-02   -1.792819721143077e-03   -2.116648642569744e-01; -1.916866592563600e-01   -1.510196509131664e-01   -2.285851567899144e-01   +2.679561520431947e-01   +3.316464931103211e-02   +2.170710389571991e-01   -7.750717248507180e-02   +3.061230903005445e-01; +1.740174655795324e-01   -5.570256647823382e-02   +1.609699142564393e-01   -1.007381927842630e-01   +2.538065786347016e-01   +2.195068565548957e-01   -2.499969551833552e-01   -3.804973227980415e-03; -2.739208040529858e-01   +1.595874307589517e-01   -2.919428111177675e-01   +3.251813248316923e-02   -9.737194724943668e-02   +3.673476499692558e-03   +2.607350741628969e-01   +5.933503294180897e-02; +1.978563943001024e-01   -2.076178934647591e-01   -2.210856557216105e-01   -1.051205472478077e-01   +1.295853989630490e-01   +1.130095659488034e-01   -1.921946295022261e-01   +2.371397165433788e-01; -3.875833996160971e-01   -2.039761623875553e-01   +2.180585858304402e-01   +1.908014343842141e-01   -4.379929896348540e-02   +4.462080110260683e-02   +2.397747631109191e-01   +2.568485066913941e-01; -2.213090166669721e-01   -1.403327376584235e-02   +9.328866995772636e-03   -1.374952036521211e-01   -1.090736454688599e-01   +4.737141520997011e-01   +1.744504464381330e-01   -1.615293721221179e-01; -3.830748893073442e-01   +7.195484766165949e-02   +9.447988905741164e-02   +6.237862502268617e-01   -2.598526490940964e-01   -2.252402854654895e-01   +7.418060560374731e-02   +1.645757758376341e-01; +1.561765199878586e-01   +1.143246159807659e-01   -5.975609110218161e-03   -1.728592152328225e-01   -1.790314330411630e-01   +3.173894132124010e-01   -1.229510319187033e-01   +8.478130846354981e-02; -8.851626167595184e-02   +1.284462577688543e-02   -2.203950127367137e-01   +1.200993254968016e-03   -1.642105571301032e-02   +4.794571991387560e-01   -1.000007547843786e-01   -1.108819749181329e-01; +3.568841108038662e-01   -2.123545829417917e-01   +3.743591025464414e-02   +1.892866293237291e-01   -3.248412356863776e-01   +8.638243431034995e-02   -3.043447198900198e-01   +2.322610528470779e-01; -2.504992579416034e-02   -2.954647229117545e-01   +2.258759389606634e-01   -2.429084850610056e-01   +1.149472253692507e-02   +3.413183756654967e-01   -1.847479681125961e-01   -5.285400069809897e-03; -3.169411017882527e-01   +1.175230900707875e-02   -2.275344205915166e-02   -1.457122218720921e-01   -1.034443340776774e-01   +6.392645368942192e-02   +3.376432822606208e-02   -6.183798966145510e-02];
L1I_L2I_iGABA_netcon = [-8.214319428470782e-02   -1.490341209127272e-01   +1.592189097968932e-03   -1.273367114671942e-01   -3.651162047674359e-01   +1.261061814173493e-02   -7.203892444984426e-02   +4.583994067209508e-01   +2.968770016978800e-01   +8.701054862010005e-02   +3.431551107097133e-02   +2.836913217423178e-01   -5.463929545026502e-02   +1.368555473503977e-01   -2.062635631776281e-01   +3.061207124035723e-02; -3.278018745257522e-01   +2.047982533459092e-01   -2.626147198535503e-01   -3.219040107196489e-02   -2.137018711399015e-01   -3.725245554625489e-01   -1.227677852517874e-01   +3.661387521060220e-01   -9.834876644136167e-02   +9.963909899718518e-02   -3.307520807337329e-01   -3.367802628150114e-01   +2.568303310045934e-02   +9.956306197640781e-02   +2.356428078534147e-02   +1.688572201930181e-01; -1.064179010176688e-01   +1.631492822181737e-01   +5.648654885728848e-02   -2.077220881638679e-01   +2.967602111045033e-01   +1.165540497357265e-01   -1.166970390501271e-01   +5.595799093676886e-02   +8.721536706157457e-02   -1.246621135774225e-01   -1.000947237031708e-01   +1.336863847314164e-01   +8.393054159093151e-03   +2.187698052841975e-01   -8.367852172648699e-02   -4.247991810759880e-02; -6.185461374697952e-02   -2.556899456786434e-01   -2.346299931515660e-02   +1.145772355479949e-01   -4.225180946638646e-01   +1.270569948555025e-02   -2.890406546504821e-01   -2.456697840200185e-02   +2.185981510874426e-01   -3.046617476536383e-01   +5.008685984624677e-02   +2.747957025463794e-01   -2.218725328542079e-01   +5.236793562937675e-02   +2.024344668588354e-01   -5.012821181415061e-01; +1.178092138576161e-01   -1.355580973057097e-01   +1.827192588249832e-01   -1.748331754077482e-02   +4.660007312895552e-02   +1.589715528887683e-01   -8.126731264997279e-03   -2.683711489074270e-01   -1.890759383539062e-01   +3.123747471191678e-02   -1.270641853665756e-02   +1.403905439023027e-03   +1.413631153421907e-01   +1.511012809684877e-01   -1.253851869705259e-01   -1.236978977248789e-01; -4.344225756105521e-01   -1.562657434803127e-01   -7.292514711057337e-02   +1.493266469399760e-01   -1.221417084061112e-01   +1.997432518538166e-01   +1.754491069028418e-01   +3.647041084897810e-01   -1.217684149728451e-01   +6.279946791514252e-02   +4.838014277035438e-02   -1.362357569702550e-01   +5.380583707619202e-02   +2.161443816171654e-01   -8.357276622093610e-02   -4.748439301561919e-01; -3.474321385724967e-01   +4.782408317765378e-02   -1.160617020947533e-01   -1.303247311638059e-01   +3.758827353540892e-01   +2.490126496978223e-01   +6.985129324924275e-02   +4.179097588357228e-01   -2.026989378203427e-01   -3.280997921587556e-01   -1.356466863715076e-01   +2.232681723635017e-01   +1.084769713468802e-01   +5.516854094946133e-02   +2.586731163095901e-01   +4.447719077246196e-02; +5.623247400930576e-02   -2.134915203292240e-01   +2.304351538065143e-02   +1.369590323568317e-01   -1.454131071959436e-01   -4.186708049634049e-03   +1.778629798196119e-01   -1.148811159431138e-01   +6.265937405005767e-02   +1.903402348224350e-01   -1.176907110112332e-02   +1.349908910104627e-03   -1.001747522715923e-01   -1.363298850289023e-01   +3.986679121666092e-02   -2.542653304955149e-01];
L2E_L1E_iAMPA_netcon = [-3.225410980052204e-01   +2.210513317148397e-01   -7.543317242234351e-02   +3.691206638594867e-01   +7.699700586031934e-02   -3.854356206148589e-01   +6.122397469128080e-02   +9.653157277863153e-02; +3.207490076681771e-02   -1.680049648963709e-01   -8.486167337050783e-02   +9.688790578880474e-02   -3.617050688140547e-02   -1.385580735629384e-01   +1.932295044685268e-01   +1.107425924104893e-02; +4.575168037128022e-01   -2.473122695611151e-01   -2.879137358020559e-01   +1.999784243275690e-02   -1.919238708988740e-01   -1.583239186644432e-01   +2.208299023161852e-01   +1.951003432833978e-02; +1.205851900863049e-01   +3.244432601040097e-01   +1.499125882871090e-01   -1.729224256344702e-02   -9.820587838383904e-02   +3.180697274058604e-01   +2.948429251523979e-02   +1.335564267330813e-01; +1.594452721128437e-01   +1.125362737874279e-01   +5.703748149752168e-02   -5.944620059252825e-02   -2.699660481351057e-01   -1.494169190496894e-01   +4.003273970086841e-01   -4.435500252180381e-02; +2.138828548919388e-01   -3.573686730323488e-01   +1.385188895670014e-01   -2.698371110724043e-01   -1.106550687029662e-01   -1.607305599384787e-02   -1.313544634004918e-01   +3.929022186352329e-01; +7.102586644899329e-02   -7.693886596194743e-02   -3.618027913180027e-02   -1.249916688190413e-01   +2.536476165540241e-02   -2.098168059367678e-01   -1.069429486843807e-01   +4.525428607498909e-01; +3.981639453844179e-01   -8.165456145439123e-02   +1.982661636419124e-01   +1.992294378322056e-02   +4.009971280076216e-01   -2.213650133389420e-01   +3.011048662855780e-01   +8.261860295445764e-02; +2.544128784220158e-02   -5.743173155383050e-01   -7.356720649256385e-02   +1.082285884865824e-01   +2.304976448776517e-01   +4.179927028512113e-02   +2.533724529443354e-01   -3.718153579926107e-01; +1.681169836780133e-01   -2.595810297546592e-01   -6.364481093230567e-03   +6.599455436649709e-02   +2.822079214575083e-01   -1.751662940561428e-01   +4.369557169206113e-02   -1.278651291483826e-01; +2.173666312784195e-01   +8.945919704464431e-02   -8.071241759624984e-02   -8.000749507955421e-02   +3.345929217536119e-01   -2.168189123791587e-01   +2.097279765822535e-02   +6.542705725133574e-02; -6.209720556645992e-02   +1.537124324916746e-02   +5.050149958659328e-02   -1.519262297233501e-01   -4.395968970286110e-01   +1.382988060516725e-01   -8.898143944957063e-02   -2.130803676065261e-01; +1.798010489287154e-01   +4.137354693740510e-02   +4.040696402980744e-02   -3.080749230625413e-01   -8.138096225495207e-02   -5.513473566495679e-02   -1.149059025227955e-01   +3.996610790288170e-01; -3.187214981711358e-01   +1.694904727884576e-01   -1.890230416194202e-01   -2.244844934590420e-01   +1.863740459902714e-01   -2.518971935153763e-01   -6.171651315832458e-02   -1.796770501368665e-01; +9.942179883986171e-03   +1.662043351226891e-01   +1.964787027821711e-01   +2.189856587521627e-01   +1.603565307421077e-02   -2.667480615791534e-01   -5.210479244092001e-03   -9.724768111004872e-02; -2.109108476508854e-01   +5.663308264491052e-02   -2.830232264905412e-02   +4.511828635669446e-02   +5.946887432860593e-02   +3.827863584984933e-01   +7.874686958212543e-02   -2.188799287162555e-01];
L1E_L2E_iAMPA_netcon = [-1.128327828799542e-01   +1.642407651924239e-01   -2.270424502848695e-01   -9.248469466275261e-02   +1.582094405360450e-01   +2.800895878782874e-01   -1.998147073557019e-01   -5.702323195903698e-02   -1.479053480217050e-01   +7.838292058401018e-02   +4.284684084654958e-01   -1.345985601995040e-01   -3.359106091507924e-02   -5.931379515855770e-02   +2.385477573292177e-01   -3.632688053764558e-01; -1.554431959025626e-02   +3.675397960124527e-02   -2.019502730470212e-01   +1.417531179579259e-01   +2.622097534253169e-01   +2.463608331463890e-03   -4.630147375589996e-02   +2.684461627612261e-01   +3.176393340165184e-01   -2.376130129682513e-01   +9.781276971723540e-02   +1.153081091723318e-01   +2.417162381198046e-03   -2.285695531586605e-01   -1.823933167733982e-01   -3.114579451763981e-01; -2.061833679436462e-01   +1.032354035972061e-01   +1.787574123702701e-01   +2.023208693909491e-01   -1.010577971892938e-01   +9.674596563816812e-02   -1.815141709230048e-01   -7.791250682685127e-02   -2.435755916608347e-01   -1.612610379142496e-01   +2.026545547881102e-01   -1.157129128472032e-01   +3.034870571602516e-02   +4.378880926508330e-01   +6.086305046321826e-02   -2.688673842521489e-01; +1.616731912478333e-01   -1.423236971411668e-01   -1.459308191186036e-01   +2.074787257971988e-01   -1.061950385283150e-01   +4.822077203082496e-03   +5.120729004353766e-02   -5.128455377453741e-01   +6.583224509968420e-03   -2.093105711474428e-01   -1.560342002998902e-01   +1.620675214588975e-01   +7.856404752532281e-02   +1.309319491017935e-01   -3.083318484059634e-01   +1.247425209728796e-01; +4.392360877735233e-01   -3.848517467953644e-01   -6.702993004629196e-02   -6.565524561525389e-02   -6.014912444238787e-02   -4.990912519845861e-02   -1.379066279299808e-01   +5.505293446891996e-02   -5.306580923185547e-02   -1.137602048789853e-02   +1.942994888590690e-01   -1.432926287140433e-01   -2.558852247545454e-02   +7.734082113889028e-02   +2.407272293066341e-01   -1.931892268632838e-01; +2.755409473517320e-01   -3.040071800132355e-04   +8.817524940343617e-02   +2.078156623725181e-01   -5.137715539798508e-02   +3.774922878171094e-01   +1.332030768435926e-01   -1.981846332701754e-01   -4.643318473986378e-01   -2.173552012810314e-01   -5.065415952018759e-01   +1.889515961522786e-01   +1.675115131120660e-01   -1.332875844485178e-01   +2.252518493155653e-01   +6.495826685221874e-02; -2.913785836151018e-01   +1.269410327657468e-01   +2.700664801545118e-01   -9.906811385289660e-02   -1.820304587702407e-01   +1.884940922942283e-01   -1.603108584621926e-01   -2.330803699820850e-01   -1.378052449774503e-01   -1.757251994286817e-01   +2.303711399580343e-01   +2.353392034614651e-02   +7.985610279060945e-03   +2.873229328094446e-01   -1.090907663290182e-01   -5.023425980836846e-02; -1.123871082433047e-01   -2.203769839978830e-01   +8.810517477036361e-02   -9.746153862983487e-02   +3.681394129899156e-02   -1.666262065316581e-01   +3.791424255324094e-02   -7.150330498973588e-02   -5.842775392924529e-02   +1.297111164931151e-01   +3.165084044517705e-01   +2.055135399546105e-01   +1.637895204503561e-01   -2.791650003054342e-01   -4.385541013340877e-06   +2.790913992235322e-01];
L2I_L2E_iAMPA_netcon = [+5.155972348639188e-01   -2.706229704184883e-01   -3.772375741126384e-02   -3.072807205109425e-01   +1.641515004643205e-01   +9.263157838591153e-02   +4.831307264556516e-02   -1.988981331886941e-01; -9.438212744897367e-03   -5.600830202891725e-02   -1.773263813173057e-01   +1.938664205905797e-01   -2.244875553510156e-01   -7.249766697068463e-02   -5.270837187192631e-02   -6.071299197500590e-02; -5.565330342690727e-02   +9.620653509459211e-02   -1.060069385621146e-01   -1.196740709053420e-01   -3.412448232544213e-01   +1.954057654804006e-01   +7.976275317064378e-02   +1.755410426857242e-02; +1.674714789525653e-01   -1.478192881354506e-01   +3.637836490718470e-02   +1.186741898610441e-01   -1.484112981683863e-01   +1.600619760728425e-01   -6.220712596966974e-02   -2.123864110452482e-01; -2.172055482647597e-01   +2.252843524972924e-01   +8.314847925022470e-02   +5.653229458879028e-04   +4.241699196079467e-02   +2.574169423004532e-01   +5.379613670734588e-01   +3.755008831537873e-01; +9.216117695238946e-02   -1.816899711059680e-01   -1.661555910912361e-01   +3.479104752857940e-01   +9.604987314999522e-02   -3.843460480850400e-01   -1.133569247122891e-01   -6.570105675645185e-02; -2.442242243980580e-01   +4.413129883499808e-02   +1.545394344131578e-01   +3.957589908691901e-02   -1.656343153893505e-01   +1.235944150106585e-01   -7.869901231807204e-02   +3.891898455304724e-02; -1.481909686290560e-01   -1.529571102080012e-01   +2.926330463744027e-01   +6.203333220299981e-02   +2.442149603972718e-01   -1.112129393782981e-01   -1.582663269112092e-01   +2.339467407078707e-02];
L2E_L2I_iGABA_netcon = [-6.556154314305684e-02   -1.214312828223266e-01   -5.013280199139483e-02   +2.155486847683704e-01   -4.789980660313628e-02   -3.060368583193618e-02   +2.919795883175086e-01   +9.802315378234727e-03; +2.520912292410860e-01   -3.481157739638460e-01   +2.460237732445177e-01   -5.149535679699693e-02   +1.724411924823908e-01   -1.655151123706953e-01   -2.286555248887819e-02   +3.922323445111358e-01; -4.190589516004850e-01   +4.609474446325502e-01   -2.335912168076784e-02   +1.089483178767459e-01   +2.989409078328178e-01   -1.155026877991150e-01   +1.895254032338632e-01   -1.422629466383385e-01; +2.310771464766608e-01   +2.369778853931599e-02   +1.710193425555545e-01   -3.606183965063122e-01   -1.973877619190725e-02   -3.032637359192816e-01   +6.661291767400479e-02   -7.791631974657161e-02; -1.654196664808360e-01   -3.284075525128723e-01   -3.323844749166458e-01   +5.553694006742989e-02   +2.631578677285071e-05   +3.485838397532789e-02   -7.621696660063824e-02   +1.072737129311298e-01; -9.644529167360896e-02   -3.852986096608799e-01   +2.148322228638348e-01   +5.056179097564499e-02   -4.376429761932132e-02   +1.863278050137843e-02   -3.418896822171003e-02   -8.713078668648014e-02; +9.081104080703123e-02   -9.755001843271438e-03   +3.631187686822351e-01   +1.454952037466255e-01   +1.812751351072938e-01   +2.904255576295895e-01   +2.356875792257390e-01   +7.437017308346291e-02; -2.411285096652051e-01   +3.661743216541962e-01   +3.556379748275686e-02   +8.108773340231706e-02   -2.482412756895323e-01   -1.182490760212773e-01   -1.812684731581647e-01   -1.316836177734261e-01];
L3E_L2E_iAMPA_netcon = [-2.673621987380718e-01   -7.107957273862903e-03   +1.813754594285165e-01   -1.995693945873489e-01   +3.775974124151202e-01   +3.006810771907982e-02   -6.687311008636310e-02   -1.600345127077663e-01   -3.865158082037402e-01   +4.268940139468163e-02   +3.277993625046206e-01   +1.883320219078815e-01; +1.163484415223457e-01   -1.436956960088840e-01   +1.730668550175427e-01   +1.333125814005134e-02   +2.386044675416123e-01   -2.104325763454843e-01   +6.066742089758560e-02   +5.960826411048736e-02   +3.052990721935591e-01   +4.582245518369062e-02   -2.932369300918229e-01   -2.259418118093663e-01; +1.910965821514928e-01   +1.132331422293388e-01   -1.477575964339991e-01   -1.446927559363904e-01   +2.042692828853054e-01   +8.252553525493728e-02   -1.828748929398950e-01   -6.853992900157034e-02   -1.455558428097284e-01   -1.584628191180545e-01   -2.658718863524049e-01   -8.634875210939238e-02; +2.428938585510024e-01   -6.525521380794969e-02   +2.220226089358368e-01   -2.285749100426733e-01   +7.519521515241712e-02   +3.798098498421646e-01   -8.337051762977468e-03   +3.370224833030247e-01   +9.879113268491009e-02   +3.134949381066719e-01   -2.219854039648024e-02   +7.814460900574742e-03; +2.241044639133986e-01   +4.663711180889261e-02   -3.526455437543624e-01   -2.859428305543931e-01   -2.986333909368380e-04   +7.900114305754387e-03   -8.367192773412138e-02   -3.454901449688817e-01   +1.437779513886247e-01   -3.147886486572277e-02   +5.048564835152673e-02   -5.140708504076065e-03; -3.398551626277381e-01   +3.548493672084199e-01   -2.063441559012825e-01   +7.159324155453071e-02   +1.481569271692404e-01   +2.139343844043770e-01   -5.203578952551691e-03   -1.386984279673332e-01   +1.292595906911848e-02   +1.732857518585955e-01   +3.212441924385908e-01   -1.268327309245185e-01; -1.865196068802754e-01   -1.468577930453397e-01   +6.036425208705910e-02   -3.221226962281160e-01   +4.416697168591527e-01   -2.715032359236002e-01   +1.974861708325376e-01   -1.576111298818052e-01   -1.742625401891276e-02   +2.158401126608472e-01   +3.063804241690599e-02   -5.344742109437567e-02; -3.526201001064810e-01   -2.020224076575117e-01   +1.430507891227205e-01   -8.224221424014172e-02   +4.583731870778007e-02   -5.013396662226587e-02   +2.277522950863975e-01   +3.659200733207597e-01   -3.279739399798111e-02   +4.300483852607467e-02   +5.534269784257789e-02   -4.369525082414574e-01];
L3I_L2I_iGABA_netcon = [+2.195389081825179e-01   -2.095529385663140e-01   -6.150236246641061e-02   +7.559399748125603e-02   -2.459396895047182e-01   +1.994299115387577e-01   +4.781428990493251e-02   +1.786450303881180e-02   +7.068683040313500e-02   -1.974921949781757e-01   +2.073006361849500e-01   +1.142387679003316e-01; +3.158867452470351e-01   +1.809485791678896e-01   -5.752272773661417e-03   -1.194698950403994e-01   +1.438297374540153e-02   -8.366451589198201e-02   +5.393099886116373e-02   +3.107238429944243e-01   +1.293579773459298e-01   +7.814364432155126e-02   +2.301578081142886e-01   +6.771737065227348e-02; -2.247175560067937e-01   -2.501225165432536e-01   +1.631508801901012e-01   +2.611059613954679e-01   +1.738181818027870e-01   +7.033113893602859e-03   +3.144738994400024e-01   -1.987361664753205e-01   +1.163305680293229e-01   -2.445282449747811e-01   +2.023685744454488e-01   +1.737517439683407e-01; -5.790982501749860e-02   +2.490016070226309e-01   +4.316716393620429e-02   +1.762000762177661e-02   +1.908698730259592e-01   -9.855663322575328e-02   +3.308688545687156e-01   +1.008940576194280e-01   +1.281658630606622e-01   -1.607396080071286e-01   +5.971574576280961e-04   +1.605819505214203e-01; +1.506076962501295e-01   +8.637100739708370e-02   +2.703640568529561e-01   -4.104885879389390e-03   -6.604390752304734e-03   +4.553947754530026e-01   -2.594873453187585e-01   +3.487022774516411e-02   -1.977996422975636e-01   +3.380570611380897e-01   +1.836829274924441e-02   +1.436999514156564e-01; +1.066162318027470e-01   -3.061147718812184e-01   -4.155983907084251e-01   +7.271316833866484e-02   -2.134400262184509e-01   -1.723257281542981e-01   -9.773153195206573e-02   +5.654690321792707e-02   -3.327444224630420e-01   -2.488017172054959e-01   +3.798809965566970e-02   +2.256815742692349e-01; +2.126742282757443e-02   +2.109914883473518e-01   -1.983256265219021e-01   +7.512764991234391e-02   -2.075803803518200e-01   -6.980165339560404e-02   -3.583429310631512e-01   -2.259988566740510e-01   +5.852957194064984e-02   -2.867540938373272e-01   -3.175547980612212e-01   +1.024403673168553e-01; -6.685467774535848e-02   +6.893930085704197e-02   +2.092460579613461e-02   -1.820527906118072e-01   +2.559286523330069e-02   +1.706213053885471e-01   -4.402511296150255e-02   +2.517870518656559e-01   -3.113757686563745e-01   -2.234789099790361e-01   +3.133163899404842e-01   -1.153151742193965e-01];
L2E_L3E_iAMPA_netcon = [+2.297972642703839e-01   -1.472799400240674e-01   -4.170326348858009e-01   +1.523112064867822e-01   -2.314646787992700e-02   -1.371967393039225e-01   -2.993477146884830e-01   +3.181929434922259e-02; +1.215008500590296e-01   -2.976488129863565e-01   -2.616274776656656e-01   -2.992809758820597e-01   +4.618393508015302e-02   -1.137696324908458e-01   -1.950859961573671e-01   +3.940505277493401e-01; -2.329658817079153e-01   +2.995497640068071e-01   -1.579283949524792e-02   -1.752921570754609e-01   +1.571339604045968e-01   -2.913361439249858e-02   +6.874257094098159e-02   +7.636000942106647e-02; +4.991483989534933e-01   +4.450717045163179e-01   -1.224769302569881e-01   -6.096832664065061e-02   +1.352781279398359e-01   -6.353008754113273e-02   +5.149702306987903e-02   +2.612631268467822e-01; -3.402637884838416e-02   +2.192655737043230e-01   -2.092893720111047e-02   +2.241472519303211e-01   +2.880808402551512e-02   -3.659029641870964e-02   -2.433951128241726e-01   +1.224188882652727e-01; -4.960370669271251e-02   -2.631035152247785e-01   +2.610088035971775e-01   +1.365538266352811e-01   +1.244784146311572e-01   -1.812902335210517e-02   -4.913962809462845e-02   +2.585303570824919e-01; -1.758768751977952e-01   -2.362846057308616e-01   +3.574196120921074e-01   +9.048469778509008e-02   +1.701569098645719e-02   +2.257945657138716e-03   -2.551383754787188e-01   +9.616783842294392e-02; -1.361283882444093e-01   +1.665588281562970e-01   -1.714677227065872e-01   -1.224826326936576e-01   +3.856353779073260e-02   -1.547343057411288e-01   +9.763809903425232e-02   +2.400115913339749e-01; +6.647677442695542e-02   -9.723404199545296e-02   +2.704509007358262e-01   +1.566658576754114e-01   +1.943776079753691e-01   +8.088175776162558e-02   +3.289697134905956e-01   -8.849472744158793e-02; -3.207675166446640e-01   -2.065831322093254e-01   +6.774799374050269e-02   +2.854618165338066e-02   +6.850430894107309e-02   -1.643422116668556e-01   +4.605056809057850e-02   +9.600431412208010e-03; +2.092251652233729e-02   +1.427525456935466e-02   -1.864493877270750e-01   -1.126847986192855e-01   -4.813492018728480e-02   +1.395747082948458e-01   -1.397908221773048e-01   -9.522503045204517e-02; -1.072136579474104e-01   -1.438911230692275e-01   +8.012468846511744e-02   +1.712169571081674e-01   -1.320776017957572e-01   -2.379450888717957e-01   -8.015202578707945e-02   -2.328651638061085e-01];
L2I_L3I_iGABA_netcon = [-2.115729879400038e-01   -7.385227286481416e-03   +1.844748088360953e-01   -1.645549085025005e-01   -2.697790195273859e-02   +2.067793917498270e-03   +5.439148169589285e-02   -5.446735251213836e-02; -2.203852617187881e-01   +7.323016884603424e-02   -7.718608083875211e-02   +4.657114756253476e-02   -1.798665877242379e-01   +8.497218069945005e-02   +4.182662431089065e-01   +8.513360657077142e-02; +3.095589304280025e-01   +1.552745770630230e-02   -5.795403293419488e-03   -2.448691820000822e-01   -8.978028565729528e-02   +8.131252307249981e-03   -4.671671190642435e-03   +2.377977455327636e-01; +9.119585841933872e-02   +3.628299422124004e-01   +1.600904247037052e-01   -1.520089645680754e-01   +1.905000468180172e-01   -1.423594236947039e-01   +3.320168756988927e-01   -2.964099081910705e-01; -1.353439277368257e-01   +1.294229498491618e-02   -2.959746650235077e-01   -1.867597548585954e-01   +2.198269660655241e-01   +2.160072926480941e-01   -1.807027494378656e-02   +1.262379785163579e-01; +2.865960567357037e-02   -9.681220765557091e-03   +2.275579561672563e-02   +4.980375318886274e-02   +4.314913405251303e-02   +2.575247268044012e-01   +1.037402062185337e-01   +1.521739631708522e-01; +4.760374961792405e-02   +8.088325631600791e-02   +1.029496287573293e-01   -9.092951566101275e-02   -5.947693357046888e-02   -5.758686178197969e-02   +4.989839862973797e-02   -5.676733819145818e-02; -2.972781232310207e-04   +3.142416238979408e-01   +2.295180563804861e-01   -4.354347000580239e-04   -2.035677820574242e-01   +2.861887533910035e-02   -3.775119148981108e-01   -1.682951948986759e-01; +4.515655144593199e-01   +1.899923419986726e-01   +3.815796261185748e-02   +3.020960411840673e-01   +5.225840027580714e-02   -1.984848193621981e-02   +4.540908975762403e-01   -3.177197640059629e-01; +9.085627867767735e-03   -1.479978099305307e-01   -1.829520824256841e-01   +2.781330555402386e-01   -2.043182318893680e-01   -3.580131106056469e-01   -3.323610276761139e-02   +9.446107668920328e-02; -2.699964536741789e-01   +1.282169792810708e-02   +4.985002451404366e-02   -1.568659875604021e-02   +2.721325512463854e-01   +1.822976517181510e-01   -9.432844889120998e-02   -1.189147419727829e-02; -5.276402530403198e-02   +2.470984314521431e-01   +4.492031175906339e-02   +1.453645629038300e-01   -1.145227714418536e-01   -3.468947098072456e-02   +1.062075830422301e-01   -1.992713218509265e-01];
L3I_L3E_iAMPA_netcon = [+1.411454059764183e-01   -4.751971010132516e-02   +5.072626313085739e-01   +3.838006735047064e-02   +1.019996795238311e-02   +2.609719332443047e-01   -4.220985721194332e-01   -2.865466846936031e-01   -2.903795852238112e-02   -3.086818288924929e-02   -1.575056882481693e-01   +3.309462983409034e-03; -1.959448095294846e-02   -4.617859432644271e-02   +4.605806488026093e-01   +1.232644404958904e-01   +1.272591439369142e-03   -5.396087710055014e-01   +2.483696708686296e-02   +3.181700977061035e-01   +3.180503663176275e-01   -7.794087291618637e-02   -1.448086786777749e-01   +1.720622334494756e-01; -1.288788302962175e-01   -3.049669166040196e-01   -3.110962651778830e-01   +1.576715620881972e-02   +1.689629489134719e-01   -3.425472700853777e-03   +3.045829768783689e-03   +1.897570988247672e-01   +7.031013838737987e-02   -7.364361246467191e-02   -1.072683175760142e-01   +2.325283522172307e-01; +5.214911077789337e-02   -8.467546174898136e-02   +3.828409192239206e-01   +4.607309461319568e-02   -3.153348384428160e-01   +1.166004256312208e-01   -3.011918660838938e-01   +2.674868333975018e-01   +3.550311697525568e-02   +2.727773784477472e-04   -4.730975721167445e-02   +3.556558227521463e-01; -1.312443848331033e-01   -3.345528289676849e-01   -2.233673594273771e-01   -3.087196057341549e-01   -2.077754375139786e-02   -3.290922596615917e-01   +2.208832210875936e-01   -8.268535390429370e-03   -1.060566338070677e-01   -3.569630380378434e-01   -2.942768091173923e-01   -2.379305933919563e-01; +2.137682290579883e-01   +1.829020750560234e-01   +1.947853875456608e-01   -4.109507905939779e-01   -3.940118367103929e-01   +1.159861361234572e-01   +2.071318017985224e-02   -7.855226695394411e-02   +1.251943814633718e-02   +1.755065889923517e-01   +6.802218941339491e-02   -6.089369293193817e-03; +5.493281019624528e-02   -2.651613628152482e-01   -1.280130070748721e-01   +2.223478781466122e-01   +2.091094158128858e-01   -2.662184864212392e-01   +2.106185336674292e-01   +4.772407822051702e-02   +1.354172887714597e-03   -3.282111491103624e-02   +1.672328617561231e-01   +2.246633976590083e-01; +2.901715817870369e-02   -2.044525772454850e-02   +1.670870416662396e-01   +1.262430105726338e-02   +3.711776336584104e-01   +1.801769966745584e-01   +9.876686849590736e-02   -1.564319033883485e-02   +1.170506448019167e-02   +1.212469629155016e-02   +4.595218928096467e-02   +1.863678241712855e-01; +3.133615645794263e-01   -1.995941071398331e-01   +2.089257792112900e-01   -2.288568536228257e-01   +1.991869209114351e-01   +4.417976156387599e-01   +2.889124950520814e-01   +2.238684402365346e-01   -1.900541822742320e-01   +1.609010298286151e-01   +1.159548592008321e-01   -4.309152643512152e-01; +2.406944914148252e-01   +4.785530144709846e-02   -2.983214402859322e-01   +6.828360149679637e-02   +2.447375448290426e-02   -9.240630120063359e-02   -2.265847230557982e-01   -1.132174399712366e-01   +9.059496908201931e-03   -8.176701412224349e-02   +2.235026646990354e-01   -8.697009815386397e-02; +4.192965100266736e-02   +8.496914550769810e-02   -3.538376748612229e-01   -1.728744403511998e-01   +3.032312662672337e-01   -2.889866801530421e-01   +2.246216924416206e-02   +3.501240752357890e-01   +2.224233652830656e-01   -1.223355843462192e-01   +2.107436925664671e-01   +1.064383301735442e-01; -1.781339760296780e-01   +3.115688618167890e-01   -6.052350922323337e-02   +4.330188622091016e-02   +2.512657117171286e-01   -2.141887160791937e-01   +1.026960482391801e-01   -3.031884624220891e-01   -1.663555287371440e-01   +3.187019070761588e-01   +2.943098791613222e-01   +2.734790881285654e-01];
L3E_L3I_iGABA_netcon = [-1.031775138560432e-01   +3.580233236731600e-02   +7.317200375062331e-02   -1.540512323318807e-01   -2.304008688100592e-01   -3.102920046413020e-01   +2.262191149848305e-01   -2.185601474402341e-01   -8.052179260995097e-02   +7.490485796978177e-02   -3.258179762808394e-02   +2.084584144404615e-01; -1.022156310701169e-01   -7.746862233893208e-02   -2.157772914256948e-01   -2.982076580853519e-01   +3.596890010504656e-01   -1.078331905645916e-01   +2.699991963432180e-03   +9.249994764429519e-02   -7.124947607509911e-02   -2.872744340755063e-01   +4.730660858028063e-01   +1.726943548804848e-01; -1.365493451382103e-01   +8.548942242665863e-03   +1.004698384149476e-01   +1.518678075887065e-01   +1.023281772123942e-01   +1.572170620826284e-01   +1.794756097988627e-02   -3.504942175324863e-03   -1.567593884219292e-01   -2.205355892086214e-01   -1.557727361427164e-01   -1.021683411829484e-01; -5.763059556888045e-02   -1.047991021579284e-01   -1.411531365095491e-01   -5.174844125445493e-02   -1.923274505440426e-01   +4.257247575683140e-01   +1.142701988378696e-01   -1.611948711940836e-01   +8.361088714371545e-02   -5.716327478288866e-02   -3.057915808111455e-01   +4.267469936140736e-02; +1.950896663624047e-02   -9.266569605225934e-03   -3.865054133196913e-02   +1.696447199045787e-01   +8.040169470589947e-02   +2.987557311919336e-02   -9.276114958173599e-02   -3.902164935383119e-01   -9.026119907649437e-02   +1.471705379474917e-01   -2.969066704855620e-01   +3.666684694311859e-01; -6.686520353324087e-02   -1.559270435664276e-01   +3.267334385904309e-01   +6.411588298872498e-02   -7.921656374232113e-03   +3.524716952109583e-02   -3.153118402116120e-02   -1.765178459313102e-01   -2.465029876565432e-01   -8.662653861108921e-02   -1.752190105492550e-01   -1.689384942135438e-02; -3.160895441188387e-01   +2.490353022534628e-02   +1.097240488612333e-01   -1.890599013202223e-01   -2.771222097360915e-01   -3.361060079407356e-01   -8.058816667353433e-02   +2.707782095598849e-02   +7.841883820104659e-02   +4.398276009827735e-01   +3.330277302875224e-02   -8.829989242839055e-02; +1.568253886069945e-01   +1.665126989324439e-01   -1.995395239024239e-01   -1.678707428371806e-01   +2.655556707901506e-02   -2.360791949966418e-02   -2.814420302320260e-02   +1.614654284750583e-01   +1.918790204195450e-01   +2.469571997628243e-01   -5.091979398259915e-02   -9.960119627991659e-02; -2.024966195137833e-01   +3.877368003952817e-01   +1.757009844086181e-01   -2.564749432404011e-01   -4.490203689245993e-01   -3.811212853935847e-01   -2.717977472072373e-01   +2.070954581636866e-01   +2.151849983703845e-01   +2.706017758145743e-01   -8.668853691696196e-02   +4.124472057454776e-02; -4.443442508855002e-02   -6.894073920921998e-02   -6.528503226456719e-03   +8.385303870578253e-02   +2.086513004618534e-01   -1.897040603826845e-01   -6.247109200664942e-02   -1.788002053799269e-01   +7.439733055535196e-02   -2.196654264042008e-01   -1.105356910381378e-01   -1.307946729017992e-01; +1.860913097105600e-01   +4.511870371906423e-02   +5.630783733537401e-02   +1.225004748532045e-02   -1.118395467774141e-01   +3.222607333893584e-01   +4.369648560350634e-02   -9.737195024617796e-03   +3.627364767459373e-02   +1.680058666789006e-01   -2.469088060822039e-01   +4.647563187752241e-02; -4.541075700374815e-02   +2.251516257930801e-01   +2.833448667898457e-01   +1.145991037304894e-01   +3.829364303713382e-01   +5.173625835239165e-02   -1.419304807396826e-02   +1.256691620782248e-01   +1.151399346775460e-01   +3.797339812474919e-01   +3.967037118033295e-01   -4.685516836050629e-02];
L2E_Input1_iAMPA_netcon = [+3.785238178407341e-02   -2.055439458910032e-01   +3.468796748739251e-01   -1.175505278293226e-01   +1.768000589433346e-01   -7.932399958288014e-02   +6.234674679105147e-02   +2.260774713341422e-01];
L2I_Input2_iAMPA_netcon = [-1.726172122898072e-01   +1.774894468875264e-02   -1.976762806031217e-01   -4.691594157227976e-01   +1.397366253802125e-01   -1.306458569884714e-01   +3.826388386077045e-01   -3.430755985020283e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
