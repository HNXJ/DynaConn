function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.128311246765141e-01   +9.484915852790680e-01   +7.015925156760342e-01   +1.624025746120825e-01   +9.225326153290550e-01   +2.122605707142657e-01   +7.430021368469479e-01   +3.060070585508076e-01   +5.352884256401118e-01   +8.338740401398731e-01   +9.710055221975186e-01   +9.707713616002660e-01   +6.995844333258379e-01   +3.702425577761135e-01   +2.970227096563347e-01   +3.809643153538149e-01; +3.502697212005560e-01   +1.269079476417204e-02   +1.401902395258231e-01   +1.721837117789772e-01   +7.679217584658560e-02   +8.107119475748931e-01   +7.987023265143762e-01   +7.568471717209868e-01   +7.910564578743222e-01   +1.854872359664432e-01   +4.747992209072276e-01   +6.652351025108669e-01   +3.696809982567665e-01   +2.782370789754633e-01   +6.844054898721933e-01   +9.609603906540158e-01; +2.008295188829065e-01   +4.769430464490181e-01   +8.037308411852272e-02   +7.088526786668897e-01   +3.131525588110384e-01   +3.822877781927190e-01   +6.601974493399141e-01   +9.545948839447120e-01   +4.756980226578527e-02   +9.254820778078642e-01   +8.734478863853069e-01   +2.021165628889691e-01   +5.459737005542048e-01   +7.152201023066772e-02   +7.789140041521285e-01   +8.127285826695849e-01; +2.321792720945590e-02   +4.878224601738448e-01   +4.336118351643765e-01   +8.409131586619826e-01   +6.358690945316565e-01   +8.665758505535013e-01   +4.414093777057000e-01   +6.909043955462230e-03   +4.649341675712925e-01   +4.230035351295485e-01   +9.427078431198631e-01   +8.978305236941279e-01   +5.138748459012361e-01   +1.537008241328116e-01   +7.184859452109856e-01   +8.937193211280191e-01; +7.665767837779313e-01   +5.192176158567424e-01   +9.013347487936727e-01   +7.991892918204968e-02   +9.093038678623898e-01   +3.213125626223797e-01   +5.815136843947587e-01   +4.041734957247250e-01   +9.415981271505851e-01   +2.990435491562412e-01   +2.372493951505916e-01   +4.832403035509313e-01   +7.668539200945717e-01   +3.671404535377005e-01   +2.756183587534412e-01   +7.176445785796361e-02; +5.736485156693772e-01   +2.843661411563564e-01   +7.260284271684305e-01   +8.383629794058938e-01   +7.983584349945094e-01   +3.815027534315755e-01   +5.164714403841211e-01   +1.552049283810052e-01   +4.742471717505385e-01   +3.502993304778643e-01   +9.227592355646242e-01   +6.638132063928277e-01   +7.448656135690315e-02   +7.151227892148734e-01   +1.828786001343472e-02   +9.044089453390750e-01; +5.813767968749979e-01   +5.638942599676462e-01   +6.827203839190359e-01   +5.486601205483130e-01   +6.454981040753465e-01   +6.439002947561631e-01   +7.254025302907249e-01   +8.262360309479996e-01   +7.783293259092051e-01   +9.745109891593842e-01   +6.345462440760105e-01   +5.262293950664900e-01   +4.315662016723860e-03   +5.356711533362013e-01   +1.606269623369000e-02   +6.715406100570973e-01; +3.873225136564811e-01   +5.127741949131630e-01   +2.059110110599268e-01   +9.660546817139629e-01   +4.422309951832350e-01   +3.886065443762364e-01   +2.193746668235711e-01   +2.858630094244782e-01   +1.115632385732360e-01   +5.358888315679545e-01   +2.889563204701025e-01   +7.041660869497391e-01   +4.070321838224000e-01   +2.332125354454387e-01   +9.341061056689326e-01   +3.464502174595294e-01; +5.547814185076279e-01   +6.697501119588851e-01   +5.270873757757800e-01   +6.742823530544265e-01   +7.506984680372480e-01   +7.307571616495637e-02   +9.987799596069499e-01   +9.783503637613147e-01   +5.189555344291665e-01   +7.909554034312043e-01   +8.496513513091981e-01   +7.199299826146702e-01   +6.606291079860522e-01   +4.731705667979245e-01   +9.347632457080023e-01   +8.425567638365014e-01; +1.858464409348313e-01   +6.184278273887872e-01   +8.261788769681032e-01   +3.352125576011704e-01   +8.299677198428078e-01   +1.826355779950756e-02   +6.216377776522578e-01   +6.239325532338816e-01   +6.382740889630677e-01   +7.997403355187983e-01   +1.609698454840238e-01   +2.936578457559882e-01   +3.751358245890591e-01   +7.198014501158685e-01   +3.750652325998384e-01   +1.954101329061377e-01; +1.195891174652574e-01   +5.659946100760099e-01   +1.799377005829769e-01   +2.188972898292183e-01   +3.466554332808918e-01   +8.761610329544777e-01   +9.856316474522506e-01   +7.466222255909803e-01   +5.781414732616388e-01   +1.398262494460186e-01   +8.276154170477715e-01   +1.153054049203947e-01   +3.973798283556690e-01   +5.214617690491548e-01   +1.050618418188151e-01   +8.444601660033519e-01; +5.667245673688764e-02   +5.058128952513899e-01   +5.151780338181396e-01   +5.713814759010230e-01   +1.458659751889560e-01   +1.552704674886624e-01   +4.959701313811374e-01   +8.832432980205562e-01   +8.387394765298207e-01   +4.546940976525434e-01   +2.182665426620390e-01   +3.284644746455683e-01   +1.356694611227091e-01   +5.182525941852809e-01   +7.239617994150037e-01   +4.250802360856655e-01; +9.390058371638387e-01   +6.607254065736979e-01   +3.560759974647245e-01   +3.779480371762657e-03   +5.041536868307729e-01   +9.221945029613237e-01   +5.213387604753845e-01   +3.312138287215132e-01   +1.160226183923173e-01   +4.540451970002780e-01   +2.673266700355630e-01   +4.631572577188091e-01   +3.388912760472495e-01   +3.889029937019525e-01   +4.530979363502212e-01   +5.603101216177341e-01; +7.451113563298671e-01   +6.399550490052234e-01   +6.532380280915221e-01   +5.936751410322271e-01   +4.152985420159557e-01   +5.633772746189851e-01   +8.558283855654070e-01   +9.350574953842904e-02   +5.182840030443108e-02   +9.623436407487271e-01   +8.952664594047530e-02   +7.165307280396499e-01   +1.230827401332990e-01   +4.812496219429098e-01   +1.420302041868735e-02   +4.470462161963492e-01; +2.387642269304106e-01   +1.409707630536813e-01   +2.789173970958961e-01   +8.973920836183252e-01   +1.763215438211911e-01   +9.234271457355028e-01   +2.505329556545263e-01   +4.469065593158438e-01   +5.243947695363629e-01   +5.272264153904628e-02   +9.165388001876487e-01   +4.016411854821229e-01   +3.688665412354892e-01   +7.438024000096729e-01   +1.202607885806113e-01   +7.616195199571011e-01; +2.029558324097774e-01   +1.776566133215570e-01   +4.332874637535015e-01   +2.585593504960332e-01   +4.949376387750324e-01   +5.997430338120394e-01   +5.769742074627047e-01   +2.371155573050583e-01   +7.017461358156847e-01   +3.933591164482545e-02   +7.303901593066788e-01   +2.397427131527782e-01   +2.479130074125010e-01   +7.066200257966682e-01   +6.585821863851842e-01   +9.730250083073284e-02];
L1E_L1I_iGABA_netcon = [+8.391763614047927e-01   +7.499433713019411e-01   +8.746811942707398e-01   +4.385314328721805e-01   +9.224797036661700e-01   +7.699536774842437e-01   +3.215298791569167e-01   +6.403973703062482e-01   +9.287219460212728e-02   +2.933269047113255e-02   +1.349114586194873e-01   +5.217245959575030e-01   +8.722051815137252e-01   +5.754389832148636e-01   +1.716630850186656e-01   +6.302571854517832e-01; +6.158128706034564e-01   +9.932400435073842e-01   +3.123734907305298e-01   +1.482250777602056e-01   +8.848479239358388e-01   +2.752028767171404e-01   +9.668845071234781e-01   +4.361997232039914e-01   +2.941151691041269e-01   +5.088038702646999e-01   +4.296201303589084e-01   +2.026913400147974e-01   +8.058715859733313e-01   +2.897345736177142e-01   +5.825757513592085e-02   +3.399193837388974e-01; +6.671431338514665e-01   +3.726769998682850e-01   +4.328743553935523e-01   +6.505246271494323e-01   +5.887096364886861e-01   +5.238730577003912e-01   +3.528386512158331e-01   +4.833249547567023e-01   +3.295178995506132e-01   +8.645954239738937e-01   +4.820750114957736e-01   +7.712361276378871e-01   +6.406862916259608e-01   +1.377552854833282e-01   +2.135363348811998e-01   +1.536313426149395e-01; +7.818171550772969e-01   +5.027810150797177e-01   +3.807237996078852e-01   +7.262065281661835e-01   +8.388250868692905e-01   +4.076753648346189e-01   +3.212116062782447e-01   +9.981772161701739e-02   +4.797425796732869e-01   +5.830781017772548e-01   +6.720154419242180e-01   +3.867492091672287e-01   +7.328744763251199e-01   +4.416714924068233e-02   +2.082161405050890e-01   +4.002296533044059e-01; +3.118444205399000e-01   +7.535054281082394e-01   +6.559057373918703e-01   +1.687154184128858e-01   +7.786074230656836e-01   +7.826550041170198e-01   +9.133214490121192e-01   +8.067944979344143e-01   +2.423195891661683e-01   +4.244898919151479e-01   +3.534025219325290e-01   +6.687364793267499e-02   +6.692442767980094e-01   +6.218546028883831e-01   +2.176736561963104e-01   +9.130592632608916e-01; +3.279205947511850e-01   +1.341149102421280e-01   +2.447397592674581e-01   +3.410679646780758e-01   +7.877252545454692e-01   +2.643539579814635e-02   +8.833878246856781e-01   +5.992316989209400e-02   +4.581973107173425e-01   +7.180785079848492e-01   +4.919637272384454e-02   +7.557275323096456e-01   +8.886359935592986e-01   +6.054694098506236e-01   +5.791055422781911e-01   +1.568462218434546e-01; +6.332802999516574e-01   +5.146170088581601e-01   +6.856911574787083e-01   +1.059222396426121e-01   +6.955872053703657e-01   +4.083710607163581e-01   +3.577427957442404e-01   +9.571975676458053e-01   +7.581861192551398e-01   +2.302583767970234e-01   +2.935372729410980e-01   +4.571562638628177e-01   +8.538551724951470e-01   +3.718948840846268e-01   +3.628049973744316e-02   +4.677898333197111e-01; +9.015685288350144e-01   +9.049179161481907e-01   +3.305879212468087e-01   +4.332032865563982e-02   +2.103408228952419e-02   +8.285089924636845e-01   +7.456086063201883e-01   +7.698588225667661e-01   +7.140142867957299e-01   +5.604410628152093e-02   +7.974782288889275e-01   +3.186856896049917e-01   +4.093894331098655e-01   +8.343627066217186e-01   +7.955290786238886e-01   +7.787383811322579e-02; +3.733143488146524e-01   +1.018679861160088e-01   +8.763556573421637e-01   +4.750825569953648e-01   +3.244092117302631e-01   +5.902161622364793e-01   +1.255030779170756e-01   +4.435205732707214e-01   +2.297236796969873e-01   +9.797025048118745e-01   +6.525877967482785e-01   +2.749451732910560e-01   +1.100068859982107e-01   +5.165078452492953e-01   +1.352093043975000e-01   +3.375971505411928e-01; +8.833548229764507e-01   +1.804480397335232e-01   +9.981481639226951e-01   +4.778953742225898e-01   +9.443433496856837e-01   +2.124152262842315e-01   +5.939827433571938e-01   +1.636665527199864e-01   +7.027963465953324e-01   +9.715985394277333e-01   +7.065808252124623e-01   +5.751478663179660e-01   +4.076345869116478e-01   +8.073895863959037e-01   +5.783910952900353e-01   +4.925177001348988e-01; +1.187641540151988e-01   +1.793840385817314e-01   +6.851044071128960e-01   +5.499677190633688e-01   +4.052730045914265e-01   +2.959647272088800e-01   +4.402459806303041e-01   +8.321410584297020e-02   +3.062512520138544e-01   +1.354314624066231e-01   +7.590194856233997e-01   +9.081459316089860e-01   +3.380624985721462e-01   +5.731562581117251e-01   +8.438826885626627e-02   +4.968091168647564e-01; +9.216500349331329e-02   +5.395652041241975e-01   +3.443043762142984e-01   +6.515996221063892e-01   +6.296347367748455e-01   +2.664756948943031e-01   +9.614128697341217e-01   +7.397407564081577e-01   +4.647134698842490e-01   -1.405672375506207e-03   +3.898826848969683e-01   +4.503496116888527e-01   +1.136329485245720e-01   +7.123079875579115e-01   +2.250429758551661e-01   +1.296327176509849e-01; +5.443421314579105e-01   +9.748246314121684e-01   +5.621426403414868e-01   +3.491644763527665e-01   +8.534999419148240e-01   +9.330103154894702e-01   +9.711182430379495e-01   +5.360962415188665e-01   +4.419238224335707e-01   +9.294636743664693e-01   +3.644261207262537e-01   +9.805133798618084e-01   +8.574949422354442e-01   +7.371193283198466e-01   +4.495467604245180e-01   +7.937808364542592e-02; +6.033344472873952e-01   +8.447812389986423e-01   +8.938731072237425e-01   +2.540741988205122e-01   +3.716010979147186e-01   +5.538331326787946e-01   +2.475922050634722e-01   +4.871623352585972e-01   +7.316153270807636e-01   +7.379106001785595e-01   +8.134891907745495e-01   +1.065036288525815e-01   +8.940905321596505e-01   +4.467695168112476e-01   +1.776860091728734e-01   +6.740267336158400e-01; +7.265878456523651e-01   +6.707562536677398e-01   +6.489414135831205e-01   +1.810028348257380e-01   +2.020368641176264e-01   +4.322062918421949e-01   +7.742747074046654e-01   +8.875809001747321e-01   +8.735543123900351e-01   +4.292196898879644e-01   +3.911730739058004e-01   +4.225556818510015e-01   +6.884413703121623e-01   +2.828091787077299e-01   +4.139813188853882e-01   +1.205543578454817e-01; +9.924807101176227e-01   +1.300471553086441e-02   +3.776898802089121e-01   +4.747229289165338e-01   +9.076326721382209e-01   +3.245650252270045e-01   +7.103177686639683e-01   +5.835424221735640e-01   +9.105025500756003e-01   +9.477408628805312e-01   +8.725975721957373e-01   +3.875943027715464e-01   +7.482284724142196e-01   +1.529780451219508e-01   +9.673808697724671e-01   +9.908570573881632e-01];
L2I_L1I_iGABA_netcon = [+5.751914236847147e-01   +5.634651475420167e-01   +1.044360726365908e-01   +4.534936166878965e-01   +7.950468485087584e-01   +9.770557584783705e-01   +2.240636566704286e-01   +7.599680124458015e-01; +5.637739020631856e-01   +9.528568050990019e-01   +1.247729645578103e-01   +5.690556609390561e-01   +5.456640155889309e-01   +4.257798244854336e-01   +6.516991688235853e-02   +4.990273052444610e-01; +6.100836235366778e-01   +9.745207314411981e-03   +4.325728348663667e-01   +8.177312028043147e-01   +2.600325545651056e-01   +3.941385587502577e-01   +8.303382543334885e-01   +8.281237747766852e-01; +4.679623802001281e-01   +1.279003693411453e-01   +9.286125249563667e-01   +3.590393606033355e-01   +7.809268906259305e-01   +4.598059625200427e-01   +4.157326237045553e-02   +9.188677769729988e-01; +4.367755107385812e-01   +8.546391265785124e-01   +1.359197637434938e-01   +2.456747289791298e-01   +7.749010559507626e-01   +1.254007402491614e-01   +9.107041083737660e-01   +7.089767360901742e-01; +6.770981726925283e-02   +2.178773842174723e-01   +8.237354654904943e-01   +7.639836751048448e-01   +1.461440626660180e-01   +4.574000890732889e-01   +4.546157022892909e-01   +7.999722861290162e-01; +6.391726745811078e-01   +7.053433338385179e-01   +9.301442002579933e-01   +2.193901712499286e-03   +8.257327737070883e-01   +2.639392243930569e-01   +2.820891810503673e-01   +9.579095496404643e-01; +4.262315721228203e-01   +7.744507920018354e-01   +5.715693282408129e-01   +2.743109082320924e-01   +6.242502679819640e-01   +1.029583035884729e-01   +7.585778348364894e-01   +9.513599483927829e-01; +7.508024411721375e-01   +4.222277993517148e-01   +4.973860610608474e-01   +3.281656590598825e-02   +4.578597123367961e-01   +6.575408759633246e-01   +9.267591821129669e-01   +2.994261000910539e-01; +3.067453387433436e-01   +7.302167619073467e-01   +9.300068848308596e-01   +6.709926814416198e-01   +4.839315280944245e-01   +9.411822638294427e-01   +1.412627835166826e-01   +3.547042857361710e-01; +5.984203354928708e-01   +4.562792251448401e-01   +8.609056906228197e-01   +9.712952814059517e-01   +2.214006013036172e-01   +7.644873724802814e-01   +9.482446311040436e-01   +5.435502805608711e-01; +3.341023079016959e-01   +8.060675199026325e-01   +2.547200809577442e-01   +9.449137614165748e-01   +8.572088457560656e-01   +4.189113978242782e-02   +3.101333596624400e-01   +2.124957026052074e-01; +6.473325840372279e-01   +4.323750284864072e-01   +4.581635668040293e-01   +4.730761019312521e-02   +8.781591228635273e-01   +2.622074969041547e-01   +2.090396441455425e-01   +7.924786630521816e-02; +4.911185880307751e-03   +1.486904440102183e-01   +7.359830726906119e-01   +2.895718139724215e-01   +8.422923462014460e-01   +6.421646414981252e-01   +4.614597593639020e-01   +5.123942117742739e-01; +1.467695451376198e-01   +8.029773848475079e-01   +7.523024566256871e-01   +4.837291279224036e-01   +4.401619715276998e-01   +9.238426009334422e-02   +5.951043780536633e-01   +1.993216390832884e-01; +2.478117892764252e-01   +3.771669799711595e-01   +2.374369596580824e-01   +8.873428566778451e-01   +5.460747833026098e-01   +7.536409896910277e-02   +5.513311085500794e-01   +1.436180096064533e-01];
L1I_L2I_iGABA_netcon = [+7.066296234554886e-01   +8.681877739096834e-01   +6.135349265071935e-01   +5.085153820509129e-02   +1.442030392192465e-01   +2.349682421984896e-01   +8.415624308857520e-01   +3.704069899802203e-01   +7.103843451577706e-01   +3.851113636726537e-01   +2.431959073001749e-01   +6.688106835451418e-01   +1.624680065333652e-01   +5.742421449030234e-01   +4.094296432562151e-02   +4.377653054566959e-02; +6.046348580073303e-01   +8.014926246962487e-01   +6.153950949661245e-01   +5.739412898984889e-02   +7.489963726112369e-01   +5.549545976139504e-01   +2.006260513679143e-01   +5.607528199736657e-01   +1.864536964419541e-01   +7.244511694499093e-01   +5.084618618084412e-01   +3.369924528479028e-01   +1.106213195229749e-01   +8.089538275385981e-01   +4.376126353572704e-01   +9.205264597231138e-01; +1.644501006671256e-01   +6.221841987225590e-01   +3.107185731189209e-01   +5.979435941998049e-01   +9.558300873941006e-01   +1.138809203113919e-01   +6.180584892528604e-01   +8.307091031410361e-01   +2.308543361915760e-01   +6.355614917206083e-01   +7.346051484780438e-01   +5.484674888166622e-01   +7.400019166158481e-01   +6.741988890919951e-01   +9.237809989507848e-01   +1.764656235620252e-01; +4.810293686824379e-01   +4.734958477371502e-01   +1.340280061254797e-01   +6.599083397703447e-01   +2.653766596390572e-01   +8.201132172522976e-01   +1.586669636819644e-01   +7.149878207477434e-01   +9.988105222476854e-01   +1.016179606101087e-01   +7.788484830165192e-01   +5.369727558185967e-01   +2.166531310686280e-01   +4.415715466836659e-01   +8.821530440040058e-01   +7.452631825068042e-01; +2.912669893985557e-01   +1.997692659344984e-02   +6.020289231818886e-01   +4.837911643516413e-01   +8.978383488154366e-02   +6.559381635368267e-01   +5.842361796066347e-01   +1.164865081755446e-01   +9.033652435691618e-01   +4.922585885453579e-01   +6.810877986033322e-01   +9.029488982783151e-01   +4.856168505178272e-01   +8.909166092809196e-01   +9.443630241077794e-02   +4.726698739761898e-01; +4.026756170799292e-01   +1.208135023076224e-01   +8.927555104713700e-01   +9.817081054421005e-01   +2.323488415246308e-01   +2.369935963773765e-01   +5.444011215654905e-01   +7.394578690829963e-01   +1.487093012822317e-02   +5.577663346712551e-01   +8.186462616587320e-01   +2.809061837566663e-01   +5.101141903232330e-02   +7.864842588287898e-01   +6.792796646463557e-01   +2.505837028156216e-01; +4.928913894383574e-01   +7.193482976746397e-01   +5.640820567058180e-01   +8.673240330933074e-01   +8.916241125926473e-01   +3.033273832963165e-01   +6.865086970231611e-01   +9.244229497018126e-01   +8.332145254072935e-01   +5.383019482749328e-02   +4.197228450867195e-01   +1.421239240339956e-01   +5.768208542666288e-01   +5.869150803138024e-01   +9.325733769707254e-03   +6.674639246208124e-01; +8.620755008854823e-01   +6.724471970088493e-01   +6.332859807405244e-01   +9.555213081130185e-01   +1.999417597032181e-01   +3.291695525363387e-01   +7.005205967246707e-01   +9.207905139260024e-01   +2.511467369990996e-01   +8.424701092786344e-02   +4.956065798891786e-01   +9.590835047117744e-01   +4.975026860775541e-01   +6.202698831441393e-01   +1.235189748494929e-01   +6.094134478332954e-01];
L2E_L1E_iAMPA_netcon = [+3.726697899331755e-01   +5.629466962512505e-01   +2.021844210513651e-01   +5.168684746989790e-01   +2.915942625442748e-01   +7.083089804793447e-02   +2.816074474789719e-01   +2.668127806174677e-01; +4.362991201444871e-01   +1.858232445493583e-01   +1.365907866097820e-01   +6.849924364430204e-01   +6.223426631242968e-01   +5.879997582234472e-01   +9.298891257006286e-01   +9.017996480064562e-01; +7.180187840277574e-01   +6.071734619516588e-01   +8.474534171977176e-02   +2.055389510992694e-01   +8.697243499979179e-01   +7.848129888376391e-02   +7.604704960284017e-01   +1.555557215812644e-01; +1.918460303052536e-01   +7.368303780711406e-01   +9.350225671696817e-02   +9.730607802701722e-01   +8.160707763574253e-01   +3.995674978611596e-01   +2.629853683410087e-01   +5.529787641064322e-01; +4.181365321777977e-02   +8.348179645687775e-01   +5.514546520818515e-01   +3.507658572009710e-01   +2.089372885980929e-01   +5.851507991930336e-02   +2.457759490660573e-01   +4.216533038544917e-01; +3.168880852360106e-01   +2.740548237158507e-01   +7.321468506632375e-01   +1.823441881552152e-01   +7.507998371584026e-01   +1.266647316892528e-01   +1.624484163182771e-01   +5.493191598956801e-01; +7.921458841582852e-01   +6.109339014726335e-01   +5.465227425493392e-01   +2.443211558733833e-01   +1.993232758412366e-01   +2.437828128265116e-01   +2.892144574605385e-01   +7.486705704283210e-01; +4.563357456856575e-02   +5.486344536111960e-01   +4.798575934130211e-02   +2.565854242479320e-01   +5.779902461470252e-01   +9.444182669087672e-01   +5.637967420667757e-01   +9.593559573329226e-03; +2.161157154732927e-01   +2.789251409710966e-01   +6.361413235368183e-01   +2.197225064311970e-01   +8.759301087071347e-01   +2.059561580433220e-01   +4.001338924816956e-01   -1.328186367257256e-03; +2.690898534473868e-01   +3.372545336488649e-01   +9.926918583689862e-01   +3.561930134749613e-02   +7.157922050940624e-01   +3.306641310113838e-01   +9.887608921984984e-01   +2.180148314892139e-02; +7.888594431955428e-01   +5.692274516618636e-01   +9.116690303617787e-01   +3.561105884777332e-01   +7.007533691026754e-01   +8.630455519687703e-01   +5.473086253115516e-01   +3.529000080676881e-01; +9.849751898648528e-01   +7.389157519489021e-01   +7.732055545679029e-01   +8.969484108745136e-01   +4.626994256625216e-01   +9.207141043384152e-01   +9.295905516373412e-01   +4.288912433482430e-01; +9.848739029557033e-02   +7.678817040693959e-01   +1.933184023385562e-01   +1.382180690423505e-01   +5.043785062162555e-01   +1.992413090233003e-02   +9.900472102377155e-01   +5.443840521135411e-01; +1.981429539175266e-01   +4.040968557803888e-01   +3.038387072841143e-02   +9.545216663375486e-01   +8.014880869378317e-01   +3.605239814116181e-01   +8.351331011688344e-01   +4.857160695869204e-01; +1.201368720982620e-01   +1.506169200359909e-01   +3.793041070882903e-01   +9.037822087574530e-01   +9.359911559274953e-01   +5.312867619053967e-01   +1.780456712460363e-01   +9.171367573508915e-01; +6.393785741614344e-01   +2.025948503088383e-01   +5.772673528414412e-01   +4.101051827270494e-01   +7.884958084677709e-01   +4.043312858801839e-01   +3.107709430435739e-01   +4.173375340230815e-01];
L1E_L2E_iAMPA_netcon = [+4.981633019440245e-01   +4.529936726257830e-01   +6.138003693388790e-01   +4.922149315746940e-01   +2.330014755726780e-01   +7.151487712139953e-01   +6.890449463046807e-01   +6.333276491268068e-01   +5.238175130861193e-01   +2.428807884494584e-01   +8.737585513243994e-01   +1.780283271593355e-01   +1.385481455443002e-01   +2.470117044409964e-01   +1.867210646059870e-01   +2.567439719118936e-02; +8.353401575905997e-01   +3.653470300232073e-01   +1.065372628179018e-01   +6.602222559168650e-01   +8.364059096627378e-01   +3.822063455685702e-01   +9.755223886667530e-01   +6.220700239653187e-01   +6.701904985920155e-01   +7.258833804382484e-01   +6.621416799615980e-01   +3.015773421155833e-01   +2.840447578128459e-01   +7.483510056465507e-01   +1.518034374283705e-01   +2.447883099990116e-01; +1.849795903983071e-01   +2.993567385515990e-01   +7.581664687778067e-01   +1.789773460231273e-01   +7.362348572951432e-01   +3.789648659919811e-01   +7.556984979146765e-01   +4.084244130210560e-01   +7.740378257748617e-01   +1.301547491316499e-01   +5.419785865067773e-01   +1.067942109974518e-01   +4.374423234600210e-03   +9.319311785643583e-01   +1.357299228842478e-01   +9.865305258692338e-01; +3.407518501162819e-01   +2.363852328258932e-01   +5.418417509866978e-01   +4.768704549272844e-01   +4.891746971841073e-01   +7.156260767161104e-01   +5.548875186726532e-01   +4.279301963508703e-01   +4.633471087577549e-01   +4.384107250790278e-02   +2.534346511851077e-01   +4.493968699400847e-01   +3.079934074431415e-01   +2.988801379801646e-02   +1.629037758772045e-01   +6.321755998528693e-01; +6.924847831897770e-01   +1.379896473047706e-01   +4.437759823028972e-01   +5.003480575536521e-01   +8.516324067323826e-01   +8.346526903664329e-01   +2.786974894524607e-02   +5.082030750699538e-01   +9.062410066624265e-01   +6.503237028003968e-01   +1.086220128982825e-01   +5.880426473204119e-01   +9.053462641075982e-01   +4.328133997726934e-01   +9.205718539593853e-01   +3.584652119893995e-01; +6.972259207006362e-01   +1.038398776537757e-01   +7.419324314736064e-01   +6.022469683267897e-01   +7.200455791186335e-01   +6.682087323034754e-01   +1.918649863868458e-01   +2.627217030578268e-01   +2.412358985339897e-02   +1.990439061674669e-01   +9.718439677788672e-01   +2.214880202096400e-01   +2.943527867533579e-01   +8.292047608896667e-01   +2.635354666466232e-01   +9.349576015735918e-02; +3.690582378545946e-01   +2.301779539786847e-01   +3.855378036652086e-01   +2.461435767576345e-01   +5.217254360154171e-01   +6.516863386138112e-01   +9.381869113850356e-01   +4.218598586473298e-01   +4.840037671488108e-01   +9.766766272955542e-01   +5.920746560724560e-01   +1.105700075021836e-01   +8.256694574436769e-01   +9.971715883110343e-01   +2.077725016335742e-01   +4.114148319260316e-01; +3.188872888055270e-02   +3.435152519836150e-01   +5.323495709132664e-01   +5.179168338255400e-01   +9.374981666470270e-01   +5.600450186872010e-01   +3.957999267905921e-01   +5.219809969020799e-01   +2.768105434025340e-01   +8.225295392637516e-01   +8.212565037876010e-01   +5.593630996733080e-01   +7.440334652633500e-01   +9.209409559094501e-01   +6.172749115838877e-01   +9.300301210844074e-01];
L2I_L2E_iAMPA_netcon = [+6.721993256371867e-01   +6.092163039907561e-01   +4.033355719466273e-02   +7.991004610775415e-01   +5.215292135470432e-01   +8.234918277958960e-01   +6.478083541272398e-01   +3.870689189267804e-01; +2.296666577432415e-02   +9.442244746604739e-01   +5.323029897956851e-02   +9.364891737360100e-01   +6.459809821728833e-02   +1.106651457276252e-01   +3.678114183756195e-02   +1.732778969500067e-01; +7.400071899659553e-01   +9.632477375822900e-01   +4.048621147069743e-01   +9.393492290424819e-01   +2.869173014901318e-01   +2.165857208545825e-02   +5.617379784081338e-01   +4.473957779333237e-01; +2.157434453802011e-01   +3.692337618735043e-01   +9.820677513971887e-01   +1.422931452636436e-01   +7.125526380656981e-01   +9.006784474483819e-03   +3.078125198184833e-01   +8.749511335986221e-01; +8.564375673724964e-01   +8.015580601272713e-01   +7.128976633539921e-01   +3.260554821613536e-01   +8.845639249985938e-01   +3.362558905328202e-01   +2.621904809866544e-01   +4.053952162446545e-01; +1.592892966537323e-01   +7.268212703675233e-01   +9.869240683208966e-01   +4.299090212517731e-01   +3.639822838749089e-01   +6.670253967486599e-01   +7.192085691729405e-01   +1.641476944352115e-01; +6.735423006110727e-01   +9.543012145682120e-01   +6.486193864033201e-01   +7.063041628737607e-01   +5.651112028140053e-01   +5.953557645453044e-01   +3.088596387933059e-01   +6.632815056341125e-01; +9.359255452930473e-01   +1.471692151693684e-02   +5.068808415373698e-01   +6.172988267390485e-01   +8.798449476761422e-01   +7.720193894847469e-02   +9.003364500714532e-01   +9.307928104547512e-01];
L2E_L2I_iGABA_netcon = [+6.307657685308221e-02   +5.238733353490953e-01   +3.525559466120142e-01   +2.558526965081212e-01   +4.528218595160603e-02   +8.969484218928873e-01   +3.424667359624297e-01   +4.518538618095141e-01; +3.561910134106470e-01   +6.839595667014679e-02   +5.607974446340221e-01   +9.824838619134605e-01   +3.623353973837179e-01   +5.450326107404493e-01   +9.316114043916935e-01   +6.744588418387697e-01; +9.324091735215058e-01   +1.792158666604388e-01   +6.905761529181060e-01   +3.492823357539341e-01   +3.711431418974617e-02   +7.152855389070232e-01   +9.156375138660489e-01   +7.699911172625090e-01; +2.403403535988606e-01   +3.138431472123999e-01   +3.594231239334637e-03   +3.974149356924326e-01   +4.853191692953048e-01   +7.155043752661824e-01   +7.253236207757788e-01   +9.244967150601247e-01; +1.054153357699661e-01   +2.480709330031419e-01   +4.607613036507675e-02   +7.513155028796016e-01   +7.265298372424924e-01   +1.693294641855626e-01   +4.447260899877201e-01   +6.546724200790386e-01; +7.119609450626060e-01   +3.233141707950842e-01   +3.037399077164793e-01   +1.071336680132010e-01   +1.312013615603275e-02   +3.532750244488174e-01   +1.524588363786013e-01   +5.023345621407297e-01; +5.730037972298575e-03   +8.757743305105246e-01   +8.718536594432575e-01   +5.951840255270343e-01   +5.134445308259956e-01   +3.796802767586318e-01   +8.290410355907769e-01   +3.456752542443082e-01; +1.754352626166809e-01   +3.052562833762363e-01   +6.238409543113095e-01   +1.220029891274341e-01   +2.404370311941569e-01   +7.597042082570410e-01   +2.516719932283142e-01   +9.474794144676697e-01];
L3E_L2E_iAMPA_netcon = [+7.665881187464973e-02   +1.808794292850876e-02   +3.692541435329459e-01   +4.932560029898170e-01   +2.068459493604345e-02   +9.603399800531723e-01   +3.589366843638023e-01   +2.040216475671237e-02   +2.039638790508778e-01   +6.777730363573815e-02   +2.451615600744719e-01   +9.979862017742585e-01; +9.513826099450117e-01   +9.789090209595364e-01   +1.154801482512960e-01   +6.383145793965546e-02   +8.072239749859711e-01   +3.897932653036243e-01   +2.277470464306603e-01   +1.267282523798275e-01   +3.562512072843570e-01   +7.415309846574891e-01   +5.356498812512182e-01   +3.439385959820802e-01; +6.648003318953942e-01   +7.192753872227751e-01   +5.119455120590489e-01   +8.684736422544060e-01   +7.963297334117787e-01   +6.617221441680649e-01   +7.263112938911028e-01   +6.635915975888675e-01   +8.894083425047044e-01   +9.940336763135699e-01   +3.330431370850505e-01   +8.256856499782955e-01; +1.674760839881121e-01   +8.732144251316961e-01   +8.401292268770774e-03   +9.978220954482754e-01   +4.205153615683995e-01   +5.854905114680874e-01   +7.713862712601169e-01   +5.082426053473820e-01   +8.193228773012343e-01   +7.672855229587066e-01   +6.701762372915792e-01   +1.101097971875956e-01; +1.973068889449444e-01   +8.183694035025859e-01   +8.696111028784476e-01   +1.220383704790721e-01   +6.310527785217018e-01   +5.241224735431217e-02   +3.415402823418642e-01   +7.790039097565471e-02   +3.187215553968639e-01   +8.875313161031702e-01   +8.771834469520539e-01   +7.809381687050300e-01; +9.921700662256075e-01   +3.446968321068663e-02   +9.111885191191498e-01   +1.056165189237900e-01   +5.669006037014936e-01   +7.207656079534112e-02   +5.731330933955648e-01   +5.390282467586444e-01   +5.990849435519043e-01   +4.246434395873237e-02   +9.828269602975740e-01   +1.511611326040206e-01; +9.272439950519250e-01   +9.473760844931989e-02   +1.103587303315445e-01   +1.481942068778820e-01   +9.015115421316638e-01   +2.325049700578870e-01   +6.387280589105457e-01   +6.816715506693016e-01   +6.995864520056341e-01   +7.953536871653937e-01   +1.408813680101361e-01   +7.317617153556034e-01; +9.777947154545096e-01   +9.273164051542129e-02   +4.503664615209877e-02   +1.271903234743207e-01   +7.490618384165184e-01   +4.156483798191176e-01   +3.696470048037346e-01   +5.897585812683072e-01   +1.795335746278265e-01   +7.117079773994942e-01   +8.798400547333485e-01   +1.158978028434331e-01];
L3I_L2I_iGABA_netcon = [+7.706166431954813e-01   +5.364805453127340e-01   +5.960316602718047e-01   +3.052891882879256e-01   +9.675351697206402e-01   +1.140717176521479e-01   +2.942230955851894e-01   +7.960458634983237e-01   +9.208595677084425e-01   +9.923315688254519e-01   +3.118249532717329e-01   +9.940865287848348e-01; +6.363687257631654e-01   +4.495361337255100e-01   +5.600029949633296e-01   +7.571273923731893e-01   +5.472052915447272e-01   +6.431520707470546e-02   +1.658405625118577e-01   +5.015673795318097e-02   +3.864722407420687e-01   +2.904017238846848e-01   +4.461678264825454e-01   +9.188654237051553e-01; +7.994495855087465e-01   +1.163859680376582e-01   +7.329813734098853e-02   +6.523643150905121e-01   +9.807658671294088e-01   +4.543858151393574e-02   +7.232537107490653e-01   +1.793456148433115e-01   +7.485520492496740e-01   +5.203047194939717e-01   +2.039486543928363e-01   +6.893779721227595e-01; +9.628943342083861e-01   +7.162184131017028e-01   +7.708133020664349e-01   +3.329089399439236e-01   +1.262097824441817e-01   +1.326368130823227e-01   +2.989944861325373e-01   +2.455569088832674e-01   +8.758197192798017e-01   +3.592039408731342e-01   +9.409958971437800e-01   +2.175498694499565e-01; +7.112080845231004e-01   +1.822086551420426e-01   +8.629400012886927e-01   +9.749021282970028e-01   +1.654351533484186e-01   +4.902134293757933e-01   +6.763815351983272e-01   +2.578683425108779e-01   +3.949850473130109e-01   +5.189482086724939e-01   +2.905582301286402e-01   +3.155468966608437e-01; +6.456508190548790e-01   +3.254846313949100e-01   +7.024611466832296e-01   +5.308392336018577e-01   +3.367365728185264e-01   +4.684813609992005e-01   +7.476817410402040e-01   +6.531673571215704e-01   +1.685277443126295e-01   +4.957124454320848e-01   +1.193176078588259e-01   +2.285007947050886e-01; +5.141942486126496e-01   +9.653438160716911e-01   +1.069415224428519e-01   +7.516074760970846e-01   +5.354603058964497e-01   +1.538775964777028e-01   +7.467402660219756e-01   +1.001387927754547e-01   +4.391685882271055e-01   +1.835779328895289e-01   +7.075284909558756e-02   +7.081067752428858e-01; +9.501164197794323e-01   +6.994349618990519e-01   +6.602324233206313e-01   +2.660730576280982e-01   +6.929825660802283e-01   +1.387052493292306e-01   +7.796738378563827e-01   +4.688062781140676e-01   +8.537694851253926e-01   +4.800525427990440e-01   +7.280688367234540e-01   +3.722804958015000e-01];
L2E_L3E_iAMPA_netcon = [+6.591980462758240e-01   +3.862528270293514e-01   +2.349281652340544e-01   +4.635755682430774e-01   +9.046114111662654e-01   +9.556514113098976e-01   +7.676053780431176e-01   +3.574169143287136e-01; +3.803683071802593e-01   +2.196567851390217e-02   +9.121071040139094e-01   +2.904636029307879e-01   +6.837108124477689e-01   +1.985997790829160e-02   +8.984135149948173e-01   +6.606416324562421e-01; +3.059694943863228e-01   +3.308435238851467e-01   +4.878228652157261e-01   +2.770124810622218e-01   +8.452214816397728e-01   +4.989911505328175e-01   +7.909550562134190e-01   +5.908830320991681e-01; +1.556032753638147e-01   +4.882739411362610e-01   +5.920181206892466e-01   +1.428931710082515e-01   +9.589366075236136e-02   +3.352217747498952e-01   +9.515375767756479e-01   +5.369618987139246e-02; +7.733409581192809e-01   +2.633601428516295e-01   +9.540546208696423e-01   +1.455769668362840e-01   +7.378626472885789e-01   +6.676379015972297e-01   +5.347522088411160e-01   +2.118863042218521e-01; +7.103070033979064e-01   +5.272470990922400e-01   +7.962344184024105e-02   +2.647755218411286e-01   +5.474046497569305e-01   +1.656937886782203e-01   +1.601869825182701e-01   +6.028124239183196e-01; +1.713128170609234e-01   +4.139460408032087e-01   +2.219724343121562e-01   +6.075061377844794e-01   +2.538480753182907e-01   +2.258200745270899e-01   +1.357109369645081e-01   +2.703369766540812e-01; +4.505579997481327e-01   +1.134600511743219e-03   +1.588810703490877e-01   +1.026366532940675e-01   +7.155725780307978e-01   +1.143527560108551e-01   +2.631764663820486e-02   +1.134951758280069e-01; +8.402361662777862e-01   +8.898866711497972e-01   +3.941042237579193e-01   +4.872758069054971e-01   +3.583253903915875e-01   +9.910465061513862e-01   +6.855490765840887e-01   +2.180161314343390e-01; +7.006894911618134e-01   +2.381156334601047e-01   +1.847959507562898e-01   +8.974171912866492e-01   +8.458686408192915e-01   +1.378024536054263e-01   +5.849890720099283e-01   +8.809015567815883e-01; +7.640455269400009e-01   +7.977958173465423e-01   +7.638576083657730e-01   +1.896369664889495e-01   +8.201195203543887e-01   +7.662670592744222e-01   +2.928237052885078e-01   +4.616066456948432e-01; +9.766589863484150e-01   +5.813685109980989e-01   +2.287348908710105e-01   +5.368860446895889e-02   +6.160593010231371e-01   +6.255181859111671e-01   +7.467512892071840e-02   +7.327451501521152e-01];
L2I_L3I_iGABA_netcon = [+5.926493107309990e-01   +1.421698303701368e-01   +3.457875089335738e-01   +3.714090137356337e-01   +5.973534534820009e-01   +5.089671294767039e-01   +7.696927700611812e-01   +2.683305274178680e-01; +8.397358463085306e-01   +9.927129810714466e-01   +4.248666028076251e-02   +5.363718775095856e-01   +4.751778367697940e-01   +2.425507064519095e-01   +1.790339752276435e-01   +5.944284862025546e-01; +6.072121119385162e-01   +4.840014135309296e-01   +9.476538455175468e-01   +9.723621288893473e-01   +3.796422911310115e-01   +2.740567560257946e-01   +4.540945957350406e-01   +6.813024928382680e-01; +7.481484130753177e-01   +3.903776770660022e-02   +8.631416218850377e-01   +9.974669267822824e-01   +9.809074228014198e-01   +4.111662691240509e-01   +3.001369627396059e-01   +4.181346990490244e-01; +8.504287323032882e-01   +2.678865696567681e-01   +1.358006527850004e-01   +4.128983496656924e-01   +1.397317982557451e-01   +2.626943680240424e-01   +3.853676983373313e-01   +5.121185693271775e-01; +1.457112824991852e-01   +6.692328113379645e-01   +5.894507364468217e-01   +4.477611488211744e-01   +2.724259698757808e-01   +8.516155388245912e-01   +7.985436759321737e-01   +8.147524875326095e-01; +7.410196806483446e-01   +1.463626479472534e-01   +6.875012385045809e-02   +2.467831316238899e-01   +2.248135146562946e-01   +4.803206443543200e-01   +7.809576897803270e-01   +5.384296940349337e-01; +1.765234340925965e-02   +7.716244124762764e-01   +9.511445869488431e-01   +5.970012740996451e-01   +7.949440277859816e-01   +3.393351683599485e-01   +6.471308247370221e-01   +5.882615156747579e-01; +2.268959677434530e-01   +2.667769603163402e-01   +4.967133841365308e-01   +7.381644986936141e-02   +8.220921638207698e-01   +6.349837105664184e-01   +2.448376764611911e-01   +5.387165552047689e-01; +5.338261822937143e-01   +8.835156277327948e-01   +2.748625149627407e-02   +9.071353055791767e-01   +7.983817769682374e-01   +4.143469497133398e-01   +6.047665180316087e-01   +5.391921470080721e-01; +7.175886080294223e-01   +3.654060743772362e-01   +5.284253874527119e-02   +4.777655241820630e-01   +1.146804533501613e-01   +5.474974664112483e-01   +4.179789624232438e-01   +1.524045781031851e-01; +4.330402617579539e-01   +1.205118622363327e-02   +2.983844562617043e-01   +5.028720791126655e-01   +6.365365492675101e-01   +3.401070813613324e-01   +2.979249520707938e-01   +6.976206465892615e-01];
L3I_L3E_iAMPA_netcon = [+5.929780722168841e-02   +7.744948414949639e-01   +5.528724042672816e-01   +5.705472424102255e-01   +9.145317125299254e-01   +8.324081482415825e-01   +8.446139599439322e-01   +8.619654873663313e-01   +5.293515641604548e-01   +9.910849852567990e-01   +4.817604048673614e-01   +3.496378430769013e-01; +9.227456407595478e-01   +8.369468303596584e-01   +8.495539458206515e-01   +9.345969451452880e-01   +5.910836835289780e-01   +3.994668432747015e-01   +6.304510382628780e-01   +8.559877162810213e-01   +5.630895750807888e-01   +6.995940401237905e-01   +7.401157264068217e-01   +3.949862786316292e-01; +1.839981562564190e-01   +5.916974546621371e-01   +9.681689541248595e-01   +7.811652108127186e-01   +5.766591890181227e-01   +6.901113945272624e-02   +4.400953851688674e-01   +9.519100406528855e-01   +9.829440159164924e-01   +8.424946071902282e-01   +5.913627916380206e-01   +9.904069851227613e-01; +5.417204941589240e-01   +7.645981226878096e-01   +4.618299350929673e-01   +5.950293727092776e-01   +6.525223960129736e-01   +3.791454490668322e-01   +2.310276851648365e-01   +6.972150749666439e-01   +9.603573535639270e-01   +7.329896841175976e-01   +2.572898625509500e-01   +2.916960059775210e-01; +3.988597108787199e-01   +6.668617913361107e-01   +7.718349474817847e-01   +6.081838127274197e-02   +4.303179153560717e-01   +8.558817563531511e-01   +5.057394495148980e-02   +3.600957399692363e-01   +5.592735580659116e-01   +9.960827355581211e-01   +6.103210153748913e-01   +2.276303121949353e-01; +1.117645403242222e-02   +5.854768753478605e-01   +2.529872922169315e-02   +5.412769812762681e-01   +9.367085296911271e-01   +2.252042359112499e-02   +7.052572886179924e-01   +3.743182296460473e-01   +5.270090088591144e-01   +5.055235571785225e-01   +2.311377827006927e-01   +3.263479947539685e-01; +1.059981646809557e-01   +2.218634722501510e-02   +6.747319020831497e-01   +8.602087465556041e-01   +1.001212596169500e-01   +4.230675628558541e-01   +8.490764878064931e-01   +8.462250053396542e-01   +4.740092221766930e-01   +1.911764676851505e-01   +1.962918734313841e-01   +1.659784388624840e-01; +8.533587869130815e-01   +6.844045098055055e-01   +8.409711097057992e-01   +3.406850535037937e-01   +4.076203639904046e-01   +2.529306376645856e-01   +4.063123697926589e-01   +3.848053006026678e-01   +9.028516227790137e-01   +9.532351944384196e-01   +3.087096682533644e-03   +3.806926766061992e-01; +3.367805538896423e-01   +3.245537383910608e-01   +6.887928709223047e-01   +1.776135171906463e-01   +8.933035112875953e-01   +7.359647809567932e-02   +2.904531891796346e-01   +7.737304574650683e-01   +4.821377028020239e-01   +4.508155813701194e-01   +6.548371911543841e-01   +5.285416485666905e-01; +1.478900646088127e-01   +8.081432241034243e-02   +8.998634623032375e-01   +8.773681244603750e-01   +7.348234832775504e-01   +9.172520608495350e-01   +2.576502615489290e-01   +7.770737781420350e-01   +4.887751225027073e-01   +6.080515399222640e-01   +3.989647593489365e-01   +5.958518690038800e-01; +8.013985821366059e-01   +7.448089044486372e-01   +9.514232288743575e-02   +8.406016878377605e-01   +9.581531461575534e-01   +2.662189386136627e-01   +5.117739622316283e-01   +4.306430600201007e-01   +3.097008872584532e-01   +6.430516616434391e-01   +2.707145970401515e-01   +1.701070667734649e-01; +6.536725882763896e-01   +9.671358353614928e-01   +7.760097531057386e-02   +8.296247923311026e-01   +9.752219711980449e-01   +1.072730354004811e-01   +1.172366766035872e-01   +4.841890284441221e-01   +8.527553392702086e-01   +7.630130836119965e-01   +1.773205943118782e-03   +6.797938256557225e-02];
L3E_L3I_iGABA_netcon = [+4.440338759490615e-01   +6.563195799368807e-02   +4.977566980246523e-03   +4.921870330949203e-01   +5.446424779413355e-01   +2.526764121973016e-01   +7.184509913155899e-01   +7.597458186517158e-01   +3.792686609703680e-01   +4.492013730520039e-01   +1.994221558399717e-01   +6.544274472888865e-01; +5.982700067061020e-02   +8.086343490146803e-01   +1.301570436758772e-01   +1.903014267888216e-01   +2.160534563030596e-01   +3.334356566324898e-01   +2.230132061198807e-01   +8.877859694296915e-01   +6.092170729955251e-01   +3.935322777714366e-01   +8.277889765181142e-01   +9.047002946161411e-01; +6.261777199079733e-01   +9.146063174130774e-01   +3.090652778664861e-01   +6.448447847457770e-01   +2.696781026629117e-01   +5.998823762998212e-01   +5.000376817354578e-01   +7.324534803979220e-01   +1.658887455716120e-01   +6.767101990810427e-01   +4.400045129361745e-01   +8.360601783368625e-01; +8.045851893385055e-01   +4.231911214496117e-01   +2.367132182372924e-01   +2.537971685551693e-01   +1.357444167366636e-01   +4.819855448317171e-01   +4.748384913546103e-01   +6.938083005082993e-01   +1.007541659282437e-01   +3.394277885807436e-02   +4.242283730585726e-02   +1.715589984409615e-01; +4.039672895026907e-01   +1.894695665667473e-01   +6.507754463569208e-01   +9.444190525427261e-01   +1.640554606183437e-02   +8.968541254939385e-01   +4.298390517845223e-01   +6.431859919465309e-01   +6.205584674780275e-01   +7.852900115463965e-01   +7.653922370893164e-01   +1.615463825119554e-01; +8.828471196028305e-01   +1.848673730313388e-01   +8.113694746595793e-01   +2.901760461371918e-01   +1.150149979228721e-02   +2.901903370884036e-01   +5.537280415853153e-01   +6.162435088648012e-01   +9.598184264378412e-01   +3.741434524747818e-01   +9.450257908040657e-02   +1.374436483314219e-01; +7.196700749306648e-01   +6.710969422533145e-01   +7.402868459733511e-01   +1.448032731969676e-01   +9.840315756280754e-01   +7.482161150092627e-02   +2.101633700384633e-01   +7.756782439584770e-02   +6.705550914862436e-01   +6.413208889371114e-01   +6.561277558832240e-01   +1.572740673577757e-01; +1.990554382195596e-01   +5.258881424703439e-01   +1.200143975270222e-01   +8.657980022454068e-01   +6.461300874892858e-01   +3.882140177435774e-01   +2.778074056109989e-01   +5.492598928768333e-01   +4.734109844104871e-01   +4.960334297214020e-01   +2.686350733915251e-01   +3.974955421064880e-01; +3.736563896855778e-01   +7.741417013667667e-01   +1.718264088774675e-01   +8.839749136342470e-01   +8.157373164603569e-01   +1.932309556654842e-01   +8.086081177309052e-01   +8.802828145820627e-01   +3.382832668444853e-01   +2.180933525594780e-01   +4.364508165696121e-01   +6.622645896045998e-01; +2.086780842462979e-01   +3.013003013533867e-01   +2.673091181967795e-01   +6.633450453544004e-01   +2.791799348084142e-01   +7.288863114341158e-01   +9.868424256646999e-02   +9.862129172135238e-01   +5.889739431802049e-01   +2.109761744530404e-01   +8.507930846329533e-01   +2.222801639984733e-01; +2.628563464055114e-01   +4.758029280033507e-01   +8.136967661880010e-01   +9.986470440518681e-01   +1.320867117875810e-02   +4.243260163230324e-01   +3.418342313437520e-02   +7.117394222028220e-02   +5.431143767561417e-01   +4.533736023281524e-01   +9.057947997469677e-01   +6.422005651347789e-01; +9.913651791541872e-01   +7.096377769639813e-01   +5.920582857931581e-01   +2.674462688933867e-01   +1.030254424384460e-01   +2.676391160288495e-01   +7.164755945425290e-02   +2.991497085698814e-02   +3.884176719633937e-02   +6.350388533460292e-01   +2.864376936546507e-01   +6.085975326305337e-01];
L2E_Input1_iAMPA_netcon = [+9.998527907267479e-01   +9.922222148272479e-01   +9.967338156617707e-01   +9.899258531255704e-01   +9.886441182713904e-01   +9.994591794217423e-01   +9.846491671740957e-01   +9.986830189361482e-01];
L2I_Input2_iAMPA_netcon = [+9.983639096119675e-01   +9.982632786234878e-01   +9.875333791527328e-01   +9.895622505510836e-01   +9.892350569263965e-01   +9.890948388753826e-01   +9.912906970490876e-01   +9.951650216902572e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
