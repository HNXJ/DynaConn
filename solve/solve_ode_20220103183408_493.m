function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.130291647846632e-01   +9.475033438874453e-01   +7.006330020220070e-01   +1.616798449824842e-01   +9.215076082750261e-01   +2.118132716896176e-01   +7.420325145951466e-01   +3.049598522137595e-01   +5.352680930463025e-01   +8.342468480126208e-01   +9.705100825146514e-01   +9.705019163636508e-01   +6.991458297230086e-01   +3.701917565744207e-01   +2.967377953831984e-01   +3.819257352662679e-01; +3.504851145352100e-01   +1.169544394728008e-02   +1.396809700643028e-01   +1.711894604512063e-01   +7.749217946670020e-02   +8.115727115948287e-01   +7.982356182890674e-01   +7.573533275331084e-01   +7.914227422100042e-01   +1.863179854048284e-01   +4.746082868043998e-01   +6.660127316502489e-01   +3.700311458747549e-01   +2.773208672101786e-01   +6.855784080082530e-01   +9.600479488625404e-01; +2.016142053425074e-01   +4.764274757130771e-01   +8.114413455659045e-02   +7.097106770235336e-01   +3.129990038356077e-01   +3.816335765502231e-01   +6.603936653920448e-01   +9.542746749631429e-01   +4.764917908084358e-02   +9.261972664591822e-01   +8.723801937311542e-01   +2.028950687571183e-01   +5.461860806035260e-01   +7.179122609657557e-02   +7.785602443718881e-01   +8.116625100123402e-01; +2.345488728545872e-02   +4.888521936072404e-01   +4.329775273387055e-01   +8.414250555433058e-01   +6.350393184244661e-01   +8.667009771784313e-01   +4.418203616192181e-01   +8.021406364396614e-03   +4.640707051504495e-01   +4.223894925606721e-01   +9.436084386637755e-01   +8.970009721465875e-01   +5.135807598500501e-01   +1.539822080027845e-01   +7.188063874083245e-01   +8.934859062478694e-01; +7.657107300105164e-01   +5.190413097938518e-01   +9.023715085845294e-01   +8.096554052852181e-02   +9.095538268762896e-01   +3.210097746011245e-01   +5.806058913943040e-01   +4.045744350737770e-01   +9.426080136754670e-01   +2.990520110574107e-01   +2.379519092376737e-01   +4.840341454009842e-01   +7.676644134961834e-01   +3.669680348211746e-01   +2.761378615220080e-01   +7.210250610322864e-02; +5.740026978801595e-01   +2.853158139067755e-01   +7.260453787758869e-01   +8.374929493218813e-01   +7.990015628388276e-01   +3.808836952150145e-01   +5.173702733796680e-01   +1.549811534120748e-01   +4.748827494244791e-01   +3.510572179056849e-01   +9.237839469598529e-01   +6.635847344515006e-01   +7.506222555338700e-02   +7.154803811657565e-01   +1.786065402708787e-02   +9.044039750275493e-01; +5.808926258240140e-01   +5.636853095758705e-01   +6.838772727306509e-01   +5.487880407354010e-01   +6.464811951435030e-01   +6.434471688506069e-01   +7.255666343710322e-01   +8.272338748693812e-01   +7.788201711282896e-01   +9.744229058056215e-01   +6.342104733205705e-01   +5.260643613685301e-01   +5.396780940431989e-03   +5.361901985456714e-01   +1.637548841233522e-02   +6.717676124890322e-01; +3.884817223164267e-01   +5.136626053460246e-01   +2.066539586139737e-01   +9.655111368301627e-01   +4.428794610622647e-01   +3.896891633654681e-01   +2.190439012081676e-01   +2.855599394674161e-01   +1.117965975110338e-01   +5.366505954906137e-01   +2.896932527386478e-01   +7.033481194895449e-01   +4.079796539492490e-01   +2.330799150043626e-01   +9.334516884018546e-01   +3.467940823012934e-01; +5.544017720121890e-01   +6.706967681788101e-01   +5.269509199321680e-01   +6.746681544911786e-01   +7.503274425028651e-01   +7.318611936641439e-02   +9.984107885838661e-01   +9.779177993025233e-01   +5.190835919633345e-01   +7.917205099200314e-01   +8.501803025980530e-01   +7.205448331764766e-01   +6.610218505953339e-01   +4.731669238617231e-01   +9.355088995922687e-01   +8.428111253260976e-01; +1.857644424467763e-01   +6.174221751666186e-01   +8.265300005831672e-01   +3.357274012084412e-01   +8.306170352213791e-01   +1.809408591986783e-02   +6.225657016084040e-01   +6.250504478801252e-01   +6.388293005468050e-01   +8.003184760070751e-01   +1.612818849990938e-01   +2.934867365625412e-01   +3.756563825345647e-01   +7.200049040102454e-01   +3.758779740475393e-01   +1.957758216065318e-01; +1.191939412250479e-01   +5.654092367203711e-01   +1.796887935103632e-01   +2.185670154929658e-01   +3.470210971339733e-01   +8.751408345173478e-01   +9.860093625919899e-01   +7.476662417373463e-01   +5.788682835402278e-01   +1.404346425131005e-01   +8.268494796331549e-01   +1.153552633176494e-01   +3.963469429775245e-01   +5.217276766392752e-01   +1.042413488188294e-01   +8.440159918131752e-01; +5.556842944543756e-02   +5.058583367160994e-01   +5.148028640704533e-01   +5.709766510702200e-01   +1.468694741658902e-01   +1.561866051331962e-01   +4.952931843163139e-01   +8.822474325673162e-01   +8.380172836921842e-01   +4.558127881126910e-01   +2.177042057501871e-01   +3.277394692220140e-01   +1.348074502938444e-01   +5.171242926616580e-01   +7.227989012400303e-01   +4.251098302000370e-01; +9.400221584354981e-01   +6.613095569230742e-01   +3.557962431104297e-01   +3.823065923563346e-03   +5.031437811102744e-01   +9.230676198060115e-01   +5.216890413907606e-01   +3.310757131384954e-01   +1.170283480233435e-01   +4.529507571719568e-01   +2.684032345515066e-01   +4.639094707495511e-01   +3.397225330794740e-01   +3.899397344636207e-01   +4.536247304840832e-01   +5.596813045977560e-01; +7.446713578464803e-01   +6.393393730940895e-01   +6.521741165541468e-01   +5.934546068438888e-01   +4.150947791895860e-01   +5.631461015926615e-01   +8.555980563521726e-01   +9.410506114314333e-02   +5.236033972551155e-02   +9.626070785189983e-01   +8.961172046110322e-02   +7.164185345262191e-01   +1.241522754007431e-01   +4.820032348534843e-01   +1.337925242857273e-02   +4.477116704209638e-01; +2.393706220724310e-01   +1.417421939595937e-01   +2.778003681649293e-01   +8.972580003952675e-01   +1.760058203407088e-01   +9.239732843293867e-01   +2.505178231315810e-01   +4.476730609916832e-01   +5.252513670595594e-01   +5.256312206455506e-02   +9.167418326212844e-01   +4.006885913882311e-01   +3.694017816358233e-01   +7.438342038759659e-01   +1.193701871048709e-01   +7.608554422728939e-01; +2.019122082126009e-01   +1.782619732971359e-01   +4.328700339964005e-01   +2.589842688947388e-01   +4.957152674666859e-01   +5.989003176427538e-01   +5.769642215986758e-01   +2.363143018628200e-01   +7.024189769896776e-01   +3.876599662565552e-02   +7.302777282517166e-01   +2.401228801370078e-01   +2.482270518312947e-01   +7.065512069071952e-01   +6.583023730672595e-01   +9.626608020831703e-02];
L1E_L1I_iGABA_netcon = [+8.390465456022792e-01   +7.496422187089590e-01   +8.742929216009677e-01   +4.376094604931350e-01   +9.220657240234612e-01   +7.690406048262981e-01   +3.205468626158429e-01   +6.394159329218863e-01   +9.361573583716916e-02   +2.952014429032705e-02   +1.338367544001539e-01   +5.218152856394219e-01   +8.728934485937074e-01   +5.743042954814179e-01   +1.707158160947566e-01   +6.307488856990832e-01; +6.147786473376006e-01   +9.939890043761175e-01   +3.114888127602973e-01   +1.471570784320718e-01   +8.849143088375732e-01   +2.750095490690756e-01   +9.662390274963865e-01   +4.354626030658924e-01   +2.933008723810391e-01   +5.083858234090518e-01   +4.297963028894853e-01   +2.032931379294318e-01   +8.049294930687421e-01   +2.890053945636273e-01   +5.837156190971875e-02   +3.409964104041617e-01; +6.666763517442627e-01   +3.725373035278875e-01   +4.327208783170731e-01   +6.505629475432524e-01   +5.893902656918111e-01   +5.240954380711453e-01   +3.535145057626434e-01   +4.844593905712385e-01   +3.296626081131439e-01   +8.648780719275122e-01   +4.820676766236262e-01   +7.707413736350656e-01   +6.402852665565133e-01   +1.380005400395444e-01   +2.139654810423192e-01   +1.546474383666599e-01; +7.808327014479375e-01   +5.030879005400144e-01   +3.796392431221688e-01   +7.253892673505337e-01   +8.377352966226160e-01   +4.076539961735942e-01   +3.206339375746899e-01   +1.002274555476291e-01   +4.795753881256859e-01   +5.822406600724439e-01   +6.713317930784860e-01   +3.861422149899351e-01   +7.328859583759855e-01   +4.440390848292251e-02   +2.092072818724177e-01   +4.012842966251592e-01; +3.122460383715890e-01   +7.525796050510516e-01   +6.552345834912475e-01   +1.681539384939655e-01   +7.784319017223856e-01   +7.835101012306042e-01   +9.126591181101291e-01   +8.074405618517464e-01   +2.428047733851809e-01   +4.253358101016643e-01   +3.528865209776846e-01   +6.634468184233815e-02   +6.681841174246848e-01   +6.230175497032161e-01   +2.183238347666930e-01   +9.131692697252182e-01; +3.285898005210575e-01   +1.332603117701514e-01   +2.441948526970733e-01   +3.419464849282943e-01   +7.882701790283712e-01   +2.580076087194509e-02   +8.838213341904401e-01   +6.059323371926698e-02   +4.585211101291918e-01   +7.181991717449359e-01   +4.821856637989864e-02   +7.558112588940481e-01   +8.896863502147817e-01   +6.058057817968305e-01   +5.783643337503278e-01   +1.577905730485893e-01; +6.323277037580632e-01   +5.138760396278577e-01   +6.861213304037003e-01   +1.061270896944015e-01   +6.958223695574826e-01   +4.075361437521685e-01   +3.586053273585958e-01   +9.565729678047294e-01   +7.578018702481871e-01   +2.290930669335225e-01   +2.925726829135064e-01   +4.561125908407236e-01   +8.537057865409334e-01   +3.716021136985271e-01   +3.569566013958468e-02   +4.667437545160650e-01; +9.017325334730034e-01   +9.058675987669274e-01   +3.298979340307028e-01   +4.342308046532947e-02   +1.986896266836565e-02   +8.275948505219692e-01   +7.453854074542412e-01   +7.710244394578172e-01   +7.139346678584086e-01   +5.688888747587158e-02   +7.976028878624772e-01   +3.177033938167280e-01   +4.087327767031151e-01   +8.347233170140770e-01   +7.955743793346423e-01   +7.685231269799062e-02; +3.741744292407949e-01   +1.020905241094456e-01   +8.753092185974128e-01   +4.748564826640799e-01   +3.248203976773920e-01   +5.906561110099130e-01   +1.264429701834508e-01   +4.431866251473632e-01   +2.296874084489529e-01   +9.796357677802405e-01   +6.518291953179138e-01   +2.750386896587341e-01   +1.101358458670419e-01   +5.175168558905953e-01   +1.347321051623627e-01   +3.379323316114700e-01; +8.826374289223551e-01   +1.793513477729679e-01   +9.980720274078614e-01   +4.782103130296158e-01   +9.448834713651276e-01   +2.127873838452770e-01   +5.938821568988397e-01   +1.646959909931004e-01   +7.024332834790705e-01   +9.709899601802325e-01   +7.068452216479743e-01   +5.743998416373571e-01   +4.075436643526767e-01   +8.081479752154715e-01   +5.779676804784293e-01   +4.919554160864885e-01; +1.186353697186699e-01   +1.782115027156193e-01   +6.843725477253816e-01   +5.500792165160001e-01   +4.061654542268442e-01   +2.957607787844133e-01   +4.393513247239665e-01   +8.302954364888902e-02   +3.053371870390307e-01   +1.346924488126455e-01   +7.578874400014526e-01   +9.092654554292420e-01   +3.376850781289292e-01   +5.734941052944685e-01   +8.535752868751102e-02   +4.972976571800942e-01; +9.270106199127941e-02   +5.397048779778277e-01   +3.449371150683854e-01   +6.507138736508706e-01   +6.304067087338863e-01   +2.674862347073477e-01   +9.619447593580454e-01   +7.395070216531915e-01   +4.658404934117336e-01   -4.039989799978531e-04   +3.888788648937984e-01   +4.509996043366230e-01   +1.134798904310434e-01   +7.123195329762806e-01   +2.253599990426367e-01   +1.285010658018227e-01; +5.445672683619509e-01   +9.745424272590976e-01   +5.626378460143491e-01   +3.481236186604058e-01   +8.533872354507072e-01   +9.334988731159662e-01   +9.720958882803484e-01   +5.355038953901947e-01   +4.421742164797583e-01   +9.291372436874258e-01   +3.643245484886465e-01   +9.800892292471698e-01   +8.568602713723220e-01   +7.359821323573688e-01   +4.485645962162803e-01   +7.987224153605763e-02; +6.034829429655512e-01   +8.445896299403948e-01   +8.927494131891964e-01   +2.538304829120921e-01   +3.712740637720852e-01   +5.528000762198120e-01   +2.483072533197707e-01   +4.868804865071086e-01   +7.318785711664234e-01   +7.379254619504718e-01   +8.143520955481562e-01   +1.063673545842736e-01   +8.942688050801630e-01   +4.470153357942005e-01   +1.786471782028453e-01   +6.750155434395515e-01; +7.274486626740788e-01   +6.703350864974087e-01   +6.486000942474579e-01   +1.817530388131188e-01   +2.029642507414876e-01   +4.320607871276428e-01   +7.737349092654764e-01   +8.884761564795135e-01   +8.744225554436170e-01   +4.284603686416781e-01   +3.909653591756536e-01   +4.217097096166972e-01   +6.889209100349183e-01   +2.826741248876701e-01   +4.142372661563196e-01   +1.195878080618390e-01; +9.913945075263720e-01   +1.283542100310776e-02   +3.768900144032378e-01   +4.750703688001865e-01   +9.070422618478823e-01   +3.250824056034252e-01   +7.096834410471828e-01   +5.845713912969102e-01   +9.112719453558713e-01   +9.466368671143122e-01   +8.723317847219376e-01   +3.865460359694086e-01   +7.486243133797628e-01   +1.532544571930332e-01   +9.665982233300575e-01   +9.900800135869033e-01];
L2I_L1I_iGABA_netcon = [+5.754463842259118e-01   +5.640423349968137e-01   +1.050750170735146e-01   +4.539456131104321e-01   +7.951652603508240e-01   +9.774393869353026e-01   +2.231089099532688e-01   +7.599004051675433e-01; +5.632265605101915e-01   +9.534921523593272e-01   +1.248661201466374e-01   +5.682124769960708e-01   +5.463675511846424e-01   +4.261624035182589e-01   +6.589076327315165e-02   +4.981187312495459e-01; +6.111194093105875e-01   +1.018625532634571e-02   +4.332193890749870e-01   +8.178685975292094e-01   +2.605981939002195e-01   +3.947762644849989e-01   +8.295398964855094e-01   +8.273766172530848e-01; +4.672416782099519e-01   +1.278677422861560e-01   +9.291009430826752e-01   +3.589199767152516e-01   +7.803904142641565e-01   +4.590118621136767e-01   +4.152547074981845e-02   +9.189270242889954e-01; +4.364232753141594e-01   +8.535961881404105e-01   +1.357487855423727e-01   +2.449711295658730e-01   +7.755394717362608e-01   +1.262643728278304e-01   +9.101059752290576e-01   +7.085894498486639e-01; +6.737227554061231e-02   +2.185568993828647e-01   +8.244537894409468e-01   +7.636884338247376e-01   +1.458359909481266e-01   +4.578521133293589e-01   +4.553691867461455e-01   +8.005703646935892e-01; +6.389009479730376e-01   +7.049266356311863e-01   +9.305512212103034e-01   +3.084841871631350e-03   +8.260415232760776e-01   +2.645802970567965e-01   +2.820994281678243e-01   +9.583186525813142e-01; +4.265529898512609e-01   +7.733363266572914e-01   +5.716518948918705e-01   +2.739750098425792e-01   +6.242027631153145e-01   +1.024333720450653e-01   +7.581244678284519e-01   +9.507337029527173e-01; +7.512313537148619e-01   +4.225345194095713e-01   +4.982505428521821e-01   +3.249342516589913e-02   +4.574574690678456e-01   +6.586486386082581e-01   +9.275834107215395e-01   +2.984563520778530e-01; +3.068966555641016e-01   +7.295848504688555e-01   +9.295826064114142e-01   +6.718589888584496e-01   +4.844591910475148e-01   +9.410210236679449e-01   +1.413421615581089e-01   +3.549844101436752e-01; +5.995497347086094e-01   +4.553886862408108e-01   +8.620122120020564e-01   +9.719368207599022e-01   +2.207166404265014e-01   +7.644489997297083e-01   +9.476345298935722e-01   +5.446315442883799e-01; +3.335160700732349e-01   +8.049037804615088e-01   +2.553279306368791e-01   +9.454921192630830e-01   +8.581944167591092e-01   +4.199914238111257e-02   +3.110985051558515e-01   +2.128386985129658e-01; +6.481694828728682e-01   +4.317792347089955e-01   +4.575332843659689e-01   +4.832541724911241e-02   +8.774130510506160e-01   +2.622304507252092e-01   +2.083519500700973e-01   +8.016146844825248e-02; +5.686280365748339e-03   +1.482630090858853e-01   +7.357851525462668e-01   +2.895714860155492e-01   +8.425979074464880e-01   +6.428128954051273e-01   +4.622067458041595e-01   +5.131842090376515e-01; +1.462499257757655e-01   +8.036082990611363e-01   +7.515475506299707e-01   +4.836951010009937e-01   +4.403657340404662e-01   +9.168825272030927e-02   +5.957118432940063e-01   +1.996481554295278e-01; +2.472889527551030e-01   +3.760398138275815e-01   +2.366643894051932e-01   +8.874948857028170e-01   +5.456946039916573e-01   +7.481086464095178e-02   +5.505209977357313e-01   +1.430276163292633e-01];
L1I_L2I_iGABA_netcon = [+7.069796456791464e-01   +8.683091579526632e-01   +6.135356614197031e-01   +4.974421657408235e-02   +1.438361145220104e-01   +2.360703454653185e-01   +8.416905233794907e-01   +3.696788155725413e-01   +7.114631449926838e-01   +3.860118239368061e-01   +2.440395763789383e-01   +6.694226500443281e-01   +1.621710735786903e-01   +5.738295376098134e-01   +4.190630065521501e-02   +4.314136141346245e-02; +6.043076708308202e-01   +8.010966574231106e-01   +6.161784986003868e-01   +5.774902555854227e-02   +7.497218123819522e-01   +5.550292359862409e-01   +2.012996575581546e-01   +5.597426152191893e-01   +1.873106764872101e-01   +7.252678013648043e-01   +5.079415838942041e-01   +3.358520425957787e-01   +1.095468648268073e-01   +8.100251242112282e-01   +4.365532532489926e-01   +9.208332701851997e-01; +1.642205808060861e-01   +6.224042329171221e-01   +3.097168791449089e-01   +5.970772043082198e-01   +9.554798430095623e-01   +1.128900974550767e-01   +6.170192369278292e-01   +8.313325599542465e-01   +2.314989405129615e-01   +6.347201822945813e-01   +7.346021566316957e-01   +5.483344389338126e-01   +7.410307985350798e-01   +6.740553062226612e-01   +9.244030811642210e-01   +1.762734448337268e-01; +4.801345462478746e-01   +4.734237095017998e-01   +1.341555088116343e-01   +6.608413003430829e-01   +2.662673163748593e-01   +8.207053493677354e-01   +1.598183709897526e-01   +7.144082441734901e-01   +9.988737153925293e-01   +1.006139089909262e-01   +7.799416734126216e-01   +5.380340871648311e-01   +2.174864878515805e-01   +4.413353760140248e-01   +8.822317741335077e-01   +7.442112352900863e-01; +2.901968692337524e-01   +1.913581908437929e-02   +6.025840452589775e-01   +4.847571886868725e-01   +8.992258106868414e-02   +6.552708053598684e-01   +5.839773941772629e-01   +1.164561190158710e-01   +9.026298570844468e-01   +4.924234893194350e-01   +6.810447132601051e-01   +9.036382854412393e-01   +4.861641543110057e-01   +8.914031832729117e-01   +9.513436400968503e-02   +4.736495550286898e-01; +4.037633550818104e-01   +1.218999439272110e-01   +8.937027893606375e-01   +9.820094595221317e-01   +2.326466909460526e-01   +2.363692576944730e-01   +5.439969894462727e-01   +7.388125061164394e-01   +1.526518962264956e-02   +5.575643284902940e-01   +8.177308995516541e-01   +2.798036342371064e-01   +5.016086875999321e-02   +7.861378885980702e-01   +6.797789492903171e-01   +2.514585168470212e-01; +4.917597355390934e-01   +7.198362849716130e-01   +5.652461381462690e-01   +8.666780307712013e-01   +8.912251583512975e-01   +3.031973617002039e-01   +6.860597573714085e-01   +9.254120853387980e-01   +8.327166177081162e-01   +5.385419953638618e-02   +4.199219913417110e-01   +1.428175073048083e-01   +5.773020065023142e-01   +5.871941591790472e-01   +1.015936871603647e-02   +6.670811397921538e-01; +8.623395855352265e-01   +6.718353757094765e-01   +6.325015821324522e-01   +9.557227567374568e-01   +1.990140106087211e-01   +3.298558380974193e-01   +7.004254008200343e-01   +9.211775569060462e-01   +2.506712492559750e-01   +8.312589817073612e-02   +4.951206357179889e-01   +9.583375663782266e-01   +4.977668513347489e-01   +6.213139009509074e-01   +1.239553801673162e-01   +6.090972181538351e-01];
L2E_L1E_iAMPA_netcon = [+3.721386537234755e-01   +5.634707903265148e-01   +2.022003404117744e-01   +5.169751743088112e-01   +2.924743880953926e-01   +6.988207367432361e-02   +2.805683506014193e-01   +2.656542517852022e-01; +4.357477429163283e-01   +1.847177342059561e-01   +1.355733163989072e-01   +6.861315897265673e-01   +6.234978907834472e-01   +5.884284146740498e-01   +9.309608241018297e-01   +9.018070359949258e-01; +7.179639423463013e-01   +6.063223078479498e-01   +8.391769557533427e-02   +2.066715385697092e-01   +8.686346263548009e-01   +7.777457277898184e-02   +7.599435396805625e-01   +1.549205810268631e-01; +1.909097563384635e-01   +7.369417037530318e-01   +9.314460090433171e-02   +9.733235591144325e-01   +8.161888773658336e-01   +3.990739397736452e-01   +2.620725217476532e-01   +5.518857934718393e-01; +4.129015397360936e-02   +8.346772499654779e-01   +5.509106760876877e-01   +3.514715009425270e-01   +2.094152677984558e-01   +5.781953632399105e-02   +2.451210599571571e-01   +4.227035906472484e-01; +3.175913336445623e-01   +2.746838382161859e-01   +7.325885470590090e-01   +1.814950001342039e-01   +7.499617280022453e-01   +1.274677428409706e-01   +1.633392850638822e-01   +5.489477430778197e-01; +7.914190245339129e-01   +6.098212900047950e-01   +5.469021247839909e-01   +2.433678994200126e-01   +1.981770584817013e-01   +2.428138696031834e-01   +2.894717403877293e-01   +7.478021090914058e-01; +4.496367975988322e-02   +5.490432608134327e-01   +4.713414830676549e-02   +2.565600083533863e-01   +5.787068975027757e-01   +9.442385109980654e-01   +5.644367844646075e-01   +9.793137568976937e-03; +2.152357770475617e-01   +2.785078969028020e-01   +6.372252088482020e-01   +2.205487398627100e-01   +8.770362831341335e-01   +2.054674319282820e-01   +3.998024130332372e-01   -1.760686887149856e-03; +2.701480235553845e-01   +3.375315228660101e-01   +9.931372834514292e-01   +3.587738443006350e-02   +7.167799117194733e-01   +3.299421726259750e-01   +9.887055224412504e-01   +2.081602737067253e-02; +7.897216585148847e-01   +5.701327477765750e-01   +9.113306268900896e-01   +3.563871710190432e-01   +7.007776392973771e-01   +8.641505799951237e-01   +5.475534533498331e-01   +3.525142058928440e-01; +9.839520809006455e-01   +7.395746957690470e-01   +7.737130497695365e-01   +8.973621823239879e-01   +4.618443516224633e-01   +9.208081974447506e-01   +9.290753245118213e-01   +4.280835621388564e-01; +9.771138369813347e-02   +7.675950875337323e-01   +1.939390563170172e-01   +1.370693585150470e-01   +5.032791431354017e-01   +1.891042541185045e-02   +9.898901595670347e-01   +5.452101255657963e-01; +1.982127833023561e-01   +4.030571904555020e-01   +3.092943945443210e-02   +9.542121268947378e-01   +8.026113911974196e-01   +3.599215915876287e-01   +8.352752357597977e-01   +4.847119518467072e-01; +1.200633829138362e-01   +1.517500556118397e-01   +3.803918341467429e-01   +9.027849839832345e-01   +9.357514923186638e-01   +5.311608666903110e-01   +1.773907585707458e-01   +9.159695432884253e-01; +6.385408881284272e-01   +2.025702071152679e-01   +5.779209908921253e-01   +4.110642806548640e-01   +7.886571761495558e-01   +4.035109862064474e-01   +3.098777825609225e-01   +4.171874168586805e-01];
L1E_L2E_iAMPA_netcon = [+4.988733666053032e-01   +4.519669336505477e-01   +6.129049994713526e-01   +4.930207431535346e-01   +2.330675341016904e-01   +7.159724725237341e-01   +6.885047916052285e-01   +6.344338577649541e-01   +5.231787098677073e-01   +2.421711914558102e-01   +8.737089584464668e-01   +1.776313622649804e-01   +1.380656414631539e-01   +2.478099442628799e-01   +1.858202321237188e-01   +2.558648751209649e-02; +8.350456427437444e-01   +3.647993908086263e-01   +1.075151421976599e-01   +6.611762807132900e-01   +8.367087250596414e-01   +3.812851279672794e-01   +9.743962364592138e-01   +6.209823783336481e-01   +6.712840598606415e-01   +7.254487707621335e-01   +6.618119725634961e-01   +3.004603589796172e-01   +2.839271577294762e-01   +7.493912208498328e-01   +1.508670016437272e-01   +2.457560826450717e-01; +1.849547442129885e-01   +2.986802908651927e-01   +7.572188824239210e-01   +1.791882571598283e-01   +7.363798989749408e-01   +3.795273984186176e-01   +7.561882359759186e-01   +4.094594598529337e-01   +7.730186655837185e-01   +1.297071698544222e-01   +5.420234213655620e-01   +1.075206846853524e-01   +5.334076483370326e-03   +9.308609524451039e-01   +1.351304487302518e-01   +9.867005017047504e-01; +3.408663582013490e-01   +2.360250906282244e-01   +5.409133908010613e-01   +4.775583670483584e-01   +4.888115900851024e-01   +7.161258390938706e-01   +5.560085592762194e-01   +4.273508445862594e-01   +4.630217293138836e-01   +4.494619618992748e-02   +2.524445501115970e-01   +4.501198870505634e-01   +3.085281995155238e-01   +3.006797101707018e-02   +1.619576105294398e-01   +6.319932162173687e-01; +6.932448191222023e-01   +1.390088690100015e-01   +4.447802241110156e-01   +5.014037470349553e-01   +8.505711528511033e-01   +8.347702137610543e-01   +2.868687015888548e-02   +5.087508415904454e-01   +9.061766203926295e-01   +6.506298010107370e-01   +1.083540503471683e-01   +5.891268802303965e-01   +9.057599127285059e-01   +4.317406327032802e-01   +9.198003332127024e-01   +3.574931375285302e-01; +6.967149775133931e-01   +1.037431136604383e-01   +7.429391890317361e-01   +6.025008997207227e-01   +7.207054336262574e-01   +6.671439997563778e-01   +1.915798106512640e-01   +2.637374350044596e-01   +2.354327571631161e-02   +2.000400864763242e-01   +9.715907834181652e-01   +2.211960323373389e-01   +2.941049795804908e-01   +8.295210572271383e-01   +2.631689191089825e-01   +9.440745779228754e-02; +3.688134555399100e-01   +2.293111298757228e-01   +3.851962477279968e-01   +2.460257391106398e-01   +5.218344019358149e-01   +6.516080507329660e-01   +9.388846717363402e-01   +4.229780583843845e-01   +4.847854134534862e-01   +9.760976166991777e-01   +5.909982088118371e-01   +1.101764224773080e-01   +8.260346315422865e-01   +9.963191878858181e-01   +2.070289283989221e-01   +4.119567464142276e-01; +3.251157821406628e-02   +3.438754928013240e-01   +5.334579343194736e-01   +5.173136984001291e-01   +9.373267105247476e-01   +5.603846806831835e-01   +3.954825369871336e-01   +5.208504596687673e-01   +2.761882055654640e-01   +8.215430762437914e-01   +8.202577826215529e-01   +5.594015061361867e-01   +7.430477177949286e-01   +9.210997678884791e-01   +6.168417476730660e-01   +9.311839537638701e-01];
L2I_L2E_iAMPA_netcon = [+6.711041095429043e-01   +6.081786749296848e-01   +3.952259377247793e-02   +8.002409108265809e-01   +5.208146249148160e-01   +8.234357285789878e-01   +6.478143480887808e-01   +3.870084931424100e-01; +2.388350226791128e-02   +9.444849709021975e-01   +5.425701869331375e-02   +9.360141744780838e-01   +6.577014277475103e-02   +1.094990477291630e-01   +3.628025133970385e-02   +1.733919947462113e-01; +7.390464793656596e-01   +9.625356693894248e-01   +4.051095556623808e-01   +9.401907915160822e-01   +2.871895030107669e-01   +2.147607053375788e-02   +5.620116785271466e-01   +4.468398465011353e-01; +2.163651154701087e-01   +3.699675949100957e-01   +9.809380482473756e-01   +1.416127348208891e-01   +7.136444355496248e-01   +8.111203745830811e-03   +3.068962428682399e-01   +8.750301370337461e-01; +8.564622377822715e-01   +8.022238525872067e-01   +7.128957785108836e-01   +3.256395879474650e-01   +8.840080498375186e-01   +3.360039977398583e-01   +2.616138705053227e-01   +4.051426725028287e-01; +1.603212382374568e-01   +7.268105243475862e-01   +9.876890099843567e-01   +4.310532091089682e-01   +3.631632820389689e-01   +6.669886446444792e-01   +7.193705268979211e-01   +1.651163549877603e-01; +6.723876102803270e-01   +9.544883001403296e-01   +6.477229271580189e-01   +7.067544271438663e-01   +5.649230199981280e-01   +5.941838201528347e-01   +3.095398136448270e-01   +6.621315825544706e-01; +9.351346271078306e-01   +1.463332312938240e-02   +5.061469883854678e-01   +6.162713915725699e-01   +8.787687639643215e-01   +7.662852246610409e-02   +8.998171288211546e-01   +9.299428002919700e-01];
L2E_L2I_iGABA_netcon = [+6.252394684142101e-02   +5.242414391437846e-01   +3.518175996139227e-01   +2.567971094990515e-01   +4.617468193620324e-02   +8.966147877655258e-01   +3.418994434113051e-01   +4.512211451306741e-01; +3.555663925921476e-01   +6.935576819919786e-02   +5.616669260342939e-01   +9.824582549665022e-01   +3.628572624371760e-01   +5.455403729784751e-01   +9.308081181721917e-01   +6.738086987935888e-01; +9.323251229213761e-01   +1.802709282251829e-01   +6.910599449777500e-01   +3.483826192916035e-01   +3.627300482160701e-02   +7.152501934844930e-01   +9.153560239188865e-01   +7.696030206319355e-01; +2.413850682606682e-01   +3.149409360120629e-01   +2.831112042530045e-03   +3.964734725238939e-01   +4.863154505461924e-01   +7.159548839578685e-01   +7.253966024962161e-01   +9.243412028088792e-01; +1.056832582525557e-01   +2.471336128670573e-01   +4.643507085346520e-02   +7.521758771775903e-01   +7.258489419857407e-01   +1.701725437999701e-01   +4.457046069092003e-01   +6.541364199477071e-01; +7.116489668377106e-01   +3.225924427377227e-01   +3.036653267809196e-01   +1.067331354403069e-01   +1.367463177826411e-02   +3.542375169128054e-01   +1.515906669511312e-01   +5.024978925716370e-01; +5.952973194507954e-03   +8.749407043673857e-01   +8.708889027801224e-01   +5.946898254998384e-01   +5.137242205434724e-01   +3.799081905915995e-01   +8.282909696079009e-01   +3.465068800684742e-01; +1.760474741100472e-01   +3.055395580659468e-01   +6.241354073090485e-01   +1.223505377497685e-01   +2.402880281183315e-01   +7.607240450350701e-01   +2.522690909285384e-01   +9.478305519078225e-01];
L3E_L2E_iAMPA_netcon = [+7.706961375389808e-02   +1.741970027505295e-02   +3.691217939206028e-01   +4.944127552922610e-01   +2.102674100081835e-02   +9.602189577951682e-01   +3.581698694263272e-01   +2.138978800737649e-02   +2.050706815566064e-01   +6.826095498962102e-02   +2.448208377410983e-01   +9.977586376369980e-01; +9.511736267756900e-01   +9.796507803747742e-01   +1.144187071362159e-01   +6.462475576257612e-02   +8.066543036662333e-01   +3.903734897052508e-01   +2.283680535516150e-01   +1.274828966985145e-01   +3.559855415426262e-01   +7.415175179523793e-01   +5.362171740356633e-01   +3.433884175690629e-01; +6.643947676176909e-01   +7.200342042864581e-01   +5.122318617398605e-01   +8.693699206892984e-01   +7.957251066555777e-01   +6.623804258918653e-01   +7.268882956089737e-01   +6.639586999576191e-01   +8.902876908730530e-01   +9.936623672711877e-01   +3.339179267863207e-01   +8.265960842056296e-01; +1.686243227554576e-01   +8.739169216666376e-01   +9.024542318990006e-03   +9.985955868063876e-01   +4.199247866804615e-01   +5.845855663231334e-01   +7.715567616921967e-01   +5.076345731561809e-01   +8.192197283827477e-01   +7.673450563882689e-01   +6.693984665413043e-01   +1.109749456615536e-01; +1.973546706909427e-01   +8.180806990392564e-01   +8.705609820739867e-01   +1.209909442448895e-01   +6.315177640226977e-01   +5.172186983770957e-02   +3.423593746261786e-01   +7.881656839420736e-02   +3.183971126305488e-01   +8.873155384760713e-01   +8.767486897850895e-01   +7.805683929871456e-01; +9.920226169761451e-01   +3.341194390183598e-02   +9.100356208129937e-01   +1.064872148550791e-01   +5.667960871208070e-01   +7.098115500734793e-02   +5.720451389762818e-01   +5.388793403944039e-01   +5.997087148691255e-01   +4.143223927720598e-02   +9.836341431304868e-01   +1.515750830694100e-01; +9.276066514349197e-01   +9.536630835807146e-02   +1.092243189736391e-01   +1.479208750391518e-01   +9.022512266793433e-01   +2.320104784300697e-01   +6.393208928480081e-01   +6.813096963422929e-01   +7.002221521934220e-01   +7.954233031907706e-01   +1.416852931071291e-01   +7.312614788144428e-01; +9.774253059166303e-01   +9.287309686967460e-02   +4.439077055510529e-02   +1.276340962614088e-01   +7.485354223277784e-01   +4.146682812106038e-01   +3.704202087609882e-01   +5.900232740252658e-01   +1.795398064281850e-01   +7.111086268646672e-01   +8.802865120228057e-01   +1.157008685946682e-01];
L3I_L2I_iGABA_netcon = [+7.710929340756446e-01   +5.371607529264831e-01   +5.965139924912809e-01   +3.060639302519770e-01   +9.669216961447694e-01   +1.148387303598482e-01   +2.943118434424447e-01   +7.959034644562545e-01   +9.219451319071444e-01   +9.927169312746750e-01   +3.124399658119830e-01   +9.932977002221907e-01; +6.354982288830524e-01   +4.487504731275795e-01   +5.605425686581973e-01   +7.561743475438224e-01   +5.481874863852502e-01   +6.441122599206778e-02   +1.648398116697145e-01   +5.106477316165994e-02   +3.857313679188260e-01   +2.910713465230756e-01   +4.468155805769711e-01   +9.182041721504001e-01; +7.990149363705444e-01   +1.163573083390482e-01   +7.338757951910575e-02   +6.516814541348379e-01   +9.806937988373331e-01   +4.476686413908678e-02   +7.223904980467324e-01   +1.791759532139518e-01   +7.495952903562280e-01   +5.208233163730973e-01   +2.036807412639140e-01   +6.903007365259942e-01; +9.618603779975925e-01   +7.169806584293577e-01   +7.712421413125784e-01   +3.332041366876279e-01   +1.255126111282255e-01   +1.332796325785023e-01   +2.989195859191385e-01   +2.446551220366429e-01   +8.768587027320877e-01   +3.593328493732885e-01   +9.421451851723757e-01   +2.180353295384258e-01; +7.119650738006522e-01   +1.815213909144591e-01   +8.619340848826884e-01   +9.750404188830936e-01   +1.646724973666716e-01   +4.906820635975405e-01   +6.771279554917310e-01   +2.574208768311460e-01   +3.961446989828857e-01   +5.192723645631380e-01   +2.898318896134737e-01   +3.151004994743832e-01; +6.450026236214997e-01   +3.251286248813334e-01   +7.036031627494385e-01   +5.299883775478516e-01   +3.365595232556623e-01   +4.687227213290570e-01   +7.471025939965648e-01   +6.522516746810355e-01   +1.684758452174930e-01   +4.948847074641753e-01   +1.184239281444383e-01   +2.280865111095149e-01; +5.149404962561568e-01   +9.663600570637524e-01   +1.076294944916132e-01   +7.509324270256171e-01   +5.355577379055615e-01   +1.549537505636469e-01   +7.464263307377615e-01   +1.006347274690838e-01   +4.381314785970179e-01   +1.839541271989198e-01   +6.967168936819440e-02   +7.074571756754920e-01; +9.493088594900114e-01   +7.000471113182939e-01   +6.595358242123304e-01   +2.655132660257571e-01   +6.919427094457592e-01   +1.375887955282868e-01   +7.791630914427425e-01   +4.685903078894465e-01   +8.533524982424849e-01   +4.791826097109739e-01   +7.285311625418824e-01   +3.718203090482592e-01];
L2E_L3E_iAMPA_netcon = [+6.594011412050238e-01   +3.864809610999515e-01   +2.355490385190707e-01   +4.635791336889905e-01   +9.039390065570574e-01   +9.549268780308257e-01   +7.664353308626767e-01   +3.578855031993595e-01; +3.811838081943061e-01   +2.109011927393920e-02   +9.130683602431061e-01   +2.897515901703507e-01   +6.843135827070652e-01   +1.907471690286506e-02   +8.989584882429530e-01   +6.605708318601768e-01; +3.059859008239276e-01   +3.303448869689914e-01   +4.868586142298374e-01   +2.764079876200832e-01   +8.453232900560809e-01   +4.988194479030299e-01   +7.906280568950464e-01   +5.901248376360564e-01; +1.553055588163606e-01   +4.886335996380321e-01   +5.913409980777791e-01   +1.430879291326092e-01   +9.625617018983056e-02   +3.359701523615835e-01   +9.511115753480657e-01   +5.455115148212685e-02; +7.735780574860845e-01   +2.631768745122930e-01   +9.537557460538234e-01   +1.449378596188738e-01   +7.384277222766886e-01   +6.668567417619417e-01   +5.352857287755887e-01   +2.120062568129853e-01; +7.109933238379585e-01   +5.278390311702010e-01   +8.020041662456233e-02   +2.650864911653498e-01   +5.478646442109059e-01   +1.662826978934968e-01   +1.612713400484597e-01   +6.023521819524221e-01; +1.706889795360402e-01   +4.140828249045667e-01   +2.228311450368383e-01   +6.079866475288985e-01   +2.541835214165760e-01   +2.264420337588340e-01   +1.368792920936091e-01   +2.693500245174124e-01; +4.503423691448466e-01   +2.011999757108817e-03   +1.579230834039816e-01   +1.016104976491937e-01   +7.144103261104019e-01   +1.146478980085312e-01   +2.515484597622874e-02   +1.130951707691287e-01; +8.410254088001918e-01   +8.902984528100191e-01   +3.948618943244577e-01   +4.877742940851832e-01   +3.592277740606555e-01   +9.902769673475235e-01   +6.846202676765161e-01   +2.177881406867467e-01; +7.016698549515497e-01   +2.388609511232514e-01   +1.846015765515955e-01   +8.966424924560336e-01   +8.449056225186302e-01   +1.382486157561197e-01   +5.855699436627321e-01   +8.800510293635574e-01; +7.634273925397536e-01   +7.987097436808811e-01   +7.634208342638185e-01   +1.899827901524196e-01   +8.207943409395640e-01   +7.658467400560268e-01   +2.939270347059159e-01   +4.609098658961740e-01; +9.772252948146756e-01   +5.819235607215572e-01   +2.284089232794470e-01   +5.296883570667645e-02   +6.166582888144576e-01   +6.266294423229718e-01   +7.432028450351288e-02   +7.331361922145663e-01];
L2I_L3I_iGABA_netcon = [+5.914949040904064e-01   +1.430280509515909e-01   +3.456136631829103e-01   +3.707322439664125e-01   +5.984306265251402e-01   +5.092191602872833e-01   +7.702732440981233e-01   +2.678941089846572e-01; +8.388807748490762e-01   +9.928993476543864e-01   +4.315045247579491e-02   +5.357424559662599e-01   +4.743053038316949e-01   +2.418863032702632e-01   +1.787310381869352e-01   +5.942001894857487e-01; +6.074792247123684e-01   +4.841475053216888e-01   +9.470480875658134e-01   +9.716205351001261e-01   +3.789926719161097e-01   +2.747149389831650e-01   +4.534889043594528e-01   +6.807550149963120e-01; +7.471267487492566e-01   +3.956066896552359e-02   +8.626488375446850e-01   +9.982959841094375e-01   +9.820779983789930e-01   +4.108697921748564e-01   +3.012421158148466e-01   +4.170601890211224e-01; +8.515458333119091e-01   +2.688578228235607e-01   +1.365183267255092e-01   +4.127138751969930e-01   +1.398199072319797e-01   +2.618558466312053e-01   +3.865058362196627e-01   +5.130507799667325e-01; +1.457493466746625e-01   +6.697075413504407e-01   +5.895651590959343e-01   +4.468357661589302e-01   +2.716609696196579e-01   +8.514046322283747e-01   +7.987863556080589e-01   +8.158680858083112e-01; +7.406687916288160e-01   +1.471402793085538e-01   +6.760689351429543e-02   +2.468808984457184e-01   +2.241666356784906e-01   +4.808193474691120e-01   +7.811977784793410e-01   +5.387484772778197e-01; +1.877235432995300e-02   +7.725107196310446e-01   +9.516473805813508e-01   +5.979458922001705e-01   +7.960208853260468e-01   +3.402854808361090e-01   +6.463613263200709e-01   +5.892031418430950e-01; +2.273505871871369e-01   +2.670277984131975e-01   +4.975583043839273e-01   +7.489229095256422e-02   +8.220114837351833e-01   +6.348483502994414e-01   +2.438846637494503e-01   +5.381274281236520e-01; +5.343168165353283e-01   +8.830042345164665e-01   +2.631877474686943e-02   +9.077753757714879e-01   +7.989793953230067e-01   +4.155140758881331e-01   +6.048515182286501e-01   +5.402718852002638e-01; +7.166358770832367e-01   +3.657389871899904e-01   +5.379838440171708e-02   +4.786528947086982e-01   +1.146763677262812e-01   +5.475821281487884e-01   +4.184117610349264e-01   +1.534932386876584e-01; +4.339504107310916e-01   +1.301417616055644e-02   +2.991020096676092e-01   +5.034395017178298e-01   +6.370246903241662e-01   +3.409382303566942e-01   +2.976267607588557e-01   +6.987760814930534e-01];
L3I_L3E_iAMPA_netcon = [+5.914334877982381e-02   +7.753025599058394e-01   +5.522882174361441e-01   +5.716933387650346e-01   +9.136376735476692e-01   +8.321055223058816e-01   +8.438631286191505e-01   +8.609168617321470e-01   +5.282198070805115e-01   +9.917816174079188e-01   +4.815550224232488e-01   +3.486639676563406e-01; +9.238292677181282e-01   +8.373051690000024e-01   +8.495042060782937e-01   +9.348771503391807e-01   +5.901287199159573e-01   +3.995051039417613e-01   +6.306662822354471e-01   +8.566771811328294e-01   +5.623060007342223e-01   +7.003734640988106e-01   +7.395256577766620e-01   +3.960836595036777e-01; +1.849622400427398e-01   +5.913561015507403e-01   +9.691656349989154e-01   +7.808837072976288e-01   +5.758991600998394e-01   +6.846781916577513e-02   +4.405063679949200e-01   +9.521404591407084e-01   +9.835941087180884e-01   +8.430238901655566e-01   +5.908704260125904e-01   +9.901867663161762e-01; +5.424445212171496e-01   +7.643997168312131e-01   +4.616029641073227e-01   +5.952583730170481e-01   +6.523600047744116e-01   +3.791898414447691e-01   +2.305582475528371e-01   +6.967068234375008e-01   +9.614967438181630e-01   +7.321824969513399e-01   +2.561306746799754e-01   +2.923424222041650e-01; +4.000224742508428e-01   +6.663635962814218e-01   +7.707254972902801e-01   +6.167234177609421e-02   +4.297480120908777e-01   +8.563642894347075e-01   +5.007026996404425e-02   +3.597861424567314e-01   +5.596712076910557e-01   +9.968534726914583e-01   +6.102881533366245e-01   +2.286797175557996e-01; +1.035209319369579e-02   +5.857829312706692e-01   +2.580929201649692e-02   +5.413559819090399e-01   +9.375595742376779e-01   +2.360977105800060e-02   +7.041709377179410e-01   +3.749165993754214e-01   +5.258627133180430e-01   +5.054659614141878e-01   +2.303983300733676e-01   +3.256576187193153e-01; +1.068793034576160e-01   +2.296047204112040e-02   +6.756030966908437e-01   +8.608558368107899e-01   +1.007644879577880e-01   +4.234985227972615e-01   +8.502267320692137e-01   +8.461926628374582e-01   +4.734109457920156e-01   +1.906582742864771e-01   +1.974591717124611e-01   +1.654097738613671e-01; +8.524285005280831e-01   +6.841643586629298e-01   +8.414508669037988e-01   +3.397730030928982e-01   +4.071208623517227e-01   +2.529661940652932e-01   +4.066348685819325e-01   +3.840287986312232e-01   +9.027662013561080e-01   +9.523716774798903e-01   +3.320403684057413e-03   +3.796457181726028e-01; +3.358921800658721e-01   +3.242226507986869e-01   +6.894736031123704e-01   +1.787563424802160e-01   +8.934353898933879e-01   +7.278585831375275e-02   +2.914378811842804e-01   +7.738431773238961e-01   +4.813375253983426e-01   +4.514609789553985e-01   +6.540268111719062e-01   +5.292927936689518e-01; +1.478310464930866e-01   +8.040805645844057e-02   +8.996676636575309e-01   +8.766419095684984e-01   +7.351499381430044e-01   +9.163152056552848e-01   +2.582562407498959e-01   +7.778857973033965e-01   +4.894246095690743e-01   +6.072121236357353e-01   +3.996850255858646e-01   +5.961211043483727e-01; +8.010278854447030e-01   +7.438408254996410e-01   +9.579400276135483e-02   +8.415963979478203e-01   +9.584112716192746e-01   +2.651352674586791e-01   +5.115181946324375e-01   +4.311077190287328e-01   +3.103926243934537e-01   +6.434828780157683e-01   +2.706476242212180e-01   +1.690495702541410e-01; +6.532574726383876e-01   +9.677498086558006e-01   +7.775861039837137e-02   +8.295124100936326e-01   +9.761330477324668e-01   +1.067579438282708e-01   +1.161193407999995e-01   +4.841635615037141e-01   +8.534489208791349e-01   +7.632468101247323e-01   +2.263726059807310e-03   +6.813687198255333e-02];
L3E_L3I_iGABA_netcon = [+4.433387955272899e-01   +6.461945330969672e-02   +4.374051588151912e-03   +4.916879738152570e-01   +5.449689368030197e-01   +2.517940752015706e-01   +7.181294268909308e-01   +7.594687953837757e-01   +3.789585812120829e-01   +4.485135420876041e-01   +1.991670239990996e-01   +6.551722948958059e-01; +5.979810325817601e-02   +8.085176435536124e-01   +1.298499515930617e-01   +1.914426420506686e-01   +2.169490714441479e-01   +3.323339861583918e-01   +2.238355989842330e-01   +8.888823552966310e-01   +6.085213897531250e-01   +3.940516753180082e-01   +8.272164522111920e-01   +9.046957141277395e-01; +6.267398799367720e-01   +9.134627554148949e-01   +3.080797496121662e-01   +6.447226862824394e-01   +2.691457476351888e-01   +6.001847730260298e-01   +4.996875262597574e-01   +7.327823380230647e-01   +1.670343782554353e-01   +6.756680989238342e-01   +4.394794756258141e-01   +8.362196439961835e-01; +8.052553031290234e-01   +4.243394824915531e-01   +2.362354360807213e-01   +2.549198895157314e-01   +1.363283952853086e-01   +4.814361066192305e-01   +4.750804463720233e-01   +6.948890921200588e-01   +1.010983142994658e-01   +3.372393341166831e-02   +4.147486468942976e-02   +1.726474167545652e-01; +4.039018432820579e-01   +1.905064332447403e-01   +6.496433090757009e-01   +9.436362069750909e-01   +1.665744310013724e-02   +8.959425317173343e-01   +4.288878974397157e-01   +6.425569154339720e-01   +6.203341008740006e-01   +7.850604393070147e-01   +7.655695685544815e-01   +1.622256390572659e-01; +8.821527780122360e-01   +1.841699444209580e-01   +8.112427841001235e-01   +2.912582690995895e-01   +1.199284504176207e-02   +2.903712085044811e-01   +5.541547019158781e-01   +6.167989941370646e-01   +9.609872678700891e-01   +3.732460295625235e-01   +9.438526435287770e-02   +1.379596495690312e-01; +7.205152361844791e-01   +6.707077210253026e-01   +7.398396624828590e-01   +1.439698385724889e-01   +9.832555398785791e-01   +7.485534021757538e-02   +2.091204584297972e-01   +7.654746385505058e-02   +6.709783435898594e-01   +6.405811147763234e-01   +6.570933108555844e-01   +1.582901734997033e-01; +1.995742750491319e-01   +5.264205792461105e-01   +1.198286099031370e-01   +8.647189582065952e-01   +6.469795482129070e-01   +3.871314510514919e-01   +2.767681352672067e-01   +5.480931414711669e-01   +4.724009706834852e-01   +4.953507617696543e-01   +2.675428848065350e-01   +3.985451611720057e-01; +3.730077313774181e-01   +7.745145148015202e-01   +1.728014938371251e-01   +8.828620502986133e-01   +8.162000486846785e-01   +1.924871838830809e-01   +8.088436617322996e-01   +8.791733763989366e-01   +3.387219678568275e-01   +2.182745153685809e-01   +4.371352661601636e-01   +6.622519376184574e-01; +2.083707662503081e-01   +3.015501826686275e-01   +2.680035353913425e-01   +6.628889544438026e-01   +2.798426027568981e-01   +7.279684786871304e-01   +9.817580057493208e-02   +9.857658017509366e-01   +5.900987620017553e-01   +2.117675412967014e-01   +8.500861318143070e-01   +2.234510324632854e-01; +2.618247805660751e-01   +4.756465324521614e-01   +8.129611765921754e-01   +9.978060863040370e-01   +1.255863534860197e-02   +4.232620497462762e-01   +3.490283860423304e-02   +7.088124439182007e-02   +5.424490398396461e-01   +4.525785722547100e-01   +9.047245140616902e-01   +6.418528270143958e-01; +9.918142452761445e-01   +7.097365963863073e-01   +5.928610742897484e-01   +2.678816385335485e-01   +1.026109178463484e-01   +2.686803914037599e-01   +7.228342431063167e-02   +2.928418334396607e-02   +3.831367032407202e-02   +6.340001452502250e-01   +2.865279275891934e-01   +6.096576874711385e-01];
L2E_Input1_iAMPA_netcon = [+9.993708155209443e-01   +9.923245271356413e-01   +9.975521165761601e-01   +9.907752115288474e-01   +9.879099026081735e-01   +9.986854654476505e-01   +9.852759210304750e-01   +9.997771003990874e-01];
L2I_Input2_iAMPA_netcon = [+9.976504787456946e-01   +9.973693617836802e-01   +9.885594500506978e-01   +9.899953836359198e-01   +9.898602618971056e-01   +9.892974356479626e-01   +9.917551279516003e-01   +9.955820650069627e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
